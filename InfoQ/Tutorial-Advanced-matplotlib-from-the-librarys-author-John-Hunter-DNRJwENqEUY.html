<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Tutorial: Advanced matplotlib, from the library's author John Hunter | Coder Coacher - Coaching Coders</title><meta content="Tutorial: Advanced matplotlib, from the library's author John Hunter - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Tutorial: Advanced matplotlib, from the library's author John Hunter</b></h2><h5 class="post__date">2012-04-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/DNRJwENqEUY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">become a weap Fatmir kind of the
standard thing here we've got a bitly
URL which has a zip file and if you get
that and download it unpack it and start
your notebook server from there you can
get all the stuff we've done here okay
so you need to once you've got them you
need to go into that directory so I'm
going to do that I'm going to go and do
this along with you basically so I'm
here and I unzip that MPL this looks to
be needs to be a little bit bigger
doesn't it so I don't know I'm like is
that okay or maybe a little bigger still
so if you go into the NPL workshop
directory do one thing here I'm going to
kill my notebook so here we are so you
want to start the ipython notebook and
then you want to start it with pylab
mode and there are two options we're
going to use both today one it's called
inline and the other is where you the
figures will pop out of the web browser
because we want to do some stuff with
interaction so we can have an inline
mode but we'll start off an inline mode
which means anything we generate in the
browser would be popped in I tend to use
this other option which is no browser
because I don't like it popping up
windows for me I'd rather just type in
the URL myself or copy/paste it so once
you've got that that will start your
notebook server currently has to be
started in the directory where the iPad
notebooks are but over time they're
going to get a file system navigation
built into it so I mean they're just
working as hard as they can basically
and so all of that will be coming in you
know we had a long meeting last night
where they were talking about where
they're going and they're going to try
to get hub integration so you can keep
your projects on github but pull them
into notebooks
remotely and I think they'll be doing a
lot of interesting stuff everybody here
I assume has used matplotlib number of
times that's why we're in the advanced
you've been to the website checked out
the gallery basically know that you can
sort of click on a plot type and see the
code that generated it so you know we
have hundreds of plotting functions that
are specialized for doing certain things
spectrograms power spectral densities
error bars histogram stacked bar charts
and you know every scientist or engineer
has a different kind of thing they'd
like to do so I'm not going to
concentrate a lot on those because you
know what's really important to one
person is totally useless to another one
I mean I can go my whole life and never
make a bar chart basically but somebody
else might make them every single day so
instead of focusing on those kinds of
things I'm going to try to focus on
things that should be somewhat generic
to all classes of users and that sort of
customization configuration customizing
the look and feel of things doing event
handling you know interacting with your
figures and then I'm going to just you
know finish up with a few tick trip few
tips and tricks like stuff that I do a
lot in my plots that I think you know
add a lot of visual appeal or
functionality and so you know I'll
finish up with some concrete examples on
on some things that maybe are slightly
underused use cases but there's been a
ton of new stuff contributed these
Sankei diagrams for you know visualizing
oh that's interesting I'll try to stay
off the web okay so the first thing I
want to do is talk about this notebook
called customizing axes so you can open
that up in v2 interesting let me just
refresh I I restarted my colonel I think
that's all that's going on here or else
it's the first law of demos which is
demos always fail
most people getting that open okay so
how many of you have seen a plot that
kind of looks vaguely like this in the
sense that you got a whole bunch of tick
labels that are munched together in
overlapping form this happens all the
time in matplotlib because you know part
of it's our fault for not working hard
enough to avoid it but part of it is
some part of the design philosophy that
we have which is I've never liked using
Microsoft Windows because I find the
operating system tries to help me too
much I don't really want the computer to
help me I want it to do what I tell it
to do and so I kind of design matplotlib
in that way I don't want the layout to
be very intelligent I just want
everything to go in the place where you
tell it to go and then I want to give
you easy hooks for fixing it and making
it look the way you want so by default
and these are things will improve a
little bit but a lot of times you get
these things where you know your ticks
are too wide or they overlap and you get
up this kind of smushed case here so
what I've done is I've used this new
subplots command which generates a three
by three grid of of axes and how many of
you have used this command it's
relatively new I mean relatively being
like two years old or something like
that Fernando Perez wrote this because
he got tired of always saying give me a
figure and then give me a subplot and
then give me another subplot and what
this does is it creates a grid of axes
that have numpy like syntax so once we
create that thing I'm going to create a
new cell control cb4 below control in
control MV for below and control MA for
above now there's two other things that
B and Amy yes before and after is it is
it before after is it above or below
kills me every time okay so absolutely
yeah thank you and I'll turn off the
excess stuff
okay so what this axis is is it is a
it's an array and it's a it's just like
with numpy it's a 2d array the 3 by 3
grid of what called matplotlib axes
objects and so the apps' axis is the
central object in matplotlib it's one of
these areas that you draw into and the
figure is this entire thing so those are
kind of the two fundamental objects in
matplotlib the figure contains multiple
axes and the figure instance here is a
map flat lib figure whoo that's
interesting it has a display hook and it
stores that list of axes here as a list
of axes so that's just some objects that
created in there and you can do numpy
style indexing into these things so you
can have that sub plot or you can refer
to the 0 0 sub plot I won this typed it
ok so that oh no I guess it's just
linear it's not that's what that's
surprising to me oh that's the problem
I'm in the wrong place
yeah see I knew I needed you here Paul
yeah so this axis object you have the
axes that the figure stores is a list
but this is actually an array object
that will you can index into it just
like an umpire right ok so it's a this
is a three by three array of axes in
fact it is an umpire right and we've
plotted this thing and we've got the
typical matplotlib problem when you have
too much on your screen that we've got a
lot of overlapping tick labels ok so the
first command that is really useful here
to help with this problem are these
share X equals true and share x equals
share ye true how many of you have used
the shared axes in MATLAB ok this to me
is the killer essential thing to use and
I use it every day
and if you know if there's one thing
that you're going to walk away from here
today is I would know how to use these
things and I'll show you what they do
I'm going to have to pop out to the
terminal though to make you because it's
an interactive features that is where
it's most mostly useful so here we are
in an i python terminal and so i'm going
to create just some random numbers
and I'm going to create two subplots
so first I'm going to create them this
way without the share X convention and
then I have to plot my data
okay
and I have to draw this because I'm not
using pylab commands pylab commands
trigger a draw I'm using the matplotlib
API here and I'm calling plot methods
directly on the axes so all most of you
use PI plot all PI plot does is it
forwards methods to our API very thin
wrapper around our API so every PI plot
method forwards a call to an axes
pretty much and so these active methods
have plot commands or M show commands or
you know set X label set title so once
I've gotten this thing done this is our
standard navigation window and you can
do the standard thing pan zoom whatever
that's useful what I like about the
shared X is I'm going to now recreate
the same figure but I'm going to tell it
the X labels are shared so both of these
axes will share the same X label same
plot and now I just have two up arrow to
regenerate
so what this command tells us is any
view limit changes that happen on the
x-axis on one axis should happen on the
other so they become synchronized
together and it also did something
useful here which it knows that these
are the same axes now so it doesn't
bother to draw these ticks so it's a
little bit smart in that way that it
says if you're going to have the same
axes limits you're not going to need to
tick labels twice so already if you're
building building a big grid where
everybody is on the same viewport
turning this feature on will get rid of
a lot of redundant tick labeling so what
I like this is now I can go here and
when i zoom in one I can zoom in the
other and if i zoom to reckon this one
the other one zooms to the same x-axis
but if I move this thing up and down the
other one doesn't change because the
y-axis is not shared so you can either
selectively share the x axis or
selectively show the y axis or both so
that's a very useful little thing if you
if you are if your subplot user it looks
a little bit different I'm just going to
show you what that looks like this is
the way many people will be using
subplot command you can turn on the same
feature but you have to manually say
share X equals x1 because it needs to
know who to share with the subplots
command builds the grid for you so it
knows who you're sharing with if you're
manually creating your subplots you've
got to tell it who you want to share
with so it's a slightly different syntax
subplots equals true in the subplots
command or E or share x equals specify
the axes ok so that's the one thing I'd
like you to to walk away from here today
is is that I think you'll find that
useful go ahead ok so we're back to
customizing this little axis object here
so right away on a grid just turning
that feature of sharing the x and y off
gets rid of a lot of that redundant tick
labeling so we're partly there in
avoiding our overlapping tick label
problem so we've got you know nice x
axis ticks and nice y axis ticks but you
not all data in the world ranges between
0 and 9 on the x-axis and and 0 to 1 on
the y-axis so here I'm going to make my
data a little bit uglier
so basically I'm plotting the same data
now but I'm raising my X data to some
power of I and I'm multiplying my Y data
by some by I plus 1 and so now I'm back
into the same problem that I've had
before these things are long they're
overlapping and we have to fix this
problem in two separate ways the first
one is with this tight layout that has
been written this is where I said you
know I wanted to do what I tell it to do
but I want to give you an easy hook to
auto do things when you want them so
this tight layout option will basically
solve part of the problem for us what it
does is it make sure that all of the
text from one axis will be displayed
properly so it makes sure that this guy
doesn't overlap with this guy and that
this guy doesn't overlap with this guy
it will resize all the dimensionalities
of the subplots to prevent that overlap
for you but it doesn't solve this
problem for us it doesn't solve this X
tick label problem and for that we're
going to have to be a little bit smarter
but this tight layout is really nice I'm
just for generating figures that that
have a reasonably nice automatic layout
so we're going to try to solve the rest
of this problem now so here I couldn't
use the share X and share Y because I
really have different scales right my Y
axes are different scale so I've got a
I'm not I don't have that luxury of
solving that problem here so to deal
with this problem there's there's
basically two things we want to do we
want to use fewer ticks there's just too
many of these things um but we don't
want to you know you've probably been
able to call set X ticks like give me my
kicks here but that's not a good case
generally because you got to figure out
where you want them and you kind of want
you don't want to have to manually
figure out where you want them every
time you kind of want it to happen more
automatically and so what what
matplotlib has under the hood is
something called a tick locator and
basically this is an extensible
customizable class that you can pass in
we have several internal later you can
write your
own that will tell you where to lay
ticks out the Arctic locator the one we
use in general is called the max in
locator which is I've got a reference to
it here in the notebook and basically
that says give me at most in ticks at
most three at most for most 10 and the
defaults are pretty high so I think what
we can do with the subplots command to
improve it is we should figure out how
big your grid is and the bigger your
grid is set that number to be smaller by
default so if you're if you're if you're
a one by one you might have 10 ticks but
if you're five by five you might only
want one or two or three ticks per
subplot so what but we expose that that
that max in locator to you fairly
conveniently so what we're going to
basically do is say hey I've got a three
by three grid here I'm probably only
going to want three four or five ticks
per x + / y and so the function that we
use there is called X dot locator params
again that there are two parts that
determine how techs get drawn in
matplotlib there's a locator and there's
a formatter the locator tells you where
to put them the formatter tells you how
to represent that string so this this
this locator params controls the default
ticking the default tick locating a map
plot Lib and this is the line everything
else is the same here we're adding one
line which basically says for both the X
and the y-axis you could either do it
just for the X or just for the Y but for
both the X and the y-axis I really only
want four bins which is up to five ticks
three bins is up to four because the
bins are the spaces between the ticks so
I went up to four bins and this this
Auto layout call is in the wrong place
it needs to be called once this tight
layout okay so when we run this we're
getting closer now because instead of
having nine or ten on each axis we have
five to a few so methyl is still trying
to help you and pick where they should
be but now we've informed it just don't
use so many so the last piece here is
what's giving us trouble are these guys
and these are kind of like in order of
one e to the fourth
these are 10,000 you know we seem to be
handling the small numbers less than a
thousand okay and we're handling the big
numbers okay here too anything you know
so this is what's called the formatter
so we just addressed the locator the
locator is a guy who tells you where to
put the ticks now we're dealing with an
issue of the formatter
which is how do we represent those
locations as strings and that is all
that's also configurable and our default
formatter is pretty smart but not quite
smart enough every time so it knows that
once you start getting really big it
needs to go to exponential notation and
once you're really small you don't what
it doesn't know is in this intermediate
range how close everybody is together so
basically it has a has a limit at which
it goes into exponential notation and
that default limit is 1 e to the minus 7
1 e to the 7 so all we have to do is
tell it maybe over a thousand at one III
I want you to kick in so the function
for controlling the default formatter
here is the tick label format so now
we've got one helper function to control
the locator and one helper function to
control the formatter and basically what
we want to tell it is use scientific
limits at 10 to the third and so now
these kick in at a lower resolution and
we get at least something that's usable
so those are the kind of the important
hooks for you to to make these plots and
I think Paul you could do a pull request
to the sub plots command right which
detects the grid geometry and basically
sets these two parameters intelligently
based on the grid geometry okay any
questions at this point yep go ahead to
how to configure that that itself like
what the format string is for that thing
I'm going to we'll find out
okay so let's take a look off the top of
my head I don't know the answer to that
but I'll show you how to kind of dig
into there and we'll take a look and see
how to find out so I'm going to create a
new cell below and so I want to get my
hands on that formatter basically and
where it lives we'll look at the x-axis
formatter so first thing I've got this X
that's defined from my session above so
that's just the most recent axis I was
working on and then there's this
function called get major formatter and
that just returns the instance that does
the work so the x-axis has a major
formatter and a minor formatter majors
the major gridlines minors the minor
gridlines and then the y-axis has the
same so this is the guy who controls
that representation so I just I'm going
to just inspect that for a second and
see what's there listen okay I want to
see what this is the format it's a
string format
oh you printed it okay so that's the guy
right there who seems to be doing um
that's for the but that's interesting
because that doesn't seem to be what
what's being used on the x-axis is it I
mean those are not 1.04 minutes I'm kind
of a go to the source code guiding the
kind of guy typically so I'm just going
to pull this up sure yep mm-hmm so the
cleanest way would be this guy if this
if that's what you're looking at right
there is use math text equals true or
false so let's just see how that field
propagates down into our code that sets
it internally I don't know if we expose
that to the user set scientific set
power limits foot format data short for
my data long
to whether whether or not to use that or
not so you can change your default I'm
going to do something that we shouldn't
do but I'm just going to try to see if
it works is I'm going to set that
private variable so I'm going to say
format I just want to see if we can hook
into that that's why it's Python right
we're all adults here
so we should probably make that expose
that a little bit better to you but but
one of the comments was you can you can
expose it using the config file which
we'll be talking about in a little bit
but you may not want it to be true all
the time but I guess the point is we do
have access to those RC params in code
here so that's the other way to do it
would be exactly so yeah so does anybody
can does anybody know the name of it
okay oh it does use that like this no
it's not used tech that I want because
I'd rather using Matt Butler's internal
math tech rendering is that is that what
it uses for that for that value in the
are you looking in the code okay yeah
that's we see Matt public has to raise
ways of rendering mathematical text one
is our internal mathematical rendering
engine one is the external latex engine
here it's calling out to the latex
engine and it's not rendering right on
my system and maybe something to do with
the down sampling I'd have to look into
that we should be using our internal
math rendering engine for that kind of
thing okay so you can hook into these
things but there should be better ways
of hooking into some of that you could
create your own instance and set it
that's the other thing is you can say
kick or dot and then you set use
technical so that's I mean that's the
right way to do it probably so it would
be right here X dot x-axis dot set major
formatter ticker dot scaler formatter
use tech equals true was it used
technical Trinder I'll
I'll take a look at it in a second in
one second
camel cased
so you can instantiate this guy yourself
text possibly
it's a big traceback oh because the RC
params are still set we set those RC
params that's a global setting so I need
to unset that
who made me go off the reservation how
did how do we spell that use tick okay
okay so we've turned that back off now
we're getting math tech rendering so
that's that's sort of the code way you
could hook into that process okay since
we were just talking about the RC params
I'm going to jump into your question
real quick and his question was if I'm
producing in figures in different kinds
of environments maybe sometimes for a
certain journal maybe sometimes for
interactive scripting maybe sometimes
for a user interface and I want to
customize the look and feel of those
different things how can I do that so
I'm going to jump out of the notebook
for a second just show you briefly how
you would do that the first place is you
need to hook into our what's called our
RC file and the way it where you would
find that on our website would be in the
doc section and one of the easiest way
to find it is in the doc section there's
a customizing matplotlib section and
that tells you you okay I have you now
Luke Skywalker okay so this is just my
local build tree of the docs this tells
you about the matplotlib RC file which
is about what we're about to talk about
and it's just a simple key value pair
filed as the default configurations here
earlier we were setting them in code but
you can set them in the config file and
this is a sample so you can download
that file to your system and basically
you can either put it in the mapped out
Lib default config directory which is
dot matplotlib
or you can put it in your local
directory so matplotlib will pick it up
and in your local directory so that's
basically how you how you do this so I'm
going to the way this file works is
everything is commented out except for
the back end so you basically because we
we want to have a little bit of
flexibility to change these and so it's
good if you only uncomment the defaults
you want to change so I'm just going to
copy this file
and throw it into my Emacs buffer I'm
going to go to the talks PI gate up in P
elder MP l PI data yep and I'm going to
make two directories temp 1 and temp 2
and I'm going to drop this file called
Matt plot lid into both of those
directories so that I'm dropping in Tim
to and I'm also going to drop it in temp
1 so this is a large file and basically
every at almost every aspect of the
figure can be controlled here tick size
tickling font size font color italics
the background of the axes so I'm going
to do just I'm going to just tweak one
thing so that we don't spend a ton of
time here I'm going to say the axes face
color so the default that's the this is
the axes this is this region here that's
white by default for publication a I'm
going to make it blue and for
publication B I'm going to make it red
now any code that work that's run test
up hi thank you
I'm going to cheat here because I'm in a
big hurry don't try this at home we try
to get people using pipe lot so I'm
going to create the same thing and then
I'm going to save this in temp1 - okay
so now we've got the same script in two
different locations basically actually
you know we only need one script we just
need to run the same script so I'm going
to delete it from temp 1 because the
idea is you want one script right right
so I'm now just going to navigate on the
file system
temp 1 so that's where my map out Lib RC
lives and I'm going to run the script
that's in Tim - should be a show at the
end huh
oh it's the thing is because I commented
out the back end I actually have to tell
at the back end I want to use so I'm
going to by default if the back end
doesn't set it goes to one of our image
back in so nothing happened okay so
that's that's the background there but
now if I run the same script from Tim to
I get read so you can pretty much
customize the look and feel of all of
all these things using that methodology
and how many of you are our users so as
part of this um exercise I was looking
at some Gigi plots at West McKinney was
making today and I just wanted to see
how we would do emulating the AR style
so here I've just written a little bit
of a section of code basically setting
my axes face color to be gray and my
tick labels to be white and in changing
the default spacing between all of these
are configured at the RC level if you
want I've configured them in code in
this example but you know you could set
your config file up to look like our if
you wanted to we initially set this
thing up to look like MATLAB because I
was writing in that lab emulation mode
but again I think might be nice to
expose a little bit of these things at a
higher level as well for people who want
to say give me this config you're saying
can we borrow from somebody who's
already developed these styles there's
not you know there's there hasn't been a
file exchange or people haven't
submitted these kind of style files if
you will right or an or the other option
would be in in module code essentially
we could have styles which instead of
depends on whether you'd rather make a
function call or drop a file right we
could have our C dot set our style and
it just sets all those parameters so you
could call that function in software and
then you could actually toggle within a
session to go from our style to matlab
stylers or some other style but know no
one's ever suggested such a thing but we
could we could certainly have some entry
points to that
um so now that's done so you know you
can look and see I don't think we need
to go through everything that's in here
but basically these are just you know
these are a bunch of API calls that
short sort of show you the matplotlib
act you know our hierarchy and our API
this is the way I write code I don't use
a pipe lot interface very much and it's
you know another thing to just show you
all if you want to sort of write more
pythonic code all of these API methods
are available to you you know I was a
C++ programmer before I was a Python
programmer if I had to do it all over
again
these would be properties and not
setters and getters um you know just to
make that slightly more pythonic right
so if they're just properties than you
so you're old-school like me
yeah so X dot x-axis let's just say X
dot tab just to give you a flavor of how
many of these things are out there so
I'm still on the A's so there's a fair
amount of stuff you can set here and we
have we have I would say all very good
doc strings so unlike ghido we have good
interactive doc string so if I say set X
label you'll get something that looks
like this
it basically says set the label there's
a dictionary to control the fonts and
these are the keyword arguments and you
know we here's every basically every
argument that you can set there's quite
a few it tells you the name what they
can be you know so every doc string we
have pretty much has this level of
detail in terms of of what you can do
with it so there's there's a lot of
stuff in there I mean the font weights
here you know can bein so this is
basically is it bold or is it not both
these are your options for setting how
bold your text book so there's a very
high degree of customizability under the
hood if you want to you know go down
that path
I'm probably going to switch gears now
even though there's a lot more in here
but you know that's the great thing
about a notebook you guys can read this
on your own time if you're interested
I'm basically kind of going through some
of the stuff we already at how to set
your own formatters how to set your own
locators how to do really stupid stuff
like rotate your tick labels and make
them read you know just kind of showing
you the API and how to drill down and
get into these things this is this is
some I'm gonna I want to talk a little
bit about this because this is probably
something most of you either haven't
used or not familiar with but it's
really nice um have any of you used JJ's
AXYZ grid or grid specs stuff a couple
of you JJ is an astronomer he's a really
talented matplotlib developer he's the
guy who's done if you've looked on the
gallery sort of what I would call most
of the eye candy these fancy arrows and
fancy boxes and all of that kind of
stuff he's done a lot of of that work
but he's also done an awful lot with a
grid layout like how to do sophisticated
grid layout so the men plot lib subplot
is is a by default a regular grid m-by-n
but a lot of times you may want to
specify something like this we've got a
big axes something above it here and
something about here you can do that
manually with your axes command you can
say left right left bottom right no it's
left bottom with height is the syntax
but there's a lot of arithmetic to
calculate exactly how you want this to
be so what he's done is if you've done
any GUI programming is he's basically
implemented the concept of a span so
this is a three by three grid so this is
your basically your three three here
he's got a three by three grid but it
has a call span of two so that basically
says this is the zero guy but I want you
to span two columns so the first one is
x1 here so basically he's saying and
when he did this you know matplotlib
uses this one based indexing like
subplot one subplot to figure one figure
two which is very unpaid onic because pi
a zero-based indexing but again we I was
immolated MATLAB at the time so I matlab
had a one based convention when JJ
rewrote this he's like I'm not going to
continue to perpetuate that that idiocy
so he redid this with zero-based
indexing so that's one mental mapping
that you'll have to make this is more
pythonic but but as you'll see in a
second he also wanted to support this
with ax e slices so I'll show you that
in a second but he basically you can
slice these things to create spans so
what this is basically saying is four
axes one which is here give me a 3x3
grid this is first row 0th column so
this is this guy and span two rows this
is spanning two columns and two rows
AXYZ two here is the zero zero guy so
he's the uppermost guy in the array and
he spans two columns but only one row
and this guy here spans he's the one two
guy so Row 1 column 2 which is the last
column because it's Python Python based
and it spans two rows so this enables
you to lay things out nicely so the
example I gave above is similar you know
looking at like a marginal distribution
of a 2d histogram these are the kind of
layouts that are useful for those kinds
of things and he does so this is this is
an example showing the same thing you
can actually create one of these grid
specs and you can do slicing on them so
you can express a span here like this
span on x2 you can express that as an
array slice so starting at 0 going all
the way up and not including the end
right so he's basically expressing the
spans here as slices of a
two-dimensional array so just like you
have numpy slices give me the first you
know up to and you can do the minus 1 so
you know the last row but the second to
last column so it's kind of a nice thing
and he's perverse enough that it goes
even more deep than this um just I'll
show you one example where he does this
thing
so this here there's a documentation
page called
using grid spec so this is just that
example I just showed you but it turns
out like this guy here is a more
complicated one once you've got one of
these you can put subplots within
subplots so he defines one of these grid
specs like this but then he starts
sticking this is a 1 by 2 and then he
sticks these you can put geometries
within geometries basically so you can
you can recursively specify these things
so you know he does things with
matplotlib which should be illegal yeah
so here he's basically using his grid
specs from above that he created but
he's sticking them in a 1 by 2
grid arrangement so he sticks one in the
first one he sticks this other layout in
the other one and they all kind of
layout nicely so if you need to do
sophisticated layouts of axes he's your
man ok so I'm going to shift gears here
and do some event handling the next
section is basically going to be
interacting with your figures mouse
clicks keyboard events selecting data
picking data that kind of thing and in
order to do that I'm going to restart my
notebook server because everything so
far has been into the browser and here I
want to actually pan and zoom and click
and interact so I actually want the
old-school matplotlib figures to pop out
so I can interact with them there's a
lot of talk about how to get interactive
figures into the browser but that's a
development project so for right now the
figures inside the browser are static
but we can you know most people interact
with their figures through the standard
map outlet window so in order to get
that and if you want to follow along you
basically just need to kill your
notebook kernel and then I'm going to
say instead of pylab in line I'm just
going to use the TK back-end and so that
just tells the notebook use the TK back
and pop the figures out and you can
interact with them and if you've done
that you also need to refresh this page
because this page is still talking to
the old notebook colonel
so simply refreshes it it's the same URL
for me so it's going to point to the new
and then the workbook we're going to be
dealing with is called MPL events how
many have you done any GUI programming
event handling most of you how many of
you done any event handling a met plot
lib couple Paul wrote pong in MATLAB we
have our we have our own event model and
just like you know we have we support
user interfaces in QT t k WX native Mac
OS X widgets and some you know FL TK
that you almost never heard of and so we
have to support user interfaces across
many different windowing systems and so
we have a Windows system agnostic
drawing API and we also have a window
system agnostic event API so that if you
write a new back-end or new windowing
system comes out we don't have to redo
all that work so when you interact with
a figure in matplotlib you're doing it
through our event system so we basically
all of the interactions are written
using matplotlib events see if I
so there's some standard keyboard events
like g4 grid you can turn that off we're
trapping the key press and exposing it
or I can type L for log to toggle
logarithmic axes on and off or I can
type s for save and it should pop up a
save dialog not implemented on this back
and apparently but we expose that event
handler to you so you can write your own
events and the advantage of doing it
that way is that you can send your code
to another matplotlib user who might be
on Mac ofx and the same event model will
work that's the basic advantage there
kill that it's in PL widgets 3 that's
what I'm going to be working with in
kill Vince is a perfectly good worksheet
there's a couple here and I'm not going
to do it all that were written by
Fernando and Paul while I'm on the
subject I think I'll just show you
Paul's because it's kind of cool what he
did here was he took an xkcd plot and
said how can I make this in matplotlib
that was his goal and so it's a nice
long tutorial oh I do have to do run all
he saved without without the output oh
so there's going to be a lot of stuff
popping out ok well oh I don't want to
hear you do supply oh that may be
confusing the kernel I'll worry about
that at the end cuz I've set my kernel
to pop out and he's setting it in line
so I'm going to just actually restart my
kernel but it's a nice little demo you
can look at it later as you have time
where he basically replicates the xkdc
figure in MATLAB
okay so I've got to now maximize the
second string so this is sort of the
basic event handling model that we have
where the metalhead figure has a canvas
that's sort of your GUI canvas it has a
connection method where you can connect
to one of many matplotlib events and
there's a tutorial on the website called
the event handling tutorial where these
will be listed for you there's a key
press event a button press event a mouse
motion event the kind of the standard
GUI events and the way it works is you
connect the event to a callback function
and every time you press this key any
key this function is called and we try
to keep it pretty simple you know so if
the event has a key field and and so
what happens is when you press this
whenever you press a button it should
print you've press this key and then it
looks for this is key handling if the
key is X what we're going to do is
toggle aligns visibility so on this
example I'm plotting two lines and every
time you press X I want you to turn one
of the lines on or off so I ask is the
line visible by calling the lines get
visible property everything in the
matplotlib figure has this property
every check every text has this visible
property it's the it's the base classes
method of artist and then I can set the
visible set the visibility to not
visible so that's sort of the toggle
operation and then I have to force the
the figure to redraw itself so that's
sort of a very simple event handling
loop and let's see if I can run this
from them so there's my figure that pops
up I've plotted two lines and I just
press X and in the notebook it should be
saying you pressed X let's see if it
does okay so it's saying you pressed X
and every time I pressed X I toggle a
line so that's sort of a very simple way
of connecting to the low-level key press
events so as I said we have several of
them the most important ones are key
press button press and mouse motion
called motion notify event
most people don't want to wire up really
low-level
GUI code themselves so we've tried to
encapsulate some of the common things
that people want to do with Mouse
interaction into what we call widgets so
these are little tools that we've
written to do kind of basic stuff that
you might want to do in the figure so we
have a module called matplotlib dot
widgets and I'll show you one of these
in action and then I'll show you where
you can find more so this is a sort of a
standard cursor widget where as you move
your mouse a cursor will follow you so
basically I'm just creating some random
data and I instantiate this cursor
object as a color has aligned with and
this bleeding is kind of a rendering
feature that is that does optimizing
rendering on backends that support it
Mac OSX native back-end does not so if
you're running that you may encounter it
so you would want to set use but equals
false if you encounter any problems with
it so that's interesting
it's failing oh I got a traceback I
didn't execute that line those are the
kind of errors I like so that just gives
me a little cursor widget as I'm
following along and I'm getting my XY
coordinates as usual down there so the
cursor is not that useful the multi
cursor to me is actually useful so the
way the multi cursor works is you can
create as many subplots as you want and
you you you basically have active zero
and AXYZ one but you can create as many
of these as you want you initialize this
multi cursor with the figure canvas
every figure will have this canvas
instance it's our abstraction of the GUI
and you give it a list of axes that you
want to share this cursor on and then
you set your line properties as we did
before so what's useful here is when you
have two data sets and you want to look
at events in one and see how they're
registered two events in the other so
that's I think a lot of things useful
because you have like four or five of
these panels and you you see a feature
in one when you're sure when you have
the same axes limits and you want to
zoom in on that and see precisely where
you are so it just gives you a visual
alignment there we have a lasso widget
you know for selecting regions so this
was kind of a nice little example how
many of you made one of the pandas talks
so what I wrote here was a little pandas
a widget viewer basically so in the
script
I'll kind of walk you through what this
thing doesn't um but the idea here is
you know you might have a data set that
has multiple types of data some of which
are not some of which may be strings or
categories you know not easily
represented on your graph and you know a
lot of times what you might want to do
is plot value 1 versus value 2 on a
scatter plot and then you see some
outliers somewhere and you want to say
hey what's going on with those outliers
how do I drill down into those outliers
so what and what are they what days did
they occur on what was the other values
that I that are not on my graph so sort
of you know hover over a region and
inspect that region that's kind of what
we're trying to do here so what we're
going to do is plot two of our values we
read in some financial data from a CSV
file do some standard pandas stuff
attach a new column and print out some
of it so this is as you can see the
daily pricing data from the stock crocks
so I loaded up this little pandas
dataframe and so I want this to be kind
of generic so I'm going to specify which
pandas fields I'm going to be working
with the strings so that throughout the
code I can refer to these things so I'm
basically going to be working on the
x-axis with volume which is the daily
trading volume and the y-axis is the
daily return in a percentage terms I'm
going to have a single axis and plot
this is the data frame access the X
field column versus the Y field column
and as a marker plot so it's basically a
scatter plot okay that's just going to
be a 2d scatter plot now this is one of
our widgets called a span selector and
what the span selector does is it lets
you just basically select a horizontal
or vertical region of your plot it's
like a rectangle like a zoom to
rectangle but it's only one of the
dimensions of the rectangle so what we
call span like a region of the x-axis so
this is a pretty simple one so I'm
starting kind of with the easiest one
and I'm going to basically say when you
select a region call this function on
select so this is sort of standard
callback mechanism call this function
some of these these are just sort of
drawing things it's going to draw
rectangles that are red and translucent
so these are the rectangle properties
that we're going to draw this is where
the action happens we're selecting again
a span as an x-men xmax Regents are
going to be selecting a region it's
going to print the region we selected
it's going to get the the same X field
that we plotted so it's grabbing that
guy there and it's going to do a boolean
mask where X is greater than x-men and X
is less than X max
selecting the region it's selecting the
data in that region and then it's just
going to print it to standard out so
well this prints the entire data frame
so we have an XY scatterplot but we're
just going to be looking at the data in
that region let me run it one time so
you can kind of see what it looks like
and then maybe we can take some
questions if there's what's going on in
the code so this is the XY scatter plot
x field versus y field and so basically
you know we have a lot of data around
here which are small volume days and
kind of you know some sort of
distribution of returns around those
days but we also have a few outlier days
that we might be interested in saying
these were really big volume days out
here what what did the rest of the data
look like over there so that's where we
select that region that little rectangle
that I just selected and that triggered
our unselect event here so what happened
now is we got this standard output back
from the terminal this was the data
between X min and x max inside this
region so here we can see the outlier
events that happened on those days so
it's kind of a nice way of of
interacting with your data I'm going to
try that again I'm going to try to go
over here and just collect the very two
biggest days so that's my span that I'm
selecting them when I release the mouse
it triggered another print here to my
screen these are the two events that I
selected so it's an easy way of drilling
down into your data so I accidentally
probably selected the whole data set
just as I was trying to close the window
this is exactly the same thing but it's
using a different widget it's the
rectangle selector so you know zoom to
rect is a very common mode of
interacting with data we give you a
widget so you can hook into it yourself
so if you want your own rectangle tool
you just create one of these widgets you
know there's a lot of arguments but you
don't need all of these these are these
are just options you know sometimes when
your rectangle is too small you you just
click your figure and your rectangle is
too small you want to ignore that this
is basically saying if your rectangles
smaller than some
minimum rectangle ignore it so you know
these are just some extra options but
it's exactly the same selection code
that we had before except now it's a two
dimensional selection we have a the x1
and y1 of where the upper corner of the
rectangle was and the x2 y2 of where the
lower corner of the rectangle was so we
get that and to do the math we have to
make sure X 1 is less than X 2 you know
because I want to basically say this
operation where X is bigger than X 1
less than X 2 y is bigger than y 1 less
so much so this is just a toggle make
sure that X 1 is always less than X 2 I
get my X M my Y fields apply
two-dimensional mask and then I select
that region out of pandas so it's same
logic in two dimensions now and so we
should be able to now you know we can go
in here and try to get one of the sort
of a denser area I did a tiny rectangle
in there and it shows us what we got so
I should be able to grab these two
points so you can hook into a lot of
these widget tools and you you know it's
I hate to say write once run anywhere
because it reminds me of Java that was
the failed promise of Java you know and
I'm not going to promise that you won't
encounter some glitches across some
backends across some platforms but for
the most part the event model is the one
we use internally for panning and
zooming and doing these things so to the
extent that those things work the event
model should work with reasonably well
ok all right so I'm going to even though
Paul tell me I don't have to do it the
old-school way because I don't have a
lot of time and I know how to do it this
way I'm just going to kill my kernel and
go back to in line for the last segment
I wanted to talk about today
the last one is called NPL recipes all I
have to refresh if you kill your kernel
and restart because I went back to I
have to refresh this mode so these are
just going to illustrate a few different
kinds of plotting commands that I like
to use that some of them are in the eye
candy um realm just making plots look a
little bit more attractive there's a
command I like he's called feel between
where the syntax of it basically is
given time or your x-axis filled an area
between y-min and y-max and these are
can either be a constant or an array so
if they're an array it basically will
fill between the y-min and y-max is an
array and if it's a constant in this
case Y min is the constant one it fills
between a solid line and you can set
some parameters just to create shaded
region plots so that's a pretty easy
thing to do but isn't there's a has a
nice argument to it called where that to
me makes it pretty interesting so this
is a this is an example that I've used
to show how you can use the where
argument in both cases I'm filling
between the two arrays I'll show you how
to created these in a second but I'm
filling between this array Y 50 and Y
200 so this is a case where both y-min
and y-max are both arrays and it just
creates the polygons between them
and I can give them the same arrays in
both cases but I can give it a boolean
mask here that says where some condition
is true so this is a random walk and
I've set up here and
oh it's the same random walk from above
so basically this is my random walk it's
a geometric random walk where I take one
plus some random number cumulative
product what Wes called the total return
the total return on one dollar invested
in his panda's talk and these are two
different moving averages of that
variable so you can compute a moving
average and numpy as a convolution so if
you convolve your variable with a
weighting function that's essentially
the concept of a moving average so you
can do an exponential moving average if
this was an exponential function or an
equal weight moving average by giving it
an array of ones the view to make it a
proper average you need to divide by 50
so that the total weighting is one so
here I have two hundred ones weighted by
200 so I do this convolution the
convolution has sort of a decay part at
the end so you want to just extract out
the beginning part and begin at the
beginning there's an artifact where you
know yeah it's a moving window basically
the way the convolution works so at the
beginning it's only the average of one
point so these points aren't really
valid averages because it's one fiftieth
of one point you know so you basically
what I'm doing is saying for the 50
point moving average I'm going to just
say that's bad data for the 200 point
moving average I'm going to say that's
bad data but then very simple measure of
trending that you know kind of the the
simplest measure of trending that people
in the financial industry like to look
at is whether a short-term moving
average is higher than a longer-term
moving average so here I'm creating a
logical array saying I'm going to say
this thing is trending up when the
short-term moving average is greater
than the slower moving average it's a
trailing because of the moving average
is a trailing indicator it's a trailing
indicator so what I'm doing now is I'm
basically coding these different regions
so I can see where my moving average is
positive where the where the short term
is higher than the long term and where
the short term is lower than the long
term so these basically show you kind of
one example of how you can use these
fill betweens to you know put extra data
onto your graph in a way that conveys a
lot of information I like
to use whenever I use these polygons I
find these I find these um colors are
too stark so I like to soften them with
alpha alpha is the transparency Channel
and matplotlib
so anything that has an alpha less than
one you can see through you can see
what's behind it that's not so important
here because these are disjoint regions
you don't need to see through them but
there's a secondary effective alpha
which is that they just soften colors
that's weird what was wrong I oh did I
not execute it so this is an example
when I was talk about softening the
colors this is the standard blue if you
take that away make that alpha 1.0 is
the default it's just a much stronger
color so I tend to I like these like
kind of soft pastel II colors that you
can get out of setting alpha equals um
0.1 so this is again just to kind of for
the visual enhancement of your figures I
find tweaking that alpha a little bit
can give you different kinds of feel to
your colors this is a slightly more
involved example where what we have it's
actually quite nice an illustration of
how powerful numpy is as an expressive
syntax what I'm doing here is I'm doing
a random walk simulation with 100
different random walkers and each random
Walker is going to take 250 steps and I
want to do some statistics on the
population like so what is the average
position of the random walkers and what
does the AB the variance of the of the
average position of the random walkers
so I want to take you know 250 steps and
basically I'm creating a random
distribution here with different means
so my mean of the first population is
0.02 and my mean of the second
population is 0.04 so they're going to
be walking a little faster they both of
these what random walks have drifts
basically so this is the drift term and
this is the variance term so my my first
population has a smaller standard
deviation than my second so these are
unit normal two-dimensional unit normal
distributions with a different
in standard deviation and all we have to
do to compute the random walk is this
step which basically said give me the
cumulative sum of the walkers in sum
over dimension zero so with numpy sum on
a two dimensional array if you just call
sum you get the sum of all the elements
or you can sum over access equals zero
and just get the sum over one over the
0th dimension or you can say sum over
excess one and give us some so what
we've done here in you know six lines of
code is a complete simulation of 100
random Walker's taking 250 steps I'm
going to insert control m so at the end
of all of this I've got something that
comes out that looks like that it's
still 100 by 250 it's still 100 random
walkers and I'll just plot one of the
trajectories so this is the first random
Walker in x1 so here he goes and he's
because it's got this positive drift
term he starts to take off and in
matplotlib you can also slice this guy
so you can give you can for example say
show me the first five random Walker's
so you can pass these array slices in
and you'll get the trajectories of the
first five random Walker so that's and I
think we have a hundred total so what we
want to now do is is compute some
statistics on those random Walker's
which basically says give me the average
position over time of all the random
Walker's in population one give me the
standard deviation of all the random
Walker's in population two and do the
same thing for both sets so we've got
two walkers different variances
different means
so here again four lines of code we've
got population statistics so again you
know so Y dumpy-dumpy MATLAB and all
this family of languages is so good for
this stuff so for the last thing I just
want to plot the result set and again
I'm illustrating this fill between using
shaded region so basically we can
the the population mean which I'm
plotting here is T times mu 1 and T
times mu 2 and you can see the
population variance here what I'm
computing is well it's mean plus one
standard deviation mean minus one
standard deviation so what we're seeing
is the one standard deviation from the
mean of the population over time so
population 2 had a bigger mean so it's
climbing faster but it also had a bigger
standard deviation and so it's got a
wider distribution of outcomes so this
is the one Sigma probability density
function over time of the other random
Walker's basically so we're viewing
slices of this and again using the fill
between with an alpha channel we can see
both populations even when they overlap
you can see through them so it's a nice
little technique and you know we expect
the variance to grow linearly with time
for population of random Walker's so we
expect the standard deviation to grow as
a square root of time and that's
basically what you see here is a
standard deviation function that grows
as the square root of time so I use fill
between a lot I think that's a nice
little nice little helper function
another one that I like for is kind of
these text boxes it's very easy to
create around any text in the figure
just a little box and I think it draws
attention to it it makes your figure a
little bit richer visually I'm normally
against most forms of what Tufte calls
chart junk but I think some of this
stuff adds a little bit of a visual
appeal so text is a generic command I'm
going to turn this off so this would be
a standard text command the rest of this
is just a histogram so I've got a long
mathematical expression saying in latex
the mean is this the meeting is this and
the standard deviation is that and we
have this support for new line separated
texts so one text man gives us three
different textual representations and
this is actually a very useful technique
here
which basically says place this thing in
axis coordinates not data coordinates so
rather than try to figure out oh I want
this thing to be at because the normal
coordinate system is data so this is
like in data this is - 125 versus you
know 550 so you have to figure out where
that but if you want it in the upper
left you have to figure out what is it
for this data set hard code that in if
your data changes it's suddenly in the
wrong place so we have a number of
different coordinate systems but one of
the most useful one is this this axis
coordinate system where you can say I
want you to be at 0.05 which is a
relative position on the axes 5% over
and 95% from the bottom so that's
basically saying forget about my data I
could pan and zoom and what this would
not move because this is not in the data
coordinate system and the way you
specify that is by setting the
transformation so method has a map of
the artist has a transform under the
hood the default one it's called trans
data it's what turns your data into the
map into the figure coordinate system
but the axis coordinate system is 0 0 is
here and 1 1 is here so you can put
something anywhere in your figure in
that coordinate system just by saying
use the axes coordinate system so that's
what your what a standard text would
look like but if you want to decorate it
a little bit you can pass in this
dictionary of properties and these are
properties from matplotlib patches they
have face colors edge colors alphas and
essentially a style so this I'm going to
use a round style with a wheat face
color and an alpha of 0.5 so you
basically pass in this dictionary to
what's called the B box
it's the bounding box of your text props
and then you can do something like that
turns out we have a number of styles you
know if you like the postage stamp look
or something like that there's a number
of styles that you can use and if you do
a help on the all of this stuff comes in
matplotlib patch the patch is the
abstraction of A to D area
so basically matplotlib has a line as a
base class and a patch as a base class
or rectangles polygons ellipses all of
that stuff is a patch so if you want to
see the different box styles that are
out there left arrow right arrow around
we've looked at round and sawtooth these
things also have optional parameters
that you can pass in so I'm going to
just use a different one like a right
arrow is a different style we can use
there's the various things and you can
control some padding and things like
that so again this is the work of our
friend JJ since we're out of time I'm
just going to highlight some stuff you
may have seen we have very a lot of
support for annotations so basically an
annotation is I want some text to point
to something in my figure and you can
sub you can each one of these things
does basically the point you want to
annotate is XY so here I'm editing this
point at 2 minus 1 and my text also has
an XY location so very simply those are
two different things but what we support
is the ability to specify those
coordinate systems in many different
ways so you here for example my XY
coordinates are data that's your
standard data coordinate system that
you're used to working in but you can
you can specify your XY in data if you
want you can say in data I want my my
text to be here or you can say I want it
to be an offset from my data in points
so points are printer 72 points per inch
this is basically saying a hundred
points to the left and sixty points
above so it's just a relative physical
position to your data that's where you
want your text to live and then you can
connect connect your annotation with an
arrow and there's a lot of arrow styles
so this is a fancy arrow it's got a face
color of 0.6 that's gray an edge color
of none so there's no edge color
basically we say we're connecting to
this ellipse so rather that's the center
of the lips that were annotating is
actually here that's the that's the
point it's annotating but we're
informing it you're annotating this
ellipse so just point to the edge of the
ellipse so you can actually tell it the
physical you're annotating a coordinate
system you can tell it the the shape of
the thing that it's annotating and it
will look at where that is and make sure
it doesn't go inside it so there's a lot
of things you can do there with
connection styles I mean you know this
is again JJ stuff you I'll just show you
without if I don't for example tell it
what that patch looks like it goes into
the center
and I you know I can say I want this to
be at minus 60 which would be below and
it comes in from below so there's a lot
of ways of specifying annotations there
these are just two other examples
showing you the kinds of things you can
do and I'm going to call it quits
because we're just over three o'clock
but the last thing in this worksheet is
how to create your own color mapping so
if you want to write we probably have
hundreds of color maps inside matplotlib
if you want to write your own it's here
one of the things Paul is interested in
working on and we might even have a
google Summer of Code is writing a color
map editing tool you've probably seen
these things in like Adobe Photoshop
where you can drag the segments to show
the RGB of the color mapping we want to
write a tool like that using the map
lock live event handling so we can
deploy it across</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>