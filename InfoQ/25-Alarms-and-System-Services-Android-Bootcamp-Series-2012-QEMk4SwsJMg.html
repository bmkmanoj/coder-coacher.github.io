<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>25 - Alarms and System Services: Android Bootcamp Series 2012 | Coder Coacher - Coaching Coders</title><meta content="25 - Alarms and System Services: Android Bootcamp Series 2012 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>25 - Alarms and System Services: Android Bootcamp Series 2012</b></h2><h5 class="post__date">2012-03-07</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/QEMk4SwsJMg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so one thing that we have going on right
now is that this is not a very smart way
this does it right for one it works on a
on a timeline which is very rigid it's
every 30 seconds every 60 seconds every
one minute whatever that something is
right the better approach would be to
have this be done all at the same time
as the other services do the updates let
me explain that one of the most
expensive things you can do in android
is second most expensive thing you can
do in android is fire up the radio and
use the radio so our poor service
definitely does that it uses the radio
goes out to the world and check the
cloud right um now it'd be fine if you
were the only citizen on the phone but
we're not there's Twitter there's
Facebook there's you know linkedin the
yelp other things that you have going on
gmail gtalk whatnot right all these
services are running on your phone as we
saw yesterday so if they all have their
own sort of interval that is not going
to work very well that's why battery
doesn't last too long right so better
approach would be to have something else
control this interval that's approximate
because we don't really care if it's
every 15 minutes right we would rather
have it be on about certain timeframe
times span and be grouped with other
services as opposed to the radio going
you know as opposed to everyone firing
up the radio like this over time line
right we could have services group stuff
and be quiet and then they all go do the
radio thing then they go quiet they all
go do the radio thing then go quiet and
so on right we'd rather have that
then kefka's ilion like little things
like that make sense so so that's that's
what that's what we're trying to
accomplish one way to do that would be
to help our refresh service be driven by
somebody else so if you think about it
in our update service which I really
don't like anymore this is not a very
nice piece of code like new tread drawn
try while I mean I don't know I don't
know about you but I really don't like
that I think this is way more elegant
piece of code I do like this piece of
code it's like actory lines fits on one
screen large font right much more
legible right plus keep in mind that we
really didn't need this nor deaths right
because we don't really do anything I
mean hunt elegant is this now right it's
a nice little piece of code just does
the job BAM wasn't positive complete
yeah the problem that we had was we
needed to somebody needs to trigger this
so right now the trigger is going to be
either if you look at a picture the
trigger right now is going to be either
as pressing the button so you press the
button and you say started a fresh
service right to the human or what that
was the only trigger actual was pressing
the button what if there was something
else out there called alarm service that
would also could also do that think of
it as a cron job against normal to cron
job is so something like that right
where you can basically basically
subscribe and say every X you know
intervals like do something so that's
what an alarm service is now alarm
service is also going to introduce to
other systems services so just to really
quickly bring it up alarm manager so
alarm service is exposed to us via
something called an alarm manager and
that's pretty standard so basically what
you have is you get
our manager and your API is pretty
simple it's going to say set right set
something let's schedule an alarm okay
and and that's about it that's or set
this is one that we're going to want to
do set in exact repeating right so
that's the kind of thing that we did you
want so sat in exact repeating so so
what so that's that's gonna basically
schedule repeating in exact interval any
alarm that repeats every hour but not
necessarily at the top where we all
right right so that sounds like what we
want so to do this let's what's a good
what would be a good place for us to
register this alarm manager like we got
the summer set up the alarm like to say
hey this is what we want to done up to
be done every soft and do something
what's a good place to do that boot
receiver yes because boot receiver is
guaranteed to run first time around the
system boots up so we could actually use
it to set set some stuff up right on so
as opposed to like let me open up my
booty receiver so is opposed to having
boot receiver start the intent sir the
update service so first of all I'm gonna
change it from update wow I mean but for
now I'm going to comment this out I do
want to get rid of out this service
right so what would be nice to do here
is set up the alarm the alarm right so
system may give you a picture about
couple things before that are not
necessarily from this course that from
another course but just to kind of
explain something to you
yeah this is what happens with your
system when you boot it up when you
press the power button on your computer
on your computer on your android device
right so what happens is we start some
linux demons bam and then what we do is
we start some linux runtime stuff and
then we think studies thing cause i got
which is the beginning of life for all
the apps but then even before which
finished booting so this is the line
where we do boot complete mad even
before we finish booting we start a
whole bunch of system services right so
in soon android on the their whole bunch
of system services and their part of the
the part of this picture that we had
earlier that we talked about so they all
run inside of desk in here so this is
not just librarian libraries which we've
been using so far but it's also a bunch
of services things that are actually
running right active and you can attach
to these services like think about GPS
right think about sensors think about
Bluetooth Wi-Fi telephony audio you know
NFC etc so these are all services that
you can connect to and say I would like
to know when sensor changes I would like
to know when GPS becomes available I
would like to know when phone is off
hook I would like to know when blue to
despair etc etc right so these are
various services with their various
api's there i think the last count is
like they're like 57 of them or
something in the ice cream sandwich so
there's a whole bunch of these different
things there are certain things that are
common for all then there are certain
things that are different so we'll use
alarm manager as an exam
what's very common for all of them is to
get it via the context alarm manager is
going to be alarm manager and then to
get it you ask the context for it get
system service service and then you ask
for context dot alarm service so you're
going to have a component of just alone
in a jerk so this line of code you're
going to have every single time you're
going to get system serves right
now now when you once you get the system
service things get become different in
the case of alarm manager you then refer
to its API and its API is rather short
right it's got these things and you know
it's pretty obvious like the one we want
is going to be set in exact repeating so
now i can say things like alarm manager
dot set in exact repeating and this is
not where we got a kind of also see what
that what things mean so if i click on
in exactly repeating so type is elapsed
time that a real time RTC your right to
see wake up right in these things mean
different things then have a type of
there so if you look at the what elapsed
time so alarm time in elapsed real time
since boot including sleep right a long
time in including sleep which will wake
up the device when it goes off mountains
okay so it doesn't really matter for us
in this case we don't want to we do not
want to wake the device up you can also
there a couple ways to do this with
alarm service the real question is do
you care about these updates running
while the device is turned off in other
words my device is now oh not awake
right all its drivers are shut down and
so on I the only driver that is way oh
this is awake is actually the radio
driver right so the phone call can wake
it up but right now this device is
sleeping the sometimes you need to keep
the device awake and to do that that's
beside the point but you gather you got
to obtain the wakelock you basically
would keep it away now that record
obviously potentially dangerous thing
because it weighs battery and you know
do various things so you typically do
not want to you know it depends you know
like Google Maps Navigation needs that
feature because you want navigation to
stay on while you're driving right but
sometimes you do not want that that
thing right so uh so the in this case I
would presume that we don't care about
refreshing tweets while the device is
sleeping right I would not want to do
that so the question is that are we
going to use elapsed time or or or real
time right so basically the current time
in milliseconds so in other words if I
say one hour is going to be one hour
since last time you was walking up in
other words does the clock count while
we are sleeping that's the real question
and I guess it may so it's really that
in that case you would use RTC which is
the time so it's basically the wall
clock right it's the time in in UTC
right it's time current time in
milliseconds otherwise you can do a
lapse time since both including sleep so
you could do since booted it doesn't oh
this is actually also include sleep
elapsed time actually since would ok so
it's smaller numbers it's presumably an
int or something so it doesn't really
matter for us so I'll say alarm alarm
manager dot elapsed time ok
trigger at time trigger time is so the
time the alarms will go off first using
the approximate clock depending on the
alarm time this is inexact Iran will not
fire before this time but there may be a
delay of almost an entire alarm interval
before the first invocation of dealer so
in other words how when do you want this
alarm to fire right and for the first
time knowing that the first time could
be the next interval so we could use the
current time right if we are using yes
so we could use the current time in
milliseconds so system dot current time
emails okay
the next thing is interval so what's the
interval is it 15 minutes half an hour
hour half day or day right and we should
probably adjust our interval to be to
use that as well right remember how we
have that end up in the preferences so
so we could actually grab that from
preferences right what that interval is
and so we call it the delay before right
so we called it a quality interval for
now but we'll have to define that
interval and let's uh let's say we're
gonna get inter ball here I'll say is it
a constant right the constant it is a
constant so let's see what the actual
values of concept are so then actually
number of milliseconds right right so
half an interval an hour so that's
another 36 3.6 million milliseconds so
it's time in milliseconds right so
that's what I did what we have right
times 10 so so that's going to be that's
going to be art so long interval is
going to be something we're going to
figure it out okay and the only other
thing that we have is going to be the
operation in the operation is going to
be this thing here that that is a
pending intent now what the heck is a
pending intent right so a pending intent
is basically an intent that you're
leaving for somebody for the future
right so we are now creating an intent
today that we're going to give somebody
to use to wake us up later on in the
future not us or somebody else exam so
we're going to have this thing called
pending intent
operation right now the question is how
to create a pending intent and a pending
intent you create you don't create
directly but you created via one of the
static methods depending on what you're
doing right so remember what you can do
with intense we've been talking about
today extensively in the afternoon right
so intense you can use an intent to
start a series start an activity stop a
service buying the service send a
broadcast that's about it right so
remember what we want to do in what our
alarm is going to do is going to wake up
our refresh service right right so so
basically what we want to do in that
case is one we want to do a get a get
service intent right that's the one that
we're going to use so it's going to be a
get service intent so it's going to go
something like this pending intent dot
get service okay context request code
code intent and flags and keep in mind
the you know part of this axis also can
show you how to use the documentation
all that stuff because you definitely
don't want to memorize all the stuff all
right so context we got that request
cost private code for the sender
currently not used hmm okay so minus one
should qualify right right intent don't
compute the intent describing the
service to be started so don't confuse
this intent indistinct and this is the
intent that walk the broadcast receiver
this is the intent that we're going to
be sending right so that intent is going
to be the actual new intent right and
then it's going to be from context to to
refresh service we put a smiley for
service actually have the way to start
it via the
you create an action for that start Mary
first service place yeah I did write
that like I could do it I could do it
from this to refresh service I could do
it that way or I could also do it by
intent filter although this name is
going to stupid study first service
place typically it will be something
like calm example dot dot refresh
service right so now my boot receiver
cookie I could do it this way or I could
do it that way it's really up to you
right and if you want you could also to
make it a little cleaner one way to
store these statics we could basically
put it in here to create a public static
final string action refresh right with
the action I guess I mean intent.action
refresh right so now I can basically in
my boot receiver as opposed to hard
coding it like this i can say i'm the
app to app dot that
and the only question is will the heck
are flags and the flags are one shot no
creates like canceled current like
update current okay so so let's say one
shot it's basically used word get
activity get service can only be used
use ones if set after sand it's called
on it it'll ultimately we cancel for you
and your future time to send for it will
fail so we probably want update current
flag football already exist and keep
very close with an extra data okay they
probably won't like it basically in an
unlikely situation that we that one
service one intent is not done that we
have second one in second ones so you
don't want this refresh refresh refresh
to pile up right instead you can say oh
if there's already one pending just just
updated right so I could do something
like that so intent dot update it's not
intent it's only the where am I pending
in time
and the only now problem to hear is to
get interval and the interval to get
interval i get i need to get the
preferences and we don't have an easy
access to to a Yamba app in this case so
what i can do is i can do preference
manager don't get before share
preferences for a context dot get
strength it's a delay like this
what was the was the default was 15
minutes is how many milliseconds is that
if we that is it as a default
I'll just make 115 ah so long and this
is where you get like a little bit of a
spaghetti code
so what I'm doing is I'm getting the
preference manager I'm getting that
string was it called delay I don't think
it's called delay let's see in the
Preferences whatever we call that
preference delay it was called delay in
lower case right delay right so then my
boot receiver is going to be called
delay 9000 and and then I could yeah and
that's basically that so just to make
sure we know what we got i'm going to
say i'm going to say in log i'm going to
actually put some of these debug
statements right so string.format % s so
delay percent us
show me the format
something like that it's everything
basically compounce this point actually
fit your very first stories how do you
how do you make this pending service
available are you so first of all I did
so keep in mind you guys that nothing
changed other than I haven't changed a
file other than boo tipsy right this is
the only flower change I don't work
trying to get the service way ok so this
tourniquet operation make sure in place
yeah I'm gonna yeah where sin we're
creating an intent that's going to
happen in the future so basically what
the pending intent is is a wrapper
around an intent that specifies you know
what to do with that intent so we're
saying a create a pending intent around
this section for get service so that's
not our operation essentially this is
going to be equivalent of start service
for such an assumption then whoever can
be obviously the same process my vision
board someone application will have work
the same communities he says if you
don't understand this by giving pending
intent other applications are giving the
right to perform operation either
Facebook the permissions are a different
story in these kids we're not too
concerned about permissions we can
manage permissions like we talked about
yesterday with permissions and we can do
that we can do that here right so as a
matter of fact we already have this
locked down because the the Refresh
service is already saying you gotta have
the permission to refresh right and if
you want we can just we can either say
we can what we could do is we can say
signature so basically only guys who
have the same signature can perform can
access this so yes you can give
anybody in this intent anyone can know
this piece of text this doesn't have to
be a secret this piece of text refresh
service right but no they will not be
able to invoke because this permission
is going to block it right circular
world would not be able to send an
intent to start a service
so again
I'm going to JPY is finishing the fine
director
so so that's that the only other thing
that I would suggest going was adjusting
the strings to match what we have
available right so right now we have
every 15
15 minutes every 30 minutes and every no
Owen motor controls 15 15 minutes half
day
so every hour every half hour 15 minutes
all day of the so this is it so and we
are not so so every 15 minutes half an
hour an hour half a day a day once a day
right so then this is becoming
milliseconds so 15 minutes becomes nine
ninety thousand right yes
so we have one two three four five one
two three four five okay so 15 minutes a
half hour right every hour half a day
and every day lose the values right i
doesn't really matter but I just wanted
to kind of sync it with what the
constants are so so far i only changed
this right and again it's not really
that important but really the only new
thing was the boot receiver and so
that's about it
let me try this I'm going to install it
because it's going to take some time to
actually test this right so we need to
install it to actually have it be part
of yambar first right um what if i just
wanted to fake my you know I don't
really want to sit here wait to reboot
the emulator um how could I faked my
boot receiver to actually get installed
but to actually get kick-started like I
want to write a test code to this hmm no
because right now my boot receiver is
only registered to get the notifications
from for this intent-filter hmm yeah i
mean i could just make up a do something
like this action name you know this is a
you know calm example yamba dot test
broadcast right this is just for me to
be able to like to speed things up I
don't want to wait like you know install
it and like go wait for it and all that
so my little kilo thingy remember we had
the little button I'm gonna put in
button as opposed to start service oops
I'm going to comment this one out but
instead of that I'll say oops i'll say
send broadcast for a new intent
right so now I'm gonna run my my hello
world which is not really becoming my
little almost as driver alright so let's
see if this actually turns out the way
we expected so if I click on this this
should send an intent but nobody god I
wanna say is installed runners and
without
that's it but on this
they're so might see my button did wake
up my boot receive right so presumably
our alarm is now set up yeah you know I
can just a little bit on all the testing
site and set the alarm with with the
9000 which was the default oops so you
know with that well the the boot
receiver is gonna start the alarm oh oh
you're saying start oh do I need to
study alarm when you just set the alarm
yeah what yeah yeah the system service
yeah it's set for 15 minutes right now
but it did it work
so this was just for testing purposes
all I did in the manifest file was add
this one extra action film so you don't
have to have one filter you could have
multiple filters right and if I wanted
to really test it presumably I could add
a note in here but presumably I wanted
to let me see if i can add the
preference here test item test x 7 30
seconds item so we don't have to wait 15
minutes right and so this will be 30,000
right 30000 milliseconds right so if i
do this now if i install my test code
nothing it actually the builders we are
it actually didn't do the rebuilt known
as Android app
so if I go to menu preferences delay i
want to sell it for 30 seconds okay and
that's it so now i want around my hello
world again and trigger it
30 seconds damn it worked right you can
see that that this get triggered and you
can tell the three fresh ran we should
see 30 seconds later refresh once again
although it's not the official interval
so i don't know if that's you know it's
something we should remove eventually
but but it's a test okay dead student
team theme is tweeting right so so this
is now running as well right so first
again
what's missing in this good
what's not good about this code right
now what's that ah there's no way to
turn the alarm off right so we could add
an interval as opposed to test interval
we could add an interval never right
right sure and then we could say item
something like that right so we could
figure something out like that but
here's the thing what if I now so this
is now running every 30 seconds what if
I now go and change that it will not
change it
you know keeps on running every 30
seconds
right so what's missing out there dis
man what's missing in the booty receiver
what did he have to do before
so we're only doing this code once at
boot time right and we're testing we're
checking the preference manager for the
value and we're signing that as an
interval setting up the alarm and dying
off this is never going to start again
until the the phone is rebooted
you
make sure you know what that's not a bad
idea i mean you have a that's not a bad
idea i mean what i was thinking there's
you know it points out there's different
ways to do these things don't do this
but what I was thinking is I would
extract this right i would say shared
preferences prefs is that then I would
you know here then we will do X will do
prev straight that's the same codes of
all right just basically we factor it a
little bit now what was missing would be
to be able to assign a listener right so
I producing like this perhaps dot add
what's the dad register that's right
Shambala and then I could say new and
then it's such a long thing you copy
paste this rate I was just going in your
class right here so ugly but you know
and then in and then i would say
organized imports and then i would say a
damper methods and then you would
basically say profs are or you know key
right so then in here i could then
refresh the alarm a little bit too much
code
preferences changed today it like we
said the alarm but you know user changed
his mind or her mind now what so we
could register a listener but purity
have a code like this right so so we
could actually as opposed to doing all
this stuff here right we could actually
do it in the where we already do that
which is in yamba app so we know when
preferences changed right reference is
changed here so I could send a broadcast
send broadcast and again I could make a
broadcast new in you know I could make a
static in tank you know
intent refresh alarm intent is new
intent make up some static text right
I'm just making stuff up
oops
so I just make some text here so we now
just send broadcast for the fresh alarm
so basically when shared preferences
change we say refresh alarm and then we
could just do the boot receiver again
make sense we can keep waking that piece
of code over and over again not just a
boot maybe boot is not appropriate name
anymore maybe it should be called you
know alarm receiver or something refresh
receive or something like that but then
in the manifest file a better register
yet another action Android name and then
use that name that which is the point
what do you mean oh I don't put them in
external thing because we don't need to
localize them they're not user expose
this is only the free card code once we
get it right we got it right there's no
real reason to externalize it it's it's
not something it's configurable and and
so on yeah that's why and the only thing
that we may have to do is cancel
previous so we may have to do so cancel
previous operation if there is one and
then we set a new operation right
although this may not work
and we are only going to do this if
interval greater than zero right because
in interval could be zero so should be
now able to trigger my boot receiver via
just goes a couple of changes in the
preferences okay so if I go menu
preferences delay then woke up did a job
right and it's going to run within the
next 30 seconds first time around right
I'm not they haven't canceled anything
yet see that also got it so that worked
what so I should presumably cancel it
here so if the if the if the interval is
zero but we should probably cancel yeah
so let's see alarm how do we cancel all
nah huh it should be it should cancel
yeah
say
soul our manager dot canceled so we
should probably cancel anything previous
right any previous operation and then if
there is a new stuff we set it in let it
run right okay so so let me do you guys
you guys lost on this or are you
following so really the only the only
news is really in in this file boot
receiver this is really the only file
you care about right on I mean there's
some other cosmetic stuff that they did
but don't worry about it so here's what
we did we basically let me start with
the picture where's our picture so what
we wanted to do is we want it to have
this guy this guy be controlled by some
kind of receipt some kind of a lot
something that basically alarm service
so there's going to be alarm service
here it's outside its part of the system
and we wanted this alarms we wanted to
have a booty so let me redraw this so we
have the boot receiver right so we
wanted the boot receiver to set up alarm
so alarm is something that is outside so
am L our manager right alarm is
something that's outside of our project
it's part of the system it's given to us
so boot receiver so boot receiver wakes
up right so this is boot completed right
good completed happens this guy wakes up
it goes and it sets up the alarm manager
think of it as a cron job it goes and
says all right i would like to configure
such-and-such job okay
got it so far exams so so once it
configures that job that job is going to
subsequently trigger refresh service
every so often right now I only all the
only additional things i also wanted if
there's a change in preferences i wanted
to kind of trigger this guy to set up
the job again right that's the tiny
little difference between and that's
actually done through here so this guy
not to change says be receiving set up
date basically the alarm manager of
digital our manager our manager changes
the frequency yeah just just a second
but you guys conceptually get is first
so this happens first at boot right so
this is boot boot completed intent this
guy wakes up does this second right in
sets of the job and then this happens to
the three plus x right this keeps
happening many many many many times this
is optionally if this happens fort like
something changed this guy is going to
say Oh update yourself then this is
going to be then five and then this is
going to be 6 plus times but it keeps on
kind of looping that way so you could
actually you do lines and circles make
sense you're using intense quite a bit
here and these are the Android building
blocks right your preference what's that
you sure preference you can go to the
manager 31 you could set that you could
attach an observer yes you could attach
a register and on on shape preference
change listener to listen to that and
then go update yes you can do that but
this is a little more elegant that's
what you know the suggested so so I
think it's a little more elegant yeah
because we're using tents and such so
it's more of a you know this was this
was how it was designed to be used right
so then
what we do so back now to code right so
this is where I read my share
preferences just to get the interval
right so this is all just like cannot
number parts that number it's just so
not nothing special right then once we
get this interval we create a pending
intent pending intent is just basically
wrapping a some intent such as started
if action refresh around some future
intent that's all it is right Thanks
else then we say we get the alarm
manager and then we say if there's
anything previously canceled it and then
we say if the interval is bigger than
that set future interval and that's it
well if I have a pending intent set
every 15 minutes and user says I want to
change it to half an hour so in our
picture what's going to happen is we're
going to go from here to here to that
alarm manager and we're going to say
update to half an hour it says fine i'm
going to now start a half an hour so now
what we have is we have 15 minutes in
half an hour intervals ah that's yeah
you're right i should have a yeah you
right i should have remember the
previous one and then use that one
instead so yeah I should have done that
so yeah I didn't but that's that's what
that would do I would have to have a
static variable here and then memorize
the previous one and so okay but you
guys get it otherwise right okay so
that's the main thing the other thing
that I did was just more more cosmetic
stuff like you know young we said okay
if if Yamba app if there's a change in
in preferences
defied the alarm to not send a broadcast
to update that so that's basically but
he starts this guy again right right so
I guess I could have static depending in
intent last stop right so I could
basically cancel last operation right
and then hope this becomes operation we
run that operation and then the once we
set it operation we can basically you
know last stop becomes becomes the
operation something like that right
I could yeah that's something like that
um any questions or questions on these
comments on this are you doing lost or
salsa got it getting it getting it okay
yeah
no no beep what we had going on before
we had the update service rate which at
this point we totally obsoleted we can
totally get rid of update service right
so our update service was very rigid it
was basically sleeping here for exact
some number of seconds and it would fire
up fire up fire up right so if you look
at it like this let me let me find a
clean slate right so clean piece of
paper so if you if you imagine that so
this is our service our service get a
perfect interval it would wake up it
would wake up it would wake up it would
wake up right and so on so each of these
wake up's anto radio uses the radio
right now the problem isn't weird so
these are perfect intervals this this is
all 15 minutes or whatever let's say 15
minutes the problem is that there's also
other stuff that goes on like maybe
Facebook does something like this right
every 15 minutes maybe maybe you have a
you know your gmail doing something like
this right right maybe you have your
twitter app doing something like that
right so very soon your radio is up all
the time right we're trying to minimize
how often radio is so we're trying to
batch all the needing to go out to the
world on the same interval so it doesn't
really you don't really care about your
gmail going exactly on a specific you
know second nor your Twitter nor your
Facebook nor any of those so you can
just say hey why don't you guys all go
together so we open up the radio once
everyone goes to the cloud and we shut
it down so the purpose of this whole
exercise was to get more of a flat then
everyone goes out does the job flat
presumably for some time everyone goes
out does the job flat and so on so this
would presumably minimize the
consumption of battery because the
radius
takagi it's about 10x normal well
difference is about 10x between idle and
on right so that's what we're trying to
do that allows this by using the system
salon manager in this elegant system you
know saying just you know here's an
intentservice just fire up tell it when
to wake up and so on and so on right you
know by using that we now get the system
be responsible to kind of optimize all
those things
so that was the that was the big that
was the big goal of this make sense you
I mean the other apps can tie themselves
to the same alarm it's not our business
right so Facebook and Facebook and do
the same thing it's gonna be they can
say go over to 15 minutes and check for
facebook updates but what every 15
minutes means you want to get in sync
like maybe that's seven second after the
minute right like you want them all to
go out at the same time it doesn't need
to be on the clock 15 minutes it can be
15 minutes and seven seconds afterwards
so that we group them all on the same
clock so this way we will basically have
all of them are kind of going out in
here right right and then they're all
kind of flat and they're all going out
in here and so on and then there'll come
a flat and that's what we want to cause
that's our goal just merely batching
them together batching the jobs on the
same here right on the same radio is up
yeah
ardea I think I think it lapsed is
actually 0 minutes 0 seconds I think I
use the RTC or whatever it's called
which is the absolute yeah i use the
absolute so because i use the episode
because they based it I pace the start
time I am NOT going to present sure but
it seems to have worked I used I used
here that said start from absolute RTC
absolute time and use the current time
so you know we offset based on or both
butter based on january first nineteen
seventy so that's why I kind of figured
it's going to work because they're both
based in the same unit imperial time
right
so basically our the point here is that
are a disservice which we had earlier is
totally obsolete we don't need this we
don't need this like thread within run
we didn't try within while within I mean
you know with the sleep and so on this
was somewhat ugly right we separated the
job from the scheduling of a job right
that's a big different difference right
so look our job now is is in a refresh
service so our job is right here right
our job couldn't be simpler pull and
insert that's the job all the threading
everything else is done magically there
so this is very elegant piece of code I
mean come on 20 lines of code not even
right so so that's the job the
scheduling of a job was done with you
know if you if you take out all the
reading the preferences right the
scheduling of a job is really you know
that right again it's not that bad it's
like set a set an alarm so we took we
separated concerns as well right
and through all this process we got to
illustrate some some of the sort of
advanced topics like impending intense
you know how also you know you wanted
one thing you guys want to learn from
this course is also kind of how to think
in the way of Android right so to kind
of use the this building blocks like
intent intent filters services you know
who's messaging whom how how this gets
delivered and so forth that's why it's
different than just a plain old java
right so that's we kind of got to use
some of those features and so on in an
elegant elegant way right so is it
clicking in yeah yes the so okay so
maybe at this point but-- receiver
should not be called boot receiver bad
name because before it was just for
something to do it boot now its
responsibility is to schedule schedule
refresh so matin we might as well rename
it so here I'm gonna actually leap
rename it so boot receiver is now
refactoring name officially gonna become
schedule refresh schedule receiver
refresh schedule schedule receiver or
refresh alarm receiver what you want to
call it yeah okay very fresh alarm
receiver right oh actually they fix this
magic you would have to normally
manually do this but how easy was that
to rename though it needs to be a bug
three factor would not fix this so now
this refresh schedule receiver is
responsible for scheduling refresh
service right and it responds to a whole
bunch of things it responds to boot it
does something one system boots up it
does something when we do a test
broadcast and it also does something
when we change you know something in the
no and you could also do it scava do
something on a button right if you want
it to change reschedule but we do it
from preferences right so far so good
you cannot have two instances of the
same app running same time you can have
two instances of the same main building
block running at the same time here's a
problem Oh actually no it's not they can
demonstrate yeah all right so let me uh
so there's a 15 minutes left let me give
you guys something to think about so you
you're up you're asking about the sample
code and such right so there's a very
good sample code you should be aware of
and and by the way for this to work you
must have the following installed you
must care this SDKs sample since samples
for SDK installed right so for example i
think i have it but there's an update
right so yeah i do so you must get one
of these for your appropriate platform
okay so check this out so what i can do
is i can create a new project android
project okay you wanted to create a new
probably want to do something different
right so let's do something different
and you create a new project from
scratch in the next 15 minutes right on
but what you're going to do is we're
going to create projects an existing
sample right
and what I'm going to do is I'm going to
create next and I'm going to choose API
demos I just so basically what they did
is again I click on create project for
existing samples you can leave this
blank right so just create project from
existing samples next pick your platform
like I'm working with four point oh next
pick your sample and the one I recommend
what rank recommend is API demos and
click on finish at the gazillion
different samples but this one is really
good for this one is really good for
it's kind of like a kitchen sink of a
whole bunch of stuff right you guys
there so let me run it
yeah it's big / fan blah blah blah but
so this is the problem II thought it was
installed in this brand-new emulator God
knows when and where it is most full
uninstallation so and it tells you what
the command is actually so I need to
uninstall it because it was whatever is
their assigned me the different debug
keep probably the one from the factory
or whoever made it so what I need to do
is I need to adb uninstall that
altogether because it's probably the
installed on your device and then I'm
going to reattempt to install it by
running it in this time around it's
since it's removed now it's going to go
in the install with my key the debug key
that you will sign with with some
Engineer somewhere I've built it so we
all have different debug keys hopefully
so we have it running there it is API
demos is the kitchen sink of stuff you
know you can you can find out about
various things so for example you want
it to and you let's see one thing that
I'm thinking you could try to figure out
on your own is you know you know when we
post a message it may take a while it'd
be nice to do a little spinner like a
little progress bar right that says
please wait we're attempting to post a
message to the user knows what's going
on but like you know the gazillion
widgets and we're not going to show you
all of them so you should be able to
figure out like by going to this list
all right what the heck would it be
right Oh progress bar let's say without
be that in title bar
dialogues yeah this would be a good one
right something that says please wait
we're posting the message right or
without a title please wait we're
posting yeah so you know if you were
going to figure out how to use this
widget you could go to documentation
good luck or you could go into this
example and its really nice the
organized so you see colleges views
progress bar dialogue tree hmm well this
is a UI so it's going to have some XML
it's going to have some Java right so no
problem we know we know about Android so
far right so let's find views okay so
something that's called progress bar 3
all right so it's using a layout called
progress bar three are in no problem
resources layout progress bar three so
between these two files right you should
be able to figure out how this works
this is probably not that useful it's
probably all it's doing is probably just
pulling up the menu those are probably
just the buttons so not much in here
just two buttons right we didn't really
care about it as a matter of fact that
can close this and so there's some Java
okay when the button is clicked say show
dialogue oops so it says show dialogue
right and in that's how you do it okay
we take the dialogue w so anyway the
point is try to figure out like
something like this like for example
progress bar if you could plug into our
example right yeah and try to just kind
of see what's in this kitchen sink
anything that you know you were looking
for that that
be available available to you right so
that's the that's one of the main sample
codes that I wanted to show you because
I think it's the best for learning
purposes it's more to the point than
anything else right yeah so play with it
for a second but you guys learning so
farming oh is it is this good so far
okay I mean we still have one day so we
can like change the gears right so if
you you know there's something that's
missing or you know a remote services
well we've been doing remote services
from day one Twitter it's a remote
service right I mean it's it is a real
web service all along we've been doing a
web service it's just the intricacy of
building up a URL or of no interest to
us that's a plain old job or pearl
whatever right so we abstract it all
that if there's a soap service it's all
the same stuff come on you guys look
it's it's well that's that so we can
talk about parsing XML we can talk about
Jason but that's got nothing to do with
Android right that is a plain old java
so Twitter does exactly that we are
making a web service soap it's actually
a restful web service so yes there's a
there's a restful URL going out there's
a jason / xml code coming back there's
something parsing it but guess what
there's nothing about android and all
that so we can go on that tangent and
Logan you know a lot of great things
about Java okay yeah location would be a
good one because it is very Android
specific yeah location and sensors ah
yes that's a special to think and i'll
give you a code for that yeah yeah
yeah you want to talk about app widgets
okay I don't know much about gesture
building at all unfortunately no and if
see I don't know much about NFC either
we can explore it but I don't know a lot
about it plus we don't have a very good
way to do anything with it I mean
there's only one device and I don't have
it that the gas does so great so you can
in canvassing graphics that I can talk I
can show you canvassing graphics as part
of the sensors I'll show you the example
that compass example that actually does
doesn't use that and that's going to
explain custom components as well google
maps up like so first of all google
google maps is is not a standard android
it's a google specific ad on right it's
kind of like saying show me quieras dual
screen support right so on secondly it
has its own API right so in terms of
using google maps it's super easy you
just take maps view and you drop it into
your application in Bandung type the box
that you drop in is just just like
you've drop in a piece of text view
right but what you do with that box is
now different because you now follow
google maps api and that's a separate
api we actually have a separate course
in that it's it's really not a specific
to Android it's the same for web or
Jacob javascript or or Android and so on
so in secondly I don't have it you have
to have a key to use it we wouldn't
really get a lot of done I can show you
i have a sample code I have a naps
application that i can walk into a
really quickly yeah yeah I'll show you I
mean yeah that's very well documented
these easy stuff yeah I mean it's kind
of like can you drag a drop a button you
drag and drop a google map into your app
I don't know anything there's no nothing
special in android about charts you can
do charting but that now just becomes
some third-party components yeah so
that's what that does is that was the
same question so what happens when you
have your images you want to display the
images of users oh there's actually a
little bit of work to be done because
you get a URL but you don't want you
don't know wait for that URL to download
you gotta put it you got to manage the
down we'll build a bill basically all
download manager I can show you how that
works I could actually copy paste that
code and plug it in but I didn't know if
I want you to follow along just because
it's there's a lot of stuff but I can
explain conceptually how that works yeah
yeah yeah cool cool cool awesome so yeah
I'll you know rocky no I'll see you guys
tomorrow same time
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>