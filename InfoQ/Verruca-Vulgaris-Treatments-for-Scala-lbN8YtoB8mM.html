<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Verruca Vulgaris Treatments for Scala | Coder Coacher - Coaching Coders</title><meta content="Verruca Vulgaris Treatments for Scala - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Verruca Vulgaris Treatments for Scala</b></h2><h5 class="post__date">2014-04-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/lbN8YtoB8mM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">um so I work at this company called
simple energy we previously had a
developer that didn't know scholar and
one of the reasons that i use scholar is
that it's so flexible but after seeing
the code that this guy's created after
not knowing scholar maybe flexibility
isn't a great thing so what we've done
so far is delete about 25,000 lines of
code we've got 15,000 lines left and
we're still trying to manage it but I
think we'll get it down to about 10,000
lines of code but we will actually have
a functional and working but basically
I've come out against flexibility in
languages after seeing what a mess you
can create with flexibility in Scala I
believe that we should limit it and this
is kind of a bit of a talk about how we
can how we can limit the flexibility in
Scala so does anybody know what verruca
vulgaris means common was of course so
I've been working on a tool called a
wart remover awesome name 10 it
originally started off as a pack a trait
that you would inherit into your package
object so for example we put it into
combat simple energy and then any
packages under combat simple energy
would automatically get some
enhancements or some limitations so used
ambiguous implicit so does anybody know
about any to string add yeah it's
awesome right so any to string add is an
implicit that's in the pre def and what
you can do is make that ambiguous by
defining two more implicit with the same
type and so when you go and when you win
when the Scala compiler would usually
insert any tutoring add it would try and
look up the the implicit and you'll find
that there's more than one and wouldn't
know what to do so it would throw an
error which is exactly what I wanted I
didn't want this this what I thought was
a wart to just encourage her in my coat
and also our language features like the
cf-18 language features like higher
cards exiting
tools there's things like post fix-ups
so you can actually they're actually
implemented using implicit so when you
go to use a feature scholar will look up
in scope is this is this language
feature enabled by looking at the
implicit and so what you can do is just
turn that feature completely off you
can't enable it again because what you
can do is just make that an ambiguous
implicit so in Scala compiler goes to
look out the implicit will find out it's
ambiguous and then you can't use the
feature and also I to find a couple of
wats so you would have a couple you
could define a you could define a block
and inside that you could use a macro on
that block and it with disabled features
so the first one wasn't very useful I
couldn't I couldn't write all the what I
couldn't disabled as much as what i
wanted so i decided to rewrite it and
make it a general-purpose linty so i
took the idea of using the macros the
the code the macros that would go over
the your blocks and try and generalize
it to be a compiler plug-in as well
because they both use the reflection API
so this this new wart remover will you
write a general-purpose traversal for
finding wallets and then it will be able
to be run as a compiler plug-in or as a
macro over block or even as just a
command-line tool so there's a good a
repo if you want to have it have a look
at it so let's pretend we hate print
loan anybody else hey print one like I
do awesome yeah we hate print alone so
taking this line of code it compiles
into this scholar aht right so we apply
it gets the function using the name so
it accesses print line on the pre def
and then supplies an argument which is a
constant and then yet applies it to the
function so I'm going to show how we can
disable this disabled print line using
what remember
is that too small is that okay hang on
oh let's rip it up okay so to write your
own what you are creative project at SBT
project and you just create an object
inside of there that extends a wat
traversal and what traverse it just
takes it just has an apply method which
takes in a universe which is an
abstraction over the scholar macro
universe in the reflection universe when
you both we need to have struck both
over both of those so they can run as
compiler plugins and also as macros so
inside of that we we have to spit out a
traversa at the end yes uh I tried that
I tried it it didn't work it's you your
fault um yeah I don't know anyway i'll
get to that anyway so we spit out a
traversal which is something that will
traverse over al scholar AST so we
define a pre def symbol so this is a so
pre def is a module it's got a well
stuff like a lot of my Clips important
important when we use a when we write
its calif i'll let me create a term name
for print line and so when we traverse
we just look for anything that is
accessing print line so it doesn't even
have to be a function call to print line
it could just be x equals print line
anywhere that the print line is accessed
on pre def we throw an error so we say
you use print line you're bad you can
see that we've got this what what what
Eugene was getting that was this so
we're checking that the site the the
thing on the left is the same as is a
subtype of of the period of simple
actually I do know exactly why and I'll
show you in a minute so yeah we were
just checking that the thing that was
the thing that we're doing dot print
line on is a subtype of pre-death so
let's
so when we when we want to use our macro
oh sorry ll the work that we've defined
we just include scholar see options so
we say that we want to use this out HP
is like including a scalar C plugin so
it's actually plug in into scala t so we
include what remover as a plug-in and we
include we put on the classpath the the
jar that contains our what that we just
defined so in here i'm using the jar
that comes out of the compilation so
when we actually compile this project
you'll spit out a jar and we use that as
the as the classpath to to what removal
and then we just say we want to use this
traversal so that's the print lunch
reverse that we've just defined so this
will be running so you can see that
scholar see options is in test so
anything that we put under test will
have print line disabled so you ever got
an example
so there you go it says now yeah use
print line so you bad I'll demonstrate
that it actually works without print one
and then we can actually use other
things do go so test passed even though
there's no test but yeah so one thing
the reason why I've got the subtype
there so if I go Val x equals pre def
and then I do X dot print line does that
make sense now so we're not actually
actually asset except them all laid up
ago so we're not accessing our print
line on pre de for accessing it on X
which is a subtype of predefined so we
can also do is now that we've defined
this thing so I've got a you can see
here I've imported macros I'm inputted
our wallet let's try make a macro out of
the wart that we just defined so we just
say no print line takes in any
it's a look there we are so now we'll
have a macro and we can't use print line
within that macro but we can say and
that works so the traversa is running
over just that part of the code and
spinning out an error so we can have
blocks inside of our code that are safe
and the final thing I want to show I'm
really ahead of schedule um which is
awesome because I'm sure Josh will talk
about as it usually does so the final
thing is I've got this shell script
which will run my wart from the command
line so we can actually run from the
command line stuff going through SPT or
going through a macro so let's run it
over i'll test so there we go so you
don't even have to spin up SPT or
anything you can just run it from the
command line using let's got the scallop
plugin um so let me just show you what i
want to get done with uh with wat
remover oh so we've got to build a lot
of built-in wat inside of what remover
so i'm not sure which ones are by
default but we've got like a super class
we just got a heap of these all under 11
kind of 111 traversal but yeah like we
disable any to string add no far all the
bad things so you don't you can't use
them and also you can't use option get
which I know Daniel used to love to do
so the wish list I want to get rid of
caught false positives and false
negatives so um sometimes it'll say you
know you're using option get here but
it's actually spit out by the Scala
compiler and not not actually written by
you so the Scala compiler should be
doing the right thing hopefully who
knows though
so we can we should try and ignore
everything thats Carla compile it spits
out but that's actually tricky because
only something so marked as synthetic as
in like generated by the compiler so the
compiler spits out things and says well
this stuff is but then you look at
somewhere else and says it doesn't have
any annotation saying this is this is
this is synthetic so it's actually hard
thing to tell if you've written it or
not and I want to get more built in wars
there's lots and lots of what's on the
on the github issues and they're
actually pretty easy to write as you can
see so if anyone wants to wants to get
involved just take something off the off
the it off the issue because there's
dozens of them I want to make waters
warnings just so you don't always have
to get have an error so you can have any
to string as as just a just an error
instead and mosaic what's doing Google
that don't google images that it's bad
but basically when we want when we
traverse over when we traverse over the
HD we should only do it once we
shouldn't have to do it multiple times
per watt so if you enable three warts it
should only do what traversal of the HD
ones um that's it
oh so you want to let up so the question
is do can you like suppress the walk for
a particular region that is something I
want to do I haven't got around to it
yeah I'm not sure a good implementation
about so you mean compilation um no idea
yeah it looks fast yeah ah no I mean
I've tried running it over but I got I
got false positive false negatives I try
fixing up a couple this week but yeah
it's not it's not it's not quite ready
to run on the whole fifteen thousand
lines of code that I've got at moment
yeah yes yes we've got two newbies and
yeah they don't actually pretty well but
yeah we got to disable parts of it for
them yeah so the team now is not going
to write the offer code that we had we
inherited it from someone that left the
company and he basically bride hipple
scholar about thirty thousand lines of
code and it was completely unmanageable
he couldn't really keep up any left and
so we took over and we're trying to fix
it up we're not using what remove we're
not we're using remover black no no no
but I do believe that you know after
seeing what what what someone is capable
of with color it's um it's something I
want to prohibit yeah no no we should I
mean it's meant be like a cold winter so
that's the direction I'm going in yeah
okay I think that's it thank you
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>