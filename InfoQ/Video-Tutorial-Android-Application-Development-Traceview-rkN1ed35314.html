<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Video Tutorial: Android Application Development - Traceview | Coder Coacher - Coaching Coders</title><meta content="Video Tutorial: Android Application Development - Traceview - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Video Tutorial: Android Application Development - Traceview</b></h2><h5 class="post__date">2011-01-31</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/rkN1ed35314" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so back to back to this so is Aaron
happy with the look and feel everyone
got their styles together got images and
understands how nine-patch works or what
it does and so on yeah we we did a
little bit of you know error handling if
things fail with palpable toast so for
example if I say hello and now press
update it's gonna say successfully but
if I press update again it's going to
fail okay so another thing that I want
to show you it's a little bit on a
technical side yeah I haven't covered it
haven't covered in the book yeah I know
yeah yeah thanks thanks for pointing
that out
I have it as a to do so one day I'll get
back to it okay
so one thing that I wanted to point out
is that I can crash this application so
let me show you this if I click on
update and I click on update again
let me let me see if I can I can get it
to to crash yeah I'm trying to I'm
trying to crash it really hard
not that kind of crashing I'm trying to
get so let me quickly disconnect from
the network and if I do it now uh-huh
this is what I wanted to bring up hmm
it's not the problem do the catch
statement the catch statement would have
caught it so let's look at the code and
explain why that is so the catch
statement is fine nothing wrong with the
catch statement so let's look at the
code so we press the click on click
button right and we now connect to
Twitter and try to add little status
right but how long is this taking
especially if I don't have the network
enabled it's gonna it's gonna sit there
and keep trying because it doesn't know
hey is the network down is there like
Network latency there's just too much
data network is slow connection is slow
you know like you know what it could be
zillion things that that are going on
and so basically this is sitting there
waiting okay in the meantime in other
words it's blocked in the meantime I'm
trying to click on though you are on the
button to do something else and it's not
responding and so what happens is the
application says whoa whoa you know
we're like we're not responding would
you would you like me to kill this
application or not
yes so the application manager brings
this and says look this app ain't
responding what do you want me to do do
me to kill it or do you know wait for it
and if you wait for it it's actually
eventually gonna come back and
everything is gonna be good right we're
just basically saying okay fine give it
more time it's non-responsive but give
it more time versus saying no just four
scores close but it's a bad app all
right you guys just throw it too bad app
did you know that okay it doesn't even
it it does it the problem is that is
blocked so it's not that it's failing or
it's not that we need something and
finally we could doesn't mean finally
the problem is that it's sitting here
trying really hard to update Network and
it's just sitting there it will it would
it would come back to the socket design
exception like 30 seconds it that's what
happens yeah if I said wait it came back
nothing failed right nothing happened so
but the problem is I had to wait 30
seconds that's not a very responsive app
as a matter of fact if your app doesn't
respond within three seconds the system
brings up that that thing okay so what I
wanna do is I'm gonna show you a couple
of things else eventually came back and
says failed right and so so what I want
to do is I want to do a couple things I
want to measure the execution of this
first to show you what's going on what's
wrong with it and then I want to fix it
okay on so two to measure the execution
of this we're going to need we're going
to use a tool called trace view but
before we can use that tool we're going
to need to generate a trace file before
we can generate a trace file I need to
explain to you how what the file system
looks like okay so I'm gonna jump to a
quick section here
on a file system she could talk a little
briefly about that and I say file system
I'm referring to the file system of the
actual the projectors are off again a
little bit file system the actual device
right so that's so this is the device
file system looks like it's got three
partitions we care about data as the
card and system okay those are sort of
three things that we care about so what
you're gonna do is we're gonna look at
these partitions but as opposed to
showing you know on a dumb static slide
I'm gonna switch over to DDMS and
actually poke around the live file
system of one of my emulator so it
doesn't really matter which one let's
see if something change in one points
two point three they had more stuff but
so these are the three partitions so I'm
gonna start with just talking about them
the system partition so the system
partition is where all the system
related stuff is system partition put
corresponds to what image does anybody
know system to at IMG yeah remember we
talked about that I said if you're a
platform developer this is what you ship
at the end of the day this is what you
need to produce and then it gets flashed
onto the device and that's a new phone
right right there okay so system image
so system image contains a bunch of
stuff such as default apps right you
should look familiar
Calcutta camera contacts desk clock
email browser you know and and so on and
so on so these are the default apps that
ship with the phone right and what do
you notice about this um I said system
partition is is mounted read ami so that
means what about these apps yeah you
can't get rid of them but wait yeah
didn't I say yesterday you can replace
apps just like you know on Windows you
can replace your
Internet Explorer with a5 Firefox yeah
exactly
so in other words you can't get rid of
these ever as a user but you can
successfully ignore them
just like Internet Explorer you can
never really get rid of it anybody tried
I mean it's so entrenched in the system
right but you can successfully ignore it
so so that's sort of similar comparison
right still ok so Apps is where it won't
close ok Apps is where apps are
applications right pin is where you have
some binaries like such as you know your
standard Linux command line stuff like
seed each mod LS that sort of stuff
ok it is easy directory framework is
where you have your ab frameworks ok
some Java classes let is the only place
that is in the LD library path and what
lib is is basically though the the
libraries it's your you know C libraries
it's your shared objects dot Essos right
that's why I like your lip as a cell and
so you know OpenGL and you know open
core and so on they're all in here yeah
in Lib folder and then you get some
other stuff ok so let me just kind of
show you that it is differently I'm
gonna kill this and open this in images
images there's a image Android stack
okay oh I can do it I can do it like
this money well I'll keep it like this
so roughly only roughly speaking of the
apps okay
apps go into this folder here folder
okay except user apps you're gonna see
later on go into this folder here yeah
that's your applications app framework
is a different color that framework goes
into frameworks folder okay
libraries go into libraries for work
yeah and then this stuff at the bottom
goes all over the place but let's say it
goes into bin folder something like that
right so yes so it's so so yeah let's
take a look at that now so that was the
system partition um
so system partition as I said is it's
important for a platform developers but
for us we don't really have a lot to
business there right so we can't
influence anything so no big deal okay
now this close yourself so let's look at
the data partition so data partition
corresponds to what image ya user data
at a time Jia and so that's where a user
defined the apps are so this is the one
that we installed an app private I'm not
quite sure what it is and there's a
mechanism of moving apps back and forth
to SD card so that could be part of that
and but I'm not sure okay so that's
that's apps right
other than that as an app developer the
most important place for you on the
entire file system is a place called
slash data / dat ax and then slash your
package so every single app regardless
if it's a system map or user app has a
private piece of file system here okay
so ours is somewhere here and there it
is and there isn't much in there right
now but we do have our own part of the
file system and by the way it's because
we have root promote privileges of the
emulator that we can even see this so if
you connected my phone wherever it is
you can't see this folders right it just
won't allow you data yes but that's all
within the application right so if
you're sharing the data you're sharing
the data within the application so it's
gonna go into the app private folder it
goes into there's a folder underneath
this we will see that folder when it
gets created okay so that is the that's
basically the the file system at large
the this slash data partition now
there's one more partition that's the SD
card and what does the card pretty much
is is sort of a free-for-all storage you
get to store stop there yeah okay so now
here's what I want to do I want to turn
on tracing so if we can trace what the
heck is going on on our device so I'm
gonna go to our status activity and I
wanna you know you can when it comes to
tracing you need to basically trace
between point a and point B you need to
start somewhere you need to stop
somewhere and you can choose whatever
these two points are it doesn't really
matter but just for sake of argument we
if I wanted to start tracing as early as
possible so what's the first place where
I can start tracing oncreate again and
what line in oncreate you can actually
do it before set content I've said
content view but after super on Crete
cuz you gotta call the super first so
the earliest they can do anything is
here so I can just link all debug dot
start method tracing and you can give it
to trace name file name if you want I'll
call it Yamba dot trace so this turns on
tracing
okay so now I want to stop tracing what
would be a good place to do a stop you
know you guys get a good point I mean
the opposite of oncreate would be on
destroy however the problem is that I
don't have a control over on destroy
right I can't really have it run but
what I could do is I could stop my
activity right so instead of doing on
destroy I'm gonna do it on stop again
just because it's easy to stop activity
you just leave the screen
right Keep Calm button or something so I
could now you know go here and I could
drive to override blah blah blah but if
you don't like typing you can also use a
shortcut source override implement
methods and eclipse knows which you know
where your location is seed nauseum an
activity so it gives me all the options
that they can override implement based
on my you know being an activity so I'm
gonna do on stop BAM
and that adds the method there so it
just saves you typing so you go source
override implement methods so the
opposite of debug start is debug dot
stop method tracing
yes so there is ondestroy it's just we
don't know when ondestroy is gonna
happen hmm
yeah cuz it gets called at some point by
somebody this is just a name yeah yeah
yeah so this is our point so this is our
point a so point a is here and this is
our point B right so we start and we
stop
everyone good so far okay so I'm gonna
run this
and this is going to it's going to crash
miserably yeah why the crash mm I did I
still do still have disabled Network but
that's not the reason remember this
means to read the law cat right so you
would basically open up your terminal a
DB - you know what let me kill the other
amulet - someone got to deal with you
know serial numbers so a DB log cat BAM
and you fire fast-forward back to the
top of the exception and there it is and
what does it say yeah so you you just
got this answer right away without using
your brain too much you now go to what
do we define all the Preferences it's in
a manifest file and it's gonna be just
yet another users permission right it is
this time around it's gonna be a users
permission right external storage so
like I'm gonna get like this manually
use this permission and I see this is
doesn't work Android name equals Android
dot permission dot write X turn X or no
storage you could have also found it in
the list of permissions but the key
again is to say uses permission how do
you find that it's a good question if
you are not a new on Linux you can go
here and you can do it under this under
under permission tab yeah select it and
then you can find it in there right so
you know I could have gone here and say
ah look there's the right external
storage damn save it so that would be
one way sometimes when it dies
it tells you what's missing it actually
says do you have camera permission
do you have location permission so
that's very useful so it's faster to
like show that crash and read the logcat
and to actually figure it out if all
that fails duty the documentation you
know I guess we should be reading the
documentation first but you know it's
not power wired so that's why we have
the art EMF term right in the first
place
okay sure so we're gonna now I run it
again
okay so presumably now it's tracing I
can check that by going into DDMS
perspective see how sometimes you go to
the DMS and stop you're like huh there's
nothing right you guys noticed that
right you or walk at you're like there's
nothing in my locket right that's
because you it doesn't know that you
haven't selected the emulator it doesn't
have the active like whatever device
right but you know let me show you so
now if I go to the SD card
notice that there's a young but trace
file but also notice that it's size is
zero right so we do have a trace file
but there's nothing in it
that's because point B hasn't gotten so
I can now go let me actually get this
run work right so I'm gonna turn on my
my my thing again I'll say your love
wait wait
trace you okay click on update okay it's
failed try again failed
yeah waiter first close oh okay there's
no weight then it crashed it's different
then then then in this case the reason
is that value HTML had meta of type
string can become really to JSON object
hmm
whatever we're getting as a response is
not a good response oh you know what's
going on yeah let's go back to slash dot
sorry I just get to read a little bit of
news first
do you Revere now if I click on update
it's gonna work mm-hm
it's because your your fire firewall was
preventing my connection when I was what
I wasn't getting response
I was like wait this meta meta response
makes no sense that's probably because
this was the response from your firewall
saying login first yeah yeah yeah so
anyway what I wanna do now is my file is
still zero so how that's because point B
hasn't happening how dare you can't
point B happen I can keep the back
button can hit the home button just
anyway to leave the screen and notice
that now takes time but notice that now
then we kill a file woohoo
pretty big it's like half a gig hmm it
the answer is in the law cat what does
it say
remember the crash message says read the
loggia did you figure it out okay so
what we should so now you know this is
finished where we we have the file so
how do we look at this file and so
before I've been showing you this stuff
through the WYSIWYG tool right so lucky
one way I can grab this file once you
have it is I couldn't use the pull and
push to get this file so it's sort of
like FTP right so I can click on this
and I can now say okay grab that llamado
trace and dump it on my desktop it there
it is me copy the file over so it moves
file from one computer to another so
it's this two buttons push and pull
again now like I said before there's no
real magic to you know this stuff here
until it just stopped it sits on top of
ADB alternatively I could have done adb
shell and gotten onto command-line
that's answering your question they
could have gone CD as the card and done
L as the shell and there's my file as
well right Yamba trace right if al yes
there is a cat inside of shell that cat
is one of the things that there is
there's cat there's dog there's Mouse so
if I wanted to copy the file manually
I'm gonna exit the shell and a CD into
my desktop right if I wanted to copy a
file manually I can again use ADB and
push pause so pull from sdcard
yunga dot trace to current working
directory right this is the command line
version of copying the file over there
copy open it and now I can I can examine
this file on my desktop with much more
tools like an I can say mate YUM
and then it opens it up in my you know
my editor there it is and you can see
it's just a text file more or less or
some binary stuff later on okay so to
pull it I did a DB poll then the name of
the device so the remote name and then
the local name under which one same
commander well no I mean just like
before you would if you can't competing
devices you would have to do adb - d or
- e or - s and then serial number yes
but so but it's that's true for any adb
sub-command
right so you gotta say adb and then -
what device if you care more than one
let me take a look so in the status
activity dot Java all we did is we had
we added the point a and the point B you
know you could have just said start
start metal tracing without this right
it does it would have come up with a
file name but but basically the point
was to start here so that was point a
start and this is point B stop and
everything that happens between these
two points is recorded at that far
yep well at some point possibly yeah but
it's only tracing while there's some
execution so yes if you leave it on and
it's running something yes you push into
the into Eclipse I think so
okay mm-hmm so now did you get that
trace file and we copied it onto our
desktop right so it's right here if I do
LS dash L Yamba it's right there right
the trace file now what I can do is I
can use a tool called trace view that's
in a toolbox it's in your tool set when
you're in your in your SDK tools right
and I can analyze this file so trace you
space llamado trace
yeah
I mean just generate a different fault
because this I'm not happy with this
particular I was talking too much while
I was doing this so what I'm gonna do is
I'm gonna round the app again okay
so that so I'm gonna do another example
another experiment right so I'm running
the app yellow with trace view okay I'm
gonna click on update it salad is
successful I'm gonna press home okay and
I'm gonna copy that trace file again
okay and now I'm gonna view it again
yes exactly
yeah pretty much the same trace view is
the same place 480 bees were not drawn
I'm patches where all those tools are
SDK slash tools SDK directory slash
tools
remember that director that we should
have put in the path so that we don't
have to worry about it you know I'm
talking about if you're on the VM you
have it me but so what this tells me is
basically the execution of stuff right
right so I can zoom in like this I can
zoom in on a particular area right and
for example this is where we're reading
the socket so this is the networking
piece right see I can zoom out now
your guys's network is that
unfortunately fast so when you try to do
it with a slower network so what I'm
gonna do is another experiment I'm going
to shut down my airport okay a wireless
I'm going to rerun the application yeah
actually know what I'm gonna just make
sure there's that that actually it does
rerun
so I'm gonna change the code reinstall
the new code okay so so just to be sure
my application is starting okay
so hello from trace view okay click on
update touch here notice that I'm
probably gonna get that force closer
wait okay I'm gonna click on wait okay
and you know wait wait wait for it to
finish which may have to be 30 seconds
since my network doesn't exist it may
need to timeout okay okay it finally
failed now I'm gonna leave the page okay
and hopefully I have a new file so I'm
gonna pull that file again
okay and I'm gonna open it
okay
so this is my trace file right so it
took 16 seconds the entire execution
right 16 seconds approximately and what
what I want you to notice is that there
basically there's basically one main
thread everything worked on this main
thread this thread is also known as a UI
thread user interface because that's why
that's by default your app gets one and
only one thread and everything runs on
it on it right so so that's where the
things are running and if we have
something that's long running on it
taking a long time to run then that
thread is not going to be very
responsive because it's gonna be waiting
for that something and I kind of suspect
there's some kind of issue here because
you see something that's very same color
for a long time right so what I would do
is I would double click on that area so
I'm gonna zoom in and if I if I click on
it you can see that all those are
actually net it seems like they're
Network calls they all io input stream
so that's probably where we are
basically getting the data really
attempting to read the data okay exactly
and that tells you that what I'm looking
at is took 18% or treat 3,000
milliseconds three seconds that it was a
one call and zero recursive calls and so
on and so on
so tells you how long it took and what
so you can use the trace you to find
bottlenecks in your code
my view he keeps faxing okay let me take
a look
does everyone understand and what the
problem is the problem is basically that
while we are attempting to do the
network call everything else is blocking
because we're doing it on a UI thread
that's my goal my point here right so we
have one thread only doing all the work
and while it's busy with networking do
everything else is to wait and that's
why it's clipped the system pops up that
force close or wait window right because
the application is very non-responsive
so we're gonna kept address that any
questions on that okay
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>