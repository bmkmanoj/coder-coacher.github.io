<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Play in Practice | Coder Coacher - Coaching Coders</title><meta content="Play in Practice - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Play in Practice</b></h2><h5 class="post__date">2013-05-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/s2GOZpzBwVE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">well I've been programming in Scala for
about three years now about two seven I
saw Martin give a talk and was instantly
thrilled I before then I was a Ruby
programmer before then there was
actually a Java programmer and seeing
Scala I was basically like oh I can
actually use something which has the
flexibility of Ruby with the power of of
Java behind it and since then it's lived
up to all of my expectations and then
some when Alexi asked me if I was
interested in doing a talk there are a
number of things that I could go into
and so I actually had an original talk
plan which was about writing play and
practice and about doing some fun stuff
with the authentication system so you
could do remember me cookies and delve
into the details of actually composition
while it was fun to write there's kind
of a bigger problem which is if you
haven't used play then it's not gonna
mean nothing to you if you have used
play then it's not gonna be even new and
it's gonna be really really detailed so
I went back and I thought okay what's
gonna be fun and what is going to be
potentially risky but is going to show
you what you can do with play and what
you can do in play that would be dubious
if not impossible with other frameworks
and with other languages so this is
gonna be a broad talk it's not going to
be universal to all situations I'm not
attempting to say this is the white the
way the light and the truth but there is
one thing that play does do and that
it's a web application framework it's
awesome and it's awesome not because it
tries to do everything play is actually
awesome because it doesn't try to do
everything here's what play does do it
takes an HTTP request and it returns or
it streams a response that's play call
that's literally all it does the
internals of it we can
go into detail of it but that's that's
all it actually requires of you here's
what play doesn't do which if you can
see that there's other frameworks out
there it doesn't tie an HTTP request to
a thread it doesn't tie an HTTP session
into memory
it doesn't assume that you want
convenient or but unsafe practices it's
not gonna try and make it as our website
for you it's not gonna try and do any
scaffolding or at least not yet it
doesn't require that you actually have a
particular object relational framework
or in fact any relational framework
object relational framework at all you
are allowed to use eb nor a norm or
Slyke or squirrel but none of those are
actually required they're at their
orthogonal to the underlying play core
functionality and also it doesn't even
mandate a peculiar template library you
can switch it out and it doesn't mandate
a particular routing format on top of
that so what it does instead is it
provides the options out-of-the-box it
provides you a build system it provides
you an HTTP API it provides you with a
template system out-of-the-box
form handling JSON support and all of
that stuff is available to you but all
of that stuff is loosely coupled and can
be switched out as you need it as it
becomes inconvenient so the build system
I'm just going to go through this really
quick because again this is a broad talk
it's a modified SBT and it allows you to
create all of your projects from the
simple library there's a front
controller that allows you to take in
the get or post request that comes in
from the server and allows you to route
it the router is awesome the router
actually allows you to take either you
can switch it out so you take you you
IDs or you can take things out your own
classes and actually just plop them in
as though they were parts of the actual
string framework itself the action which
is the base core of what play actually
does is that it it wraps everything into
a little bundle of functionality and
then you've got the
mutable HTTP API itself everything in
play allows you to go through cookies
through requests through headers and
everything doesn't allow you to actually
change the request itself if you want to
actually change anything in play and
send it back and it's part of the core
API and it's out of the core HTTP API
what you have to do is you have to
create something based off the original
and then you send that back in the
request so you never changed the
original cookie what you do is if you
want to remove a cookie you send a
discarding cookie if and the same thing
with the request and the same thing with
actions you actually have to like
aggregate them together and all of this
is backed by a packer
and is backed by Nestle and then you
have the presentation on the front-end
this is pretty much everything you'd
expect it has all the bells and whistles
and finally you have Jason which is very
nice just because it provides you a
simple data format that you can use to
talk to JavaScript and use the talkback
and it allows you to query into that
object and be able to change how those
objects are written and and read
automatically through the user
Combinator's it there's just a ton of
stuff basically if you can think of it
then you can rely on having a problem
then usually there's something in play
that solves it for you and usually in a
way that's much more elegant than you
are going to come up with at the time so
the big question is all right so that's
useful but why you know why would you
actually want to do that well the answer
is when you have to make a website
that's what they come to you with is
they say okay we need a products go
forth make this happen and then when
you're actually coming back you have to
make two websites you have to make a
product website that all your users are
going to see and then you're gonna be
like okay I need something to actually
administrate it and turn it on and turn
it off and see what their everything's
working a lot so now you've got two
websites and they're both talking to the
same system under the hood
now you've got a few years ago by and
you've got way more websites you've got
a product you've got the admin stuff
you've got the customer service you've
got somebody doing business analytics
and reporting on it you've got somebody
else doing business content and actually
you know putting out the new version of
the site and being trying to put out a
different version and then you've got
something that's you know managing
long-running jobs queues or sending
email on the back and all of it is
talking to the same domain and this is
something where play is actually really
useful because because play doesn't
require you to do anything but send and
send back okay
all right how's that bad all right
excellent
okay so play allows you to it allows you
to look at the same thing from different
angles and you're not going to touch the
database because Goethe knows that's
willful enough and people of horror
stories all over the place and the
answer is you can actually with play you
can actually break it up so that you're
using loosely coupled stateless
composable services what this means is
that you can actually do the play for
intent and you can have it backed by
akka you can create something that's
completely back-end and talks to akka
and you can send messages through it and
you can remove all of the functionality
from play itself which allows everything
in play to actually use messaging in the
original object-oriented sense of the
word that is when you're actually
talking about objects don't think about
them actually calling each other and
being mutable and changing state
internally and all of that think about
them being able to talk to one another
and the way that this happens is through
something called command query
responsibility segregation and this is
where it gets fun because if you think
about play as something that's
completely stateless then the way that
you actually change state is you're
gonna send a command to something else
and then you're going to get back one or
two things you're going to get back an
event that says yes it works or you're
going to back get back a fault that says
no this didn't work something went wrong
in the middle of it all right follows
four questions and it's also a prize
attached to this so doesn't incentive
you okay so so yeah so we've got a
stateless play application on the front
end and we create commands usually by
doing a post so you take the posts and
you wrap it you turn it into a command
you send it into a KO and then you get
back an event and that's all you care
about from the play side and if you're
querying for data then you have this
whole bunch of query services that
and you back a mutable object saying
this is what the data looked like at the
time that you asked and you don't know
anything more about it than that and
then you also have the option of
broadcasting events that is when you
send a post and you're processing a
command when that event comes back that
event can come back to everybody who's
actually signed up to it so if you're
doing real-time web stuff where you're
sending out chat stuff oh you're saying
I want to be notified when this guy logs
in whenever you're sending a command the
event can be streamed back to everybody
who has an open browser and is listening
for that particular user so when you
cross a single command you can validate
or Olympic this is comes with its own
nest of issues as well in that you can
actually be processing and displaying in
foot that you really shouldn't be so you
have to be very careful about how you
actually validate and pass that into the
service so it doesn't try to get hacked
and that's what the API looks like it's
fairly simple you have a command here
and you return a future and that future
is going to be an either that returns a
fault if it's an error or an event
that's on the right and it folds very
naturally into scholars paradigms what
idioms I should say so here's a diagram
again fairly simple and you can see that
as far as the domain service is
concerned we're actually sending a
command and we're getting event back
we're getting we're calling out for
queries and we're getting back data and
again play is completely stateless and
just sitting in the middle of all of us
so here's what a command looks like
again a little more widely streamed so
this says you have a bundle of data you
package this bundle of data up and it's
just got products and that's all it is
is a case class which again Scala makes
really easy you have an event which
again is a class class and has a couple
of data bits added onto it
and you have a faults that looks simple
enough this is all you know assuming
that you're logging in so this is the
session cookie wasn't there or the
session cookie didn't match up with what
we thought it did and then finally we
have queries queries are kind of
different queries actually say we're
calling out to something and we're
getting back data and we don't
necessarily know what's under the hood
at all we're not setting up a
transaction we're not necessarily
calling out to what we think is cash as
far as we know this is the data that we
had at the time we have it and it can be
coming from a database
it can't be coming from a cache it can't
be coming from a no SQL database like
Cassandra or react as far as we're
concerned that's our system of record
when it comes to data so there's a
couple of things that come along with it
that it's going to be immutable it's
going to return ranges or streams
because you don't want to ask for a
million items if you can possibly help
it because it's going to be something
that's away from the ERM you should
avoid using something that's in hql and
although you can put together your own
query builder it does get a little hairy
to do so avoid it until you really have
to do that and then we come to what play
actually does in terms of doing
authentication and in terms of providing
you with a context when you log in
because play is stateless because play
doesn't have an idea that you went in
from one to the next it has to pull that
in and know you are every single time so
you do it from the cookie usually or you
do it from the the underlying session ID
that comes in and from this you can
create a wrapped requests and that rep
request has a credentials object which
you can see back here is that you can
see that there's an implicit credentials
that's being passed in for absolutely
everything and that's also actually
being used in some of the commands is
that you can actually say when we are
calling for this are we the person who
we think has a right to be able to see
this in
first place and that's something that's
very important to do because again you
don't want to make this information
available to anybody and it is something
which allows you to it's an automatic
marker on absolutely everything that
when you get a command when you return
back an event you never lose track of
who it is that's asking and in what
context sorry go ahead is that is right
is that a lot better okay that's a lot
more angry okay so so here we go so
we've got a request context it's got all
the state we need we set up helpers on
the templates to pass everything around
so everything that's using the template
uses that context and we end up with
something like this on the actual page
where we are passing an implicit through
we are getting that data out this is who
you are this is who the user is if we
actually are hitting the user page and
you don't necessarily have to know
what's going on underneath that the
helper will just pass through the
context to everything that needs it so
this goes into more detail about
streaming is that again when you send an
event play has something called an
iterative and an iterative a sickly says
when we get some data deal with it and
and it's funny because it really is that
simple on the other hand it's so
completely unintuitive that you can give
yourself massive headaches trying to
think about it too much but but once it
has an authority it takes that event and
it uses something called a socket and
hob internally to play not very
well-documented at all I recommend going
out to the wall posts and then play
sends it out through a server side event
or through WebSockets as you choose
sends it to Jason Jason picks it up and
then handles the displaying of it and
the single best application I've found
that actually demonstrates this is
called Delilah and it's guy by a guy
called on a car for
depress I think and I don't know exactly
what sort of an in line he has the guys
at sanic see but he's been picking up on
features and play which would just like
completely undocumented a good six
months of anybody else so if you can
read through a source code if you're
ever stuck that's an excellent way to
know what to do about various strange
things involving real-time web and
forecasting and all of that
there's also vertex which is it tries to
be a Java equivalent to socket IO and I
don't know that much about it except
that they were working on making it be
quite as usable a socket IO but hadn't
quite managed it yet and then we finally
we have everything else according to
play and I don't know where we are in
time a twenty seven excellent so a
couple of things avoid to play logger if
you can possibly help it it's not harder
to hide coded and you can implement your
own and that way you don't have to go
through it directly amongst other things
that has problems when you have
configuration where it ignores what
you're doing and decides to go on as a
merry way metrics it doesn't come with a
metrics application included but there's
one on coda Hales website that you can
use to track everything in more detail
and again because you're using commands
and events and doing queries you can
actually log all those and pass those
into the metrics as well and have much
better fine grained analysis and then
finally testing which is again if you're
looking through something and you're
getting at post requests and you know
that you're going to be sending a
command that makes it really easy to
test if you are getting back an event
and you want to make sure that you're
dealing with it that makes it really
easy to test queries and they're a
little more hassle because the thing is
is that you have to swap out everything
that's actually doing the querying
underneath
the hood and that involves typically a
dependency injection framework which
isn't all that fun and finally load
testing is just the same old as far as I
know there aren't any quick fixes
foreplay applications I don't think that
typesafe console is a bit available to
everybody but I know that J console and
Jamie will tell you just about
everything you need to know if you ramp
it up available and stick it to the J
max alright so that is the broad
overview of CQRS and the play
application framework and I'm seeing a
lot of blank places so how much of that
was actually fun all right question what
would you inject into MongoDB what ABI
API so there's a couple of scholar
drivers that I know of a MongoDB there's
a lot and then there's Kasbah yeah so
salla is a skull um user Scala sig
internally to provide a better type
safety on to MongoDB but as far as I
know they both work and I don't really
have much of a preference I did sign
that sallet was it was more useful in
sort of allowing you to ignore the fact
that I was using Mongo underneath LaHood
felt yeah okay sorry the the question
was so this guy Eric Evans likes to talk
about CQRS in the context of event
sourcing an event sourcing is a a style
of programming that's used in accounting
a lot where all of the transactions are
gone through and you end up with a view
of the model that you're looking at so
you have a user in you change the name
and you change you know like can state
of birth and everything else like that
all of those get written out as events
and then when you're actually looking at
the user it goes through all of those
events and then creates that view from
what was actually written in as events
and that can be extremely helpful when
you're talking about financial
transactions
if you're talking about something which
is just bog-standard user data it's not
necessarily all that much of a win and
it adds a lot of complexity on to your
model and that's why that they're useful
concepts in and of their own right but
they don't have to be conflated so
that's that's mostly where I left it out
it's like yes you can do it but you
don't have to do it okay okay so about
deploying play play is I mean one of the
one of the things that play doesn't do
unfortunately is it doesn't allow you to
package it as a war application and so
you know sending it into a j2ee context
just doesn't make any sense at all
fortunately what you can do is you can
use you can package it using ansible for
example ansible okay so yeah if you
google for like play - and ansible then
you like you can you can there are a
number of people who are trying out
different deployment tricks to actually
push it out to chef or push it through
their deployment network and be able to
deal with it in that basis instead of
having to pass around drawers that file
and write their own shell scripts if
Tomcat six and seven are using a j2e
framework I don't are you saying dad
into Tomcat six and seven I don't think
you can if they're using a j2ee context
because it's actually backed by Nettie
and Nettie is its own completely
asynchronous web server so in that
context you know you'd use you'd use
Tomcat in a situation where you wanted
to offload that and part of the the win
of play is that it completely ignores
the request model and and just dumps it
off the side okay Wow
that that is a really good question so
okay so he's asked if the logging and
metrics are actually done as particular
events themselves
I believe that certainly there are
frameworks available that's and if you
use log back for example that's a that
you sends out a log event and you can
definitely hook that into your own
system however you like if you're using
coda Hills metrics gem thing I
believe that also uses its own version
of events and I know that you can hook
it up to a graphite server and be able
to see requests per second and all of
this other stuff based on the metrics
that come out of it but I don't know the
details of it I'm afraid yes
that that's that's a very good question
and currently you're in the lead so so
play that the routing API is very good
for some things and not so good for
other things in that it's it's very good
for letting you modify each part of it
and then have everything be typesafe
after it and then there are some other
things like if you if you're setting up
a REST API for example the default
routing API can kind of be a pain to set
up because you want to set up different
namespaces you have all these common
verbs and you just have to do it
manually line up the line off the line
there is actually a library called plane
navigator it's by this guy called team
on that actually specifically set up for
doing REST API s so that might be more
to what you want and again if you want
to write your own routing API it gives
you an idea of where to start I I can't
hear that in terms of efficiency
Wow yeah I don't know whether writing
something using a macro would make it
any more efficient in terms of run time
I don't know how much the routing
actually costs on play requests for
examples so it could be that it makes it
ten thousand times more efficient but
it's the only one percent of the
requests and so okay in the back I don't
know that anybody is actually focused on
doing annotations probably because like
whenever people talk about annotations
they talk about it in a Java context and
from what I can tell the trend seems to
be towards using more implicit objects
and doing auto conversion inside of that
scope rather than because you get more
of the type safety whereas if you use an
annotation that's its own thing
completely and it doesn't really mix in
for the rest of the systems quite so
well okay</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>