<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>13 - Services - Part 2: Android Bootcamp Series 2012 | Coder Coacher - Coaching Coders</title><meta content="13 - Services - Part 2: Android Bootcamp Series 2012 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>13 - Services - Part 2: Android Bootcamp Series 2012</b></h2><h5 class="post__date">2012-02-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Q9dk82ux-fA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so as you recall we said you know one of
the main building blocks a pretty common
one was a service right and we use it in
a context of explaining like a music
player so if yeah well you know if you
get a music player you would need a UI
to control the music but you don't want
to own the actual playing of the music
in the UI because the UI could be just
wiped out right it's nine-thirty so you
said that's that's what services are
used for they they appear to run in the
background because they're not visible
but don't confuse it running in a
background with running in separate
thread but we talked about that so if we
do if we look at the life cycle of a
service typically it's much simpler you
basically you create it you started you
run it any destroy you could also
restarted like if you click on start it
just basically calls start again start
again start again right that's what
that's what we like to stop that's what
we have going on tour the end of the day
so um and you know this is the template
for service this is what we implemented
right we basically implement to this so
far I said ignore unbind for the time
being it's used for bound services which
we're not doing right now bound services
have to do with the aidl and binder
which we're going to do to the end of
the class so we're using unbound service
when for that you typically need these
functions these methods on start Hong
Kong create or destroy announced our
command right so that's that's what we
did so to translate that into code we
created it's just a review of what we
did yesterday right so what we did is we
created the Java class so the
significant things were that it extends
service right then we overrode those
three methods from the template right so
on on create on Star Command and on
destroy all right so that's essentially
a service
everything else is now java programming
right it's not that much android
specific exams so when it comes to java
programming we notice that when if i
click on start on create and onstar get
called subsequently just on star gets
called so um create is a good good place
to do something like one time like if
you just want to do one off initialize
Twitter or open up a database or connect
to you know some surveys in like that
right so one of things are good in
oncreate if there's a counterpart to
creating you would do that in ondestroy
right so for example if i open up a
database but i want to shut down a
database i would do the shutdown of the
data before the end of the chance cool
whoa cool so then what we did is we said
ananse don't start comment what we're
going to do is we are going to simply
sweet in this first we just said let's
get Twitter timeline and that posted to
the timeline then we said let's just
print it out so again this is just Java
it may may be weird for some of you who
are new to java but you know this is you
know just a list of statuses where
status is a twitter status object start
this is a pretty common name this is a
for each loop that says for each status
in timeline to this iterates over all
other thing in timeline and and then we
did we put that in a try-catch block
because it's possible that this dies
right this call here we don't really
have a control over lots of things could
go wrong network goes down right so so
what so that's basically that's
basically how that works and then we did
finally we decided let's put this in a
separate wrap so we wrapped it in a
thread new thread public void run closed
it and do star does just
you put something in separate reading
job it's just again just jealous yeah
now why didn't we do this using async
task we talked about tasting task
yesterday as well why not do it using
async task okay frequency um okay sure
sure what do you mean by that oh I wish
you can you can keep running with
reservatrol increasing consequence of
Finnish Turkish the thread yes the
thread destroys itself you have done
business name yes yeah so async task
once it's done it's done that's correct
yeah service keeps on existing although
it's not necessarily running as in doing
much but it is running as in it's in the
running state will be overhead and world
of little floaty yeah yeah um but also
do you guys remember why we introduced
async task before what was broken
yesterday when we introduced async task
I mean we did a thread first right and
then it worked and then we wanted to do
the toast and then we got it broken
right number one which run from
separately right word exactly it async
task get to do with the synchronization
of the UI thread so the main reason why
I'm introduced to say async task is we
wanted to do something on a separate
thread but we also wanted to come back
and update the UI so that coming back
and everything the UI was the reason why
we needed async task to begin with right
so now you know async task great you
know and you know does the time to see
like oh great we need to put something
on a separate thread let's just use
async task right well I mean it's kind
of like letting to use a hammer and then
everything starts looking like a nail
and so it's keep in mind why a synthesis
it was used to to handle UI updates in a
service we don't have you I habits so
there's no real good reason to use async
task right off you usually this is a
slight exception although I told you
guys that service doesn't doesn't have
access to the UI so it doesn't really
update UI there is one thing service can
do and that's toast the service can do a
toast toast is sort of a an exception to
a role because you can do a toast from
from anywhere right like you know
something that's in a background could
be doing a toast over totally different
application the reason why that's okay
is because they are they limited that
length to grow longer short so it's not
like it can be abusive presumably but
that's why it's okay so does this now
make sense what we did okay so um how
would you now do this to keep on running
every soften every 10 seconds or so 10
minutes okay yeah you could put
something you could put to sleep and
look right so you could you could do a
run and you could do around this round
presumably I guess I could live in here
right oops so around these things I
could say while while true right I could
do something like this
and then presumably we sleep here but
the sleep or some delay so I'm basically
what I've done is this this is the new
line leave it so I'm wrapping that that
work that you want to do in a in a in an
infinite loop right
make sense so far so basically this was
the what we had this is the work we had
and we just wrap it in an infinite loop
right now on delay is not defined so I'm
going to define it as a constant I'll
just say final static final int delay
and I'll put like 30 seconds for now hmm
yeah so it's in milliseconds at 30,000
you know or if you want to do it like
this you can say 30 here and then judges
will delay times 10 right thumbs time
stars a knife if you want you know
so far so good things make sense now the
product we asleep and read right
so what we could do is we could surround
it with a try-catch block
okay so a pretty move preferring you're
saying do this add a catch exception
here exactly yeah you could do that just
you basically just do a catch the mother
of all exceptions right like that um
it's it's better to actually do a
specific exceptions because you may do
different things right because here I
could for example say log.e the comma
failed because of network error all
right so now people will know what the
heck went wrong right and here I could
say it's actually not an error per se
but it could be just log D I debug Satan
that I'll say something like you know
interrupted updater
what
so far so good make sense
so we can actually start we can run this
and kind of see what happens that's it
out alright so I'm going to click on run
launching
yeah we clean up my console more menu
start service ok sorry Tran ok so
presumably in 30 seconds it'd be
interesting to see if it runs again I'm
gonna clear this up right so just to see
what happens portugal make that they lie
be different but I think you know 30
seconds is ok there it ran again right
today earth up
and again yeah
suppose I good now what happens if I go
anything looks good right what's got
Vince equipped to go menu stop service
but it keeps on wine wait a minute so if
i go to if i go to phone menu system
settings actually I can do I get to do
system settings you can do the menu
engine manage applications service is
not running yet I mean we're definitely
seeing the data come through but you
don't see it here right we don't have
the service right so we have stopped the
service successfully but the code is
still running right so I guess there's a
I guess you guys are kind of noticing
that there's a double meaning to the
word running and stopped right there's
running as inning in the state will
services in right and then there's
running as in the code is actually
pranking like doing something right and
same for stopped right obviously our
services in a stopped state and
obviously there's code that's running as
part of that stop service so the problem
with our code was I think somebody said
that we're not stopping the thread right
so what we could do is we could create
it thread as actually elsewhere like um
you know there are a couple ways to do
this we could create this thread
elsewhere and then stop this thread or
what I could simply do is I could also
manage it via a simple loop also a sorry
flag so for example if I create to
create a flag and I'm running set it to
false right
then in on start outside to true so
running is true right then supposed to
having this be an infinite loop I could
do I could do running while running
right so that's new that's me that's me
right
for the LP and then what I was doing
ondestroy because we know this gets
called I would simply set running to
false right so basically as this used to
be wild true now it's while running
running is true when you start it and
running is true or false when you stop
it that's it right so let's test that
now
it's a menu start service okay it ran
let's see if it runs again wait 30
seconds and then we're going to test if
it stops because that was missing piece
okay so they're trying again now i'm
going to say many stop service and let's
see if it actually stops so it's about
20 more seconds
yes I think it stopped right not seeing
any more updates
so that's gonna work yeah we're not
blocking on UI thread because we're
doing threaded sleep inside of the new
thread yeah yeah where's your blog we
are spinning off a new thread inside of
that we're sleeping okay now this is
where our little RL utility traceview
comes in handy so just to kind of
demonstrate this remember those lines of
code that you commented out yesterday
and they started to date yesterday I'm
just going to quickly comment it then
just to demonstrate around this and you
can see what happens
and do menu menu start service that
doing something
you
they're so it ran ok so now I'm going to
see many stop service and i'm going to
leave the screen so presumably have it
fall now
so a DB pool / SD SD card / yamba trace
dot right
raceview yonder trace
yeah so you can see how our we don't
have a we don't have async task in this
case but we have a thread this is the
thread that's basically responsible for
doing all the networking stuff right so
you can see that if you go over it it's
all reference to bufferedreader and J
Twitter and so on and so on right so
that's basically what what it does this
is jacob Jason tokenizer and son right
so so that's the separate thread does
that it is pan out
make sense
okay let me take a look it's red ready
to move to something new okay so um so
this is gonna work okay for things that
just need to keep on running are always
on such as updating your twitter status
other thing your email you know things
like that now what if we want it to just
do something one off like for example we
want to refresh our timeline how would
you do that how do you implement refresh
timeline I want to be able to press on a
button like I want to be able to go here
go to my my app right prasanna refresh
button and I would like it to do a
one-off refresh how'd you do that you
could do an async task yes hmm umm hmm
no it's fine I mean it'd be okay yeah
you could do you could do it in async
task this is why it's not you know
there's no right or wrong sort of answer
async task is good but then you would
own it in the UI if I wanted to do
something that I wanna duel down the
line and attach this sort to to
periodically keep doing refreshes the
nascent ask would not be the right
choice but it would be just if it's just
part of the UI so yeah any other ideas I
mean we could do a service and just do a
one off and then like basically started
left running stop it I would like
start/stop a service but this is a lot
of code as you can see like this is sort
of a I mean I can't put this on a single
screen not in large font right it's a
lot it's a lot of code so there's
another kind of service it's called an
intent service right and looks like this
an intentservice basically it's a kind
of services we stand on his end service
right you need to provide the
constructor right you need to provide
don't create on destroyed but then as
opposed to doing the main differences
that is opposed to on Star Command you
provide on handling time man n on
content is owed automatically gonna run
a separate thread and a worker thread so
when you go create a thread do the job
and kill itself off right much easier
yeah just once
access
so let's try to do that let's let's
create a refresh service a new service
so um yeah let's do the service first
then we're going to update the menu so
I'm going to right-click say new class
and for class me I'm gonna pick I'll say
dfresh service and that's it
now inside of the Refresh service what
we're going to do is we're going to do
the we're gonna say extends just like
before you get a sub plus something so
extent intent service organized import
to import intent service yeah then we're
going to let this fix the errors you're
just kind of let the clips do this for
you so you click their fixes one error
you click there fix the other air right
so just add add constructor add and
implemented methods that's a good
question why does this server require a
serious require construction and the
other one doesn't I don't know that's
just how to design it i'm not sure what
the rationale was behind that um but
wanting to notice that's confusing about
this one is that this constructor is not
a constructed as you actually need this
is misleading the constructor that you
actually must implement is the default
constructor is the one without a
parameter so the template is slightly
off I you just yeah just play with it I
mean that's how are ya in bed you're
like why is this their fire failing and
isn't that because that yeah the Eclipse
template just gives you that and but but
you must call super with the name so
usually what I do is you know how I
define my my static final string tag
right
I usually pass that tagging here that's
what I usually there
so you must have a emptier constructor
and you must call a super with nothing
it that's probably all you want
so now if you just want to do one off on
checking off Twitter and you could go
and you could copy paste that code right
defeated yesterday's so list for each
blah blah right
right and it'd be interesting to have on
create a non destroy here more
suggestive we can see that they ran like
so more solid so you have a template not
so much because we really need them so
what I'm going to do is I'm going to
copy my on create right and i'm going to
copy my own destroy
and the only thing other thing that's
missing is twitter twitter very well
anything from pulse and that you don't
need a running on it shouldn't it
shouldn't I believe it as the same thing
you usually do not want to do things in
the constructor that could potentially
fail right that's why usually in Java
doing in it right you would like
Australia object to be easily
constructed then you can utilize it
subsequently but Twitter having said all
that twitter twitter object doesn't
really connect to the net or anything
like that so a chance of its failing or
low it's the cause to Twitter it
actually do all the networking
to walk out and I guess technically we
should put this in a try-catch block
just to be fair
it's one that
I
so what's next what do we do next this
compiles yeah many item is going to be
is in one itunes we need to do but what
else do we need to do to each main
building block once we write the Java
code yeah we need to define it in the
manifesto yeah mm-hmm so just like the
service it is a service just a
specialized panel service so go ahead
update the manifest file yourself first
yeah so we need to update the manifest
file and yeah like I said permissions
are all on the a plow see there are
outside of the application i think but
to add a certain disservice you just
basically just like you did with the
other service so control space service
smooth Doctore rush service that's it
one-liner
so yeah so next you want to add the menu
button refresh so you guys should know
how to do that by now right it's the
same as what you did it did yesterday
twice you need to do two things you need
to update your menu xml file and then
you need to update the processing of the
menu right and that wasn't status
activity I'll give you a second to do
that so one thing was to basically go to
a menu add another item just like you
did before so I'm going to do it like
this I 10 android ID it's going to be at
plus ID and then I can say item refresh
right and then Android title I'm gonna
say oh this isn't allow me to ok so I'm
going to quickly add it yeah title to
browse you I'll say refresh refresh as
well looks like right
so then once you add the that piece of
taxing that ID now you can go back to
your status activity and you can process
it right on options item selected we
already had that you said this gets
called every single time any item gets
pressed right and we have our pretty
extensible switch statement that we can
add another item to easily so i'm going
to say case r dot ID dot and I to me
fresh is there I can then return true
then I say start service for intent you
know make up a new return intent so we
already have intent you know in this one
update or nah it's gonna be the same as
what you have before i'm going to make
written a new intent and just call it
intent re fresh and just change this to
refresh service
right so basically when the service get
started I'll when the button gets
pressed we basically send any time to
start a service and that's it
so if i run this what's that can we
create your intent in the inside of here
yeah yeah oh yeah absolutely as a matter
of fact there should be probably static
five this week this could be status
static final my these could be constant
and you know so that we're not going
every single time you could put it like
this just outside it's all come a little
confusing but well actually we can't
because it's a using of this never mind
never mind I'm gonna undo that choosing
a desk using context there is a
different way and that's to use it based
in action but it's not a big deal okay
so um if i do if i watch what happens so
menu there's may i refresh button
any cash
except today and do anything in maybe
for a casing it did oh yeah okay there
it is
so there there it is on create service
only for service created right on reefer
service candle intent and on reversers
destroyed so basically created it ran it
and destroy it all at once right now
what's also interesting is that if I
actually since i already have tracing
going on in the background if I leave
this screen and if I now pull the trace
file
what you can see is that that's our
refreshed or is there and as you can see
it's running them separate
what's not ideal in our code now okay
keep one super palace for ya too many
card code we have passwords hard coded
love tonight and we have lots of code
repetition lots of copy pasting right
like the Twitter logica Twitter object
we need it in many places right so it
wouldn't it be nice if we kind of
outsourced that somewhere else right so
um okay so that in one place we can do
that is that place that I mentioned
earlier yes on Monday called application
object right so just like we can have a
service activity provider and see where
you can actually have application of it
as well so it may be a good place to
hang with Twitter object off of the
application of you can keep it in there
yeah right because we see not a scholar
we copy paste this code everywhere we
copy paste you know they probably based
here copy pasted here and so on before
we start you're right that username and
password our car product but before you
start changing user name and password
I'd like to not to to make the changes
to the 2d factor this first right
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>