<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Create Elegant Builds at Scale with Gradle | Coder Coacher - Coaching Coders</title><meta content="Create Elegant Builds at Scale with Gradle - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Create Elegant Builds at Scale with Gradle</b></h2><h5 class="post__date">2016-04-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/vnmYcH4LSKk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">thank you yeah welcome to this great
we'll meet up I'm super excited about
creating Lin talk it's it's it's amazing
stuff but I don't want to talk don't
wanna spoil what what John has to show
but it's it's a it's part of the story
elegant build sets scale how do you
maintain the health of your build
infrastructure the health of the
craziness you developers might do with
the build scripts right and that's where
the great Lynn plug-in comes in so
talking about scale yeah so cradled as
an enormous momentum right we had 10.4
million downloads in 2015 that doesn't
include all the android studio android
downloads that is bundled with it's
probably the most popular if you count
across platforms write java android c
c++ probably the most popular build
system in the world by now and but
there's still so much pain in our domain
right the problem we have is that the
colors are somehow screwed when it comes
from backbiting a connection to the
projector so so what is red is green and
anyhow but so this guy is in more pain
with this colors right a green face so
so this is kind of the state of the
average enterprise buildmaster right
that is there is a there's hardly a
company where everyone is saying hey I
built is amazing everything is perfect
developers are so productive that is a
rare thing right there might be a
handful of companies in the world on a
larger scale that can say that and and
even though I still pioneering but yeah
so so and and there are many reasons for
that situation a the scalability is a
big part of the problem and the
situation is getting worse right it's
not like you know there's still some
eyesight laughs and still some breathing
right but not for long right when you're
in that situation right code bases are
crowing software is eating the world
a the movement to a micro service
architecture right in many organizations
is an enormous challenge for the
continuous delivery architecture going
from one of few releasable units too
many independently releasable units the
heterogeneity of the technology stack is
increasing and increasing so so they're
more and more challenges so investing
into the build platform is a question of
survival to you know to be to continue
to be productive right that's a that's
the situation we are in so it's for us
it's the Golden Age of for next
generation build platforms and and one
big problem of that is dependency
management you're smiling and just okay
yes well it's so and there and the funny
thing is I mean we talked about and
write and I also still remember when n
came out and but it's interesting that
the pain we are talking about has been
around for a long time so is fascinating
why it hasn't been solved earlier
there's so many obvious problems right
in our domain and you would think hey
it's 2016 right certain things are so
obvious why is there no easy solution
for that so I will just go through some
of those and and show how we solve that
and yeah so one thing is in dependency
management right a typical problem is a
substitution problem so a dependency
let's say guava is replacing Google
collection right or a company got
acquired and you need to change
basically the name but it's the same
it's the same artifact in a new version
that replaces an older one with the same
name when you do dependency management
with maven or with end Ivy how do you
solve such a problem any ideas lots of
excludes which is a fragile solution
right back it's a shitty solution and so
fragile solution right so so let's look
at a simple example can you can you see
in the last row I wouldn't know
what to do if you say no but for that
clear to you that you can so okay so i
just have here two arbitrary libraries
jason taubman why on why amok not very
famous but that doesn't matter in this
context and I now ask cradle hey show me
the dependencies right including the
transitive graph are for for my compiler
dependencies and what you can see is you
have to Jason token dependencies and
Jason token has a dependency on Google
collections right and then you have y
amok and why amok has a dependency on
guava right so many have exactly that
specific problem right so so what you
can out do with Gradle you can simply
say hey Google collections is replaced
by guava and then after you say that
oops Maestas not nothing after you say
that you see now in the Creator
dependencies report it tells ok Google I
don't I no longer use google collections
for the JSON token dependency i use
google guava so with a simple statement
right you can express that fact as a
dependence that a dependency is replaced
by another one and then we we then we
replace it in the whole transitive graph
so when you now do the following right
when you remove the wire knock
dependency right then you do the
dependency report again and now you can
see Jason token has a Gainey dependency
on Google collections that's something
that wouldn't work with excludes right
so you always have to keep that in mind
oh now when you remove the first level
you depend now on the transitive graph
of another dependency that your other
dependency is working that is and that
is all that is a big part of the
scalability problem deal
with your large Java library classpath
right and and you need to have straight
forward and st. solutions to do so and
that is a simple problem with a way with
other build system there is no
reasonable solution of course what is
important to understand in those demos
right what you can see is that is now in
an actual build script code usually
those rules would live in an enterprise
plug-in that is automatically consumed
by all your cradle builds so I develop I
wouldn't need to specify that in the
perfect world that information would be
in the metadata let's say in the XML
metadata in maven central right we would
have richer metadata descriptions and
the people that produce guava can say
hey we replace Google collections or
Google collections can modify the
metadata and say we are replaced by
goodbye guava right then you wouldn't
need to specify you know yourself but
for the time being it's much better that
you can specify it considering that the
metadata in the Java repositories is not
rich enough to tell you that this is the
case right so that's one example the
other thing is working with dynamic
dependencies right that is a sum that
the day that has a lot of challenges for
organizations right and who have used
using something like maven snapshots or
some form of dynamic dependencies so
what we do in this example we say hey we
have a dependency on the latest version
of hibernate validator right so and if
we now we now look at the dependency
report and look at the graph you can see
okay the latest version of hibernate
valid data in the repository that we are
connecting two is five to 20 better one
okay what you can do now with Gradle you
can now filter which of the latest
viewer
you want to have so you can you can
provide us with a resolution strategy
and say for the dependencies of type
hibernate valid data right I want to
define a selection criteria and every
dependency that contains the term alpha
or better should be rejected right so
our and after you specify such a rule
you see what is now picked is 513 final
right that is the latest one that
fulfills the selection criteria so you
can run a an info mode and then the
console output will tell you exactly
that those two dependencies better 1 and
alpha 1 where candidates but we're
rejected because of a of this rule right
so you can specify those rules not just
for particular dependencies you can say
that is the rule for all the
dependencies for all the dependencies
that that belong to to my company right
and then the output will be the same 513
final in this case
so you can also say you can also plaque
less dependency with that mechanism you
can say hey 513 final is known as a bad
version has a back that doesn't work in
our corporate corporate environment so
you can say we want to reject that
version because it's known that version
right and then 512 final is the one that
is selected yeah if we run in info mode
you can again see there are now three
candidates that we're rejected for
different reasons you the selection
criteria are powerful it's not just the
name and the diversion it's the prawns
from which you build it if you want it's
the metadata status is it is it some
milestone or deaf or QA release right so
it's a very powerful language you can
have and what is important to understand
is a depending on where you're building
you can inject different selection rules
so for developers you can inject the
rules whatever is the latest you get the
latest right and then for QA you can say
a for the QA built we will never take
anything with alpha or beta so you now
can get in dynamic dependencies
depending on the environment you're
building right and that is something
that was always missing when you were
using maven snapshots right what's just
give me the latest right but you could
not specify additional criterias and
Gradle provides you with that another
big scalability capability for people
for organizations that use dynamic
versions okay so another thing I would
skip the example for that because i want
to show something else what you can also
elegantly do with grail is when you have
a large mighty module build let's say
three four five hundred modules right
and your developers don't want to check
the whole source tree out right you can
easily have a setup
that developers can check out only ten
modules of that build and then cradle
automatically replaces the other
potential dependencies those modules
have on the other modules that are not
checked out with external dependencies
and gets that from a repository so
that's what we call fluent dependencies
what I want to show you and this is a
live demo d other demos are pre-recorded
it's the latest feature we having
greater we call composite builds right
so I want to show you a little example
so this is a this is a sample project
and it has three independent so this is
not one mighty module build those are
three independent Gradle builds you can
see project B has a setting start Gradle
right and has sub modules p1 and p2
project see has the own settings dot
Gradle and project a in the sample stay
they live close together they could live
wherever on the machine those are three
independent cradle builds right you can
execute them independently and when you
and when you look at the dependencies I
make this a little bit bigger when you
look at the dependencies you see project
a right has a dependency an external
dependency on be 110 NP 2 10 and those
are the dependencies that are built in
the project be in a sub-module b2 and b1
and b2 okay so what you can do now is uh
you can now have an an additional built
it's called a composite build where you
say i wanna i wanna i want to build a
project a B and C together I want to
aggregate independent greater builds
right so uh and and then now so let's
let's do this you can say created show
dependencies this is now when a
composite build is not in action and you
can see project a
hazard external dependency on B 1 and B
2 and B 2 has an external dependency on
project see okay so it's a brand new
feature so we have a teacher feature
toggle to switch that on its dash p
integrated and what you can see now now
composite builds is activated and cradle
sees oh this dependency is actually
replaced by project bb2 does this make
sense right because we see this is this
is now another cradle built that you
have checked out locally and greater
just checks okay project a B and C are
now aggregated and every dependency
those projects have between each other
that I declared as external dependencies
are no exploit with it replaced with
project dependencies so you can now
aggregate any cradle build you want
right and together and execute them
together and then the output of the
build is taken versus the external
dependency so imagine a scenario that
usually you work on project a and you
and you always take the released version
from project be but now you have to do
some complex refactoring within a and B
at the same time now you just say I
check out project B Tara cradle treat
them as a composite build and then
Creator will automatically always take
the latest from B instead of using the
external dependency and I meant many
other reasons why this is a cool feature
right so this is also supported with our
IDE integration so from next week
onwards when you import project when you
import projects into eclipse right the
Creator will realize oh even if project
a has an external dependency on project
be if project B is imported into eclipse
they will be treated as an eclipse
project dependency and you can reflect
that and together and IntelliJ will
follow soon so I'm super excited about
that uh and i think you as well so we
worked on together on some of that stuff
and then the next step 4
for composite builds I mean we still
have to do a work to make it fully
polished but the next step is that you
then can have composites that live on
different machines so that's when we're
getting into remote builds with Gradle
so I'm super thrilled about that anyhow
let's continue yeah regarding dependency
management there they are there are
amazing additional community plug up
plugins out there so Netflix contributed
really cool one so for example the
dependency locking plugin when you use
dynamic dependencies that you can always
lock the last state of the resolution
and put that in version control and you
can always reproduce build they are
plagued list and whitelist plugins out
there are a lot of Kublai plugins out
there that that that add additional high
level feature around greater dependency
management that metaphor the enterprise
right so for example I think the black
and white list plug-in you can you can
specify on a server right in adjacent
file all your black and white list rules
right and then they are shared across
the whole enterprise right and you can
say hey warn these people if they use
that version or let the built fail if
they use that version that is all what
matters when you do dependency
management at scale one feature are many
people are not aware of it's one of my
favorite features in Gradle is the
continuous mode will show you a little
example who is aware of the greater
continuous mode so okay so that so check
out this example so here we have a the
cradle we're not building any Java we
have we have a little ascii dr. project
right who knows ask a doctor it's a
markup language that is a yeah more
powerful than then mark down but not so
heavyweight as doc broke so I think
Riley is has fully switched to ask your
doctor it's it's it's very cool format
whenever you write something a little
bit more complex right and so and we
have here an ASCII dr. project right and
a doc is the ask you dr. mark up file a
and it's it's a manual for for some for
some java project and now we take Radel
hey transform the ask your doctor mug up
file into well now first first we look
at the ask your doctor markup file that
you get an idea how this looks like
right and you see a this is an ask your
doctor mock-up file right and you know
we now tell Gradle to transform that
into HTML
so we open now the transformed HTML page
and that is how it looks like okay so
now we change to ask your doctor backup
file let's do something exciting we go
back to the command line rebuild the
ASCII doctor HTML generated HTML page we
go back to the HTML page and you see ya
the page has not changed that was not
the exciting bit no worries so what we
do now is when we now tell Gradle hey
run the ASCII doctor task in continuous
mode and that is when creator turns into
a local build server so you see cradle
is now waiting for changes to input
files of the ask your doctor task and
the cool thing is because cradle has a
rich input and output model not not like
with other watch plugins you don't need
to specify any fire patterns or whatnot
you just say run this task in continuous
mode and greater than automatically
knows which which inputs to watch you
don't need to tell this to cradle you
can even do this in a mighty module
built when you have 500 sub modules you
can go on the root project and say
create a compile dash dash continues
right and it will watch all the 500 sub
modules and when rebuilt in with any of
those changes right so so let's see how
this works so we change this now right
and we click Save and now we don't need
to do anything we just need to refresh
the browser and cradle automatically
right has rebuilt that continues mode
introduced with greater 25 so let's do
it one more time we click Save and
without calling cradle we just refresh
the browser and you see this has this
has been rebuilt and if you go to the
command line you see change detected
executing built one time and change
detected
executing build another time and we
added one more cool feature to that
capability so I think into 10 so what
happens if you do a change in this ask a
doctor fire right and then it takes
let's say 20 seconds to build and within
those 20 seconds you do another change
to the source file in version 25 this
change was then ignored right in the
latest Gradle version we now continue to
watch to file changes so even my cradle
is rebuilding the next the next HTML a
generated version of your file and you
do further changes we keep them in the
queue and once Gradle is done with with
building the new HTML page we greater
knows oh there are further changes and
automatically rebuilds again right so
it's now really like a local build
server ID so it's a and you can use this
for many you know when you do web
development it's it's a really cool
feature it works with every task okay so
yeah who views using eclipse just get an
idea okay so really good Eclipse support
for Gradle but intelligence report is
also getting better and better so you're
served well on both IDEs performance is
obviously a very important aspect of
scalability not the only one we have
seen other ones but it's a very
important one so if you if you want to
have the fastest gradable use the
fastest the latest cradle version so we
did we did some significant improvements
in 213 and there are more performance
improvements to come so you can you can
expect pretty dramatic improvement when
it comes to configuration time over the
next one or two greater releases right
so that's one area we're working on
heavily and there are also many other
areas in performance is for as a
constant stream where a few people were
consoles so there's there's a lot to
come to make Radel builds faster and
faster and faster so one other thing
we're working on is demon stability
right so using greater without the demon
is as much slower experience
at the same time we have we see problems
that people use custom extensions with
the demon or use some external plugins
that are leaking somehow right and are
making the demon in stable unstable and
yeah I think next Monday yeah when is
213 going to be released next Monday the
release candidate one is out so what we
are working on for the demon is some
auto health checking right that we
realize hey we're getting memories
getting a scanning scars and we need to
automatically restart a demon and things
like that so we want to make the demon
rocks table right even even if it's used
with extensions that are kind of
polluting it right at least you pay a
performance penalty when a demon gets
restarted but at least your build is not
stuck the other thing we have started to
work on is the distributed cache so
basically that any build output can be
shared with a with any developer right
and yeah that is a key feature most
importantly 44 c c++ and native builds
but but but for scala obviously as well
and also for java it will give a really
nice performance boost to two or at
least two larger projects so we're super
excited about that distributive builds
in the context of composite builds it's
something we're going to start to work
on in the second half of this year the
other thing we are super excited about
is cradle calm so if you want to learn
more about SS offering we are going to
provide to all Gradle users go to cradle
or calm and check that out it's a it's a
capability that you can connect any
cradle bill right with with the SAS
service and it collects metadata from
the build and it can gives you inside of
how you know what happened during the
build execution we're building in
analytics functionality that you can see
how's your built and certain problems
evolving over time so there's there's a
lot to come there so if you're using
cradle in a serious way check check is
offering out if people that are
interested in
getting started with Gradle or if you
just getting started with greater there
is a really good Udacity class out there
it's free it's it's amazingly produced
super high quality greater for android
and Java excellent course right we did
that in collaboration with Google when I
did the screenshot it was 2700 student
it's now 16,000 student it's one of the
very popular Udacity classes so if you
want to look at deeper into Gradle
cradle in of as a really really good
instructor led training online classes
delivered by cradle core engineers so
it'sit's knowledge on the highest level
a very much to recommend right and yeah
that's it thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>