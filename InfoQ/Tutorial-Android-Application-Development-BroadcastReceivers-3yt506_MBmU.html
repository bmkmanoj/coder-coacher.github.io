<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Tutorial: Android Application Development - BroadcastReceivers | Coder Coacher - Coaching Coders</title><meta content="Tutorial: Android Application Development - BroadcastReceivers - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Tutorial: Android Application Development - BroadcastReceivers</b></h2><h5 class="post__date">2011-04-15</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/3yt506_MBmU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so one thing we wanted to do is I'm
gonna introduce you guys to broadcast
receivers we talked about that you know
when we talked about the main building
blocks so what I would like to do is if
you remember what the broadcast receiver
is is a way to subscribe for certain
events so basically you're saying when
something happens right notify me okay
that's what the broadcast receiver is
it's pretty straightforward right got it
when something happens to you get a
notification okay
so where do we want to use this in our
example so one place if I have it here
is to start our update or service on
boot right so basically I want to have a
broadcast receiver which subscribes to a
system notification which says system
got booted so that when system cut gets
booted we simply start our service in
other words that ensures that our
service is always on always running you
don't have to mentally remember and go
and start it the system is sending a
broadcast in waking up boot receiver
saying hey you wanted to know when I get
booted on this just happened now this
guy is gonna start the updater service
is that does it make sense yeah sure but
yeah if there's not yet but it's a
publish/subscribe it's like it's like
telling your broker yeah if this talk
hits that cell or you know telling your
own real estate broker if you see a nice
you know three-bedroom two-bathroom
house in my neighborhood for sale let me
know
so keep subscribing for some certainly
done that event may never happen all
right
and you may be doing zillion other
things you just get woken up you get a
phone call when when when it actually
does happen right that does that kind of
make sense oh cool so we're gonna start
with this one because it's very
straightforward so we're going to create
a boot receive or receiver that gets
woken up at boot so first we're going to
define it later on we're gonna register
it okay so to do that close all this so
to do that just like before to create to
create a new broadcast receiver we start
the new Java file right so I'm gonna
right click new class right and I will
say boot receiver right so that's all I
entered does the name of the class
booter 0 yes if you want yeah absolutely
it could so you could just type it in
here and all that I try not to depend
too much on the tools so other than for
some yeah especially not the dialog
boxes I like Taurus when it's a self
completion and stuff but either way
whatever either way will work so I'll
right here extends broadcast receiver
yeah organized imports and then add
unimplemented methods bam bam bam
so that really created my little basic
template for the file so we now just
have a basic you know broadcast receiver
template
so far so good
yeah yeah
so publish it as pops pops up is a pop
it's it's a quarter kind of like a
pattern right so so this guy is
subscribing it's saying I want to know
when something happens like you know
houses for sale
stock is hidden certain thing booty's
completed battery's running low whatever
that something that you want to know is
so you're subscribing to that event when
that event happens if in one of the
event happens you get a public you get
published right it's kind of like you
subscribe to a magazine and somebody
publishes it right so that's a yes there
is a new feature in Android since Freud
and it's called cloud to device
messaging so there is a way to have a
app server something via cloud send a
message to the device no this is good
this is a Google app server yes yes so
this is this is Google is managing this
it's a good question about the push so
if you look at our algorithm here like
how we did this we did the pour here
okay so what that means is that we're
gonna be like every minute two minutes
five minutes whatever that is we're
gonna be asking for tweets and we're
gonna be getting all 20 and dresses are
did like all 20 are gonna be your iPad
iPad so you know you may get like five
six new ones a day but you have what
3,600 minutes in a day or something
right or whatever number is so you're
gonna yeah are you gonna make so many
calls and waste so much bandwidth and
power and all that stuff so in other
words Paul is very inefficient it would
be much more efficient if we could say
Hey online service let us know when
there's a new tweet and you only get
notified when there's something
meaningful as opposed to you saying is
this the new no is there something you
know is there something new no right so
that's really inefficient unfortunately
we don't have a pub sub mechanism with a
cloud as of right now
well the way so on Android does cab push
mechanism but again we need to be with
something that supports it
so Gmail gtalk all those things
effectively work like a push right
they're actually implemented there is a
mini pool because they there is a
certain like something that thinks the
server every once in a while but but
it's essentially looks like a push right
yeah but in our case we're not we don't
have that feature so we can't really do
it that way so unfortunately so back to
this guy so we have now so this is the
receiver and this is how it's gonna get
woken up so when the event happens what
tablet event is Right regardless of the
event this is every single but broadcast
receiver looks like it wakes up right so
this is like a template copy-paste it
for every single receiver you're done
right okay so now what's gonna be the
one line line of code that we're
actually gonna do it here yeah so we're
simply gonna do C now if I do if I try
to do start service that metal doesn't
exist right because it hangs off of a
context here's how it's slightly
different in in services and activities
which are also main building blocks they
were subclasses of context in other
words service activity is a
context rate Boutrous a broadcast
receiver Gaza context so in slightly
different context is passed to it it in
itself is not a direct child off but
regardless it's God it's readily
available so the only difference is that
we know you have to say context dot
start service and then I need to create
a new intent so this is the part where
we do we do what we do when we are
notified exactly yes somewhere else
we're gonna register yes and then up
you know this will this would work right
in essentially this is a one line of
code that's it now because we don't know
if you want to know if this actually
worked would be useful to actually log
it so that's why sometimes gap you know
usually do log D just I know for my own
purposes let this work so I would say a
lot of D on that organism ports and
that's it so it's second line of code is
just so I know it actually worked but
it's not absolutely necessary no I mean
I'm not gonna have too much stuff going
on so you know yeah right now I wanted
to kind of show you how simple this is
right can any other application setup
broadcast yes and we will be sending our
own broadcast as well yes yeah broadcast
can be there are lots of different
broadcasts yes and and they come in a
form of an intent so we're gonna see
that in a second so should we're done
now with this guy where I've totally
done there's nothing else to do with the
booty receiver but so we now have what
happens when it wakes up right so back
to boot receivers so we have this part
what happens when it wakes up so this is
done but now we need to tell it for what
we want to register how what you want to
subscribe for so what do we do when we
ever when whenever we define one of the
new building blocks what do we do next
exactly
so we go to the manifest file and we add
it to the manifest file so this menu so
the manifest file Bam Bam and then in
here we're gonna register
right so I can just say I'll go up right
here I can just type receiver right
Android named oops
yeah it's called receiver and it's gonna
be dog food receiver so point to the
class yeah so so we now have it in the
manifest file
so use control space that can help you
complete stuff faster that's three clips
just names it like that it knows that
it's a number project but it really
truly is an Android manifest XML file
yeah so it clips gives you like kind of
like a methane meta meta name for it
so now we can register did but we
haven't said what it's going to be
notified for right we haven't subscribed
for a specific action so the way you
subscribe for a specific action is by
creating a filter for that action in
other words actions are intense
okay so we're filtering for intense
using something called an intent filter
so sort of like the system is
broadcasting like this you know crazy
amount of intense all the time and you
just say what you want to filter for
right so what we're gonna do is we're
gonna go in here within the receiver and
we're now gonna add an intent filter
okay and within an intent filter we're
gonna define an action okay with a name
of something and then control shift F
just to reformat that to look
presentable right so it's more
manageable to understand okay so in you
know notice that this looks very
familiar to what we had in here in
timeline activity right does it make
sense
remember in timeline activity I told you
if you wanna make this activity be the
one that gets launched all you have to
do is move make it this right and I said
don't worry about that too much okay so
now we're gonna kind of worry about that
so I'll explain what that is but
basically this is an intent filter
that's basically specifying the intent
that that we're filtering for in this
case we're filtering for an intent
called action main and category launcher
so this category launcher means make
this particular activity be the one that
is in the launch and in the launch pad
what do you call it the drawer you know
the little thing that pops up so if I
look at this so so the fact that
in this launcher right is the fact that
we put it inside as the category
launcher right and the exactly and the
fact that this this one is the main one
in other words it's the main entry point
it's the homepage
yeah that's but this is the filter this
action right it's pretty straightforward
so now so that's why we here we have
good receiver but we're saying trigger
this boot receiver for a specific action
that we're gonna filter for that's what
this says okay so now the biggest
question is what the heck is that action
that we're filtering for okay and what
do you find this documentation how do I
know what's being sent broadcasted when
it's a system booted a song so the best
documentation for this is sort of to go
to your to your developer sorry to your
developer.android.com/design during
tenth and some of those intents are
actually listed here as is constants so
what I usually do is I would just go
ctrl F and I would search for something
to just go with boot right for example
and I found this one that says action
boot completed so I'm gonna click on
that one BAM
again this has broadcast action this is
broadcast this is broadcast once after
resist after the system has finished
booting it can be used to perform
application specific initialization such
as installing alarms cetera you must
hold it is received boot completed
permission in order to receive this
broadcast so so a couple of things so
first of all this is a Java constant it
doesn't mean much to us in XML so we
actually are need the actual constant
value which is this value here okay so
you're gonna ctrl C to copy it right and
then in here I'm just gonna control V
paste it
okay so it needs to be a the actual
value of the constant not not a constant
itself right right so see that's so this
is the first thing second thing that's
important is it says in the
documentation you must hold a specific
permission to receive this broadcast so
here's the thing unlike before I said oh
yeah just start something and if it
doesn't work you know if you don't have
the permission since gonna die and
that's the fastest way to know you don't
have a permission remember remember with
dinner in Internet right so don't even
think about like what you're missing
just run with it
let it die look a look at your logcat
then copy paste from your lock yet the
permission that you need that's the yeah
exactly so the problem here is that you
don't know what you don't need to know
okay nobody knocks at your door and says
hey by the way there's something for you
but you can't get it it doesn't work
that way right it's on a need-to-know
basis if you don't need to know you
don't know that you don't need to know
right exactly so so be careful about
this stuff because I sometimes be
mentally I'd be like oh it's iboot
complete like why am I not getting a
notification I'm listening for something
that doesn't exist which never happens
so I don't know the time listening for
something that it's one of those things
right so be mindful of that so you know
you know those are some hard to find
there are sometimes so I need to now add
that permission sub and again I'm gonna
click on the permission and again I need
to specify not the permission constant
but the actual constant value of that
permission right so copy phase that you
could also use eclipse you know produce
permissions and kind of go and add it
this way right and then use that but I'm
gonna do it manually so I'm just gonna
say and under permissions I'm gonna say
control space use this permission
control spit this is why it doesn't work
Android named BAM and that's it right so
receive
would completely so basically this is
required for this to ever happen right
for that for that filter to ever be
triggered
so they go hand in hand right that's the
ticks
so far so good okay so what I'm gonna do
is I'm gonna save this I'm gonna run it
to just reinstall my app because they
need to install the newly updated apk on
to the emulator right
and it's installed the newly updated apk
or to the emulator okay so 9:00 I assume
now that its installed I'm gonna this is
the one time I actually am gonna kill
the emulator so it's been about five
days it's about time to restart the
emulator right so I just shut it down
right and now I'm gonna start it but I'm
gonna starting not by running the
application I want to start it without
running the application right it just
equivalent of user just turned on the
phone right because if I click on here
it's gonna start the emulator and start
my application don't want that that's
not a fair affair I check right so I'm
just gonna go and start my emulator
right I'm not gonna wipe the user data
this time around so I'm gonna let it
start so my not gonna be running but I
wanna see if the if the service is gonna
get started
that's starting okay so my amulet is
started you can barely you know if I
click on uh if I click on this home
button you can see that there's no
recent applications right so it's not
like I ran Yamba yet right
however if I go to if I go to menu
settings and then click applications in
the near running services voila
there's Yamba updater service running
for 34 seconds now 35 it's on okay so we
know it's running right as a matter of
fact what I can do is I can also do
exactly I can do adb Sigma see a
headlock yet running here it adb logcat
gives me too much information but what I
can do is I can do it remember how to
filter it adb logcat and then boot
receiver column and then comes the
silent bam so we know that dad got
indeed it locked yes
so we know the dollars boot receiver
walk up and do this job and died right
so that's kind of how you can verify
that that actually indeed happened
so yes if something didn't start just
make sure that you are listening to the
right did you register for the right
notification right right action and that
you have the right permissions that's
usually the common you know mistake yes
you should be C able to see it in
services okay I see them here so I
haven't even started my app yet right
and this is cranking in the background
and now let's test if I actually go to
my if I start my my up in other words I
study activity let's see what the menu
says menu see this button is proper cuz
we walked into it while something asked
is started it
the see how we kept like this loosely
coupled stuff right activity was totally
loosely coupled to the service but
something else not in service and you
know and so on but they do share certain
data
you gotta install your app first and
then reboot so no I did on the boot
receiver actually created a new intent
as well yes but this intent a good point
so this intent is the intent that walk
up the boot receiver so it's gonna be
the intent it says action boot complete
but that it's going to be a broadcast
intent it's it's different Intendant
what we are going to do next so this is
what woke us up this is in case you have
a the same you could have one receiver
be listening to Sicilian other things
that like it could be like network or
network going up and down
I could be listening for that I Saturday
Saturday
so that is important so so so while
guests are waiting for that Saudi I want
to be in what would be really nice would
be to ask a user if they really truly
want is to happen or not right all the
time so how would I do that no I just
you know what I'm thinking is
preferences you know so in yeah exactly
so what I would this is this an
opportunity to add a different type of
preference here because we now have
infrastructure so I can just add a
checkbox preference
so key is gonna be you know start at
boot
oops started boot right title is gonna
be new title title start at good start
at good and I can say summary and view
summary yeah and that's if you want to
have a different text work for on off
versions somewhere started good should
updater should save this start at good
dams and like that oops
happens when you type too fast
where's me summary summary stunning good
okay so I now have a new preference and
what I can do is I can now in my boot
receiver get Yamba so hold on yet
the context dot get application
so we're gonna do is we're gonna do
context dot to get shared preferences
for our name should start to good right
and the mode is gonna be let me see what
the mode you see what the mode is I'm
not sure some more this of you zero for
default or durable desired preference
file uh-huh
no this not you don't want this we want
to get default shared preferences right
people share preferences for the context
yeah so this is gonna get us props for
the context this is gonna get us the
crafts right in share preferences right
share preferences with this organism
ports traps right and now we can say
tribes dot get boolean and then the
string is gonna be whatever we named it
here which is started put just gotta get
it right right string so started boot
default value false so I'm gonna say you
know I started what was it was the key
yeah I started good was the key
what's that yes I do so it's a string
the key is a string started good yeah
yeah the same same what we've been doing
to get username password and server so
preferences get bullying started boot
by default it's false you know so should
we start it good good so that's now just
a little bit more you know tracking user
preference right
just sir if you know so if we have a
little bit of a debug information
understanding the Cap'n's only this only
runs once so don't really care too much
about the efficiency of this piece of
code
really it's not it's inefficient but at
the same time it only happens one system
is good
so if I run this now I should have a
little love checkbox in my app it allows
me to configure that right so young but
starting menu preferences and there's a
little checkbox right
cool everyone happy with that so what
we've done so far is we've done a one
type of in Proteus receiver so it's this
type that we registered with the system
in event I attended rate to do something
here okay
so I want to do a totally different type
of a receiver so this receiver is
different time line receiver it's
different couple ways it's only it's
programmatically registered so not
statically it's programmatically
registered to exists only during the
existence of time line and it also
listens to our notifications that we
have to send as opposed to system
notifications so two main differences
right so a couple so again it is it is
only its existence is only during the
existence of lifetime or for time line
this exists forever
okay this listens to system and this
places to our notifications okay so what
is so here's the problem that we're
trying to solve if I go to my timeline
activity if there is a new timeline and
I'm sitting on this page I don't know
that and this page is not gonna refresh
right so status activity may know that
but I'm not gonna know that okay
so like you know if I'm sitting here and
I manually go into the learning Android
status net I post something testing
timeline line okay obviously there's a
new something right so it's right here
testing time line now look it knows my
location obviously California right
right so we're gonna work on that next
so it knows that now if I start my
service so let me show you the adb
logcat first
around the normal lady below yet right
so if I start a service which may
because I already be running it's not
okay so I'm gonna start a service okay
obviously there's the new information
testing time line obviously it's it's
inserted into my database I can test
that as well but this guy doesn't know
nobody told it now if I leave the screen
and come back it's gonna possibly know
but it'd be interesting if it actually
popped up right here right now right
make sense so for that time again are
you're gonna use publish/subscribe I'm
going to subscribe timeline to that
notification know what we're gonna do is
we're gonna have this guy send a
broadcast so you're gonna also learn how
to send a broadcast okay it's gonna say
broadcast to the world it's gonna say to
the cloud to the airport operational on
a vendor it's gonna say hey there's a
new tweet these guys gonna get notified
and then it's going to do something
internal to Timeline yeah we're gonna
build it some kind of logic here yes yep
so let's start by defining what happens
when this guy wakes up but then we're
gonna worry about updating this guy so
we're gonna get in that order so we're
gonna create timeline activity now
timeline activity in this timeline
receiver in this case unlike this
receiver it's really only very specific
to this guy okay it only it's got
intimate knowledge of timeline right so
as such I'm gonna put it inside of the
timeline class right so it's gonna be an
inner class so I'm going to open up the
timeline activity and just at the bottom
just gonna create a new class so I'll
say I'll put an open some time line
savor wakes up when there's a new status
right so it's going to be I can make it
private or I can just make it a class
class timeline receiver extends
broadcast receiver so so far the same as
what we've done before right organized
imports and then add and implemented
methods and then implement methods and
then there is our own receive okay so
far so good so on receive is gonna get
woken up when the when basically there's
something of interest right we're gonna
have to deal with that logic next but
what happens when it wakes up remember
our job was to help this guy just to be
refreshed right and we already know how
to do that we have the one liner it's
called cursor dot re-query bad right so
we we refresh the list once there's new
status that's all it does BAM just put
it fresh is the list
oops oh okay so that so that we're done
with this now so we know we have the
second part you know if you look at the
broadcast receiver we've done what
happens when it's woken up we're done
with that now we have to register it all
right in this case it's not Android
system
well kinase but we're registering it
dynamically and the reason why we're
registering you dynamically is because
because it does it make sense for this
guy to be registered when we are not on
timeline it doesn't write it only needs
to refresh if we are looking at it right
like what's the point of refreshing
something if this application is dead
not even exactly yeah it wouldn't it
wouldn't be the context exactly so what
we're gonna do is we're we're gonna read
then you don't know how to register it
but where would you do it to register
right so if you look at it if you look
at the life cycle activity so we keep
coming back to this we would like it to
exist during this thing right so it's
only registered while timeline is in
this state which means we can register
it in on resume in unregistered written
on pause got it
so if you want something to on exist
during running you do it in on resume
and you undo it and on pause make sense
so here's what we're gonna do so we're
gonna define those two methods inside of
a timeline so back to timeline we
already have on resume and on pause we
do have on resume okay and so I'm gonna
define on pause here source already have
implement methods
and from activity I'm gonna add on pause
okay so so what I'm gonna do I don't
need this anymore by the way because
we're gonna obsolete it so we just can't
empty onresume and onpause so this is a
good place to to you know so register
receiver so they're just their time line
is here and this is gonna be on register
what's that yeah we did I removed it
because we now we're also eating it we
don't need it anymore because now it's
gonna be much it's gonna be better this
way
so what I need to do is I need to
register time at this receiver and
unregistered list is here right so so
because so this guy so there's a it's a
publish/subscribe maker right so you get
to subscribe to something you get to
subscribe to something and get notified
when something happens good
exactly it's kind of like do you need to
be subscribed all the time right so good
receivers were subscribed all the time
when statically it's written in the
manifest file it's part of you know it's
whenever system boots do something
sometimes you wanna and as opposed to
being subscribed forever you only want
to subscribe for a certain amount of
time so it's kind of like when I'm in
town you know let me know if there's
something good playing in the theater
but don't tell me from out of town I
don't care so similarly since the job of
a job of timeline receiver is to update
timeline it only makes sense to do that
while the user is looking at the
timeline right
while user is working at the time
right which in other words is time line
is in a running State yeah you can do
you guys get to cast this net Hawaii
however you why do you want you can say
as long as it's in memory I'm gonna do
it okay so this is a big net right I
don't care where you register on
register it's up to you to pick your
point a point B right I'm just saying
right now I'm choosing this running so
you get so let's let's get let's get
something straight boot receiver does
not run it's it's dormant and until it's
registered so you register it but it's
it's dormant there's no code actually
executing until something wakes it up
until it gets this mystical phone calls
as BAM you're on right that's when it
wakes up and then it's when it's that's
when it runs okay that's that's the boot
receiver it's a one type of a component
okay now another type of a component is
a service service is running as long as
you don't stop it so it's in a running
State there's a state called running now
the fact that it's in a running state
doesn't necessarily mean the
it's doing much right just like an
activity it could be running
quote-unquote running capital are
running state right but it's sitting
it could be just sitting here it could
be just sitting here and doing nothing
except being in your face right
similarly on the flip side of the story
it could also be quota quad stocked I in
a stop state yet it could be consuming
resources that's for example that's
exactly what we don't want to do in this
case do I want if I register if I
register receiver here in unregistered
here unregistered it here then is it
gonna be updating it at the timeline
even minutes in a stop state yes it will
because it's active between these points
right but that's not what I want that's
why I want it to be registered here and
now register there so only happens
within this block right does that not
make sense you guys well okay so so
that's why I am and this is a pretty
common thing I am - registering
something here I'm registering something
here okay so I'm gonna just define
globally my receiver so I'll say
timeline timeline receiver receiver just
right define it globally right and then
in my register I'm gonna first of all if
I don't have it so if type receiver is
now is now I need to generate it right
I'm gonna say receiver is new timeline
receiver
I am inside of my time on activity
receivers don't have only zoom on pause
activity do remember this is the picture
yes so these two different components
receiver is the component that's going
to wake up it's gonna wake up it's gonna
do something that is one job okay that
job is in the receiver which is here
okay that's it it's a tiny little just
like we did like couple minutes ago with
a boot receiver it's got the name it
extends broadcast receiver and it's got
on receive and it does one little thing
Kirstin cursory query that's it okay now
forget about that that is the job that's
gonna happen that that's that once you
know it's walking up that's what it's
gonna do now I'm more worried about how
to wake it up how to trigger it right
and so what we're gonna do is to trigger
it is in onresume and onpause right of
time activity so timeless time line
activity time line activity is
registering says look hey let me know
when there's something new so in this
guy lets it know right but it only
exists in the context of timelined
activities so as such i want to use time
and activity life cycle so that ii tony
is registered while timeline is on the
screen i it's running i it's you know
mean user's face so so now that you know
this is just blue lazily initialize it
to make sure that we have a receiver so
once they have a receiver I'm gonna say
I'm gonna say control space register
receiver okay a receiver and now I need
to provide a filter okay so what I'm
doing here is essentially the same what
we did building it in XML we said the
register receiver for this filter okay
but this is in XML we said register
receiver good receiver
or this filter okay in Java I do it
slightly differently I get to specify
the filter Kearse it's gonna be new
intent filter and then I need to give it
an action okay for some kind of action
right blah
okay so I'm registering it for some kind
of action right exam and then this
action is whatever you want to make it
be I can say for example Yamba dot new
new status just make it tough okay so so
this is basically a intent filter for
which were filtering right so far so
good and then similarly I'm gonna
unregister it here on register receiver
receiver so I'm just basically saying
look if I'm not visible do not notify me
if I'm out of town don't tell me what's
going on in theaters in town right that
sort of thing this is happening on way
out this is happening when your activity
is no longer running but it's going to
pause because next is gonna go stopped
and who knows what's gonna happen to it
right but basically we're saying I no
longer want to know what is going on but
if I come back into running I er show up
back on the screen I do want to know
what's going on in town does it make
sense so that's basically what we're
doing here so this here this one-liner
is the equivalent of what we did in XML
it is that in XML looked like this we
said let there be a new receiver and
register it for this intent filter right
and that was the action that was made up
right so here we're doing the same thing
we just reformat this we're doing the
same thing we're just saying we register
receiver right for some kind of intent
it's just that in this case I'm doing
programmatically and I'm doing it for a
specific amount of time between
onresume and onpause point a right point
B okay those are my two points between
which I'm I want to know right
so I unsubscribed when I don't want to
know anymore right is that is that kind
of making sense so all this is in
timeline timeline activity right
it's a differently usage of the same
concept than just so all again it's a
publish/subscribe it just says it's a
for more specific as opposed to saying
hey yeah I'm in general interested in
you know Beatles everything right like
let me know when there's anything
Beatles related that's one thing right
but it's a different thing to say hey
yes I want to know when there's a if
there's a good show when I'm in New York
City right but don't let me know if I'm
using the same if I'm in San Francisco I
don't care about stuff going on Broadway
right so all the service is gonna come
into the play but so so far I'm just
working on this part this is how this
guy this guy's gonna wake up and do
something okay we don't know when it's
gonna wake up yet right you we only know
that the published part we don't know
the SUBSCRIBE part yet right we haven't
done an intent yet we haven't there's
nothing being broadcasted we so far only
said look I want to know why
Yamba new status happens I wanna I wanna
I want to notify this guy when um when
you start escaping
I want to notify this guy and it's gonna
get notified by calling on receive and
we're gonna do some kana refresh okay
but we came and said when this is going
to happen yet right now we need to go to
the service and actually broadcast to
the world hey there's a new status this
make sense we have one part of the
equation we have this part of the
equation right where's my we have this
part of the equation we have said what
to do i refresh we and we said register
us for a particular event so when the
particular event happens okay we are
gonna get we're gonna run certain code
one-liner to refresh them right but we
haven't got we haven't created that
event yet is it clear
I mean do you see another angled another
opportunity and something different
better way to do it okay anybody else
anything is anything not not making
sense about this I mean this is all
based on push
right the alternative would be a poor
like I could have said as opposed to
saying hey call me when there's
something happening I could be saying
hey is there something happening is
there something happening is there
something happening is there something
happening right I'd be hella anoying
right that's what our Twitter that's
what our service does to Twitter right
that is that this poor that is poor it's
hella anoying every five seconds or five
minutes or five hours whatever we're
saying do you have new email do you have
our new status do you have new status do
you have any status do you have no
status do you have no status right as
opposed to saying let me know when
there's new status and I shut up I go
away right it's kind of like you guys
used remember pop3 servers and you would
specify how often you want it to go and
pull your email wasn't it dumb right
that's how it worked every five minutes
when we go and check do you mean ignore
them do you have any monoidal do you
have any no you need to do that every so
often that is poor okay so we do pull
here we explain because we don't have a
better option we don't know how to tell
Twitter to call us just doesn't have
that feature right but here we do so
we're using broadcast receivers
internally quite a bit so we can
subscribe and then get notified right so
so far we have this is the code that's
gonna run when it's notified this is
where it's subscribing for a specific
notification because it could be
listening to zillion different things we
said no no no only call us when this
happens your new status
that's it never ever again only when
young bond you status happens
ok so now the question is how is young
bond your status going to happen but how
are we going to determine what to
broadcast because in the previous
example you know it was system
broadcasting I finished booting
batteries running the law there's a new
SMS message incoming phone call whatever
that is it was system doing that we just
registered for something that's already
well system is like trying these events
like Shh left and right stuff happening
all the time right now we are gonna
broadcast that's also where it's
different right
so who is gonna be broadcasting in our
universe exactly a litter service is
gonna send a broadcast and this guy's
gonna listen to it so I'm gonna open up
my updater service ok
and the question is when in updater
service do we even remotely have an idea
there's something new yeah I mean so
yeah exactly so right now we don't
really know because insert insert status
we don't know actually if it's gonna
succeed or not right because this is
attempting to insert insert insert we
don't know if it's gonna be successful
or not so let's see status data it's
going in to inspect in there we have let
me so we have insert in here it so this
dot inserts just called the other insert
so this where's the other insert the
other
insert now tries to insert okay so okay
so
so check this out so basically so
basically here's how we cannot remember
ultimately we are using work including
the database so we're using insert word
on conflict
so if insert without conflict is not
successful it's gonna use the conflict
algorithm in this case I think we're
using the coffee cart algorithm just to
replace right right
b-but yeah but so if so near zero or the
primary key of existing role if the
input parameter configure config ignore
or - -1 if any error so basically what
we can do is we can use that as a fax as
opposed to returning void I'm going to
return long which is what this guy
returns right right yeah I'm just
changing its our codec into whatever I
want right so I'm gonna basically return
that code that the database is returning
right so it just changed I just
basically just pass that code like the
database so this is gonna tell us what
what is being inserted right let me see
this it's it's the ID of the database ID
right was that
so you put your mouse down and tells you
it's the role ID of the newly inserted
row okay so if it was successful it's
going to be the row ID or that newly
inserted row right it or the primary key
of the existing role if the input
parameter is conflict ignore or minus
one if any errors what's that well we
can't we can't insert multiple rows with
the same ID because that would fail on
the constraint because the database is
designed so they or if it's different
then it's gonna be a new if it's a
different row ID it's a different row
it's a different status it's a new
status if if it was a successful insert
it that means that it must be new
because it must have a new ID right and
the ID comes from the unit from the
cloud not from us right so it's not like
we are managing it right yes this is one
by one yeah so so in this case I'm just
not sure actually
what is I'm not sure if because we're
using conflict replace so it's gonna be
when unique concern about the
pre-existing you know do the causing the
so let me see what are any more prior to
the new or is it does the insert or
update always occurs the command
continuously no no that's not what I
want because that's gonna always give me
the ID so I actually want conflict fail
so I'm gonna use conflict fail for now
I'll test it because I want this to be a
negative one right only to fail right so
that's gonna return minus one and by the
way since this one is being used by the
other insert I'm also gonna return along
here and and I'm gonna return the value
here make sense so I want to drag that
ID all the way from the database backup
right and then so so if I have that then
I can check now in updater service do we
have a negative value or not right so
now glitter service I can I can check
you know if it's a negative what's that
so so basically I can say if if greater
than zero right if you cannot positive
number then then I can create a nice
little new I'm gonna what I'm gonna
create I'm gonna create a whole bar
boolean as new start to says and by
default it's going to be false
okay so now if we do insert and we have
at least one that is greater than zero
that means that we got a ID that is
greater than zero right and then I'm
gonna sit flip simply flick the switch
I say statuses is true
doesn't make sense
I just defined a a flag here I'm saying
by default you don't have any new
statuses but while inserting in a loop
right while inserting your if any of
them is greater than zero that means
that something successfully was added to
the database so I flipped a switch
now my has new statuses is true you get
to say what you want to do I said fail
yeah that's what it says
according to the documentation right
according to the documentation when you
try to do DB insert with oral conflict
so if we have a conflict in other words
we're trying to insert something already
exists into the database we get to say
what the DA does and I said conflict
fail and that's defined as when
constraint violation occurs the command
aborts with the return code blah but oh
you know what the return code is but
then it changes to the database okay so
that's the return code constraint failed
and what is the constraint failed let me
see what the value of that is hopefully
it's not a positive number right but
constraint failed okay next
I don't know what that I don't I don't
know where that's defined was that yeah
we can just try it
so what you know what I mean what I can
do is it's very simple I'll just print
it out right so just like we always do
yeah so now the tur service when
printing it out I'll say I'll just
temporarily other variable here and I'll
say I'm gonna longer at a or long ID and
then I'll say ID equals that and I'll
put that in there I'll say scientist is
percent D USAID I got right so I'm just
gonna run it in just for fun see what's
going on so we're gonna run it
and it's easy to test because we're
gonna have a lot of duplicates anyway
right so I'm gonna start service and
let's see what you get
juror okay so okay so it actually chose
a exception constraint failed right okay
so let me try then something else so if
that failed where is the status data
insert so it's whatever this caused a
constraint we want right what algorithm
do we want conflict fail conflicted non
let's see
bored ignore replace city replaces the
value but I'm not sure what if it's
gonna it's gonna check try CAPTCHA I
could do that yeah I could do that let
me see let me just test this there's a
plan B so so what we're gonna do is run
it like this okay so menu start service
trip and okay so this is not so this
works but see my IDs are the regular IDs
so I can't really tell if it worked out
or not right
I mean I could say the idea I mean
there's some other logic that I could do
but here's another way like you said
what if I is supposed to insert with on
a conflict that came to insert or throw
right so I'm just gonna change it I'm
gonna use the different algorithm right
so now what I'm going to do is you find
let me define it like this so I'm gonna
do this and I'm going to surround with
try-catch right so if it fails I'm gonna
say that is minus 1 right so if it fails
it's this otherwise it's that right
yeah yeah you could we could do that as
well we could actually check what the
latest ID was and do a little yeah yeah
do it a little smarter
so let me let me delete this and just
see menu start service BAM okay so C
minus 1 minus my minus 1 right so if
there was a new one so if I now publish
something does think IDs swim publish
right so now I'm gonna stop service menu
stop service menu start service okay
notice that this one did not have a
negative alia okay so yes maybe
inefficient but works right so the cool
so do you get it right so somehow I need
to know got the new value or not so
that's kind of I use the database minus
one just means it's an old value that's
all so back to update their service so
it doesn't really matter how we got that
new value right
I don't you actually need I'll leave
that I'd 8% D so what I really care
about is this value if you have new
status so now if we have new status of
track if there are new statuses so if he
has new statuses
is true right then I get to do something
yeah
and so what is that something that I
want to do because I would like to do
something that is going to trigger a
need for quality I want to do so I know
now that there's something new here what
I want to do is I'm gonna trigger this
guy to tell this guy to refresh itself
if the user is watching that way so what
is the thing in today yet we're not the
hair that requiring all that done here
this part is done this guy's gonna do a
good job once we wake it up but how do
we wake it up send yeah we need to send
a broadcast right we need to notify we
need to send a broadcast
well then this guy is already done it's
waiting it's registered it's waiting
it says if what he called us and said
call me when there's something new it
already do that he told us to tell him
winters and we knew now we need to tell
him so we need to go to the top of the
mountain and scream there's a new broad
there's a new status right that's what
we're doing so that that is done by
saying bro is it brother sent let's see
send broadcast intent right new intent
and then we specify an action and now
whatever we put here needs to be the
same that this guy is listening for
right ideally this would be a constant
so I would basically create a a constant
public static final string string action
new status like that you know just
define it as a constant it doesn't
really matter just say it's a string you
know just a string action new status you
can type it I don't care it's just a
piece of text however you exactly
exactly it's that piece of text as
opposed to hard coding it here
a piece of text and let's say update
update service dot action your status so
just to make it domain maybe a little
more clear what it is
yep
I'm gonna clean this up because I
actually I don't care about it I D that
was just experiment right I'm gonna I'm
gonna make the code a little more
legible so that prints it I'm gonna get
rid of the side this thing because we
now know it works that's so great
I used as opposed to as opposed to using
insert a I use the insert to throw this
is a slightly not efficient because it's
exceptions are somewhat expensive so you
know and we're throwing a lot of
exceptions here will by default throwing
an exception so it's a little
inefficient that I'll worry about that
some of you know later right the next
iteration we will make it more efficient
I also want to get it to work right so
that's goal number one is to get it to
work right goal number two is then you
improve it and you improve it to some so
for not what I want to test ticket or if
this works first and foremost I send a
broadcast it's kind of like I go to the
top of the plow mount and I'm screaming
we have a new status we have a new
status now hopefully somebody somewhere
cares about that that somebody somewhere
in our universe is the is the this
receiver which we registered right here
so it only cares while we are looking at
it so this was the point a and one point
B happens he no longer cares it says do
not let me know if there's any new stuff
new stuff is still gonna get broadcasted
our ablator service is gonna go to the
top of the mountain and scream new
status regardless if somebody's
listening so a lot of in broadcast could
go into nowhere right which is totally
fine right so
status data finally basically happens
regardless so this is always gonna
happen so even if this fails or it
doesn't tell when I close the database
that's the point so I'm gonna test if
this works actually I mean that was the
whole point right so the test would be I
am I have the latest data first up
fourth first of all all right so I'm on
this right on this page okay I'm on this
page I'm gonna go behind the scenes and
updates and you know testing timeline
receiver send them so this guy so if I
now run a service okay if I run the
service start start a service so now the
service know is that there's something
new the service doesn't know this is in
the database always good but did anybody
told this guy ooh it did but what
happened yeah it's supposed to I mean it
did so you know it did wake up the the
cursor but it's invalid same in the fill
window so so let's let's see what
happened so we did get notified and this
guy did wake up but
but what's happened yeah
so here's what's happening what with
that with that one what is happening is
we try to require him here right but
we're requiring so what courser not
require does is it reruns reruns the
query that generated the cursor in the
first place right the problem is that
behind the scenes the database was
reopened for writing by the updater
service and shut down afterwards closed
so in not inadvertently this cursor got
closed and that's why it lost everything
remember that we install some data we on
purposely said do not close the database
in query so we just we return it right
get readable little is and rerun it so I
think that if I do well yeah may serve
to amazing cursor is you know again
recreate my cursor basically all week at
this right so let me get to do both so
that is basically let me see let me see
if this is gonna I don't know if I need
to do tell the last list
we made a decree adaptive yeah D fresh
or something like that I'm not sure yeah
yeah so so basically a refresh the data
all right that right okay so let me do
that private void get data or refresh
data or set up set up set up lists right
so we're gonna I'm just gonna put all
that stuff in between one spot right and
I'm just gonna call that from here set
up you I set up list this that set up
list all right so that's a sense of the
list and then in case we need to refresh
I'm actually just gonna do setup West
it's not this it's you don't need to get
into it like this so let me read that
that's that theory again it's just a
theory
okay so test number two so we have it
running okay I'm gonna go to three
testing receiver sand okay
so go here menu start service to force
the refresh okay so the retesting is
there that worked and bam it worked with
retesting service so yes so that close
that other insert would close the
database which would reset our current
cursor and when I did the cursor the
three queries basically laws that query
because the current query was tied to
the original cursor that was original
database
open cursor right so that that's why so
yeah so that worked okay you guys got
that okay let me let me let me refresh
what we've done okay let's just kind of
like create talked this through again so
we want it this was the topic of this
session was basically the booth the
receivers right I said listen to me
started here so I said the receiver
basically is a very simple
implementation of publish/subscribe
mechanism you have a certain piece of
code you can have certain actions
something some work right and you say I
would like this to happen when some
action happens so you subscribe it's
kind of equivalent of you know
subscribing to you know whatever mailing
list or subscribing to some kind of
notification when an event happens is
that something it's published you
because you're a subscriber you get
notified okay that's the mechanism
publish subscribe should be call should
be called subscribe publish but it
doesn't flow of tongue just as well
right so one motivation for us was to
start our service at boot so we said
okay the action the work that you're
going to do is start at boot so that was
that
so the the action is gonna be simply
started both that's good right so that
was done in code like this it was very
simple was I want I mean I made it more
complicated because I'm checking for for
preferences in the other it was very
simple one-liner right start at boot BAM
right now the put the question was who
caused this is gonna get notified how is
it gonna get woken up right how is it
gonna get cold so in this case the event
or the intent was coming from some guy
some system something else would
broadcasting this we just had to
subscribe to it right so that's
something else that was broadcasting was
a system right so what we had to do
is with the manifest we would not we
would register or a boot receiver and
it's and this is sort of a static
registration it's registered from for
now forever as long as this app is
installed right so all is registered and
this is the action that it's registered
for and we also needed to own a
permission to even be notified of that
action right
so that was a very simple
straightforward thing right so three
pieces what to do when to do it and then
a trigger to actually tell you do it now
okay got it
yes no maybe I don't
that's another yes I can listen to
zillion things I could have checked if
Network is on I could have turned on and
off a service if Network comes on and
off right they could have listened to
like you know only start this from
Tuesdays and shut wiseness you know you
know zillion things you can listen to
right but we chose boot receiver okay
all the network receivers same idea you
just got to figure out the logic to
check the network but that's not a
subject of the talk yeah yeah I added
the logic where I went to preferences
and I checked
should we start at all right because
remember I added a checkbox here I added
I went here in preferences and I added
an award checkbox should be started
that's that's this work here so don't
don't worry about that right all that
that's right it's extra just because I
wanted to add that but that's that's a
that was a different conversation so so
that was the boot receiver now back to
back to another case where I need the
receiver so if I am watching user is in
this activity user is watching this
activity in other words this activity is
in what we call the running State right
okay and
this guy in the background is pouring
the data pulling the data pulling the
data and it kept us to get a new data
Pam puts it into the database how does
this guy know that there's something new
in the database it doesn't because this
guy gathered data when it started
he doesn't know to go every five seconds
ten seconds I mean why would it it
doesn't make sense it's much easier if
richer if it says look why don't you
notify me if there's a new data so it
kind of does a subscribe publish yeah so
we had a different type of receiver that
would subscribe to notifications if it
cares about right so we said well the
difference is that this one is not
subscribed forever in other words why
would it need to be notified if we're
not in town we're not looking at
timeline activity who cares that there's
any new I don't nothing for us to do
right so we're not passively but I just
don't it's like if I wanted to passively
register it
I could've right I would have done I
would go into manifest and I would do
the same thing you just did here
copy-paste this change the name right
bam bam right change this to young but
whatever young you know new statuses
something like that and then change the
not who who to call right
that's the static notification but I
didn't want to do that because it
doesn't make sense right instead what I
did is I said so this is what wakes up
this is the what right this is the when
it's registered this is the SUBSCRIBE
part it was basically we said register
it in on his own register and unpause
unregister one line of code here and one
line of code here okay I just happened
to create a new timeline you see what
doesn't exist right
make sense and then and then basically
it was ok what notifies if what sends
this action what triggers it what makes
it phone call it says now do it now
right or goes to the top of the mountain
whatever metaphor works for you guys
right so we said updater service is the
one that will be good to know because
updater service is the guy that always
goes and says is there something new is
there something new is there's menu and
it does this every five seconds or
something right five minutes right so so
we we changed the ablator service to
when it's looping through statuses that
it just got to say okay if there's a
status that we successfully inserted it
that would mean to us that it's a new
status in other words we haven't had it
before because if it would have failed
before right so then we just flip a
switch and say hey there's something new
and then we send a broadcast right so
that's that broadcast that we're sending
here so we're sending a broadcast to
this guy and if this guy is active in
registered that means that this guy's in
the running state and it's gonna update
it is it not clear okay now boot
receiver is receiving boot notifications
system boot notifications yeah it's got
nothing to do it's listening to a
different cloud which we call the you
know the Android system universe
mechelen whatever alright
that was the club it's cool I'm gonna
take a short break let's do that
and then we're gonna talk about
something else</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>