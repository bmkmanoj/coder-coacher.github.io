<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Understanding the World Pixel by Pixel | Coder Coacher - Coaching Coders</title><meta content="Understanding the World Pixel by Pixel - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Understanding the World Pixel by Pixel</b></h2><h5 class="post__date">2014-04-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/jSV4zgkW14Y" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">my name is Josh Marcus I'm Asafa
developer at meet up I work in data
analytics and talk name of talk is
understanding the world pixel by pixel
so it's awesome be talking about this
because it's something I've talked about
in the open source mapping technology
world but not in the Scala world so it's
really cool to share this um and I'll
give you all sort of a brief taste of
what this domain is about and hopefully
will be a fun change of pace so jus
trellis is a scholar library for fast
distributed process and analysis of
geographic raster data don't talk a
little bit more about what that is when
I say it's fast it's designed to be low
latency so that you can see the results
of analysis you want to do in real time
in web time and we use this to build
both like interactive web services as
well as sort of more batch processing
projects that have a common component
and efficiency has been a big piece of
this project distributed and that we
define sort of a data pipeline and geo
trellis will automatically either
paralyzed that or let you distribute it
over machines processing analysis and
that there's a set of techniques used in
geographic information systems to
transform raster data that a number of
which are implemented in geo trellis so
just to give you a bit of background
Eric and I Eric who's here love you know
started this project in two thousand
don't 2000-2010 at a software
development company called as avian
Philadelphia which pushes the state of
the art in geographic information
systems it was open sourced in 2012 Rob
who's also here in Eugene not showed
this year as well rob is now currently
the tech lead of this project and
jus jealous is soon to be a project
under the Eclipse Foundation which is
really cool in a subgroup called
location tech so that's kind of exciting
but so let's just talk about like what
is raster data and why am I excited
about it because you probably aren't so
the story begins with this elegant and
humble creature who you may or may not
recognize in its natural habitat we
recognize it as the pixel pixels not
very exciting by itself but what we can
do with it is really pretty exciting um
we can color it in that's not that
exciting we can make pretty pictures
with it and that's often what we think
of when we think of the pixel in that
the picture in that bright images are in
fact you know made up of pixels but
what's really exciting is when we put
numbers in it we have a grid all of a
sudden now we have a Sudoku but oh but
here we have the raster so with the
raster we have a grid right a regular
glid and we pin it onto the map we sort
of define you know how many cells how
many columns and we're on a particular
map so by a map we serve we have the
earth the world is round but maps are
flat and so we project it as we say okay
great on this map where is the leftmost
side of the or the you know the West's
most side of this grid what's the East
both sides and each of these cells now
represents an actual place on the earth
and we can put some information in it
that tells us something about it now of
course this is very the resolution here
isn't really very good this oh we're
looking at here is the National
elevation database Ned and so this is a
raster the grid is about like two
million by 1 million and it's about six
terabytes and so it's interesting
because it's not necessarily big data
right but it's not small either and it's
not fast right and certainly when you're
working with a number of them
are some real challenges what's really
exciting about the raster is it gives us
a way to describe the entire world right
and there aren't that many tools that we
have to do this right we can model the
world we can predict what's happening
and there's a whole kind of wide range
of phenomena that we can use to do this
um and so what else can we actually use
to do this in the answer as well sure if
we're talking about place we do have
points lines and polygons but we're
talking about a continuous surface so
say like temperature everywhere on the
earth has a temperature raster is a
really a good way to go also we can
often take points in lines and polygons
and interpolate them into raster data
right so you have weather balloons that
you have give you say temperature and
then you can term guess or use different
methods to decide what the values around
that is um we also it's not just about
the weather or a natural phenomenon
though this is like popular for science
um so for example our humble pixel can
represent you know educational outcomes
we can ask questions around economic
inequality you know what is the average
income in an area right um we can the
traveler we can model travel time like
how far would it take us to travel from
this place um land use is a popular
thing you know is a certain part of the
earth used for residential is industrial
right and there's all kinds of raster
data made available by you know from
satellites from space also the US
government puts out all kinds of raster
data being able to build it so right so
when I started we were looking at oh hmm
mmm great so this guy right so this is
just um right we in the background is um
sorry my computer is unhappy with me we
have here in the background is a
beautiful data set called black marble
or earth at night it is a composite of
shots taken by NASA on cloudless nights
and what we see beneath it are at that's
actually like the light of
city or populated areas and so it's cool
because it's actually a cool proxy for
where population is because right when
we zoom out right we might you know we
see like you know people don't live
evenly distributed throughout the
country and then what's being overlaid
here is an image that we're generating
using geo trellis from a like a live
stream of RSVPs so let's take a look at
that a little bit further oh sorry so
this is um this is meet up so it meet up
basically people can schedule events and
invite people to come and an RSVP is
when someone says hey I'm going to come
right and so it sort of just a proxy for
you know where who is using it so here
is here here's some code this is this is
not necessarily the best example code
and i'll look at some simpler examples
but the basic idea is that there's an
operation called kernel density where we
take a point and we spread out it's sort
of its influence over a broader area and
we can define sort of the saw and the
kernel density really we're doing is
we're stamping a smaller rat grid on a
bigger grid and we can define the size
of it and its spread one thing so here
we're basically we start here we define
this kernel density this gives us a
raster there are these two maps here the
first one is because I'm a Jew trellis
when we're constructing these operations
we're not you're not doing the work
right here right this is it's sort of
like a future or task right it has yet
to be done so the first map is simply to
say to bring us into the context of the
result once we get it and then what
we've gotten is actually a raster and
this map so it's a little confusing is
is treating the raster just like it's an
array or a list right and then I'm
saying hey for every value in this rat
in the raster we will later get if it's
if the value is no data then set it to
zero just because that is necessary for
what I want to do later
then I add so basically we're doing a
fold-over the like we have a stream of
newports coming in and then what we're
doing is we're making a new new raster
with the new points and we're combining
it to the raster we used to have I'm
multiplying the old raster x 0.9 sort of
cause that fade away effect and then
calling cached so there's a lot to it
but i'll keep going um let me just show
you also this geo trellis transit
because it's kind of also a neat thing
that we have done with this so in geo
trails transit I know can you see that
I'm right so let me change this to
something can actually see right so this
is where I live in Philadelphia right
and what this this is like an open
source thing you can play with it mess
with it you can load your own data for
your own area into it um if you set up
and the idea here is that as I move this
bar it shows me how far I could travel
from that location if you know get at
341 p.m. on a weekday and then I've
selected like regional rare regional
rail bus and subway and walking and the
reason this is possible is that we're
generating on the back end this grid
where each cell says how you know how
long would it take me to get there right
um so kind of awesome and you can you
know move around and you all kind of
stuff um there's a sort of there's like
another interesting use of it where this
is like a scenic view which is like I
want to leave here and arrive here and
I'm willing to take a certain amount of
time how long could I stay in between
points by calculating how long does it
take me to arrive at places there which
is like one raster layer another layer
is how long does it take me to arrive at
a second place and actually subtracting
the one value from the other value um
right so I mean the basic idea i mean
raster data in the end is quite simple
but
are the sort of like a whole world of
techniques designed to help us work with
it due to too don't agree there is a
thing called map algebra which is sort
of a formalism for manipulating raster
data there's a professor called Dana
Tomlin who has been a advisor to us on
this project he's been great but like
you know an idea here is like here we
have one raster that represents fire
hazards another one that represents
flood hazards we just add them together
and now we have something that
represents risk I'm going to skip
through all sorts of stuff just to
mention here is it like a simpler
version of of an operation where
basically we have a bunch of layers
we're going to multiply every value in
those layers to weight them and then add
them together with that reduced and then
we render them as a graphic and there's
a color ramp to sort of defined it will
look at the values in the raster divide
them up into classes and then color it
one thing I thought would be worth
mentioning here is earlier Heather
you're talking about type level
computation and type classes and how
they can be useful and I thought be cool
just to highlight this as a practical
example so right in that pipeline we
have a thing called like a data source
and it it's sort of like if you're
familiar with things like spark it's
like a distributed data source we don't
know where if the data is on our machine
or somewhere else but um and there's a
raster data source and it has all these
methods of transformation methods that
we can use it is useful right so this is
ugly um but we have a map function that
allows us to when we're writing these
construction methods to transform some
data sources to some other data source
right and what ends up being really
useful is that we can say would it you
know in the end what that what the this
type classes of the instances let's do
is they still have a lookup table that
says hey if you are working with a
raster source and what you end up with
is histograms then this is the kind of
data source I would like you to end up
with and the nice thing about
this whole the whole can build from
pattern is it lets us automatically or
not automatically but lets us pass along
necessary metadata about like where does
it where do these datasets exist in
space to pass that forward which is
really useful and allows us to avoid a
lot of duplicated code and so this part
of the machinery is is messy but it
leads to a very clean API I am about out
of time I'm one thing that's fun about
our parallelization is that it is not
what they call trivial parallelization
and then often datasets actually rely on
each other which is complicated um one
thing just worth mentioning is that we
you know what we do all day every day is
deal with large arrays of numbers and so
Scala has been amazing for API
construction and you can end I'd like to
highlight Eric's premature optimization
talk from last year because you can
write really fast Scala code you just
you know might take off some months of
your life for years um and and you know
and and I just encourage everyone to do
whenever it is you have to do to make
your code fast on the inside you know
and then you know it happen our code to
have beautiful functional interfaces on
the outside and beware specialization it
doesn't work
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>