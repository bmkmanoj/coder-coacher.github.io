<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>27 - System Services (Cont.): Android Bootcamp Series 2012 | Coder Coacher - Coaching Coders</title><meta content="27 - System Services (Cont.): Android Bootcamp Series 2012 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>27 - System Services (Cont.): Android Bootcamp Series 2012</b></h2><h5 class="post__date">2012-03-07</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/X3-YdMcOpWc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so remember yesterday we talked about
that when you start your Android device
you get a whole bunch of these so-called
managers the managers are basically your
access to a system services system
services are basically assistant
services are basically a whole bunch of
things that do certain verticals things
right so for example location manager
would be your access to location service
Wi-Fi manager to Wi-Fi Bluetooth
telephony vibrator alarm NFC battery
package application bla bla a lot of
these managers to kind of get the idea
right so sensor and location are part of
them they're not all that different ok
so now to illustrate how they work like
we actually we did touch on this
yesterday when we talked about the the
alarm manager but the alarm manager is
not a very typical one sensor or
location would be way more typical
example so let me give you an example of
a piece of code that I wrote a while
back that illustrates some of these
tools by the way a lot of this code that
I'm the term referring to is in my
github github.com / Marikana there's a
repository called on Android code and
you could you could clone it what I'm
going to do is I'm going to download it
and you know import it into our package
our workspace at the other day i'll give
you the entire workspace you're going to
have the enchilada game
thing right in there so don't worry
about about that right so let me make
sure that this is downloaded cool so
what we're going to do here is we're
going to say import existing projects
into work space from archive i'm going
to point to that archive and there's a
bunch of code in there right now keep in
mind that not everything is going to
build because of you know different
versions of Android that I may have been
using a lot a lot but I'm also going to
want to close a lot of these projects
because I don't wanna have to fix every
single one of them right now so what I'm
going to do is I'm going to close them
when I clips becomes responsive project
okay so the one that I do want to show
you is the compass
okay pompous
there we go so it's an old piece of code
I wrote a while back it's my phone and
it doesn't really do it justice to show
you on the rail on the emulator because
I remember shaking my laptop won't do
much so what I'm going to do is I'm
going to put it on my phone
yes
how do i test absent birch oh my Dwight
oh I just oh um I that's a good point I
take this USB key and I just plug it in
and that's it literally and when I click
on run magically might have my device
appears yeah you need to enable USB
debugging thats the only thing it so
it's an under system system application
development enable USB debugging and
possibly allow unknown sources but that
you should not have to do that that's
pretty much it yes accepting pieces you
also need to get a driver which is you
know something that's a pain like you
have to go to the website of your
manufacturer and download the right
driver install it the ideal it's complex
just time-wasting thing right but you
don't need to do that in a mac so so
okay so I'm installing it on the on the
physical device and and there it is let
me show you what I'm gonna do is I'm
gonna do the DDMS and I'm gonna show you
like this so it's basically a little a
composting ye the throat 80 tailing it
smooth on the device than it is on the
screen but you can kind of see huh okay
got it very simple thing so I want to
illustrate two things in this example
I'm sure I'm going to show you how to
use sensors and also how to you all
right custom components right yeah you
don't need this code it's going to be it
isn't your book it's in a chap in
chapter 14 or 15 and it's also on the
web and you all put it in this part of
the entire workspace workspace this is
going to contain all the samples and
I'll give you all that right
so yeah you don't need to this is just
more of a lecture at this point but what
what we are talking about right now just
to kind of prep you guys up is you're
going to have to take this into you're
going to have to take what we just did
and you're going to do it in yamba and
the way you're going to do it in yamba
is you're gonna add the location to
twitter yeah you'll see so um so let me
show you my compass there are only two
Falls of significance right first a
couple of things that on a point out
remember I said that when you work with
system services regardless of which
system service it is this is pretty much
gonna look like that right you're gonna
say sensor manager since the manager
gets its in-service sensor service right
we did that yesterday for alarm source
right we did the lar manager equals me
know blah blah blah right so you're
always going to have a line like that
then you this is not very typical it
really depends on the particular API
right in sensor manager has something
called get default sensor right just
returns default sensor because guess
what there are multiple sensors it works
with now something that is very typical
is that sensors tend to work on a lot of
these system services tend to work on a
register on our own a registered and get
callbacks mechanism right it's a sort of
like publish-subscribe or observer
observable pattern right so it's not
like it's not like you're pulling the
information from a sensor but rather you
let the sensor push it back to you right
so you almost often almost always have
something of this form you register for
notifications and you unregister not for
ananta fication right sometimes these
things are called differently you may
say registered on register you may say
something else like what's the other
terminology register on register
subscribe unsubscribe
you know that sort of thing they have
different names but they they do the
same thing right same concentrate pops
up right or sub pop I guess subscribe
get published so what we are doing here
is we are saying register a listener
right and we're saying basically sensor
manager let me know when when there's
something something changes on this
particular sensor to the care about
which happens to refer to that sensor
there right make sense this is just some
flag not that important and this refers
to the class itself namely compass right
so for compass to be able to get
notifications compass must implement the
aunt of sensory event listen again so
it's very typical telephony you're going
to have the same thing you know Wi-Fi
are going to have same thing in some of
them so now when you look at it down
here what we have is we have the couple
methods that are part of being so these
three methods are part of being the
sensor event listening right so that's
how you get notifications so the system
is going to call you now when you
register so you register this that's
what I system is going to call in this
the methods on accuracy change and sense
of change the owner on configuration
changed so far so good
so so it's a pretty similar is a pretty
common pattern right now once you're
done with the sensor you're going to
unregister right now the question is
when are you going to register in a nun
register and it comes back to our life
cycle of the activity right remember we
talked about this a couple of times we
said if I i typically want those things
that take a lot of power consumption to
be only limited to running state right
and we said the good way to do that
limiting is to basically do on resume on
resume on resume which is when you turn
it on the the opposite is on pause we
turn it off right so that is one way of
wind so that's why that's why I
subscribing on resume unsubscribing on
pause yeah that makes sense now um I
said I was going to show you another
thing here and that's called um the
custom components work right cuz you
know I was I went out and I was trying
to find a wedge it looks just like that
just like my rose but I couldn't I
couldn't find the widget looks just like
this right so guess what I have to make
to make one so how do you make it let's
take a look at that so so what I did is
I created this object called rose now
Rose is a view so whenever you want to
create a create a new new widget you're
gonna subclass view because view is the
mother of all widgets right or views
right AK component in job right so in
this case is opposed to sub classing
view I subclass image view right and
then in the image view I / rode on
that's where the actual drawing Cap'n's
I'd if you you basically create your own
object by subclassing an existing one
the lowest one is the view itself and
then implementing ondraw where you
basically are given a canvas and then
within that canvas you can do with
everyone you can draw pixels you can
draw shapes you can in my case I just
set an image right in my case what I'm
doing is I'm just rotating the canvas I
actually figure out the media middle of
the canvas I rotate it and then I draw
the graphic that was going to be drawn
anyway so basically i draw the graphic
on our rotated camps so what happens is
how is the direction getting changed so
basically when when sensor detects a
change in sensor it calls back on
configuration change which we not so not
yeah own sensor changed which we use we
figure out what is the value from that
element zero defects 2x x coordinate y
is 1 and z is too right so it just each
sensor cares data in a different box
right and they're always going to be
floating point numbers you just got to
figure out okay I'm using you know
temperature sensor then it's 0 means
Fahrenheit whatever right and so based
on that orientation we then set roses
orientation and that's what this guy
uses to draw um by the way drawing
doesn't this method on draw is called by
the system but do one way you can tell
the system that it should redraw your
component is by saying invalid if so by
invalidating this you're saying hey
system I'm no longer valid they need
somebody to repaint and the system
schedules the repainting eventually to
come along
invalid can you what yeah so invalidate
leaves a message for the system to call
on drop so it's asynchronous call back
into this right that's why this
so that's that's what this guy looks
like it's a very simple custom widget
right p some graphics that I just rotate
on a canvas but by the same token you
can do whatever you want this is your
canvas you can now go and draw pixels
draw 2d graphics 3d graphics with
everyone alright so let's do uh let's
compare this to something else I'll show
you another example this other example
is called where where am I know the
example is called where am I oh my I
don't care where am I example um okay
well we're gonna do that where am I
example right in the in the yamba so um
I was going to show you first but it
doesn't matter what we're gonna do so
let's think about this so I would like
to now use the location service it's
very similar to what we've seen right so
let's do this one together so in yamba
we have the opportunity to to specify
our location okay so which code where
would we want to do this status activity
alright something severity yeah so what
was the first thing that we always do
when we need the running working system
services
ah remember I said this is the thing
that's common for all of them yeah I get
it right we need to get it right so I'm
gonna define it so location manager
enough for sensors not for sensors but
yes for location or we'll get to them
location is not considered sensor right
it's a different yeah just your sensors
are your things like you know
orientation magnetic field Gras
temperature there is it there even was a
try coder sensor I smell that it is yeah
you know what it is yes it looks up for
life in different planets
I'm not I'm serious about this its
successor so these are the various
sensors so a sensor orientation
proximity temperature tricorder it's
been deprecated but but but it was there
right there was also a let me show you
the constant you have all these
gravities in all the major planets but
also there's gravity on the island lost
so um yeah so so that yeah they get they
can get funny alright so location
manager we never we know number one
right we get it right but we know
nothing about it so uh you guys should
get familiar with documentation by this
point location manager BAM yeah so
because you're going to me asking ask me
like to cut his wife I work I don't know
go to Wi-Fi manager figure it out you're
gonna need to get it and then you're
gonna figure out its API right but
there's some patterns that are common to
all so let's figure this one out
together so um location manager does the
following
um you can do certain things you can
request location updates that's
equivalent to register or sign up or you
know whatever you want to subscribe what
I'm gonna call it right so request
location updates is the way in right and
then the remove location updates is
going to be the outright it move
listener what are its go make sense so
so so that's basically what it is so if
there's also useful method is get last
known location which tells you what the
last known location is in case it takes
a while to get you know the actual note
location so let's do the following so
now that we have a location manager I'll
also define location
so what people do I non create as you
can say a location manager is location
manager right oops wrong key combo
control space get system service locate
look Asian service right so I'm getting
the system service that we need in this
case right location service now if I
simply wanted to know what the last
known location was I could say location
is location manager dot get last known
location now it's going to ask you for a
provider in a provider is going to be
one usually one of the two providers
that are available mobile or GPS right
so you can say a location manager I'll
you know what I'll just define it as a
constant provider no typing it so I'll
say static final string or by der Rohe
either and its location manager dot GPS
provide references
okay so that's basically our provider um
so so that's that's it we can that's how
we get the last known location right so
we didn't really do anything to come
intense with this circuit with this
service we basically just got a service
and set get us the last known location
now if we want to know when the location
changes we can request updates and in
all that so that's one way to do it we
can request a single update providers
get best provider blah blah we can
request location updates or we can
request a single update in a single
update can work via a by a pending
intent which we're not going to do so
let's let's do our request location
updates okay so what I can do now is
just like what we did before define my
own own so on a pause on an on resume
which we don't have right we don't have
on Paula no reason oh okay actually let
me do it right here so what I'm going to
do isn't going to a source override
implement methods and I'm going to
implement those two methods that we said
we usually care about whenever we're
dealing with something that you want to
turn on off right so we talked about on
pause and on resume right
so basically so far i defined location
manager in oncreate and i declared these
two methods
so typically what you will do in on and
typically on resume would go before on
pause right so what you would typically
do here you would say location manager
dot request location updates I'm gonna
pick the second one on the list one that
takes the listener so provider it's
going to be a provider minimum time how
frequently do you want the updates to be
communicated to you and I believe it's
in seconds or something like that let's
assume it's in seconds I'll say 30
seconds minimum distance before you know
before you get notified so if location
changes just for like 5 meters right do
you really care so you may say look you
know we only care at a kilometer what I
know that's in on that is in meters but
the first one pretty sure is minimum
timings in seconds milliseconds you know
so a millisecond ok so so basically
provider milliseconds distance right and
then finally who to notify when things
actually do change so what we could do
is we could make the deaths of this be
notified right yeah now the opposite of
requests location updates would be a we
can remove right so location manager dot
the move
not remove yeah yeah yeah yeah they move
updates this yes there we go Thanks so
so basically same pattern what you can
encompass right you get your call sensor
manager you register for notifications
and you unregistered for notifications
got it so far it's the exactly the same
we're just using a different beast now
the turn part was always to provide the
handling or to provide the listener
right so I'm gonna do that dance again
remember when you fix the error so you
put the mouse hear you say lets us
activity implement onclicklistener that
adds that and I say add and implemented
methods and that that's what ever it out
to the bottom all these methods
so this is a location listener Bob x oh
okay
so what you would typically care about
is that I don't care about status
changed I don't care about provider
disappearing like for example if you
want to know the GPS is no longer
available you can do something I'm not
so the only one we care about is this
one you can rename this to location and
i'll say this dot location
so I'm assigning it and jackie cooper
just painted out lock dot leave that
comma on on location changed + location
dot is there something get speed of two
string can something like that
um well in this case because they can't
location here so there's just to
distinguish between 22 like if i call
this C I could do like this way yeah I
guess location L not see
so you can try running this see what
happens I'm gonna run it on the emulator
do so they can show
so let me see the law can't
okay so menu dr. update so subject okay
but Zach yeah so exactly so this is
failing because we can alter the
permission so that's an easy one night
hey
that seemed
so let's see what's happening here so if
i do menu by the sublet
what's that so I didn't turn off
anything but um I didn't turn it on
either so right now our GPS is off yes
that's the default state so what we can
actually do is we can control to certain
extent GPS by the emulator controls so
you could actually select your emulator
DDMS you could go on to emulate the
controls and you can pretend that it's
got the connection so i can send it a
location and notice that now this turned
on alright i guess what we know about
among right so how would that I guess
not I guess it says has altitude but
it's set at zero 0 which is probably
appropriate do you guys know which
location this is 37 point 4205 and minus
1 to 25 what I wanted to and then
i'm using i'm using the emulator yeah
it's google plugs yeah so altitudes of
zero is about right give or take 10 feet
so a couple of things it seems that for
some of you um it's see how we were just
testing this and we define a permission
here so if you're using my code it seems
that it ask you to explicitly say uses
permission and then that permission yeah
okay so it's kind of like when if we're
defining it and we're defining that
we're using it so not sure why so that
that seems to be a problem in some cases
and the other thing that I noticed was
username password server and sure i'll
plug in the default so you don't have to
if you're wiping up your code you don't
have to remember to put in
so cool so doesn't look too minor fixes
we have Oh another thing that I noticed
it seems that in certain emulators you
need did that work did you need to
enable specifically GPS like you may
have to enable gps here i'm not sure i
did not have to do that obviously but if
you know you could try to edit your
emulator or you're a BD and put in that
information so so worked right with you
so if you've given a thousand meters i
think that when you're limiting the
location update mm-hmm it has to be
greater than that model for the sensor
to actually fire over ok that's correct
here so don't watch for that investment
yeah yeah so just to recap what we just
did we do the following i define global
in my location manager location just to
be nice right yeah i got the references
to variables you know this was optional
to find get lost on location but the key
was that you register in on resume and
you unregistered known pause writes a
request updates remove updates right in
what that does once you register you're
basically saying call me comme des call
me when there's a change because we said
this here right so that is our listener
so this better implement onclicklistener
right and to be an onclicklistener you
know you need to provide to specify your
own like this when you get all these
callbacks and I only cared about the one
that says on location changed right so
so let's see so far not changing
occasion so what happens if you now go
and change the location but if i change
it by 38 I'm gonna I'm gonna change like
this digit from two to three right send
they didn't really do anything but what
if i change 37 238 that's what most we
must be the minutes is thirty 30 minutes
at seven thirty minutes but by yeah but
so that arcade there it is so it 30
minutes later it notice my 38 right yeah
is that you know changing a whole degree
you know it's way more than thousand
meters so um okay
well so that's working on if you want it
to now plug it further into our example
you could I believe that there's
something wrong on Twitter and it says
set location set low location or
something I'll set my location ah but
you need to convert it to this ID number
set solid range from minus 92 + 9 east
west and minus 1 82 plus 180 and you
need to create an array so it's up to
you if you want to do that another care
okay but you got the idea so now we
could do that if you wanted to change
cool ah so any questions on system
services well sometimes you know that
Matt validation the first level that's
the metrannans body is so which one the
first thing I able to get to know your
location and we get lost you location
yeah that would still be the method yeah
yeah yeahs gas plus last known location
is there just to kind of give you the
last known location because sometimes
they may take minutes or you know or
forever to actually get the GPS
coordinates right like when my samsung
galaxy it could take me like half an
hour to get like a lock on GPS right
horrible GPS so so for that purpose what
you can do is you can you can basically
do the different yeah you could get the
last known location we kind of use that
as the as a starting point until then
you get a lot yeah that's good I mean
there are the methods to be no query
what the best provider is you can also
do a search for provider you can specify
criteria you can say I want to provide
it it has altitude but doesn't cost
money or is a low power consumption and
so on because different providers have
different criterias I mean I personally
think they over engineered it a little
bit because you only have two things
really in reality but let's but for this
school work that's on a particular
device you have to ensure that the user
changes from UPS well inside both of
them because when you can setting like
that on the device is ready yes but you
can acquire like so your app can
intelligent to say what's available
maybe Wi-Fi is maybe a GPS is not is not
available or you can all get the
information so let's do you know the
plan B and so so that's the whole point
you are
capable of doing some wearing right so
you can say you can say get-get
providers so this is going to get you
the list of all available providers
right then you can say get providers for
a criteria and only show me enabled for
instance right right so you can
basically specify get all providers for
example just returns entire list and so
on and so so you can basically do a
search like that you can also say okay I
really want GPS on its not available get
me network but let me know when GPS
becomes available right because our even
now we're going to get notified in our
code when when GPS becomes when provider
gets disabled or enabled right so we all
know when GPS is gone so you can then
switch to another afternoon sir
so far so good</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>