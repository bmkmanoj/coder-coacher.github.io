<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>AnDevCon: Migrating Your Apps to the New Gradle Build Process | Coder Coacher - Coaching Coders</title><meta content="AnDevCon: Migrating Your Apps to the New Gradle Build Process - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>AnDevCon: Migrating Your Apps to the New Gradle Build Process</b></h2><h5 class="post__date">2013-12-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Lzh1PbZ5HrM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">alright so if you're looking for the
Gradle build process
duration you're in the right spot right
a couple seconds for you to slip out if
you're not yeah good okay first a little
quick you know it's about me I have too
many jobs I hear my name is Jeff by the
way Jeff from triangle ah but you should
call me Jeff there's a some work I've
been doing with new circle I've been one
of the developer of the instructors for
their boot camp class their Android boot
camp class I also my main job those
working for a company in Maryland praxis
engineering and in their product group I
also teach a class and loyal and loyal
as an adjunct professor there and I have
a couple apps out on the google play
store and I like to use those as
examples of what not to do in your code
when I teach the Android class because i
use those to learn android and they were
useful melt i put them out on the Play
Store but and one day I'm going to
rewrite them but I'm going to find out a
little bit about you guys I've been
hearing on and off throughout the
conference that a lot of people are
already using Gradle but uh you know
it's just curious is to you know how
many of you have apps out there right
now you know either on the Play Store
just one you've created it you're going
to get out there one day you know all
right okay quit if you could most of you
right that's why you're here right and
it and how many you feel like just indie
developers you're the only one working
on your project right okay okay how many
how many you've got like a team of like
you know two to four people okay how we
got like four or more interesting and
we've got keep your hands up four or
more keep them up for more keep them up
okay how we've got like more than 10
okay more than 20 all right well more
are you from Twitter cuz like I've heard
let the other night there was like 60 on
that King no yeah well how many have you
got I ie I'd say all of them you know
and then Android what do you have all
like 600 yeah yeah yeah okay that's
pretty that's I mean that's pretty
standard right neither are you seeing
the main product the you know has a lot
more and then Android specifically so
curious how many how are you using
eclipse yeah ok then using aunt do do
you do any you know command line build
stuff already with aunt okay and then
what about android studio anyone already
made the switch to android studio yeah
i've been seeing a lot yeah i was afraid
this was going to be a little outdated
already I'd everyone's already switched
over they're just gonna come to see if
you did it right right yeah or at least
or at least if everyone agrees with the
way you did it and then anyone using
Gradle yet to do you know kind of
command line builds or continuous
integration stuff like that okay good
how about just cos using continuous
integration this is an on continuous
integration but you need to do something
like this if you're going to do
continuous integration okay good so that
gives me a little bit of you know how
long to linger on what's life so that's
that's good to help so first let's talk
a little bit about the history like how
do we get here right so at least what by
the time I got into Android they were
already pretty much shipping at least an
eclipse plugin and then shortly after
that a special version of eclipse that
was the ATT right the android
development toolkit for that was set up
for doing android development right it
had some plugins and things like that
that were very handy for android
development
and they but they separated it out so
that you would use IDE would be eclipsed
but any command line building you you
want to do you had to do with aunt right
and they weren't really the problem I
think was that they weren't really there
was a lot of crossed over there right
you could you could have something that
they compiled in and built an APK fine
for you in Eclipse but then when you
tried to run aunt to get a build out of
it it didn't you build an invalid APK or
it didn't build at all right so that was
that was pretty frustrating and then in
April this year Xavier dushe had sorry I
don't have very good pronunciation
announced that they were basically
deprecating Eclipse an aunt in favor of
IntelliJ and great this was great news
to everybody but me who was doing a talk
at the Boston Google I the Boston and
DEF CON a month later on how to use aunt
so kind of made that completely
irrelevant and well so I did a couple
all-nighters and tried to figure out
Gradle and and get that to work for the
for the class and I think i squeaked by
but this is going to be a lot more about
Gradle and probably a little bit cleaner
so Gradle overview we've got griddles
pretty cool thing on its own right it
doesn't have to just be used with for
Android and I think it's worth looking
into if you're doing really any sort of
Android development and it's basically
the build system that they've created
that the uses it's it's a declarative
language ok so you're you're going to
basically tell it where the source files
are and where you want the executables
to be put and you know it'll take care
of the grunt work for you you're not
going to have to do a lot of conditional
while loops or if for whatever in there
it's declare it right and then there's a
little bit of customization you can do
with the
with with the with with Gradle so you
can you know have plugins and then it's
got its own domain specific language
that you can use to extend it in a way
that you any way that you need and now
that's very handy and they having some
api's for integration it's also free and
open source okay and it uses what's
called convention over configuration so
i'll show you a couple examples of that
like just just by having files in there
in the right directory the right things
going to happen for you right but if you
need to be someplace else you can get
figure it to look there it's pretty cool
and it also has maven and aunt
integration so if you've done a lot of
mavin or a lot of aunt you're not going
to lose all that work okay just a lot of
it and it's based on groovy so that goes
back to the dsl stuff where you know
you're going to be able to extend it in
whatever way you need to okay and groovy
is that if you don't know it's a it's a
interpreted language that's based on
Java so in the end it builds class files
for you and it's basically groovy is is
built on top of Java and then Gradle is
built on top of Group so you've got that
that's stat going for you so if you're
after you can always drop right down and
just pull something out of like Java
Commons or something if you need to so
all right let's let's get into it here
we've got a you know if we just want to
build something real simple for java we
can we can do the simplest case here so
i'm going to bail out of the
presentation and then go right out to
the command line all right so we'll do
the the simple stupid hello world right
so i can't see both the same time but
we'll just bring it ok so what you what
you need to do is have by convention
source main Java which if you've used
navin that's kind of
they're set up right so you just need a
source main java if you're going to do
testing you want a source test java and
then you will put any resources down
here in source main resources and then
all that goes into the build directory
so let's just go ahead and put one of
those together so we do Victor hello and
so I'm gonna build the directory
structure real quick source main java
right and then i'm going to go ahead and
put my i'm just going to use the just
for sake of time I'm just going to use
the default package right so I'm just
going to create a Java class in there so
you see there's nothing you know it's a
super simple here
and now this is riveting it's like pair
programming to the nth degree n oops
escape and then out of the mood and then
save it alright so there it is now I
need a build.gradle file here this is
going to look like that and all we have
to do is tell it what plug-in we went
oops I have to spell build right and
i'll just do say apply job oops save it
come on please save here and just do
great ol jar
oh I'm sorry yes yeah there's unless
everyone in the front row wants to
slouch all right so build successful so
now what we have is a build directory
that was built for us and in that build
directory we can see we've got the
classes and in there there's my main and
my my class Bob it was compiled and then
there's also a couple of minor things to
Pencey cash libs enlibs is actually
where they stuck the jar file all right
this would be great if we were building
a if we were building a library or
something right but if we want it to be
an application right well we want to we
want to change the oops we want to
change the plug-in type to be a instead
of a Java plugin we're going to make an
application plugin which extends that
and it's going to use our main class
okay now I I used in in the slides here
I guess I was playing around with I used
a full fully qualified class name with a
package name in front of it and all that
and you know using your last name as a
domain name is a great idea unless it's
mature Angola too hard type in a in a
conference so just skip all that alright
okay alright so we just want to switch
our Gradle we want to change our package
name I'm sorry our plug-in name to be
application and then tell it what our
main classes
miss Blair right come on pair all right
that's all I need to do in the default
package and now all I have to do is
Gradle run that's going to recoup its
going to recompile it and run it build a
jar file and run it and there you go
that's hello alright so that was pretty
easy just basic Java but we get to take
that a little bit further for android so
Android here is going to have a build a
cradle that's going to need a little bit
more to get moving ok first off it's
going to use a plug-in Android which
probably could guess that right but one
of the other things you need to do in
order to bring that plug-in in is you
want to pull it in through this the
dependencies ok so the dependencies this
this section here this group's is is
available for you this build script
section is available for you for it is
available to Gradle ok it's not what's
going to be installed on the phone or
anything like that this is or used to
compile the Java code this is for for
graybles runtime ok and it's just saying
that it's going to want to pull in the
this dependency and this dependency will
contain that plug-in and where is that
dependency it's in maven central ok so
you can pull that repository and then in
this section we are going to have the
Rope another entry for repositories but
this section is available at compile
time and then it's also possibly
incorporated in your apk so whatever it
gets pulled in
be something that your apk is dependent
on to be built and then to be put in the
APK m4 available at runtime so then
you've got this Android section which
was defined in the android plug-in a
couple things in here we're going to
kind of revisit these a few times so if
you don't collect it at all it's okay
we'll go through this and then we'll get
into a demos and you'll see a little bit
more you'll see it maybe even be able
easy er to understand by the time we get
it into the syntax highlighted stuff in
and in Android studio but for now just
know that these this section here is
what this plug-in uses to define Android
and the first thing it has is the SDK
version you're going to use to compile
it and then the build tools version okay
i'm using 19 here and then the default
config the min SDK and the target SDK
version are what is pulled into the
manifest and the manifest in this case
part of it is being built at runtime not
just the manifest at androidmanifest.xml
you know you have to define that without
in two of the things in there are going
to be your compile and your build SDK
right so you would want to manifest XML
that had like all your activities and
your services and stuff like that to
find in it but it's going to pull the
SDK version from this definition in the
build decorator and then the the build
config right here is can be expanded to
have a little bit more information like
your the package name and things like
that so we'll get a little bit into that
and then there's a tendency so this is
just saying pull in the new app app
compat dependency so you don't have to
have a full apk library type thing set
up so along with that there is the the
structure that you're going to need in
the you know this convention versus
definition or configuration principle is
that you're going to have a project and
in that
you're going to have a module so this is
what you get basically if you do the
default create a new android project for
me in Android studio okay this is what
it sets up for Gradle for you and it's
basically a project with a module in it
and in that module you'll see the build
directory okay that's because odd
because i obviously ran this built it
before I you know before I put a brevet
screenshot of it and put on the slide
but then I'm in there on that same in
that same level there's this source
directory okay and then there's some
instrument tests so this is for any any
of those instrument test you want to put
in to get run on the device or an
emulator would go in here and your tests
go in there and then there's the main
right so the main basic setup for your
your source code in here you've got a
directory that you're going to separate
out for your aidl assets your java code
and your resources and then this is also
where your androidmanifest.xml is they
also threw in the web launcher icon and
a dot get ignore default for you okay
and then there's the great build.gradle
which we saw on the previous slide and
then this is just something that Android
studio put out there to you know
synchronize the DUI all right so we
won't really get into that's that's all
I de stuff but then you'll notice
there's a there's a directory above that
that's also got to build that Gradle in
it and that's in it's empty right but
that's stuff that you if you have
multiple modules in here you could put
you could you could set up tasks that
get run across all the modules
you
right yeah I would look at this dot get
ignore directory and they said
everything but what's in get ignore
would be stuffed you want to put in
there but for version control you you
ignore the build directory everything
else I think pretty much gets put in
there there's been debate I've seen
about whether this IML flower should be
out there or whether that should just be
generated each time so it's going to
have to be you have to find something
that works best for your team I would
start by putting it in there I my team
music checks out in the Gradle directory
up here this is what's called this is
for the great old rapper the Gradle
rapper is a basically a configuration
here you see these two script files
great will w that's actually a born
script and Gradle w dot that you would
run on Windows the that's going to use
this Gradle so if you want to be sure
that your code is being built with the
version of Gradle that you developed
with then that's you would use this
rapper okay it it helps with the case I
this has happened to us with aunt is it
you know a developer will go and
download the latest you know android
development tools and they'll try to
build the project and it won't built
because there's something different
right at least this way your urine
you're sure that you're going to get em
you know everything the same version
that you intended what we need develop
you know if you compare this to the
directory structure that we currently
have in you know in for aunt and for
Eclipse you can see it's a this is it
alright so the project I pulled here
this is not the default project this is
the project that we use for boot camp
it's basically our lab and it gets you
know a bunch of stuff but you can see
how the you've basically got all these
you've got the app and the
libs like at the same level in the
directory structure and you've got
source you know this this gets checked
in but you don't want to check in Jay
right but they're the same they're like
right next to each other in the
directory the same with bin bins right
there but libs you need to check in
those right so i think i like the the
layout the hierarchal lay out a little
bit better it allows you it's a little
bit cleaner and a little bit easier to
find what you need to have checked in so
let's keep going let's go ahead and take
that project we saw i'm just going to
use the the yamba project so if you've
ever taken the android boot camp class
or if you've ever watched marcos youtube
thing if you remember way back when you
first started doing android stuff you
might have watched that for learning how
how do you do android this is basically
that piece but since this is more talk
on build integration we're not going to
really get into the code there right but
we're just going to talk about how to
build it right so here's the typical
project with an application and two
libraries okay and all you gotta do to
get this out to Gradle in theory is to
file export and then hit the Android
drop down there and then generate Gradle
build files next select all finish all
right we're done enjoy your flight whew
yeah a little more to do here we've got
to do so these they built some
build.gradle files for us three of them
one for the app and one for each library
okay so we got three of those the
problem is there a little out of date so
we have to edit them so open with text
editor you don't want to use the default
editor that gets pulled up with a Mac
because it puts in all sorts of crazy
stuff for quotes
and so I'm going to do for six plus so
that's the version i just pointed to my
screen that is the version of of the the
build tools we want to use and then but
down here we can see what this built for
us it's basically what we already saw
this is a build script we want to make
sure we're pulling in the the Gradle
dependency I'm sorry yeah for Android
the the correct version that's what
we're doing there alright and then down
here it's also saying that we've got
dependencies of the libs directory we're
going to pull in any jars there and then
there's also these two other things
that's project right so these are two
projects that were dependent on and
these are libraries that were used in in
art to run our app I'm going to bring
this up to 19 and then down here you'll
see this new thing we haven't talked
about yet the source sets okay this is
basically telling Gradle that you're
going to find these files in a different
place in what you would normally have by
convention okay so you can see it's kind
of dealing with the flattened out
directory structure of ant so I'm going
to go ahead and make that same change in
all three of these files if i can find
open with there we go say six plus 19
there it is text
6
more riveting editing 18 open up night
19 right yeah all right so I saved those
good alright so now i'm going to import
that into android studio there's a lot
to android studio i'm not going really
cover much of it in this so in this
class okay this is more about Gradle but
you'll see a few things in here oh great
it's it's pulling up what I had had open
before I came into the class let me go
ahead and close this out blow this
project yeah a new version ready what do
you think all right now i think i think
the never update out of state definitely
applies here area yeah yeah all right
here we go um yeah so we're going to
pull hit yet yeah let's all update at
the same time see how that goes for why
fine all right I know there I know
there's group of people are just messing
with me all right import project here we
go so end up con there it is not that
one this one okay so this is the
directory that I was working in and I
went down and i found the build Gradle
that was in basically the root of my
three projects okay so um in Eclipse
you've got workspace directory right and
then your projects end up in that
workspace directory or at least pointers
do them ok and then that's where if
you're exporting multiple projects into
Gradle they're going to end up with
you're going to end up with a build
Gradle in your workspace directory okay
so just a little that could be weird
depending on if you go into more
advanced setting setups for your virgin
control and file management I'm just
going to go ahead and accept the default
for the import and cross my fingers
yes yes not sure what you mean go back
well I you start in Eclipse and then not
that I know of yeah there might be but I
don't know if it all right I'm gonna try
the hollow import button oh yeah so the
hell painful all right let me do this
all right Plan C come on oh I know
what's wrong I forgot a step see if this
works anyway how it did all right so um
what the problem was before was that I
didn't update my wrapper all right and
no okay so so it generated a wrapper for
me it being the the Eclipse export
project product able to process and
where am i dumb directory every are ok
so it created this Gradle w directory
and in there is a zip file and it sold
you want to bring that up to at least
eight okay now there's an update who
knows it might be later but that's
that's something to look forward to get
that air or when you're importing what I
told it to do instead was to use the
version of Gradle that I had installed
on my box okay so I'm a little bit more
cowboy in that sense right i'm not i'm
not going to be locked to the version
that's in my wrapper okay it's going to
be i'm going to build that with whatever
and once i check that into version
control someone else checks it out
they're going to use you know the
version of Gradle they've got whatever
they got laying around
okay it just so happens that I've got
you know 84 181 here so it worked out
for the best now now I just did that in
I as part of the import I said no just
use the the one that's on the box and so
that changed for me you can I will
really get into that because that's more
of a android studio thing but yeah you
can tell Android studio to just use your
Gradle I'm not the not the rapper but
anyway so this is what we got for from
the import and so this goes to your
question a little bit you know like yeah
why why would you do an import vs just
restructuring everything and what I'm
going to show you is how to do the
import and in restructure okay and I
found this to be effective and so yeah
basically this is just like the way it
was set up in Eclipse okay so you've got
no change the bin directories are still
laying around oh one thing I forgot to
mention was make sure you back your code
up all right because it does this change
in place right so it actually modifies
the directories that your codes in so
you want to at least make sure it's
checked in a version control like doll
but you know maybe a good idea to go
ahead and create a zip file and set that
aside if you don't want to have to
breann you know check out everything or
whatever but just just keep that in mind
but yeah the bin directory is still
there right the gen directory is still
there but you don't want those anymore
right so and but yeah the source right
this is the source is is marked there
you see that's blue right that's because
if you simply move the highlight off of
it see that's blue that's because it
knows it's a source directory same with
Reds all right so this is not the
standard Gradle set up and that's
handled by this source sets definitions
telling it where to find all these
things okay let's click the slides and
make sure I didn't forget anything
so that was the source sets this was the
export and yes I needed to change the
directory that the filename there okay
so yeah this is what what it gave us
right and then I kind of talked about
each of these sections right already
where we had the build script the
repositories so all that we talked about
and now if we want to go to a full
Gradle set up right where we are it was
it would be as though we generated the
file directly in Android studio okay the
directory structure so we can take an
existing aunt and Eclipse set up and
migrate it over it's actually pretty
easy so the first thing you do is delete
this right because we're gonna end up
moving everything around and then I'm
going to go out back out to the command
line here peckham just do it like this
there it is and so I'm using subversion
here just for virgin tirol just as an
example but when you start moving files
around you in directories around you
want to do it in a way that your virgin
control is aware of so if you have to do
anything special like subversion us to
do svn and be der in svn make der that's
that I found that to be useful so that
you can easily check it in when you're
done right so where am I alright so I'm
going to go into the apps directory
where I have the source for the app and
I'm going to go ahead and make the
prepare the source directory oh wait i
just said use this bein victor i promise
this one last typo
I source mean java right and then i'm
going to move svn move source mein kaam
so right no source com yeah to source
main java and then I'm going to move my
assets directory in there ok the source
main and then i'm going to move what
else I've got a list but so many other
it's on the slide and I can't see it res
right into source main and then I need
to move the androidmanifest source me I
see what we got here ok and while that
is running i'm going to go ahead and
start my emulator because that takes a
while to get going sorry for this brief
interlude so now you're all anxious to
see if it got started if it worked
yeah no I'm not using Jenny model and
genymotion illness because it's because
that would be so much faster sorry all
right let's just see if I forgot
anything here play go to all right so i
moved the I made that the java directory
i moved the source into source main java
i moved the i made it i didn't make the
I didn't do this i got to the aidl step
and then I move the assets in i move the
resin i move the android manifest so i'm
going to go back and grab the aidl file
put that in the right place I need to
first make horizonte aerial file find
dot dash name stored on the IDL right
ok there it is all right so I need to
make an aidl directory under source mean
right and then move the existing one
over there
oh really
what are you wrong with my make during
their source mean off crud oh well sorry
haha it would be no big size up here
alright yeah
there you
all right there we go all right so I
moved everything around and now if i go
back to android studio i can tell it to
sync with the directories and then
re-import the Gradle configuration not
the SDK manager wrong button it's a
little little icon that has the Gradle
symbol with a down arrow under it there
it is so now this SRC directory refresh
failed well so it says it's missing my
manifest I love them that stuff happens
any manifest missing yeah it's not there
anymore that's right it's not there hmm
alright
huh I must have opened the wrong built
that great oak I'll ok because it was
still looking for the defined locations
there so I'm going to take this out of
here and I'm still going to need it in
this other one there we go save that
again all right that's important see I'm
making these mistakes just so you get
another look at the bill decorate a file
and in here now you can see that that
source folder that turned brown again
and now the it moved the the blueness
moved to underwear Java is ok so now
let's separate it out into a IDL assets
java and res ok and then the manifest is
down in there
I don't have it turned on on here right
now because I can't connect so but you
can yes there's a really handy under
tools you can just enable version
control and it syncs up okay and it'll
end it and it makes the puts a little
like a little bit the version number and
all that stuff on the side at least
first version i'm not really sure what
it looks like i'm gay make sure I
haven't forgotten anything okay so now
so now what do we have that we can build
from we've got some tasks they're handy
right so if you want to build the apks
you just do assemble now we'll build you
both debug and a release version all
right and then there's also this check
which you'll run the tests after you've
done the assemble and then bill will
just do both okay so you can check
independently or you can do build and it
will will assemble it for you and check
and then clean we'll just basically
delete the build directory so you know I
noticed an error I'm tempted to go back
and see what it came up with before we
go on to the next thing here was
complaining about what was that my when
I down that must have been the build
Gradle file I changed by accidental and
make sure there
oh it doesn't like where the aidl file
is
all right let me try doing this build
make project let's clean it rebuilt
okay it's clean all right I must have
just done it decided to do a build while
I was moving stuff around so you'll
notice in IntelliJ and this was kind of
a shock to me i'm a Eclipse user from
way way way way back you know using it
in the j2ee days and stuff and one of
the things that was kind of disturbing
yet delightful to me for Android studio
and I guess until all of IntelliJ is it
you don't save you know you don't save
files it just automatically saves them
for you which is you know disturbing and
delightful but the problem is is that i
don't think it really knows when to do a
build so it seems fairly random like
i'll be moving files around or changing
something and it will you know Jimmy
arms like well yeah I was typing you
know so I hopefully they'll be able to
refine that as we you know as they as
the product matures a little bit or
maybe it's just something I have to get
used to I don't know so now we've got
these these things split up into the
separate directories and I'm not going
to bother going this with the lid
because the lib I don't really care I
for whatever reason I'm you know I I
don't need I don't need different
flavors for that so what're flavors
we'll talk about that next I think yeah
bill variance yep so let me let me yeah
good that's the next thing we're to talk
about so i did my slides on halloween
and so I was you know anyway it does
it's not as interesting now because it's
November you know I should have Turkey
it there so flavor basically that allows
you to manage multiple versions of your
app so you have that base version in
Maine and then you can have like a free
and a demo version you can have a
special version that you're going to use
for you know for beta testing you can do
maybe separate builds that have liked
you know that are that have icons or
branding for separate companies all that
kind of stuff you can do with flavors
it's pretty cool it saves you from
having to break out all your code into
separate APK libraries and then have one
really small app you know so it gives
you a little bit more flexibility there
I have a feeling though it could get
really messy if you're not careful with
it so there are probably some occasions
where it's very appropriate to use a
library and then some occasions where
flavor would be better yeah I would be a
good idea yeah Amazon and Google Play
I'm sure sure they didn't didn't intend
that when they built this thing when
everything to go and Google Play but
yeah sounds like a good idea um you can
also change your package names in there
different birds different flavors can
have different package names see you can
have different assets resources or even
the Java code can be different in the
different flavors it's it's pretty
powerful but you built in and also the
nice thing about it is is it build time
it builds the common stuff once and then
it's going to build whatever flavors you
need assembled at that you know F for
that particular bill and then also the
androidmanifest can be you know it's
basically built by merging the different
flavors together so how do you do this
the google talk from google i/o has a
lot a lot of detail about this so that's
definitely a good youtube video to watch
but for for this we'll just talk about
it you know little lightly i'm going to
try to not cover too much overlap but
there's some things that that i've used
so you can have multiple i'm going to do
this show a version of a pro and a demo
right so the pro would be the one that
you put out you charge a dollar for and
the demo is the free version with the
ads in right so we need to do first is
add these product flavors to the to the
to the manifest I'm sorry to the to the
build-up Gradle file
and just pull this up so you can tell
I'm not a native until a J guy because I
don't naturally do the control n thing
to pull up the knee anyway um so we'll
just have in here I'll just copy that
out of there to save a little bit of
time this product flavor in the android
section change it anyway
okay so and it's actually different
pectin amet so I'll say yamba and same /
down here so this way you can actually
install both on your test devices at the
same time right so they'll have
different slightly different package
names right and so now we just need two
directories at the same level as main
right so new directory and we'll have
pro and your directory me our demo right
all right collapse this a little bit
alright so how am I going to know
whether you've got the manor though so
what I'm going to do is I'm going to
take the assets out of main so what I've
got in here is a licensed little license
file right and in there it's going to
say you know what version it's running
and in the past you'd have to create a
you'd have to go in and manage this by
hand right you'd either have to change
the file or you'd have to generate it on
the fly with some sort of crazy ant
script but now I can just what I'm going
to do is I'm going to move this and I'll
into my pro version alright so there's
no assets under main anymore and then
I'm going to copy it and put a version
under demo it's going to be slightly
different copy it demo there we go
all right and I'm gonna make this
slightly different this is being free
all caps because it's free alright so
now what that give us we've got the
option to build two different types let
me pull my slides back up to two
different flavors alright alright so
that's what I did I change that so
here's our flavors now how do shoot see
there we go how do we how do we build
these right so too if we just want to
get an APK for the debug demo version
all we've got to do is run the Gradle
command assemble demo debug alright so
we'll get that particular one but if
instead we want the demo release version
we can build that all right and then
this goes all the way through down to
just assemble will build all four
versions okay so it's got that
permutation going where you have the
flavor permutation and then the the demo
or release thing so and you can just
pull with the assemble target there to
get what you want alright and then in
Android studio all you have to do is
sorry pull up the Android the build
variance here and you can pick think I
need to reimport Gradle there we go now
this is loading now you could pick what
there we go so you can pick what you
want it to build when you hit the play
button alright so to start in the
emulator or whatever you got yeah
no no they right now at least the Gradle
stuff is where you want to do all your
dependency set up and stuff like that
don't do it in in the IDE okay that's
not its they're saying it's not ready
yet and that's I guess part of the
reason why they're still calling in a
beta all right so i don't i don't know
how how integrated they're going to end
up they Google hasn't consulted me yet
so all right okay so so those are that's
any way to build different flavors the
other thing i want to show you in and
this was mentioned in the google i/o
talk saying yeah you could do it but i
just thought i'd show you kind of how to
do it one of the problems that i had
when i first started writing my hobby
app was that i would release go to
release a version to google play and I'd
forget to increment the number right the
version number and it would kick it back
and say you know hey dummy you got this
isn't version 2 anymore so what what
what I decided to do back in the ant
days was look at subversion and didn't
use that revision number so if you're
familiar with subversion you can do svn
info you know straight right if you just
do like svn info you'll see here one of
the things that comes up with is this
revision right so this is 318 I've done
like 318 check-ins on this little
project I've been working on so if I
ever want to reproduce exactly what this
was I haven't checked in my changes of
directory moving around because I don't
want to fool with Wi-Fi but what I would
want to do is build from something that
was just a just a check out right and
then I would look at that revision
number and then anytime I wanted to
reproduce the code exactly as it was
when I built that I could just use that
revision number to check out that same
basically that same you know branch or
it's almost like a snapshot afternoon
right so what
I wanted to do was you know basically do
the same thing in Gradle so there's that
version you know in the default config
you can specify there's a section called
default config and this goes into all
the manifest XML files across all the
flavors all right you can also specify
this in each individual flavor if you
want so you could have a version name
that included free or demo or debug or
whatever if you wanted but just for the
sake of example there's this default
config i'm going to use and instead of
hard-coding a value in here i'm going to
pull this off of a vey task that's
called SBN info and i'm going to grab
the revision and make it a integer and
use it as the version code and i'm also
going to use that as a part of the
version name so that if a customer you
know calls me up and says hey I'm having
problems with version you know with with
this app I can say well what revision
number are you and then I could rebuild
that exact code and duplicate that
problem okay so now in order to get
there I'm going to need to build this
svn info task and that's built outside
of the android section as a separate
task okay and the there's a little bit
this is basically groovy at this point
okay so this is some groovy foo here
that's using the output stream to turn
that into a string and that's the output
of a exec which is a groovy command to
run something on the command line
basically and the executables svn and
the arguments info pretty
straightforward and then it's going to
take the output put it in the output
stream turn that stream into a string
and then do a little bit of regular
expression
magic on there to pull this value after
the colon out and put it in basically
it's a return value so the neat thing
about tasks is you can update this EXT
return value and it's it's basically a
structure so you can big I just made up
the word Reb it's arbitrary you can make
it whatever you want and put it put it
right there and then just for you know
warm fuzzies I did a print line of the
output so during the build i can see
that it got the revision i expect ok you
don't wouldn't really want to do that
long-term because it just makes it build
more noisy all right so and then one of
the problems with Gradle one of them is
that they don't support native tasks yet
by default but I did a little bit of
research and you know it's not really
that complicated basically all you have
to do is get your native code into a jar
file and the right structure and include
that in the APK ok but there was a
little few jumps that we had to jump
through to get that to work I'm not
going to go just in the interest of time
I'm not going to go through this full
demo here but basically you want to do
what you would typically do which is
create your directory structure ok
that's that first step that's just for
java stuff and then you would want to
take your J&amp;amp;I directory and put it under
source main J&amp;amp;I or maybe your flavor J&amp;amp;I
and of course if you're already doing
Jay and I stuff you probably already
have an ndk but you want to set an
environment variable to tell your build
system where that indicate lives all
right so i called that ndk home and then
in the build Gradle file I'm just going
to do a couple other tasks here the
first one is I'll start from the bottom
here let's start with build ndk all
right so that's going to
you look in this outputs directory and
the inputs directory and it's going to
compare them and if something is newer
in the inputs directory it knows it
needs then the outputs directory it was
it's going to have it built okay and
once that happens it's going to run this
executive because it's the task type is
exec it knows that it's going to have a
command line to run this ndk bill so if
you ever run ran ndk build on the
command line if you're doing any case
stuff you probably have you'll know that
that then generates a directory called
obj right now the first pass at this it
worked great but the problem was is it
stuck this obj directory in the same
under my source for and that kind of
violated some sort of deeply held
principle that I shouldn't be putting
out put under my source folder right I
need that to go under build so the only
way I could figure out to do this was to
without modifying the NDK build script
was to copy it first so you can see this
dependency here for the NDK bill there's
a depends on right here it says copy ndk
source that's going to copy this is the
source files up into the build directory
okay it's just doing a straight copy and
it's smart if it's already there and
it's you know a later date than what we
already have it's not going to bother
doing it again but that's that's all
this is doing so now it knows when it's
doing it knows to look for input for
builder because that should have already
been copied from source main J&amp;amp;I into
the bill directory okay that makes sense
pretty clean ok and then what's now now
how do we get that to to to to be put
into our finally we need to get that
into our APK right so there's this other
task here that's called native libs to
jar I'm terrible naming things so
but basically it's a zip type right so
that's what a jar is and it's going to
create a use this destination directory
of native libs okay that's where it's
going to put the output and it's going
to create a jar file that's based on the
build directory negative lendi k dash
libs and it's going to include any of
the iso files there right it's all this
is doing is creating a zip file that's
called native libs jar and it's putting
it under my native libs directory but
but where did this ND caleb's directory
come from alright that came from this
little thing here if we did an ndk build
we need to make sure we move the files
out of the libs directory that the ndk
build creates just for us without asking
thank you very much we need to move that
out of the way into the Andy caleb's or
whatever we want to name it that's not
called libs anymore libs is used by the
for the building the java stuff so any
any jar files or whatever that you've
got that contain java code in there
would go under libs so you want to get
that out of the way that's this ndk deso
stuff out of the way before your java
stuff starts happening okay so now
you've got a jar file and it has been
placed in the in this indie caleb's
directory and where'd I go
all right and then so now when you're
the other thing you have to do that I
unfortunately left off my slide is that
you have to add your your build
directory this this ndk libs directory
to your dependencies so I'll go out here
too I'll show you what that looks like
just in here this is going to be totally
invalid because there's no NDK in this
but I'll show you what at least what it
looks like in the build-up Gradle file
so you see here it's already got this
libs there's nothing in libs in this
project but if you had any java libs
that's where you would want them to go
well this can actually we can actually
add another line almost exactly like
this that is the further for the build
directory so we could say and then if
you want to do replacement you have to
put it in double quotes instead of
single quotes similar quotes are just
literal literally whatever the string is
but if we want to say builder it's got
to be in double quotes builder / and BK
dash live and now that jar file that
contains your ndk will end up being put
in your apk file okay sound good okay
let's go back here see what else we got
alright and this last step is going to
keep doing that see there we go this
last step will let you build your
automatically run that native to libs
jar task whenever you are about to build
so that just means that you don't have
to and you know separately call that
task in when you type trail so it'll
just whenever you do an assemble for
whatever it'll make sure your native
lives are up to date for you all right
so one of the things that I had done
also in aunt was automatically convert
my images from vector format to the
various DPI sizes one of the things that
I got frustrated with when i first
started was that I'd be working on a
project and I get all the icons
converted and then you know the someone
from the graphics group would say oh we
changed this so then I have to go and
generate you know for a new PNG's and
get them in the right directory and I'm
really bad getting stuff in the right
directory and checking it in so what I
ended up doing was just having them give
me all the the graphics in vector format
and i was using as we decided on SVG and
then i put that in like an arbitrary
directory we called it icons and then
ran a script to convert them so what
that looks like for Gradle is pretty
convenient you can basically that script
was pretty heavy right you whenever you
are converting those files it's pretty
slow if you've got a lot of if you've
got a lot of images so we didn't want to
run it all the time so what we did was
we had this with Gradle here we can set
the inputs files and the outputs files
and only run this for the files that
need to be
dated so where the inputs files is the
is a as this just looking at the file
tree where we've got these files located
so it's in that directory and we're just
going to look for SVG files in case
someone throws some other rained and
file in there and then the output files
that was a little bit more complicated
so we had to do was take what the inputs
were coming in with and compute what the
final name would end up being based on
the the dense pixel densities that we
were going to support right and then
only if see this do last here this only
happens if the if the outputs are older
than the inputs right so this is this
just saves us a lot of time because then
we only have to do these converts when
we're ready now that convert is another
Gradle script so that is just a just a
simple script it's just cold convert
well this is the find output file so
yeah this is another script so in order
to compute what the output files are
going to be I just you know do a for
each in this loop here and pulling each
of the resolution types and figure out
that it's going to have the name of the
file paying so you do we do a little bit
of string manipulation to to find the
file name without the extension and then
append P&amp;amp;G for it and then we add it to
the list of output files and that's
that's what that is ok that's just
computing what the output files will be
is it's it's not very time consuming but
it is a little bit but it's certainly
less than this which is the actual
conversion ok and this is very very
similar it's just going to iterate
through the the files for that directory
and then
go ahead and put them in the right
drawables directory with this I'm just
using RS VG convert there's a few other
conversion utilities you can use the
convert SVG files to pngs or whatever
and then oh there's my I put that slide
in the wrong place that's where it was
this is telling us how to integrate the
how to make sure that that native build
will happen sorry about that any any
questions on any of those things today
yes no let's go
Oh
yeah so back on this um where do I have
it you own the dependency you would list
that as a compile dependency so here you
see how this oh darn it I did it again
see here we are you see how this says
like colon yum this means that these are
in the same directory so what I would do
is set up my my shared libraries and an
expected directory and they just
replaced you know the slashes with
colons for whatever reason and point the
dependency to those sub-projects to
those libraries in now or you could if
you wanted to you could use a maven
style what is that called you can you
can there is a way that you can and I
haven't explored this yet myself but I'm
really interested in there's a way that
you can build your libraries so that
they're a single fight and share that as
an artifact through a repository so I I
all I know is that you can do right
right yeah yeah you can have your own
maven repository I think you're in your
own file system right yeah its local to
your machine or even just you know one a
local server somewhere on your land any
nails all right thanks a lot please
don't forget to send some feedback there
so I hope you enjoyed the class if you
did please leave the feedback and if you
didn't remember this was deep dive into
framework or something I don't know okay
see y'all later
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>