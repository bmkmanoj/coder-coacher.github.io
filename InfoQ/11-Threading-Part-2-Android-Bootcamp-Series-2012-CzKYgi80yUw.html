<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>11 - Threading - Part 2: Android Bootcamp Series 2012 | Coder Coacher - Coaching Coders</title><meta content="11 - Threading - Part 2: Android Bootcamp Series 2012 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>11 - Threading - Part 2: Android Bootcamp Series 2012</b></h2><h5 class="post__date">2012-02-15</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/CzKYgi80yUw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">anyone we left off so we basically what
we did is we talked about on click
happens this is a UI event right what we
then do is we create an async task we
pass the status some kind of text it
becomes this parameter here let me
didn't post right now the result of that
is either dis textured a text which then
goes into result here and which is then
ultimately just print it out of this
crowd that's basically what happens
that's the process and it goes right um
now to actually show you this is running
giuliano on a separate al let's
introduce a tool the tool is called the
tool is called trace here and it's
useful for profiling your apps ok so to
use trace you you need to have a trace
file in other words you need to generate
some kind of trace information before
you can view it right makes sense now to
do that you need to basically start the
tracing on your code between some two
points point a and point B right so if
we are going to profile most of our
application what would be a good place
to start it is you know what would where
would you start method tracing here what
would be a line number we can sort of
start doing something useful so what's
the first line what's the first piece of
code that executes in our code yeah i'll
create and then we must call super so
basically one of the very first lines of
code will be like right here right so
what I'm going to do is I'm going to
start metal tracing i'm going to say
debug doc start method tracing you can
optionally give it the name
again so this is going to start tracing
our file our code now what would be a
good place for a point B that's the
opposite with the stock people yeah the
subject racing yeah if you remember the
life cycle do we talked about yesterday
so it's a good place to stop metal
tracing it would be I mean you could do
it I mean it's arbitrary I think you
could do there technically the you know
the counterpart to on create will be on
destroy right the problem with that is
that we can't cause on destroy to learn
we would get to like kind of sit and
wait for it to actually get garbage
collected and cleaned up and all that so
they don't really have time for us so
alternative that i'm going to pick is
going to be on stuff right because i can
cause on stop to create a two-run how
bring something else in front like i
could click i could click back a
complete home button right and just
cause home to become the active activity
so then this one that was running would
go from running right and it will
basically go this way to here and we sit
in stock right so that's not a bad
choice cool so I'm gonna put on stop
here now again you can type if you like
typing or you can go source / I the
implement methods and find on stop here
now it's a big much bigger lens to it
then we get before but it's fine right
so fine on stop edit in bandages
so far so good
now what would be the opposite of start
metal tracing debugger Summit Racing
we'll be right yeah so debug dot stop
netted tracing
so far so good so we basically
introduced point A to start tracing
point B to stopped racing between those
two points we should have a farm so I'm
going to run this and it's going to
crash right
so when you see them as Miss and a
message like this it means go to the law
cat is my locket and why do you guys
think it's crashed
so there's no there's no reason for
crashing yeah so we need a permission to
access the file to write to a file
storage so just like before for internet
you need a permission el again as well
so the permission is going to be called
the right external storage so go ahead
and add it so basically just like before
we go to the manifest file right and
just like before you can say oops you
can do i'm going to edit from command
line from our text for change right i
can say users permission and right name
you can copy paste the previous stuff
right if you want and then you just have
to find the right permission and I give
you a hint it's called right external
storage and it's somewhere at the end
the right external storage so that's
doing but it's the key is its users
permission not permission so anybody
around this
good it didn't crash right so far okay
good leave the lockout they read the
logcat what is it saying so it okay I'll
take a look in a second so if i post
something you say hello hello words
trace you right and I click on update
right um now if you actually I'm still
on the screen but if I gone back and if
i go to the DDMS perspective and look at
the files for notice that now on the SD
card we actually have a new file called
straight young adult race
no no no no this is a trace of the code
all right so this is a file but notice
in the file is zero yeah that's because
file gets created at what point a
happens who doesn't get written two and
twelve point B happens okay so let's
write the point B so what I'm going to
do is I'm going to simply click on a
homescreen to leave this app that should
call just cause I'm stop to Kevin
alright so we now got it fun and we now
have a file it's actually a large file
yeah this is a text file it's somewhat
human readable actually so we need to
analyze this file but to analyze it we
need to bring it to our laptop and right
now it's in it's another computer it's
another device it's in one of these
right so how do we get it over from the
device into the the laptops yeah you can
use you can use the there's a button for
that right you can use the pic of push
and pull buttons here right so we can
select the file you can do pull get
device file and then save it as we're
pulling it from the device onto a
desktop if I put it into our boot camp
that is an essentially ft peeing it over
or something like that right so for the
girl so do you guys have a file on your
file system you should be able to go to
your workspace boot camp and then well
wherever you save it it doesn't really
matter but there's my father right now
to analyze it what I'm going to do is
I'm going to say trace here llamado
trace on Windows you may have to specify
the full path traceview and then c colon
backslash blah blah blah the full path
you may have to that there's a known bug
before
so basically what race you is is a way
to see the execution of our code over
time right so this is basically a
timeline right so this is our timeline
right it does is in the whole thing 222
milliseconds well hung 22 seconds
actually right um it tells us that we
had a bunch of threads right so this is
our main tab so also known as the UI
thread that's where you know all your
main stuff happens like processing of
the buttons and drawing of the screen
and things like that right this is our
our async task this is where we actually
went and posted stuff online right and
then we have some other binder treads
okay so what you can do here is you can
actually you can zoom in into some areas
right so if i zoom into this I can now
look for things that put were
potentially long running tasks right so
this was a file descriptor something to
do with POSIX and uh you know so on I
can for example zoom in further I can
take a look at various things figure out
what took a while what are the
bottlenecks in science' to exit to
double click on the timeline to reset of
you yeah you can see in a functional so
you can see that this whole thing this
whole thing took you know well whatever
i have selected to forty-three percent
of cpu time take that long you know
there's so many recursive calls and so
many function function calls on the top
right so the top level one hundred
percent took that long right so you can
basically see what's happened behind the
scenes in your cup put the steps of
executioner
you can also do a search so for example
set status search doesn't wear I think
doesn't matter for me well there's my
post to Twitter take six point two
percent right and Jane background and it
took some so many milliseconds right
okay so this is a useful tool for
looking for problems also looking at
that now a lot of these other tats you
get one over there and you don't really
care about them so none of that amount
of that drive so we this this what we
caused that one in that one that's the
main stuff if we care about in this
question yeah if I click wheel eight
times why don't you tell me why don't
you guys go ahead and click click ten
times and let's see what happens okay
i'm going to close this i'm going to run
the test again so I'm going to say Ron
so go back to java run this
waiting for it to start
this could be the same activity alright
so now do this three times i'm going to
click on one two three yeah the toast is
going to be sequential but we don't
really care about that that's that's a
UI current property I'm gonna now
believe this screen yeah and now
presumably we have a new trace file by
the way what you can do is you can also
get the trace file by a command line one
second so you can say you can do this
remember adb i can let me remove Yamba
oops yambar dot right so I can do
something like this I can do adb pull /
SD card / yamba Oh tres tres done so
this is now pulling that file from
command line by a DB so you know
although there's a button for that you
know just to kind of know that it's all
really driven by a to be right and now i
can say trace view young but the trace
and see what we get
I'll be I just my second this isn't this
looks like at the same one right this
doesn't look right adb shell CD such as
the card RM so Alice the shell RM yamba
this michelle gone me try this test
again one more time
you know what's happened so one more
time
okay so some test
update update update
first is going to be successful but also
should fail problem because of the
repeat messages no maybe walked out on
so I'm going to press home if I do all
off the shelf I don't care the file yet
it's still writing it there it is gets
bigger bigger but there's my file so if
we go here oops i figger their control d
and if i do pull pong that file facing
it that's what we get
there you go so basically what we're
looking for in here are a couple things
what's interesting is first of all the
number of threads that we kept going on
so like I said this is the UI thread you
don't want to be blocking it like if we
actually get our core drums luggage Lee
this would be obvious that something is
going on here right but we already
implemented async task so we have this
tree chasing tasks here right that the
result of me pressing the button three
times okay so there's nothing really
wrong with this code so that's why you
know or with this execution so that's
why you know you're seeing it like this
but this tool is useful if you think
it's something very sluggish you don't
know why you're you guys for example not
as forming right so this can reveal that
often this tool yes it can be very
little noisy and they're supposed to be
a search that can help you with that but
it doesn't always work and so on so
again I just use it for looking for
problems ballman's yeah yes yeah it's
pretty accurate it actually takes into
account its own time so you called me
actually can run longer because it
accounted for the time that it used to
actually write it a lot of the trace
file it's gonna actually down
substantially slower once you get the
tracing line yeah so it takes that into
account so you want to possibly yeah so
that's the so that's you know taking
into account is 45 seconds you know all
the timing already took into account the
fact that it was earning so well okay so
with that what I would recommend is now
that we know how this works out common
assault because I don't wanna have it
run every single time for seven minutes
I'm going to comment all this to debug
starting the work stopped
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>