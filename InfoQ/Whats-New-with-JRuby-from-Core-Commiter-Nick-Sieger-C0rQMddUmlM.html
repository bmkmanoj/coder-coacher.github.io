<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>What's New with JRuby from Core Commiter Nick Sieger | Coder Coacher - Coaching Coders</title><meta content="What's New with JRuby from Core Commiter Nick Sieger - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>What's New with JRuby from Core Commiter Nick Sieger</b></h2><h5 class="post__date">2012-03-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/C0rQMddUmlM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so I'm Nick Nick Seager this is me I
work at engine yard I'm one of the
members of the JRuby team and I've been
weird engineer for about two and a half
years now we Charles Tom and I we both
came from Sun right before they got
acquired by oracle and we got hired on
by engineered to work specifically on
JRuby make JRuby better as a ruby
implementation and also to improve JRuby
and make it suitable for deploying to
engineer cloud so what actually I've
been doing most recently is working on
JRuby in the context of engine yards
products and making sure that we have a
JRuby solution there so how many of you
folks are actually using jruby today or
considering using it looks like most
yeah most of you okay great when I was
asked to come out here to give this the
give this presentation I was it's been a
little bit while i was in san francisco
last october for java one we had a bit
of a presence there of course we had a
typical javaone presentations and I've
kind of been I won't say stuck I've been
kind of relaxing at home for the past
few months since since then I haven't
had any trips I mean any conferences to
go through it's been pretty nice so when
I was asked to come back out here I was
like well what should I talk about and
because I felt like well I was just back
out here a while ago and I just thought
well I'll come out and just kind of give
an update you know and tell you where
things are on JRuby land you know if
some of you are new to JRuby some of
these things may or may not you might
not have heard of them they met they
might might be missing a little bit of
context and i'll just say feel free to
stop me and you know if i could fill in
as many details as you want i'm going to
kind of assume that love you a lot of
you have at least a little bit of
knowledge of what's going on in the
community and if you don't i'm happy to
fill it in either during the
presentation or afterwards so at
engineered actually what I've been doing
is like I said working on the cloud
product one of the first things one of
the things I've been working on most
recently is a way of using visual vm
to connect to your JRuby processes that
are running in the cloud anybody
familiar with visual vm few of you yeah
so visual vm is this really neat tool
that comes with every java development
kit that gives you a nice really nice
kind of introspection into what's going
on into the jb m and so i can start up a
java program I my local machine and
start a visual vm alongside of it and
visual vm will actually give me a
listing of all the all the java
processes are running locally the
problem comes is when you have a java
process running somewhere else and how
do you connect to that and they're
actually not there aren't any real
straightforward tools for say connecting
a visual vm program on your computer
with something off in the cloud so I
went out when I went off and worked on
this for a while and I was going to give
you a little bit of a demo of it here
but I won't be able to do quite a full
fledge one because I've actually don't
have internet access so I'm going to
kind of do a little simulation of it of
a nap and just kind of talk through what
what is going on as I do it just kind of
give you an idea so so the idea with
this is that like I said you have a nap
web application running in the cloud and
you want to just connect visual vm to it
in it in a simple straightforward way so
i have this command line tool and right
now it's just a command line to do over
here right now it's just a command line
tool we could look at making it you know
more full fledge maybe a plug into the
visual vm program itself later but for
now it's just command line tool so you
can run it at your command line and it
gives you a couple different options
let's make this a little bigger so the
main one is you just say ye y visualvm
start and that's all you need to do and
so in the case of an engine yard
application I have a couple of extra
convenience features built into the
program specifically for engine yard
apps since that's of course my employer
and I want to make things work well for
our cloud so when you start when you
want to connect to an engineered
application you can actually specify the
environment or account in your
engineered cloud where your applicant
cloud application is running and it will
just go directly out to those you don't
have to worry about what host is what
ec2 host is running on any of those
things you can up so in order to make
this useful for all of you even if you
work working outside of engine yard
cloud you can also use it just in a way
where you say well here's a host that I
want to connect to and i'll specify a
port if you want or you don't have to
necessarily and you can actually have
you by visual vm just open up an ssh
tunnel to your host and then wire things
up that way so what happens is you have
a you have a server process that needs
to be started to listen on a certain
port that visual vm can talk to and the
way we do that is we actually you have
to say you have to run your server
process with some specific arguments and
the visual vm tool also tell you those
so if you just rent it like this with
the JVM args it will print out the java
command-line options that you need to to
use on your server program or your
application program and my system is
kind of cold and not sure why it's
taking so long here
there we go all right so just so let me
just run this one more time so somewhat
unrehearsed I prepared all this material
just for this for tonight so apologies
if it's you know they're couple of loose
rough edges here trying to do this on
the fly so we get these JVM arguments
and what we can do is simply put those
in an environment burial environment
variable called Java ops which the JRuby
command line program recognizes and it
will pass those on to the JVM so we want
to take those quote them so like that
and then what I have is to simulate a
server application I have this little
program which it just runs in a loop
just a little ruby program runs in a
loop and every so often every ten times
to the loop I'm going to just generate
an exception just to kind of simulate
maybe a problem that maybe happens
periodically in an application that
we're trying to troubleshoot for example
so i can start this program so I've got
my Java the options set for my server I
can just start this program like that
and so that start that doesn't do anyth
doesn't print anything out so I don't
know for sure that it started about it
it's it's running and something if we go
over here and just do ey visualvm starch
it knows to look on defaults to looking
for local host by default and it has a
specific port that starts at so I don't
need to specify those arguments and it
should actually start a copy of Java
visualvm which is coming up now
so you see that so this is visualvm if
you haven't seen it before one of the
things again that I mentioned is when
you're using visual vm on your on your
desktop machine or your notebook you
have a already have a listing of all the
Java processes that are you running on
your machine so in that case this this
tool becomes superfluous really you
don't really need it you can just
connect room directly by selecting them
here I ran it this way just to simulate
well if it's probably if this program
was running on a different server the
two like I said has that extra smarts to
do an SSH tunnel and connect to the host
and set the same thing up so this is
what we're simulating so now some of the
things you can see in visual vm if you
haven't seen it before is you have these
panels that give you a real-time status
of CPU usage memory usage the number of
classes loader the number of threads
loaded and there's a whole bunch of
plugins you can install for this as well
one of the things that I've installed is
this mbean pain which lets you examine
all the jmx objects that are running
inside your jvm and in particular JRuby
actually installs some of its own and
the this corresponds to the one jruby
instance that's running in our VM if I
go look at this runtime thing here you
can see I have some attributes here to
specify the back trait or that actually
keep count of how many back traces have
been generated we've found over time
that one of the source of performance
problems with lots of Ruby applications
is that it's so easy to capture errors
and ignore them and drop exceptions on
the floor problem is when jruby in
particular and actually for most Ruby
apps in general generating exceptions
and the back traces that go along with
exceptions is rather expensive so we
actually built this statistic into the
vm so you can go look at a ruby runtime
and say oh well this thing seems to be
generating quite a few back traces maybe
we should go go try to look into that
and there are some other tools that can
help you dig in and get you get specific
back traces and see well what code is it
that is actually generating these but
this is at least a way to kind of get a
quick look and say yeah maybe there's
some problems here so that's basically
the sort of the visual vm overview
I don't know if I can do a whole lot
more with the this brief demo i have
here so i think i'll just go back to my
prepared slides and talk about those
that's just one thing to look for i one
thing i don't have on the slides here is
you can get this code on github it so
it's open source so you can take a look
at it for yourself see we'll see what i
did see if you want to adapt it for your
own uses it's available under a liberal
license so you can certainly take it out
of the existing project or even just use
the tool as is if you want the location
of that it's under the engine yard
organization on github github com /
engine yard it will be in there if you
need a extra pointer let me know so
another thing I want to think about well
what's new in JRuby is I really wanted
to kind of highlight from the community
Specter perspective what I think is
interesting and new going on and kind of
share a couple of those examples with
you because as you know Jay Ruby's not
all not only about what the core team is
working on two to make Jerry better it's
my even much more in my opinion and what
the community is doing with JRuby one
project that's coming along in the past
few weeks that I find really interesting
is this this project called sidekick
anybody familiar with rescue rescue is
basically I sort of a ruby messaging cue
that the github guy is developed and it
uses Redis as the backend store for for
storing the messages and so basically
you have your front-end app that post
messages into Rath enter into I think an
array or something and instead of a data
structure inside of rescue Redis and
then rescue is a separate process that
pulls those messages out of reticent
does your background processing this guy
Mike purim who has developed sidekick
was playing around this and a while ago
he actually who's trying to run red
rescue with JRuby and finding that it
didn't really quite that model didn't
fit and you think about it you have
rescue running as a bunch of background
processes you basically need to run one
rescue process for every worker that you
want to be able to have doing work and
he thought well you know why do we have
just run all these passes why can't we
just want to run a single process and so
he worked he played around with rescue
as it was tried to change it but then he
ended up going off and doing this
separate project that just came out and
I'm on the
you're all that I just posted he has
this sort of this sort of a tagline here
what if one side kick process could run
do the same work as 20 rescue processes
and so what he's done with sidekick is
basically implement the same protocol as
you have with rescue so you can have
your front-end talk to read us as if it
was a rescue thing and you know posted a
post exact same data in the rescue
protocol inside a Redis and that
sidekick will just read that out and you
can have a single sidekick process that
will just spawn up as many threads as
you need to process all your background
workers so the idea is using concurrency
and threading as a way of increasing the
throughput of your of your background
processes so I haven't had a chance to
play our own two yet but it looks really
neat what I'd like to do and I've been
trying to do for a while a common
question I have from people who are
using JRuby to deploy applications is
well what if I want to do background
processing what if I want to do some
sort of scheduling or you know there are
various tools you could Java tools and
Ruby tools that can do that and they
sometimes work well in a j.o.b
environment sometimes not what is we
like to do is something exciting states
take it and make it possible to deploy
sidekick alongside a rails application
inside of a single single JVM and just
have it all just working yet another
area I find particularly interesting
I've been I you know being a Jay Ruby
person and a Java person I would tend to
call myself a polyglot although I
actually haven't really been keeping up
much with all the language advances on
the JVM whether it be closure Scala
groovy some of the newer ones like
Kotlin or you know all these different
languages it's going to be the point
where it's getting really hard to keep
up with all them and and I I generally
liked that idea that the pragmatic
programmers wrote about where you know
take the time to actually learn
something new learning a new language
every year that whole idea I'm like yeah
great and then you know the years go by
and you know if I've been doing Java and
Ruby for five years and haven't really
sat down to do you know any new language
stuff and but I I feel like I have a
background with emacs and
less a little bit of background in the
list world and I feel like closure is a
different of thing by itself that taking
two things like JRuby or you know Ruby
in this case and closure it feels like
there's potential for marrying them in a
way where they you know they're
different enough as languages and and
technologies that they there's not a lot
of overlap they might actually fit
together if you like to like to mix and
match tools in this kind of way and
there's actually been a little bit of
activity in the community recently
around this too so I just actually don't
really know much closer at all so I just
cobbled together an extremely minimalist
example of just creating a hashmap and
then accessing it and that's just for
the purposes of translating it to the
Ruby versions here so you can see here
I'm declaring a variable called H map
creating a hashmap which underneath the
covers for closure is actually you know
it's a persistent data structure which
is a really nice feature of closure that
you get that sharing sharing within the
data structure without without the
concurrency aspects of it where you
might over right over right thing so the
data structures stay immutable but they
change and share share and share the
state that has not changed between
different versions of the map so we're
doing that and just getting key out of
it and checking if it has it has it has
it that key so you have a closure file
one thing you could do from ruby is just
say oh let's just use Jay Ruby's Java
integration to just call out to the
closure command line that actually works
it's you know obviously it's a little
bit clunky you don't really get any of
that tight integration that you really
like you've got your closure over here
you've got your Ruby over here Mia but
then then again maybe that's that's the
way you want to do you want to keep your
closure in your closure in your Ruby
Ruby but you know there might be some
other things you can do here to like to
take a little bit more advantage of
closures features without having to get
deep into closure the language if that's
not your thing so this guy Dave Rae who
I guess is more of a closure guy than he
is a ruby guy came up with this library
he called familiar and the idea was
familiar was to basically take all the
core closure functions and make them
accessible from Ruby inside of JRuby so
with with familiar you get some code
like this well this is a disk idea you
there's a
module in Ruby familiar with and then
everything inside of this black gives
you direct access to functions enclosure
core with where you know if you have a
dash and then in the closure name it
would be an underscore and the ruby
version of that that function so here's
that here's our you know again our
closure that creates the hash map on the
top the familiar version is on the
bottom so it's almost identical right
except we're just using Ruby's variable
declaration semantics and we're calling
into that exposed hash map function
which will create the closure structure
you know and passing the same collection
as we you know in the same format here
and of course printing out these things
those those you know we can do those
Ruby the exact same way we're just using
Ruby's printing methods instead of
closures here so we have that H map
variable we just print it the get method
is the exact same closure get method
except access from Ruby and likewise
with contains headiest is actually
Charles the one of the either of my
fellow Jeremy core members and he was
working he's been kind of keeping his
eye enclosure for a little while too he
he thinks there's also maybe a lot to be
be gotten from kind of mixing the two
together hehe cobbled together a library
recently that kind of takes another stab
at this and it's still a little bit fit
in its infancy but it's you know he had
another way to do this I think is worth
kind of contrasting a little bit so
Charlie's approach was to instead of lay
instead of tying into closure core
directly he wanted he just basically
exposed the data structures so we
created this closure library and all the
all the different data structures
exposed through specific classes in in
the library and so you access some more
in a much more Ruby like way in this
case if you want to create a hash if
there's a persistent map class that has
a hash method for constructing and in
this case you're actually passing in at
ruby hash and the code underneath
traverses Ruby hash and converts it into
the course
and close your hash one thing that's
impt and so then you see here below you
get the same sort of closure data
structure out of it but you you can
access the things in the data structure
using the Rubies operator you know
syntax sugar methods for for reference
referencing into the hash or checking if
there's a key and what's interesting
about this is it actually is it just an
artifact of the fact that closure data
structures implement some of the same
top-level Java interfaces so it in you
know in the case of these the closure
persistent maps implement java.util.map
and JRuby happens to have syntactic not
syntactic sugar butt decoration around
jaw of anything that implements
java.util.map in the inside of JRuby we
automatically make it possible to use
Ruby hash semantics to to do those
things so you pretty much get ur for
free what this actually needs is you can
go back and use the same kind of access
method for for the for the familiar
version as well so like if you do H map
bar equals something yeah that's a good
question i'm sure try it might as well
it's good Yeah right
ok
so I do have this code here i'll post i
have a link in my slides if you want to
go to look check out the way this is
wired together so let's just go grab our
let's just do this
was that hideous
which one yeah that's no no they're
separate they're separate I'm just using
the familiar version here so each map so
you can see that the actual class of
each map as a closure Lang persistent
hashmap and so your question was what if
we do each map foo equals bar explodes
so it actually so it appears that
closures persistent hash map interface
throws unsupported ops for right through
that makes sense you know yeah I think
you can so let's let's do this again so
we still have that we can actually do
like oh so familiar yeah I know what
you're talking about it actually doesn't
quite work the way you would want to so
like you're saying take this right
whoops we need to route I need to
bootstrap that code
yeah alright so we have this H map which
is an instance of the closure persistent
map so the problem is you know can we do
it like yeah foo like this yeah this is
we're in 19 now so you can do that the
itch map too yeah so his library is a
little bit a little bit underdeveloped
in this area and notice one thing that
if I try to actually access actually get
an exception here because it's not
expecting it to be he's expecting the
keys to be something that you know
closure would know about and what's
actually in there is a ruby symbol and
there's no automatic conversion for
symbols so still it's still very much in
its infancy but you know it's
interesting you that how much you had
about you know what happens and so
that's kind of what I would expect it
first of all that I wasn't sure so it's
kind of fun to see that that that's
actually what happens so again with
closure you know if you're familiar with
closure and the way it does
modifications you use a ref and then you
have to you know it's got a software
transactional memory system where you
have to open a transaction before you
modify a variable in this case of breath
so if we try to do if we create a breath
when we try to set it do a ref set on it
outside of a transaction we get an
exception but if we use the do sync
method which is closer closures way of
saying please open a transaction do the
ref set in there then it works and that
you know the pretty much the identical
code for the clojure this is really
confusing now talking about closure the
language in this this extension but you
know basically the same thing here you
can see there's a tiny bit of a
difference here we're kind of using more
of an object-oriented approach here
calling set on the ref rather than you
know using a rough set function here
that's yep definitely in fact i was
going to you you and I were talking
about Scala a little bit before that
before we start
and we do have a little bit of Scylla
support built into jruby so that we're
using Scylla classes from junior biet
knows about some of the special special
class names for some of the you know the
ways that scala generates classes under
the hood it I'm worried that it's a
little bit brittle though because
scholars compiler changes so frequently
that the output it generates may not be
compatible with what JRuby expects that
at the current time Erlang yeah or jang
yeah he's urging for sure yeah so this I
have a little short URL here which will
take you to the gist that has this code
which you know again just serves the
purpose of showing you how the stuff
fits together the actual code that is
doing is fairly trivial but at least
you'll get an idea hope you'll be able
to get that running so highlighted a
couple of community things I'm sure
there are tons of are out there and if
you guys are you know know of any that
you're currently looking at or
interested that I'd be I'd be glad to
hear about those two I'll shift gears a
little bit now and talk about from jruby
cores perspective you know kind of
what's happening in the core of JRuby
and you know the the the answer there
really doesn't change quite as much over
time like it's for the past six months
is so it's all been pretty much been
about the same thing and that happens to
be Java 7 anybody out here using Java 7
in production yeah haha ok that's pretty
close we're almost there yeah yeah good
yeah it's only so Java 7 came out last
summer in end of July you know I haven't
been in deep in the Java world recently
enough to know to remember you know kind
of like what the adoption cycle is for
new JVM no major jbm releases like this
but seems like Oracle's already burned
through for updates to Java 7 so it's
the latest is java 7 you for it seems
like before too long you seems like most
you know it should be stable enough that
people can start switching over to it
and
and hopefully hopefully it will of
course the big thing for for jruby oh
just a quick note if you are Mac users
you've you're probably aware that
there's no java 7 official java 7
release for the mac yet but you can
actually get a dmg of a preview of java
7 at this URL and actually do have an
update for build available i'm not sure
how you know how long it's going to take
before they stop calling it preview
because as far as I've seen it just
installs and it works so you know maybe
it's not the production quality thing
that you're concerned about but most of
the people i know are not actually
deploying java software to max and
production it's usually deploying to
linux or or something else so it should
be good enough for development and
certainly good enough to try JRuby with
with the Java 7 features so the big
thing of course in Java 7 that jruby
gets Jerry be all excited is invoked
dynamic and anybody tell me what invoke
dynamic actually is or what it does
pretty much yeah in well so it was
functional in the initial release but
there were some aspects of the
implementation that were suboptimal that
made things really slow yeah it was like
update 2 or 3 something like that so
yeah so I mean now we're definitely in
the clear and all the other testing that
we've been doing based on the look the
latest java 7 is proving proving to chip
to you know come true and i respect so
you know there's still a fair amount of
not misunderstanding but maybe not you
know not not enough familiarity with
what's really going on within book demic
that i thought i'd take another stab at
giving you an idea of what's actually
going on here why why it's important for
jruby and I'm going to take a little
detour through this really cool blog
posted i read in the past couple months
this guy named time tom stewart gave a
talk at Ruby manner I think late last
year was conference in the UK and he
called this talk programming with
nothing and hopefully as I talked
through this a little bit you'll see why
this is going to be relevant for invoke
dynamic but for now just going to bear
with me so the idea of this talk
he gave was what if you had a version of
Ruby where all you had in it were
lambdas and the ability to call lambdas
you know you don't have any if
statements you don't have any constants
you don't have any literals don't have
any strings can you actually implement
anything and you know those of you who
are familiar with lambda calculus and
Turing completeness yeah you know you
can get there so but what's really cool
if you go read the posters you know he
kind of breaks it down and step by step
detail and you know personally I
actually didn't go to school for
computer science that was a double D
major so some of this stuff was a little
bit lost on me until recently but so
it's fun for me to go catch up and kind
of see you know what's happening under
the covers so sort of the crux of the
talk is he talks about fizzbuzz you guys
familiar with the little fizzbuzz test
it's you know cold like this right so
here's some Ruby code that implements
fizzbuzz if you you know you loop
through a bunch of numbers and if you
have multiples of 5 35 or 15 you print
out different things and so how would
you go about implementing fizzbuzz with
just a you know a simple language that
only has lambdas in the ability to call
lambdas well he actually builds it up he
blows up step by step he covers every
aspect of us from you know numbers to
iteration to to you know to the modulo
operator the conditionals and when he
adds it all up you actually get a
fizzbuzz program that looks like this
and this is all just you know lambdas
and calls you can see that you've got
the arrows for the lambdas and you've
got the square brackets or some calling
if that lambda so go check out the blog
post to see how that actually matches up
I thought that was pretty pretty funny
though so the crux this right is that
you've got this unit of use of this kind
of lowest common denominator unit of
just being having a chunk of code and
executing it and the the cursor the
magic behind invoke dynamic is actually
basically that same thing so in in the
JDK these are called method handles and
really a method handle is well it is
basically a lambda in a sort of way what
actually happens when you're actually
running code that uses in both dynamic
JRuby will come
I'll down to bytecode in when it detects
that Java 7 or higher is available it
legit it will generate bytecode that has
the invoke dynamic by code in it and
along with that invoke dynamic bytecode
there is a there's a little bit of
information there's a we embed a
knowledge of a bootstrap method in the
byte code so that invoke dynamic can
call over and figure out well how do I
actually get a method handle to begin
with and so if you think about you know
a list of byte code that corresponds to
some java method you know inside that
method there's one invoke dynamic byte
code that represents one instance of of
calling out to some piece of dynamic
code so we have to get you know BLT and
that that instance is what's called a
call site the call site has a target
which is the actual method handle itself
so the whole process of bootstrapping
which only occurs the very first time
that particular byte code is here is
just to say give me a call site and the
method handle would construct that whole
thing for me and I'll hold on to it so
the call site will stay static after
that point but the call so I can
actually have its have its method handle
target change dynamically as well and
the JVM is built to be able to handle
that so the method has actually looked
like this this is a portion of the
actual description abstract class and of
course there's your invoke method so
your your method half handle is a lambda
and it's got your ability to executed so
where is the fizz buzz program that we
saw was extremely verbose because of the
lack of you know additional utilities
for building up the logic method handles
actually do come with a bunch of
additional ways of sort of composing
method handles and decorating them so
you can do things like mutate the
argument lists as you as you call
through a method and there are really
interesting ways of combining all these
different utilities to do to implement
things like Java tri finally logic you
can actually using these drop arguments
and folding and guard with test and
catch exception and all that sort of
thing you can actually implement tri
finally logic completely within method
handles the other cool thing about
method handles and these basically these
sort of you know quote unquote
primitives if you will is that the
the JDK team that have been implementing
this stuff that have been specifically
going down and optimizing the way that
these primitives get implemented at the
JVM level so that if you build up a call
site specifically just by composing off
meth animals with these primitives it
will get compiled down to really fast
code and that's really the the crux of
that difference in the updates was that
the later updates there's more of this
logic that's baked in and optimized in a
way that you can really boil it down to
either you know machine code or
something much much closer to to machine
code than than the high level stuff so
right now JRuby has several different
ways that it uses in both dynamic you
even though you think of invoke dynamic
and methane ales as you know you hear
the word meth and you think oh well it's
just for method calls well we can
actually implement other things too like
we can implement a ruby constant look up
by just calling through a method handle
or a string literal or any other number
literal or like on the last example math
operations one of the things that slows
JRuby down a little bit and Ruby in
general when you're doing computational
stuff is the fact that we have we have
fixed numbs you know we have you know a
numeric tower that expands automatically
without having without having to do
overflow checking and it's obviously
harder to translate that to fast running
machine code so what we can do is we can
actually look at ruby code and look for
things like you know + operators and
things that might be numbers adjacent to
them or we're going to we're going to
make an assumption and say that that is
a plus operator for a numeric operation
and we'll just build up that code
generate bytecode for it as if it was a
pure math operation if for some reason
to actually call into it we can have
guards around that area that will escape
out and drop back to the you know the
more dynamic Ruby logic for handing
handling the + operator if it if in fact
the actual objects at runtime at that
cost that turned out to be something
other than than fixed numbers or
integers so we can you actually use the
Infonet Oh invoke dynamic you know
toolkit to do to do faster math some
benchmarks of course everybody likes
benchmarks
caveat emptor I actually got these
slides from the fellow JRuby committer
in Japan who gave a talk just the other
day about this stuff and so I so great
you just posted some slides I'll take
your benchmarks and you know pretend
that I you know spent all this time
running them but you know that I think
the numbers are still kind of telling so
what you see here is that line across
the middle here is you know the one
point 0 sort of the standard the
benchmark and so that's that's that
benchmark is JRuby running on java 7
without invoke dynamic that's right yeah
so too we have that we can run a Java 7
without invoke dynamic or we can turn it
on it will be on by default if you run
in Java 7 but you can turn it off with
flags just for comparison so you see
that in a number of cases just by
turning invoke dynamic on for things
like string literals and math operations
we get more than fifty percent
performance benefit for those micro
benchmarks now if you're interested in
the code that does these I can look it
up for you I think it's in the JRE code
base these are definitely micro
benchmarks it's very low level just
doing a bunch of small operations in a
tight loop so they're not going to apply
as much to real-world program these
benchmarks might give you a little bit
more idea of a real world program were
you actually doing some non-trivial
computations with these binary tree
algorithms and again we see the blue the
blue bars is the invoke dynamic version
of JRuby where we get almost fifty
percent improvement over without on this
AVL tree benchmark so there's definitely
performance benefits to be had and we
get this for free just by using java 7
just by using invoke dynamic and nothing
else releases of course what would do we
be without more updates we just had 167
released yesterday so you probably saw
that the idea what the 16 releases has
been that it's been a sort of our way of
kind of keeping up-to-date with either
problems that the community has been
having or you know come
ability bugs that are kind of preventing
people from continuing to to deploy
JRuby because they want the the the
JRuby master branch the one dot 7
version of jerry has been drowned out
for quite a while now I think it's been
it's probably going on nine months or so
and it's still not quite ready we've
been using the 16 branches way to roll
out additional bug fixes and so every
new bug fix released you say 167 is
going to be the last version of of JRuby
in the 16 series and then we find
another bug so so for 17 we're actually
looking at public it's probably still a
couple of months away i think there's
the masters has been pretty stable for a
while but there's still some things we
want to clean up so it's still a little
bit off I've yes yeah so we haven't
actually talked together and agreed upon
a date but I'm just going to stick my
neck out and say that maybe we'll have
something approximating at least a 17
beta or you know early access release in
may or june sometime right exactly right
in time for for JRuby cough and so if it
gets to be it gets to be that time you
know come come focus and make sure that
we get going on because it's it's really
easy for the core team just gotta be
heads down working on things and then
suddenly our heads come up and it's like
oh wow it's been three months and we
still haven't put out a release of
master so it's really easy for that to
get drawn out Christmas yeah right yeah
I want to just mention again that if any
of you guys are using jruby itself for
some of the projects around jruby and
you have you if you have any interest in
doing some open source stuff they're
always always welcome contributions and
I find lately that my time has become
more compressed and less available to do
maintenance of the of the project's
themselves so if you have an inkling
please please always you always welcome
to join us go to just the github page
forge a groobee and we have all the
projects there and then of course the
conference so we're having our fourth
annual Jay rubyconf this year and it's
happening
apolis and it might seem like a little
bit of a hike for you guys out here
sorry about that it's a little bit
closer than DC last year and Ohio the
year before that of course we're having
it in Minneapolis that's where charl
charlie Tom and I are all based and we
kind of just had this idea that yeah we
should have a conference for jruby and
in our hometown so we're looking forward
to playing host so if any of you guys
feel like joining us we're having the
conference at the Guthrie Theater which
is a sort of an internationally
recognized a piece of architecture right
on the banks of the Mississippi should
be it should be a really nice a great
venue we're going to have whiskey and
beer at a conference party and hopefully
lots of other good things planned we've
just started announcing speakers at the
website you can go there we're going to
continue to announce more or content was
go forward I'm having a lot of fun
actually putting out in the conference
planning hat myself and I've been the
conference webmaster as well which is
also been kind of cramping my my you
know availability in terms of things
that can accomplish but you know it's
another way of doing things so as far as
that's the end of my prepared material I
just want to close the talk here by
saying you know I kind of started out
thinking about what how to present this
talk and you know answer the question
well what's new in JRuby and again I
want to emphasize that really what's new
for me is just a tiny piece of it and it
really want you guys to to fill in and
you know tell me what's new for you
because it's more than likely something
that I'm not familiar with or if it is
maybe it's something that you know is a
crucial piece of feedback that going to
help us make Jerry better or help help
the adoption increase increase and I
hope that as these meetups continue have
whether or not to continue every month
i'm not sure but I'm hoping that maybe
some of you guys will step up and maybe
present a quick quick story about your
jruby use down the road as these
continues forward so I'm not sure how
we're doing on time but I'll certainly
be around for a while yet and be happy
to talk with you guys and and just talk
to every we or talk whatever you want so
thanks
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>