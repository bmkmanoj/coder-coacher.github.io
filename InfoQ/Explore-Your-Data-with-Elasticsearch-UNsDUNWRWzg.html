<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Explore Your Data with Elasticsearch | Coder Coacher - Coaching Coders</title><meta content="Explore Your Data with Elasticsearch - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Explore Your Data with Elasticsearch</b></h2><h5 class="post__date">2013-09-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/UNsDUNWRWzg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so what elasticsearch is it's a very
buzzword compliant piece of software
it's open-source it can do rest JSON
HTTP it has real time there's leucine
somewhere in there
it's very buzzword compliant what it
actually means it's a distributed data
store that's very good at searching and
analyzing data that's that's what you
should that's what you should take away
from this slide the rest is just gravy
so how do you how do you start with
elasticsearch first you need to insult
zookeeper and Annelle so you download it
you untie it
you run it you're done so it's really
that easy
I just have to I just have to inform you
if you try it right now all of your
notebooks will probably form a cluster
which you probably don't want so just
just just just a little bit of advice if
you if you do want that that's perfectly
fine it's very good way I'll just steal
data from people at a conference just
went to computers joined I'll share data
so the first step what you do with the
data store is you shove some data in in
in this in this example I'll be using
curls for all the examples there is
obviously a Python client which I'm
which I'm working on but curl is is the
the lingua franca of HTTP so we'll use
that so you just put in an index with
the type and an ID and you put some JSON
document in there you can you can
immediately get it you can delete it you
can update it you can update it by
posting a partial document that those
two then will be merged you can update
it using the scripts you can even do
absurds
nothing nothing groundbreaking there so
you have data what do you what do you do
with the data so first thing you do with
the product that's called elasticsearch
is that you actually search so there is
a there is a convenient shortcut if you
just do underscore search
q equals speed up it we'll just do a
search for meetup it will search across
all of your indices all of your types
all of your documents all of the all of
them fields so this is if you if you
really want to make sure that it's
working just do this which basically
translates into something like this I
just added one more one more thing and
this is for people that are familiar
with search this is passed into law seen
as a loss in query syntax so it's very
powerful you can do all sorts of stuff
but it's sometimes hard to read and
besides you really don't want to be in
business of concatenating strings to do
a search request or anything that we've
all been there with let's not do it
again so how you actually query the data
is we have some query DSL built on top
of your favor data form a JSON and this
is what a typical query would look like
it's a filtered query that has a query
part and a filter part we'll talk more
about the difference later and the query
is a bull query that has a that has a
must part so it's saying that in title
or body there must be Python and its
thing must not so entitled there must
not be PHP and then we are just
filtering events from events from this
year so the difference between filter
and query filters are fast cashable and
don't contribute to the score it just
limits your results that it doesn't do
anything with a score whereas query will
actually determine how well the document
matches so this is just does it match or
not and this is how well does it match
so here I'm indicating the title is more
important to me by a factor of 10
whatever that means then body so I'm
telling I'm telling elasticsearch I'm
telling my search engine that title is
more important note that it would do
something similar like that because
title is generally shorter field but I
can I can I can make really sure that it
does it
so because filters are more performant
and primarily are cashable always use
filters only when you cannot
use filters use queries just-just-just
well thumb rule ah okay and it looks
better so we've we've we've seen a we've
seen a query now query will only give
you back the documents by default it
will give you the top ten the top ten
best matching documents for your query
you can also append something that's we
call facets which are basically
aggregations here are two examples if we
are if we are searching over an
imaginary index that contains meetups we
can we can have an aggregation that we
call monthly meetups and it will based
on the date contain in the field event
date it will do by month it will do
counts so this will give me only for the
documents that match so for meetups that
that have Python in title or body and
doesn't have PHP and a have have been in
the in the last year it will give you
per month how many meetups were in in
that way and the second one is more
interesting so for each topic of those
meetups which mostly it's going to be
Python but we will we will see some
statistics on the number of attendees by
some statistics I mean are the usual
suspects sum count average a standard
deviation very basic very basic
statistics so for each topic for example
Python big data and everything will get
how many people generally attend and
what are the the statistical
characteristics and this we can do on
any on any search so already we see how
it can be useful because we can do
aggregations against any field not just
something that we are searching on but
any any field on the index
that's one brilliant part of lousine it
creates a index on every single field
you put in it by default so now let's go
a little crazy
so you're not supposed to be able to
read this it's it's okay and this is
just this is just a simple query that
does all that all that stuff so it still
has the boolean filter in this case we
this is this is an actual query that
runs against the data set from Stack
Overflow
and it will actually filter questions
based on the answers so there is some
form of relationship going on in
elasticsearch that you can define you
can say that these two types in our case
questions and answers have a
parent-child relationship so what we are
saying is that answers belong to a
question so then we when we are
searching on a question here you can
obviously read that we are searching
questions you can see give me only the
questions that have answers that match
this query which is what's happening
here obviously and then we do another
cool trick we actually take the rating
that's part of the Stack Overflow data
which is user contributed it's generally
some it's generally more reliable that
something will come up with an algorithm
on how good the question or answer is
and we will take it into account when
combining the score we will not sort by
it so something that's a very very good
match but not really a good question it
has very low rating will still show up
at the top and something that's not that
good a match but it's really good
question will also show up there so
generally something that that users
users would want from your search then
it is some faceting in some HTML
highlights not very not very interesting
so how does it that is how does this
actually look now is coming the
interesting part we've had so much great
success with technology so
so this year is cabana it's a it's a
front-end for for ls6 surge it's a
purely JavaScript Java second I know I
made a Python meetup but this is this is
more impressive and what this basically
does it queries data in elastic search
it was all written as for as a
complement to lock stash which takes all
all the logs from you from your servers
and stops it into elastic search and
this was written for for analyzing that
data and we can do some we can do some
pretty interesting things I've some have
some very simple dashboard prepared for
you so this is a histogram of all the
all the questions from from DBA Stack
Exchange this is a this is a breakdown
by tags and this is basically just a
number of these three queries which you
can also see breaking down here so I
decided to break it down by the number
of comments that a post has 0 to 2 2 to
4 4 and more and here you can see that
it's actually it's actually pretty
pretty fast
this is squaring the entire data set
from DBA exchange just on just a my
notebook I can do I can do filters I can
click on the tag hopefully now have I
belong to now I haven't and everything
everything immediately changes I can
just I can change these I can change
these queries using the full power of
office search engine so let's say it
let's see if DBS actually search
something in Python yes and here we have
the actual results the actual data we
can just click on the document inspect
all the fields so this is this is
something that that you can that you can
do with Cubana and I'm showing cabana
specifically because it's written in
JavaScript so you can be absolutely sure
that none of these aggregations none of
these things are happening in the
browser it's all happening with
elasticsearch you can actually for each
of the panel you can just click here and
see the query that is actually running
to get the data exactly in the format so
this is something that that Alice exert
can can do for you there are people that
it that do these sort of things on it on
a data sets that have
multiple tens of terabytes very very
easily because of the distributed nature
of elasticsearch so running out of time
so let's find my slides again what
happened to my slides so the demo gods
has listened to our prayers and let's
just do a quick run-through of some of
the other cool features one of one of my
favorite features is a percolator what
percolator is is a reverse search so
instead of indexing documents and then
running queries you index queries and
then you run documents how it works is
for example imagine that you have a site
like psych overflow and you want to
create alerts so I as a user come to
your site I define a search and I want
you to give me alerts when any any new
document comes in that matches my query
this is it I just I just put in the
query and I can use all the power of
elasticsearch in this query and then
when I just send in a document it will
give me a list of queries that actually
matched so if you have a feature like
that you're done like this is this is
all you need to do obviou
you can you can limit that the queries
that should be tried you don't have to
always run everything you can actually
do a query on the queries and only have
those queries that match that query
matching the queries run against the
document but because it's very difficult
to explain in 20 seconds this is this is
a very simple very simple example so
that's one one cool feature then we have
two suggesters so jesters are something
different from search we have one for
autocomplete and one for spell checking
pretty much and the thing to note here
is suggesters are fast and I mean we try
to be very fast in our searches as well
but as suggesters if we don't do a
10,000 queries per second on on a single
machine we are doing it wrong and we
really hope we are not so autocomplete
you can define a suggester then you just
do partial note that you can add some
payload to all the all the things that
you want to potential autocomplete we're
running out of time so did you mean some
people don't know that the whiskey is
actually spelled differently Johnny so
we have a phrase suggester that's
context-aware and that can give you a
spelling suggestions based on actually
the context from your own data and the
last part is just very simple yes it is
web-scale we have customers that have
over over hundreds of terabytes of data
in a single cluster it still works and
that's it this is how it looks if you
have one index it's by default divided
into five shards so this is a situation
when I have one index five shards three
nodes this is how its distributed if I
were to kill one node it would just
associate the new replicas and heal
itself and that's it so what wouldn't
you use elastic search for it seems to
be great but seriously what doesn't it
do well so there's there's as there are
several limitations one of the
limitations is if you put something in
it will not be immediately available for
search you can request it that it's that
it will be immediately available but
it's it's a potentially expensive
operation by expensive I mean tens of
milliseconds or something like that
nothing nothing brutal but by default it
will only be available after a second so
that's that's one thing if you know that
that's only for search if you want to
get it by ID it will always work always
work like this I wouldn't use it
anywhere where you need transaction
across multiple documents when you where
you need where you need stuff like that
and hmm I kind of think of any any any
other examples it's it's generally
pretty good with the combination of
structured and unstructured search if I
if I think of anything else I'll let you
know what's the replication speed of
data across the cluster and does elastic
search natively support plugins
lagoon's handlers which can handle
insert update delete events okay so we
have support for plugins in if you write
any any plug-in in Java you can do
absolutely anything but remember with
great power comes great responsibility
if you don't do something right in your
plug-in your cluster will fall because
you can actually dabble with the the
very internals of elasticsearch of
leucine from the plug-in so you can do
absolutely anything in a plug-in and
also remember it's all HTTP so if you
just want to log something if you want
to do some very basic ACL you can just
put a put a load balancer in front of it
do a simple do a simple filter on the
URL patterns or on the on the methods
because it's rest so if you only allow
get method you will only be able to
search so that's that's a half-assed
response to that I'm not sure whether
there are some already made plugins that
that would hook up into into that cycle
where you're joking about the auto
cluster forming okay what are the
security implications of running
elasticsearch no I wasn't joking that's
the default we tried the default to be
as developer friendly as possible know
that this is not a setting that you
would typically run in production first
there are several ways how to limit the
cluster formation the simplest one is if
you just name your cluster it will only
form cluster with the elasticsearch
instances that have the same name so
that's that's the first step that will
work even now if you just name your
cluster which is just one file one line
in the llamó configuration file or JSON
configuration file you can choose that
will that should be enough
also you can disable the automatic
multicast discovery you can just go you
can just use a unicast and list of seed
nodes so when when the new node comes up
it has a seed nose that will try to talk
to and get the members of the cluster
you can do it completely man
so I was not joking but the security
implications is don't run the
development settings in production
really don't and also also for for those
of you who have for example VPN access
to to production if you don't change the
name cluster name on production you have
the multicast enabled and you connect to
the VPN in production with your node
running on your notebook your notebook
and your site is going to die this has
been known to happen like suddenly
because the cluster hey there's a new
machine
let's off load part of the load there
suddenly you're serving production data
of your notebook and you generally don't
have enough space or processing power so
something to be aware of
it's definitely solvable it's not hard
but there are many a developer who did
it wrong ok so that seems to be all of
the questions if you have any more come
talk to me I'll be more than happy to
and thank you for having me
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>