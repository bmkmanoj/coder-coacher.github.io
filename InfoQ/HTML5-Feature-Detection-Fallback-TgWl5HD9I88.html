<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>HTML5 Feature Detection &amp; Fallback | Coder Coacher - Coaching Coders</title><meta content="HTML5 Feature Detection &amp; Fallback - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>HTML5 Feature Detection &amp; Fallback</b></h2><h5 class="post__date">2013-07-12</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/TgWl5HD9I88" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I got like this laser thing this is so
cool okay I'm so how many of you walked
up 10 flights of stairs to get here very
nice all of you get bonus points you
will get double the tickets for this
year unicorn which eventually we're
going to steal from Yelp at the end of
tonight alright cool so thank you for
coming as so we're going to talk about
html5 features detection and fall back I
think an alternate title for this talk
is that shiny things can break really
easily this is something we learnt as
children I remember once breaking this
surrett this ceramic bird that was my
dad's and I was like crying for hours
like that I broke your shiny bird but
then I learned about hot glue um and
somehow I thought that my hot glued
together bird was just as pretty as when
it started um it turns out it wasn't but
okay childhood aside so here's the thing
html5 there are a ton of new features
right sometimes like Friday night you
know when i'm bored and not getting any
i browse the the html5 spec in and see
what new things are are right and then i
make animated gifs of it so you can see
we've got new image for formats we've
got lots of new CSS stuff you've got big
things like web workers you've got form
input types you've got funds you have so
many things there's no way I could go
through all these right so you look at
these you like you start drooling right
especially on Friday nights and you're
like wow that's amazing this is the sort
of stuff I've wanted for years of being
a web developer toiling toiling alone in
my you know my work and Friday night um
however you know the thing about all
these features is that they're not all
available now right so when are they
available here's a quote from the the
what wig faq because they commonly got
this question when will html5 be
finished when do I get to use it right
and their their answer now is basically
never um
they say it is now considered a living
standard which means it's kind of like
asking when will humans ever be finally
evolved we are living standard solely
getting worse um but so it's really not
about when html5 is finished it's about
when can you use that particular html5
feature right so we have to look at it
as a feature by feature basis because
browsers are implementing it each
feature at a time right and then there's
like sub features of sub features of sub
features right so if we look at you know
what is it that browser support now
here's some visualizations based on can
I use com which show us you know what
the kind of support is like for four
things across many browsers and this is
also an animated gifs so let's just
reload it here there you go um so you
can see across many different features
you can see the circles you represent
the different browsers and their
versions right so any different element
you click on it has a very different
browser support right there's not one
that that is supported in every single
every single thing you cannot use common
and just yourself how do you keep track
of what's coming out and what supported
have like where do they get all the
information from okay so the question is
how do you actually keep track of this
stuff um so they are paying attention to
the specs and there's new specs coming
out a week so you pay attention to specs
and you pay attention to the browser
release notes all right so I actually
think the best way to do this is just to
go to Cooper press calm and sign up for
the html5 weekly in the JavaScript
weekly and every week it'll have a
summary of the latest browser releases
and the latest specs and there they're
really good at keeping on top of that
right so you see we've got quite the the
varied browser support for every
different feature right so that means
that if we're protein html5 and we're
thinking about a feature we need a
strategy to approach that right so the
first thing you need to do is research
and find out what browsers does this
thing actually work in right the second
thing is you have to figure out all
right assuming that it doesn't work in
all browsers how am I going to know if
it works in the
particular user's browser right because
then once you know that you have to
decide on a fallback said okay if it
doesn't work in someone's browser what
is my fallback strategy going to be
right will I show I use some inferior
technology where I show a message etc so
we'll go into details on each of these
steps right so in the research step
figuring out what browses it works on
there's actually quite a few resources
right so the one I just mentioned is can
I use calm and that's kind of my go-to
but can I use calm it's yo maintain kind
I think by just one person and it means
that it's not always it doesn't have
every single thing in it because there
are so many things in HP 05 to keep
track of so if it is here go here first
but there's a lot of other places too
there's some things specifically about
CSS specifically about CSS on mobile
specifically about html5 on mobile
specifically about xmas script five
right so I'm kind of lumpy nekomura
script 5 into html5 and css3 because
it's all things that we might be
thinking about using and for those you
know acma script is the standard that
drives javascript and actionscript five
and six are the things that the next
versions of Java Script are based on
right and there's all these like really
cool features coming out in those two so
go to those sites and also pay attention
to the notes so on these sites you
actually see like on can I use com you
see here there notes section notes
section and known issues really really
important don't ignore those right
because a lot of times there's
subtleties to the sport it's like yeah
it works but and that but becomes really
important when you've got hundreds of
users going it doesn't work and you're
like oh I should have really read the
butt right um so pay attention to any
notes because they those are the things
that are really going to bite you are
you or somebody running automated tests
against browsers and like
um so yeah the question is is somebody
running automated tests against the
browsers and nightlies probably maybe
maybe pbk is um I'd have to ask them and
see if they are it would seem like a
very clever thing to do probably PPK
does for his mobile compatibility chart
um so then we move on to detection right
so how do we know if a particular
feature works and we have a couple
different strategies for this so the
first obvious way is feature detection
right so the way we detected features
like we kind of asked the browser like
hey is this feature in you right so if
we were doing something like JavaScript
api's for JavaScript API eyes will say
something like okay you know where is
this this global variable WebKit audio
context is that defined on window right
so we assume that if the browser
supports it then defines it and so you
may have the prefix version and then
maybe a nun prefix version for checking
on supporting audio and then for
checking if new HTML elements are
supported you might try and like create
them and then see if a particular
attribute is defined or this example
here is showing creating an SVG element
and then checking to see if the
namespace gets set on it that's kind of
more advanced for checking HTML elements
for CSS you could actually try and
create an element and check to see if
that element by default has that CSS
property find on it but really we don't
want to be figuring out how to detect
features for every single thing we do so
browsers are working on a standard way
to support to give you feature detection
because all those things are kind of
things we are making up right so one of
the cool things that they're doing is
something called CSS conditionals and
there is a spec about this if you enjoy
reading specs and so what that'll be is
that you can actually in your CSS you
can say at supports and if the browser
supports that it will then execute the
rule inside that right so that's pretty
cool it means you can serve some rules
based on whether it passes this at
supports kind of like how we would media
queries and we can also access this via
JavaScript so we can say okay all right
if it supports the CSS then we're going
to do some stuff as well right so this
is pretty cool this
is in a couple browsers now opera Chrome
Firefox and so you can start to you know
try to use it but it's not in all
browsers right so it's not something you
for everything and it's only for CSS
right so what should you really be using
for feature detection is does it detect
with and walk prefixes um probably yeah
yeah I probably would recommend reading
the spec I didn't actually write the
spec so I haven't memorized all of it
yet I started reading the xmas scripts
spec last night that's that's it's a
good one so I started I got really
excited the beginning because there's
like this diagram of how it's like a
prototype based language and he like
follow the prototype so long as I guess
so goes like a children's book um and
then I kept going and there were no more
diagrams was like what happened god I
thought this was going to be a picture
book what's happened um okay so here's
the thing right so you can you do all
that feature detection stuff and you can
be like oh I wonder this is how i would
i would sport i detect this right but do
not reinvent the wheel there are so many
people out there reinventing the wheel
and silly because there's like billions
of web developers in san francisco alone
I've done the stats um and uh and there
are people there who have already
figured out how to detect what it is
that you're trying to detect and most of
them have actually put it into the
moderniser library right so the
moderniser library is a community open
source project with a lot of
contributions from very smart people who
are trying to figure out what's the best
way to support a particular feature
right so when I'm thinking about doing
some feature detection I go straight to
moderniser right and you can for
modernizer you can use a couple
different ways you could it actually
include a script tag and then once you
do that modernizes will automatically
run all these tests and then it'll add
class names to your HTML tag and it will
also add j/s properties to a global
right so that means for the class names
if you wanted to do something based on
SVG support you could just say oh if the
HTML tag has SVG on it that means it
supports it and then you can serve this
rule right or javascript
you say Oh with moderniser dot SVG or if
moderniser touch right that's that's one
way or two ways of using it the other
way that I use modernizer is that I just
go straight to their github repo and I
copy paste the particular feature
detection that they have for whatever
I'm using right so they do do
incremental build so you can totally do
a build a modernizer that only has a
feature text you're interested in but
for some reason I just like to copy
paste from them but you know lots of
different ways but just consult that
first check their issue trackers because
they have lots of interesting
discussions about about the different
things and issues that might come up and
you'll find out if there's actually
something kind of up with that
particular feature tax but go there
first because that's where everybody is
putting all their community resources
into right um so feature detection is
really awesome when it works right
because you're like wow this is what I
should be doing I should be asking the
the browser if it supports it but this
doesn't always work there is not always
a way to ask the browser right sometimes
there's just nothing exposed that will
tell you whether it works so when it
doesn't work we have to use the horrible
user agent sniffing right whichever was
like oh god no um it's that's how you
react right sir you know user agent
sniffing good old window navigator user
agent good old regex and you're like oh
am i on an iPhone or an iPad beautiful
and that might be a really really basic
check there right maybe if you wanted a
more advanced check your checking for
mobile browsers right oh you think this
is bad just wait if you wanted all
mobile browsers this is what your reg ex
would look like right I'm sure those of
you who I you enjoy regex are just
really enjoying yourself right now ah
for a response of a lot of em they use
green size as a dremel bring you that
these trim your tree
so the question is can you use screen
size to trim your tree down um
inappropriate ah so I mean you can use
screen size but that's that is kind of
relying on the fact that there happens
to be a browser with those exact
dimensions and that if so there's so if
somebody comes up with its I so I
wouldn't really use that because what
happens if they're then using Chrome on
something with that particular size
right so the browser is not the same as
the hardware so I would be wary of doing
that right but depending on what you're
doing maybe it'll work yeah so user
agent sniffing can get really nasty
especially if you're making up your own
regex right um so once again other
people have done this in the past unless
you really get off on regex don't try
and do it right and I don't understand
why you would do that so um what I'd
recommend instead is to use the you a
parser library so once again this is a
community open source project that lots
of people contribute to it was created
by browser stack but it's used by Google
Facebook lots of places and it's got a
really good approach in that it actually
defines all the red x's in a lamo file
which is yet another markup language I'm
and then it will generate libraries for
all the different languages from that
yamo right so automatically so we'd have
the same red x's in Python in javascript
and PHP and Ruby and all that stuff
right cuz sometimes you do want to check
this stuff on the server to and then
it's got a consistent API for accessing
you know the family and the major in the
minor version all that stuff right so
this is if you are going to do user
agent sniffing I would recommend going
here first um and you know get grabbing
whatever port is best for you or at
least looking at their reg ex is that
yambol to see what it is they're using
right because otherwise you will end up
wrong right like you might think that if
you're detecting chrome in the string
it's chrome but that's probably not true
cuz you could actually be looking at an
IE with chrome frame installed right um
so I've had even
very common user agent libraries fail on
edge cases like that and edge cases like
IE with chrome frame actually matter
quite a bit when you're you know serving
something the users are debugging
something okay alright so you can also
mix and match right so I've had to do
this quite a bit where I'd be like
alright I'm going to do this for every
device that is touch enabled but not on
safari for because I happen to know that
there is a bug on safari for that means
that this doesn't work so here so one of
the reasons that people really don't
like user agent sniffing is because a
lot of people use user agent something
to whitelist people into features and
say hey you can only have this feature
if you're on chrome and ie because
Firefox doesn't support it right now but
then if firefox comes out the next day
and does support it then you've got
users that can't use that feature for no
good reason right because you've
whitelisted who can use that feature
right as opposed to this approach where
you're basically saying like all right
anyone can use it has touch enabled but
if you happen to be on this browser that
I have proven to not work then you can't
use it right now so far as a little
tricky because if I did safari for major
version 4 it's possible that maybe
there's a gonna if this was one spy for
was out maybe they'd come up with a new
minor version that did fix it but I'm
not I'm not excluding to may users right
and you could get more and more specific
there you can specify the major in the
minor and greater than less less than a
particular minor and all that stuff
right so it is a little bit more future
proof than the technique of using user
agent sipping to whitelist people into a
feature right because especially with
html5 these browsers are coming up with
the support for the new features like
pretty frequently right so there was a
Firefox released last week that included
support for input type equals range
right and so you don't want to be
sitting there you know keeping track of
when these features or something to
supported you ideally want your code to
just kind of work when they do ok so
that was detection right um so now you
know we figured out that doesn't work in
someone's browser so what are we going
to fall back to because most of time it
is
going to work in all browsers so we need
some some strategy right so one thing is
something called a shim and shim is
basically a library that lets us use
these new features and older browsers
using some sort of fall back technology
all right so one example is the file API
so this is like if I wanted have drag
and drop right drag and drop is awesome
and by the way drag and drop is based on
IES implementation of drag and drop so
just so you know you can't blame IE for
not being cool because I II actually
invented a lot of stuff we're using
today so I know oh by the way html5 spec
at the very bottom says thank you to IE
for coming up with a lot of stuff see
that's why you read specs all right
anyway so now I'm allowed to make fun of
my you for the rest of time all right um
so uh you know if we want to do some
drag and drop the file API kind of makes
up this way of doing it says oh okay all
right if you want to listen to drag drop
event and when you get this over you're
going to do this and this and this right
and you just read the documentation
you're like oh okay that's how I'm gonna
drop and drag and drop and behind the
scenes whoever wrote that library is
going to make sure that it works in all
the browsers that they claim it works in
right so that's pretty cool even cooler
is something called polyfills all right
so polyfill is a shim but a shim that
mimics the future interface of the API
so the idea behind a polyfill is that if
we do things using polyfills then at
some point we can just take out the
polyfill javascript and our feature
works according to the current browser
spec right so that's pretty cool because
that's kind of the ultimate dream right
is that eventually we're using all
native technology and we're don't have
any of these fallbacks in there so
people go through a lot of effort now to
try and make things that are polyfills
instead of just shims so that is you
know you can have this kind of
transparent switch out behind right so
one the simplest example I could fit on
a slide was for a new xmas crypt feature
or JavaScript so JavaScript finally has
a for each um and that's pretty cool
because we can iterate over stuff and
array this is something every other
language has had four you know 50 years
um but if we wanted to shim it we can
say okay if for each is not to find on
the array prototype then we can just say
reach and you know it's actually a
pretty straightforward shim or polyfill
here right um so that's cool and
actually if you go through the mdn the
Mozilla developer Network docs they have
polyfills for pretty much every new
atmos crypt feature and but really what
you should use is es5 sham or es6 gym
because they will do it all for you as
well so if you're interested in writing
a polyfill there is various articles
that actually tell you how you know give
you good advice for how do you write a
polyfill because it is a little tricky
sometimes to figure out how to mimic an
API but actually use something else
behind the scenes yeah good question so
as I saying like yeah you shouldn't be
making up these yourself most of time
because a lot of people have already
done it because html5 been around for a
while so we have a ton of resources
right so the best one is the all-in-one
entirely not alphabetical no
guide to html5 fallbacks so here we go
we see a long list of polyfills and
shims so SVG canvas elements videos
audio web sequel indexdb forms I don't
know where my school okay I'm thirty
percent geolocation you know you can do
animated pings now awesome um meter all
these new form elements data said they
did a list file API web RTC web-dl Web
Audio this is also a good list of
everything you do in html5 postmessage
cores pointer events at my skirt five
here we go so there we go es five shim I
was a colleague with him cool and then
equus group 6 has an es6 shim um and
then we've got CSS stuff lots of CSS
stuff let's use us everything and then
there's everything um
and you can contribute to this because
it is a github wiki yeah so there's a
long list on here in the the es shims
are linked from here but this is
probably the first one to consult you
can certainly try googling you know blah
blah polyfill blah blah shim and you'll
probably find some little stack of reply
answer but what I would do is I would go
here I would I would look at a project
right so we go and like all right let's
look at that yes five shim right and
we'll check it out so then what I look
at is I look at the number of stars and
I look up the number of forks um so it
approximately has a shitload so that's
good um it's all so let's look at recent
activity six days ago that's good yeah
so it's a recently active project
especially comport enforce Mel five
shims and poly bills because browsers
are changing stuff all the time with
these new api's so you definitely want
to see something that's active um also
what I also look at is issues right so
15 issues Wow it only has 15 issues 15
open 152 clothes that's pretty cool too
right that's a pretty good ratio doesn't
have too many open ones i also will look
at an individual issue to see how
douchey the maintainer czar um oh
actually kick it's really cool so uh
yeah so i'm not sure if i'm going to
find an example of what see one comment
I agree soak it is awesome so this looks
like an amazing library right it's
active it's got a lot of people using it
it doesn't have that many issues animal
trainers are really quite agreeable
right that's what I want so this is
actually a perfect you know I know
randomly picked this to that is a
perfect library to use so look at all
that stuff also of course look at
browser coverage some some polyfills
will specifically not support older
browsers may be their only targeted for
mobile so take a look and see does this
actually work for the browsers that I'm
particularly interested because you'll
find some people will purposely want to
do something that involves fall like a
lot of fall backs and some people are
really just saying hey this is a
lightweight version that you use when
you're just doing like an Android iOS
app right so that's that's pretty
important to
um so yeah that this is what you should
look to for first and I think you'll
find for quite a lot of features that
there is going to be a polyfill and shim
available hopefully um alright so the
other alternative is when you're
considering what to do for fall back is
you could just not have the feature if
it doesn't work in the browser right so
particularly for stuff like CSS right a
lot of css3 stuff is like I'm sorry if
you visit our site in an old IE it will
be square right and that's totally cool
because that's like flat design now
anyway right uh so they get like the new
modern thing right so there's a there's
a lovely website do websites need to
look exactly the same in every browser
com um that exposes you know a really
good explanation of this there you go so
it's just it's really it's not worth the
effort for some things to make them look
exactly the same right like you don't
have a box shadow the word will go on
it'll probably perform better in those
older browsers to UM so I you know for
some things you might consider just not
using it right um particularly for
styling things right you're not going to
always get away with that um you could
also tell the users right you could say
hey if you want this feature do this
whole newer browser right so like I was
just learning probability on Khan
Academy right and they have a little
speed up but and I was like I need this
beat up because I'm so used to Don
chrisarah like I need to speed up every
video i watch even like music videos and
I clicked on the speed up and it said oh
you're actually using the flash player
right now if you want this you have to
go and opt into the html5 player instead
and reload the page and I was like okay
done I will I will do that right so that
was kind of cool is that they showed
users that the option existed and when
you click it it's like oh well yeah you
can do this if you actually go and you
know upgrade your browser or change your
settings or something like that so I
thought that was kind of that was kind
of a cool thing to let people know that
there is a path forward to this
functionality if they want it right
because maybe maybe they'll watch e
upgrade yeah we know um okay all right
so that's our general strategy right so
we research we figure out how to detect
and how to fall back and that's the
rough order that we should do things
don't always do it in that order so now
I'm going to go through some like true
stories like Tales from the Crypt of you
guys I'll watch that show when your kids
yeah i was gonna get the this green but
it's too scary um so uh some stories of
some features that we've wanted at
chrisarah and what the process has been
like with using those right so start
with something simple our designer
wanted us to have SPG logos right
because he had a Retina Display machine
and he has like perfect eyesight and
when he looked at our logos he's like oh
they're so blurry I was like what I
can't see anything um but I'd like all
right all right all right fine this is
pretty straightforward let's do it I I
believe you so you know so we wanted SPG
logos which would mean that on any I
naughty display on any zoom we would get
these nice crisp lines right um so you
research right and estrogen is an
interesting one because there's not such
it's not just does SVG work it's does
SVG work in CSS backgrounds does SPG
work as the image source does it work in
line xml doesn't work as like an object
SVG embedded there's there's like 10
different variations on the ways you can
use SVD inside a page since it's not
quite HTML it's like this image format
it's kind of in between and then there's
all these different features inside SPG
itself that you could check on right but
this is a pretty standard SVG file and
so I was just checking does it work in
CSS backgrounds right so it basically
works there is some bug where SVG images
blurry and scaled on firefox but since
everything's blurry to me anyway I was
like fine whatever um so the way I did
this I actually didn't find the check
that i needed and modernizer i found it
in a different blog post about this
particular technique but i put in my
detection and
little you to library that actually it
checks this document implementation
object and that will end up telling us
if it'll work and so then I add the
sports SVG class to the main root
element of the document and then once
I've done that I can then start off so
here it's not really a fallback it's
like a fall forward or whatever but I
start off with my normal ping defined as
the background of the logo and then I
say okay if we are in a browser that
supports SPG then we serve the SVG logo
instead all right and there's a whole
blog post about doing this in particular
so it's probably like the easiest way
that you could please your designer
tomorrow if you just go home and do this
um so this was really straightforward
right and it actually it worked fine and
there were no issues with it most of the
time there are issues so now we're going
to talk about issues all right so we
wanted rich text areas right because we
have all these places on our site where
users want to give us rich text right we
have discussion forums we've got these
admin interfaces it's like on twenty
percent of our site right so we were
using um was it you guys know I'm
talking about hmmm no the one that
starts with T thank you yeah I mean yeah
now you're not gonna get the Unicorn
come on so yeah we were using tiny MCE
but didn't love it tiny MCE is a is it
it's an HTML editor rich text editor has
been around for a while and we weren't
we weren't in love with it and it wasn't
the most extensible and had some issues
so I was like oh well we'll just use
something new will use something more
modern right we're like all right we
want a modern text area that uses modern
technologies yeah so then we had to look
at like all right how can we do this in
modern html5 right so what does html5
have so we have text areas but that's
not going to give us anything because we
don't have anything rich we do have this
thing called cotton editable and you can
put content editable as an attribute on
anything all right right so I'm actually
typing inside a constant and it'll div
right now I could
delete it and all that stuff and it's
actually good if you look at it I'm not
going to leave this because I'm trying
to do it's got really good support right
it's all the way back even ie8 has it
right so that's pretty neat so I was
like okay this is cool this is cool we
can kind of do this rich texting but we
don't have any buttons right when you're
making a rich text area you want button
so that people can click them and they
can say oh now I want to go bold now I
want to go talak and then you also want
keyboard shortcuts right so basically
there is nothing in html5 which is like
a rich text area element so it's like
all right there's actually quite a bit
of work that you have to go through to
make this rich text area element with a
toolbar and keyboard accessibility and
all of that so I decided that I was not
going to reinvent the wheel and I went
looking for a library right and so I
went and found wizzy html5 right so with
a 05 it says open source rich text
editor based on html5 technology and
progressive enhancement approach and it
had great browser support right all the
browsers that we cared about and I was
it go this is awesome and behind the
scenes it uses contenteditable right
because this is the kind of the best way
to do something like that in modern
browsers so it's like this is so cool
yeah this is gonna be amazing right and
so let's just look at how wizzy html5
does things right so in this case this
is all wizzy html5 code I'm just giving
you a look inside their code to kind of
show you how crazy it is so you don't
think about doing it all right so this
is their function to check if
contenteditable supported right so they
check to see if contenteditable is an
attribute of an element all right so
that's kind of your your bare query but
then they check this thing to see if
exec command exists on the document and
also they have these query command
supported things that they check for
that has something to do with I think
mutation events something crazy and then
we check for query selector and query
selector all guys probably know that and
then finally we check to see if it's an
incompatible mobile browser right so
this time talking about feature
detection first and then blacklisting
bad browsers so basically says content
edible is
unusable in some mobile browsers right
and then so finally whether it's going
to do this is based on all this stuff
right so that simply dictates whether
wizzy html5 uses a text area or a
Content animal div because the whole
idea of wiz eh15 is that it backs down
to a text area if it can't do this but
the crazy thing is that it also has all
of these functions here for checking
little other things that it supports as
well right so it's like does it throw
the mix content warning when the iframe
sources empty does it insert line breaks
on return does it auto scroll to carat
does it clear list and content edible
corrected can you select images and
edible these are all feature detection
functions it has like 50 feature
detection functions inside his code base
in order to figure out little things
about the way it works inside right so
yes this will tell us if it roughly
works and the all this information here
will tell us how to tell it how to act
in particular places right so it's got
quite a complex code base in order to
work around all the different ways that
browsers support compatible right so
this is one of the points to really get
across is that it's not just as simple
as checking to see if something works
there's all the different ways that
something can work and you will have to
work around all those different ways as
well if you intend to use one of these
new features right expose you something
complex like content editable now we're
actually you know using wizzy html5 and
how it works you create a text area and
then you say oh creating new text area
around this and then with the html5
we'll just say okay if it's not
compatible then we're just going to
return otherwise it'll go on to make its
hole view full rich view right but it's
quite a complex code base so I recommend
reading that on Saturday nights um so
what I learned from from this here and
you see in a second is that this content
editable is a bit finicky right so what
happens is so I wrote I you know I
rewrote all of our text areas to use
radiation 5 and it looks really cool on
my chrome and I'm on Firefox I was like
this is awesome and I pushed out our new
phone
rooms and then I get the next day just
all these people on their iPads going I
can't use this crazy things are
happening my carrots are going
everywhere and they were freaking out
right they were literally using all caps
right because what I've learned about
users is that they use all caps um this
was I screenshotted a nice one the nice
one who was like giving like a little
like ordered list of all the things to
do and I much appreciated his post right
it was much less stressful than the
hundred other all caps posts um so
basically what happened is that there
was an issue in ipad with continental
where it actually like according to
wizzy html5 ipad should work but because
of some strange interaction with the
fact that we had a scrolling page and
the fact that we had different events
bound or something like that it wasn't
working and it was really really hard
for users to type right and people were
freaking out because they basically felt
like they couldn't contribute to
conversations and that basically meant
that this part of the other forums were
unusable right um so I couldn't figure
out like okay so I'll tell you this
debugging carrots is really really hard
when I said carry something like the
little thingy their right not just um so
so debugging characters really hard like
when I worked two years ago on a
phonegap app I once spent a week
debugging an issue with carrots on the
Android Browser we're like the carrot
wouldn't go to the right place and it's
very hard to debug because you can't
emulate it it's only going to happen on
the exact advice and there's nothing
there's not that much programmatic
debugging support for carrot location
right so when something weird happens
with carrots you are going to spend a
long time debugging it right so I
already learned that dealing with carrot
issues is not something I wanted to do
so like all right what can I do instead
I was like well I could just always
serve iPad users a text area right so
that's what I did I was like yeah you
got a text area um they didn't really
like that that much they wanted to be
able to express their like their
boldness and and their new lines all
right new lines are a big thing too um
and I was like all right well what's one
we could do that I was like well I could
just let them do markdown right cuz
markdown it would
care of turning new lines in to be ours
and you could just do it with a text
area and of course every programmer in
the world loves marked down so i also
had all these programmers that were
begging me to get marked down back so i
spent the next week implementing a
markdown mode for this editor right
which would actually just convert to h
moba hind the scenes and so then what I
have in the code is like okay if its iOS
we always give a markdown all right
because basically we've determined that
for whatever reason content editable has
too many issues on iOS and they are
beyond the reach of my puny human brain
to figure out so we give them markdown
right but this was really kind of
upsetting for us because it was like wow
you know we were gonna have this new
modern experience and we weren't able to
do to just weird issues and continental
right and I spent a while just looking
through WebKit bugs trying to figure out
which WebKit but it was because when you
when you look into it you will start to
see oh yeah there are people talking
about strange stuff in Compton editable
on ipad right um but that's when you
really start to look into it right so
yeah so what did we learn here like you
know features like contenteditable there
they're really subtle they can break in
really subtle ways and you have to be
very very careful when you use them so
that wasn't the most pleasant experience
but let's go to videos right so one of
they are basically the main thing that
people do on Coursera is they watch
videos right of the lectures here's my
favorite Dan Ariely um and you know
we've got videos we've got subtitles
subtitles are actually something that we
need to have because we're obligated by
contract to have them because you need
them for accessibility reasons so we
wanted to be able to play videos across
multiple browsers which includes
browsers where flash doesn't work like
ipad because we actually have like ten
percent of users on ipad and we also
needed subtitle support right so we
started to look into it all right if you
look at the video tag and you look at
his support tables you'll see pretty
decent support right so we see ie8
doesn't have it but you can think
yourself like oh okay well you know we
could just use flash on I
eight right and that's not even that
many users for us so that's cool but
then you look at the HTML spec and you
see in the HTML spec they said it would
be helpful for interoperability if all
browsers could support the same codex
however there are no known codecs that
satisfy all the current players we need
a codec that's known to not require per
unit per distributed licensing that's
compatible with the open source of L
model that is of sufficient quality
quantity to be usable and it's not an
additional submarine Pat and risk for
large companies I I don't even know what
a patent risks their summary patent escs
is but basically the point is that the
html5 spec editors couldn't come up with
a Kodak that they could reasonably
recommend to every browser so they said
do your own thing right so the browser's
did their own thing so that means you
have to look up video codec support to
to make sure that you're going to output
your videos and all the required formats
so if you look at this lovely table here
from Wikipedia you will notice that
there is no column that is green all the
way down which means there is no format
that works in every browser right some
of them with your some with HS for some
with web M so that means you will always
have to output your videos in at least
two formats to get them to work across
all the browsers so we're going with I
think we have web M and mp4 h.264 right
now because that will get us that will
get us all of the the browsers right so
that makes life interesting as well but
then there's also all these features of
the video tag right so there's a lot of
browsers to support the video tag but
what about the actual different things
that we could do with it right because
there's quite a bit of things so the
thing that we are really concerned about
is the track tag that's what lets you
specify subtitles so if you look at this
other chart for it from longtail video
com we can see that there's not very
good support for the track tagged right
according to this there's basically none
in Firefox or iOS or Android right so
that means that we are going to have to
come up with our own way of overlaying
subtitles in those browsers so after you
do all this research you think to
yourself right I don't want to really
deal with any of that right
that seems it's really complicated
luckily people have already come up with
approaches to this right so there's
quite a few rappers for html5 video tag
right so list of them here video Jas
lean back caption a Tourette's cetera so
we went with media element Jas and this
was like a year and a half ago when they
were starting chrisarah because it
seemed to have everything we needed
right so we needed a flash ball back we
needed support for tracks and we also
needed to be extendable because there's
a lot of other things that our videos do
too like we overlay the video quizzes we
have this like slide thing on the side
where you can sink the slides to the
video and and all this stuff so we need
to be able to build on top of it so if
we look at media element is once again
I'll just give you a little insight into
what it's like to detect things inside a
video library right so on the video tag
we have this lovely attribute can play
type so can play type will return
probably maybe no or empty string I'm
and this is a real spec this is a real
thing that somebody came up with because
they decided that was the best way so
basically what you do is you get you
pass it a type of file you say okay I
have an mp4 can you say it can you serve
it and then they say back probably or
maybe no um and actually it's not even
know anymore so now empty string
actually means no but you still have to
check for no cuz it snow in the older
browsers I kind of found noah's better
um uh so this is kind of a weird API but
okay we're going to use it right so in
media element yes first we have a hack
for android I love this media element es
has a natural property which is is
busted Android right I feel it's kind of
redundant right like you could just say
is Android um I'm not sure if there's a
distinction but okay so so there they
remember what this is this is a polyfill
right so they polyfill can play type if
we're on a busted Android and have it
returned based on the things that they
know that an Android can show right
which could be wrong in the future but
hey you gotta do what you gotta do all
right and then they go through
because you can have multiple source
files so they go through each of the
source files and they'll check to see if
can play type basically equals to an
empty string or does not equal to an
empty string and then they also have two
special case is one thing in safari five
point two point three of course and so
after this they can determine whether
whether the video element can actually
play the type that you've been given it
in that browser right and then if that
browser can't play that video type it'll
go and fall back to flash instead um so
for falling back to flash it'll it comes
with its own little Swift file and it'll
serve a swift file on that Swift file
will play the video instead all right so
hopefully you've actually given it a
format that does work on ipad since the
flash isn't going to work right but it
also has silverlake fallbacks in case
anybody's silverlight i think that's the
main ones at i/o and a youtube actually
we've got youtube in there too if you
wanted a host on YouTube and YouTube
would do its own fallback so you have
like a library that's wrapping on top of
a library which has its own fall backs
and crazy stuff happens so yeah so if we
want to actually use this library will
create a video tag we have our multiple
sources we have our track tag and then
we pass this into the media element
player and make it all right all of
these snippets are highly simplified I
recommend actually browsing the code if
you like have dinner that you're trying
to vomit or something um and you'll see
that it's quite a bit longer like you
but I have to cut it down to fit on
slides right we've got probably I don't
know five hundred or thousand lines of
code that actually wraps on top of this
little bit here right but I couldn't fit
that all alright so what I've learned
with this thing is that when you've got
fall back so that means you have double
technology which basically means you
have double any trouble you would
normally have a technology right so that
means that any time we make a change to
video it takes twice as long for our QA
team to test it because they need to
test flash and html5 right it means we
get twice the bug reports from students
and every time we get a bug report we
have two very explicitly ask them like
hey was it age 15 or was it flash all
right otherwise it's very hard to debug
and it is just twice the maintenance
Bergen right because if something
suddenly happens with flash tomorrow or
suddenly
thing happens the video tag tomorrow we
have to take care of that right and we
you know we have other things that we
have that we'd like to do instead of
just maintain you know these videos all
day but it turns out you know
happen so what happens alright so this
happened quite recently and I apologize
to those of you suffering from it right
now but basically chrome 25 came out or
chrome 27 came out and in that version a
our videos were no longer loading right
we literally did not touch our video
code whatsoever but something about
Chrome's internals changed in such a way
that our videos stopped loading and some
people notice this in Chrome Canary but
you know sometimes things gets fixed but
now it's actually in chrome stable and
we've got tons of users that are
freaking out and going the videos aren't
loading and as much as I've been
tweeting at the chrome team to fix it
they're not fixing it so we have to fix
it instead right so we have to come up
with some work around so I spent I spent
four hours on Monday calming teen
outlines out of an 800 line file until
our videos worked um and I got it but it
wasn't the most pleasant afternoon um so
yeah that can happen right so suddenly
in the middle of us trying to work on
new features it's like oh oh guess what
something about chrome changed and your
feature which work before it didn't work
before right this is what can happen
when you're using new technology right
subtle things will change about the
browsers and your stuff won't work
anymore right now unfortunately even old
technology can be bad right so flash
unfortunately gets security issues from
time to time and people found in xss
vulnerability in this media element
library so when that happened we had to
upgrade the the whole library and and
the flash and all that stuff and said
and that also took several days of time
because we had to have QA go through and
do several nights of QA right so that's
not good um and then the thing is we
have this like detection where we think
we're serving what the user can see but
it is saying we don't always tell right
there's nothing that we can do to
programmatically detect the fact that
that chrome video isn't really loading
okay maybe there's something we can do
right but weird stuff will happen with
ml5 video like it works and like it it
breaks in weird ways right maybe the
audio is slightly off maybe it's kind of
pix elated right and so it's really hard
for her to detect all those things so we
have to give the users tons of options
to change so we have it on the video
lecture page where it says okay if
you're having trouble maybe you should
change players and we have a little
button there we've moved it onto the
player itself and honestly at this point
we're thinking of just making it like
really freaking obvious like just have
the giant thing that says look just
click it because this is the number one
reports that we get from people is the
problems with videos and most of time
it's fixed by going to flash so my my
colleague actually wants us just a
default to flash which I'm really
tempted to do because flash at least has
less issues than the html5 player right
and if they wanted to be all adventurous
they could go to html5 right yeah like
trying to play a video and a hidden
frame and observe it's treating and if
it doesn't stream past a certain point
uh yeah so can you do an existential
test like check to see if it's dreams I
think you could totally do that question
is too like whether i want to go to the
effort of you because i think that will
that will that will if we did that like
if we tried to see oh if we try to
detect the fact that it's doing that
infinite loading thing i bet we could
find a way to detect that by checking
how many stream how many bytes have gone
by but I don't know if we'd be able to
detect everything right because that's
the issue we're facing this week but you
know next week it could be sound out of
sync right I'm not sure how I would
detect that it could be little
pixilation issues okay I have to render
to a canvas tag and detect blocks of
pixels so I think some of them you could
detect um but not not everything some of
these things are weird so those are just
a sampling of stories I have a holder
talk which has like five other stories
in it but the idea is just to give you a
taste of what can happen right and I
know that I'm not always like the most
pleasant in my stories so it's not that
I want to like scare people right and if
I was like national 5 advantages I
probably get fired
but um but I I want everyone to be
forewarned right that these things can
happen that it's not all you know shiny
happy roses right because these 805
features are really really tempting
right and you look at them and you think
oh my god you know everything's gonna be
so much easier with this feature but
then you know when you when you start to
use it these weird things can happen
they can break in weird ways and you can
end up going through a lot of effort
because you decided to make that
decision to go with this new technology
right so I would suggest that you know
when you're thinking about using these
Asian well five features do you have the
time right it is going to take your time
you're going to have to research you're
going to have to evaluate different
different polyfills and shims to use
you're going to have to maintain it
afterwards or it and saying like the
maintenance version can be big do you
have the resources right one of the
problems with that wizzy html5 issue is
that I was not set up for debugging on
an iPad right because we've never had
I've had issues before that day and so
it wasn't something that I had a whole
you know when you're doing mobile
debugging like you have a whole mobile
setup right I didn't have that setup
because we haven't had mobile issues
before so it took me a week just to get
an ipad set up in such a way that I
could actually test this issue and then
getting to set up so I could test
locally and do fast reloads and all that
stuff that took another few days so you
know there's the resources to actually
check that these things work and to have
QA that can make sure that they're
working in all your browsers and do you
want to be the pioneer right because
some of these things you're going to be
the first one to try and go down that
route and yeah there's lots I said
there's lots of polyfills and people
have invented the wheel but they may not
have used that polyfill for the
particular usage that you're using it
for right so it might work great for
their usage and probably looks fantastic
on their demo page but when you start to
integrating your app and you have your
particular users using it inside your UI
there might be something about it where
it doesn't work and it could just fall
down completely right so you're going to
have to be the pioneer there that
figures out why doesn't work and comes
up with the patch and documents it and
then you know gives a lightning talk
about it here and all that stuff right
and so you have to be willing to be that
pioneer if you're going to take these
things on and you can totally do it it's
kind of fun right it's like I'm go
in to traipse in the new land i'm going
to be able to look for my little flag
here um and it's cool but i wouldn't
recommend being the pioneer of
everything right because at some point
you probably are trying to get a feature
out to protect users and your users they
kind of want just want the feature right
they don't really care that much that
you know you you manage to fix this one
bug that you know nobody else was able
to fix right so you kind of I think you
know we kind of balance in web
development like okay are we going to
use the tried-and-true technique here
are we going to try something a little
different a little crazy and you know we
will be willing to put the time into
this urn right and you can totally opted
to go for you know kind of balance and
opted to go for the crazy sometimes cuz
that's fun right and it's it's like a
little scavenger hunt um and do you have
an alternative all right sometimes you
just don't know them turn it right we
you know we pretty much have to use
html5 video tag because we don't have
any other options on ipad right so we're
going to have to make it work somehow
right so you know maybe there's a
different way we get a different library
we could use but we're basically going
to have to use that video tag somehow
right so you have to consider what your
alternatives are but I yeah by all means
go for it try it out and good luck and I
hope that whatever you find document it
right if you find something blood write
a blog post submit a pull request with
with your fixes file an issue on web cut
or the Android tracker that says this is
busted I file so many issues on the hand
wrote racket they probably won't be on a
blacklist right um so just just share
what you learn because in html5 like
we're all you know everything is
changing so much so we're all there's
all this new stuff to learn all the time
so it's kind of up to us to document
that and share it with the rest
comedians we could go along right so
that's it thank you
questions compliments right so that's a
good question so when it comes to the
html5 versus flash for the video is it
do the browser or to do the features I
do believe it's do the features we're
using since we we actually only get the
issue with us when we're using subtitles
so it has something to do with subtitles
it has something to do with the rapper
library using and so in order to figure
out what it is that's actually going on
I would have to reach inside that rapper
library and and debug that right so I
commented out as many lines of code I
couldn't I couldn't our code to try and
see if that would get rid of the issue
and I was hoping that I wouldn't have to
also comment out every line in the media
element code to write because we did
when we did find that issue the first
thing we did was that we created a test
page with just the video tag without
media element jas with exactly the same
sources and tracks worked fine so it has
something to do with the rappers on top
of the rapper's right but figuring out
where it is hard so that is something to
be aware when you when you use these
rapper libraries so when you're looking
those rapper libraries the final thing
that I didn't do was look at the court
code right because at some point you
will have to look at the code and if
that shit's nasty you were going to be
sad right so look at the code and see
you know is this written in a way that I
would feel comfortable going into it and
you know trying to debug it right
because I think that I the vast majority
of the time that I've used a rapper
library I have gone into the code and
sometimes it's made me very afraid yeah
okay so the question is how do you
balance your day job with also i guess
like contributing back community and
keeping track of everything going on in
the world so I was saying oh actually I
don't keep track of anything going on
the world but the web world yeah so
first of all yet stop paying attention
to politics that is really complicated
stuff um
uh-uh so I only asain I the only news i
subscribe do is the cooper press
newsletters right you could actually
turn off hacker news and Twitter and all
that stuff and you would find out about
all the top links basically from those
newsletters so and that only takes me
like so i'll get those newsletters once
a week and i'll just like open up like
10 of the links i'll give them a
look-see and I was like cool i'm on
board i get what's going on there so i
think that's a really nice way of
keeping on track in terms of a
contributing back yeah so i write i have
like this compulsion to write blog post
which is like kind of bad but maybe kind
of good too but it takes time to do
stuff like write blog posts or write
like entire open source libraries but
there are easy ways to do stuff so just
something alright just so great they're
like really low barrier to entry being
back and they're totally SEO too so if
you find some some hack or something
like that just do it just that says
workaround for busted android and
continental right all right and somebody
might find it right there's i found lots
of solutions off of gist and i've been
really really helpful for people who put
that out there right and it can be like
just like to line or just right so i
think that's a good way of starting to
give back and you know and just doing
stuff like when you're on an open source
repo if you see a typo in the docs or is
something wrong in the docs just edit
the edit that right there right that's a
really easy way of giving back so i
think you can start with these kind of
low low barriers yeah um ok so the
question is did we consider putting
subtitles in the server side how would
we do that what do you mean by server
side Oh baking it into the video ah
we've got like 20 different languages
for some of them so we'd have to have a
ton of videos for that and we'd have to
have a service for doing that so right
now we're using trans loaded that does
all of our encoding and that's really
cool but I'm not I don't know if they
would bake it in and and that means I
you'd have to have so many options so
you have to so you know video costs and
video transcoding cost is quite a lot of
money so I I think it would be kind of
unreasonable and then in the number of
videos you would need to support all the
different languages might support but if
it was just English that'd be cool
yeah you can turn them on and off so
you'd have to like switch between the
behind like the videos back and forth
but you know you could always decide
everybody get subtitles right I actually
I like dating foreign boys because then
I can put the subtitles on and pretend
it's for them because i really like
subtitles because i can't understand
anything so all right so the question is
on the testing process all right so we
for our test we actually for the front
end we do we just do we use j/s tom j/s
tom is not a real Dom so it allows us to
test things like interactions of events
without it like with you know visibility
and with mock Ajax requests and stuff
like that it does not actually run
inside a browser so it does not catch
any browser issues so we do not catch
browser issues with our automated tests
we have written selenium tests in the
past and selenium tests you know they
open up an entire browser and then
they're like remote controlled browser
and that's like a full integration test
however our selenium tests have been
quite flaky and we haven't had the time
to actually maintain the selenium tests
and make them not flaky and they just
they also take a long time to run right
so we wouldn't be able to run our
selenium test as much as we can run the
other ones right we can run 400 j/s Dom
tests in like two minutes all right we
could never achieve that with selenium
unless we put it across many different
clouds which you can do you can use
stuff like sauce labs and that will
paralyze your selenium tests and stuff
like that so we could certainly look
into doing I think that's the ideal one
days you have so the ideal thing is you
have cross browser selenium tests for
your most important things like lectures
you have all these unit tests that went
really fast and then what I really want
is visual regression testing right is
when we change something about our CSS
if that suddenly changed the way
something looks somewhere on the site
you can actually do a take a screenshot
and do a diff and get an alert that says
hey something changed about your visual
stuff right because little changes in
CSS have really bitten us quite badly so
I think that's kind of like this ideal
stack but it takes time to build up that
stack so right
no we just have the j assam unit test
and we have a QA team that will test new
features and changes and catch things
that way hopefully so the question is
how many platforms is our QA team do so
we we ask them to test IE 9 and 10
firefox chrome and Chrome it's a for
Chrome and Firefox in some windows in
mac we also ask them to says ipad when
they have time because we have a lot of
users errors and I've actually noticed
that ipad is an environment where you
are likely to get bugs that you wouldn't
see elsewhere so I think it's really
valuable to test an iPad because just
weird stuff happens and that's yeah
that's what they test in the most of the
time I'm saying that that definitely
does take time oh and even chrome on
ubuntu because we have a kind of a
programmer crowd too yeah we don't so
for older browsers so we're ie8 we don't
formally support it I actually throw up
a banner that says hey you're a 98 you
should probably get out about you it's
not a good place and if you go to like
coursera.org and ie8 I just oh I throw
the brown in ie7 I just don't let you in
i'm like sorry dude you gotta go um at a
certain point right it just won't even
work yeah so we're not we're not we are
so same for a video test we do sometimes
ask them to check android tablets
because there are enough people using
android tablets for videos but we're
doing it largely based on what our users
are using now right so if you look at it
it's largely chrome firefox android we
do test that i use because the
professors and these IE and then and
then there are a few people on android
tablets so specifically for video we
might test that but not for the other
stuff i know so you a parser has the
regex enamel and then it it
automatically gets output in client
libraries in like eight different
languages so you can use it from Python
Ruby wherever
honestly I've actually never used it but
when I gave something like this talk
before Paul Irish was like you got to
get them used you a par so there's a go
gay right so I've never used it but I've
been told I really really should pretend
that i use it okay Don't Tell Paul
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>