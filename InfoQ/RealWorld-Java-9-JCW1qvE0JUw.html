<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Real-World Java 9 | Coder Coacher - Coaching Coders</title><meta content="Real-World Java 9 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Real-World Java 9</b></h2><h5 class="post__date">2017-10-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/JCW1qvE0JUw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so I'm Q Khan London is my favorite
place to give a talk it's both my most
exciting and most terrifying talk
because I almost always give the brand
new shiny live demo first at this at
this conference so this is the place
where it's either going to fail horribly
or not fail quite so horribly there
really is no success at this so anyway
but you are always an amazing audience
she said setting expectations
accordingly so you're always extremely
supportive of my trials and tribulations
yes so yes so I'm Trisha I work for
JetBrains
I'm a developer advocate working mostly
with IntelliJ IDEA and also with up
sources which is our code review tool
and this talk is basically Trish can you
talk about Java 9ish so so I am I'm
going to talk about I'm gonna do a
little bit about jigsaw in action even
though I promised I wasn't going to do
anything about jigsaw and I'm going to
look spend quite a bit of time looking
at reactive programming in Java 9 and
that's because the reactive api's are
built into Java the language so the
thing is can be quite interesting to
understand how reactive programming
works in in Java to get a feel for what
this means for us and then I'm going to
spend some time depending on how long
this takes and looking at some of the
other Java 9 features that we as
developers are probably going to find
reasonably interesting so first and
foremost I think it's really important
to understand why we should care about
Java 9 it's not just because it's the
latest and greatest in the shiniest and
at some point you probably going to have
to go to your bosses and say whether or
not it's worth going to Java 9 given or
who's using Java 8 at the moment that's
fantastic who isn't using Java 8 yet
who's an Android developer some of you
okay that makes sense is anyone using
Java 9 yet really that's adventurous yes
okay so let's have a quick talk about
why we want to know about Java 9 it's
coming out this year probably July ish
they tell us we don't really know it's
Brian in the room I hope not because
then he can not tell me what's wrong
with my job and I talk and so we want to
have a feel for why we might think about
upgrading to Java 9 and we get freeze
with Java 9 if we upgrade to Japan iron
just run our applications on Java 9
without doing anything without making
use of any of the new features we get
better use of memory better performance
of a bunch of different stuff we get
better use of hardware we get better
javadoc documentation it comes with a
new search field and you can do html5
Java doc which is terribly exciting and
some improvements around graphics and
faster compilation so there are some
there's some really nice changes which
have gone into Java 9 which you can take
advantage of straight away just come
kind of free out-of-the-box of course
whenever anyone talks about Java 9 they
can't help but talk about jigsaw because
this is the big thing and it's only been
sort of a work in progress for about you
know 5 million years and we're
eventually going to get it in Java 9
whatever that means so this is the big
ticket item for Java 9 and a bunch of
people are talking about the repple
who's heard of the Java 9 repple a few
of you so read eval print loop so the
ability to kind of try out Java
statements on the command line which is
not really a way that we as Java
developers are used to working you have
it with things like closure and a bunch
of JavaScript ways of doing stuff and
but it's not really a traditional Java
way of working so the repple is quite
interesting and we are not going to have
time to see it today I'm so sorry I'm
and then everyone's like ok so what else
is there you get some free stuff and you
get jigsaw and you get the repple but
what is there for me as a developer so
we're going to look at some of the other
things which came in which is coming in
to Java 9 it's now sort of feature
complete so there's one or two things
which are going to be available whenever
Java 9 is finally released now I usually
especially given live demos slightly
fraught with danger so I do usually try
and set expectations appropriately low
don't use Java 9 in production yet it's
not out yet it's not ready yet it is it
is an early access release so you can
download Java 9 it is being updated
fairly regularly you can download an
early access and try it out in your
applications or in a new application the
other thing which is early access at the
moment is the IntelliJ IDEA version that
I'm going to be using here is the one
that's not quite
yet as well so something will definitely
go wrong and I'm ready for this I can
take it and of course we can't really
talk about best practice with a version
of Java which isn't out yet so we don't
really know what best practice looks
like yet for Java 9 we're only just
starting to see some of these best
practice type things for Java 8 with
lambdas and streams so all I can really
give you as a kind of sneak peek on some
of the features of Java 9 how I found
them reasonably useful for me to work
with in a real live codebase and then
from there you can get a feel for
perhaps what sorts of things are coming
in Java 9 the case study two years ago I
did a live demo probably in this very
room about Java 8 in anger frankly I
think I should have called this Java 9
in anger because jigsaw made me quite
angry and the Java 8 in hangar talk was
about JavaFX real real-time dashboard
which responds to tweets pauses tweets
and does some interesting stuff with
them and shows them on on this dashboard
and the point of that was to kind of
demonstrate a bunch of Java 8 features
now what I wanted to do is just take the
same application and migrate it to Java
9 make use of some of the Java 9
features particularly because this was
always a kind of event-driven type
architecture which lends itself quite
nicely to the sort of reactive api's the
architecture of this was it's kind of
got some very tiny services
I wouldn't say micro services because
they're not reliable and they don't do
any reporting or anything that's useful
for micro services but I have a bunch of
independent services and so we'll have a
look at some of those independent
services see how they work and see how
the Java 9 features impact them I could
yeah let's do a fraught with danger and
try and see if we can get it up and
running so I can show you what it looks
like so the first place we can go wrong
and you know when you're like compiling
stuff on your on your computer and
someone looks over your shoulder and it
takes like about 500 times longer than
it normally does that's what this
experience is like there's like 700 of
you in this room all right so I've got
what I'm doing is I'm starting three
independent services in the backend one
is a sir
which sends tweet like information one
is a service which parses the the
usernames out of the tweet and one is a
service which kind of get some idea of
what the mood of that tweet is is it's
kind of vaguely happy is it kind of
vaguely sad and then I have JavaFX
dashboard which kind of renders this on
the screen so this is the application
that we're going to be refactoring to
use some Java 9 features and
architectures that's subtle that I'm
surprised that worked that's the first
test passed excellent and so if you're
interested in the original use case I'm
not going to go into the details of how
that was built because I've already
talked about that and it's available
online and I don't need to bore you with
the details
these slides are obviously available
online so you don't have to like take
pictures of the thing so Java 9 I can't
really go anywhere with Java 9 without
talking about the elephant in the room
which is jigsaw and they really did want
to get away without talking about jigsaw
in a Java 9 talk but it turned out that
what my project was a multi module
project using Gradle and Gradle the
current version of Gradle with the
particular version of groovy in the
particular version of Java 9 in IntelliJ
doesn't work so at the moment and they
are working on it but it means that my
multi module project which was so
amazing under Java 8 and doesn't work on
the Java 9 so I decided why not just
like port it to jigsaw just see what
happens and the one of the things I had
to do is actually had to change I don't
know if this is absolutely mandatory but
I had to change the directory structure
of the project so what I had before
was a kind of typical groovy like movie
in Gradle and maven style directory
structure with my sort of source main
Java source test Java type of directory
structure and in order to turn it into a
jigsaw friendly modular system I ended
up having to have like a top-level
source directory and then all of my
modules under that and their top-level
test directory and all my test modules
underneath that and this is much more in
line with a sort of recommendations from
both the jigsaw QuickStart tutorial and
this is what the the JDK
layout looks like if you look at the jdk
code itself and so what you'll see with
that is now I have a module info file
which is the kind of the configuration
of your Java 9 jigsaw module and for
each of my production modules but I
don't have one for my test classes
because the test classes are in the same
modules the same package name and so
there's a package name clash and so the
easiest way for me to get this to work
something for demo purposes was to not
turn my test classes into real modules
just have the IDE take care of the
dependencies and so I run the tests
inside the IDE so this is not this is
definitely not best practice but it does
work more or less so one of the
interesting things about modularizing my
code is I had a look at the dependencies
between my modules and these are the
things which visited appendixes I
already had I already had a modular
structure in my code and then I thought
well let's have a look and see if my
dependencies are right and it turned out
that I had some weird conflicts of ideas
inside my head when I created my
original modules for example my two
back-end services my merge service and
my user service both depend upon code
from my Twitter service and when I
thought about it I thought well that
makes no sense I mean it can listen to
the Twitter service but it shouldn't be
sharing code from the Twitter service
that's kind of a bit weird I also see
that my client code has access to the
web socket API library as well as the
web socket implementation which I also
didn't know why that was either and then
I have a separate module which is
necessary at the moment which is going
to do the conversion between my Java
eight reactives Java 9 react to streams
API and the org reactive streams
reactive streams API which is called
which is called flow and this module was
dependent upon reactor streams but also
inexplicably so was my service module so
by drawing out what my dependencies were
I could actually see that I had some
weird dependencies that I didn't really
need
and jigsaw kind of brought this to my
attention because I had to think about
what my dependencies were what were my
modules really using so I went away and
rethought about it and I ended up with a
much simpler structure and with this one
all of my independent services are now
independent services they don't depend
upon each other they do depend upon the
service class the service module which
is all my infrastructure code for
services so that seems correct which
depends upon WebSockets because my
implementation is WebSockets and then my
three back-end services my Twitter
service my user service and my mood
service are all dependent upon our X
Java because those are the only services
which use rxjava and then I also have
and those ones also have to depend upon
my adapter between reactor streams
implementation and the Java nine
implementation so here I found jigsaw
really useful for kind of helping me to
forcing me to look at the modular
structure in my code to look at the
dependencies to see whether they made
any sense at all which was kind of a bit
tiresome because I really didn't want to
be looking at jigsaw at all I just
wanted to get on with the code and let's
have a let's take a quick look at what
this means and all of this talk by the
way is going to be sort of very each
topic it's going to be quite high level
so if you're kind of interested in
jigsaw for example there are lots of
talks and documentation already
available on jigsaw and there will be
more this year I'm sure so I'm not going
to do like a deep dive onto each topic
I'm just going to do a sort of
high-level oh look this is what it looks
like in the code and then if you're
interested you can go away and find out
more information later so let's look at
trying to implement a jigsaw module
inside real code and let's check out the
right branch
so mm-hm and what you've got you know I
really need to be able to see that the
words there but and so this is one of my
back-end modules it doesn't currently
have a module info my other modules have
a module info so in order to turn this
into a module it needs to have the
module info file so I'll create one of
those new module info IntelliJ makes a
reasonable guess as to what the name of
the module is but it's not quite right
to kinda put some dots in here no doubt
this functionality will evolve over time
and so now when I compile Java nyan is
going to say okay this needs to sort of
conform to all the the jigsaw modularity
way of doing stuff and so now I'm going
to give you loads of errors and warnings
about what you've done wrong and so now
I'm using a Java library class musing
the the Java logger but I need to
declare that I'm going to use that
module and I'm not going to get it by
default so if I enter onto that
typically I the default it's not very
big but I can add requires Java logging
to the module info so we have a look at
that then I can start to build up the
dependencies that my module has and and
get those added into my module info file
similarly I need to add reactive streams
so the class path and I need to add my
dependency on reactive streams into my
into my module info so here I actually
have two different types of dependency
one is a module from inside the JDK
so that's part of Java but I have to
declare that I want to use it because I
don't get it by default and another is
me using an external library the
reactive streams library and I have to
declare both of those and the other
thing that I can do inside my module
file is I don't just talk about the
things that I use I can also talk about
the things that I'm going to let others
use from my module otherwise there's not
a lot of point in creating a module if
no one's going to use you so here what
we see is this is code
from a different module so here this is
inside the user module and the error
here is package comm countess and stop
flow is not visible from inside this
module the the flow module needs to
export it now there's no magic auto fix
for this and so I can say exports the
package name I only have one package
name in that particular module so this
is a very simple module which has a
dependency on two other modules and
exports one module for other people to
use there are some slightly more
complicated ones for example here's my
module for the client and these these
things I kind of figured out by kind of
trial and error because as you're
running it it tells you you need to
import your Java FX modules and then
when you try and run it as well JavaFX I
assume uses uses reflectional users I
don't know some sort of callback or
something you have to say that your that
your packages are open to Java FX as
well so there are there are different
things you do inside your depend inside
your module configuration file you can
configure the the all the visibility of
all of your packages now it's much more
configurable than it used to be and I've
left that comment in there because it
told me I needed to export two packages
that I'm not sure I actually want to
export so again jigsaw is kind of making
me think about the design is this really
what I want to do with these things
really supposed to be visible or not is
that what I want to do and there's
another another one on my service side
and what I found was I did this by pure
brute trial and error trying to figure
out which modules I have a dependency on
and then when you have when you try and
run it you get runtime exceptions where
like you've got missing classes and
things like that and because you don't
get all the errors at compile time so I
highly recommend that you read the
documentation understand how the
jaidev's tool works so that you don't
have to do this by a very difficult
trial and error way which is what I did
so so yes there was a there was a
certain amount of pain in movie
to an early access version of Java 9 for
example Gradle wasn't working for me I
am reliably told they are working on it
and I chose to reorganize the file
structure to be more in line with the
jigsaw recommendations and of course
reorganizing the file structure of your
project is a non-trivial thing to do and
because the way I've chosen to put to my
production files in one put into the
modules but my test classes are not in
the module system I currently have no
command line build for this I can only
run it through the IDE so this is not
production-ready the way it is right now
I'm the IDE support for things like
IntelliJ IDEA it is there for jigsaw you
saw that I can generate a module info I
get a certain amount of Auto completion
for some of the keywords but we don't
get all the magic auto fix things that
we're used to inside Java what if using
Java 8 or whatever so the IDE support
across all the IDE is definitely getting
there for Java 9 but when you're
starting to adopt these new things
there's going to be a certain amount of
it's important to understand what's
happening under the covers because you
might need to do some things manually
and so yes so you really do need to go
away and read about stuff like jigsaw if
you're going to do something like that
so enough of that let's get on to the
interesting reactive thing because
that's what I put into the abstract to
get this accepted for the conference
that's not true that's not very true so
my services are actually very quite dumb
and this is intentional because I want
my services to be very simple I want
them to be independent they happen to
use web sockets and the WebSocket
protocol you can choose to send strings
so all I'm really getting is like a
string input and a string input output I
could do more than that with my services
but I've just chosen I get like some
series of string inputs and some series
of string outputs so the what I do
obviously you plug the business logic in
between those things but all I really
needed for my application was a really
simple mapper so I get some string value
I map it through some magic either into
a username or into a mood or into
something fairly simple and end up with
some sort of string output and so what I
thought well this is what it looks like
so it takes a function of string to
string and when you call it you give it
like a lambda expression because you
know this is a Java eight demo so I was
supposed to be injecting land
expressions what I thought that would be
kind of more useful for the architecture
of this particular application is really
what's happening is under the covers the
input is a publisher so it's publishing
strings to my business logic so I can
publish a stream of strings and the
output subscribes to some set of outputs
from the business logic so my publisher
is publishing a stream of strings my
subscriber is listening to a stream of
strings that are probably a different
shape to the original stream of strings
and then again I have my business logic
somewhere in the middle doing something
to those streams so I want to go ahead
and do this change because the publisher
and subscriber interfaces are the things
which should come in in Java 9 so Java 9
has the reactive streams API built in
let's have a look at what that looks
like
so my service in my service class is
fairly stupid really simple so it's
simple to understand and I have the
client input endpoint is the input to
the service and the broadcasting server
end point end point is the output of the
service so what I want to do is I'm
first going to change my output to be a
subscriber and I'm going to cheat
slightly so I already had this idea of a
message listener I already have an
interface which was a message listener
which takes a string message and what
I'm going to do is I'm going to cheat
slightly by changing this to the same
signature as one of the methods on
subscriber so I can much more easily
migrate from my custom message listener
to the the reactive stream subscriber so
then what I'll do is I can now implement
subscriber and that's going to text
string let's take a quick look at what
this looks like
so my sisters part of the Java 9 library
so I get a subscriber which has an
unsubscribe and on next which is the
thing that gets called with every single
message which gets passed in a non error
and a non complete so those are the
things I need to implement in order to
be a subscriber so I'll implement those
my unsubscribe is the thing that gets
called when something so I'm a I am a
subscriber so when I subscribe to
something I get given a subscription so
what I want to do is I just want to do a
fairly simple thing I'm going to request
from that subscription like everything
it's got
so as the end point all I want to do is
just listen to every single string at
the string that you're going to pass me
like forever for whatever that means my
on next I already have this is the sort
of this is the logic of my endpoint it
just says the like for every message I
get in I need to publish it to my
WebSocket output that's what I do on
error let's do some really cool error
handling
that's my amazing error handler and then
I'm completely I'm gonna close it so I'm
just going to implement those in the
simplest possible way but what I've done
is I now have the subscriber part of my
service so I've just really simply just
turned it into a reactive stream
subscriber now obviously my service
isn't going to be compiling anymore so
my client endpoints is let's rename this
so it's more useful this is going to be
my publisher so before what I did is I
added a listener to my publisher but
what I'm actually going to do is I'm
going to subscribe to my publisher it's
just again it just a different
terminology but it's the same sort of
thing and what it used to do is it used
to take a message listener and now I'm
gonna say I want you to want the
SUBSCRIBE method font size on this is
not amazing and I want you to take a
subscriber so let's say a subscriber
type string actually needs to be some
generics magic okay so now my service is
responsible for gluing together my
subscriber and my publisher to make sure
that they're actually talking to each
other let's go quickly into the
publisher and turn that into a publisher
so I this is the SUBSCRIBE method that I
just called and let's rename this so
it's more sensible this is now a
subscriber so when I am a publisher when
someone subscribes to me what do I want
to do well one of the things I need to
do is my subscriber I need to call oops
on subscription unsubscribe where the
subscription let's create that
subscription I'm going to create a class
called subscription I'm going to create
an inner class for this
and I'm going to pass my subscriber into
my subscription and I manage it there
and hopefully it will become clear what
we're doing why we're doing it so let's
create a field for this so the reactive
streams API has an idea of a
subscription so I'm going to implement
subscription and implement the methods
from subscription and we've already seen
the subscription method a little bit
because what we did is we called request
to request all the items in that stream
so now we need to implement our own
subscription this is because I'm not
using any libraries this is me using the
reactive streams API implementing the
bare minimum required for me to sort of
be able to have a subscriber and a
publisher so I'm gonna say something
fairly simple I'm gonna say I'm going to
track this with a new atomic long great
field for this and then mmm in order to
cancel I just have to set that to zero
and we'll we'll use this in a minute so
for now all we need to know is that our
subscription has an idea of this of the
subscriber and the number of things
they've asked for so let's go back to
our SUBSCRIBE method now now I will need
to track all of these individual
subscriptions that I've created because
these subscriptions are going to allow
me to send stuff to the people who are
subscribed to me so a subscription so
instead of listeners I'm going to have
subscribe own oh yeah let's forget that
I'm going to change this so that instead
of story message listeners which is what
I did before I'm now I now have a list
of subscriptions and so I'm going to
rename this to be something more useful
so basically what I'm doing I already
had my message handler idea but I'm
basically formalizing instead of having
a message listener I'm using
the publisher and subscriber instead and
then what all I have to do is this is my
method which takes a message off the
WebSockets and is going to publish it to
whoever is listening whoever is whoever
cares about that message and of course
who cares about it is all my
subscriptions so every one of my
subscriptions I'm going to tell them
about this message so that's not called
message listener anymore it's called a
subscription and let's just implement an
on next method on there to make life a
little bit easier and then this is the
bit which says look if decrement if I
still have outstanding requests that the
subscriber wanted to wanted me to
fulfill then I'm going to send the
subscriber then I'm going to send this
message on to the subscriber so this is
just it's a really simple really mood
rudimentary subscription okay so it
meant that my subscriber was a little
bit more my publisher was a little bit
more difficult to implement than my
subscriber but at the end of the day
what I've done is I have let's compile
everything and hope it works I have my
two ends I have a publisher which is
listening to the WebSockets and then
publishing stuff into anything that
cares and a subscriber which is
subscribing to any output from the
business logic and then writing that to
the WebSockets now I just need to do a
quick and slightly boring fix to fix the
UI because the UI uses the same the it
listens to those client endpoints so
tiny tiny cheat just to fix all this up
so instead of instead of implementing
message listener all of these things
have to implement subscriber and all of
these things will just basically ask for
every single thing that that I could be
sent then just send it to me and we'll
look at these UI ones a little bit later
on but at the moment all I need to do is
fix them so let's compile that I might
even go so far as to rerun everything
just to make sure everything's doing
exactly what it used to do before but
what we've done is we have the same
infrastructure we had before more or
less but I'm using reactive streams
instead so yes
so I plugged my publisher and subscribe
it on to the ends and that's kind of
fine and terribly interesting but I've
just basically it's doing exactly the
same thing it did before but with
slightly more code okay that's fun what
exactly did you do that for so the point
is to be able to use these reactive
api's the idea about reactive streams is
that these api's are usable across
different libraries so you can use for
example rx Java which is what I'm going
to use you can use reactor you can use
echo I think you can use a bunch of
these different reactive libraries and
frameworks but they all talk with the
same API so that means that for
something like maybe microservices type
architecture like mine or a modular
system they can they can be using
different implementations of reactive
libraries but be talking to each other
over the same reactive API and they
don't even need to be talking of talking
to other JVM things - because this is
implemented in other languages so this
is kind of this is where the power comes
from so this is what we did we
implemented our publisher and L
subscriber and so I'm going to take a
look at some individual uses of this
like what can we do now that we are
reactive what can we do now like what's
what's the point so I'm going to take a
look at the tweet service to begin with
because is at the end of the line it's a
little bit easier to manage let's shut
everything down
so what I did it perform is I had this
really nice new feature in Java 8 which
is files dot lines and it gives you a
stream of strings which represents every
single line in that file I'm going to
show the sort of alternative using
reactive streams instead of using Java 8
streams this to do by the way is
intentional because I didn't really want
anyone looking at this going
oh yeah that's a really good idea let's
just do that sort of error handling in
our micro-services no don't do that so
in so now I'm switching from using the
reactive API is to using a wrap to
reactive implementation I'm using rx
Java as my implementation for just
because it was the first one that
occurred to me so I'm going to add our
extraverts on my class path oh no we
don't have class paths in modules I'm
going to add our extra to my
dependencies I can create a flowable so
a flowable is is effectively a publisher
but it's kind of it's a stream if you
like but of reactive stream not a Java
eight stream which isn't at all
confusing in any way shape or form
so I do a flowable I'm going to do it
from iterable I can use a similar thing
to the files dot lines values files dot
read all lines which would give me an
iterable than the file path I'm and then
I'm going to do pretty much the same
thing that I had in my java 8 streams
but using reactive streams so we need to
do a filter which is going to take an S
and I have to say equals ok and
filtering out everything which is the
string ok Java 8 streams have has this
feature peek which lets you do something
at that point in the operation
enlistment you like to do something with
the item reactive streams don't have
peek but I can do do on next instead
which is the same sort of thing and what
I was doing is at this point I was
inserting a delay of 100 milliseconds
mostly for demo purposes because I
needed to be able to show the tweets
ticking at some sort of sensible tick so
I used peak to sort of inject a hundred
millisecond delay into each one of those
tweets as it gets published if you like
and then I can do for each
I can do the same thing so I'm due to
its endpoint on next and so here we have
basically this is my reactive streams
implementation of this it's it looks
exactly the same more or less be warned
it's not exactly the same it doesn't do
the same thing but we'll get onto that a
little bit later what we can actually do
is not just do a like-for-like
translation we can actually use some of
the power of reactive streams instead so
let's take out my java 8 implementation
the first thing that we can do is
instead of doing for each so for every
element that I see send it to my
subscriber I actually just have to say
subscribe my subscriber so my tweets
endpoint is a subscriber the only
complication here and I've mentioned it
a couple of times is that in Java 9 the
reactor streams API is under flow dot
subscriber
float publisher flow dot subscription
and the reactive streams API is is not
is a different set of classes and are
extravagant Lee works with the reactive
streams API because rx Java is not
currently compiled and built against
Java 9 but it will be so I need to
create an ad adapter which is going to
turn my Java 9 subscriber into an
old-fashioned reactive streams thing
which is not complicated at all so I
would just beg you to ignore it
completely so all I'm gonna do is just
wrap it in an adapter ok so instead of
doing for each I can just subscribe so I
have a subscriber so just get it to
subscribe to the output of this stream
that seems fair enough
also this Duan next thing always kind of
bothered me it feels like a little bit
of a hack but in terms of my
functionality that I want I actually
really do want it to tick every hundred
milliseconds that's like a business
requirement of mine if you like
now with reactive streams you can
actually work on two streams together
Java eight streams you have like a
stream and that's it you use it once and
then you throw it away you never use it
again and reactive streams you can you
can actually merge two streams together
so let's create a stream for
a stream of ticks so I'll say a flyball
into warm 100 milliseconds let's call
this tick so this is going to let's fix
this I need to add our Xterra to my
module info because you know Chickasaw
likes to keep me up to date
so this thing this emits it happens to
be along it doesn't really matter it
emits a long every 100 milliseconds 300
milliseconds tick tick tick tick tick
what I'm going to do is I'm going to zip
that together with my with my files so I
can say is it with my tick and so that
will kind of force my this strings in my
file to be emitted every 100
milliseconds and then I just have to
tell it like given that I've got two
streams I've got one which takes strings
which is the strings from my file and
one which is lungs which is my tick what
do you want me to do with those two
things well I don't care about the long
I only care about the I like the string
value so just admit the string value so
I think this is quite a nice elegant way
to sort of say okay and if I want this
stream to be to be emitted every 100
milliseconds
I just zip it with a stream which emits
something every 100 milliseconds so this
is kind of some of the power that you
can get from reactive streams that you
can't do in for example Java 8 streams
now let's see if that still runs
okay so now we're you can't really see
that very well but we are basically
admitting a tweet from the file every
hundred milliseconds so that's still
working excellent that's a good start
what time did I start how long have I
got
you'll come back to me that wait so what
I want to do is apply this reactive
streams thing with with all of my
services because because I can basically
let's look at the user service I've got
13 minutes hmm
hmm okay write some of this stuff I will
just do because it's boring and not
necessarily cannot necessarily explain
now remember I had a service class which
glues together the two ends the
publisher and subscriber so instead of
taking into that class a function which
takes a string and returns a string a
mapping function what I'm going to do is
I'm going to give to you the caller the
user service of the mood service a way
to get hold of the publisher and the
subscriber and you can do whatever you
want to do with those two things so I'm
gonna have a by consumer which takes a
publisher publisher of strings and a
subscriber of strings and I'm not going
to use this message handler anymore
because we are going to get rid of the
need for message Handler and just
refactor that it doesn't matter it's
kind of break everything because we will
fix that and I'm going to call this this
is going to be my business logic for my
service so create that put up field for
that and then when I run my service
instead of doing this instead of gluing
the the client to that instead of gluing
the subscriber to the publisher I'm
going to basically tell the business
logic to do its thing so I'm going to
give it the client endpoint publisher
and subscriber so that's all well and
good you say what's the point
I go to my user service and what I'm
going to do is now instead of giving it
a function I can now take
I can now have a publisher and a
subscriber and I can do whatever I want
to do to it so obviously I'm going to
listen to the publisher and do something
with the stream of events which comes
out of that and eventually at some point
plug that into the end point subscriber
so again I'm using an RX Java I'm going
to create a flowable from a publisher
I'm going to run out of space publisher
okay and then I just need to do the same
thing I was doing before so I used the
original function which was use a
service get Twitter handle for a tweet
and then glue the subscriber onto the
end of that I mean it's not super
exciting but the what ik when it gives
me which I didn't have before is I can
now use the full power of reactive
streams to do whatever I want with with
the Twitter information that comes in so
before this this servers had to be
really simple because all it did is it
took the tweet and it just took the
username from it because I couldn't do
anything much more complicated than that
but now what I could do is I could have
a look at that tweet information which
can be kind of small and and not very
populated or big and very populated and
I can pull out various bits and pieces
and create a fully-formed user if I want
to rather than just omitting just a user
handle and so that this gives me a lot
more capability inside my user service
and I'll show you example inside the
mood service which is a bit more
complicated so here in my mood service
again we were going to have a publisher
and subscriber the create flowable from
our publisher
mm-hm and then I can start by just doing
the same thing I did before so I can
just do the mapping function like I did
before the twos subscriber letter
subscriber okay and that's that works
the same way it worked before just have
a horrible feeling yes my user service
doesn't compile oh yes because I didn't
add rxjava to my module info file okay
now what I can do my mood service was
reasonably complicated before it was an
example of a Java eight stream which
uses a whole chain of operations to take
a a tweet and turn it into some series
of moods so let me show you what I mean
on the mood service so I take a tweet
and if there's like a word in there
which is reasonably happy then I omit
the string happy or i omit the string
sad or if there's like a word which
corresponds to more than one mood then I
can omit a CSV of mood so sad I'm happy
and then if there's no mood associated
with the tweet I end up just emitting an
empty string so there's a one to one
relationship between the the tweet that
comes in and some string value that
comes out the end which represents the
mood now with reactive streams I can
actually change that so I can actually
instead of thinking in terms of one to
one thing between I get some input and I
can return an output I turn this stream
of tweets into a stream of moods and
there's no correlation from the UI point
of view that doesn't matter the UI or
only cared about are people generally
happy are they generally sad that are
generally not care so listening to a
stream of individual moods as they get
admitted it doesn't matter to the UI
whether they happen to correspond to an
individual tweet one or multiple tweets
or there's like multiple moods from that
so with reactive streams I can actually
think slightly differently about this
problem let's just put this into another
method
and what I'm going to do is I'm going to
lift almost all of the Java eight
streams from here and chop them into my
reactive stream there's one slight
difference my flat map needs to take
needs to be a flowable not a stream from
array I have to do a magic incantation
which thank goodness I don't have time
to talk about right now in order to make
the flat map work I guess the moral of
the story is back pressure really does
matter
especially with reactive streams so go
away and research about that if your
service falls over in a heap like minded
and and then all I have to do is let's
get rid of the distinct so I'm doing the
same operation but instead of what I was
doing is I was collecting it into a CSV
into a single CSV for each tweet and
instead of that I'm actually just going
to omit each mood as I find it so I end
up with something like this where I just
get individual moods emitted so this is
something that reactor streams gives me
I probably could have done this with the
Java eight staff but it didn't make me I
wasn't thinking in those terms right so
I have five minutes left
we're not going to go into the UI side
of stuff because it really doesn't it
there's not that much interesting there
I just had to change the mood service so
that it understands that it's not CSV
anymore that it's an individual set of
events it's not super exciting so Java
eight versus reactive and they look the
same Java eight streams and react to
streams and look the same but they're
not the same they don't work the same
way so reactive streams do are like
infinite streams of events that come in
Java eight streams can be infinite
streams as well but the idea is that
with Java eight streams are done with
reactive streams I can have multiple
subscribers to my individual stream for
example or I can zip multiple streams
together
I just basically work with them in a
completely different way whereas Java
eight streams the way they are at the
moment is more like nice syntax for
querying collections it's not quite the
same thing so reactive stream is work
with multiple streams you can have
multiple consumers you can reuse them
back pressures extremely important you
need to understand
the back pressure on the system and it
does have a very different concurrency
model which yes which is worth reading
about right now the Java 9 features in
four and a half minutes fine
convenience factory methods for
collections this is a really it could be
arguably a really silly feature in Java
9 but it's a really nice feature in Java
9 so if I go to and what I can do now is
of having instead of having a raise I
can say list of and give it some set of
values okay that's fine and not super
exciting because before we could say we
could say ArrayList raised or as list
and do the same thing but what is more
interesting is that you can do this not
just with lists but you can also do it
with sets for example so you can create
yourself a nice unmodifiable set with
convenience factory methods this is kind
of this is really useful particularly
with things like testing where it is
really useful is I don't want as a
setter well it's really useful in my
opinion is in its for maps so I needed
to initialize a map in this particular
case and this is the one feature I miss
most about groovy the ability to write
to nice maps now it's a little bit
easier in Java 9 you can say map of
entries you can create each one of these
things as an entry can't select
to find in a place on that
not that one honestly right so instead
of having a static block you just have
some nice helper methods for doing a map
of entries it's it's not as pretty as
the groovy way of doing stuff but it is
a lot easier than what we were doing
before you can also if you've got less
than ten fewer than ten you can also say
map dot of and you can say something
like and so on so you can just give if
you've got a small number you just give
key value pairs in there in the map
table so it's it's a little bit easier
for us to work with it's it's quite nice
private methods aren't interfaces now
this might seem really silly because
like why would you want a private method
on an interface when an interface is
supposed to give you the interface to
implement now of course interfaces in
Java eight ended up with default methods
and static methods so you can start to
have behavior inside your interfaces so
then you end up with interfaces like
this sweet possible and which is a
genuine interface that I had from the
from that demo where you have you have
copy/paste coding and there's no way to
put that into something which is
reusable unless you put it somewhere
else and now you can do that in Java
eight in Java nine sorry we factor this
into you get value for field and so now
I can reuse that obviously previously
that would have to be public but now I
can say I want it to be private so I can
reuse that functionality between
individual methods or on my interfaces
so that's quite nice what else new
methods on the streams API so the
streams API especially when you're
working with so this is the Java eight
streams API with the Java eight streams
API but especially when you're working
with infinite streams it was quite
difficult to tell it stopped now you're
done please stop no more and that's a
little bit easier now with Java nine so
I can say what I had before is I have
here a feature which on my leaderboard I
have to go down the list of the the
Twitter
users and then find the place to insert
them so what I did is I used filter to
find in that place which was just kind
of relied a little bit on the fact that
it was ordered and it's fine because I
was only 15 entries but it's not great
so actually what I want to do instead is
I can now use take while so while some
condition is true then do this and then
after that finish or I can do the
opposite I can do drop while so ignore
all of these up until some condition is
true or I can use a combination of the
two to get some things in the middle so
that's great now I've been told to stop
like a minute ago the pain right so
everyone's a little bit worried about
Java 9 because they're worried about
things like modularity and so forth
might break their code but you can try
it out now to see if things will break
and and you might be surprised you might
find there's not as much pain as you
thought
there are things going away in Java 9
lots of things are being removed
deprecated things are being removed in
Java this has never happened before it's
very exciting you can delete code and so
lots of things are going away and
there's also some changes to things like
logging for example and to the garbage
collector so you might end up with some
unexpected behavior if you're relying on
certain things that practice shouldn't
have been relying on like errors in logs
for example and the Java 9 is still
evolving it's not out yet so do download
the early access thing but be aware that
things like Java 9 is evolving the tools
we use are evolving and these things are
still in flux at the moment I'm don't
necessarily rush to apply jig so you
might not need to jigsaw eyes your whole
project but you can still use Java line
without being modular that's fine and we
actually streams are not the same as
Java 8 streams if you care about this
then definitely read up about that and
experiment and see what the performance
is like because they do different things
there are they are for different use
cases and the gain in terms of Java 9 it
does encourage good design I did find
that modularity had me thinking about
single responsibility about
encapsulation and about these good
design practices and it also encourages
new ways of working so the reactive
streams API lets you think in terms of
like events
and streams of streams of messages or
streams of events and also the repple
which we didn't get a chance to cover
the repple is a new way of working with
Java as well and there are lots of
little things in there like private
methods on interfaces collection factory
methods new methods on the Java eight
streams which has just make code that a
little bit nicer to work with I think
it's gonna be a little bit like when
Java 7 got project coin and some of
those syntax changes were just a little
bit nicer for us to write code with and
I have less than zero time for questions
and but come and grab me anytime
throughout the day all of the code all
of the slides all of the all of my
reference material is available at this
link so please go and take a look and
see what's there and thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>