<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Intro to the HTML5 Audio Element | Coder Coacher - Coaching Coders</title><meta content="Intro to the HTML5 Audio Element - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Intro to the HTML5 Audio Element</b></h2><h5 class="post__date">2015-03-31</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/gcc0Jgot6Ts" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi there guys my name is Rick Hurst and
I'm the lead html5 and struts are over
at the new circle you've probably heard
of the new circle at some point if
you're involved in the tech community
they do love the recordings the user
groups around here they also do a lot of
enterprise training public classes that
kind of stuff and today we're going to
talk about the html5 audio element as a
lot of interesting things happen inside
the audio element in terms of the events
when they fired that kind of fun stuff
so i want to show you how all that
pieces together okay so let's just jump
straight into the code and so before we
start coding I'm just going to show you
a little bit about the setup here and if
you're not already familiar with this
this is chrome devtools now if you're on
a pc news f12 if you're on a Mac it's
option command I and this will
essentially toggle on or off the chrome
development or some obviously working in
chrome here and it's just an h1 and h2
in here I can replace this with an audio
api audio elements i should say here we
go audio this just points to main.css
file which is currently empty let's give
it a bit of a background color there we
go and the jay s file that is pointing
to at the bottom after bringing in
jquery right here is essentially empty
okay we had a function scope here which
I've taken out so it can experiment with
the Global's down here at the bottom
some initialization some just place all
the tech tell me structure my code read
me nothing interesting in there reason
I'm showing you this you're going to
have a copy of all this i'm going to put
it somewhere so you guys can get all of
this when we're done and so we have all
the folder here in as i've called the
audio now we have a file which is an OGG
file which we'll get into in a little
bit essentially just a video just a
little audio sound clip with an annoying
beep I'm not sick you know we have index
main main JSN beep and then we're up and
running so what I've done here is just
added the audio tag and I'm going to
refresh the page so we don't see
anything right now because we haven't
got anything inside the audio elements
itself now rather than just add this
directly to the markup what I think
I'm going to do is I'm going to
structure it in the code here so first
of all let's think about what we need to
identify in terms of the model what
we're going to be working with the audio
element right so why don't we find that
using jquery and whenever you find an
element in jquery you usually put a
dollar in front of it what audio element
so the dollar that you see here really
doesn't do much ok it's just convention
telling you you're dealing with a jquery
wrapper and then you can use good old
jquery to find the audio element on the
page done ok next thing that we need to
work with is the raw Dom element because
one of the challenges when you work with
the audio element down here if you put a
little watch expression in here I have a
look at it this is refresh our page to
find it audio
and yes I didn't save see a little star
it's not safe let's try saving it I my
help refresh okay so this is a j.crew
rapper inside of here we have lots of
interesting stuff all the jQuery fun
stuff that you see in here you might
have be familiar with jquery like click
events and all this really interesting
cool stuff they have but the first item
inside this array is actually a
reference to the audio raw element
itself and this is what you need to work
with when you're working with html5 so
for example it has a duration you know
that kind of stuff and it's an audio tag
itself so we're going to want to work
with this so how did you get that out of
there well as you can see you could do
something like this if you wanted to do
we factor as I go in a second and I
could say the audio element would just
found using jquery and then pull it out
like that that's not really best
practice even though this will get you
what you need what they really want you
to do is get zeros to one of those
things you just gotta learn okay and I'm
reflect on my code a little bit because
I always like to have one Val okay
that's the same stuff yeah so we have
something we can work with we've got to
scope variables here now can have a look
at this as well and refresh and save
and now have all the stuff that we need
okay so let's think about what we want
to do well I suggest that we find the
audio element and we get that beep file
that beep boop dot org that we have over
here and inject that into the audio
element itself so I could just do that
in the index but I want to do it in
JavaScript because you'll see why I'm
doing that in a second I want to force
an error and it will expose some
interesting things so I think which what
we should do first is add a sound file
or add sound file to audio element now
I'm being verbose here with the you know
why file names and you'll often notice
me use things like STR and all this kind
of stuff I'm doing that to be clear
exactly what elements at what variables
were dealing with any one point in time
okay so add sound file to audio element
this can be function that we're going to
run and this is very visual thing so I
think we're going to add this here in
the view function add sound there we go
alright so how do we do this well i'm
going to construct a little bit of
markup and there's numerous things you
can do that you can great sin placing
engines and all that stuff but i'm just
going to keep it pretty simple and can
catenate a little bit of markup so here
we are we're building a little string
and the plus equals is equivalent to
doing HTML equals HTML string plus
whatever so this is just a shorthand for
concatenated and so I'm using a single
quotes here to concatenate and I want to
have a source file because that is the
element that goes inside the audio
elements itself and this way we can
provide various sources because some
files can't be played on certain
browsers for example and you might have
a problem playing an OGG file you know
on a certain browser and I will talk a
little bit later but which browser
support which things but i'm going to
add 2 i'm going to point to actually two
different beep files now currently i
only have an OGG so i'm going to point
to an mp4 and see what happens
so let's just do an SRC here and let's
do beep darts mp4 all right this should
give me a 404 should fail shouldn't find
it okay you might think just by having
the mp4 that will figure out that this
is a type audio equals mp4 unfortunately
it's not smart has to look here so let's
just take that line and also let's bring
in the agua below it now it should find
this one because we have it as you can
see on the left yeah okay so once you
have this HTML string I'm going to
turbocharge that with jquery and turn
this into instead of being a dumb string
it's going to become the Dom elements
that it needs to be and then I'm going
to insert them or append them to the
audio elements itself which have already
done a lock-up is no point looking this
up again I've already got it and I want
to make sure that that will actually
give me an error widget which it does
because I've stupidly had a bracket in
there try that again okay so here here
we got over 40 for you can see under the
network that when you click all and this
is bright and read this is telling you
can find it which is what would expect
however it does find the OGG file yeah
you're also getting a 404 here so I want
to actually wore up an event handler on
this i want to see if we can capture
this error and to say something like you
know or we can't play that type of file
so i think once we added the sound files
to hear that we want to work the event
handler so let's call wire up event
handlers
okay well what do you want to wear up an
event handler on well to actually want
to wire up on the audio elements but
you'll notice if you try and wire up say
an error handler it won't work so i'm
going to i'm going to call this generic
and i'm just going to be some error and
we're just gonna do a debugger in there
see what see what happens whenever the
error event occurs now we should begin
an area because you know it can't find
it but it doesn't fire we're going to
get in the 404 and the reason is and
it's a very sort of thing is that you're
actually getting the error on this tack
or potentially this one so you know in
jquery if you have this element you can
you know dig inside of it with children
and let's try that
there we go so now we're poston debugger
and we can see I over here kind of a
quick look at that actually this event
is telling you quite a bit about what's
going on here tells you it's a type
error etc etc what you'll find
interesting in here that it will tell
you a little bit about the source which
is the target target and inside of that
what do we have here gonna scroll down
quick enough there it goes type so in
other words what we have here is will
have a target type okay we could just
console.log that out can't play
okay come play audio mp4 okay so at
least you've caught that now the way the
browser is going to work it i mean if
you look here and our tag should bring
it up we have a source tag this is
brought in first now if you bring in the
Augean above that you won't get that
error so instead of seeing this red
stuff all the time and seeing can't play
audio I would prefer to change the order
of this because i know i have the op
file no problem therefore that shouldn't
fire everything's good in the world okay
so we've got that in place now we need
to do something else I actually I'm not
going to call that generic handle going
to refactor that i'm going to call that
error handler it's very specific to the
error and i'm going to do handlers on
the actual elements itself so I'm not
listening for errors here I want to
listen for things like load starts yeah
and I'll talk about these type of events
in it in a second this is going to be my
generic handler
just want to do a bit more in here
unless just done let's have a look at
what what I is okay
so what should happen is when the
element loads okay generic angler should
fire and we should see something going
on in there yeah shouldn't have any
errors anymore as you can see on line 17
this is firing and the event that got
fired is all the way down here and it
tells you what type of Vernie was a load
start event that's because we're
listening for it so what other events
can we actually listen for there's loads
if we have a look in our audio element
let's just move this up a bit look at
all this stuff yeah seeing things like
on come play through thing what on
earth's that well things like that all
they do is once you've buffered a
certain amount of data okay and it knows
it can play it it's got enough metadata
it has enough information that it can
play it all the way through it in its
entirety then can play through event is
going to fire and that's when we can
play the audio we could listen for other
events such as you know unload start or
unload metadata and so I'm going to add
a few of these things here and let's see
what events we can actually listen for
okay so let's load starts loading
metadata
and I'm just removing the on each time
nope already got that they're mounted
this is if you suddenly I'd say you're
downloading something it's buffering for
a while and you want to kill that and
you want to stop it pouring it won't do
it because it will still continue to
download so emptied em we'll get fired
when you just replace the SRC to null
and that's a probably the best way to
kill an incoming audio stream audio file
i should say so unloaded metadata on
load start on that one what else do we
have playing yeah okay you can try that
you could do things there's a few of
those like on rate change which probably
not going to trigger right now volume
change time update yeah kind of look
that and also there's a suspend and
awaiting
I'm waiting to see their starts if of
mistake I missed any out do progress
well that's enough to have a look at
before we get too much further right so
we have all these events that are going
to fire and we want to see what's
happening when we run them okay so
currently we're just getting this one so
save it and we should get more yeah so
we're getting a few events now it's not
easy to see here so instead of doing a
console log just going to refactor this
a little bit and create something on the
screen so why don't we just do a little
order list here
and work with that i'm going to call it
message log
okay and let's create a view that is
function I'll show actually append to
message lock
sorry shop down in front of that dollar
message log and I'm going to construct
something a little bit a bit nice to
work with so here we go HTML string is
equal to just doing the same kind of
building that I'm doing up here I just
want to build in some list items
and this will be the message so we pass
a message to it it's going to build a
list item and then we're going to
turbocharge that and append it to the
message log all right so let's just
turbocharged that and let's try a pen
message log instead of the consoles
whereas a consoles Get Rid art one not
those going to fire and we can put it
here we also saw inside that was the
type of the event we're listening for
you know inside this event inside here
right down there that's what we're
looking for the type so if you notice
the duration changed event and so on
okay so let's just run that so this is
saying this is interesting here because
this is showing the progress I mean what
I'm doing is I'm appending them so this
is happening first then this one then
this one then this one then this one so
one of the interesting ones you really
want to have is that can play through
type whoops can play through
there and you notice that fires last so
this is firing after slow did the
metadata after its figured out the
duration it just did that initial
suspension and you see progress on the
load start is the very first one so this
is you know showing you the progress and
what a lot of people will do is they
will fire up when everything is loaded
so in their generic handler they might
do something like this if e type is
going to be equal to load start then
maybe play the sound I'm just going to
play the sound do we have a play the
sound yet no let's just add that quickly
come back to that I play the sound and
guess what this does it plays the sound
on the audio element notice it's not a
dollar in front of that because you
can't do play on a jQuery rapper okay so
using the audio element you've already
got that here see okay so that will play
the sound when load start works so in
theory this actually shouldn't work
because you know we really want to play
it when we can play it all the way
through lodestar we don't even have a
duration we don't have the information
however what will happen is it will
still play because it will do a waiting
event from listening for a waiting event
here if I play the sound here lies such
an annoying sound I'm going to try not
to play about that often but all what's
happened we load start then it waits
because this is firing immediately and
it's causing all of this to happen and
it's not quite ready yet so it waits and
it suspends and then it can play it once
we've got can play through the time
starts to update okay if that plague is
happening before can play through as
well so it doesn't need to wait until it
can play the entire thing all the way
through notes a short file you can still
start playing anyway so loaded metadata
might be good start to time to play but
i would suggest waiting for the can play
through before we play the sound
can play through okay let's run that
okay so notice we don't have a waiting
event and everything is working nicely
loads get some progress events waits for
a little while check the duration loads
all the data it's fully ready to go and
then plays and then it starts to do the
time update now currently we're not
showing the audio on the screen if you
want to show the audio on the screen
well it's quite easy what we can do is
we can just do this unlisted you can add
the wood controls find that attribute
word controls and throws on the screen
so let's watch you know what I'm going
to put that on me if you don't mind show
you don't you can see it playing ya kay
there but that's actually playing
there's the audio see alright so notice
what something here is we now have audio
controls that you can control and so if
i want so i can go back and forward on
here and can play and do all this stuff
so there are other commands that you can
listen for for example you can listen
for seeked or seeking much okay so as i
start to go back and release play you
have a seeking events and seek to vents
so you can listen for that you notice
when someone's scrubbing through your
stuff yeah okay I think that's all i
really had for you on basically looking
at what events are fine and when they're
firing and the thing that i would
suggest you wait for really is probably
the can play through which I don't see a
lot of people doing but I think you
probably want to do that um okay and I
don't want to keep this tutorial too
long I just wanted a little short
snippet to show you you know how we how
we do our training and can we give you a
bit of idea of how this Audio API how it
works on a basic level at least and
showing you how watch expressions and
this kind of stuff so hopefully that
spin of some interest to you anyway guys
I'm going to be doing another tutor or
shortly probably
more complex subject but hopefully for
you beginners you like what we did here
and so get in such a new circle if you
want training speech again</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>