<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Developing Web Apps Using the Python Pyramid Framework | Coder Coacher - Coaching Coders</title><meta content="Developing Web Apps Using the Python Pyramid Framework - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Developing Web Apps Using the Python Pyramid Framework</b></h2><h5 class="post__date">2013-04-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/kRKOWNdT72A" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right so it's great to see so many
Python enthusiasts it's like having Pike
on every month okay so I'm going to talk
about my favorite web framework pyramid
and we're going to spend it's a 45
minute talk we'll spend the first 15
minutes on basics and another 15 minutes
on slightly more advanced stuff and then
last 15 minutes on things like
WebSockets and more oh and furthermore
you can access this presentation just
look on the meetup website I put a
comment and you can go through the
slides at your own pace and the code
right now okay so can everybody see that
a piece of code here okay so you can get
started installing pyramid is easy so
start your virtual environment tip
installed pyramid okay so we'll create
our first you so we do pyramid you
create they have existing scaffolds so
we have a starter scaffold here let me
show you right now so let's create a
scaffold okay so we just created our
scaffold here the files inside it the
next step we need to do is install and
then when we run our server
so this is what you get for free and on
the right you see the debug pyramid
debug toolbar that gives you various
debug information about your application
okay so we just
if you fold along we just wrote our
first pyramid application so I want
everybody to do this okay and do this
yeah okay so the most important file in
the pyramid stack is this file called
init it's in the main configuration and
the mase what this init file does in the
package is where you specify it's where
you configure your whisky app so
everything that we'll do from now on
we'll take this config file and run
functions off of it and it will return
an app okay so that's our basics you can
read more you should check the pyramid
documentation and the pyramid cookbook
there's a lot of examples that and I
especially recommend the pyramid
cookbook if you're an advanced user
okay so views the site so the first
important concept I told you was the
configurator that's where you configure
whisky app the second most important
pyramid concept is your view so how the
internet works in two phrases your
browser sends requests a URL and your
server sends my server sends a response
in pyramid the the route Maps the URL to
a view and the view transforms that
request into a response so you can so in
our example app we can see what routes
have been defined and so you see a lot
of stuff cruft because that's encodes
the debug toolbar
but here are the routes defined in the
production environment and if you wanted
to see which views are defined for the
home directory you can see that the view
direct the view is called view so how
many people in the audience already knew
this stuff okay so most of you are new
to pyramid ok so how to add a view so
adding a view so if you remember just as
I said before here the purpose of review
is it transforms a request for URL into
a response and in pyramid we take if you
want out of view first you define your
view so we're defining a view code index
it takes a request and returns a
response that's rendered into JSON
so in okay and then you specify things
with the view config decorator ok and
a-- and then once you've defined your
function your view you need ad define a
route that map's the URL in this case
we're mapping the home directory into of
the route name called index so here's
the route name index and view config is
what connects the view to the route and
here is where we connect the route to
the URL ok so this is so we just went
over how to define a view and this is
how for the most part you'll be defining
the behavior for your web app ok so we
just saw a possible renderer code for
Jason let's say you wanted to use okay
so the default template renderer is
chameleon you can see if you edit your
okay so let's just backtrack a bit in
the default scaffold you see that they
use the
Kamui and template with the extension PT
if you wanted to use Mako might make mic
layers templating system there are two
steps first you need to define in your
configuration file where your templates
are located and then you write your
template and finally you change your
renderer to say that you want to use the
Mako index okay so we just covered oh
and one more thing that you want to do
is so some sometimes it's useful to have
global variables in your templates like
user ID or is admin is member and you
can specify global variables called
renderer Global's and here you need to
tell your configuration you're
configuration this function called add
render Global's before it renders each
template so in this case we're adding a
global variable that's accessible in
each of our templates as user underscore
ID and here's how you can do it okay so
in we just covered the basics um if you
want to so the scaffold that we had used
earlier was called starter it can see
okay so we just use the starter template
if you want to use alchemy if you want
to use the default database thing you're
going to create the alchemy so using the
alchemy scaffold okay let's so now that
we've covered the basics let's take this
quick break so I want I'm going to ask
everybody question and in response I
want people to say rated-r okay so
what's so what's pirate's love which
kind of movies rated our
yeah okay so just let's go through that
right now so P create scaffold alchemy
are okay oops and I let me move it back
okay so this is so before we use the
starter scaffold now we're going to use
the alchemy scaffold which includes
support for SQL came-- sequel alchemy so
that's another question I have you guys
how many people say sequel alchemy and
how many people say SQL alchemy
okay sequel alchemy just so I don't
annoy the hell out of you okay okay so
models yeah so most we that's what you
need to know oh yeah so by default it
includes a transaction manager and you
don't have to do anything that means
that if your view fails for some
exception then it doesn't commit at the
end it'll roll back any database
transactions that you had it and if you
write an outside script which I'll show
you soon you will have to use a
transaction manager explicitly oh yeah
so in Ex an example so the scaffold
includes an example of a script which
I'll talk about soon so scripts you so
you want scripts to also be able to
access your database because in case you
have a cron job that modifies your app
but I'll talk about that in the next
slide so scripts so so far you've
already seen scripts such as P create P
routes P shell I don't think I've shown
you P shell but if you want to write
your own script there are two steps so
you have to first you write your script
the
major components convenience functions
here are get app settings which will
take as an argument the path of your
application configuration file so the
application configuration file is for
example development dot ini' or
production dot any it's a text file that
um
standard text file that contains your
application things and the other thing
that you want to do is initialize your
database okay so let's say you've
written your script the next thing you
have to do is register it so you edit
the setup dot PI function and you'll see
at the end it says console scripts can
console scripts you add your script as
another line there and then at once
you've to once you've done that you can
run your script and it'll on the
application configuration file and it
should be able to pick it up ok so one
tip that I have many times you don't
want multiple copies of a certain script
running at the same time so you can bind
a socket to make sure because that will
fail yes so let's say ok let's say you
have an application that people it's a
revenue sharing system and about once a
month you pay out everybody you share
the revenue in that case we would have
the web app running and then we might
have a cron job that says once a month
pay out these people so in that case it
would have to access the same database
and other things so that's what I need
by a script ok so I and also in that
case you will you wouldn't want the
payout sent twice and so that's why you
it'd be good to bind a socket and that
ensures that only one version of
the script is running at one time okay
so some tips for debugging okay so a lot
of you have probably heard of PDB you've
heard of IP DB which is PDD using
ipython and you can also use ipython
embed to to debug your script so what I
pothen embed will do is it'll drop you
right in there into the ipython prompt
and you can do a bunch of things but
what you might not have heard of is PU
DB so PU DB is just like the old days of
if if you've used something like turbo
debugger it will give you a nice
graphical text graphical thing so I
found it very nice you might not have
known about it okay so I'm trying to get
back okay so you can try these on your
own
each of these four options is a way for
debugging your pyramid application ok
permissions let's see how we're doing on
time how many minutes do I have left
okay so
permissions this one I want to spend a
little time on because the way pyramid
does permissions slash authentication
could be confusing but it's not if you
just understand these basic concepts
first I'm going to go over how to
authenticate against your own database
and second I'm going to show you how to
authenticate with third party provider
thanks to a package called vel ruse that
I'm been Bangert wrote and he's actually
in the audience today
okay so permissions in pyramid when
somebody accesses your application we'll
call that person a user a user is in a
group each group has a set of
permissions and a permission gives that
user access to selected views the funk
the where you define so when you
implement this the place where you
define given a user ID what groups that
user is in is get groups which I'll show
you soon you define which what
permissions a group has in ACLs in a
class called the root Factory and
finally you give you specify what
permission is required to access a view
and a consent of you config constructor
okay so I'm going to show each of these
in a specific code maybe I'll cut and
paste this into something a little
easier to read
actually
you
okay so what we just what we just said
was when a person accesses your site
that person is a user so here's here's a
very stripped-down version of how you
might implement authentication for your
site if it's against your own database
here's the configurator function that we
saw before first you choose an
authentication policy and an
authorization policy in this case we
chose to use auth to get off ticket so
there a couple options you can either
use an auth ticket that's like a little
string in your cookie that's been hashed
with a little thing to detect whether
it's been tampered or you could choose
to store it in your session and store it
on your server so when you use your auth
authentication policy okay so when
somebody goes to your site pyramid calls
the callback get groups and get groups
get something called the user ID in a
real environment you might check the
user ID against the database and
retrieve the permissions but here we'll
just do if we do a check for if the user
ID is the username is says Tigger then
we append the group special so each
group is a string and get groups returns
given a user ID get groups returns a
list of strings that indicate what
groups that user ID belongs to so we
just covered the first part how pyramid
identifies what groups the user belongs
to now how does pyramid identify what
permissions each group has well you need
to define something called a root
Factory and here's where you define your
access control list and you can say oh
wow this particular group which is the
second column in this last one you can
special so allow everybody in the
special group to have the permission of
yummy eat and the final step of this is
then you need to define a view somewhere
that's could be in your yummies module
that given a request and define a view
config and the route name being
something and you also need to define
the permission is equal to the string
you eat so here are the three components
and you can look at this the slides are
online you can look at this in more
detail but that's the main concepts for
permissions yes permission takes a tuple
in which case here um that I don't know
does somebody know the answer to that
I'm guessing you might have to add
another line and that's the way I think
I've done it before if you want to give
a view to permissions okay so we just
covered how to indicate with the own
database if you want to attempt gate
with a third-party provider so third
priority provider means like for example
open ID so open ID is supported by
google it's supported by Stack Overflow
and I think github and other things or
oo auth you can use a package called
Belle ruse very recent package it's it's
nice all you need to do is include vel
routes and your configuration and they
just go to the site it is here
so the nice thing about Vagos is it it's
a pyramid app it doesn't require your
application to be a pyramid app but if
you are writing a pyramid app you can
take advantage of it here's what you
need to do in your init file in your
package you include values you specify
what kind of providers you want to let
people log into then you specify some
credentials or you need to define two
views one so what happens is when in
your template use you give it a URL that
the person will go to so they'll say oh
login via Twitter
they'll cook it they'll be redirected to
Twitter's login page you login and based
on what happens you get redirected back
somewhere and when you get redirected
back to your application here are the
two possibilities either the
authentication was successful complete
or it failed so you need to define two
views one what happened if it was
complete and the other when it's failed
and the last thing that you need to do
is of course redirect to the URL in your
application so three basic steps to it
to use well ruse like I said so define
two views and include the URL in your
template okay so now you've come to
deploying application I'm only going to
show you three ways to do it okay so
let's say you serve with um G event okay
since you're using since pyramid is a
whiskey application all of these take
the same form which is you get your app
you get your app looks like I can't zoom
in you get your app and let's use this
one you get your app and you give it to
the server and you ask it to serve
forever so when you use gee event yeah
it's it's mostly it's the same so you
get your app it loads it from the
configuration file and you run it so
something so ok so G event you would use
it's a great
so default server is waitress they use
waitress because it's it's compatible
with a lot of platforms like Windows and
Mac but geo event is very fault tolerant
let's say you wanted to serve your thing
behind SSL and WebSockets one thing you
could do is serve it behind nodejs so
some corporate or government
environments have very strict firewalls
and ammonia allow 84 43 and even within
those ports they block all non HTTP
protocols so sometimes to get around
that and still be able to have your app
use WebSockets you need to put encrypt
your WebSockets in SSL so that's why you
need something like this so this is
actually some nodejs code using HTTP
proxy and what it'll do is let you use
WebSockets through your secure server ok
so another quick note if you're serving
your stuff behind HTTPS it's useful to
have two backslashes that will resolve
your URL to HTTP or HTTPS whichever you
happen to be using at the moment
and you can see more deployment options
in the cookbook and detail I'm just my
my goal here is not is just to let you
know what's possible so that later on
you can look into it so don't worry if a
lot of this is breezing by you right now
oh so okay so caching caching caching I
think Canadians a keishon so caching
caching you can use so the original so
dogpile cache is the new version of
beaker dogpile cache you can it still
has the same concept you make a region
in that region you specify what you want
to how you want to store the stuff that
you're caching so in this case we're
storing it in memory but you just switch
this out swap this out for memcache to
Redis or files and that'll be your
caching back-end then you have this
decorator in each function that you want
to cache region cache and arguments and
when you run this you'll see that the
first value is not cached because it's
computed and the second one is cached
and the third one since we invalidated
the cache for those arguments it'll run
the thing so this is the dogpile cache
written offset by Mike Beier who wrote
sequel alchemy okay so let me
demonstrate this real quick and and
before I go into WebSockets I can take
one question okay
so WebSockets is a little harder concept
so before we do that let's just get up
and stretch people should get up and
stretch and this is actually something
you should do in your daily work day
about every 10 minutes you just get up
and stretch and especially put your neck
back like this and that's so you don't
develop this crane next posture and well
and while you're at it since you've gone
30 minutes of pyramid high-tech stuff I
want you to give your neighbor high five
okay cool okay so now I've woken you up
because WebSockets this is a little more
of a higher-level topic and I'm going to
need all your attention for this one
okay so WebSockets
so how many people have heard of
WebSockets okay good
WebSockets you'll use it for if you want
to make a real time app like a dashboard
for example when a dashboard is let's
say an emergency responder wants to see
where all the firefighters are right now
um or a chat application like chatting
so here we it's it's actually become
very easy thanks to a package called G
event socket IO you can take a look at
it which oh yeah the G is very important
okay and you want a so Jeffrey started
it and I forget his name but he a
Bourget continued it okay so what do you
need to do to integrate so you have a
couple options when you want to put web
sockets in your web app the way I
originally did it was I had a separate
node.js server running
and my pyramid app would would talk to
it as a separate thing but if a better
way to do it is actually to have it
inside your pyramid by the bat so oops
okay so here are the steps to do to use
to use website
socket web sockets in your application
you I'm just going to show you how to
use socket IO there's a second option
called pyramid sock j/s and it's more or
less the same steps
I like socket IO they both have the
reason you use this instead of web
sockets directory is because you have a
fallback in case that the browser
doesn't support it
okay so first step use socket IO server
so that one we actually saw before in
the thing on servers let me just find it
okay well anyhow so before somewhere
there was here it is so here's the part
about G event socket IO so this is how
you first the first step to using web
sockets in your app is to change the
serve write a script that actually uses
G event socket IO socket IO server so
that's step number one done now you want
to define a view containing socket IO
managed ok so what that is is so here's
our views okay so this is reviewing
before how to add a view what you need
to do is define a function that takes a
request and returns a response and in
this case it's returning this is the
response and it's the route name we're
going to use a socket IO
the second step for adding a view is we
connect that route to our URL so we do
this during config dot a drought which
connects the route name socket IO socket
IO to the URL called socket IO any route
URL that matches this pattern okay so we
just finished step two which is we just
defined a view that delegates everything
that matches this URL and delegates it
to the socket IO manage function which
is convenience function that is in the
package in that convenient function what
it does is it um it Maps channel names
slash namespace names into classes that
define how your behavior the web socket
behavior so we could have another one
like news and this we'd have to define a
news namespace okay and define the next
step the front almost the final step is
you define your namespace so this is
what what happens when it receives
certain events so you define that here
and of course you also need to connect
to the web sockets in your template and
that one we can I can show you if you
want yeah so those in those three simple
steps we just enabled our application
with WebSockets and you can start doing
some real time stuff okay some some
other add-ons that I didn't cover yet so
you can yes in terms of fall backs
further if you don't have WebSockets and
you have to support older browsers
uh-huh how good is the haul-back
well that's why I don't use WebSockets
directly I'm using the socket IO package
so there as far as I know is it's a
pretty excellent
um fallback so they so here's the site
it's
this is not Python this is I guess the
protocol but yeah it'll it'll fall back
to long polling if there's no website
yeah this is it's been a while and it's
but yeah it's it seems to work well for
me there's long polling and then it's
flash so they have like three or four
five six fall backs but like I said it
I'm warning you it's still an early
stage technology so you don't want to
rely on it too heavily okay so if you
want to other add-ons there's a bunch of
add-ons that we didn't cover and they
all follow the same kind of format yes
oh yeah um I don't think so
because this is at this point where
delag we've delegated we've handed it
off to this socket IO managed function
so pyramid once it had reaches this
point pyramid isn't responsible for it
anymore because I mean because I don't
think socket so once it connects to the
socket it's it's talking inside it and
it's not through URLs anymore yeah other
add-ons are pretty much the same you
just to use them you have to config
include it and then you do some
configuration stuff so you can send mail
you had sessions forms and you still
have form and code back from the pylon
stays for validating forms okay so some
future directions for pyramid it'd be
nice if we had a unified payment system
so just like we have Bell Roos for
unified authentication you have a lot of
payment stuff right now like wallet in
Amazon and Square and PayPal it'd be
nice if
is one so some ways that you can
contribute to pyramid a lot of ways to
keep it alive if you don't want this
project to die you can answer questions
I think over always looking for somebody
to write a book on it and pull requests
and add-ons so I think that's it so now
I can take questions
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>