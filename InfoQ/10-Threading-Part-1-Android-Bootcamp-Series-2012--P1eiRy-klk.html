<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>10 - Threading - Part 1: Android Bootcamp Series 2012 | Coder Coacher - Coaching Coders</title><meta content="10 - Threading - Part 1: Android Bootcamp Series 2012 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>10 - Threading - Part 1: Android Bootcamp Series 2012</b></h2><h5 class="post__date">2012-02-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/-P1eiRy-klk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so things that potentially run a long
time should not run on the main thread
that was the best practice before
honeycomb since honeycomb that best
practice became a law right so the
reason why our apps are specifically
crashing is because most of us are
running an ice cream sandwich or
something similar right
so you actually are not allowed to
perform a long-running task on a main
thread right so what's wrong a lot what
would be a long-running task give you
some examples well it's actually
networking right I mean well yeah
anything anything that anything that we
are not in control of our arms destiny
right not everyone's got a fast 4G
connection right so how do you know that
this is not gonna take 20 seconds 60
seconds to actually do a post you could
be a some 2g connection timing out
god-knows-what right so so that's that's
the first reason to that this will not
be able to run second reason for other
examples would be connecting to a
database for example talking to reading
doing i/o stuff all those things could
potentially be a long running tasks so
we and we have a single thread that UI
runs on so we should put this on a
separate file how do you do that you
guys are Java guys come on I did it up
so the problem is this line here wants
to run a separate thread okay I do that
20 to services yeah yeah I mean service
would give us something called a
background stuff but in some cases could
be the right solution yes but I kind of
want to keep it in this round because
yeah swing Java when you wanna put
something on a separate thread right and
this is just a Java thing it's got
nothing to do with Android it's just a
very simple Java thing you can basically
take your coat
let me see actually that's cool it's
actually not trainable that I want to do
I tread dot start yeah so in Java when
you want to put something on a separate
thread you take that something something
right and you wrap it with this wrapper
like you basically say what we're right
here right now creating a new thread
inside the thread where it's anonymous
inner class by the way but don't get
stuck on that too much we're creating a
run method so we're defining it and then
we're saying start so this is now gonna
run on a separate thread I did that know
if you don't like typing which I don't
blame you for what you can do is another
useful shortcut in a club so in this
case it's not perfect it's to go source
surround web and then do a runnable
so this is the Eclipse mechanism for
helping you do a bunch of stuff on your
behalf right source surround worth novel
yeah you could configure a template so
there bunch
Serrano looks like that and so basically
I could create a new one I'll say the
name is gonna be thread description
BAM about to start right and it's me
don't worry about this this is just me
kind of playing with some stuff so you
can actually expand like check this out
let's try this I could select this I
could say source surround with thread
BAM
cool huh white doesn't matter maybe
maybe it's good to type it first time
around so you actually see how things
work right all right so so far so good
in this um so now this is gonna be
outsourced on a separate thread alright
let's give it a shot running
okay I'm gonna clean this up but
appertain update BAM died again
but we don't swell anymore we know that
something dies which is basically look
at the exception so first again you guys
still have it crashing but we now don't
know exactly where it crashed yeah
because you're running on free honeycomb
yeah so we get probably the same
exception and we just don't know what
the exception is so what I could do is I
could now catch that exception so
something is dying here right so what I
could do is I could say Sora's surround
the word try-catch block that actually
figure saw the type of exception right
and the only thing that it's not is it
smart to figure out which exception it
could be possibly dying from but this is
not a proper way of printing that
exception actually what you would want
to do is you want to print it like this
log dot e that coma
you know died comma E so this is a more
properties the the Android way of
printing that exception to the law cat
which we talked about earlier yes
following so far
so
so if I run this now I should be able to
see at least what white diamond
so let's try this again
oops died
you wanna see a long train no no oh yeah
why then print my log I'll try this job
at the standard Java way I'm confused
why I didn't print a lot yet it should
be printing the locker
there we go this is the exception I
don't post exception right so let me
just recap so what we've done so far is
we wanted to simply do this three lines
of code right we want to do this three
lines of code but we have to put it on a
separate track which was this ugly stuff
here right and then we had to actually
catch the exception and figure out
what's going on why it's dying right
if exam so the reason so this exception
here is somewhat cryptic no unknown host
exception it could be many things it
could be that you your emulator really
is not online so it has no idea what you
know that mark on your thumb is right on
you know this frequently happens in with
firewalls when you do this being a
company firewall it's probably the most
common question that people ask from the
book the author I just did everything
and I get this uncrossed exception like
okay so refer to that post such-and-such
a because it it could be many things
what I would do to verify the firewall
I'll just basically say hey can I
actually go on a computer because
sometimes you truly may not have a
connection right so I would verify the
technician I open up a web browser and
go outside world to outside world right
so if I can do that right I may even go
and be more specific
Amba
you don't need to do this but if I can
do this that tells me that there would
be nothing wrong with our network on the
device that's that's a good way to
eliminate that assumption right see it
renders everything's good so the other
possibility is that we simply don't have
permission to access Internet now in the
past when I used to do this in a back in
the you know one X days under 1.5 1.6 I
would be like you know what don't even
worry about permissions just blend the
code let it crash and the exception is
gonna tell you exactly what happened
so this exception used to be as opposed
to an own house it will basically say
you do not have permissions to access
the Internet have you declared such such
permission question mark like it would
be so much over a hint like no telling
exactly what's wrong right
so I think the somebody decided that's
too much information so they kind of
made the exception way more cryptic but
in the same issue yeah no sister so in
Android whenever you have something that
is potentially dangerous you need to ask
the user to grant you their permission
to do that something that's potentially
dangerous accessing Internet is one such
thing so you declare the permissions
that you need in your manifest file
rights if I go to the manifest file I
open up permissions right we're gonna do
it the easy way first right so if I open
up my manifest file you go into
permission staff you click on add right
now you do not add permission group
permission tree or permission what you
do is you declare a user's permission
it's not these three phone call
misconception is like oh I need to add a
permission no no we're not adding a
permission we're adding a statement that
we're using in order to define
permission right so you define you
declare you basically say all right
we're gonna choose users permission
click OK now from this shortlist we're
going to find the permission for
Internet there it is it's one of the
more common ones
so far single now there's no apply
button so it's not obvious how you
actually you know you have this applied
so you get a hit save for this to
actually take effect so hit save and
then it should say something like this
or if you look at the XML file basically
you added this line by the UI okay so
whenever you do something dangerous you
ask the user to grant you permission to
do that
so basically when this the app is
deployed it's gonna prompt the users you
can say hey before you install this app
this happens to go and do things on this
you know Wild West of Internet are you
sure you are not installed proceed with
installing this app and you gotta grant
all the permissions from nunn of nunn
none at all so why does eclipse what I
doesn't do the checking for you
it doesn't tell you oh you yeah I guess
suppose suppose it decoded it could
basically check for your call and say
hey you got to define these permissions
yeah
it's good there's information about no
actually this crash isn't runtime so the
code that the code that actually
connects to the Internet is is checks it
says do we have a permission so that's
that sort of like a business logic it
says the check you know assert
permission to access internet behind the
scenes what really happens is this code
is actually now assigned to a GID call
dinette
right so basically this app now has
island group permissions so so even if
nobody checked anything if you have a
one Linux process try to access another
Linux process the kernel would would
kill it off right so technologically
this is pretty decent good easy good an
elegant solution but we talked about it
briefly the problem is the social
engineering a specific I click on run
it's gonna reinstall the app and then
we'll run it yeah yes you may walk
being crash let's see public timeline if
i refresh this and I think this is me
but you know we can bear if I can say
the law mg m-- update refresh definitely
right so it worked now wait then I say
was gonna ask us about approving a
permission right but you guys didn't do
that but it worked right so for
development purposes purposes um it's
just assumed that all the permissions
are always granted that's to minimize
this whole cycle of like change
something deploy test and Sun right
developing purposes all the permissions
that are automatic and granted you need
the lock yet yet so what I would suggest
is if you guys are not sure what's going
on right what I would suggest is putting
some log log log right so for example
you don't know if it's just not printing
anything of this line or you don't know
if this was successful so how about we
just print out something I would just
say log dot d tag tag comma you know
successful it's fully post it you know
something status text right and then I
would say something like that here
add I already do died so run it with
that and actually verify you know is it
and I try to add I'm not sure this was
supposed to print the error message but
it doesn't so I added this and that
seems to work so try that and maybe
gives you a little more clues about the
execution report so we have something
working right we can actually post to
Twitter and we can see that it's all
working right you can verify that the
stuff is there and I see you have some
very interesting and meaningful tweets
right so that's good right you have a
little web service going
you're right with this app you can
probably now get what 19 cents for this
app or something right I mean it works
right so um well one reason why nobody
will buy this because they wouldn't know
if it actually worked on wouldn't work
right so it'd be nice to actually tell
the user hey this worked it's been work
right so one way we can do that is we
can do it there's this cute little thing
in Android called a toast right so what
a toast this is that little balloon that
you may see it pops up tells you
something and then disappears I'm
talking about yeah pops up tells you
something then disappears right so um
what we could do is as opposed to saying
successfully posting which is nice
it'd be nice to actually do a toast here
to the user so it goes something like
this
toast dot make text yeah it's asking you
for the context the context is the class
itself the status activity itself so you
can say status activity this status
activity is a context with inherits from
context the text could be you know a
person was successfully posted blah blah
they make this bigger because you guys
can see it
the duration is gonna be it's defined as
a millisecond so what do you think it is
I'm sorry it's defined as an int what do
you think it is yeah so that's a typical
like Java conditioning right we would
think that if it's in a generation it's
in millisecond it's an inn it's likely a
it's gonna be likely in milliseconds
because that's got normally Java works
but it's not it's actually one of the
following to toast dot length long or
length short it's an actual a constant
and the worst thing is if even if you
try to put ten thousand milliseconds
it's just no it's gonna work but it's
not gonna be that 10 10 seconds this was
gonna be equivalent to long yeah it's
hard coded so one thing that's missing
in here is that also is not very
intuitive that although you did what is
called long thing those make tags blah
blah blah you also have to say dot show
I keep forgetting forgetting that all
the time basically adding this one line
of code right
if you want you can do the same thing in
your failure when it fails right you
could say does that make tax you know
failed dive
again so far so good so this should work
right it should give me a little
notification saying either succeeded or
failed that doesn't seem to be a third
option right so let's write in see what
happens
so let's say hello click on update damn
you died
I'm going to die it did that for you
guys okay
so it died and if you look at it in
exactly the locket you see that it died
online 38
well whatever line that is for you so
you go to that line and BAM boom BAM it
died here and basically what it says it
says something along the lines can't
create Chandler and inside credit has
not create loop or repair it's a long
explanation basically what it's trying
to say is that you cannot touch anything
UI from anon anon UI thread right so
what we kept going on is a non UI thread
so this thread is fine to do some work
that's okay but if this thread now wants
to go in update our user interface or
widget throw a toast or something like
that that's not okay
right so how do we go around that well
there are different ways and we could do
various we could basically do various
things with synchronizing the threads
and and so forth but all that is a lot
of pain it's a lot of work so to make
life simple because this is a very
common pattern and Android guys
developed a sort of sending on top of
general Java telling telnet mechanism is
called the async task and async task so
so async task is basically an
asynchronous task something that happens
asynchronously and then updates that you
want yeah so we're gonna rewrite this
ugly code using async task right in the
spirit of first line things the long way
and then doing it the elegant way right
get the creative motivation so excuse
what we're gonna do we're gonna create a
new class called async top post to
Twitter
tasks or something like that myself call
it class goes to Twitter extend a sink
so far so good all I did is this two
lines of code
so async task wants to take three
parameters forty miles there it's gonna
tell you it wants the params the
progress and the result so a classical
example of an async task would be I'm
downloading a file my app needs download
the file right it's potentially a long
long downloading file right so I would
have I want to outsource that to
somebody else to do the job right yeah
but here's a file or many files go
download them let me know where you act
how far along you are you 50% done 75%
done that sort of thing and then let me
know if it succeeded or failed at the
end of the day right so those are those
three parameters you basically have the
first parameter is going to be your
input what are the files to be done
asynchronously what was the job to be
done asynchronously in the case of files
it may be like do you are out too fast
done or something like that or file name
but in our case the input is gonna be
let's say it's a text message if you
wanna post right to keep it simple so
I'll put a string here on in case all
file download the progress could be is
for example a manager it could say you
know 75% done right that's the most
typical type of a products but in case
of posting to Twitter you don't really
know you're 25 percent done posting to
Twitter it's just like wait wait wait
and then that does everything right so
it doesn't the progress doesn't make a
lot of sense in this particular case
because we're not getting a feedback
that we're done with you know first
hundred hundred forty characters right
so I'm gonna put void ignore it
and finally I would have the result and
result could be like a boolean year now
succeeded failed it could be actual text
message fail because of blah right so it
could be any of those so I'm gonna put
the string for now so the second the
last string represents the result the
the error message so far so good
what happened sorry so so now for that
so this is now under my breath what do
we know when something's under the line
that we do what yeah you would put the
mouse over it and it says blah blah blah
blah blah and I said whenever you see
this type of a blah usually wants to do
the first one and unimplemented methods
right so they say alright add an
implement methods and that basically
adds an item that you must have which is
called do in background
good so basically in async tasks doing
background is what takes the job and
does it on in the background this is
where your long-running operation would
go okay so in our case the long-running
operation is this thing here right we
said try then go to Twitter post
something if it fails so do this if it
succeeds with that yeah yeah now you can
cut paste this or here's a cool feature
in Eclipse if you guys want to know all
these cool features you can hold the alt
button and then do up down alt and then
Arab down alt options option
it's alt on PC or you can copy cut a
straight
either way we just move that blob of
code into this location so far so good
now everything is almost not a nice and
then they accept the it doesn't know
what status text is right on status that
the text in this case is the text of the
user typed in and that's gonna come to
us via doing background so this strength
the other dog do you guys know would
string those dot is or like dollar dot
in general yeah you can have any number
of arguments it could be that it gets
5/5 tweets to post or you know ten files
to download right it's an art it's a
variable length argument that's what the
double ovens but ultimately all it is is
it wins the des very variable which is
actually a dumb name arg0 doesn't tell
you much but I would say the params or
something like that it usually means
that this is an array right that's all
it's actually represented John so doing
background is gonna get a bunch of messy
a bunch of tweets to post but we only
care about one because we're only
expecting one
so basically status text is going to
become four Rams zero which is the first
one right
that fixes back
okay so but we're still doing background
is gonna happen on a separate thread in
the background so this is still gonna
crash what we really need to do is we
need to synchronize it with the UI
thread and that's apparently with async
task offers so let's do this what we
wanna do is we want to look into
possible methods if we can override any
sync task and it only has a handful of
them there's doing background there's an
own progress update and on post execute
so you interpreters you could go look at
the documentation and figure out how
async task works right or you can do
this nifty little feature in in Eclipse
which is basically you go source
override implement methods right so what
this does is eclipse then goes and
figures out given where it's at I
instead of an async task what are the
possible things that we could be
overriding or implemented and eclipses
all right I see already take care of
doing background so you really have a
couple of choices on cancelled
onpostexecute Rancic an important one
progress update so the progress of this
is the one that gets called every single
time there's an update like for example
you know downloading a file and you're
like okay I'm 75% done and so on we said
we're not using that one so the only one
that we actually care about is done post
execute so typically you care about so
on post execute select that one click on
so you guys there so what's going to
happen here is that we're going to have
the the thing that runs in the
background happened in the background
but then what we whatever we want to do
in the foreground in the UI thread we
can then do it here so this was our UI
that was failing right the top sorry the
toast piece right so what I'm going to
do is I'm going to move the toast piece
down to post execute because that's
where you I should be running
okay yeah progress update to also run
some you are yes we updated the the you
know spin or whatever use
so what also we need to do is we need to
then then we need to care returned the
message so it supposed to returning null
which is not gonna cut it
okay what we're gonna do is we're gonna
return the message here they turn
something like this successfully posted
some piece of text is successfully
posted block
similarly here we're gonna as opposed to
doing twelve tossed off we're gonna say
return and then the message is gonna be
failed to post all right so I moved the
toast stuff into post execute and here I
just simply return a message in case it
worked out in the message in case you
failed right then finally I just need to
fix this to victim resolved at this
point everything from piles
so return value of doing background yes
so I'm gonna explain it in a second I'm
sorry what were once so whoever's then
so this guy could for example if I get a
progress here I could say I could say
this dot there's nothing called no
published progress then I could probably
publish a progress like you know some
some value yeah if I had a way to do
this but yeah so so far so good
so basically what we used to have before
is we had this thread where we did
something in the background some work
right right that's what we can the
problem with that mechanism was that we
were not allowed to touch the UI from
there so we could not update what's
going on so instead of doing that we
basically created this class where we've
moved the coded transcend a background
into doing background right so that's
our separate thread then we move the
code that actually posts that happens
after it's done here into post execute
so what we have to do is kick start the
Kickstarter poster Twitter so get rid of
this and it place it with some like new
post to Twitter dot execute possible
execute and then status
that's correct yes yes that's correct
yeah it's not so this is what happens so
the so basically let me draw this for
you
so post to Twitter let me use different
colors post to Twitter take some kind of
value okay and it has execute this
posting to Twitter that becomes an input
into here that becomes that okay and
that's what we are ultimately posting to
to Twitter right that's that okay now
the result of that becomes a on post
execute so whatever we return here or
here right becomes an input into here
right make sense then we are we we print
that out so that's that's what we
becomes a result and we basically xx
that right so in then this whole thing
runs on is on on new thread and this
whole thing runs on UI track so this is
basically UI thread this whole thing
everything else is UI thread right UI
thread but this is a new new thread what
do you mean oh yeah yes yeah thanks yeah
so there should not be printing
successfully posted they should just
print out a result yeah yeah because
that's that important whatever that
input is yes yeah we don't need to do it
anymore
yeah that was because you can't if it's
gonna be changing you can be passing it
into a thread yeah
yeah nutria and then this is the this is
gonna be you I tried right so we can
test this now we can run it and see what
happens
so test is update and check this out
this will be the this was the toast then
disappears right</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>