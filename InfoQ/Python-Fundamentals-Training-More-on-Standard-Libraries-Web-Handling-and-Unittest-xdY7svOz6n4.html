<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Python Fundamentals Training - More on Standard Libraries, Web Handling, and Unittest | Coder Coacher - Coaching Coders</title><meta content="Python Fundamentals Training - More on Standard Libraries, Web Handling, and Unittest - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Python Fundamentals Training - More on Standard Libraries, Web Handling, and Unittest</b></h2><h5 class="post__date">2011-11-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/xdY7svOz6n4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">you know that's a really good topic for
the last day so Danny's wondering why we
keep on talking about Python 2 when
there's Python 3 out Python 3.0 was a
failure it's pretty much what it boils
down to Guido made the decision to break
backwards compatibility with the python
2.x series in what was originally going
to be python 2.6 I think so it's been a
while since the decision was made and
the community outcry made everybody
decide we're going to make a new version
major revision of Python 3 that will be
a backwards incompatible with Python 2
will continue parallel development of
the Python to branch and the Python 3
branch the main thing that they did is
unicode is a pain in the ass if you've
done any like web programming headed to
go with character sets in brief we've
been pretending that strings are made up
of ASCII characters and each character
takes up one bite and there's a single
non dubious representation of each bite
and that's just simply not true in the
real world in the real world textual
data is binary data whose interpretation
depends on how it's been encoded sad but
true and that fact is a real pain to
work around in Python 2 so almost any
almost any substantial program that
might undergo internationalization or be
exposed to multiple character sets like
every web application ever written has
got some libraries to deal with Unicode
issues and it still bite you every now
and then so Python 3 fixed all that and
Unicode data is the basic string type
and that breaks every single other
library that depends on Python 2 big
discontinuity so nobody obviously nobody
use Python 3 despite the fact that the
engine is more performant than Python 2
and there's been parallel development
and they've released python 2.6 in
python 2.7 we're getting close to the
end of life of Python 2 and there's been
enough progress in fixing third-party
libraries to run on Python 3 but like
for instance
it was a major effort to get Django to
run on Python 3 and I still don't know
of anybody who's doing it in production
so we've had two versions of Python
living side by side for a while and the
official word was it's fine to stick
with Python 2 for production and Python
3.0 is kind of a experiment to show you
where the language is going to be and
hopefully in five years everybody's
going to decide to migrate and we're
still in the are we gonna migrate sort
of phase right now and I don't know
anybody who's running Python 3 code on
production machines and that's not true
I don't know very many people that are
running Python 3 code on production
machines if you are writing for your own
machine and your library needs are
adequately met Python 3 is fine and as a
user of the language semantically not a
ton will have changed unless what you're
doing is heavily processing text textual
strings and Unicode aside from that most
of the concept of the same and there's
very limited and like send tactical
changes to the language there are a few
and there is a Python 223 tool that's
written in python that will convert your
Python to syntax to Python 3
automatically for you I catching the few
places where there been changes in
keywords and/or syntax and it's usually
things like they changed how exception
exceptions are caught because you can
catch multiple classes of exceptions and
you can catch the exception instance and
in Python 2 that's kind of an ambiguous
list of comma-separated things and a
python 3 they made that much more
clearly a tuple and a instance so they
cleaned up some bits and pieces of
language but it's not really a
substantial change from a cent tactical
point of view it's mostly a substantial
change from a runtime and string
handling point of view but we continue
to teach Python to when Python when you
yourself have to use Python 3 there
won't be a big learning curve and it's
mainly a matter of people getting their
software to run on Python 3 the state of
general web handling stuff in the Python
standard light standard lib is kind of
messy
partly because despite being considered
the new and hotness Python is a
relatively old language that's been
around since CGI was the way to do web
applications so exceedingly lame names
but there is URL lib in a standard
library which has a bunch of things
having to do with reading URLs parsing
URLs parsing data you might get from
URLs and the slightly newer slightly
improved URL lib to which confusingly is
not a complete re-implementation of URL
lid but supply some additional missing
pieces and about half the time I can't
remember if what i want is in one or the
other and i can pound my confusion by
importing star from both of them we'll
just use a little bit of the basic
functionality of URL lib right now and
we're going to use a different data
format jason is a commonly used format
on the web jason stands for JavaScript
object notation and it'll look really
familiar to you because it looks a lot
like pythons dicked notation with a few
additional rules JSON stands for
JavaScript object notation and valid
Jason can be interpreted as valid
JavaScript code which is one of the
reasons has become a really popular data
interchange format if you're writing
JavaScript you can just grab some JSON
and it's already parched for you it's
kind of nice it's also kind of dangerous
when you're talking JavaScript I put up
some Jason I left my file name dot txt
and it's being sent with a text mime
type so it's not really really Jason and
I wouldn't be able to use it from
JavaScript but those are details that
don't need to concern you if you're not
a web monkey like me but this is what
JSON data looks like i have opening
square brackets which would indicate a
list an opening brace
which would indicate a dictionary and I
have name colon value pairs
comma-separated pretty much Python
dicked send tax right no problem
understanding like what the Python
representation of this would be almost
identical there are a few rules for JSON
like like if I put a trailing comma here
that would break JSON for one major
browser at least URL lib has a lot of
stuff in it but what I'm kind of
interested in is this paragraph and this
is worth noting because it's basically
Python philosophy Python OOP engages in
duck typing and you'll hear that phrase
turn around and duck typing means if it
squawks like a duck and it walks like a
duck it is a duck and what we're trying
to convey by the humor statement is
Python doesn't concern itself a great
deal with exactly what type of object
you have it's more interested in the
behavior of the object and some type
systems are concerned with making sure
that you have exactly the type that you
think you have and perform complicated
tasks by coercing types Python is more
forgiving and it's not as concerned with
exact types it's more concerned with the
ability to do things so URL opener dot
open will give you back a bunch of
different objects but all of them have a
read a red line red lines file number
close and info method which means you
can pretend that their file objects it
walks like a duck quacks like a duck it
must be a duck or at least we can use it
as if it was a duck none of them are
actually
file objects for the most part and we'll
see that real quick now i'm going to use
URL open and i'm just going to pass it
the URL i put my browser up there
FP is a ad in a din fo URL whose file
pointer is actually a socket object so
this is reading from a network but to
get the data out of it I could do read
line I'm not really interested in in
lines I just want the whole thing so I'm
just going to say F P dot read and F P
dot close and data is new lines included
the JSON that was up there at San
Franklin com so I just used a socket
object made an HTTP connection to a
particular port but all the details of
that are hidden from me and basically I
got to pretend like i was reading from a
local file which is nice and now i have
a string that is Jason like this is a
string I can't yet say give me the first
row that just gives you the first
character so to parse this string I can
use the built-in Jason module and Jason
only defines a few functions you can
change how the decoder works and do a
lot of customization but mostly you
don't have to do that and mostly you're
going to do load which takes a file or
load s which takes a string and dump
which takes a file and dump us which
takes a string wrong direction I'm
loading some JSON data and what I'll get
back is native Python types so I'm going
to reassign my data and now data is a
list of length to data 0 is a dict
it has keys and values you'll notice the
presence of the leading you which
indicates that these are Unicode strings
but you pretty much shouldn't worry
about that right now and if I were
importing address book data it would be
pretty obvious how to do it from here I
can loop over the roads that I've got
and read the labels that I've got if you
would like to add to your address book
the ability to read a remote URL and
import the JSON data that you find there
you know enough to do it now the URL is
here and URL lib dot URL open it gives
you a file like object it's worth noting
one of the other built-in file like
objects is a string io class and that is
in is it in the file module it might be
in the file module it is in the string
i/o module sorry the string i/o module
defines a string variable that's
actually tied to a buffer and it has
readwrite read lines right lines
basically emulates the file object and
what that means is if you write
functions that except files file
pointers as arguments you can test them
by converting a string to a string i/o
and passing it the known data that you
have without having to have data files
separately laying around so that's kind
of that's kind of useful it's also
sometimes used to get around the string
concatenation issues so if what you're
composing is a really really large
string like say you're manipulating
documents you might use string I oh and
right to it and as opposed to the native
Python string class during i/o works by
pre allocating a really big buffer and
then jumping up in big chunks when it
needs to so appending to it doesn't
doesn't cause any memory changes until
you hit the buffer size and then it
doesn't call their memory changes for a
long time after that again so it's more
performant
so the fact that there's a you before
the string is pythons representation
telling you that this is a Unicode
string but for the purposes of this
class Unicode strings and ascii strings
are all exactly the same thing if you
printed it'll print your justing the you
because it's by default doing the
wrapper the programmers representation
and you might want to know whether it
was a Unicode string or an ASCII
stringer whatnot so really briefly
strings that we're used to our in ASCII
which is an encoding system of 255
numbers that correspond to letters and
it reads text by saying this is the
number 31 therefore it has to be a I
forget what the ASCII numbers are
nowadays it turns out 255 characters is
not enough to represent every character
in the world's languages so there's a
whole variety of originally the idea was
we come with a whole variety of
different encodings you might have seen
like in your browser you can select from
encodings like kanji and eventually we
sort of standardized and said well what
if we made strings instead of one byte
we made them to bite and then what if we
said that you had to define the name of
the encoding that the following string
data was in and then strings would be
portable and that whole effort is called
Unicode and as a particular encoding
called utf-8 and it turns out that a
couple of bites isn't enough that's
actually utf-16 a couple of bites isn't
enough says utf-32 and it still turns
out that that's not enough so there's
tons of Unicode and coatings and
basically what that means is when you
have a Unicode string you don't know
what an individual bite represents as a
character unless you know how it was
encoded because different encoding
specify different numbers mapping to
different characters from the program
perspective we're going to pretend that
we always have a ski strings Python is
capable of saying here is an encoding
the name of an encoding as long as the
encoding is installed on your system
here's a string to read using the
encoding and giving you back the proper
characters
it's also capable of just having binary
style strings whereby you don't make any
assumptions about the type and I've done
some programming that way and you'll see
if you ever see programs that have / x
and then some hexadecimal number that's
directly embedding unicode characters
and frequently o passes around as binary
strings to keep those from being
interpreted in any way shape or form but
it's a big gnarly mess in almost every
most most of the cases you're not going
to have to worry about it especially
with since we're doing like command-line
programming against ASCII text get to
the web and it's a different story
exactly
just parse JSON and or creates JSON so
if I have a list that contains a list
and a string notice what I get back is a
string there's quotes on the end and
inside that string is the JSON
representation which is pretty close to
the Python representation although
double quotes are mandatory instead of
single quotes and i will say javascript
is a language seems to be rapidly
converging towards python so not in your
browser so much but newer versions
because your browser limits the version
of JavaScript you can run but newer
versions of Java Script have stolen from
Python things like list comprehensions
for example and the object literal
syntax here is stolen from Python as
well so give you that URL there just in
case you want it because I'm putting the
survey URL back up so one more module to
discuss and this might actually help you
especially early on in your explorations
of Python one thought that occurred to
me I think I should introduce unit test
early on in the class and hand wave over
the object-oriented part of it because
unit tests would actually be kind of
useful for some of the assignments and
if you're lost in your classmates
program it's kind of hard to debug it
sometimes like okay to get to the part
that I want to mess with I have to run
it load all the data from csv add
another name then filter by role and you
know it like takes a bunch of keystrokes
to get right it is exactly that you're
going kind of confusing sometimes
there's a stolid development called
test-driven development and the basic
idea is I already know what I want to do
and I'm going to write a test that says
when I call this function I should get
back when I call this function with us
data I should get back this result and
I'll define the function but it won't do
anything and I'll run my tests and my
tests fail
I now I'll fix the function until it
meets my tests as long as it meets my
test then that function is going to be
usable by the rest of my program and it
means to debug your filter by roll
function for instance instead of like
loading data and stepping through your
program interactively till you get to
the spot where you can test your filter
by roll function you could write a test
for your filter by roll function and
your test might have enough output that
on successive iterations you don't have
to step into it with PDB you can just
see oh right i forgot to strip the strip
the trailing newline oh right I've got
two pools instead of lists and work
through until all your function passes
we've talked about doc tests as far as
testing goes and doc tests are kind of
more like once you've got things working
you add some tests that guarantee that
things stay working while they change
and also the tests are kind of useful as
documentation and it should probably be
kind of minimal there's another testing
library that is much more frequently
used for extensive testing it's the unit
test library unit test is a straight
port of j unit so if you've ever written
j unit tests unit tests should look
totally familiar and basically the way
unit test testing works is probably a
separate file probably a separate file
called test or something like that i'm
going to write classes the classes
inherit from unit test test case
the classes may define a method called
set up that does whatever initialization
I need to do that's common to all of the
tests that i want to run for this class
and then i will write functions whose
name starts with the word test and then
they're named whatever you want to name
them and each function should test some
sort of discrete piece of functionality
and at the bottom I'm doing the if name
equals main thing and unit tests stop
main unit tests that mean is the unit
tests applied main function and it loads
all the classes in the module if they
inherit from unit test it parses all of
their functions it runs the set up at a
fifth exists and one at a time runs the
test methods if they exist and reports
about at all so let's run our tests
you
i defined one test and actually just
look really quickly i did set up I
imported my classmates 9 file as c9 my
classmates dot 9 file is reading from a
CSV so it starts out with a data
structure called classmates that's blank
there it is it's a module level constant
so I'm putting some data in it as part
of my setup and then my test is calling
the save to file function that's in my
classmates 9 file it's got a textual
string it's reading the CSV file and
it's using a special method and I said
self that fail and less equal and I
don't define fail unless equal unit test
test case which I'm inheriting from
defines a ton of fail methods which do
checks for you so fail less equal
obviously checks to see that the two
things that you pass it are equal and if
they're not as a test failure and if
they are it's a test success and there's
various does the more flexible fail if
and various other fail functions
and when i run this it says fail test
writing csv is the name of the test that
failed it gives me the trace back and I
said fail us equal text NF text and
assertion error John Smith student
Simeon Franklin instructor is not equal
to Simeon Franklin instructor John Smith
student why not well too yeah two things
one my CSV writing is putting a blank
new line at the end of every line so I
need that and then yeah the other issue
is the orders reversed
and the order is reversed because I am
writing a dictionary and dictionaries
have no order and I could right now
switch the order of my lines and it
might pass this time which it did ran
one test in 0 seconds ok I put one dot
because it ran one test but this is a
really fragile test because dictionaries
don't have order and I'm relying on some
sort of implicit order that might vary
in the future depending on what machine
this was run on so one really nice thing
that tests do for you is give you
different entry points into your
functions different ways of testing your
function and isolation from the rest of
your program which is usually easier
than testing it in conjunction with
running the rest of your program the
really nice thing tests do for you is
make you think about how you wrote your
program in the first place and changing
your program to be more testable usually
means changing your program to be more
readable as well or more sane for
instance the c9 saved a file thing
I have hard-coded the file that I'm
writing to so when I run my test I
overwrite the data file from my program
it's really dumb to have a hard-coded
file although I'm expecting that hard
coded file
so I'll make a change to my program
okay the change i made was i gave my
function an optional argument called f9
that has a default value of data csv
because it has a default value that f
name does not have to be passed and my
program which previously expected this
save to file not to accept any
parameters can still call it without any
parameters and everything will work as
before but my test can now supply its
own file name to write to and I won't be
clobbering my main file name and I would
probably use the OS temp names directory
to get a guaranteed unique temporary
name or post em names module and then
the reason my test is failing is because
dictionaries don't have an order and the
reason my test is a bad one is because
dictionaries don't have an order and my
right to a CSV rights in whatever order
the dictionary happens to give it to me
which I can't count on to be reliable
from time to time and since the
fragility of this test is bugging me
this tells me that probably would be a
good idea to go back to my classmates
program and the save to file instead of
doing four key and classmates I should
probably do four key in classmates that
Keys sorted which guarantees that i'll
write it in the same consistent order
every time and i don't really care what
that order is but I'm not that concerned
about the order of the CSV file but at
least it will be in exactly the same
order every time so my test helps me
debug my program it guarantees that my
program continues to work because I can
rerun my test after I've made some
change and if my tests still pass i'm
probably good and it also forces me to
write my program in a manner that can be
tested for example how could I test the
get record function and get record
function probably doesn't need to be
tested it's pretty much just for input
the query record function I'd like to be
able to query to
the query record function because I'm
going to change the implementation from
looking at a dict to searching through
rose and I'd write a test beforehand and
make sure the test worked and then I
change the implementation and I'd run
the test again and the test should still
work but I can't really test the quay
record function because it has raw input
in it so it would probably be a good
idea to pass an F name to query record
and get the input separately
which meant that I pulled one line out
and made it a new function this text
this line of code probably doesn't need
to be tested it's probably going to work
I'm not going to change it but this
query record function I'm going to
totally change how this thing works and
I'd like to be able to write a test for
it and now I could because I pass it a
name and it's going to look up the name
let's write a test without really
quickly might change one other thing
about it if F name in classmates I print
record else sorry not found yeah that
kind of sucks I've got print statements
in it that's kind of hard to test as
well again not impossible but kind of
hard let's just returned classmates
fname
functions default value is returned so
I'm going to solicit the first name call
my function that I'm going to be testing
and get a row back if I got a row I'm
going to print a row with print record
else I'm going to print sorry not found
so I moved all the input and output to
squee record input but the actual logic
of query record which again I'm going to
change big time is now shorter and
testable and i'm going to say see 9 dot
query record and it's based on the first
name so I have John in my sample data
and
a nice simple usage at the beginning but
I'm kind of looking for and not the not
the description looking for the methods
there we are there's a certain methods
and I love some of these assert not
almost equals there we go assert true
let's see if this does what I think it
does
yeah I'm an idiot two functions with the
same name so of course it's only running
one okay now I did a test query record
which worked and test riding the CSV oh
hey when I changed it to be in the right
order it failed and if you remember i
change this would be in order of the
first names so my previously failing
test my previously passing test failed
again because i didn't run my tests
after i met a change but there we go to
test ran they both passed so I must have
gotten a record back when I queried and
now that means i can go ahead and change
the implementation of my query record
function change my data structure to be
just a list search through my list
return a row or a row of rows and my
test query record will make sure that
least I'm getting something back well it
just makes it easier to test functions
in isolation I think then against your
whole program I'm not a big test driven
fanatic and that i rarely as the first
step of writing my program write a bunch
of tests where some people do but i do
find it helpful and sometimes when i'm
confused or conflicted about exactly
what it is that i'm trying to do writing
the test forced me to say okay what is
it that I'm really trying to do in the
end here what's my final result going to
be what's the format going to be and
making those decisions in my test then
clarifies my work of writing the rest of
my code so unit test is useful both as a
way to test your code interactively
write it and also as I'm a way to stop
and think about it in a different way
rather than bang your head repeatedly
against the same wall forever he you're
frustrated with the progress and writing
code stop and write some tests really
simple tests that fail and make sure
that they pass and they can be really
simple tests will make sure they pass
and you're just thinking about the
problem domain in a different way and
that's that's frequently useful least I
find it I find it frequently useful
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>