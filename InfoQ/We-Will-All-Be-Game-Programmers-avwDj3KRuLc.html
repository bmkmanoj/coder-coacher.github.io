<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>We Will All Be Game Programmers | Coder Coacher - Coaching Coders</title><meta content="We Will All Be Game Programmers - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>We Will All Be Game Programmers</b></h2><h5 class="post__date">2015-03-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/avwDj3KRuLc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">oh we've got more people coming in come
on in and sit down guys yeah so my name
is hunter Loftus and I'm responsible for
the node.js platform at Heroku and so if
you use that platform and you like it
I've got my twitter handle up there if
you want to talk about building games on
Heroku that's awesome if you have
problems with it your build isn't
working or something's failing you get
an NPM error my email address is also up
there so you know send all your angry
emails today so when I'm not maintaining
the build pack and doing support tickets
for Heroku I've run a little website
called playful j/s it's it's kind of a
place where I get to explore playful
JavaScript I really enjoy playful coding
building graphical systems terrain
generation particle effects stuff like
that things that you frequently seen in
video games but you also see in other
places and you might have seen this on
Hacker News some time towards the end of
s last year one of the things that I
built was a recreation of the doom
rendering engine in JavaScript it was
pretty short it was pretty fast and
maybe most importantly it worked on just
about every device you could run out on
a really old iPad and old Android and
this is the sort of thing that I like to
play with so nothing in here is gonna be
like modern game development stuff this
is mostly throwback to things that
people figured out in the 80s but that
we're just now kind of bringing into
JavaScript because we're a little bit
behind so after I built that I got
contacted by this this company called
warp records and they said would you be
interested in a project for one of our
artists they wanted to they wanted to
build an html5 based video game that's
very much like that first person shooter
engine for an upcoming album release and
I was like well this is an intriguing
idea this is really cool I used to build
flash games but nobody has ever until
now offered to pay me to build a
javascript based game so I you know I I
decided to talk with these guys they
were they were based in the UK and one
of the issues with this proposal was
that they had just discovered
this first-person shooter and they were
about to do a a major international
launch three weeks later of this album
and they were like so can you have it
done in three weeks I was like I mean
maybe you know like and I'm kind of
rationalizing to myself I've already
built that fps engine so it's like 80%
finished rate the second issue was
budget since they hadn't really found me
until the very tail end of their
marketing effort they only had a little
bit left to throw into like an online
budget so I was like okay so it's it's
also gonna be really cheap well you know
what I love doing this stuff I do it for
free on playful yes so why not get paid
even a little bit to do it right and the
third issue was the technical
constraints it had to work everywhere
and that's that's what initially
attracted them to the project right they
they were actually using an old iPad and
they saw that this thing would run on it
and that was really important to them
because a marketing effort they wanted
people to be able to just click on a
link and go play this game and their
idea for the game was really cool they
wanted you to explore a world and in
that world be able to discover different
songs that were on this album and then
if you beat the game you get a link to
SoundCloud and you can actually play
these songs on your own like SoundCloud
and kind of get a preview of the album I
thought that was a cool idea I thought
it'd be fun to work on so unfortunately
though they were those three issues so I
had to say sure let's do it right like
let's just go let's let's
you know I rationalized and I talked
myself into it and I decided to just
just jump ahead and and I felt kind of
good about this because I was like you
know what this album for an electronic
artist named rusty who had never heard
of I was like it's it's an indie label I
was like so so it's it's me and you know
an experienced web developer I'm helping
out the little guy I'm getting indie
music out into the hands of the people
like this will be a cool project and I I
imagine like three weeks you know what
does that mean he's gonna tweet to some
friends maybe put up a link on
SoundCloud like if if I need to I'm sure
he'll push back this you know
international release if the game you
know
if the game requires it and so I
accepted the project and then my
girlfriend who's way more into music
than I am found out that I accepted this
project and she sent me a bunch of links
and it turns out that especially in the
UK and especially in Europe this guy is
a major deal in like indie electronica
and like international release was a
real thing and and that's when I
discovered that it wasn't me helping out
like this no-name artist like I was the
no-name artist I mean he was giving me
an opportunity to you know demonstrate
some some abilities so so he that added
a little pressure so then for the next
three weeks I basically didn't sleep and
I built a custom rendering engine for
this game because of course the first
thing that I wrote wouldn't work for for
the vision and so it renders about 4
million raise a second it's all done in
canvas I you can probably tell from the
screenshot I spent a lot of time
watching minecraft development videos
because minecraft was written in Java
and it was originally a software
renderer and so it had a lot of the same
constraints that you have when you're
working in canvas so this actually
turned out to look and feel a lot like
minecraft but anyway I wanted to show it
to you just so that you can see what I
what I ended up with I won't play
through the whole game but I just wanted
to show a little bit so this is green
language let me see if this will work ok
yeah and you might be able to hear for
some reason my sound is disabled but you
can still hear it so that's cool so like
you start out and you can hear some
music and it's it's like very
exploratory and so you wander around a
pretty large procedurally generated
world and you like find things like you
see there like a little golden sort of
stone and when you touch these things
that's when you collect new songs right
and over the course of the game you
collect more songs some of them you find
that way and others you find by
performing certain actions right like
they
of spring a very low resolution spring
and like it brings you up into this
whole other world where there's like sky
temples and things and it starts playing
different music that's telling you that
you're gonna go down right when you
start springing around and anyway so I
actually really liked the music that's
the only reason I think a project like
better
so anyway I'm really bad at my own game
there's like all these little hidden
things and like little challenges I'm
not gonna solve the maze because I can't
but there's a maze and this is my
favorite fiction this is this is where
I'm going to stop this particular demo
but you see how the land changes as you
go over the maze but once you retrace
your steps enough on this like dark area
it realizes that you're lost I mean it
plays his song called lost so I was very
happy so so anyway that's what I ended
up with right and I was really happy
with it until one month later when Apple
released WebGL on iPhones and I could
have just written it all in WebGL and
not invented my own rendering engine for
this project if it was just one month
later but well I learned I learned a lot
of trigonometry so and I also got
features in Kotaku which is not
something I ever expected to do and so
now if you were to describe me as a
professional video game developer you
would be technically correct
which is the best kind of correct so but
you might be asking yourself I'm not a
video game developer so why do I care
about this what does it matter to me and
actually it should matter a lot because
because application interfaces are
starting to look a lot like games you
know if you've been following along with
the oculus rift which Facebook now owns
or the leap motion device or with
Microsoft's new thing which I hope
really comes to fruition because this
thing looks awesome this like hololens
like move around a 3d world like design
a motorcycle and three that's just it's
amazing right and other developers non
JavaScript developers are gonna be
working on this stuff
unless we figure out how to write
because right now most JavaScript
developers would not be able to even if
even if the api's were exposed to
JavaScript they just wouldn't be able to
work with this kind of data it's kind of
like 3d immersive simulation that's just
not where we're strong right now and so
we need to get better at that and it's
not just for future applications it's
also for applications being built right
now if you've taken a look at Google's
material UI some of the foundational
principles are that this material should
behave in sort of a physical way
animation should mean something they
should be simulations rather than just
pre-scripted animations right and so
like if you're trying to build a modern
Android app right now you should be
using material UI and that's actually
pretty hard with JavaScript right
because we are limited well we appear to
be limited to what we can do with CSS
and with with pre pre done animations we
don't do a lot of simulating in
JavaScript so so that's why it should be
important to both game developers
aspiring game developers and people who
couldn't care less about ever building a
video game and there's one more reason
and that's something that you'll
discover if you ever just try to spend a
weekend building a game pick an old game
pong asteroids pac-man whatever and try
to build it in a weekend and you'll
you'll discover that it's the hardest
code you have ever written in your
entire life building a simple game is
harder than building most complicated
web applications and so there's a lot
that we can learn from games we can we
can really level up with
with videogames okay so that's a note
and I do have 15 minutes left so I'm
good to go
right so today even though there's a lot
that we can learn from game developers
as Jas devs we're only gonna look at
sort of three things I wanted to focus
on three things and we're gonna focus
specifically on user interfaces so three
takeaways that we can we can steal from
the game dev community about how we can
build better UIs in JavaScript so the
first is that state is the root of all
evil right
and traditionally JavaScript developers
have been very bad about just throwing
state everywhere it's so easy for us we
can attach state to anything everything
is an object and everything is something
that we can just attach properties to
those properties don't need to be typed
I mean it's just so damn easy to add
state to our applications that it's a
very prevalent practice but game
developers they don't have that luxury
and you can kind of see kind of see with
this example all right there so this is
this is how we test JavaScript
frameworks right like this is this
standard JavaScript framework tests
compare this to a modern video game
right how much state is happening here
you have like a rocket you're flying
through the air you have guys shooting
at each other multiple things are on
fire and and more importantly this game
is updating every 16 milliseconds right
so we have debates about which MVC
framework will update your list of a
thousand items in under a second right
like this is updating every 16
milliseconds so so there's obviously a
lot that we can learn from game
developers and one of one of the first
things is that they have developed a
couple techniques to tackle environments
that have lots and lots of state that
interacts with each other really really
frequently so I wanted to show you a
little demo of what I can look like this
is a little piece of a game that I was I
was messing with with a friend right we
were I would write a piece send it to
him he would write a piece in the back
it's actually kind of a fun thing to do
and like it's a little mobile game and
right now we've got like this dude and
he like runs around and there are trees
right there's not a hole but other than
this it's not actually a game yet it's
just a guy that runs through but when we
initially built this we started talking
like like normal JavaScript developers
we're like what's all this stuff that we
need to keep track of well what
direction is he facing right is he
facing right is he facing up arrived up
and then what what frame is he and
there's 72 different frames with
animation here for each different
direction and different so we've got to
remember like which direction he's
facing which frame of running that he's
on and then we wanted to make it so that
like when he went slowly he like walked
slower and then when he went quickly the
animation so now you got to figure out
like how fast is he moving and and how
does that impact the current frame that
he's on and then when he changed his
direction quickly we wanted us to kick
up so there's all this different state
that's that's happening here with this
player and so our initial like state
object for this was just enormous and
then we're like wait no hold on we're
gonna we're gonna boil this down and we
ended up being able to write it in just
this this is all the state actually in
that entire little you know running
simulation there's yeah and you notice
there's nothing here about frames or
directions or anything like that
and the reason is we use something
called a pure function some of you may
have heard this if you've ever taken
like a you know functional programming
Lisp class in college and hated it like
I did you've heard of a pure function
but they're actually super super
powerful and and they're really simple
too the idea behind a pure function is
it has no side effects it changes
nothing it takes something some
predefined type of input and then it
produces some type of output in this
case you can send it the X Y the X and y
coordinates of the guy which are stored
as an array of the last three x and y
coordinates and then you can send it the
time interval which is also an array of
the last time intervals and then it will
figure out how fast he's moving once you
know how fast he's moving you're not you
know have like a vector for for his
velocity you can put that into Direction
and you can compute
you know where he is facing and then you
can you can basically figure out how far
he is moved by adding all those
velocities up and you can figure out
which animation pose he needs to be in
and a nice side effect of that is it'll
automatically make him run faster when
he's moving faster it will animate
faster when he's covered greater
distance and more slowly when he's
covered less distance and so it's it's a
really elegant solution and the nice
thing about this block of code here is
that there is no chance it is
introducing bugs like outside of itself
because it has no side effects it
changes nothing there are no there are
no variable set at all inside any of
these particular functions all right so
that's a pure function so one of the
things we can learn from game developers
is wherever possible minimize States
explicitly point out where state lives
and then use pure functions to try to to
delete as much state as you can right
figure it out on your own and also I'm
going to yeah all right I'm going to
move to this screen so that my computer
doesn't die while its animating all that
because I'm not charge very high all
right so the second thing that we can
learn from game developers is to enforce
deterministic rendering and all that
means is that if you have a blob of
state you should be able to send that to
your renderer with no other data and
your renderer should be able to make
everything right for instance your
render function should look like that
which is a little bit shorter than most
of my traditional render functions have
looked and it's it's important for a lot
of reasons and one of them is that it
makes it makes sure that you are
encapsulating all of your state data in
that state object if you have to send
more stuff to your render function then
there's actually state that's living in
places that you aren't sure about right
that you're not tracking and that makes
it hard to do things like undo and redo
it makes it very hard to do to save
things right like if you're if you're
trying to make a hell if you're trying
to make keynote and I want to save a
whole bunch of undo swell if I can just
save them as blobs of state and then
just go back through those blobs of
state and then move forward through
those blobs of state I know how free
undo and redo
right stuff like that I mention how hard
that would be if every time you change
something it's actually directly
manipulating properties on some sort of
an object right on some sort of an
instance of an object it's just it makes
things very hard and for multiplayer or
multi-user applications you can't
actually send JavaScript instances over
the wire right you can't say you know
var player equals new player and then
send new player over a WebSocket that's
not something you can do you have to
have adjacent object right so if you're
not representing all of your state as
something that could be put into Jason
you're setting yourself up for much more
difficult integrations later on I wanted
to demonstrate this I'm not sure if this
is gonna work let me put this caveat in
here I wrote this in a couple of hours
over a weekend and it may or may not
work I don't know I've never tested it
with more than two people right so we'll
just try it with you anybody who wants
to open up this URL right and I wanted
to highlight that like this is all the
code that it took for me to turn a
single-player game into a multiplayer
well we'll see if it works
let's let's see if it works before I
start dragging about it all right so I'm
gonna refresh this and is everybody on
Wi-Fi I guess that's the other question
yeah no not everybody like well
whoever's on Wi-Fi join here oh we're
all blue there's one red guy that poor
red guy all right so I didn't I didn't
see the game logic was perfect right
like yeah we're all blue all right well
that's fine so let's just let's just say
I intended to make this game one where
you actually hunt the red person the
single poor red person who's running
from everybody else right anyway so
what's kind of neat about this is I just
hacked together a little thing where you
spin and you shoot and whatever and it's
got a state and then I wrote this tiny
tiny little like three function 50 line
thing and because the rendering function
only takes this one state object to work
it actually all sort of worked on the
first try right I mean sort of work but
we are all living in the same
environment we can't kill each other
because we're on the same team but that
poor red guy cannot like he's he's just
screwed
so yeah so anyway that's you know just
one of the benefits of keeping States
independent let me move back here so
it's what's kind of neat about this it's
like this is this is the network code
for that game right this this is 100% of
the network code for that game because
it's using as many pure functions as
possible and just storing state as these
very simple little objects so another
more polished example of that type of
thinking is react they do some really
interesting stuff and one that coolest
things react does is render to string
you basically you give it a state object
and you give it a you give it an element
a component a react component that you
want to render with this data object and
it will give you like the whole HTML
markup everything that you need to
render that as a string which is really
cool because it lets you use react to do
pre rendering on the server with almost
no extra work so you can like render
something on the server send that over
and then send the exact same code over
to the client and it'll like
automatically convert it into a single
page app that was pre rendered on the
server for like a really fast
first load experience which is amazing
right so react under the covers is
actually written very much like a game
engine actually and it's it's kind of
cool to kind of cool to look at it's
been compared to doom as well in its
rendering pipeline so the third third
thing I wanted to talk about that video
game developers do that that we should
start doing is separating rendering and
simulation because this is definitely
not normal in JavaScript so let's let's
talk about why you would want to
separate rendering and simulation and
let's also make sure that we understand
that simulation is what leads to
animation right it's what leads to good
animation I'm not even really going to
talk about animation here traditional
you know move from this spot to this
spot animation we can do that fine with
CSS but modern interfaces require
simulation when you when you want
somebody to have scrolling on your
device and you want it to have some
momentum and you wanted to have some
bounce when you want your draggable
icons to have a little bit of weight and
mass friction behind them you have to
run a simulation there's no way to do
that
with a with a stock animation so so we
don't really write a lot of simulations
in JavaScript so let's talk about how
you can get 60 frame a second
simulations in JavaScript because it's
it's not requestanimationframe one thing
to point out is that at the cinema you
get 24 frames a second do not think that
means that 24 frames a second is okay
right they chose that back when films
what film was very expensive as a
material and this is the lowest like
threshold that you can watch without
just getting sick right so 24 frames per
second is not is not a goal to shoot for
18 frames a second is about as low as
you can even make out like motion rather
than independent frames and when fighter
pilots can see up to 220 frames a second
right they can see a jet that's in their
vision for only 5 milliseconds so we
have a very high threshold for animation
so we should be aiming very high so you
know if you're delivering less than 60
frames a second and any of your online
experiences then then you should
re-evaluate it because because we can do
better this is a hand-drawn browser
timeline bear with me this was this is
how you might initially think you would
make the smoothest animation possible
but most people here probably know that
this will just this is terrible this
will cause your computer to sound like
it's about to take off it'll eat up
everybody's battery it'll get really hot
and none of the other tabs will be able
to continue functioning right so this is
not a good way to make smooth animations
so the next thing people tried and this
is basically how jQuery works is you
delay by about 17 milliseconds which is
approximately 60 frames a second the
problem is set interval does not
guarantee one that you're going to be
updating anything when the display is
actually being redrawn and - it doesn't
guarantee that you're actually going to
be redrawing anything after 17
milliseconds it's a minimum of 17
milliseconds so you're not going to be
doing anything in 15 milliseconds but it
could take 100 milliseconds you don't
know so there's no guarantees with set
animation frames so now everybody thinks
that requestanimationframe is like the
holy grail of animation and we finally
solved this in JavaScript but we haven't
we definitely haven't because
requestanimationframe guarantees
that you are drawing at the right time
with regard to rendering but it makes no
guarantees that you will be rendering at
60 frames a second if that users
antivirus starts like you will drop
frames if they create a new tab you will
drop frames if you do anything that
cpu-intensive you'll also drop frames so
you can definitely drop frames while you
are using requestanimationframe and now
I'm going to show you why that's bad
because feel like a few drop frames who
cares right this is why that's bad so
this is a little test of a physics
engine that I wrote called Newton it's a
terrible physics engine never use it but
I wanted to point something out with it
so I'm gonna go refresh it a few times
right and you'll notice that every time
i refresh it
it does something similar to the time
before but not the same it never behaves
the exact same way twice right sometimes
two things bounce off and then the third
bounces off sometimes well that was
pretty similar sometimes one stays on
the platform right like different things
happen every time if you run your
software multiple times and it does
something different every time you're
doing something wrong right so even
though it sort of looks like it's kind
of working this is definitely not what
you want because imagine how impossible
this would be to test you can write
automated tests for this so instead
instead what you do is you decouple your
rendering from your simulation and you
always you you do draw on
requestanimationframe you render on
requestanimationframe but you notice
that I've dropped a frame that means
that I do two simulation passes before
the next frame so you basically track
how many frames you've dropped and
whenever you drop a frame you run your
animation loop or your simulation loop
twice and I will show you what that
leads to
that leads alright so this is a 10 frame
a second simulation right all right so
it's gonna go really slow imagine like a
really slow mobile device running this
right but you notice that every time it
ends up in the exact same state it's
really really slow but it does the same
thing every time now let's say we're
running it on a new fast computer it
does the exact same thing just at a
higher frame rate this will do the exact
same thing over and over and it really
did because I'm so nervous every time I
do this it's never not work but there's
gonna be some time when it doesn't do
the same thing and but so far it's
worked perfectly so so that's why they
need to be decoupled and you can
decouple them using several techniques
but my favorite is something called a
time accumulator some people call it a
time buffer I'm not gonna go into this
too much this is something that you know
that I'd be happy to talk about
afterwards but it's sort of a topic unto
itself it's actually a pretty simple
concept but it just sounds complicated
when you give it in a presentation like
this so feel free to look up time
accumulator all it really does is you
just store and into and yeah an integer
and every time time passes you add that
new time to the integer and whenever
it's greater than a certain amount you
delete that certain that's your sounds
complicated doesn't it but it's really
not complicated time accumulator I'll
talk to you about it after the
presentation and now since I'm getting
towards the end of the talk let's see
yeah I've got one minute left I'm gonna
show you my favorite bug ever this is a
bug that I created and it was so amazing
when I first saw it that I actually
created like a git tag so I could always
find this bug again
the coolest bug you'll ever see it's way
better than the physics engine that it's
in so alright so here we go and again
every time this works the same I hope I
hope it works a little as well today
like hasn't failed me yet alright here
we go so oh I should provide background
I was sitting in a cafe trying to get my
stupid physics engine to render boxes
and that's it just render boxes it's
harder than it sounds so I checked this
out so I thought I finally succeeded and
then and this is this is the sort of bug
that if you told me to do it I couldn't
even watch what happens next this will
blow your mind every single time all
right there bounces and then and then
it's a box and for the rest of this
programs life it will stay a box I have
watched it for hours so I wanted to
leave you with this bug because one I'll
get software developers leave somebody
with a bug but too because it
illustrates like I couldn't bring this
bug to you if I couldn't reproduce this
really quirky behavior every time over
and over so this bug is brought to you
today by the principles that we just
discussed so so I think I'm at a time
here a couple links that might be useful
I strongly encourage you if you're going
to build any of these apps or these
games to try it on Heroku because we do
all sorts of really awesome stuff and
it's free so you might as well if you
want to chat with me after I will be
hanging around I'll be watching the
talks and if you want to get in touch on
twitter my handle is right there and
thank you so much for coming everybody
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>