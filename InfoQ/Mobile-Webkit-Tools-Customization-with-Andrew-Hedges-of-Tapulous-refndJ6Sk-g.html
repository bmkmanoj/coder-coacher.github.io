<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Mobile Webkit Tools &amp; Customization with Andrew Hedges of Tapulous | Coder Coacher - Coaching Coders</title><meta content="Mobile Webkit Tools &amp; Customization with Andrew Hedges of Tapulous - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Mobile Webkit Tools &amp; Customization with Andrew Hedges of Tapulous</b></h2><h5 class="post__date">2011-08-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/refndJ6Sk-g" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I'm a the lead web frontend games
engineer at apolis which I didn't feel
like was going to fit on the slide very
well so my team does we do web views
inside of inside of games we do iphone
games mostly we have one game on android
but our Genesis was at an iphone game
company I've been in the time that I've
been there which is just since November
so about eight nine months now we've had
a string of games that went to number
one in the app store so we had tap tap
revenge 4 we did a tap tap revenge game
for Lady Gaga and we just did one for
Glee all these have gone to number one
we had one game we got out of the music
well he had a game that wasn't part of
the music gaming genre more of a tycoon
game called club world we even got to
work on a game for the Cars 2 movie with
Pixar which is pretty fun so so topless
is a pretty exciting place to work the
thing that all these games have that
neatly there's these are all native
games all the gameplay is native iOS
code and all kind of stuff but what they
all have in common is that they have
social components so they have you might
have a profile or an online store or
chat and those kind of those kind of
features and that stuff's all done is
web views so what that does is it gives
us some flexibility we don't have to we
want to make a change to the look of
that or something we can make changes on
the server serve that stuff out doesn't
have to go through the whole app store
approval process so what I'm here to
talk to you about is optimizing this web
stuff for mobile our use case is a
little bit different than what you might
be dealing with because we're we have a
kind of a host environment it's more
like it be analogous to using phonegap
or something right like we have a native
iOS kind of shell that your web stuff
lives within and the provides certain ap
is but a lot of the stuff is applicable
to just general mobile web development
a lot of it works on Android as well as
as iOS and other WebKit mobile WebKit
browsers and some of the principles work
across any kind of mobile settings so
all right some of the basic principles
are going to be similar to what you may
do on the open web as well so not they
aren't just necessarily mobile specific
but so one of the things we try to do is
reduce the number of requests on on
mobile as opposed to sort of the desktop
web latency is a much bigger issue than
it is you know another settings so
whereas you know you may have latency of
50 milliseconds or something on a
regular web page if you're on mobile
that can be 500 milliseconds and all of
a sudden if you have if you have 10
requests for different CSS files and
JavaScript files and images and all
these things that's going to start to
add up and it's going to really slow
down the experience for users right so
the basic thing is just a kicking
concatenate and sometimes even in line
that CSS and JavaScript just reducing
the number of requests using image
sprites so it's probably something you
guys view if you have instead of having
a bunch of small images you can just put
those in one image and then use
background positioning to to show the
piece of that image that you want to
show right pretty pretty basic stuff
right another thing that we do though is
in our CSS files instead of instead of
always linking to images sometimes we
base64 those and and actually include
those in line with the CSS so um
basically it's called a data URL so you
can actually just do data colon what the
mime type is basics for and then this
long string and you can actually just
treat that just as you would a URL to an
image or something like that so again
it's this you don't always want to do
that because your image maybe you know
300k or something right in which case
maybe you want to have another strategy
of loading at the background or
something but for smaller images this
works great reduces a number request
it's actually a win do you have a bigger
CSS file that has these images just in
line all right of course you want to
send fewer bytes as well right so
obviously gzip everything pretty simple
pretty common uglify minify whatever you
want to call it your CSS and JavaScript
these are pretty standard techniques
properly compressing images so you you
know there you may be tempted to do
everything as PNG's because that's kind
of you know it seems more I don't know
less patenting comfort I don't know what
exactly but but a lot of times these
these things are better done as a JPEG
right if it's a gradient or something so
whatever just you try to like it I don't
know we fight with our designers to get
these things compressed down to the
we're just to their tolerance level for
pixelation and these kind of things but
these things make a big difference to
users right sending fewer bytes using
cookie louis hosts for static assets
there's no sense in sending cookies back
and forth if you're sending an image
right so most CD ends take care of this
for you so something that we haven't
done yet but we're thinking about
experimenting with is actually leaving
out unnecessary tag so Paul Irish who's
a Google person he did I saw a
presentation he did where he talked
about all just how all these tags you
don't actually even need to put in the
browser just checks for as the prep is
this a closing Ally tag is it there if
it's not it just adds it so you can get
away with actually sending fewer bytes
by just leaving out tags that aren't
necessary if you go to if you hit
Google's 404 page you'll see an example
of this where they leave out half the
tags you would expect to be there and so
it's not who probably would be a huge
wayne is why we haven't really gotten
around to it yet but it's another place
where you could save a few bites
probably of the most important things
you can do is to cache really
aggressively so there's a few different
strategies for this html5 manifest
caching is it's sort of I guess you
would call the native way to do this it
is sort of fraught with peril I mean it
works but it's it's sort of finicky like
if you have one syntax error in your
manifest the whole thing doesn't work
it's kind of it's kind of tricky to get
these things reload there's this a few
issues you have to kind of work with it
kind of get to know how it's meant to
work but if you get it to work it's it's
a great win it uh the basic concept is
that you can set up a manifest it says
cash these assets don't catch these
assets when you come to a page it has a
manifest it'll go into the background
and download all these things
to the device so that they're available
the next time you want to you want to
access them without going over network
so huge win if you get it working
correctly local storage is another thing
that we do and actually glan who is
going to be presenting after me who also
works in me to tap euless is going to go
into it's going to show some code about
how to use local storage for caching
requests if you're not familiar with
local storage I guess you guys ever
really know what local storage is it's
html5 JavaScript API so basically local
storage is just a property on the window
object okay so you can test for its
presence by just seeing if it's defined
we can set a value as simply as just
saying local storage sub K equals value
and now all of a sudden that value will
be in local storage so foo equals bar
right it's probably the simplest
possible API the way that you get it out
is just to say you want local storage
sub whatever your key is and the way you
delete is just to just delete that that
property off the off the object so it's
very very simple to work with there's a
sort of built-in five megabyte limit in
most environments after which the user
is going to be prompted for if they want
to allow for more storage so we try to
avoid that like we don't try not to get
anywhere close to that limit because we
don't want we want to give the illusion
that we're that the users dealing with
the native screen so we don't want them
to be prompted for some Webbie kind of
alert and that kind of thing so we stay
away from the limits but it's really
helpful for just cashing Ajax requests
or for caching JavaScript templates and
some of these kind of things so pretty
helpful and it this local storage
persists across session so there's also
a session storage which you could access
for the duration in that session but
it's going to be gone the next time you
come in so local storage is kind of the
most useful of these you can only store
strings that's an
a little thing to keep in mind but
another thing that we do at tap euless
because we have this host environment
that we work in our client engineers in
the case of tap tap revenge for anyways
they gave us a way to store assets
locally within the app bundle on the
phone so we have this kind of a little
bit clunky system for telling the client
when to when to get new assets and
things but it is kind of a huge win for
us in that game where we can the server
can actually tell the client to go get
the new version of you know the the
javascript file or something and then it
stores it locally and then it never has
to go over the network again until you
know until that that resource has been
updated so if you have that kind of
environment to work with this can be a
huge win if we I mean caching it's one
of those kind of tricky things to solve
so you need to come up with like really
think through your solution but it is
possible to do something else that we
haven't actually implemented yet but
we're talking about doing is is allowing
our our web page our web views to access
resources that are at like binary
resources that are inside the app
bundles so I don't know if you guys know
like in iOS apps you can use a scheme to
like to basically tell commands to the
to the host environment so like in tap
tap revenge for if we say TTR for CMD
colon slash slash something the app is
going to intercept that and it's going
to see if it understands what that
command is and if it does it's going to
do something so we can that's our way of
talking to the host the iOS host
environment so what I'm talking to our
client engineers now about is if we can
have a way to say you know TTR for
command colon slash slash binary assets
/ and then the name of a file or
something and have them send that back
to me just as if I'd gotten it over the
network so you know there's already all
these kind of these binary assets in the
app that they use for different views
that they they're doing and the look is
going to be consistent in our web views
anyway so we might as well just use
those from the local local law
local app so like I said we have an into
actually implemented this so if there
any gotchas we're going to run into them
down the road but seemed like a good
idea s'okay leveraging see at css3 so we
do we spend most of our time and
javascript and CSS do a lot of css3
stuff like all that when I showed like
those images flipping over and all those
kind of things that's all css3
transforms transitions animations so you
know in the old days you know you would
have used maybe a jquery animate
function or you might have written some
kind of custom JavaScript animation and
all these tweening algorithm bella stuff
that stuff's all taken care of for you
now in the browser natively in WebKit so
you know we can specify I want this
object to move from here to here over
the course of you know two seconds and i
want it to rotate while it's going or
something and do that all in CSS really
simple it's all hardware accelerated so
huge win you know generally a few couple
of lines of CSS is going to be a lot
less code than a big javascript
animation function right so another
thing you can do is to use some of the
native the built-in css3 stuff in place
of images places where you would norwich
is so gradients is kind of the most
obvious example can actually show you
they're starting to be the syntax for
gradients is a little bit kind of weird
but they're starting to be nice
generators for not that this is a nice
gradient but we're kind of working with
gradients and actually generating that
code for you i'm making a cross browser
and that kind of thing too well so it
works on mozilla worked on very recent
browsers right not all browsers but if
you have the luxury of working in this
kind of environment another technique
that we use a little bit is this 9 you
can actually do nine slice borders so
you know no 29 slices if you have an
image and you need to have a box that it
kind of expands in all directions but it
has a certain border around the outside
mount is called a nice slice so because
the box is cut up into nine pieces so
there is actually a there's actually a
CSS that does this so
this is a nice kind of gooey to playing
around with some of those properties but
it allows you to take an image and place
different parts of it on the nine slice
and do different things to it stretch it
or you know have a repeat or whatever so
another kind of handy technique all
right this is a javascript meetup so
using javascript conservatively so what
I mean by that is you know on mobile you
are you have a lot a lot more
constraints than you do on the desktop
so CPUs aren't as as beefy you know just
basically you're working with a less
capable device so one of the things that
you know I would recommend is to use
touch events that are there there that's
sort of what how these devices are
designed to be used so if you were if
you've ever done an iphone kind of
mobile web app and use a click event
you'd notice there's a 300 millisecond
delay right we've use a touch event
there's no delay like you can use touch
start and it's going to happen right
away you can use touch and w we usually
use because we want to also detect
swipes and that kind of thing but
anyways touch events are kind of where
it's at went on the mobile mobile side
that's what how you interact with it so
use it right this is I don't know if
this is going to be controversial at all
but closures use memory and there's not
as much memory in on this environment so
some people recommend that you reduce
the use of closures because you don't
have as much memory to work with and
things so it's usually probably not
going to be a problem but if you find
yourself for unknown reasons kind of you
know if the device is running out of
memory is something you might try this
kind of technique but also only
executing the code you need so we've
actually gone through this recently
we've been refactoring a lot of our code
base so that things don't just kind of
initialize themselves like we include
all this all this javascript in this big
cash thing but then it was kind of all
executing and so now we're we're trying
to be really strict about these things
might get interpreted but they're only
initializing themselves when they're
needed and if they're needed so you can
catch the whole file but only run the
stuff that you actually are using just
again to kind of cut down on memory use
in CPU
don't reinvent the wheel so we leverage
open source stuff all the time so we use
depto we use a modified version of
jqtouch modified to work with septo so
it hasn't been released its we call as
eq touch just to be cute but anyways
it's a took a few little tweaks to get
that get that working those libraries
working you know if not familiar with
zep toes up to is a mobile web kit
specific sort of clone of jquery so it
uses a similar api to jquery chaining
and some of the same api calls but it's
only 5k or something like that so it's a
big win in terms of signing fewer bytes
jqtouch is a framework for you know
doing page transitions and monitoring
like pass change and that kind of thing
so in some of our past apps we've used
up to jqtouch we've also used the i
scroll library so the scrolling that we
were doing and the and the things i
showed you that's i scroll we started
look at underscore Jas and backbone jss
ways to kind of organize our
applications so anyways if you you know
these things work for you if they fit
your use cases I would say leverage
these there's you know thousands of
person hours so I put into these these
projects so why not when I take
advantage of it otherwise you're gonna
be finding all the same bugs at these
these guys did and trying to fix it
yourself so told them straight so the
debugging web stuff in this kind of
mobile app environment can be can be
challenging so there are a couple of
things we use a couple of tools we use
to make this easier one of which is
Charles proxy you guys familiar with
this hit a basically web proxy runs on
your on your local machine and you can
run all your web traffic through it so
you can actually if the device hits a
certain URL you can redirect we redirect
our traffic to development servers and
you can watch the traffic go back and
forth so you can see what's what request
headers were sent you can see what the
response was you can inspect all this
stuff as long as it's not encrypted but
if you have the certificates you can do
that too so it's invaluable for just
seeing exactly like what's what the
device receive wasn't what I expected
you know or was
error in the on the server or whatevers
you can kind of inspect all that stuff
really helpful another tool this is
pronounced winery this tool allows you
to attach a remote debugging session to
the device so just like you would have
sort of the web inspector of the console
there you can have most of that
functionality actually running on the
device so it's just a javascript file
that you include at the top of your of
your web view or your page and then you
can't have a program on the desktop that
gives you basically the same thing as a
web inspector console so you can see
what the Dom structure is you can do a
little interactive stuff with JavaScript
really really handy unfortunately I
think still it only runs on iOS but
Peter Mueller I think it's the guy who
who wrote this and there are tickets
open to get it running on Android as
well so he's working on it contra what
the holdup was exactly on that but so
that's kind of all I have other
questions so the question was whether
I'm doing these patterns these CSS
background patterns is best done in CSS
or like as an SVG image or you gave Andy
like canvas or something like that right
I'm not actually i'm not i'm not sure i
mean i don't know as anybody would
anybody here know like what the
implications might for the camera to z
was saying that not all browsers support
SVG as as background images so that's
kind of a limitation yeah takes a lot of
memories so a big radial gradient could
actually use all the memory and crash
the browser so it's good seem like
you've done some of that thanks
everybody</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>