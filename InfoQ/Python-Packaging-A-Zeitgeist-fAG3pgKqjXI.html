<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Python Packaging: A Zeitgeist | Coder Coacher - Coaching Coders</title><meta content="Python Packaging: A Zeitgeist - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Python Packaging: A Zeitgeist</b></h2><h5 class="post__date">2014-07-15</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/fAG3pgKqjXI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so I'm back again for talk number two
this time Python packaging a zeitgeist
this is an overview of the last roughly
18 to 24 months of development in the
Python packaging world just what's
happened and what's going to happen so
first a disclaimer this list is not in
chronological order it is not in order
of importance that is not in any
specific order except that which worked
best for slides but before we get to the
the meat of this let's just look at some
fun statistics because I think they're
cool so in the month of April pypy i
pushed 71 terabytes of data across 877
million requests those are really big
numbers and this makes me excited not
actually relevant to rest of the talk
but big numbers are cool so
so let's move on to some org chart
changes in the path of packaging world
so the biggest one is the creation of a
group called the Python packaging
Authority or pie PA this is the group
that is now responsible for all
packaging stuff managed outside of the
Python standard library this includes
pip virtual end vinsetta tools they now
have a central organization they can all
find each other relatively easily and it
means that more than one person has
maintained ership on all of those
projects we also have the the newbie DFL
for packaging so Guiteau has stepped
back from dealing with packaging because
as Thomas mentioned he doesn't really
care about packaging particularly much
nothing against keto it's just not
something that he really works with much
so he is desiccating Nick Coughlin as
the media fell delegate for packaging
that means that he can directly accept
all peps related to packaging without
discussion having to happen on the main
Python dev lists if anyone here is on
python dev you'll understand why this is
a wonderful wonderful thing and if
you're not stay that way
additionally rich jones has very
fortunately come back and taken a bit
more of a center stage role the
development of pipe i acting as the BD
FL of pi p I itself even though that
lose a little bit outside of the formal
C Python development framework so there
aren't always peps about it but when
there are he can accept them alright so
most of you probably use the Python
package index at least at some point
either to host your own packages or more
generally to find libraries to install
or to install them so we've made some
changes to this most importantly in my
mind is security so we've deployed TLS
across all of pi PI this is includes
HTTPS we now set the HTTP strict
Transport Security headers so you'll
always use HTTPS and we now support
perfect forward secrecy on reasonable
subset of browsers slightly older than
some of the other stuff i'll mention but
mostly unknown pi PI now offers a JSON
API if you take any package or version
URL in PI P I and just put / JSON at the
end it will give you all of the data on
that page and a very nice machine
parsable JSON format so if your screen
scraping chi VI please stop lots of
people are it's kind of annoying
fortunately another thing that we have
added in the last 18 months or so is
fastly fastly as I mentioned my last
talk is caching CDN and like I said they
are a very generous sponsor of Python
software foundation so of those 80 877
million requests that i mentioned in
that previous slide only about twenty
percent of those actually had our
servers the rest are handled by fast
lees distributed network of caching
servers this means that we have much
faster performance basically everywhere
that isn't the US and even within the
u.s. we have a lot more stability we
also have a integrated static fallback
system so if there's ever any problems
with the main pipe Qi servers through
fastly we can fail over to a static
mirror in another data center that's
updated every five minutes so even if
the main server is completely self
destruct you'll never notice at least
four pi PI or pip install purposes this
is very very nice to have the flip side
of the CDN deployment is we mostly
deprecated the mirroring system so all
of these public mirrors are now dead the
old A through G system
have been completely removed and are no
longer usable and the mirror
authenticity framework has been
deprecated so for the most part the
public mirroring system is not
particularly stopped but no longer
really officially supported and pip will
no longer attempts to use any public
viewers but private mirrors they were
fortunately been some nice changes so
pep 481 client was long the workhorse of
building a pai pai mirror that's been
largely retired in favor of a new tool
called Bandersnatch so if you do want to
run an internal pikey i'm your if you do
a lot of python package installs from
within your network or if you just want
to have extra safety in case we go down
even though as mentioned fortunately
that basically doesn't happen anymore
Bandersnatch is a great tool to use and
it's very easy to spin up a new Python
package mirror also def p I it's not
strictly built for mirroring but it can
act as a read-through mirror so if you
don't want a mirror every package on on
the index you can stead set up dev pie
and have it set to cash only the stuff
that you download through it so that's
very nice if you just want the subset of
packages you actually need at install
time we're also hard at work rebuilding
the software the power is pi PI the new
tool is called warehouse it's an old
there it's an outgrowth of the old crate
io website which is submit or tired and
you can use it now it is available at
warehouse python org it will become ipi
2 point 0 although not to worry they'll
be plenty of announcement before i flip
it over but if you have any scripts or
other things that interact with PI API I
would definitely encourage you to try
them with warehouse we are aiming for
almost one hundred percent API
compatibility except for a few old
things that we're pretty sure no one
uses but proved me wrong certainly let
us know if there's any API that you're
using we would certainly like to know
about all API compatibilities right now
it is mostly read-only so you still to
do all your uploads through the old
system but you can test out anything
that's using the read api's or the
installation api's you can even just
point pip at warehouse although there's
not really much reason to it should
currently support all anything related
to installation search and all the JSON
and XML RPC api's so what good is
serving packages if you can't install
them so another major area of security
enhancement has been in hip itself so
pip
now that PI P I offers good TLS support
pip actually does TLS verifications this
means that you can't be man in the
middle we also have mostly deprecated
external links and dependency links
depending sexually been removed external
links are still available although I
will touch on those a little bit more at
the very end but right now it requires a
flag to activate external links is when
you are hosting your files on an
external server just linking to them
from PI P I we've really been pushing
people to actually upload all of their
installation materials to PI P I
itself's they can be covered by our nice
happy fastly caching system we also now
have a pep 453 which is including hip
with the Python standard library this
means that finally after a Python being
around for 30 years you can actually
install packages out of the box with
Python 3.4 yes like this is this is very
very big we're still sorting out with
all the distros of how exactly as we
handled so it's not going to work
exactly the same everywhere but the
expectation is if you install Python 3.4
you should have a working pip we also as
mentioned by Matthew have wheels so I
won't go into quite as much detail as I
did the last time I gave this talk since
we had that lovely lightning talk but I
will mention there's still some issues
with wheels he did briefly touch on the
fact we don't allow binary uploads to
pipe I do to avi compatibility issues so
if you want to do binary builds on Linux
you still have to do some of you some of
the work yourself there's a tool called
wheelhouse which makes a little bit
easier but overall it still got to be
massaged a little bit one of the great
advantages of wheels that he didn't
touch on is you no longer need set up
tools to install if you are just using
pip and you are installing wheel files
you don't need set of tools at all on
the system it is no longer a runtime
dependency unless you specifically state
that it is this is very very nice means
that we can really hopefully one day
relegate set of tools to be a build time
requirement and not run time requirement
of almost everything and finally on the
Installer side is Conda again this was
fortunately already covered for the most
part I will mend
for people that are it now it changed
tryout Conda it does unfortunately have
some lingering security issues most of
them in fixed in the last two weeks or
so but as you might guess by the words
security fixes in the last two weeks
it's still it still got some issues it
is mostly aimed at the scientific and
numeric computing worlds so if you don't
operate heavily within those worlds I
would still mostly recommend that you
use pip on a daily basis so what's you
have packages you generally want to use
them so V n is the outgrowth of virtual
end it works almost the same way albeit
with a different name now instead of
virtual end it spivey end and it comes
with Python itself as of 33 so again
once you install Python you have a
working packaging system mostly this is
again quite nice most people didn't
really know much about distribute except
for frustrating error messages and
confusion but fortunately it's now
completely gone I'd like to thank pje
helps to transition setuptools back to
community management under the PI PA so
the old distribute fork has been merged
back together a set of tools and now
it's all just being done under set up
tools and similarly just utils to was
briefly merged into standard library
during the 33 dev psychol and was then
removed and is now dead so there is no
dis details to there will not be a
district tales to there is no parrot and
all this wouldn't really matter without
people making and releasing packages so
a few changes there so the metadata spec
has been updated a little bit it allows
you to specify a lot of things that were
added by setuptools as part of now
standardized metadata so that other
tools can interface with it it's
creatively named metadata 2.0 and is
being discussed currently under Pep 24
to pep 426 sorry all of this will now be
in a single JSON file in a single well
recognized place so it's a lot easier to
build tools that integrate with the
packaging ecosystem uploaders are also
very important so most people upload
their packages to pi PI by using Python
set up high something upload but this
has a lot of problems mostly it can only
upload packages that were built in that
command line invocation it means you
can't do something like build a package
and test a package and then upload the
tested package this is fairly
run-of-the-mill foremost packaging
systems on a fortune
distutils never quite got there
fortunately there is now another tool
available called twine you can use that
to take an existing s disk or wheel file
and upload it into PI P I and on the
uploads front I'm probably doing myself
a disservice by even mentioning it
because most people never knew it
existed but pi p is SH has been turned
off it was an old way to upload things
over ssh that was used by i think at
most four hundred people ever so we have
removed it there will be on another
system added in the future if you don't
want to deal with uploading the password
protected system we're hoping to offer
TLS client certificates for
authentication at some point in the
future in warehouse but until then twine
is your best bet and finally there's the
python packaging user guide formerly
known as The Hitchhiker's Guide to
packaging it's the one stop shop for all
of the information you want about the
packaging world it's basically an
expanded version of this talk and I'd
highly recommend check and I'll out at
packaging python.org and finally if you
coming soon so what's on the horizon so
I mentioned metadata to point o briefly
as the new emerging standard for how to
store metadata in Python packages we've
also got esta stat wheel to point o on
the horizon both of those package
formats have seen a little bit of wear
and tear as mentioned wheels don't
really work so great on linux assists
the format hasn't really changed in
years so just try to get those all
updated make sure they're compliant with
metadata two point oh I thought they're
easy to install up to manage if you're
interested in any of those check out the
relevant peps again warehouse I
mentioned before we are working to
transition so that it will take over for
pie pi/4 the old code base hopefully
sometime in the next few months and hot
off the presses this morning is pet 470
so I mentioned briefly before about
external links scraping being deprecated
the goal of pet 470 is to remove it
entirely so this will mean that pip will
just not consider scraping external
links most people are not even aware the
PIP does this they assume that when you
install something it's coming from the
package server but it is in fact not
always pip does currently support
scraping external links and following to
external servers just because you happen
to link to them from your pie pie
description so we're trying to get rid
of that that will hope
Lee improve speed stability and security
and how would you like to help us out
with this so the best place is to
contribute on the code side some stuff
is hosted under get so pip virtual
engine warehouse sorry are all under the
pie PA organization on github while
setuptools pypy I and wheel are up IPA
organization on bitbucket no real reason
for that just things were set up in in
mercurial versus get as the original
authors so desired if you'd like to
contribute to any of those i highly
recommend you check out their source
code repos and submit patches there's
also the PI P a channel on freenode if
you have any questions about packaging
in general or any of the projects that
the pikey a-team manages that's the best
place to go for help and just util sig
is a mailing list you can go sign up for
it at list of python org it's the place
where all of the discussion all of this
happens so if you're just interested in
looking or if you'd like to jump in and
and provide some opinions or feedback on
any of the peps i've mentioned that's
the right place to check out thank you
and now questions round two did you say
a little bit about how these different
making packaging tools that discover
correct sets of dependencies that
package together which make a package
and tools do me like I'm getting my own
home so wheel is not wheel is just a
different output format it's basically
the same ideas as dist just a different
organization of files it doesn't package
dependencies together so a single wheel
is a single package that's it dependency
management is all still handled via
normal ways in pit Conda does it by it
puts together whatever you tell it to in
the build scripts if you're talking
about like building like groups of
packages it's more so that's more stuff
like the old virtual and bundling stuff
which is mostly deprecated at this point
due to portability issues so let's do an
open problem on that's not really
something we want to solve that would be
back towards my original top my first
talk of tools like omnibus that is a
mega package building framework it works
wonderfully and I use it every day it
works like freebsd ports or homebrew
does where you build descriptions of
software and you state that the
interdependencies and then it builds
everything into a folder and / opt and
slams it through fpm and gives you a
single package output super easy and
makes really really portable gigantic
packages with no external dependencies
highly recommended and then frees me the
download accounts on my value seem to be
all over the place like because then you
know why that is the case is there a few
things with white house well so no it
can't really be fixed so those download
counts are really the raw download
counts that are coming off the fast
least streaming information and it just
means that somebody is downloading your
package a whole lot likely a mirror
unfortunately most of the mirrors don't
self-identify so we can't easily filter
them out of those there was actually a
problem a few weeks ago where somebody
strums somebody's trying to spin up an
internal mirror at a tech company and
accidentally was hitting us with
one hundred thousand requests a second
needless to say that it plates download
counts a little bit so yeah fortunately
the download counts on pi PI are now all
time limited so after a month it won't
matter even if spikes like that do
happen so that's really the best we can
do certainly we do filter out
Bandersnatch and as more and more people
switch to that instead of homespun
mirroring frameworks it will improve the
quality their questions I actually
wanted to ask about omnibus give me
recommendation for resources to do not a
whole lot so my best recommendation is
check out omnibus balanced if you just
search on github you'll find all of our
omnibus configs are open source and you
can just copy us we're just building
pretty boring flask web apps so
this was a whole microphone again um did
you say something about how you run so
the myths so I could say what the my
opinion is and I know Nick and I
disagree about this but it's my talk so
call dang it I get to say my opinion
personally I would like to see it just
be opaque string-based and only deal
with stable AV eyes like Linux distros
so we can allow things like kubuntu 1204
as an avi tag it means that if you are
using your own builds of stuff that's
not our problem anymore and you don't
get any kind of a TI stability and you
can't use public wheels sorry nick has
some other very interesting and I think
overly complex ideas about how to try to
describe ati's for existing systems but
personally I would just mean that that's
those are my big concerns is basically
butu and centos for whatever like five
versions of each I need to care about
anybody else alright thank you everybody
for coming if you have any other
questions
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>