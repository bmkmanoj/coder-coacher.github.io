<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>API Design at Eventbrite | Coder Coacher - Coaching Coders</title><meta content="API Design at Eventbrite - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>API Design at Eventbrite</b></h2><h5 class="post__date">2014-05-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/2D_ppkE5OHw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so I am here to talk initially about API
designer of M bright so the quick sort
of hole possible hope you hear of
written API is in the past simple ones
collects ones so okay that's at least
half the room whoever you ever used API
is in the past that's yeah even more
people so coming into Eventbrite one of
the very first things I was given was
this problem the idea that a member has
an API that actually has two api's in
the best kind of development effort API
v1 is at least sixty I went back and
gear I got six years back into gear and
it says import from subversion so that's
at least six years old and a PI v2 which
was of course called the next-generation
API very bad name to give anything it's
likely called InDesign file it's never
one I think all that it was started
never finished and sort of is now
heavily tied into our mobile absent and
powers them very well but it's got a lot
of design decisions that tie it heavily
at mobile isn't really good for general
consumption and so the overall issue
here was to try and get an API that
wasn't sort of a stuck in the past as
API b1 was I wasn't tied down and serve
in this sort of small corner of API v2
was so some the problems they pay v1
which is our current public API either
we we have previously it was outdated
the code was all pre Django because we
moved to Django three or four years ago
there was no provision for new features
there was a lot of sort of interface and
design ideas around the URLs and the
methods that were just locked down - how
about worked five or six years ago
things like way payment methods work the
very repeating events worked all that
kind of stuff there's also some bad
patterns in there it was on the same
domain to the main site which is easily
fixable but you know all dear bad sign
it had methods accessed just as so in
the demo it's eventbrite.com
slash xml question mock method you know
this is not perfect and also it has the
wonderful thing of both the xml and json
return form as it gives
you actually transforms of each other
which is a great idea in theory until it
turns out in practice that one of them
isn't isn't really correct there's
there's both misformed xml and also
poorly written json in that output of
that to api so that's always a fun one
to deal with so the tile skaters no take
all this stuff and take what Eventbrite
is now like you know we're adding new
features at a rapid pace we've got all
these wonderful new things reserved
seating the stuff has come out as well
and try and work that into an API for
the modern era and one that isn't gonna
sort of make developers and run the
screaming when they see it so the first
key thing for us is that we have SOA
internally if those aren't familiar the
acronym is service-oriented architecture
it sounds very enterprise it's not what
we're doing is splitting apart the
codebase from this one giant monolithic
blob into much smaller services that are
much more manageable by small teams for
example we're pulling out events into
their own event service the idea of the
order flow and ticketing it design
service or reserve seating as its own
service that kind of thing and trying to
organize it so you've got small code
bases that can be released independently
tested independently but the nice thing
here is that that mapping of bringing
out services and ideas and you expose
them as sort of methods as endpoints and
that matches the idea of an API very
closely and so one of the ideas here was
to try and minimize our duplication and
make it so that our SOA work just split
the stuff out internally which is still
ongoing and our API work was sort of
closely what intertwined and wasn't
wasn't too dissimilar so in a way what
we do here this doesn't fit well on the
screen but we have sort of these
services internally they talk between
each other that's all perfectly fine and
let me have sort of internal SOA clients
like our website be talking to it or
something like that
and what we wanted to do is to have that
same kind interface mapped to API
clients and so the idea is an API client
just talks through this sort of
translating layer that his API v3 it
just things like whiteness thing like
security and a few other things but in
its essence it's just pushing through
this API calls into some part of our
underlying infrastructure and that means
that as we maintain upgrading these
internal services that also affects our
API as a minimal sort of extra work to
keep it updated obviously the API is
happy frozen so that mapping layer will
grouse over time some freezing some
remapping to try and keep that external
interfacing system
saves us a lot of time already just
developing the new stuff coming up
that's all I do freezing api's but a
future-proof
a very big part of my job here's been
thinking okay this is fine now in one
year in two years
what are we doing what's the plan
roadmap Walker go in here and one of the
big parts is designing all your
responses and designing the way you
query things to have easily to easily
good breakpoints things you can add new
things in where you can change fields
where you can sort of easily add things
in a nice backwards-compatible way
without necessarily breaking stuff
there's not always the case
you obviously have breaks up eventually
but it's a big part of designing of
api's trying to make sure that it's not
going to even mmediately break six
months down the line and you have to
change the doppler tation and our
developers who are using it count of
screaming and anger and maintainability
is important too
I'm personally believe that one of the
most difficult things at writing code
especially in a big company like this is
make it easier to extend your code and
to thread away start again now
admittedly I did this with the old API
code I am guilty of this partially but I
think a big part of API code and the new
stuff we're doing is making so that if
you are developing one of our many teams
we have like they're all product focused
say I'm you know working on the
organiser' acquisition team they
responsible getting new events and my
kind of stuff
I won't build if them to go in easily
finding the right piece of the code add
stuff to and have it be you know ten
twenty minutes out of the day if it's a
massive task add a new API endpoint
they're just not getting added over time
will lose them they'll come out of sync
so we need to make sure that there's a
very easy low barrier of entry to this
kind of stuff so with the latter in mind
what did we do the key thing is we
started off with Django rest framework
Django restaurant was an excellent piece
of software written by one my friends
tom christie and
essentially also there's also a piece
called django piston for example django
piston is a sort of model oriented race
framework it's much more traditional
django in a sense it's based around
views around middleware around pluggable
components like authenticators and sort
of rate limiting stuff and it's a very
good base to build from we don't even
use fresh framework sort of in its
native state
we've heavily modified parts of it but
the beauty of it is that you can easily
take away different parts or vindication
entire different our serialize errs
aren't even there anymore but the rest
of it works perfectly in isolation and
that's all so we're good about it behind
the rest framework we have that sort of
custom coupling to our SOA library set
so as I you know as I said the API is
kind of this mapping onto our
service-oriented architecture and so
what's in the middle there is sort of a
nice simplified way of saying ok this
URL maps onto this endpoint
well this URL calls these two endpoints
combined the result and so when someone
comes along and like you know they write
a new feature in main eventbrite for the
main website the writing's to services
for those and they can come along and go
easily go okay here's my sucess away
endpoints here's a URL for it and map it
straight through and that's meant to be
use sort of as low cost and as
frictionless as possible piecemeal with
factors now the sort of interesting part
of all is is the API is one of the first
parts of this service-oriented future
and so many parts of it have to sort of
take existing code and tease it out and
sort of this sort of slightly service or
did way enough so we can call it in an
individual fashion and so part of this
has been taking parts of Empire which is
actually imagines a very complex code
base full of wonderful like
seven-year-old dead ends and really
special cases and trying to work how how
to contain those and put them into a
module with themselves and the key there
is to its small and test heavily as
Nathan said and make sure you're getting
back to cover and like it's been a slow
progress but we've almost got the point
we've got all of the old API code a new
version fully tested fully extracted and
it's wonderful and finally the key thing
from a business point of view is that we
have it all API
it's still public now now we can't
deprecated it until it's fully replaced
by a new one and so in terms of aiming
for an initial release we need to aim
for a full replacement of that old API
so we can deprecated it stop that sort
of six-month nine month one year
decoration cycle give all of our clients
and time to upgrade and notify them
properly and then we can finally drop it
at some point in the future obviously if
an endpoint stops getting hits like
every one we can do it early but it's a
much more difficult and involved process
and we have some big customers in to
take care of so that can be tricky so
with a lot of mine one of the design
principles behind this
so this is sort of my personal bugbear
it's only JSON now this is kind of a
tricky one some of our clients love XML
but when you actually ask them that's
more because they're used to using it
and the beauty of having just JSON is
that you've only got one return format
to take care of you can design that and
make sure it's properly consistent
across all platforms and it works well
if we do need XML in the future I'm sure
we could ship a translator module if you
you know just chipped in there but every
modern language has access to JSON old
languages there's a JSON module for
track I mean everything uses it now it's
a variant it's a very simple on the wire
format we only bug Bertha no date-time
format and JSON that's really annoys me
but we've defined a few things like like
when we tone currencies and data have
well-defined formats as they like okay
currencies come back as a dict of
currency code value and so on it's rest
ich now I am NOT a rest purist
some of you may be you may hate me to
the next slide we don't have put we
deliberately don't have put because I
don't really like put but anyway the
government addresses should use perch
updates should use Post for updates and
things about URL rotator stuff at the
end of the day you can kind of map post
and put the same tasks on any given URL
anyway I'm sure will support put as a
sort of synonym post as well but it's
you know so designing a sensible nesting
infrastructure of year old as my key
thing here like the idea that you know
slash events is a list of public events
and when you post a make a new event
then early on the end as event details
you have at the event then slash orders
gets you the orders for that event and
they can have order on that and it's
there's a lot sort of hierarchy there of
how those flow and how you can sort of
always not have it down the tree of the
way this works and also you know some
things like you can publish and council
and unpublish events which are basically
verbs on the event and perhaps anon deal
will there be HTTP verbs like published
but given proxies stripping out with a
lot of proxy strip out verbs they don't
know HTTP I've had a massive issue in
the past with using custom verbs so we
just went with custom URLs here with
posts on the end instead and then you
know similarly you also have some
a nice thing here where if you put with
a username if you were me in my URL that
just aliases to your current user ID so
you can hack around and go it's flat -
does that mean like you can play around
the API very easily it's meant to be
sort of heavily explorable easy to just
play around with get your data out of it
very quickly another very important
thing is sort of part of the future
proofing this is every response as a
dick to an object depending how you come
from nowhere do return just JSON of list
objects end list the idea here is that
there's room for pagination most
importantly and there's also room for
future expansion if you turn more than
one list all that kind of stuff
similarly every object we return we
never return an empty like errors are
always addictive error or something
there's always room to have more keys in
there and nearly all code that reads
JSON return Hormats won't error there's
extra keys extra keys are usually fine
and so our approach to this is extra
keys are fine we can leave space on in
the future just don't drop stuff and
make sure we have that place to add
finally a pub that sort of
standardization that I love having
pagination everywhere I've been bugging
so now this in particular everywhere we
return a list is paginate it just as a
pure sort of it might seem small now
like you know we only have ten languages
now you only have so many categories now
but if you get a hundred or a thousand
in future we can't change if it's not
paginating and so having that sort of
consistency there and the future
planning means that as you scale which
even an event by size we still have room
to grow and a lot of it there's no
surprises in the future so this will
rolls into this one for idea of an API
this sort of intelligent and also in
respectable all the code is written in a
way where we have code that can go and
has methods can read what they're doing
what they're calling the fields you can
pass them the format's of things you can
pass them and that sort of turns into
this automatic API Explorer so sort of
if you hit any of our API endpoints in a
web browser we do content negotiation so
oh wait you can see HTML and this pops
up and so as well as returning you this
response here which is the actual
response from the API you have the
status codes pulled out for you all the
headers pulled out for you we have what
you've resolved your authentication to
be and resolve throughs likely you
passed this token we thought that this
app ID we thought that this user so like
all that
bucking is sold for you and also on the
fossil over there you have these forms
we can just say okay we have get takes
no parameters
that's excellent we have post takes one
thing that name is required and all this
stuff is automatically pulled in and
also going to have our API documentation
which is powered by Sphinx pulling this
too and sort of automatically create our
documentation just you know save us a
lot of time in working out all these
endpoints and this feeds back and that
idea of maintainability and low barriers
for our new developers writing new
features we want ability to have an
endpoint page with all the fields the
documentation as easy as possible and
that all feeds into this there's one
more example of these forms so this is
our pagination pulls out here we're
headed here so imagination have all the
size over here so like this is a much
more complex thing this is making a new
contact on one of our contact lists you
can see it sort of like it's it's a much
more competitive so the old pages give
you this and since that's highlighted as
well and this links through URLs and
stuff and this is all named Django rest
framework ships with the basic version
of this i took their template i
customized it a bit it's customized
quite a lot actually but the same idea
is there and so I am heavy believer in
the idea of API is that our explorable
that is accessible that you can sort of
just go to them and play around with
them either via one of these explorers
that are on page or via seven explorer
so like twitter having a separate
explorer you just pick one down the list
it works
those are both fine but I'm I really
like that and the key thing is there's
always more to do an API is never
finished an API is only 15 your product
is finish and that's probably never and
so you've always got a plan for what's
the next feature what's the next change
will be removing this week this month
this year you know like something we're
redoing our categories right now that
means we're going from one category if
they put multiple categories prevent to
one category and one format and one
subcategory like that change itself is
complex so I've always gonna be on the
ball and be aware that even if you're
watching the code today
you're not the one watching the code in
a year or two years time like think of
your future developers and future
co-workers and make sure that their job
isn't really hard and with that please
try our eight eyes day it's available
there as a documentation and polyps up
already and thank you very much
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>