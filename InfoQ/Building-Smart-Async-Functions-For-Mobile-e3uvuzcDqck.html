<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Building Smart Async Functions For Mobile | Coder Coacher - Coaching Coders</title><meta content="Building Smart Async Functions For Mobile - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Building Smart Async Functions For Mobile</b></h2><h5 class="post__date">2011-08-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/e3uvuzcDqck" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I'm going to all my side work with their
Andrew hedges at tap Ulis flash Disney
mobile over in palo alto and as Andrew
mentioned I'm originally from London and
I came over here to escape the riots I'm
going to go into something a bit more
technical just and I'm just focusing on
the JavaScript side of a mobile
application development and in
particular I'm looking at and smart
asynchronous functions specifically for
mobile so by asynchronous we kind of
been a jerk I'm just favoring the term
asynchronous and because we're not
really doing so much xml these days it's
more like Jason and requests were other
than am the full name of whatever it is
XO x HTC are so
here's some kind of typical asynchronous
functions that you see now these are
actually based off the jQuery and get
Jason get post and these are kind quite
common in jQuery Zeppo prototype all
these high-level libraries and offer
these functions and I'm focusing on
these because it's kind of an eater way
of using asynchronous functionality
within an app rather than having to do
the low levels things and using the low
level and xhr object so in a modern web
app with we're kind of using lots of
asynchronous communication there's stuff
where we want to get feeds from the
server and there's stuff where we want
to send data back to the server so
asynchronous functions are pretty much
the bread and butter and most modern
applications on the desktop will be
making heavy use of these so when we
come over to the mobile platform we kind
of ran into a kind of couple of problems
and using relying on asynchronous
functionality so first of all they
require an HTTP request so we actually
have to open a connection send data to
the server and get wait for a response
back and as Andrew mentioned in his talk
one of the key things that we're trying
to do on mobile is reduce the number of
HTTP requests and not not because the
request is particularly big it's the
latency on a mobile network the actual
time to send stuff and get stuff back
even if it's a tiny request could be
quite long so the key thing is we want
to minimize these and secondly obviously
if we're doing a an HTTP request we
actually need a network connection so
the this isn't particularly good if you
unlike an underground train or somewhere
where there's no reception like like my
dad's house and you're going to have to
be on a network for some things but it
would be good if an app can run and
provide some functionality even if it's
not on a network
the other thing that I'll just mention
here but I'm not actually going to cover
in the talk at all is cross domain
origin so if you're trying to make a xhr
request to a server that's on a
different domain they're actually bound
by the same domain policy so it's just
something to be aware of if you're
trying to make calls to other services
there are plenty of ways to get around
it we're just not going to cover them so
much here so we've got some a few
objectives that we want to try and build
into a kind of JavaScript library or
some JavaScript code that we're building
in a web app for mobile so minimize the
HTTP requests we want to try and make
things work so they'll even even if the
M the phone is not on a mobile network
and has no internet connection now just
for application building purposes one
thing that would be nice to have is if
we could avoid cluttering up the
application or the game logic with is it
online is it offline conditionals so we
want to kind of keep the controller
logic in an application clear of like
continuously checking whether things are
online and branching in the game logic
because it's a pelagic because it could
be it's just would complicate things and
it's kind of return it to a separation
of concerns it shouldn't be concerned of
whether it's online offline the other
thing that's a good thing to do is to
try and preserve the original signatures
of the AP is that we're using so if
we're using like jQuery or we using
Zeppo and we're using this get JSON call
we should try and we should always keep
it as get Jason we shouldn't stick a
whole load of extra parameters at the
end such as are we cashing it are we
filtering it are we keyboard catting it
or something it's let's just try and
preserve it as it was a get function
let's keep those other things out of the
way
so the things that we can do and so
we've got these air Ajax functions what
can we do to make sure ma'am more more
useful for mobile functions of mobile
apps we can we can include a cache so if
we've already got that data that we're
actually trying to request local we
could just pull it from the cache and if
it's not to update we can use that
rather than actually making an HTTP
request and sending it to the server the
other way and if we're actually sending
data to the server rather than actually
making a request if we're offline we
could perhaps add it to a queue and then
send it to the server later another neat
technique might be to actually merge
multiple requests into a single request
so actually doing several things at the
same time but from a nap point of view
we're actually the up thinks it's
sending off multiple requests but we're
actually merging it into a single
request sending it and then getting the
response back kind of a not so big thing
but a good feature could be where if we
send a request to the server and then
the data that we get back we won't
actually want to filter and transform in
some particular way so an example of
filtering content might be if we're
getting a twitter feed and we actually
want to apply a profanity filter so it
doesn't actually reduce any day so it
just cleans it up when it gets gets back
to the client another thing that we
might want to do is and provide and
through a/b testing so where we can send
a request to the server and get the same
data back but and we can actually
present the data in a slightly different
way for different users based off as
some identifiers that we have on the
client
and then a another small feature that
could be useful if your em if you've got
versioned and API endpoints on the
server we can make some kind of decision
about which URL to hit so making sure
that the endpoints are always correct
without having to go through all the
code and update those endpoints within a
controller so I'm going to go briefly go
over techniques aware that we we can use
in JavaScript to help and build an app
and apply these these patterns so we
should look at interfaces the defining
an interface javascript doesn't actually
have a concept of an interface but at
least in our minds we should have an
idea of what the interface for a
particular utility object is so things
like an object that does caching or an
object that does queuing that they're
they have an interface to find of how
you actually use those objects and
without actually going into the detail
of actually how they work so we're also
going to look at using decorators in
fact everything that I mentioned the
previous webpage would be implemented as
a decorator around the underlying xhr
objects that jQuery and Zep tow are
giving us and we're using a decorator
pattern to actually augment these
functions and provide this additional
functionality that we're polite a bit in
terms of like caching and queuing so
once we've decorated an object we use
the delegation to these utility objects
so those are the caches and the queues
and the filters there are our kind of
objects that we're actually delegating
that functionality to so just a when
we're talking about interfaces we're
just defining how you actually use this
object not exactly clear how it works so
here we've got a cache interface and
it's gotta get set
and delete delete methods so you can
give it a key and and get contents out
of it you can give it a key and a value
on set and put value into four values
into it so this could be implemented in
a kind of number of different
technologies actually in JavaScript it
could just be a simple array and it
could be a local storage as Andrew
demoed earlier and it could even be an
SQLite database with we're not too
fussed about how its implemented as long
as it kind of follows this interface
pattern we can also influence a queue
accuse quite simple as you add an item
and adds it onto the end of the queue
and then you have removed and removed
pulls things off the front of the queue
so just a kind of little introduction to
what a decorator mike is and we've got
something quite plain here it's a
Christmas tree it doesn't have any
decoration on it and you can kind of it
so now it's analogous to our original
jquery gets or get jason function so we
can then bring our a decorator so we
have a pacman decorator and we're going
to apply the decorator to the Christmas
tree so we've we've still got something
that kind of looks like a Christmas tree
and it works like a Christmas tree has
the same signature but there's something
clearly different and it's been m or
mented in a very special way here so
that's like our kind of cashed a jquery
get function so what just happened we
took the gauge the jquery get function
we applied a cash decorator to it and
then we've got this new objet back and
will this new function get cash which we
can still use exactly like we were using
jquery get but we've we've got this
extra augmented functionality in it so
going on to how things how we might use
that in code
and it's not as pretty it's but this is
kind of practically how you might might
implement it we're just creating a kind
of generic cache object and again we're
not too fussed about how it works but
it's probably it's probably local
storage and say then we're taking the
standard jQuery acepto get function and
what we're doing is we're passing both
the the jquery function and the the
cache object into this cache decorator
and constructor and what we're getting
out of that is we're getting a new
function which has the same identity
identity as and the jquery function so
we can we can give it a URL and we can
give it a success function and then when
that gets executed it will then it will
work very similar to the jquery function
it's just it's been brought mented by
the cache decorator which so it's kind
of changes it slightly and kind of can
make it more useful for we're mobile so
we can dig down into what the cache
decorator is actually doing this is kind
of a fairly simple chunk of code that's
actually what it's actually doing to the
function and I'll leave this up for a
bit because it's this kind of can be a
little complicated so what we're doing
here is we're we're creating a new
function and it has the same signature
as the the original function that jquery
has that has a URL and a success
function i would but would note that
it's actually i simplified it a little
bit but essentially a get function as a
URL and a success and function that's
called and when the request is complete
with the data so the first thing that we
do is we we check to see whether we've
got that URL cash so we're using the URL
here is a key and on the cache object so
you're checking to see whether we've
actually got the data locally and if
we've got the data locally we fire off
the original success and
function with the data pulled out cash
and we've just given it a little tag to
say that we actually did at cash here
and hold it from the the hold it from
the cash and if we don't have the data
and we get a cache miss what we need to
do is we need to execute the original
function that was passed through so this
is the original the original function
that was passed through when the
decorator was created so it's the M the
jQuery get function so we execute that
and then its success function we've
augmented slightly with a cache cetera
knit before we actually apply play the
original function so we actually run the
jquery function and then apply the save
the data that we got back to our cash
and then we return the normal success or
apply the audit the original success
function so one of the counting things
that you can do with these decorators is
you can actually em stack them and so
you can actually provide a kind of level
different levels of functionality all in
one go so here we're introducing a
filter decorator which could do it could
do a profanity filter it could do any
kind of manipulation to the data that we
get back from the jQuery request so what
we do is we kind of create r2m utility
objects we create a cache we create a
filter and we take our jquery get and
then we apply the filter decorator to
the jquery object so we're doing the
filtering first because it kind of
really only makes sense the cash and
post filtered data and it would it
wouldn't be as efficient if we were to
cache data and then have to filter every
time afterwards so we apply the filter
decorator and then again on that object
that we get out the filter decorator we
apply the cache decorator so then this
might get function that we end up with
the end will actually end up first of
all checking the cash and then if it's
not in cash it will go for the filter
object
and then if it's not and if it will
always get filtered them then it will go
back to the jQuery at an X H our call so
we can have a little dig at the filter
decorator this is pretty simple and what
it's doing is we're just meant in the
success function with the with this
extra line data equals filter URL data
so we're just filtering the end they
come to them they're so
I thought the other the other thing I
did mention the star which was the cue
decorator so I can promise this so I
thought I'd and put a slide up of how
cute decorator might work and now this
looks pretty simple and because the key
thing that we're doing is we're actually
delegating a lot of the functionality to
the this Q object which is kind of
mysterious because we only defined a
simple interface for it and my idea of
the Q is that if we're going to use a
cue decorator everything should go into
the queue so even if we're online and we
should still push things in the queue
and let the queue deal with the sequence
of events what we do is when things are
pushed into the queue we do fire off a a
success event so you will you always get
a blank object back saying that it's
been queued but you also hopefully later
on when the queue is actually dealt with
that request actually get that real
success and an event triggered a
function executed so I guess the idea of
a queue is it should always preserve the
order that things are pushed in so
things will always be looked at at the
head of the queue and then the xhr
requests by it off and then when the
cute when that request comes back is
then and the callback function is called
and the item is removed from the queue
and then the next item in the queue is
dealt with so I've got I've got a few
quick takeaways of kind of things that I
hope I've covered and if you guys have
any more questions on and please feel
free to ask me at the end so look it i
hope i've explained kind of the idea of
using decorators to enhance existing
asynchronous functions without altering
their signatures so keeping things if
you're using jQuery door get or jQuery
and
get Jason that they're kind of quite
okay to use and and keep those
identities intact or the signatures are
down intact then separate the concerns
that delegates and things to the utility
objects so just have a object that deals
primarily with caching or queuing and
and if if you want to put something the
cash delegator to that don't depan
because you'll end up repeating yourself
over all over your code so that base so
it's like a good good practice of like
and don't repeat yourself and a good
thing if you're using these are these M
delegated a utility objects is to define
m interfaces for them so things were if
we if we wrote a cache object and and
then we raise it say we wrote it in
local storage and then something else
new comes along it's lame we want to
write a version in SQL Lite as long as
it matches the the interface that we've
defined and you should just be able to
slot that object in and all of your
decorators will that use it should carry
on working and and then the the other
point is being able to stack these
decorators so actually you should be
able to build a tool chest of like these
decorators that will do different things
and you can use them in different orders
where's appropriate in your application
so I did skip a few things and I'll just
go over briefly cross-domain origin
again I said that it's not a problem you
could build things to get round that and
it's because I mentioned at the start
I'm mentioning again at the end that
we're not talking about it things that
could improve things are looking at
failure States and so I just dealt with
looking at success States and there's a
lot that could be explored in terms of
having failure callbacks and just to
kind of neat some things up if you if
you're trying to get stuff from cash and
you're offline then you might want to
fail your event and and as if you're the
same way as if you were actually putting
things into the queue and things fail
later I didn't mention too much about
the specific implementations I haven't
actually put lots of curry off with
these and but things you can implement
these things in local storage and sqlite
or arrays and and then enforcing in
spaces I've just searching JavaScript
doesn't actually have the concepts of
interfaces and I haven't talked about
how you can actually physically enforce
these but there's actually a in Ross and
Dustin's book and pro JavaScript patents
there's actually a good section well
it's kind of near start because they
define the interface is early on in the
book and use them throughout and that's
kind of a good approach for actually
enforcing an interface as if if you if
you actually need to in your application
so am I'll leap over into the questions
and my slides are up on SlideShare if
anyone's keen to download them okay
thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>