<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Livin' on the edge: Netflix edge architecture | Coder Coacher - Coaching Coders</title><meta content="Livin' on the edge: Netflix edge architecture - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Livin' on the edge: Netflix edge architecture</b></h2><h5 class="post__date">2013-06-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/PEWIxqcdrXE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">well thanks for coming off oh go ahead
get started so this presentation is
going to talk a lot about some of the
edge technology that's used at Netflix
and by edge we mean what your wheeze and
such hit first in the network and go and
go over some Java software that that
I've been working on as a part of
Netflix so I'm Adriene Cole the other AJ
and cloud guy
there's Adrian cockerel - also raised a
lot of presentations and works right
next to me and I started at Netflix in
late December last year after spending
about four years on open source project
I found him called Jay cloths and I've
been working on cloud portability at
Netflix with regards to DNS and so you
hear a lot about that through the mix
and I hope you found yourself in the
right room so how many here know how
Netflix streaming works
okay well ishes are a few and no hands
for the rest so that won't be boring
how about DNS in general how do people
feel about DNS thing that puts names to
IP addresses yeah let that works so I
always go through a little bit of DNS
just to make sure it's not complete
Greek but this won't go into like deep
twenty-year 400-page book DNS stuff I'm
intentionally avoiding that because if
you're really interested in DNS
programming you can always join the open
source project and talk to me after the
session we'll go over in depth the Java
code that myself and others in the
project have been working on this code
denominator and this is part of the
Netflix OSS github repository how many
here use github so quite a few
for those who who aren't using it is
basically a source control collaborative
source control but that's free for
developers and we have repositories and
Netflix about well a few dozen I guess
and all the code that are in those
repositories are things that we actually
use in production so and we don't have
Forks internally either so it's very
interesting place because you can
literally see the the bits that are
responsible for for playing your
favorite films or documentaries or TV
shows
finally a cloud price have anyone heard
about the cloud price before the Netflix
cloud prize one hand has two hits three
hits all right
okay that's a bet have a bit at the end
discussing the cloud prize in short
we're giving we're doing our own sort of
Emmys for open source software and the
cloud prize will have ten categories of
awards for contributing and improving
the Netflix open source ecosystem and
there will be a panel of judges some
pretty famous folks there and the
winners will be given $10,000 each that
could be a person who could be a team of
people as well round-trip tickets to go
to the Amazon we avenge conference later
this year which is where the award
ceremony will be so it's kind of fun and
I'll spend a couple minutes just talking
about that too so this is where it all
starts right and this changes some of
you have seen Netflix change over the
years although the branding is pretty
consistent the content definitely does
change and it's it's personalized you'll
have noticed there's a number of
recommendations coming from what's
generally popular or what's popular to
you or folks that have hijacked your
Netflix account
this is actually not mine this is the
other Adrienne's Netflix screen crap but
I suppose I wouldn't mind seeing their
shows but we're going to talk about how
that content gets there and in a
nutshell you know it's a distributed
system how many here have heard about or
knew that Netflix uses the Amazon Cloud
for some of its architecture so that's
that's pretty wide known one of the
things that's that's really good for
cloud computing in general is that
Netflix has kind of trail blazed a lot
of stuff in the earlier days of Amazon
and helped help get Netflix NMS on
through some scaling issues so a lot of
folks who use now Amazon now probably
have a slightly better place because of
the collaboration over the years it's
been a very good relationship but Amazon
is not the only cloud that we use so for
example all the bits in the movies you
can think of the films being split up
into various like second or two second
pieces and distribute it all over the
place and they're encrypted and and the
massive amount of data that that is is
actually on a content delivery network
and that's that's actually a cloud
service how many have heard of the term
content delivery network before so a
good majority but those who haven't is
basically like a cache network where the
whoever the client is is going to be
getting content closest to where they
are super helpful
when you've probably heard the statistic
that Netflix is responsible for 1/3 of
the bandwidth in the u.s. optimizing
where those bits are coming from close
to the user is really important and and
that's actually the majority of the
Netflix traffic and I'll go into more of
a breakdown there so we certainly do use
Amazon for just about well our entire
control plane we don't have we basically
I think we may have a server or two left
in the data center but it's been pretty
much all read
designed for the cloud most of the
content is served through this like
service that's a combination of existing
large-scale CD ads content delivery
networks and then our own thing called
open connect and of course nothing will
work at all unless there was a client
player and so Netflix is also works
tight with device teams to make sure
that not just Silverlight but other
things like your your Wiis and your
Playstations and everything can connect
and use those protocols so for example
what generally will happen is it's a
series of like restful metadata API
traffic that's responsible for Netflix
delivering your browser whatever content
and that metadata is going to have
things like thumbnails of the of the
film's you see the recommendations if
you if you vote on it that's going back
through a rest call when you start to
play the whole licensing dance is going
through the REST API and you're going to
get basically a you know behind the
scenes is actually kind of assembling a
playlist of sort of video pack video
audio packets that are going to be
pulled by you directly from the content
delivery network if you tried to make
your own like dumb version of Netflix
what you would probably do is split up
your films similar to like a bit turn
put them on like Amazon s3 and doled out
signed URLs for temporary periods of
time they'll be really dumbed down
version and obviously Netflix is more
complex than that our content delivery
service Open Connect is a open hardware
spec and it's basically what we do is is
in order to kind of reduce the burden of
Netflix traffic on all the ISPs and and
the exchanges we have our own exchanges
that will basically help install these
appliances on on an ISP which would help
prevent the traffic that would otherwise
go from all those films from like
consuming there up links so what will
happen is
like we would actually manage the
catalog and distribute it to all of
these to all these little ISPs that
might have open connect boxes running in
them so it's a sustainability effort to
help you know get you know less less of
that you know uplink saturated by only
Netflix traffic and so it's good for the
ISPs it's good for us
users get better performance because
they're getting their content directly
from there there is peace network so
there's a lot of good information about
open connect and you can just check that
out on the website or or ask folks later
this is a traffic we have a wonderful
program as Netflix employees inside you
get the ability to see the how
everything works we have is like Netflix
University and so in November the folks
that are responsible for all of our
content gave us a nice class about how
all this stuff works and it's really
nice it's Netflix employees we have
access to like all all of the
information that maybe I can't talk
about like the specific like how many
people use Netflix from here there but
we can internally so this is a wall
slide from an internal presentation of
some information that we can publish
without violating our shareholders and
what this shows is that as of November
Netflix you know is responsible for you
know a vast majority of US traffic
coming down but it's also a pretty
pretty high up there as far as up
lengths too and that's the API traffic
that's a lot of the other things that
are coming from people's devices and so
it's it's a significant amount and a lot
of that uplink traffic is actually
coming through our services on Amazon s3
I mean on Amazon Web Services so
basically this is like we have a farm
folks may have heard that our region and
in u.s. East is about ten thousand
machines and
have another region in UK that has
another few thousand I'm sorry in
Ireland that has another few thousand so
there's there's still quite a lot I mean
and at four and a half percent of the
upstream traffic is is no small deal so
so our cloud is used quite a bit and and
the one way to figure out the control
traffic is to look at the uplink we also
worked with a company called app
dynamics for a few years now which is
one of our monitoring services we use a
lot of services and they've they've
grown over time to help us make sense of
our graph when you have a graph of
several thousand servers even if they're
bundled into clusters you still end up
with a deal where there's there's a lot
of complexity to figure out what your
dependency graph is and so our
dependency graph it's pretty widely
known that we're big Cassandra users we
use Cassandra for a lot of things and
one of the merits we have is that it
helps us deal with multi region
replication meaning that we can take
content and use Cassandra technology
replicated between like east coast and
west coast or between you know Europe
and us and so that helps us a lot for
the content that we do need to globally
synchronize but we also use a number of
other things we use memcache clusters we
use s3 we use dynamo simple TV we use a
lot of Amazon Web Services and so our
graph has to be able to represent both
things that we run and services we rely
on when we're looking at actually what y
ends up working through so this is just
sort of what a starting point like where
the start point is basically our API
server and they have to connect all of
our 200 micro services inside and and
what that actually ends up looking like
it's kind of hard to look at to be
honest
so how many here have heard of Asgard or
seen asgard asgard like our command and
control console sort of like a
replacement for Amazon's web console and
it does a lot of cool stuff and it it
actually recently can do pretty
sophisticated things like workflow
deployments because it's going to be
integrated with Amazon's simple workflow
service which would allow us to do
things like staging deployment tasks
multi-step tasks but before getting to
to something too fancy what you see is
just basically how we how we release
apps we use this concept clot
auto-scaling groups and the ASG in
asgard stands for auto scaling group and
so when we roll out everything is a
cluster until proven otherwise
so auto scaling group can have a fixed
or variable number of servers in it and
we bacon ami with a project that's
open-source nominator and it would have
a naming convention including the
version of the deployment and so Asgard
sort of built around our deployment
model so that you can release and and
put more or less traffic on clusters
that are are often but not necessarily
fronted by load balancers so for example
a lot of our internal services we we
connect with our discovery services
directly called Eureka as opposed to
using a load balancer so DNS side of
things comes into play more often when
we're talking about multi region meaning
that just having it an IP address of
load balancers not enough and so it's
the same issue with with inside the same
region if you had redundant entry points
but in a happy world what we're going to
be able to do is use our various dns
providers and
control them in a similar fashion so
that when someone resolves to say one of
our API endpoints we can point them and
allow them to have the ability to fail
over to a new load balancer or an
existing load balancer that's healthier
than the one they're currently using or
even move their traffic over just to
facilitate an upgrade a Netflix does a
lot of product testing and a lot of
system testing and oftentimes we will
before we do something major we will
move like a couple states over to this
new service make sure it works properly
before turning on the floodgates and
that's not just States but countries so
the project that I've been working on
since since being at Netflix is called
denominator the first production
deployment of that was actually barely
after it finished back in March in this
open connect so when new appliances are
being registered they're being Auto
registered with DNS but we also use it
for naming our load balancers and in
shifting traffic between them so it's
cool logo thanks to Jeff Demick from
ultra DNS who found the app that
generates things like this and so we
have a number of use cases multi-region
failover being one of them but we also
have things like Edda which is our
service for sort of understanding the
audit log of all of our configuration
over time and and then of course things
that we didn't necessarily plan on for
example the introduction of denominator
into the cache service happened without
me knowing it that's pretty cool
and also when some of the folks in our
deployment teams we're looking at
denominator to register our ec2
instances with Dinah's on boot-up just
to give them a more friendly name than i
- whatever the common model is is is a
model on DNS
we have plugins which we call providers
for each of the services we use Netflix
currently uses three different DNS
providers Amazon for internal stuff we
used I neck die neck does most of our
our CDN so this and these are going to
be tens of thousands of of cache notes
and then we use ultra Tina's
predominantly for our API and like so
for example anything that Asgar controls
typically is registered in ultra DNS and
they're all different API models mostly
broken and so that this is one of the
challenges is that some of the you know
clarity you might have with certain
modern API is like github is a pretty
good API
none of these are like that so some of
the features set so we're focusing on
with denominator where to do things in
batches because particularly we have
some pretty large zones and so if you
have something with 10,000 records in it
then you're not really going to want to
do this one at a time you end up with
instead of constant time for operations
you end up with linear time which really
hurts you if you have a lot of Records
to deal with also being able to cleanly
handle advanced records and I'll talk
more about advanced records but
basically anything that has a server
side profile like for example if it's
latency optimized or if it's bound to a
certain set of geo territories this
would be something that I would refer to
as an advanced record and play nice with
persistence because we persist
internally we interact with this and
when we back it with a service call to
nominate ryx
which is a control plane that's built on
Cassandra and we want to make sure that
if these this data is easy to query and
easy to get in and out of JSON stuff
like that so and finally don't do too
much Netflix has a lot of projects for
things like resiliency and command
retries and circuit breakers so we want
to make sure
each of our each of our components for
your design are not also doing all of
those things because then you just end
up with a you know complex web we'd
rather boat on the things that we need
so we want to make sure that denominator
doesn't try to do too much because we
have a lot of tools for doing the system
aspects that we can just use around them
one of them for example was a service we
have ribbon which is a client on the
open-source site and this allows like a
normal rest or RPC client to to be able
to use load balancers and things like
that so we don't need to deal with like
the retry and a for loop stuff that you
end up having with rest clients cool
things is also important keeps you
motivated when you're working with soap
so this is what it looks like to start
denominator from Java and this is one of
the thing that most people don't really
like so much is the fact that it uses
iterators and there's two reasons for
this one is is that we have a pretty
cool project called Eric's Java which is
functional reactive programming it's
observer model and observer model is a
fantastic way of aggregating resources
and
things like lists and things are are
less good but particularly they often
lie because most of the contracts for
things like iterable imply that you're
supposed to be able to replay things I'm
supposed to be able to call iterate or
more than once and because these are
network connections and try not to do
that too much thing we don't want to
cache this data particularly because you
can blow up your heap so the
optimization is that okay we will
probably have a functional reactive
model which will allow us to push like
zone information to you and in the
meantime we don't want our normal like
iterator e thing to be - cashy just
because there's a shortened form of the
for loop in Java for iterable and so
that's that's the rationale and I'm I'm
positive some folks are not going to
particularly care for it but I figured I
put it out there just
your blood your blood can boil a little
when denominator creates a lot of our
providers have multi-part credentials so
some of them have just a user password
some of them require a tenant and some
other things like that so we we have
some mechanisms to support variable
length and and Matt keyed credentials
and abstract as well as the ability to
do that on demand from various suppliers
for example we have a service a ribbon
that allows it to inject things like
endpoints dynamically based on what's
what's registered in zookeeper so we
might we might get things for different
places but this is a way to statically
defined it
DNS lingo so zone is what a lot of
people call a domain or subdomain
technically speaking DNS is a tree and
it makes things really complicated if
you think too hard
so zone is is sort of a noun that's
defined in like the main implementation
of DNS called bind and we're using that
word most people use it records are
things inside of it and so records are
really the things you tend to be looking
up zone is like a namespace for those
records now what most people get
confused about and DNS is like cname
versus a and basically in DNS there's a
kind of a record format and on the far
right is the data and the far left is
the name of it and the type is
describing what's on the far right
what's the data so if the the record
name is a then that means that there's
an address at the right hand side that's
an IP address if it's quad-a it's an IP
address four times as big which means
it's an ipv6 address C name means
canonical name and it's an interesting
thing because canonical implies the one
like the Highlander one so if I have a
cname that I'm pointing to and my like
canonical name
what is the real name for this thing so
if you're making a DNS record and you're
and you're putting a name in the field
for data
it's a cname record and C names are
weird because of this implication of
being canonical means that a cname can
only have one name at the right-hand
side whereas an address is not trying to
be so I could put a list of IP addresses
there I could I could give 8 IP
addresses and then my JavaScript could
just round-robin through all of them
because in one DNS query it's a valid to
have many IP addresses returned from an
a record cname because by definition it
can only have one like Highlander one
then if I have a JavaScript thing that
pulls back that I'm going to get one
value now I can resolve that back to IP
addresses but the one value thing makes
for advanced records and so basically
you need you you would probably want to
for availability concerns be able to
allow the client to use multiple load
balancers not just one and so this is
this is sort of how we start getting
into advanced records when writing
denominator we optimize for record sets
this basically means anything with the
same name and type so netflix comm
record might have you know sever is
coming back to you those would all be in
the same record set and this is also
helpful because DNS security DNS SEC
likes to sign things based on a query
tuple and that query tupple includes the
name and the type and so there would be
a corresponding signature for that name
and type and so for that for DNS records
that need to be signed you have to
really aggregate them into record says
anyway very few people do that because
there's a lot of maintenance involved in
DNS SEC but that's one of the reasons
why DNS things name servers are servers
that typically listen on port 53 that's
why I Masson Services named route 53 a
punt on route 66 but using port 50
three resolver is a thing that's asking
the server's questions and so the
resolver could be inside your Wie it
could be inside your Java Virtual
Machine
it could be delegated back to your OS X
or whatever it is that you happen to be
using
but the resolver is a thing making the
question making the questions the
nameservers the thing trying to find the
answers and when I use the word API of
course that can be used for anything but
I'm just trying to differentiate between
sort of the line of fire stuff which is
between this resolver and the name
servers and your control plane work were
you actually going through and trying to
reorganize your domains or your records
and that's that's what I'm going to use
the word API for now dagger is pretty
cool how many here have heard of dagger
before and I'm switching to Java by the
way is not DNS concept how many here
have heard of juice how many here have
heard of spring okay okay spring
definitely so spring and a lot of people
in pitches so spring is literally 10
years old I think maybe as of a week ago
so spring popularized dependency
injection right and and then I think
five years ago
juice came around and it said hey we're
writing in Java why don't we write our
configuration in Java too and drop the
drop that config files and allowed you
to do things like you know be able to
check in your Eclipse or whatever your
favorite ID is and find the references
to all your configuration and and things
and it was much smaller like 500k or
even I think maybe was smaller than that
dagger was made by crazy Bob and Jesse
Wilson and all the folks that made juice
that were formerly at Google and now
we're working at square like the credit
card square and this is this is being to
optimize it the dependency injection
problem a little bit further and also
make it possible to use the same model
on
regular Java as you do for Jewett or
Android and so for example can you do
dependency injection with with no
reflection and that's the problem that
they're attacking is very interesting
technology in a nutshell it says okay do
it in Java C instead of at runtime so
basically if I if I forgot to wire up
something together Java C will fail
that's pretty cool right so inside of
denominator we wire things together up
with with dagger so for example this is
a jet clouds context builder thing and
so on the left-hand side you're
providing things on the right-hand side
you're requesting things and so I'm
saying I want to provide a singleton and
when this if I have like all these a
bunch of methods like this I'm basically
building a graph right and be cool
there's a couple cool things about
dagger one is is that if you think it
through my graph is validated and
compiled into Java code so that means
that it's it's static and that means its
it should be faster than than doing
runtime analysis and then trying to
figure it out as you go along probably
will have less problems at runtime
because your grass is not going to
change on you the other thing that is
kind of handy is especially because it's
not runtime aspects such as singleton or
lazy or other things are actually a lot
more useful for those of you who've used
dependency injectors that have scopes
like singleton and things like that your
notice to make it at runtime they have
to sometimes make really coarse locks to
to get that to work when you do it at
compile time you don't have as much
complexity because you don't have to
consider things changing on you and so
it's it's pretty interesting and at the
end of the day you can look at the code
the classes will end up being named
dollar sign dollar sign inject adapter
so if I if I was producing this I would
have a class in my source
my target classes directory called route
53 API dollar sign dollar sign inject
adapter and I can just look at the code
and see how it works it's pretty pretty
nice Daggers runtime is is no runtime
because all of its done at at compile
time which means that the overhead of
dagger is I think five kilobytes so I
can't fathom any dependency injection
system you know like that right spring
was made to kind of like make what was
then web logic and JBoss which seemed
very heavy lighter juice was made to
look make spring lighter and and iger's
made to make this lighter I don't know
if we'll get lower than five K but I'm
sure someone will figure that up we use
adapters on vendor specifics so for
example in this in this J cause API it
has a robust implementation of the Dynex
service but we only need a few bits from
that so we adapt out and we we adapt out
into the denominator model which is
simpler doesn't mean that it's not
powerful and our model also has some
interesting things that some people will
will love or hate one is is that
anything that is extensible we implement
as extending a forwarding map and
there's a very good reason for this
one is you don't know what your
extensions are ahead of time and we have
we have Java it's nice and type safe and
we like our getters and stuff and we
know they're not going to change on us
but we don't want to have if you don't
want to deal with the registration model
always but you do want to be able to
facilitate advanced records from any
given DNS provider without having to a
lynchpin of coordination to decide what
this class models are then you do this
sort of JSON thing which is you punt to
map and and so that's what what we do
and our denominator any model that we
have that's extensible so we have this
thing called profile which describes the
advanced
her type and we have corresponding
getters with with the map keys that are
enforced when we actually write into the
Constructors so we still do the type
safety but for convenience and also for
help just arbitrarily bumping this out
into JSON we're allowing folks to to be
able to do extensions without even
publishing them we use maps for things
like that the profiles are the
server-side configuration so these are
things like is this latency optimized
for Europe or is this does this have
health checks built-in like that is
automatically going to failover when
something happens that's what we use
profiles for and so for example the most
important profile for Netflix is a Geo
profile because that's how we can
transition like Argentina to use a test
version of an application that might be
optimized for Argentina now when we're
looking at managing availability what we
are looking at is a combination of
dealing with different territories and
also the way that territories are
defined in different API models so we
have the UN we have the ISO
organizations and there's probably a few
dozen ways to describe a country or a
state and and that's as a reality we
have there's there's a lot of different
ways of doing it I can do it from sort
of a geological standpoint I can do it
from a jurisdictional standpoint that
there's many ways and the many types of
depth there so it's not wrong that the
models are a little bit different for
example inside of ultra DNS it's it's
more like the ISO 3166 which means like
us - CA for California or AR for
Argentina
and but in DNS what we're really doing
is it's not magic if I know someone's in
California I only know that because I've
looked up their IP address and and I
have some database that tells me that
this IP address is likely to have
originated from California there's
there's a at least in DNS DNS doesn't
have a metadata about someone's GPS so
unless you have a service that can
actually propagate Dene GPS data then
you can't really guarantee that that
that that entity that has an IP address
is coming from a specific spot so that's
how it works in DNS
now Netflix itself after DNS we have our
own thing called geo which is a service
that even can read GPS data and verified
locations of folks but this is mainly
just turning the hose in the right
direction knowing that some will have to
redirect out but at least you get the 90
some percent and so that's that's how we
how we use this stuff and we use it also
to deal with migrations so for example
say we're bringing on a new load
balancer for the West Coast and we want
to test that service out we can just
plug States on we literally do that we
we've ranked the 50 US states into
basically prioritized buckets based on
traffic and then and then we can move
you know two states at a time test yet
make sure everything works and that way
we can go through and go back pretty
easily so basically in availability
terms we're looking to achieve
availability by reshaping traffic to
places where kind of we know better
because we have health metrics about
certain things that would allow us to
say for example Virginia is in trouble
even if you're in Virginia use
California these are certain sort of
things that we can do is sort of like
overrides which is we have when we when
we can control based on the clients
origin I can't release the actual
traffic distribution per state but it's
very very interesting
some states you know have an order of
magnitude more traffic than others even
at the same time of day so it's not just
like the hours of the day going by
there's a lot of different like social
behaviors and people just like
particular content more and so there's a
lot of reasons why the traffic could be
more interesting than just what time of
day it is stuff like that so we can use
these tools to do this this is just an
image of ultra DNS they have some pretty
interesting analytics tools now for
showing distribution and time series
data of where client queries are coming
from
so it's geo profile what we have is we
have you know it's a profile so we need
to know what type it is it's geo the
groups that we have a Netflix typically
we have a group per per traffic bucket
so for example for services where we
have load balancers in EU US west and US
east we will make a geo group that
sounds like that and generally it's like
this this and everybody else because it
isn't just that we're serving traffic
for us east and west and Europe we're
serving traffic for the entire world so
we need to figure out which of these
which of these groups when assigned to
the right load balancers can can take
the rest of the world's traffic because
we don't have API servers in every
single data center in the world although
we do have this massive cache grid our
all of our API is like all of our REST
API are running out of Amazon clouds and
there's there's only so many regions
they have so we do need to make choices
as far as which countries go to which
cloud endpoints this is sort of what the
Java looks like so what we do is this is
using guava how many here have you have
used or heard of guava before guava is
like functional Java
and effective Java in a library it's
kind of nice adds new types called multi
map and things like that table some
extra collection types and some function
and predicate logic so if you like using
languages like closure or Scala you'll
probably enjoy java more if you use
guava and a pitch basically what I'm
saying here is I want to move the the
territories that I have except for
California someplace else and so I can
write a red code to do that in reality
we we use our control plane uses
Cassandra and we will have some queries
that happen there so we'll just prepare
the entire like record set update out of
a Cassandra query but this is how you
could do it programmatically in Java
airline is a project we use so one of
the things about denominator is is that
it's a Java library but we also know
that we have a lot of network
administrators that use DNS right
unsurprisingly and not many of them what
would prefer to operate in eclipse like
they're not going to say oh I need to
make a DNS change let me fire up eclipse
so we need to make a command line tool
to facilitate the reality of this this
problem domain and so there's a really
cool project in the airlift repository
called airline and this basically allows
us to write get like CL eyes and so
things with expected
naming conventions for commands and
parameters and help statements without
as much of the work and so we're also
using a process now airline I believe
was originally authored by Brian
McAllister who had this process called
really executable jar and what that
means is that you can actually take a
Java jar file and and execute it without
saying Java - jar that file you can just
dot slash it on a UNIX
and it's a pretty interesting trick and
that's that's baked into our build
scripts so anyway you mark up a POJO
basically it doesn't have to implement
any interface that just happens to be a
abstract class I have quote denominator
command and so those descriptions that
everything will will magically place
themselves inside the resulting
executable pretty cool stuff
now I figured I've talked quite enough
and got enough time to answer some quick
questions and also click around and show
you something so good yeah sure I can
randomly click over there so let's see
if I make sure all right so if I go to
this is the checkout of denominator
denominators on github under Netflix and
if I go to the CLI now we're we're using
Gradle for the boat tool but you could
do this with maven there's a built in
maven plug-in called really executable
jar plug-in yeah but if I look at my
build at Gradle here so here's a really
executable jar stove so Brian's website
is called Skype and this is the wizardry
basically what happens is that if so so
a jar you could open in your text editor
if you really wanted to
it wouldn't be fun but it can work the
zip format ignores the header basically
before it before I get this there's a
certain there's a certain marker in zip
format that after which it starts
reading it before which it ignores you
can use that header spot and stuff in a
shell script that says exact
Java so if you write a shell script just
that just says exact Java and then you
cat to the end of that your jar file
then after that you can just use it so
for example if I have right now we have
this uploaded into homebrew so if you
did like brew install denominator it
would work but I already have it
installed but if I just do to
denominator version I didn't have to do
Java whatever but if I look at
denominator so off oh yeah and say look
at its first two lines of that file now
there's my thing that redirects me into
Java but if I looked further I would
just see nasty nasty you know jar stuff
and I can jar - tvf that file it's
perfectly valid right but I'm tricking
the filesystem a little bit because I
think it thinks my jar file is a shell
script now
so it's this makes for a very easy
distribution model of command-line tools
and recently a guy in in the open-source
group who were working with Shane his
digital sanctum he added a config file
support so denominator you can do
commands like I want to look at my route
53 test environment and my config file
would be denominator whatever I did a
list of my zones one of the things that
this is denominator 1.1 and one of the
things we're working on and 1.2 is to
make this faster because there's a lot
of overhead this still uses juice and
juice is responsible because because of
a lot of the singletons that are in the
existing code it does take a lot longer
than you would expect a command to take
and particularly if you're working with
systems administrators are not really
kind of happy with all these few second
legs there used to curl and other
utilities to just return like nslookup
right if I want to do nslookup yahoo.com
I wouldn't want it to happen quickly
they're very responsive ly like 20 now
in Java we're never going to get to 20
milliseconds because the JVM takes
longer than that to start out however if
we look at if we look at what our
overhead is if I do time of denominator
using our mock - provider mock zone list
then you know my JVM is pop you know
it's it's not too bad I happen to know
that a hundred milliseconds of that is
actually parsing the command-line
arguments with airlift but it's still
it's you know you should be able to make
a web service call and return in less
than a second if my whole JVM only takes
300 milliseconds so one of the things
that's happening now with denominator is
we're working on a new core library
that's based 100% on dagger so
everything's compile time or as much as
we can and it's called to feign because
a lot of the api's we deal with are
feigning restfulness they're not really
restful they're kind of weird they're
HTTP but then but they're not that
simple to use and what fane does is it
allows you to use things like regular
expressions to
to parse your responses as opposed to
like a jack speed thing that would take
you 100 milliseconds to initialize or
longer and it also is completely written
from ground up in dagger and guava only
which means that the jar file even with
five providers even every every
dependency included is two-and-a-half
megabytes so that's very fast for Java
to launch it's very fast for it to scan
the class path and because everything's
woven together at compile time the
processing is very fast so the overhead
dropped when I have a example of working
with this where the overhead dropped
from 680 milliseconds to 50 so that was
kind of cool and basically what Fame
implies is you end up with a factory so
I can create new instances of a marked
up API that's marked up with like jax-rs
annotations and then the couple extended
once and I can make many api's out of
that now a Netflix we have some pretty
interesting concerns because a lot of
our services are looked up by a
zookeeper we have a lot of dynamic
service discovery going on so when we
want to find the URLs for services and
and how we actually interact with them
we need to be able to do that at runtime
so one of the things that Fame optimizes
for is that you can not only dynamically
change the URL but you can dynamically
change any part of the request before
it's sent which means that I can strip
off the tokens from here use this
different service I can fall back to
something else and I have a very simple
interface just using a guava function in
equals out and and do that so Ben's
pretty exciting tool and that that will
result in a denominator 1/2 which should
hopefully be at least preview able in
the next week or two return a command
like from RAL 53
in about a second so at that point the
only way that your network administrator
would know that it was written in Java
as if you told them I'm gonna switch
right back I think I probably only have
one or two minutes but I promised I
would go to the cloud price so don't
want to leave you without that so here
are the categories of the ten categories
now some of you have heard of monkeys
those are the things that kind of
they're like our cron jobs and they look
at things and they report and they
sometimes take action sometimes kill
things do we have ways of contributing
to code quality that we haven't thought
up like sometimes people are looking at
efflux came I say man you guys should be
doing this what it so sucks well here's
your opportunity to show us and get you
know Fame glory and 10k portability and
enhancements would allow you to like run
Netflix on different languages or
different clouds or whatever stuff you
might be interested in I can read all
these categories to you but there's ten
categories that's the important thing
and then there's the the we know we
haven't figured out all the interesting
things you might come up with so there's
a judges Choice Award for the category
that doesn't exist the process is we're
under way every contribution has to be
apache license so we can sub license it
out to folks in apache license so if it
ain't apache ain't going to be accepted
still time
the entries closed on September 15th so
we highly expect a lot of them on
September 13th and then the award
ceremony our Emmys is going to happen at
the Amazon reinvent conference and
that's the judges will be selecting from
nominations that were categorized and
suggested through the engineering team
the entrance if you look can follow
those those lines basically why myself
and others and the team will help filter
these into into the right categories the
main responsibilities from the entrance
are just go to github netflix cloud
prizes or repository it has instructions
they're not too difficult so there's not
many rules as it is like in Netflix in
general but make sure your code works at
least if it's code and the more traction
the better so we are in the cloud but
we're not about buying this guy
everything on a flex up my source
repository is used in production so if
you have something that's that's working
and also has traction from someone
that's that's definitely going to bump
you into the higher consideration
categories it's not just cash you also
get five thousand Amazon credits I
always forget to mention that but for
some people that's pretty important
pretty nice and a trophy cool so the and
for those who aren't interested in what
why Netflix does open source last little
bit on that we spend a lot of time on
Netflix working on functionality and
scale knowing that when you optimize for
certain things
you're not optimizing for something else
so we're currently working on
portability denominators part of that
but also some of the open source work is
is helping us with that we've been we
have a bunch of projects but we're
working towards a platform that you
could deploy and be able to sort of have
the whole application lifecycle similar
to what we use if it's helpful to you
and generally what we're trying to do is
make sure that that we increase our
ability to evolve and get done so
take away is denominator is what we're
using for DNS has got some cool stuff in
it too we're fixing the DNS API is like
the last release of denominator included
a lot of serious fixes that dramatically
increase the performance of the clouds
we have leverage to do that being
Netflix we're pretty important customers
so we can definitely help proxy some
serious issues and I guess I don't want
you to subscribe to anything because I
put them into unreadable links but
anyway we have Google Groups for
denominator we have github account and
and you can also follow on Twitter so
thanks for coming</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>