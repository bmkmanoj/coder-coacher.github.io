<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>29 - Content Providers - Part 2: Android Bootcamp Series 2012 | Coder Coacher - Coaching Coders</title><meta content="29 - Content Providers - Part 2: Android Bootcamp Series 2012 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>29 - Content Providers - Part 2: Android Bootcamp Series 2012</b></h2><h5 class="post__date">2012-03-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/kO0VCuYGIM4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">we said refactoring right our
refactoring was basically we created
Yamba provider the provider is now a
content provider we basically
implemented a content provider by
providing implementing you know the
standard methods on create on get type
right and then we inserted we provided
insert in query right so so they they do
something they insert a new database
inquire database I purposely skipped
update and delete because of you guys
should be able to tall extrapolate how
to do that as a matter of fact that will
be your homework right so yes you get to
do that that's gonna be on the test but
basically update is gonna give you the
URI of the record it's gonna resolve to
a URI this is gonna be your values and
this is selection selection arcs you
pass that on to database you'll return
how many records have been updated and
deleted you delete and this is basically
a where statement right now we move the
DB helper into here because this guy
used the DB helper so they basically
obsoleted all together the status data
we deleted it all together so we
modified the Amba app so now I use get
content resolver to insert into one
right now in timeline activity we did
the opposite right we are reading from
we were reading the data and we were
reading the data in two places one was
here right and the other one was down
down in the timeline timeline receiver
right so basically what we did here is
we said get content resolver query blah
blah blah there's actually another way
to do that and that way is to do
something called
managed squaring yeah so what Nana's
query does it looks exactly the same
soon looking copy paste the URI right
you are I'm projections now selection no
selection arcs now in sort order is
gonna be the same as what we had before
and and I say Kurt sir is that right
so as opposed to using this approach you
could use this approach so I'm gonna
comment this one out
so this basically what manage query does
is is is basically supposed to is
basically does the same thing but also
manages the life cycle of a cursor so if
we close that if we close the activity
something is supposed to close the
cursor remember that database if we
never close and we never release
anything right so if you say managed
query then dad's going to close it if on
the other hand we did for example this
if I did close here I did get this if I
did debated close then that moment this
would be empty this would be not it took
me a while to figure this one out like I
was like huh as the data disappeared but
I thought I open up the database get the
data close the database
the moment you closed database release
the data so you can't do that so so
instead what you do is you do something
like this you say manage query right and
you get M Squared now we're not gonna do
this either because as you can see this
has been deprecated well it's been
deprecated in a sense honey comb right
so this really depends on which version
you're using
but basically what we're supposed to use
is use the duck the the cursorloader yes
that's correct okay so to do that you
basically use the it's gonna be it's
you're going to use the we're gonna use
the cursor loader that's going to load
the the query okay and it's gonna notify
us off when it's done okay so we can
basically create a cursor loader with
all this and we can say load in
background okay so once load in
background is the loading diagram stop
loading much documentation that and let
me open it up here
there's diamond fragment so basically
what we want to do is we're gonna create
do it like this we're gonna implement
something called a loader manager loader
called call back so that we a
synchronous the update our UI when we're
done so let's do it like this so this is
the sort of proper way right but again
like I said it only works since
honeycomb so we are going to say
implements loader manager dot see a lot
of the manager dot why doesn't it have
the callbacks because they have a typo
and they should complete it for me
all back there sir
you're not getting the loader manager
sounds like where some of us are stuck
on the older versions remember how I
said you can go to the documentation and
you can actually do immediate here
loader loader manager so you can
actually turn on the filtering so you
can say I'm committed to ten then this
would not be available it was available
on it since honeycomb right in the way
well I can walk you through how it's
supposed to work right so what we're
supposed to do is we are supposed to in
it a loader right so get loading manager
initialize loader then that cares
callbacks that that are gonna look like
unloading finish you get a cursor loader
and so on and so on you're supposed to
basically return cursor loaders and and
unload finish do something with that
loader etc cetera but but but you know
if we don't have it we don't have it
right yeah so we will basically
implement methods like this and create
loader we would do something like
initialize the URI
for example do our selects and create a
new cursor loader right why don't I have
it so that's it's a different story
though their manager loader callbacks
did that change mine to work on all the
version I didn't
okay
so okay so I was using the old API I was
based on ten by the way if you are using
ten you can still do this via the
compatibility labs pressure it's part of
the loaders and fragments are part of
the compatibility so you can actually
run it on gingerbread as well so what I
would do here is I would say add
unimplemented methods so this now added
these three methods right on create
loader needs to create new cursor loader
so we're going to basically if it turned
new cursor loader organized imports okay
so and then this is context URI so
context is going to be this URI is gonna
be the you right that we were loading
from so it's gonna be like this right
URI that's the URI we're loading from
projection selection selection artisans
sword order so everything's going to be
now except the last one which is gonna
be that so basically this is ID I
believe because you could hear multiple
loaders IDN arguments so what I'm doing
is I'm implementing that load imagine
now again this is optional this is for
Honeycomb enough code if you guys want
to do this right but it's an
asynchronous way of to uploading data to
that's to answer the question what if
you have gazillion records and you need
to kind of do it in a background yeah
how would you get fully downgrade I mean
if you create separate apks then they're
separate application there's nothing to
talk about right that's one strategy but
it's not the best strategy by their
strategies to get one code base and to
have it you know figure out what to talk
to Ron it's just you would have if
statements you you would check for the
build
there's a system dog build or whatever
it's called property and you could check
you know how to do it like for example
like if one was I would say something
like if good system
build version or something like that
build that version right equal and then
you can basically compare the versions
and so on right so you could do things
like that to figure out what works
thanks you know since the videos so
that's that's how you would do it or you
could okay meaning you could uh
unknowingly stick to the older code
right so so in this case I'm going to
I'm going to do this using so so
basically if I am doing it not doing it
this way right you're not doing it that
way then what I'm gonna be doing is I'm
gonna say get
logan manager with autism in it loader
and then you can specify which loader
with what arguments in what callback so
we're not using any ID so it doesn't
really matter
arguments are gonna be now and the
callback is gonna be this so it is this
code that's gonna call those callback
methods right
make sense
so basically what I've done so far is I
have defined the this guy here so
basically said we are implementing the
the loader manager loader callbacks
right that added a bunch of methods to
at the bottom so as opposed to what this
was option one this was option two we
could have just gotten the cursor here
right or we could have gotten the cursor
here this was the worst way because it
actually then we would have to manage
the lifecycle of a cursor right this was
a slightly better way because the
activity would manage the lifecycle of a
cursor right but it was so bad because
everything would happen here is blocking
that was that's why it was bad right so
we are in oncreate so that would mean
that we would wait awhile to possibly do
that now you don't see any problems with
our code because we have like what 20 30
50 tweets but what if we get way more
tweets you get you get the issue right
so so that's why the this is the third
approach right it is to basically use
the to use table loader manager so to do
that well actually this is the turtle
project so to do that we're basically
saying get a Content the loader manager
initialize it for specific ID for
specific if you want to pass some
arguments and ultimately who to call
back when it's done so now the loader
manager manages loading what the manager
says ok I'm ready to load up the class
I'm done loading oh do this we'll do
that right thanks oh so the loader
manager is now going to say what what
happens so basically on create we're
simply going to return the new loader so
that's what we create the loader and
this creating the loader was very
similar to what we did here right
so this now kick starts loading
somewhere some some thread right
presumably now this is when it's done
this will be now synchronous this is
kind of like onpostexecute right
this is doing background kinda this is
onpostexecute you guys get it right so
so now we can do something useful in
here and usually this is gonna be a swap
usually unfinished you're gonna do
adapter swap cursor usually right so
this would be adapter dots swap cursor
cursor right so this would be our cursor
so we're swapping and this is loader
just eclipse doesn't do a very good job
filling all the banks so what what
happen is the loader finished loading so
whatever cursor was part of the adapter
we just replaced it right
and then finally reset loader also
happens to be swap cursor right so we're
gonna do the same thing in a reset
so essentially it's just as different
semantics you get the same code this
code now became this code and this is
now just swapping asynchronously when
it's done right
when you call that loading manager
loader callbacks right that's gonna call
back these are the callbacks these three
methods that we have this one is the
factory essentially the see happens in a
background on a background thread this
one is back on a UI thread and this is
da cunha UI thread right
so now the question is just how to reset
let me see
so reset loader is basically starts a
new starts a new or restart an existing
loader demand if this is manager so
basically what you want to do here as
opposed to doing this stuff we now want
to say so I'm gonna comment this out
just so you can kind of see what it will
used to look like and we're gonna
replace this with the get load there
manager dot reset loader ID of the
loader I should probably give it some
kind of ID I'm gonna call this loader
status yeah
callbacks are gonna be this is gonna be
now and the last parameter was what put
a callback and the callback is gonna be
the parent which is timeline activity of
this right let me just define status
loader sorry just one second I know I'm
bouncing up and down
I just want to define a constant for my
loader so I'm gonna give static final
int loader and it can be like whatever
47 you don't really care so as opposed
to doing - so so that I'm not confusing
it with this number of -1 right okay so
version 1 was was this right it was bad
because we would have to manage it
ourselves the life cycle of a course we
would have to remain to remember to
release it and so forth and so forth
version 2 it was better because it was
managed but it was not as great because
it was blocking so if this was taking 10
minutes to load we would be sitting here
for 10 minutes to look now keep in mind
content providers are are usually backed
by database but not don't have to be
always backed by a database right
so because of that
that's not a good approach especially
not to block oncreate right because this
would be this could lead to aan are you
doing something potentially long so the
third approach was the best approach so
that was basically the best approach and
that was basically to use the loader
manager to say just load status loader
and call back this which is that once
you're done okay
so that's gonna cause these cool but you
know api's to get called on create
unload are finished on loader reset
right so basically what we're doing
let me just double check when I reset
unload that is literally what you want
to do unload reset now we wanna set now
yeah we just have to say now right we
stopped you it was registered that's
correct so on so that's gonna swap the
cursor so we basically got the new data
and this is that yeah oh we don't need
this anymore change change
and we can actually well this is not at
this case right as a matter of fact I
don't think we need cursor anymore
put the noun
right because we're not using that
variable anymore it we are not managing
cursor ourselves we have the adapter
we're loading it with a now cursor but
we're kick-starting the loader then i
should probably put this line like
slightly below then see this is gone
and at this point this may say make
sense to just gonna reorganize orbit
so something like that so basically
these guys are now responsible for
managing the loading so let me let lets
start make sure this works actually
before we talk about it any further
menu stuffs update enough okay test to
test loader update that posted go back
menu refresh works like a charm right
you guys following so this is sort of
the Ice Cream Sandwich an accomplished
Ice Cream Sandwich feature but via the
I'm almost sure via compatibility
libraries that's available in the older
versions as well so in other words you
could add is a feature to the other like
questions comments on that so we can now
dis now scales right we can now handle
gazillion records in our database we can
a candle like content provided that
actually goes is very slow right all
that stuff we can handle
got it okay good
yeah everyone got any questions alright
cool so what's next so now that we have
all this working the natural so let's
see we're at the natural progression
from here would be to do this guy right
after all that's partially why we
started going down this path of creating
content project although as you can see
it's not just that why we care the
content provider also you have to do
with loaders because previously we would
have to do our own mechanism for loading
if we didn't have the loaders right make
sense yeah connect to database we don't
have a network connection but the
database the database is right here in
our own ground so there's no network I
don't care about the network connection
I don't care if this doesn't exist when
I'm connecting to a database within my
own process there's no network right I
mean there's just a local tcp/ip stack
actually there's just a local filesystem
there's no you know it's a sequel I'd
database right it's a library it's not
there's no network involved at all it
could have been that this status
provider is actually backed by you know
some database up in the cloud right but
now it would work fine because we have
all these fancy loaders and you know
it's asynchronous the loading and blah
blah do all manage itself well it can
take we take as long as it wants either
to timeout or to load gazillions of big
data or whatever it is right</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>