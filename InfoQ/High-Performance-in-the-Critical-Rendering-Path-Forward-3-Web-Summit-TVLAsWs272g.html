<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>High Performance in the Critical Rendering Path - Forward 3 Web Summit | Coder Coacher - Coaching Coders</title><meta content="High Performance in the Critical Rendering Path - Forward 3 Web Summit - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>High Performance in the Critical Rendering Path - Forward 3 Web Summit</b></h2><h5 class="post__date">2015-08-31</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/TVLAsWs272g" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello hey everyone I'm Nico I'm from
where Osiris I'm answered gb on Twitter
and the back one we'd have I'm a
JavaScript consultant and I'm here to
talk about high performance in the
critical path so this is something that
interests me because I started a blog a
few years back and it was really really
slow because obviously I'm am now than I
like doing things on my free time so I
just wrote the entire thing myself it
turned out not to be such a great idea
and then I ended up with a client-side
render thing that took a really long
time to load so over time I became
obsessed with a performance so there's
basically three steps that we need to
take to fix these kind of issues and
they're very well delimited first stuff
we need to measure what we currently
have and figure out whether we are doing
things right or where we are slack
enough whether we are cashing stuff or
not and there's plenty of tools to go
over this and this kind of scenario so
you don't have to manually check HTTP
headers for every request or our net so
the first thing that we need to know is
what is going on in our sides and
there's plenty of tools to do this one
of them the quickest way you can measure
something like this is just going to
your site opening app dev tools go into
the audits tab and the firing a panelled
it and it will produce something like
this where you get different rule
somewhere if you're passing them or not
like are you combining your external
javascript are you caching stuff are you
have you enabled keep alive is gzipped
enabled for all text content on that so
this is a very fast way to get and get
started into what's going on with my
side right so you get advice for every
resource and you also get some advice
regarding caching best practices also
for every resource and there are some
more general purpose advise you that you
should follow another tool is PageSpeed
insights if you don't know this one you
should check it out and that's the URL
or you can just google it here basically
it's a hosted service that google has
for you you just enter your URL
underside and it'll take a couple
seconds to run an analysis on your site
and you'll get a different views like
the the house it working in mobile and
how it works on desktop and you'll get a
score from zero to a hundred that's
going to tell you roughly how good or
bad your situation is and again it will
give you a set of different rules and
where you pass them or not but it's also
a lot more comprehensive than the dev
tools version because it actually has a
lot of resources that can help you fix
the issues that it finds and the other
cool thing is that it also cares about
you x so for instance the model version
might tell you that tap targets are too
small for human fingers and stuff like
that so this is an hour great tool to
use you roughly get a score that I'll
see how you did and again you get best
practices and practical advice to
another version of a service that does
this kind of thing is a web page test
web page test is a little bit different
from page spilling that it's a lot more
comprehensive in what it measures it
measures request down to the TCP level
so you get a very fine detail on what's
going on and there's quite a few
different actionable things that you can
tell using web page test that you really
couldn't otherwise or at least it will
be harder with other tools so just
liking impatiently the you enter your
website's URL and you start testing the
big one of the big differences is that
it will place your request on a queue so
you want to immediately start crawling
your site but instead it'll make you
wait maybe five minutes or something
like that but if you choose a location
that's not filled up in its kew it's
going to be much faster and here you get
a great in different areas like the time
to the first bite in the connection
where we are cashing or not where you're
using a CDN in this example we have an X
there because we are not doing anything
like that where you're compressing
images and stuff like that and then you
get these this hbu where you you're told
how long it takes for the page to load
on the first load and on their second
load where the cash is supposedly primed
so there should be a big difference
there and you also get this waterfall
view where let's keep that where where
you have all the resources and have they
are blocking on each other here you can
tell for instance that the CSS is
blocking
all of the funds because during the CSS
right but that's in turn block in the
shallow script so if we found a way of
deferring the deforms and the JavaScript
the page would load like two seconds
faster or something like that so this is
really something that we should be
placing more interest on and it also
gives you like again like I said earlier
very fine detailed grades on on all of
the requests and shasta on a whole scale
and you also get these what they call a
filmstrip view that basically makes it
very very easy to tell if you have
issues like most of the basically loaded
but we are not displaying anything
because we have it what's called a flash
of invisible text and in this case again
what we should be doing to fix it as we
will see later is a differing different
loading anxious using some website font
first and that way we would get rid of
all the blanks in the page where even
though the content is there we are not
explain it because the font isn't there
yet I'm for the most cases unless you're
obsessed with typography and stuff like
that it's fine to just displayed in a
slightly different font and then load
the other one on top so it makes it very
easy to spot flashes of an invisible
text and fix them and it calculates
something that's called the speed index
that's basically a number that tells you
how much of the page has loaded over
time and it's defined very complicated
Li but it's yeah it's that it takes the
visual progress of the be visible page
loading and computes an overall score
for how quickly the content is being
painted so with web page test you get
inspection forever
qwest you get to analyze TCP traffic you
identify bottlenecks and you can
visualize progress so with all of this
you can really really gained a lot of
insight into what's going on in your
site and start fixing things but the
problem is that if we ended up right
here today you would go back home or
maybe even Chas here on your cell phone
this is your page figure out what's
going on once never go back to that
again maybe you fix a couple issues and
whatnot but the problem we'll just come
back in a couple weeks or a couple
months or couple years so it's something
that we should be doing actively and
constantly so this is something that we
could obviously automate but from what
we've seen so far it's kind of difficult
because you have the devil thing not
something you can really automate and
the website services they are kind of
clunky to automate i would sell anymore
something right so there's actually CL
eyes that allow you to do this kind of
thing in your terminal so one of them is
a psi psi is short for PageSpeed
insights it's basically a CLI written a
note that allows you to just passing a
URL and run that against your side
you'll get a pretty printed response
that's basically all the content I wish
I saw on the PageSpeed insights page and
there's also a programmatic
implementation of that so you can chat
integrated with golf or anything really
again webpagetest also has a CLI this
one is a little bit more annoying
because like we said earlier requests
get put in a queue first and then you
have to wait so the first time you call
this they give you a URL you have to
thing for a few seconds before you get
the response yeah you obviously can
write the script that does the waiting
for you but they don't make any
assumptions like that so you have to do
it on your own but you still get like
the level of granularity this gives you
is ridiculous just try to run it once
see all the raw data and you'll be
impressed as to all the things that you
can do once you have all of this you
could do something like different of
your previous results with your current
results maybe you never build on or on
mp3 deployment to to stage in and you'll
get a much better insight into how your
changes are affecting the performance in
your sights on our tool is why slow we
didn't really go over the one in the eye
dee dee dee browser extension because
it's pretty much the same as the depeche
speed insights and the dev tool Odets
but it's a little bit older so it's kind
of updated by still useful it also gives
you a grade and a score and winnett and
you can run it over grantor with the
phantom shares which is a headless
browser directly so you can also run
this on the command line Annalise
measure measuring right I mentioned you
could run these things on your own your
build processes and maybe on every
deployment to staging but you could also
take is take this step further and say
ok so I really actually care about
performance so I want this bill to fail
if some something is going to slow right
so there's a couple of ways you can
determine what's called a performance
bad that's basically saying ok the
page must take two seconds or less to
load or we must make a
less than a hundred requests to survey a
web page or we must ping at most 20
analytics trackers or stuff like that so
what should you track right well turns
out there's a lot of different metrics
that you can use one of them is
milestone timings that's basically
saying the time that that it takes for
the site to show the first relevant
content like an article or tweet or
something time to first wit is actually
something that to our blogged about it's
pretty interesting um speed index is an
hour one spin index is pretty nice
because it gives you an overall score
that's pretty tied into what performance
in your site actually looks like and
that's not something that you get if you
are tracking something like quantity
based matrix which yes are very easy to
do right like you measure how many
requests were made or how big these
ideas but they don't really give you
insight into how much of that content
was loaded over time because maybe if it
was loaded right before the patient load
him that all of the content was actually
readable already then it doesn't really
matter that much other than the browser
loading indicator spinning um and the
you get even easier things like rule
base metrics like the whites low score
or the or the web page test grade
someone out so yeah you could obviously
also mix and match these things to get a
better insight into what you're trying
to accomplish but the the DN goal here
is to first you have to figure out which
kinds of improvements you can make on
which ones you shouldn't
curso match about and then measure that
and enforce those measurements make sure
that if the build is the if this check
fails then the build files also that's a
really important and easy way to make
sure that performance is performance
stays relevant for everyone involved in
the in the team so yeah and our tool
this time grant perf budget that allows
you to set a ton of configuration
options that that allow you to settle
these budgets that we've been talking
about and enforce them so if one of the
requirements so to speak isn't met then
the the whole grant build will fail um
and that just allows you to not make the
deployment to production or whatever so
what can we do to actually improve
performance because so far we've been
talking about how we can identify issues
but how do we actually fix them so to do
that we have to look at the complete web
stack and that means TCP https HTML CSS
font images and javascript so let's do
that first off we have networking and in
this regard I i highly recommend that
you read this book from le agregue Rick
high performance browser and working
it's a it's really interesting because
he speaks about all of the lower level
protocols that underline the web such as
TCP HTTP but also the newer ones like
WebSocket where TC and stuff like that
he also makes a lot of emphasis in in
more networks and UX around that
have a big site might be a really huge
problem and the bigger problem that we
make it out to be for mobile users
because they might be walking down the
street and champion from antenna to
antenna and having a very spotty
connectivity so this is also something
to keep in mind when designing for
performance um that it also improves UX
right so optimizing DCP is actually kind
of obscure but there's two things that
you would actually do that there are not
so hard the first one is increasing the
initial TCP window size and that
basically means that the connection will
start with a higher throughput and the
way you do that is basically updated in
latest OS version and they usually have
sensible defaults nowadays to
accommodate for that the second one is
disabling slowstar restart which
basically means tcp works in a way that
it tries to balance out when the
connection has been idle for some time
it it goes down and the throughput to
the safe levels and the problem with
that is that HTV by nature is very
bursty right you make a request you wait
you make another one and if you are
using people I which you should this
kind of defeats the whole purpose so you
can disable this using that command and
the slides which are on my Twitter
account and on any Linux box then HTV
just mega wriggles right we can all go
home turn on keep alive it's usually
really easy to do many many web servers
enable that by default she sees
everything obviously that's text I'll
expire sunny tech Heller's this is
something that we shall II
tend to live for last and end up never
doing but it's really useful used to see
the N if you should which means research
and look into using a CDN but don't just
blindly throw your site behind a CDN
because sometimes it can be overkill if
you're just running a blog right or
something like that so look into it but
don't go overboard HTTP choose PD yes if
you can use them use them nginx support
speedy and I'm pretty sure there's some
sort of extension that does hcv chew as
well so if you in case you don't know
what these are it's basically the this
thing that's going to revolutionize the
web as a whole because it's in most
cases it gives you like a fifty percent
improvement on the connection as a whole
and it does that by using a single TCP
connection you remember when we had to
do like shardene because three or four
connections would block the the entire
browsers connection to our side so we
would use sharks in order to hack around
that and allow the browser to open more
sockets against our site and all of its
subdomains so what this does instead is
it uses a single TCP connection but it's
a non-blocking multiplexing so all of
the requests go through the same
connection and it's reused so it's one
connection part of the main peroration
right you get a higher compression which
is basically like really really
important because for many requests the
biggest or an important site part of the
rigorous sees the health and you must be
thinking well but i have like content
type and
ah ha cept and the cookies and one out
yeah the cookies are for the most part
usually the problem because you tend to
get a lot of analytics cookies and one
not so her compression how it works is
basically since we have a single TCP
connection it maintains a cache of all
the different hairs and values and if
it's something that either sign has seen
before then it's just mapped like cheesy
I guess so the content is not sent over
every single time as long as it hasn't
changed and you get proactive server
push which is basically to say that when
the server is serving the HTML content
it can in parallel also hint to the
browser that it should be downloading
these JavaScript dcss so the browser
doesn't have to wait for the whole HTML
to load in order to start making the
waterfall for all of the other resources
so yeah the web needs us right so
optimizing HTML well rendering the
server side that's the best single piece
of advice I have for you in this slide
so yeah if you're using react or
something like that then you can already
do server-side rendering if you're not
you should look into doing something
that allows you to do server-side
rendering a lot of the client-side
frameworks are now trying to find out
ways in which they can support
server-side rendering because they've
realized it's a huge performance problem
not doing so because well the design has
to serve the HTML has to serve all the
images the CSS the JavaScript and only
then it can start interpreting the
JavaScript fearing add what bu is going
to be rendered render that run the
clients I controller and by that time
these are long gone right so you can
become a single page at later and the
way that works is basically you serve
HTML with
were seen that the user needs to see
write the content that's the only thing
that matters really as a user and then
you can add in the decline side
rendering engine and allow that to take
over the server-side rendering thing by
hijacking links and one that you can
throw all of your analytics requests and
when add I you should also defer any non
critical as a loading again this means
the content is so Lamar's so if you have
20 images in your page chances are maybe
I've of them are in the top of deciding
what's called above default but the rest
ours has nowhere to be seen and there
are still loaded and blocking everything
else so you can easily use some
attribute hacking and changing around
the page loads and make it faster to
load and yeah I usually keep it
accessible to because again this is
where I see you X and performance being
pretty tightly knit together when it
comes to CSS the best thing we could do
is inlining critical CSS and these means
everything that's seen in that first
above default imagine this is a web page
and everything that's below the curtain
is below the fold so the critical CSS
would be every single rule that's needed
to have desired be rendered exactly like
this and and it doesn't matter if the
user Scrolls down and sees the comment
box like a gibberish because eventually
they'll get it asynchronously but the
point is that if you in line the
critical CSS in a style tag you aren't
blocking rendering on the CSS and that's
huge you can also remove unused styles
obviously done do this by hand no
we'll ever but II you you can use a tool
called an CSS that will see later to do
that about them domains just make
responsive websites or apps and you'll
be far better off because you wouldn't
be trying to cram everything every
single device into either mobile or
desktop that usually doesn't work out
obviously concatenate them and minify
and follow a style guide seriously
following a style guide is the best
single thing you can do with CSS besides
pre-processing and I wanna add but if
you don't your team is just going to
there's this concept that I heard that's
called up and only and that means that
CSS is something we always sad too when
we want something because we don't
really know what's in there it's like a
black box so if we're following a style
guide that some of those problems can be
mitigated and we get a little more reuse
out of it when it comes to phones load
them asynchronously if you can use a
fallback when while they load prevent
flashes of visual text as a as the page
loads using javascript is fewer fonts
and I repaints yeah that sounds right
right but if you're working with any
designer at all and you go back to your
team and be like yeah we need to teach
these free funds they are now working
out he's just not gonna do it right but
in your next project or not you should
try and work with the designer on those
issues and try to figure out what's a
good constraint to set for for the
project and maybe you are like okay we
can use two phones that's okay and again
constraints are great
design actually so this is something
that you should consider in the future
and obviously cash the hell out of funds
because they are huge and expensive to
load so that's an obvious one when it
comes to images we should be minifying
and shrinking them and this means not
just running a lossless compression over
them but also if you have user uploaded
images and things like that they tend to
be freaking huge like if you don't get
screenshot in in any Mac it's going to
be ridiculous and if you shrink them to
like 900 pixels by 700 or something like
that or anyways you set the maximum
width to 900 pixels chances are it's
going to be practically the same except
probably for mag smaller so do that
again the four images we've below the
fold create spark price sheets using
tools don't make your designer do it
because that just lousy but uh yeah you
surprised she's anyway trying lining
tiny dynamic images like gravatar swell
gravitons are not a great example but if
you have something like that considering
lining them because the they can be it
can be more expensive to make the
request than to inline them again
something HTTP two fixes but a four-time
mean is still useful in some cases and
you CSS for simple icons if you have to
use like a circle none shall study an
icon for that shows you CSS and be done
with it javascript that's where the
wrong issues you should say you should
be able to live without it because again
going back to the HTML section you
should have server-side rendering
showing all the content that's relevant
to user and in most cases if you're not
running a real-time video chat thing or
something crazy like that you probably
don't need that much so again deferral
of it
you probably can get away with that your
small money obviously this is something
that's becoming an arm nowadays luckily
but yeah if you're not using modules use
them if you're using modules use smaller
ones use asset hashing obviously to cash
javascript and CSS and even images if
you can so that you can another expires
header and cash them away until they
change and use on our hash and cash
vendor scrape severally because those
tend to be the biggest parts of the site
so if you can get away with having a
separate bundle for those that one
probably won't change as often acts as
the user code sorry won't be downloaded
as much which is a good thing so how do
we do all of this right well um
questions ok that's like there we go
so to do all of that you can use engine
eggs it'll solve everything it's a
reverse proxy it's basically you can put
it in front of your actual application
if you have no chase it's perfect for
that use case you can use it as a
cluster or not but anyways it handles
all of these static machine for you
she's sleeping and one and um so all of
the static content is taking her care
for you and it doesn't add load to the
node process which is huge too it's
super speedy Annie yeah it has gz by
default set up a CDN if you want to or
not you can use fastly cloudflare Amazon
CloudFront and the S free again look
into it maybe if you are like okay yeah
I really need a CDM maybe try out cloud
for CloudFlare cloudflare first which is
cheap too free and then maybe go with
some are more enterprise option for sure
rendering you can use backbone and
render but I don't think render is
actually a lot well maintained anymore
you can use angular presumably in two
point oh I'm not even sure but I've
talked to a couple of guys from the
angular team and they seem to be going
to do it at some point some have you can
also use Ember even though their server
side rendering thing pretty much doesn't
work because all it does is it
pre-compiled things for web crawlers so
yeah now the point toners it's a thing I
wrote it has server-side rendering and
clients are running it also does some
like progressive enhancement things so
if you're in
in that checked out then there's react
which means the most reasonable option
nowadays for this kind of thing if you
care about performance and you want to
serve full HTML pages from the server
side first differing assets that's an
easy one for javascript shots you sizing
for four styles or fonts put them in a
no script tag and then use javascript to
create the same link thing but set the
media type to only ex or something legal
like that and then after a time I change
it and that will don't ask why but
that'll make it loaded asynchronously
and now block I new CSS this is mostly
useful if you are using a huge framework
like bootstrap are only using like three
different rules that they provide and
that's usually the case with bootstrap
right but you probably aren't using boo
striping production so anyways you have
like the goal plug in the grunting and
the command line tool you do like an CSS
pipe some some website to it and you'll
get it you you'll get back all the CSS
that's not unused so you can just put
that back in your your side she'd
probably you want to prettify it first
but it works critical CSS inlining is
kind of hard because you have to load
the page on phantom shares or something
like that and run these penthouses great
on top of that and what perhaps does is
it figures out out of all these CSS and
you tell them to look in which rules are
affecting the the content that's above
default and then it gives you that back
in a in a chunk of stand
up with and then you can use that to put
it into style tag and differently rest
if you want something a little bit more
higher level you can use critical that's
an arm oil it also comes with a run task
and I believe it has a gulp task but
what it does is it goes a step further
and actually does the inserting of this
style tag for you and it also yeah so
you don't need to worry about that and
also the first the the rest of the CSS
which usually doesn't get modified
because that way if you have different
pages where each page has different
styles that are critical to that page
then you can just serve the same the
same style sheet for everyone but sort
of different styles so because it gets
cached but body styles still change so
it's pretty good so look into this one I
beg you use the fun loader those are
pretty simple to use to you can do NPM
install from patient load I'm basically
what you do is you said your instead of
whatever custom weapons you have use a
website font like Alberta or something
and then you run this great were when
the callback is called you just add the
an hour class name to the document and
right over to the different family
optimizing images again releasing image
mean allows you to optimize all the
images but Shasta when it comes to like
bytecode you can use graphics massacre
or stuff like that to automate the the
Franken um and yeah you should do that
as soon as the user uploads the measure
or something so these are both really
easy to use
I'm ish mean comes again with the CLI
got plugin grunt plugin and I
programmatic API so you can use it
wherever you want it's really really
good creating spreadsheets again really
easy you can use frightening for this
you basically tell it where your icons
are at the individual icons I give you
back an image that's de spreadsheet the
the CSS file and the it's actually well
abstract enough so that you can do
whatever you want with the with the
coordinates and sorry that it outputs
stylus let's ask Jason wherever you want
to it's really simple to use are you
gonna integrate it into your belts so
that's great inline images just use the
data URI module has a programmatic API
CLI just the data URI your image you get
back at data URI so it's great um my
little system you can use babel or surf
I or yeah that's about it then use
anything else yeah you're great now so
another thing you can use perfect school
that's like an old-school workshop thing
that runs in your come online I wrote
this thing so that you can go through
the exercises and it's pretty documented
so if you want to play around with
everything I've been talking about you
can just run this and yeah follow the
exercise around so in summary measure
your metrics out of my dear matrix
define your budget enforce it prioritize
your content optimize your content
respect your humans and respect our web
so I also wrote the book it's called a
JavaScript application design I have a
couple here so if you want 1 i'll just
give it to you just come talk to me it
talks about mostly all this stuff i've
been talking about but also it goes
deeper into
Automation is divided in two parts the
first one is build automation and how to
make your development processes faster
and your deployment and testing
processes faster it talks about in the
second part about Nigel arity
asynchronous programming with java
script testing NBC and one out and then
it also talks about rest api if you
don't want to buy anything from me
Shasta contacted me and I give you one
for free or also go to github.com / bill
first / will first and there's a hundred
code samples that you can look at so
that's what I have thanks
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>