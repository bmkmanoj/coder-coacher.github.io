<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Tutorial: Android Application Development - Location Sensors | Coder Coacher - Coaching Coders</title><meta content="Tutorial: Android Application Development - Location Sensors - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/InfoQ/">InfoQ</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Tutorial: Android Application Development - Location Sensors</b></h2><h5 class="post__date">2011-05-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/aRhos52bZGA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so so let's talk about file location
stuff works so this is a little example
and you have it in your PDF it basically
it's it's a little location-based thing
and it says you know where am i it's
trying to figure out the location now if
I run this on a physical phone it's
gonna look different
then if I run it on the on the emulator
and that that is because the emulator
doesn't really support location very
well it's got something called markup
location so let me rerun this on
physical on the emulator on a physical
phone and then what I'm gonna do is I'm
gonna switch over to DDMS so that's what
I can show you what it says well isn't
it a fact I'm not gonna get you much
much information because I'm also an
indoor on the on this so it's not gonna
get GPS coordinates and it doesn't have
a sim card but let's do this instead so
what I can do to the emulator is I can
fake the location so there are certain
emulator controls that we can do here so
what I'm gonna do is I'm gonna send a
seeker there's a bottom there's like a
way to send longitude and latitude to
the emulator all right doesn't exist on
a physical phone that doesn't work but
on the emulator you can do that so what
I'm gonna do is first of all notice that
there's no little GPS here right doesn't
exist now if I go here and click send
notice that now GPS is on and notice
that it knows my location details right
which basically is the same as this
right god so I faked it it's as if we
got a lock we didn't yeah so far so good
so to show you this example how it works
and then what we're gonna do is we're
gonna plug it into our code as well so
now so in this code
what I did is we have something called
the location manager location manager is
one of the system services that works
there's a lot of system services and
they all sort of look you use them in a
similar way right location manager Wi-Fi
manager telephony manager sensor manager
all these managers they're kind of
similar in a way you use them so here's
some similarities and some differences
one similarity is how we need to get
location get system service so the way
you get access to it is by asking for
that particular system service from the
current context Susan so good questions
so where does this hang off of so this
belongs to the context so as long as you
have context you can say context dot get
system service so in other words it's
readily available 20 of the main
building blocks so basically anywhere in
an Android app so you get a location
manager ok so this line of code is gonna
be identical regardless if we're doing
sensors Bluetooth Wi-Fi telephony you
name it ok the user status for our
system service ok now there are certain
things that are specific to a specific
system service such as location manager
I can I can ask forget last-known
location
thank you it's because it takes a while
to get like a fix so it's location
manager happens to remember it's lost
fix or not in in our case right so far
so good now these are services meaning
they are there to serve as they change
all the time so what I mean by that is
that let's take let's think about this
for a second back to the picture that
you've been going back to resilient I'm
so far which is you guessed it lifecycle
so I am now I want to know location but
location is something that changes just
like sensors change
all the time just like Wi-Fi changes all
the time just till I for any changes all
the time just like glue tube changes all
the time etc so when do I want to know
changes to not knowing location and
let's just assume that knowing changes
is expensive and it's expensive because
you got to do something to process them
right for GPS it's the mayor of fact
that you're turning on the GPS chip
means you're sucking dry the battery
okay same for Wi-Fi for sensors it's not
the chip itself itself but it's the
processing of the data that is expensive
so typically you want to register and
unregister from those changes it's very
similar to what we did in in our time
line activity so again you get to cast
your net you can cast it very small or
very wide so in this case in most cases
I like to only listen to stuff while I'm
in users face in other words I can do
something with that information right in
other words does it make sense for me to
try to acquire GPS signal while the user
has turned off or like you know shut it
put the phone in the pocket
it doesn't night it'll just waste the
battery right like my see my phone here
still trying to get a GPS right using
trying trying trying never gonna succeed
right we're indoor so in other words we
again wanna register on this zoom in
unregistering on pause now it's it
doesn't mean that it's gonna be on
resume on pause but mindfully pick your
point a point B in other words Pig car
white maybe you want to do it on onstart
and onstop maybe you wanna do it don't
create an on destroy it's up to you
right but I usually do it in on in rock
or in running state so in this
particular example back to the code so
what I do here is only zoom I request
location updates in on pause
I do the opposite of that I remove those
updates okay so in on his own request
and on pause
remove updates got it yes well so if I
just requested only when you press send
then you have to wait until in like it
may take a minute two minutes or my you
know stupid galaxy phone you know five
minutes plus to acquire GPS right so you
probably don't want to do that
that's what red yeah exactly so you're
not blocking because this is working
again on a publish/subscribe mechanism
right so in this case I'm registering a
listener so this is a listener okay it's
pretty common so what this means is that
I'm saying location manager I request
that you call this guy when there's a
change to GPS provider that is more than
one second and ten meters I think this
is like milliseconds and number of
meters right so you get to kind of hint
how frequently you would like to get
changes right maybe maybe your app is
the restaurant app so you don't care if
it's changed more than a block maybe
maybe it's a video game some game app
and you actually care about like tying
all the changes in location who knows
right you get to hint to the system but
the point is you register for updates
you aren't register for this now the
actual language may be different for
sensors we call it something else but
you know but but it's the same idea
you summer subscribe you somewhere and
up subscribe you say I want to know you
say I don't want to know
right and then you need to provide
listener
so in listener it's gonna be another
class and again it could be an inner
class
it could be a whole separate class in
this case what I did is I made this also
implement the listener which means it's
capable of being notified which means
that it must provide the following
methods on location changed on look on
provided disabled don't provide an
enable on status change it doesn't
matter what those methods are each
service is gonna have its own set of
methods got it okay so let me show you
let me show you another example and
we'll get back to this example and
actually implemented in our Twitter
example okay so so what I'm going to
show you is let me show you a little
sensor demo I'm gonna run it to my
emulator oh my sorry my physical phone
so this is a little app that shows me my
sensors and specifically I'm listening
to orientation sensor okay so I'm X X Y
Z coordinate right so my X is azimuth is
basically north/south right so if I find
zero or close to zero or close to 360 to
somewhere so hold on you know I wish
this was more accurate but it's it's
sort of saying that North is somewhere
there is that right
to say yes okay so it's approximately
that that way okay so that's what it's
telling me because that number is close
to zero or 360 right that's not now
pitch is gonna be this number so when
it's ops like this then it's and then
it's close to minus 90 right if I hang
it like this then it should be close to
plus 90 right that's pitch right enroll
is gonna be this axis right it's right
now it's whatever ninety and then it
goes the other way
like not change the orientation but it's
different stories you guys get the idea
right so let's compare the code and
again what I'm trying to show you here
is that they're extremely similar
so since your demo
BAM so you have the sensor manager does
this line looks a similar to this line
right so BAM you know we get a location
manager you just do get system service
BAM and they're all the assistance of
Bluetooth Wi-Fi telephony they all look
the same right so once you get lucky
sensor manager guess what you're gonna
register a listener in onresume
in non registering on pause most likely
right so in other words I want to be
processing the computing the data when
I'm visible does it make sense to update
like the screen when it's you're not
visible it doesn't you but you're
basically doing work when you're not
visible in other words remember how I
said stopped doesn't mean that you're
not doing much most like you don't want
to be doing much but there are abs that
actually keep on processing even when
they're in the background in other words
they're in stop this cache state but
they're still cranking doing stuff
that's not a good app right usually
generally speaking so far so good so so
on resume we registered our own pause
beyond register and I provide a listener
so again this is a listener it
implements sensor listener this is an
outdated there's a new API for that but
don't worry about that
and what that means is that on it's
gonna call us on accuracy change and on
sensor change so I do nothing here I
ignore it but when it's a sense of
change I figure out the results because
they're given to me and then I do
something got it
so all of these guys worked pretty
similar
any questions enough it was a yes or no
question yes ma'am alright so let's do
let's our Yamba because it's so simple
let's just let me show you what people
do so damn damn so let's assume that we
want to specify our location okay so
what I'm gonna do is and you can only do
that in status activity right so I'm
going to define location location
manager location manager is gonna be so
disorganizing ports so location manager
gives you a location as it as in
location object so location manager so
it gives you a location as the location
manager is location object and location
itself kinah
let's see location itself it can tell
you distance to accuracy acts you know
latitude longitude you know time speed
provider cetera right some basic stuff
but location is very it's very abstract
kind of concept right now if you want to
convert it to a you know one two three
main street you know springfield
illinois right
then you need to geocode it so there's a
whole other API for that called geo
coder that tries to convert it to
unknown adams right and as a matter of
fact in my
yeah and that is open-source geo coder
is open source so in my in my where my
application it actually does try to do
that right so I take the location and
I'm gonna if you notice but yeah so I
think it took that thought see
allocation changed so yeah here it is
so I use geo coder gets from location so
I try pass DX latitude longitude to geo
coder and ask for known addresses
geocoding is part of the API so it's
here yeah so that's geo coded now
there's it don't confuse it with maps
maps is now a whole other ballgame Maps
is a Google specific proprietary secret
product that you need to sign a contract
to use it's that it's not Android thing
so Google Maps is a Google proprietary
product you need to go sign up form a PI
API key get a key down of the API
separate API to use it okay because they
have to pay for the tiles to copyright
on the tiles so that is actually a
proprietary pub yes yes so so that that
is that is open source so that will
query I'm not sure exactly why Square
it's giving you back so you give it you
give it
37 comma minus 125 whatever and it gives
you back 1 2 3 Main Street
now if you want to draw that on a canvas
Wed like trees and like buildings then
that is the map so there's a
I don't I don't know where the data is
coming from per se geo coder is part of
API so it's it's there yes geo coder is
right here it's it's Android location
geo coder yeah so so it's reverse
geocoding is process transformation
latitude blah blah the amount of data
yes yes exactly so occasion is abstract
so let's do that so let me show you that
since we're doing that example here so
in status activity or have a location
manager now I'm gonna get location
manager by saying you know location
stuff so I'm gonna say I'm gonna say
location manager is a location manager
and I simply say get system service for
and then you find location service right
so so far it doesn't it just a location
manager just got something that's
available to me anyhow now if I want to
find the last-known location right I
would do I would basically say let me
say let me do this in like this
location location right I would say
something like this location is location
manager dot and let's see we get last
known location see this is what it's
asking for a provider it's saying what
provider do you want to use to get that
result and you can have multiple
providers so I would say I can say GPS
provider which is a good location then
manager dot GPS provided well let's see
this GPS provider is known one network
provider is another one and so on right
so you could have different providers
you know Galileo in Europe whatever
Russian one is called you know China's
coming up with something so there could
be different providers other than the
GPS which is us run right so so I say I
specify the provider no that's not what
I'm saying I'm saying they're different
systems on the planet now one of them is
Global Positioning System by the run by
the US government it's available to all
of us across the entire planet but it is
run by a US government yes yeah they
they launched told us what 27 satellites
are something like that right now
Chinese government has their own
Europeans have been working on PLL
forever and it's like over budget over
time kind of project right typical
European project so yeah exactly so so
everyone's got their own different
provider I worked with a company that's
making like you know super precise
positioning system for inside the malls
right instead of a mall yeah so like you
want to know is in front to what story
you're at and like yeah because you know
you can't find your people instead of
all right now right well I don't know
what they're using but yeah I don't know
exactly what they're using typically not
so so there could be different ships
inside of your phone the differently to
figure out location but the one system
is that you go to a network you ask
yourself on Tower hey since I'm talking
to your tower what's my location the
other system
is your chip goes in triangulate
satellites there could be a another
system it goes triangulates I don't know
you know the local coffee shops or
benches in front of the stores or you
know trees now have RFID Zoar I don't
know you know there could be different
yeah I mean I don't know Wi-Fi exactly
Google Google's been scanning the Wi-Fi
networks yeah yeah
they're basically driving down the
street with a car with no GPS and it
scares and says look Bobby Wi-Fi network
Bobby and Tommy are located that such
and such as you know so it basically
builds a mapping table between the GPS
coordinates and the scan results so
later on if I'm in that area and look I
I found Bobby Network we we can map it
with Google service to a specific GPS
correct so that's the idea exactly yeah
and then you get a lawsuit from the
German government so but but that's you
know or at least investigation so that's
what's happening there but anyway back
to this I'm asking for a last-known
location right so so that's that's one
thing that that I wanted to add but I
may not know this last-known location
right and so what I want to do is I also
want to register location manager for
updates so location manager dot well
actually I don't want to do it here
that's what I'm gonna do it is like we
said in arms on right so I'm gonna do
this source override implement methods
I'm doing this quickly just in the
interest of time so we're looking for
pause right right there and on resume
those are typically the ones that you
care about these own damn Adam why did
you have it here so I'm gonna yank them
out of here to see the bloody stuff
so right there I'll say location stuff
okay she stuffed and and I'm gonna flip
the order cuz it doesn't make sense like
this so add it here so on a zoom we're
going to do a location manager dot ready
quest location updates okay this is
provider this one provides a minimum
time minimum distance in listener
provider that's already defined it as a
string minimum time how often do we want
to change our stuff let's just say we
don't care that often every 10 seconds
or something well we can use the same
delay that we use we don't have it right
here
it doesn't matter yeah I can
yeah 60,000 sure minute minimum distance
you know doesn't make sense to let's say
every kilometer right we care about that
right every 0.6 miles right and then
listen I'll say this
now it says you can't have this be a
listener because it's not a listener so
we do that little dance to say let the
implement a listener and then I say add
unimplemented methods remember just like
we do don't click whenever you made
something always sinner blah blah yes
okay
so location you undo the thing so you
remove updates for the listener this
come we're done okay so this is going to
register and unregister listening now
when there is a new something something
we need to do something right so on
status changed so hold on on status
change your providers on location
changed I'm only gonna care about on
location changed right got it
and so what I'm gonna do in case
location changed I'm gonna update our
location right so what is going to be so
our location is gonna be be on ba da to
get to weather and then I think it's at
how do you set it in Twitter location
how do you tell something else so let's
go to the not Jade Twitter documentation
look for Jay doc right Jojo Java doc
there and then Twitter and then location
okay on this one set my location there
you go
and you need to pass it an array of
ignore Gia navel for users
okay this is a for setting okay so we
need to say latitude longitude lat as a
double okay
so set my
set yeah so here but why is it not
finding it
I'd cast - amber gets wetter ah huh
Twitter why is it not working
maybe my version of the library doesn't
have my location what's the problem
one why am I not seeing that in my
Twitter
let's see dot set favorite count blog
set search location that exists let me
see what else is there in the
documentation so it could be there
something change in documentation set my
location set search location search user
set search location
well I'm not sure why it's not supported
but you guys get the idea right oh god
that would work right that's what I was
gonna enable right so anyway I'm gonna
undo it now it's a bummer that the
library doesn't support it I already fix
the library I actually have a different
version of a library then it's available
online so we could with the emulator we
could because we could simulate it let
me remove this and location manager
going BAM okay so that's that's the
location stuff so is that gonna make you
sense code that works so you guys kept
to like where Emma is a good example
it's in the book and so is the sensor
and I have this other example which sort
of goes into how to use some of the
custom components as well but it's
basically just like sensor demo is just
that it's showing you that graphically
so it looks like this so basically just
as I move it basically updates the Rose
the compass rose right so you can kind
of see how it shows you one or taste and
so on right physical device so far so
good okay so that's basically same
source and location</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>