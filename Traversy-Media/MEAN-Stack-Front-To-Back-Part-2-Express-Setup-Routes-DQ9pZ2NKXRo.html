<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>MEAN Stack Front To Back [Part 2] - Express Setup &amp; Routes | Coder Coacher - Coaching Coders</title><meta content="MEAN Stack Front To Back [Part 2] - Express Setup &amp; Routes - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Traversy-Media/">Traversy Media</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>MEAN Stack Front To Back [Part 2] - Express Setup &amp; Routes</b></h2><h5 class="post__date">2017-02-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/DQ9pZ2NKXRo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right welcome to video number two of
mean stack front to back in the last
video or the first video actually I just
kind of gave you an introduction into
what we're going to be doing we're going
to be building we're going to start off
with building an authentication app okay
we're going to do the back end first
using node and Express and then we'll
move on to the angular 2 front end now
before you get started the two things
that you absolutely need to have is no
js' installed if you don't have that
just go to node.js org or you can use
your package manager however you want to
install it and I do have videos on my
channel that show you how to do that I
would suggest watching the node for
absolute beginners if you need to need
help getting that set up but honestly if
you don't know how to get nodejs set up
you probably shouldn't be starting with
this video because you're going to be
very really get confused
you also need MongoDB installed locally
I would suggest watching MongoDB in 30
minutes if you don't know how to do that
okay so just make sure you have those
two things installed on your system
before you even attempt to do this
project alright so we're going to go
ahead and open up the terminal here and
I have three windows open these two are
in the my projects folder and then this
is the Mongo shell okay so once you get
MongoDB installed you want to well you
don't have to open the shell but I like
to have it open if you're on Ubuntu or
an hour any Linux distribution you want
to make sure your MongoDB service is
running so to do that you can do sudo
service Mongo D start okay so you need
to do that and then just put it as a
password okay
so first thing we're going to do is
we're going to generate our package JSON
file so we need to create a folder for
our project so I'm going to say make
dart and let's call this mean off app
and then I'm just going to CD into that
okay and then we'll do NPM and knit and
that will help us create a package JSON
file so let's just enter through
it's version that's fine description
will say mean stack authentication app
and the entry point I'm going to choose
app dot j sk author you can put your own
name is this okay yes it is okay so
let's open it up let's open that folder
up in the text editor i'm using atom but
of course you can use whatever you like
i'm going to add a project folder and i
want mean off app ok so here's our
package dot JSON file now i just want to
add a start script here so that the
reason we do this is so the user doesn't
have to do you know whatever the main
entry point in this case note it would
be node app to run it so we just want to
say that right here that way they can
just do npm start all right but we're
going to use node lon anyways which will
run our application and make it so that
we don't have to keep stopping and
starting the server every time we make a
change
alright now under that scripts we're
going to do our dependencies ok so we're
going to need a bunch of stuff here so
we need express and we're just going to
install the latest version of all these
ok we also need mongoose mongoose is
going to be our object document mapper
to work with MongoDB we also want be
crypt and we're going to use be crypt
Jas because with the standard decrypt
package there's a whole bunch of
dependencies and I always have issues
with it so we're going to use the bcrypt
chaotian which is much easier alright
let's see what else do we need we want
the cores module so that we can make
requests from our front-end even if it's
not a different port we're going to need
G
and web token and that's going to make
it so that we can generate GWT token so
that we can have authentication for
specific routes we also want bawdy
parser which is pretty standard and then
we want passport and then there's a
bunch of different passport packages we
want passport - JWT ok so that will
allow us to create a login strategy that
uses web tokens ok so that should do it
I'll make sure you put a comma right
here and let's go ahead and save that ok
so now we're going to go over and we're
going to run npm install and that should
set up all of those dependencies for us
ok so that's that now let's go ahead and
we can close this up and let's create
our app GIS file ok so this is our main
server entry point file and the first
thing we want to do is bring in all the
modules that we want so let's bring in
Express so your require Express we're
also going to use the path module
okay now path we didn't install with our
dependencies because it's a core module
so we don't need to do that alright
let's bring in body parser okay we're
going to want see what else course and
let's bring in passport and Mongoose and
that should do it for now okay so next
thing we want to do is initialize our
app variable with Express okay let's
also create a variable for the port we
want to use I'm going to choose 3,000
but you can use whatever you like and
then let's take that app variable and
we'll call listen which is going to
listen on whatever port we pass in so
we'll pass in our variable and then we
can use a callback now you can just do
function like that but I'm actually
going to use arrow functions I prefer to
use those so we're just going to do like
that okay and then let's just do console
dot log and we'll say server started on
port and then we'll just concatenate
that port number okay so let's save that
and then just this code here should let
us run the server so let's go over here
say NPM start because remember we added
that start script and now our start is
on port 3000 okay so if we go over here
and we say localhost port 3000 we're
going to get this cannot get slash and
we're getting that because there is no
route to the home page
to slash so just to get rid of that I'll
just create a row this is you know when
we're done this this URL is going to go
to our front-end index file but for now
we'll just put a route there still say
apt-get and slash and then our callback
which is going to take in request
response and let's just do res dot send
we'll just send some text and we'll se
invalid endpoint okay now if I go in and
reload it's not going to change that's
because we have to restart the server
now there's a module that I'm going to
install globally so that we can just run
it and we can make changes and it will
automatically update and that's called
node Mon so for that you want to do I
have to do sudo because I'm in Linux
Ubuntu and we're going to do npm install
- g for global and then node mod
okay I would suggest always using this I
use it with every application alright so
then we just have to do node long ok so
then it will watch our app and when we
make changes it will update so now we
get our invalid endpoint which is what
we want so far so code up to this point
we're bringing in all of our
dependencies we're initializing our app
variable with express we're putting the
port into putting the number into the
port variable we have one route to the
home page which we're just sending out
some text thing it's invalid but that's
not going to be used on the back end and
then we're just calling a listen
function which takes the port and starts
up our server so that's what we have so
far now I want to just add in our cores
middleware so that we can use that and
what that does is it allows us to make a
request to our API from a different
domain name okay because by default they
would get blocked if they try to do
certain requests so you can set it up
without using this module in fact I
guess I'll show you that so it's the
express tours and I think this is it
yeah so if we if you don't want to use
that cores module you could do this this
you could just add your own middleware
or just saying app dot use so we can add
a function here takes in a request
respond to next and then we're setting
ahead of red setter and we're saying we
want to allow access from any domain
that's what this is
you could put specific domain names or
ports and hair as well and then this
right here is just saying we'll accept
it if it has a content type header and
then you can also specify doesn't say it
here you can specify what requests you
want whether it's you know if you want
to accept delete and put requests get
posts and so on but the cores module
makes it so that so that we don't have
to do that so if we take a look at this
we required it already so all we have to
do is put in this app dot use course
and it doesn't for us okay so we can
just put that right here now there are
options for this if you want to take a
look at this page for instance if you
want to enable cores on a single row you
could do that you can see right here
they're just including it in the app
dock yet you can also add some
configuration options here you can set
the origin this accepts that it's
dynamic origin there's a bunch of stuff
you can do some of it I don't understand
but but that's all we need is that one
line because we're making this public so
that any domain can access it but we're
going to have authentication so that we
can basically disable some routes if the
user doesn't send along the correct
token so let's move on to the rest of
the middleware that we're going to need
so body parts are takes the middleware
and what body clocks are does is it
parses incoming request body so when you
submit a form or something like that
you can grab the data so we just need to
enable body parts or Jason so we'll put
that right under the cores let's put a
comment here say body parser middleware
okay so we want to do app dot use and in
here we just want to say body parser
body parts are Jason should add some
comments here as well
poor number and then this is just index
route start server now we're going to
use the Express router because all the
user routes I want to put in a separate
file I don't want to stick them here so
let's let's include that file up here so
we can do const users and let's set that
to require and it's going to be in a
folder called route or routes slash
users alright and then let's go down
here and let's do app dot use and i'm
going to have this go to slash users and
then just passing that users variable so
anything that is you know localhost
three thousand slash users slash
whatever will go to that users file okay
so let's create that will save this file
and then we're going to create a new
folder called routes and inside there
let's create a new file called users dot
j s ok this is going to be all of our
users routes so we want to bring in
Express
okay and then we also want to bring in
the router just a Const router equals
Express dot rather like that okay and
then let's put in for entry to the
register route so that we can take
router get so instead of app dot yet now
it's router yet and we want it to go to
users slash register okay since we're
using this users file when we do this we
don't want to put in slash users slash
register it's automatically going to put
that in so just do that okay and then
we'll put our callback will say request
or spawned next and just to test it out
we'll say res dot send register okay so
if we save that and we go to users slash
register see what I do router don't use
all we didn't explore it so down at the
bottom here you want to do module dot
exports and took that to router we want
to sport the router ok so now it should
work ok so now we get our register so we
might as well create the rest of the
routes because we really don't have that
many so we'll have a register we'll have
our authenticate
okay change this and see what else we're
going to have we're going to have a
profile route and this is one of the
routes we're going to protect with our
authentication with our token okay so
this will be profile let's change this
to profile okay and then let's see I
also want to have a validate route so
that if we want we can check that way to
see if the user if their token matches I
can't remember if I actually use this
route or not but we'll create it anyway
okay so that's all we need for now so
let's save that and then we should be
able to go to for instance users let's
let's spell that right authenticate and
profile okay so we have our users routes
let's set the put this static folder so
we need a place to put our client-side
files and that's going to be our entire
angular 2 app when we're done with it so
we're going to set that so I'm going to
go right here and say step set static
folder file and we'll do app dot use and
let's see we're going to pass in Express
dot static
and now we're going to use the path
module so that we can join we want to
join current directory and here is where
we put what we want to call that folder
I'm going to call it public you could
call it client or whatever you like so
save that and then let's create a folder
called public get public and if we were
to put in here an index dot HTML and go
to our root you can see that that that's
what's loading say hello hello okay
but I'm going to delete that for now we
don't need it right now okay so now what
we're going to do is we want to call the
connect function for mangu so we can
connect to our database so let's go
right here and we're going to take that
mongoose variable and we're going to
call connect now right here is where we
need to put the location of the database
but what I'm going to do is create a
config file and we can put the database
in that so let's go over here and create
a new folder called config ok and then
we're going to create a file called
database dot j/s and here we want to put
module dot exports and we're going to
set that to an object and we're going to
have a database value here which is
going to be MongoDB won't go host and we
want to put in mongos default port which
is twenty seven zero one seven and then
slash the name of our database so I'm
going to call this mean off okay now
this is also where we want to put the
secret for our token okay I need to
define a secret which is just it can be
anything I'm just going to say your
secret
okay and you can change that if you'd
like so let's save that and then what we
need to do is require it in our App J's
file so we'll go right here and say con
con fig and set that to require and
let's see we're going to go dots meet
our quotes and then dot slash config
slash database and then right here we
can just say config dot database that's
what I called it right yep
whenever you put here so now what I want
to do is just put in something so that
it'll let us know if we're connected
then we're going to say Mongoose dot
connection dot on and we want to stay on
connected and then we can put a call
back I'm going to use an arrow function
and here looks a console dot log and
we'll say connected to database and then
let's go config dot database okay so
let's save that and now if we go over to
the console you'll see that we're
connected to the database I'm just going
to put some comments in here
and now we can also put in we can check
to see if there's an error if there's a
database error and to let us know what
that is if there is one
so we'll just change connected to error
and that's going to take parameter and
let's just say database error and then
we'll just put that our in whatever our
days okay
so we're going to go ahead and stop here
for this video and we'll continue in the
next now let's go over this real quick
what we've done so we brought in all of
our dependencies we're connecting to our
Mongo database we have the database
stored in the config file we're checking
for connection for an error and then
just logging that we're initializing
Express we're bringing in our users
folder from the routes folder which has
our user routes we have the port number
we're bringing we're calling our cores
middle we're setting our static folder
to public bringing in our body parser
middleware here we're saying we want to
use slash users for all of our user
routes we have our index route here just
to let the user know it's invalid and
then we're starting our server okay and
then in our routes we're bringing in the
Express router we're using that too to
define our routes just a bunch of get
routes actually you know what
authenticate should be post ok I've kind
of Keith should be post so we have our
routes for exporting the router and
let's see what else our public folder we
have our config database config file
with the database name our location and
our secret and that's pretty much it ok
so in the next video what we're going to
do is create our mongoose model for the
user we're going to specify the field
we're also we're also going to
encapsulate all the database
functionality within that model file a
lot of times people will put it in their
route but we're going to have everything
centralized into that one model file and
we'll call those functions
from our out okay will also implement
password encryption so that when the
user registers their password will be
encrypted and of course we're going to
implement passport which is going to
handle the whole token process along
with the JSON web token module okay so
that's it for now please subscribe to
keep these videos coming and and
hopefully your your coding along with me
and I'll see you next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>