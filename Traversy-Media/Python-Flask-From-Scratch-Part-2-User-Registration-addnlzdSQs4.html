<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Python Flask From Scratch [Part 2] - User Registration | Coder Coacher - Coaching Coders</title><meta content="Python Flask From Scratch [Part 2] - User Registration - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Traversy-Media/">Traversy Media</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Python Flask From Scratch [Part 2] - User Registration</b></h2><h5 class="post__date">2017-04-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/addnlzdSQs4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey what's going on guys welcome to part
two of the flask application that we're
building now in the last video we set up
the home page the about articles which
is pulling the data from a file now we
want to setup a database okay we're
going to be using MySQL so if you're on
Windows you can download and install
MySQL on its own or you could use
something like xampp or WAMP that is
going to give you minus 2 l Apache and
PHP and so on so you need to do that i'm
on linux so i'm just going to use my
package manager so i'm going to say sudo
apt-get install and we want to install
mysql - server and also the client which
is going to be Lib mysql what is it yeah
I live my SQL client - dev alright now I
already had that stuff installed so it
went quick you'll be prompted for a
password for your database for your root
user so just make sure that you remember
that ok so now that's done what I'm
going to do is go into SQL MySQL and
create our database and tape users table
and so on because when the user
registers it's going to go into the the
users table so let's see I'll clear this
out and we just want to say MySQL - you
I'm going to log in as the root user and
it's going to take a password so - P and
then enter and then you want to put that
password that you used when you
installed it so now we're in MySQL I'm
going to first just say show databases
ok so I already have a flask app so I'm
going to create a new database called my
flask app ok and then we're going to say
use my flask app database changed now we
want to create the users table so let's
say create table users
and in here we're going to put our
fields that we want so we want an ID
that's going to be an integer or an int
and we'll say the maximum characters
will be 11 we also want this to be auto
increment and we want this to be the
primary key as well all right so then
we'll put a comma next field is going to
be name that's going to be a varchar' a
variable character and let's say you put
some parentheses that's going to have a
max of a hundred okay the next one is
going to be username which will also be
varchar' and we'll say 30 for the max
for the username then we want password
our char and let's say 100 this is
actually going to be a password hash
it's going to be encrypted using sha-1
okay so let's see password I think
that's all email actually want to put
email before username so right here I'll
say email oops
varchar' let's do 100 and then a comma
okay then after the password we're going
to put in the register date okay and
that's going to be a timestamp and we
want to set the default for this to the
current on the score timestamp that way
we don't have to worry about it it'll
just get put in automatically all right
so let's go ahead and run that and now
we'll do I would say show tables and we
have a user's table if we say described
users there's nothing in it okay good so
that's what we want now there's a few
things that we need to install
using pip so I'm going to just stop the
server for a second here control C and
then let's clear this out and we want to
install flask mysqldb that's the the
module that we're going to use to
basically communicate with MySQL so
we'll say pip install MySQL deep flask -
my SQL DB okay in addition to that we
want WT forms which is a module to help
us with that form validation different
types of fields and so on so let's say
pip install and that's going to be flask
- WTF alright and then we also want to
install pass lid which is going to help
with hashing our passwords so pip
install pass lid okay so now that's done
let's go ahead and just run our app
again so python app dot pi okay
everything's still working and we're
going to start to work on the
registration so I want to just first
import some stuff up here in addition to
this stuff from flask we want to include
flash which we can use for flash
messages redirect and that will
obviously handle redirection we also
need URL underscore for we want session
and let's see is that it all logging
okay so that's all stuff we want to
bring in from flask and then we want to
import flask - QLD B so we'll say from
flask underscore mysqldb we want to
import
my SQL all right and then for WT forms
will say from WT forms that right yeah
we're going to import form and then each
type of fields we're going to use so
string field text area field password
field and then validators okay and then
let's also import the path Lib hash so
we'll say from past live dot hash we
want to import shot 256 underscore crypt
okay that's good that has to do with
encrypting our password so now that we
did that let's go down and let's create
C we're going to have to create a
register register route as well as the
form class so I'm actually going to go
to the WT forms documentation and right
here the form class what we have to do
right here we need to create a class for
each form so let's go right here and say
class register form and let me see we
need to pass in form as a parameter okay
put a colon and then we want each field
okay so we want a name field
so we'll say name equals string field
and then in here we want the readable
version which will have an uppercase n
and then we want to include the
validators so say validators dot length
so it should be an uppercase L
and then we can set the minimum will set
equal to 1 and then the max will set
equal to 50 for the name okay next we'll
have user name that's also going to be a
string field and C validators dot length
and for that we're going to do minimum
four and maximum let's do 25 for the max
okay so name username we need email
string field email that's going to have
validators dot length min we'll set to
so you'll set it to 6 and then max will
set to 50 all right so now the password
which is going to be password field okay
so for this we're going to have a couple
validator so let's put a space here so
we want validators dot and I'm gonna say
data required okay and then we also want
this to we're going to have two fields
one will be a password one will be a
confirm and those need to match so let's
say validators dot equal to and it's
going to be equal to a field called
confirm and then we can put a custom
message will just say passwords do not
match
all right and then finally we'll have a
confirmed field and set that to a
password field and it'll just say
confirm password for the label okay so
that should do it as far as the class
goes now we need the route so I'm going
to put that directly underneath it so
app dot route and this is going to be
slash register now with this route by
default all of these routes they accept
get requests which is basically just
going to the page and loading it but
this one we will also want post requests
to be accepted because we're going to
submit our form to this so for that we
need to describe methods and set that to
get and post whoops okay so it'll accept
gets and posts and then just like with
the other ones we need a function call
it register oops
and let's see we're going to create a
form variable and set it equal to the
register form that we just created okay
and that's also going to take in or
quest dot form now request is something
that actually needs to be brought in I'm
not sure if I did it no I didn't
so in here anywhere I'm just going to
say request okay
so registration form let's see what else
are we doing here now we need to check
to see if it's a post request or a get
request to this route so for that we're
going to say if request dot method is
equal to post and we also want to make
sure everything's validated so we're
going to say and form validate okay and
then if it's a post we'll go on to to
register the user and all that but I'm
not going to do that just yet I'm going
to just go back to the same level as the
F statement not inside of it and we want
to render the template so we want to
return
render template and it's going to be the
register dot HTML and we just want to
pass along the form values so just like
that
okay we're passing this in to our
template so let's say that we'll come
back to this right here to what we
actually do when the user submits the
form and we're going to create in
templates a new file called register dot
HTML all right and just for now i'm just
i just want to test it out so let's just
save that and let's see we'll go I got
to start the server back up actually
what's this I have a error return render
template
return render underscore template
expected an indented block all right
let's just do return actually will
return the template in here I guess as
well okay so now it started okay so if
we go to slash register there we go so
we know that that register route is
working all right so let's see now I
guess what we'll do is create the actual
form so let's go to register HTML and
I'll just bring in I'll just copy home
or one of these doesn't really matter
paste that in and get rid of this stuff
okay let's put in h1 and we'll just say
register and now we want to do is create
the forms so let's put in our form tag
that's going to have method which is
going to be post because it's going to
make a post request and then we can
leave the action blank it'll
automatically submit to the register or
to this file okay and then in here we're
going to create a div and give it a
class of form group which is a bootstrap
class and then we're not going to
actually put the input tags in right in
here we're going to use the WT form
syntax which is going to be render so
render underscore field and this is
going to be form dot name and then if we
want to add a class we can simply add
another parameter here and say class and
then we're going to use this underscore
equals and then the class name which is
going to be form control all right and
then we'll just copy this whole div
he's been in a couple more times so this
next one will be username this one will
be actually let's do email and then
username okay then we want a password
and then confirm okay and then we need a
button at the bottom so I'll just put a
paragraph with an input type will be
submit value will be submit and we don't
need a name I'm also going to add a
class of BTN and then BTN primary which
is a bootstrap class all right so that's
our form now we also need what's called
a form helper and that's going to define
how each field looks whether it has a
label or if you want to add extra
classes or whatever so inside of
includes we're going to create a new
file called underscore form enough form
template form helpers dot HTML ok and
what I'm doing is I'm using the default
one that's in the documentation let's
see if I can find it
I know it was it was a bitch to find
before
yeah I don't know exactly where it is
but I'm just going to paste it in you
guys can just copy it it's actually in
the form of a macro so we have this
macro render field and then the label
will be shown and then we have this
weird stuff this kwargs safe exactly
sure what some of this stuff is and then
if there's an error it'll display that
error and I have it in a span with the
class of help in line so that's a
bootstrap class and then the error will
show
directly underneath the field which is
nice so let's save that and let's go
back to our application render field is
undefined okay so we actually have to
include this the form helpers partial
that we that we created so we're going
to do that right above the form tag and
we can just say include and that's going
to be actually no we're going to do from
include slash underscore form helpers
dot HTML and we want to import import
render field all right let's try that
there we go all right looks like the
class form control is not is not
rendering Oh missing an S on class
there we go okay so that's our register
form if we try and submit you'll see
that we get the errors spit out right
underneath the field all right so I
think that's really cool how they do
that and how it's so easy to to add
fields and stuff and validation so now
that we did that we want to handle the
submission okay so let's go to app dot
pi go down to our register route here
and we want to we want to work inside
here okay because we're saying if the
request is post meaning if this if the
form is submitted then what do we want
to do actually you know what we need to
set up my SQL first we didn't include
the the configs it doesn't know what
database to use or any of that so let's
go up top and let's see we're going to
go right here and let's say config MySQL
so we can take our app variable and say
dot config and in here actually this
needs to be brackets and then this will
be MySQL underscore host and we'll set
that equal to localhost localhost and
then let's say we're going to do I'll
actually just copy this so host then we
have user which is going to be root and
let's see what else password you want to
use whatever you chose for a password
and then DB so the database you want to
use which is my flask app unless you
called it something different and this
last one is going to be cursor class
okay so basically when we when we work
with flask mysqldb it let me just pull
up the documentation because it's
a little hard to explain the flask SQL
DB alright so you'll see right here so
this is an example so we're creating a
cursor using the connection cursor and
then using that cursor we can call
methods like execute where we can run
our queries all right so it's kind of
like a handler so what we want to do is
by default this is going to return a
tuple which is a certain type of it's a
certain data type in Python we want it
to return as a dictionary which is
basically kind of like a hash and rails
or an associative array in PHP or a
JavaScript object it's closer to that
with key value pairs so what we want to
do is set the default cursor class to
dictionary so we can actually do that by
saying actually let's do dict
why is this finally this isn't working
dict cursor like that and I believe yeah
that should just work automatically I
don't think I have to import anything
for that okay so now we have all the
configs we want to initialize - ql oops
all right so we want to say MySQL and
we'll set that equal to MySQL and then
we just want to wrap up the app variable
so now we can use this to create our
cursors and make queries now I'm going
to save this
make sure there's no errors okay and
then we're going to go down to register
to the this right here all right so if
it's post then we will first want to get
the form values we'll put them in
variables so we can get it from form dot
name dot data oops
shut that off okay we also want the
email form dot email data username else
password so password form password dot
data now the password we need to encrypt
before before we submit it okay
so we're actually going to wrap that
we're going to wrap the plain text
password in sha-256 script oops ok like
that and it's actually going to be
sha-256 script dot encrypt and then this
should be wrapped in STI wrapped in the
string function I think that should do
it okay so now yeah so now we're going
to create the car sir and we can do that
we'll create a variable see you our curl
and set that to MySQL dot dot cursor
okay so now we can use this car so to
execute commands so let's say car dot
execute and we want to execute an insert
statement so let's say insert into users
and then the fields which will be name
email username password okay and then we
want values okay now we're going to be
using string replacement so we're going
to put this
or fields so we want 4 % s signs ok so
these are just going to get replaced
with what we put here next so we want to
put a comma right here and then the
fields so I'm going to open up another
set of parentheses and going to say name
email username password ok so these are
all the variables that we assigned up
here ok we want to insert all that data
into the database I'm just going to turn
on rap there we go toggle soft rap so
that'll make it so that you guys can see
everything no matter how thin the window
is so that that's the execution now it's
not going to do this yet until we commit
so let's go down here and say commit to
DB for that we're going to take my SQL
dot connection and call dot commits
alright and then finally we want to
close the connection and we can say car
dot close all right now I also want to
set a flash message once we're
registered so we're going to say flash
and then in here we're going to put the
message and we'll just say you are now
registered to fill that write registered
and can log in now with flash messaging
we can also create categories this is a
successful message so I'm going to say
success alright and then finally we want
to redirect we don't want to render the
template here so I'm going to get rid of
that and then we'll say redirect and
when you redirect you have to use this
URL for
okay and then in here we can put where
we want to go which will be index okay
so I think that's good let's save it now
for the flash messaging this is where we
initialize it but we need a place for it
to basically display inside of our
template so what I'll do here is is
create another include so templates
includes and this is going to be
underscore messages HTML and then in
here we need to write a bunch of crap
for the messaging so we'll say with
messages actually let me see if I can
just find it in the documentation okay
so let's see
so they initialized it here and then we
need to do this but we're using category
categories so we'll go down to flashing
with categories and just grab this
alright and then we want to change this
we don't want these to be in a ul we
want it to be in a div so right here
will say div and then the class is going
to be we're using bootstraps so alert
and then we want alert - oops - and then
whatever category we pass in we said
success so it'll be alert success
now with bootstrap if you want to be
read it's going to be alert danger so
you want to pass in danger as the
category alright hopefully that makes
sense so let's go ahead and save that
and then we're going to put this out in
the layout I guess we'll go like right
above the block here alright and then
we'll just say include include slash
underscore messages dot HTML okay so
let's make sure everything still works
I'm just going to restart the server
okay and let's see with let's add a
register link up here and the on the
right so we'll go to our nav bar and
then let's see I'm just going to copy
this URL I mean this ul and then just
add a class of nav bar right and then
this will be register
all right so let's save that register
click on that good so at least it loads
the form ok there's no errors and just
make sure everything is all set and yeah
so all right let's try it out see 1 2 3
4 5 6 submit the Seto
the session is unavailable because no
secret key was set so in order to use
sessions we need to just we need to just
set a secret key so let's go in our app
PI down at the bottom or you could put
it anywhere really so yeah I think I can
put it here so if I say app dot secret
on the score key and I'm just going to
set that to I don't know secret one two
three should probably be more secure
than that but that should work 3 load ok
so I don't think I ended a div or
something let's go check out messages
okay so this is ending in an Li but
aside from that I think everything went
ok so let's see if we actually
registered will go into my SQL and let's
say describe users not describe users
let's do a query say select all from
users ok so oh it went in twice it looks
like not sure
oh it went in the first time and then I
reloaded and it went in again but that's
fine let's let's actually try to
register again just to make sure that
it's not going to do it twice all the
time
passwords don't match okay you are now
registered and can login so let's go
back to MySQL and again we'll do the
Select and John Doe is only in there
once good so you can see that this is
the name the user the email the username
and then this long hashed password and
then the date now when we submit our
form I want this to redirect us to the
login form so let's go Alex GAD for some
reason this didn't work and that's
because I didn't return it and let's see
I'm not sure where I wanted to go so
they register I would imagine we'd want
them to go to the login page so let's
change that to login and that should do
it so we can now register users
hopefully that wasn't too too difficult
or hopefully I explained it's good
enough but um that's going to be it for
this video guys in the next video we're
going to implement the login where we
can you know go in and compare the
username and password make sure it
matches and it'll let us in and we'll
create the dashboard alright so thanks
for watching guys please subscribe if
you're not already and that's it I will
see you next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>