<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>CakePHP 3.1 Login &amp; Registration From Scratch - Part 1 | Coder Coacher - Coaching Coders</title><meta content="CakePHP 3.1 Login &amp; Registration From Scratch - Part 1 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Traversy-Media/">Traversy Media</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>CakePHP 3.1 Login &amp; Registration From Scratch - Part 1</b></h2><h5 class="post__date">2015-12-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/747K6W40ur0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys welcome to another video series
this is going to be on CakePHP and we're
going to be creating a login
registration system all right now we're
using cake version 3.1 and let's go
ahead and get started now as far as an
environment you're going to need in a
well you don't need an Apache server
there's other servers you can use but
it's definitely recommended and if you
are on a local machine and you don't
have server up and running you can use
something like zamp or our xampp as it's
also pronounced that's what I'll be
using and it gives you an Apache server
mariya DB which is just a drop-in for
MySQL and PHP alright so it gives you
everything you need to run CakePHP so I
already have it installed but I actually
have a video showing you how to set it
up but it's really easy you can go ahead
and download it for Windows Linux or Mac
so get that set up once you do you'll
have this zamp control panel alright you
can see we have a patchy running we have
MySQL running and the next thing we're
going to need to do is install composer
okay now composer is a dependency
manager for PHP and we can use it to
install and setup CakePHP alright so
that's the first thing we're going to do
is install composer so if we go to
getting started there's a whole bunch of
information documentation there's a few
ways to install it you can use curl if
you'd like
we don't have curl so we're going to be
using just PHP okay which is this
command right here so we want to grab
that and go into our command line or
shell
zamp has a really handy button right
here just to take you right to your
command line now htdocs is going to be
the server root so let's go into htdocs
and we're going to want we're going to
want to install composer here so that we
can just generate applications right in
the server folder all right now to
install we're going to paste that look
that command and run it alright now we
created a file called composer dot far
Phai
and that's what we're going to want to
use to run it all right you can see it
says use it PHP composer dot far alright
so let's go ahead and do that Apple to
say PHP actually won't let me make this
we make this a little bigger for you so
you guys can see it let's see properties
there we go alright so PHP composer dot
far and then we're going to what is it
create project great - project and then
you want to add this flag prefer - dist
and then we want to say cakephp slash
app and then whatever you want to name
your app let's just call it my login and
that's going to go ahead and generate
the application and create my login
folder right in your htdocs alright so I
have quite a bit of different folders
here but you can see my login and we'll
just wait till that's done
all right so it's going to ask about
setting folder permissions I'm just
going to say yes and now it should
create that folder so let's go CD my
login and let's see if we can go to
localhost / my login
and there we go so this is the cakephp
landing page now you'll notice that we
get we have all checks which is good
this one is going to be an X because we
didn't connect to a database yet now I
do want to mention something if you're
getting some strange error and this
isn't showing it might be because yo you
don't you have you don't have an
extension enabled that should be enabled
so if you get that just try this go into
zamp or xampp and then PHP and then PHP
dot ini' and you're going to want to
just search for int el alright in this
extension right here you want to make
sure that's enabled and to do that you
want to just remove the semicolon in
front of it alright because if you don't
if you have this disabled you may have
some problems alright so do that and
then just save it alright and then go
ahead and try again
alright so let's go ahead and set up a
database so to do that we're going to go
to localhost / PHP myadmin
and we'll go to databases and create a
new database we'll just call this my
login all right and we're going to want
to create a users table and let's say
six fields all right so we're going to
want let me just make this a little
wider okay we're going to want an ID
that's going to be the primary key we
also want it to auto increment so you
want to check that AI and make sure this
is primary
okay next we'll do a name that will be a
varchar' of let's say 100 okay we'll
have an email that will be a voucher of
255 let's just make them all 255 ok
we'll also need a password and we'll do
255 and we'll need let's see let's do
created oops
which will be a date/time field
which is right here and also modified
which will also be a date-time field
okay so that looks good to me let's go
ahead and save that
all right and I'm also going to create
another table called post all right now
I'm not going to make a full blog here I
just want something else
aside from users okay so when we log in
we can see at least we have something
else to look at
okay so posts let's say six and this
will also have an ID which will be the
primary key in Auto increment and then
we'll have a post title which will be
varchar' 255 body okay body is going to
be text and we're going to want a user
ID so we're going to say user underscore
ID that's going to be an int and that's
actually if going to be a foreign key
for the users table and then we'll do
created which will be a date/time and
then modify
all right so we'll save that and that's
going to do it for our database so now
what we want to do is go back into our
command line and actually not before we
do that we need to connect our database
so in sublime text and we're just going
to link the project folder which is in C
Drive
samp htdocs and my login alright now the
file you that you want to configure your
database in is in config and then app
dot PHP alright we're going to want to
go down to where it says data set I'm
sorry data sources and I'm going to
change the user name to the database
username and your database password and
the database name alright so save that
and now if you go back to the landing
page and reload you can see that we're
connected to the database
get that out of there so now we can go
ahead and close that config file and I'm
going to go back to the command line now
we're going to run something called bake
which is it's basically a code generator
or a scaffolding tool it'll go ahead and
set up our users controller model
templates as well as our posts so what
we're going to do is save in now if
you're using Windows like I am you're
going to want to do a back slash so bin
slash cake then bake all users
okay and that's going to go ahead and
run and I'm going to do the same thing
except we're going to say all posts okay
now if we go back and we look in the
source SRC folder that's where all of
our files will be working with that and
we look in controller you can see we
have users controller and we have post
controller okay those were just created
in the model we have post table users
table in the view not the view of the
template we're going to have a posts
folder and users folder okay so that's
all set up for us and it actually should
have set our routes up too if we go to
config routes and go down actually it
doesn't set them up but if they should
work just from using the correct naming
conventions so if we go to slash users
okay so this is the interface that it
gives us which is kind of nice and we
can create a new user we can list posts
we can create a new post but we're not
going to focus too much on this this is
just the interface I want to focus on a
login access control and registration
all right so the first thing we're going
to do is from here we're going to add a
new user all right
so name
and email email I'm just going to say
test at test comm and password submit
okay that creates a user now you'll
notice that the password is plaintext
and that's how it's stored in the
database which is not safe at all all
right so if we go to the database we go
to users and see the password is just
one two three four all right so we need
to hash that password we need to encrypt
we can do this in the model when I go to
the model folder and then to entity and
then user PHP all right so this pertains
to a single user while the users table
pertains to the entire table so what we
want to do is just add on to this and
I'm going to say protected function and
we want to call this underscore set
password and by using this convention
this is actually going to run when the
user is created when the password is
created all right so I'm going to pass
in password and then we just want to
return new and then we're going to
instantiate the default password hash or
object so default password hasher and
then we want to use the hash method
method I'm going to pass in
password alright and that's it that's
going to hash the password so let's
close that now let's go back to our
application and reload and now we're
going to edit this and you're going to
want to use something different don't
use the same password alright paste that
in and submit oh we need to include the
hash the password hash er into the
entity user folder or file so we're
going to go up here and we're just going
to do use cake slash auth slash default
password and hasher alright and that
should fix that
so let's go back try this again submit
and now you can see the passwords
encrypted so if we go to our database
now it's this long hash all right so
that's going to secure our passwords now
what we're going to want to do is create
a logging action in our controller so if
we go to controller and then users
controller and go down to the bottom and
we're going to add a login controller so
we'll say public function login and then
before we add anything here let's save
it and we're going to want to create a
template so we're going to go in our
users folder and say new file save it as
login dot CTP CTP is cake template and
we're going to create our form now by
default we're using foundation as a CSS
framework so I want it to match what we
have here so we're going to add a couple
of classes
okay so we're going to say class equals
index large for so we're going to use
the column system that foundation uses
medium for large offset for okay I want
it to offset because we want this to be
in the middle of the page all right then
we're going to do medium offset for and
columns all right and then in here let's
add a panel
all right and then we're going to have
an h2 I'm going to want it to align to
the center
so we'll say text center want to do that
and for the text we'll just say log in
and now we're going to do the form and
we're going to use the the form helper
that cake offers alright so we need our
PHP shorthand tag and then we're going
to say this form create so that's
basically just going to create an
opening HTML form tag alright and then
to end it down here we'll say this form
end
all right and then we're going to use
our inputs so we can say this slips this
form input all right and then we just
want to pass in the field name which
will be email
copy that and then this one's going to
be the password
okay now the default type is text so for
this we need to specify that we want to
use a password field so we can pass in
an array of options and one of those
options can be type all right and then
finally we need a button so we'll say
this form button I'm sorry submit all
right and in the submit we're going to
put login and then we have an array I
just want to have a class
okay class is going to be button all
right so let's save that and see if we
can go to a users slash login and there
we go let's actually move it down a
little bit so we'll just put just put a
line break here
now CakePHP comes with an authentication
component so that's what we're going to
be using so we need to enable that and
we can do that in controller app
controller
all right this app controller is
extended by every other controller so
it's always going to run no matter what
page you're on and you can see right in
the initialize function this is where we
load components so we're going to add to
this and we're just going to say this
load component and we want to load the
auth component all right now there's a
bunch of options we need to configure
here which is just basically a series of
arrays nested arrays so this is going to
be authenticate and that's going to be
pointed to another array and in there
we're going to say form which will go to
an array and this will be fields which
will go to another array and we'll
specify our fields here all right so the
username we don't have a username field
so we're going to use our email and
password is Supes
is going to be the password field okay
and then we want to go where are the
authenticate ends right here put a comma
and specify login action actually this
needs to be in quotes alright and then
we're going to specify the controller
and for us it's the users controller and
we want to specify the action and action
is going to be the login action that we
created all right so that should do it
so let's save that
and now if let's see if I try to go to
the route you'll see that it's not
letting me it's going to automatically
block all routes and just bring us to
the login form so now let's create the
login action so we want to go into the
users controller back to our login
function right here and first thing we
need to do is test to see if the form
was submitted so to do that we can say
if and we're going to say this request
is and we want to check for post
requests okay because when the form
submitted its submitted as a post all
right if it is a post then we're going
to create a user variable and I'm going
to set it to this this auth identify
alright and then we're going to check
for a user
okay so if user
then we're going to set the user okay so
basically if the login passes then we're
going to say this lot set user all right
and then after that we want to redirect
actually we need to return return this
redirect okay and then we can pass in
the action that we want to be redirected
to which will be posts
I'm sorry not the action the controller
controller posts alright now if it's a
bad login if it doesn't pass then we're
just going to set a message so we can
use the flash component and we'll send
an error okay and the error will just
say
the correct login alright and that
should do it so let's save that and
let's go back here and let's just try to
put anything in here we do need an email
address okay you can see up here we get
incorrect login alright if I go and do
the correct login okay so it let us in
but let's say set undefined method set
let's see he uses controller 111 this
offset user oh it's supposed to be set
user like that
there we go okay so now we're logged in
so now let's quickly create a logout
function alright so I'm going to want
the logout link to be up here to replace
those so if we go to template and go to
layout and then default this is the
rapper that's wraps around all of our
views and this is also where the
navigation is you can see it right here
so what we're going to do let's get rid
of one of these and let's change this to
logout and we're going to get rid of
this target attribute actually you know
what we're going to do is we're going to
use the link helper alright so to do
that we're going to say I'm sorry it's
the HTML helper but it's the link method
so this HTML link
all right and then here we want to the
text to say Lago and then we want to set
the controller to users and we want to
set the action to log out all right now
we need to create that log out action in
the users controller okay
and all we're going to do here let's
copy this flash message and we're just
going to change error to success
it'll say you are logged out all right
and then we just want to return the
redirect okay we want to redirect to
actually what we want to do is get rid
of that completely and say this off
logout all right so I'll save that okay
let's see click logout and there we go
you are logged out so in the next video
in the next part we're going to
implement a registration form so that a
user can register and we're also going
to want to hide this this logout link
when we're logged out because that
doesn't make very much sense</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>