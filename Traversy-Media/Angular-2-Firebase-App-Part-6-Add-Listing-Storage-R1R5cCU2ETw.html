<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Angular 2 &amp; Firebase App [Part 6] - Add Listing &amp; Storage | Coder Coacher - Coaching Coders</title><meta content="Angular 2 &amp; Firebase App [Part 6] - Add Listing &amp; Storage - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Traversy-Media/">Traversy Media</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Angular 2 &amp; Firebase App [Part 6] - Add Listing &amp; Storage</b></h2><h5 class="post__date">2017-03-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/R1R5cCU2ETw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys welcome to part 6 of the
property listings angular to firebase
application in this video we're going to
be making it so we can add a listing to
to firebase I'm not sure if we're going
to get to the image upload part we might
have to do that in the next video now
I had a comment in I think it was the
last part and someone mentioned that if
you go to the listings page or the
single listing and you reload it messes
up so basically what's going on here is
that it's loading the page before it
actually gets the data the listing data
so this is actually a really easy fix
all you have to do is go to our
components go to the listing component
listing component HTML and then we're
going to just going to wrap this in a
div and we're going to use the ng-if
directive and we're going to say if
listing okay so basically it's going to
check for that listing before it tries
to load it and then just close the div
down here tab that over and save and now
if we go to a listing and we reload it
shows up okay so it's not breaking
anymore
so I'm thank you to the person that
mentioned that in the comments all right
so now we're going to do is this add
listing page we need to put a form here
so let's go to our component and then
add listing I want to go to the HTML
file now I'm just going to paste in the
form I don't like the copy and paste but
we're just putting in the mark-up here
there's no dynamic code basically we
have a back button which will add a link
to we have our form then we have our
different form group divs okay that's a
bootstrap class and a title then the
input and make sure you have the name
attribute on each one of these as well
so they also have title city owner
bedrooms then we have type which I just
have a simple drop down here and then we
have our image file so make sure you put
type file here and then the price
so we're going to just add a little bit
of dynamic code here for the back link
we're going to put in router link and so
that equals put some brackets in there
and then listings okay actually it's do
slash listings and then for the form for
the form tag here we're going to put a
submit event so let's just that equal to
a function called on add submit okay now
each of these inputs we need to
basically bind it to the klappa
component property so to do that we need
to use ng model and since ng model is
two-way we need to use brackets and
parentheses okay then we'll say ng model
and we're going to set that equal to
title all right now your ng model should
match whatever your name attribute is
alright let's go ahead and just copy
this paste that in change this to city
and so the owner bedrooms and select
this will be the type and we have the
image now the image I'm not sure if we
actually need to do this but we will
anyways so that'll be image alright and
then file any of the price okay so let's
say that and now it's going to our
listing component I mean our add listing
component TS file now in the mean stack
video I'm sorry the mean stack series we
created a validation class and you can
do that now if you want I did get a
comment from somebody saying why bother
with that why not just put required in
the HTML you know with html5 and you
could just as well do that you don't
have to have a validation class on the
client side but it does make things a
little bit more scalable if you want to
add other types of validation later on
but for this video I'm not going to do
it again so that's just exactly what I'm
going to do is just put in required for
these these fields okay so just just do
that and it's up to you what you want to
make required or not I'll just I'm just
going to do everything
not the image though all right
and you can see our form over here
correct so if we try to submit we're
just going to get these html5 validation
alright so what we want to do here is we
want to bring in some stuff we want to
bring in the firebase service okay
that's going to be from and we're going
to levels up dot slash dot dot slash
services slash firebase dot
and we're also going to bring in the
flash messaging actually I don't know if
we need that just yet I don't know if we
need that in this in this component so
let's not do that yet let's bring in the
router
okay and let's see now all the ng models
we created we need to create properties
for so let's go right above the
constructor and put in title and I'm
just going to give these the type of any
you can be more specific it's more
specific if you want but I'm just going
to do that okay so we have owner we have
city what else bedrooms and price and
type and image okay so there's our
properties what's going on here all
right now we need to inject into the
constructor parameters our dependencies
so we have do private firebase service
and I'll set that to capital F firebase
priority service and let's see what else
router is a private router and think
that's good for now and then we need to
create our on add submit function and
just test it out let's do a console log
and let's blog let's say this dot title
say that let's go ahead and try it out
so we'll just say test I'll just say
test for all these
please into our number
okay let's open up our consult of 12 and
we get tests good so we know the form is
at least submitting now we want to do is
create an object with all of the fields
that are submitted so let's do lek
listing and we'll set that to an object
and then let's put in the title which
will be this doc title since we use ng
model that is binding those fields to
these properties okay and then we're
just creating an object with those
properties so city this doc title owner
let's start owner and what else bedrooms
and price and type okay so there's our
object now what we need to do is we need
to call we're going to create a function
in the service called add listing so
let's go down here yeah after the object
and we'll say this start firebase
service dot add listing and then we're
going to pass in that listing object
okay and then after that we'll go ahead
and redirect so we can say this dot
router dot navigate and we're going to
navigate to
- what things okay so we're getting this
error because we haven't created this
yet so let's save this now you may have
noticed that we're not dealing with the
image at all and that's because we're
going to do that right from the service
we're going to grab the element and then
we're going to create a reference and
upload it through there so let's go to
our service and we're going to create
add listing okay that's going to take in
that listing object now uploading image
is is kind of tough to wrap your head
around and firebase at least for me this
documentation page is really helpful
basically we need to create a storage
reference so we shut this to firebase
storage and then storage rough okay and
then we need to create a variable and
set it to the storage ref child and it's
kind of difficult but let me just I got
a full example down here but let me just
show you
so in add less thing need to create
route reference so we're going to say
let storage storage ref set that to
firebase firebase dot storage dots ref
and so make sure we brought that in we
haven't so we need to bring in the
firebase module so to do that we're
going to do report all add firebase from
fire base okay and then we're also going
to have the folder as a property of this
class so right here would say folder and
I'm just going to set that to any okay
so then we can access it with this dot
folder now in the constructor we can
assign the folder name so we'll say this
start folder and we'll set that equal to
let's say listing images okay so that
will be the folder name on the firebase
side and then back down to our add
listing so we create a root reference
and then what we'll do is we're going to
do a loop and search for the HTML
element that has that has the ID of
image which if we look in our form right
here this input has an ID of image so we
kind of we have to kind of latch on to
that so let's do four okay so say four
and then let's do let selected file of
and then we're going to put in right
here some brackets and we're going to
use parentheses and then HTML input
element
okay so we're typing this to an HTML
input element and then we're just going
to say document dot get element by ID
and has the ID of image
all right and then right here we're
going to do dot files and it's going to
be the first one it finds which is the
only one so it's going to be at index
zero okay and now within the for loop
we're going to say let's pass and then
we're going to set this to let's use our
rickety things called
ticks ok so inside here we're going to
say slash and we're using a template
literal so when you do that you want to
use a variable use this money sign and
then these curly braces so we'll put in
this dot folder and then slash and then
select the the selected file name so
selected file dot name ok so that's
going to be the path it's going to be
whatever this is which is listing images
slash and then whatever that file name
is okay so then we have to create a
variable called I ref and we're going to
set that to storage storage ref child
see is that right yeah and then we pass
in the path all right and what we're
doing here is this right here storage
rough child okay so pointing to that and
then what we'll do is take that I ref
variable and we're going to call dot put
and then in here we want a selected file
okay and then we're going to do dot then
because that gives us a promise so dot
then and then in here let's open up
another set of parentheses and put in
our snapshot parameter set that to a
code block
and then here we can say listing dot
image equals that selected file dot name
okay and then we'll set listing dot path
set that to the path that way when we
save it in the database we'll have the
image name as a property we'll also have
the path okay and then we just want to
return this start listings dot push okay
and then we're going to pass in the
listing and that will save everything to
the database it will save all the files
all the information from the form it'll
save the image the image name and it
also saved the path to that image
alright so I know that that's that's a
little tough to understand and I
actually have a hard time with it first
alright and if you guys know of an
easier way to do this please leave it in
the comments but this is the only way
that I could find that actually works I
mean you could have just as well used
just a local file you know just upload
it to a local folder but I wanted to do
I wanted to integrate it with firebase
all right so let's save make sure that
that's saved and we should now be able
to update or add a listing so let's go
to add listing ok and see
we'll just say awesome mansions already
have that no all right so they awesome
mansion City and Miami owner the Bill
Gates bedroom 16 type will be a state
let's choose an image choose mansion
five and then price with the 20 million
all right so let's cross our fingers and
submit and there it is click on it ok
now we haven't added the functionality
to actually show the image but we can
see we are able to upload now let's go
to our fire rates console and let's go
to storage
I might have to real aughh in here
and there it is there's our listing
images folder if we go in there we have
mansion five so everything worked out so
I'm going to just close these up and
then what I want to do is delete the
initial listings that we have because
the path for the image is incorrect so
let's go to our console and go to
database and we only want the one that
we uploaded from our application which
is this one here awesome mansion so this
one we can delete and this one delete
that and this one because you can see
the path here is image slash mansion
that's not right it's the listings image
and that was just basically test data
anyways okay so now we need to go back
to our listing component ts file and
need to import firebase so if they
import all as firebase from firebase and
then down here where I have this to do
we're going to set the reference to the
image just like they did here see where
is it so we want to do this create
storage records from our storage service
and then a child reference all right so
let's replace this and we'll do the wet
storage ref and let's set that equal to
firebase dot storage dot ref and then
we'll create a variable called space ref
put that to that storage ref variable
dot child and then we're going to pass
in the path which is going to come from
the lifting above okay
it's coming from this right here which
comes from the gate the get details we
can get rid of this console log all
right let's see yeah this should
actually be a dot not a slash
I'm not sure why that path is underlined
that's kind of weird um you know what
let me let me actually console.log that
out I want to make sure that listing
actually has a path which it should save
and then we'll go to a listing and look
at the object here and it does have a
path so I'm not sure why we're getting
that oh well see if it actually causes
an issue all right so then what we want
to do is going to take that storage
reference and when it's a dot child
listing dot path and then we need to do
dot get download URL because we need a
reference to the image to put in the
source attribute and then we're going to
do dot then and let's see we'll pass in
the URL set that to a code block and
then we're going to set the image URL so
this dot image URL equal to URL all
right now we already have image URL up
here that's good now we can also if
there's any errors we can catch them so
right here we're going to say dot catch
and let's put
ever and then we'll just um I guess
console dot log if there's an error okay
so we're still getting this error for
this PAP and munch or Y anyway let's try
it we'll save it and then we need to go
to our template our listing component
HTML where we want to put the image and
we should be able to put that in right
here so let's do image I'm going to just
give it a style of width of 100% and
give it a class of thumbnail and for
source we're going to set that to the
image URL
alright let's save alright so there it
is it shows up
cool
so before we go I just want to try and
add one more say pool mansion city and
Monica owner say say Steven Tyler
bedrooms ten type estate image price say
12 million submit ok cool mansion and
there we go alright
so in the next video we're going to move
on to being able to edit a listing and
then as well as the legal listing okay
and then we should be done I may add
some extra features I'm not sure but
that's going to be it for now guys I
know this was a long one sorry about
that and that's it thanks for watching</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>