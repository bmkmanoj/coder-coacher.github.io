<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Node js With CouchDB | Coder Coacher - Coaching Coders</title><meta content="Node js With CouchDB - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Traversy-Media/">Traversy Media</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Node js With CouchDB</b></h2><h5 class="post__date">2016-11-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/R6LUMXrAoCE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys in this video I'm going to show
you how to use CouchDB with an ojs
application all right now this is kind
of a continuation from my CouchDB basics
video where we installed CouchDB we
created a database we connected through
curl and added some documents so I would
suggest that you watch that first but if
you don't want to that's alright we're
going to just recreate the database I
already deleted the one we created it's
going to be the same type of thing we're
going to list customers so let's go
ahead and click create database and I'm
going to call this customers alright and
then excuse me what we want to do is
create a document so we'll say new doc
and we're going to add a name let's add
an email say Jay Doe at gmail and let's
do an address and the address is
actually going to be an object okay so
in this object will have a street Main
Street and the city and state
and that's good all right so there is
our customer let's go ahead and click
create document and now we have a
customer all right and if we click this
doc so we can see the rest of the fields
so I'm going to copy this and we're
going to create one more so let's say
new doc and put a comma here and then
paste it in and let's change this change
the address say Congress Street City
we'll say New York New York all right we
need the curly brace there as well for
the address all right so now we have
these two customers in our customers
database so we want to do now is create
a view all right so if we go to new view
and let's call this we'll call it all
underscore customers okay and then for
the index name let's just call it all
now this is going to be a Map Reduce
function although we're not going to use
the reduce and what this is doing is
basically it's going to emit a key value
pair so right now it's going to be MIT
the ID the document ID is the key and
then just the number one is the value
which obviously isn't very useful so
instead of the number one we want to
return an object with the different
fields so we'll say name which will be
doc dot underscore nope dot dot name and
let's do email which will be doc dot
email and we'll do address
which will be doc dot address all right
now I also want to add the revision ID
because when we delete it we actually
have to include the revision so we're
going to put another one called doc
actually not doc we're going to call it
Rev and we're going to set it to doc dot
underscore Rev all right so that should
do it let's go ahead and click create
and the Rev ID field I was I was talking
about is let's see right here all right
we need to add if we if we want to
update or delete a record or a document
so we should be all set as far as our
database so now we're going to go and
create the the nodejs application now
you will need nodejs if you don't have
it just go to node.js org and download
it install it and you should be all set
all right now I'm going to create inside
my projects folder I'll create a folder
called we'll call it couch customers
all right so couch customers and we need
to open up a command line okay and I'm
just going to navigate to that folder
which is in projects all right so we
need to create a package.json file so we
can do that with NPM in it and as long
as you have no js' installed you should
have NPM and let's just enter through
this description we'll say simple
customer list entry point will be apt J
s and then we can just enter through the
rest all right so that will create a
package.json file now I'm going to open
this with sublime
let's just snap that to the side there
all right
now what I want to do is install our
dependencies and we're going to be using
this node CouchDB package and it gives
us pretty good documentation on how to
use it how to create databases and
documents and so on all right so let's
go ahead and install our dependencies
NPM install and we're going to want
Express go download body posture ejs for
our template engine and node
- couchdb okay we're going to add - -
save at the end and let's run that
alright so that's all set now what we
want to do is create our app J s file
and I'm going to add that folder to
sublime so that we can access our files
quickly c-cups customers alright and
let's create a new file and save it as a
PA s ok now we're going to just bring in
some stuff let's bring in Express ok we
want to bring in body posture body
posture we want to bring in the path
module which is the core module so we
don't have to install it all right and
then we want to bring in the node
CouchDB ok so we're going to call this
node couch DB actually like that and we
want to require
coach TV alright and if we look at the
documentation I'm just doing this right
here alright so next thing we want to do
is let's create our app variable and set
that to Express
all right let's add the view engine
middleware as well as the body parts or
middleware okay just the default
middleware nothing special and then what
we want to do is let's say let's create
our route our first route which will be
to the index page so slash and say
function takes in a request and response
and for now let's just say res dot send
and we'll say working all right then we
need to app dot listen and we want to
run our server on port 3000 which I
don't think we need those quotes and
then we'll put a callback function and
we'll just do a console log telling us
that the server's started look try to
type too fast all right so let's save
that and see if we can run the server
alright so we're going to say node app
node is not defined
oh it's talking about that I threw out
the quotes
all right so it's running on port 3000
if we go along to HTTP localhost 3000 we
get working all right so it's working so
far so now let's hook up the couch TV
database to node alright so we're going
to use this object right here that we're
bringing in
so we'll say Const couch and let's set
it to node couchdb and we're just going
to pass in some options and we just want
the off which will be an object with our
admin oops
our admin user my username is admin you
want to put whatever you used and then
your password and that's it alright so
that will authenticate your application
or sorry your database so let's take a
look at the documentation and let's see
so we did we did this right here now
what we want to do is let's list
databases so we'll grab that actually
there using arrow functions here I'm not
going to do that so I'm going to type it
out we're going to say couch dot list
databases and that's a that returns a
promise so we want to use dot then and
in here we should be able to just put a
function and pass in DBS all right and
then we're going to just console dot log
DBS so let's go ahead and save and let's
restart the server ctrl C to stop it
note app and what's this hope we didn't
use new right here this should be new
and there we go so it's listing all the
databases and there's our customers
database so we know that we're hooked up
so what I want to do now is we want to
get all the documents from customers and
then list them in the index view all
right so let's create a views folder and
inside views we're going to create a
file called index dot ejs okay we're
using embedded javascript and for now
let's just say hello world and change
this to res dot render and then change
that to index so that will render the
index view okay we need to start restart
the server though okay so now if we go
and reload we get hello world so what we
want to do is let's see we want this
right here get view results so we want
to create some variables we want the
database name we're not going to do this
start key end key we just need the name
and then our view URL all right remember
we created that view right here all
alright so if we click on all and then
we click the API URL that will actually
give us our view URL so if we copy that
and then let's go let's see we'll go
right here and let's create a variable
called DB name okay we know that that's
customers and then we're going to create
another variable called view URL and
then we'll paste what we just copied in
now we don't need we don't need the
localhost and all that and we don't even
need the database name because we have
it above right here so all we need is
from that underscore design over all
right and I'm actually going to get rid
of the reduce false and the limit 20 as
well okay so that's it
now let's see let's look at this again
so now we want we want to make this get
request as coach dog get alright so
we're going to go into our we're we're
rendering the index and I'm just going
to replace this for now and we're going
to say couch get alright and then let's
see we're going to pass in the DB name
let's say I want that to be a uppercase
n so I'm going to pass in the DB name
and also the view URL all right and then
that's going to be a promise so we got
to say dot then and inside here we're
going to put a function oops let's move
that back actually not we'll put it
right there and then another parameter
here which will be another function for
an error if there's an error all right
so this one will take in error and if
there happens to be an error let's just
say res dot send and we'll pass in the
error up here this is going to be if
it's a success so this takes in data
headers and status and you can see over
here this is the same thing it's just
using arrow functions all right so what
we want to do is render render our view
excuse me render our view with res
render we want to render our index now
we want to pass along the data that's
returned so we're going to say we're
going to create a template variable
called customers and I'm going to set
that to data alright so I think that
will do it let's um let's also
console.log that data just to see what's
in it
okay when we'll save it and reload the
server so if we go to let's say our
index view and reload you'll see over
here this is what we're getting from
data the number of rows the offset and
then the rows themselves you can see
there's two objects okay those are our
two customers that we added all right
now to be more specific
let's do data and it looks like it's in
another object called data and then rows
so let's do data dot data dot rows all
right and we'll restart and reload the
route and there's our customers John Doe
and Sam Smith all right so we want to
pass along not just data but we want to
pass this whole thing all right so then
we should be able to access those inside
of the index view so let's go to index
and let's put an h3 here we'll say
customers and let me just format this as
HTML all right so we know that customers
is an array of objects so we have to
loop through them and ejs gives us the
for each loop to use in our templates so
syntax is going to look like this
customers dot for each let's see yeah go
like that now in here takes a function
like that
all right then we have to end this line
with those tags and then this we have to
wrap in tags as well now inside the
function we'll put a variable that we
want to use we'll say customer that
makes the most sense and let's actually
wrap this in a ul
and then inside here will have an Li and
we want to output the customer name so
we're going to use an equal sign there
since we're outputting and then we'll
say customer dot value dot name alright
so hopefully that works let's go ahead
and restart the server and reload and
now we're getting our customers all
right so we know that everything's
working as far as the node couchdb
module we should be able to get other
info as well from the customer so if we
want to format this a little bit and
wrap that in say h4 and then below it we
could put a ul and here we could put the
email address and I think actually know
what we'll put the email up here and
then we know that the address is an
object so we're going to say value dot
address and let's get the street so say
dot Street let me just double check the
format yeah okay so then we'll put under
that the city and the state all right so
save that and since we just edited the
view we shouldn't have to reset the
server and all right so that doesn't
look that great but you know it works
actually remove the paragraph so we
don't have that margin yeah that's fine
all right I'm not going to try to make
it look good that's not really the goal
of this of this video all right so we
know that we can list them now we want
to be able to add them so we're going to
put a form up here let's put an h3 and
we'll say add customer and it will open
up a form
all right let's give this forum a method
of post and an action the route we want
to submit to will be slash customer
slash ad alright and then in here we're
going to put input type text' name will
be name and let's put a placeholder
alright let me just make this bigger
okay so I have a name do the email and
let's see let's hold off on the address
since we're using no SQL we don't have
to have an you know the same fields in
every single document so we'll just do
the name and email for now alright and
then we're going to put our submit so
input type submit and give it a value of
submit alright so now we're going to
submit this to customer add so let's go
ahead and add that route in app J s will
say app dot post since it's a post
request okay it's going to go to
customer slash add function ok that'll
take a request response and then for now
let's just say res dot send and then
let's get actually know what we'll put
the name and email inside of variables
so let's say continum we can get it with
request dot body dot name
Quest's dot body dot email all right and
then we'll just do res send name so just
to test it out make sure the form
submits all right so let's just say test
for the name and submit and there it is
alright so let's get rid of that now
when we submit let's take a look at the
documentation okay so we're going to
insert now we need to we need to create
an ID and it needs to be that UUID
format all right now instead of thinking
of one on our home every time we submit
you know having to put it inside of an
input or something we can go we can
generate one with this alright so we're
going to use this and then wrap the
insert inside of the the callback so
let's say couch dot UUID dot then and
inside here will pass in function and
then it's going to pass us an array of
an array of IDs so say IDs and then
we're only getting one so we're going to
assign it to a variable we want just the
zero index all right so that will give
us an ID to use now we're going to call
the insert okay we'll say couch dot
insert and we want to pass in here the
name of the database which is customers
okay then we want to say ID which is
going to be ID we want the name
just coming from the variables above an
email all right and then this is a
promise so dot then and we want to pass
in a function here should we go like
that and then the error function all
right and then this here is going to
take data headers and status all right
and all we want to do is redirect so res
redirect to the home page all right so
let's save it and let's try it out okay
so we'll go to our page and let's go
back and reload what do they do
all right so let's try to add a customer
we'll just say we'll say Tom Wilson
email let's say T Wilson at Gmail submit
couch dot UUID is not a function
it should be oh it's not UUID it's
unique ID all right so let's change this
a unique ID like that
alright let's save and try it again
alright submit now what cannot read
property Street Oh okay so in our view
we're asking for the address and we're
not submitting it so it's giving us this
error all right I think it should have
got submitted I think if we go back it's
just not showing it let's check out
let's look at it and Foxton customers
and let's see docks yep
Tom Wilson so he did get submitted the
only issue is it's looking for the
address and we don't have one so I think
for now what we'll do is just take it
out of the view okay
save that alright so there we go Tom
Wilson and we'll just add another one
say Jeff Sampson
there we go all right so we can now add
customers now you guys can go and do the
add the address if you want you'll have
to add more field I just don't want to
waste too much time doing stuff that is
just that's just repetitive all right
you're not going to learn anything new
if I go through and just add the address
so now what I want to do is I want to be
able to delete these
all right so normally what I would do is
is make a delete request to the server
using Ajax or something like that but
I'm not going to do that I'm just going
to do a post request to do the delete so
we're going to just add a form let's see
we're going to add a form under each
customer which will just be a submit
button to make a post request to the
delete row all right so let's do form
and we'll add a method of post action
will be let's see customer slash delete
and it's also going to need the ID of
the customer so we're going to put that
here like customer value underscore ID
all right and then let's see in this
form we're just gonna actually know what
that's not going to work it has to be
customer
I think customer dot key let me just try
that out save it
reload and I'm just going to look at the
source code alright good so you can see
it goes to customer delete and then the
ID or the key so let's put a submit
button submit and for the value I'm just
going to put an X for the value since
it's a delete button and then we also
need to pass along the the Rev so for
that we're going to do in a hidden field
so let's say type hidden' and let's see
value is going to be customer dot value
dot Rev okay and then the name we'll set
that to Reb as well all right let's just
check that out do a control U and note
that didn't work customer value dot Rev
let me just look at the database real
quick
so there's the Rebbe now we need to look
at the view that we are accessing so
let's see we should have included it
here
rev dr. underscore rev alright so we
should be getting it in our response um
which it is it's right there so why
isn't it showing in there what am I
missing
oh if you let the equals that's all okay
let's try that again the heck what
happened I stopped the server all right
good so now we're getting that rev value
so now we need to create the delete
route so let's go back to a BIS and
we'll say app dot post it's going to go
to customer customer / delete / : ID
okay that's going to take in a request
and a response and then in here let's
see what we're going to do we're going
to get the ID and the Rev so let's
create a variable called ID and we can
get it through the parameters so request
dot params dot ID and then the Rev comes
from that hidden field so that comes
from the request body since it's in the
form dot Rev alright and then we're
going to call if we look at the
documentation to delete a document it's
couch del
let's do coach dot del and we need to
pass in the database so customers
actually know what we we've been passing
in the actual name we have a variable
for that so let's use that all right
then we pass in the ID and then the Rev
all right so again it's a promise so we
need to add dot then and we'll add our
function let's put that on a new line
okay then we're going to have another
function case there's an error all right
so for this what we want we need to
first of all pass in the data header
status and then let's just we'll just do
a redirect because we're just deleting
and that should do it let's restart the
server and let's see all right so let's
go to Jeff Sampson delete cannot post
customer delete why not let's see app
dot post customer oh I don't have this
slash let me just check the form
customer delete and then the ID all
right so that should work
yep good and reload and he's gone so now
we can add customers we can read them we
can delete them I'm not going to do the
update I'm going to let you guys do that
because I don't want to I don't want
this video to be much longer and I think
it's a good challenge you just need to
include the ID and the Rev you could
either create a new form for the update
or you could insert the data in here
alright so I'm going to leave it at that
and hopefully that helped you guys out
and taught you a little something about
couchdb please subscribe if you're not
subscribed leave a like whatever you can
do is great and thanks for watching</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>