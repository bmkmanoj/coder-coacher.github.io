<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>CakePHP 3.1 Login &amp; Registration From Scratch - Part 2 | Coder Coacher - Coaching Coders</title><meta content="CakePHP 3.1 Login &amp; Registration From Scratch - Part 2 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Traversy-Media/">Traversy Media</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>CakePHP 3.1 Login &amp; Registration From Scratch - Part 2</b></h2><h5 class="post__date">2015-12-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Yi3eqAjK_po" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey guys welcome back in the first video
we created our cakephp installation and
we set up our login which works
completely right now so now we just need
a way for the user to register alright
so first thing I'm going to do is add a
register link up at the top here alright
so we're going to go back to the layout
so this is going to be in template
layout and then default CTP alright and
let's just copy this logout link and
paste that this is gonna say register
and it's gonna be the users controller
and the action is going to be register
alright so let's go ahead and create
that function and the users controller
and before we add to that let's create
the template so under template users
will create a new file save it as
register dot CTP and this is gonna be
really similar to the login form so I'm
actually gonna copy that
alright and then let's change the title
let's say please register create now
we're gonna pass in the user variable
here sorry about that guys anyway so
we're going to change this actually
we'll leave that I will copy it and it's
changes to name and you could have used
any fields you want I know we don't we
just created email password name but you
could have added first-name lastname age
whatever you'd like I just wanted to
keep it short
alright so name email password and
that's it really so let's change the
text to register
and then that should be it
so let's save that and it should now
render for us we go to users register
oh you know what it's not gonna let us
go there because it's blocking it all
right so we need to allow access for
guests so to do that we need to go to
the user controller and we're gonna
create a function called before filter
all right so say public function before
filter and we want to pass in here cake
event slash event okay just so it knows
the correct namespace and then we're
gonna say this this auth allow and then
what you can do in here is create an
array of pages that you want to allow
okay so register alright if you had like
an about page or terms and conditions or
something like that and you want to
allow that without them having to login
you could do that here alright so let's
save that and let's reload
let's see before filters should be
compatible just controller align 12 oh
do we not
all right so we need to at the top of
user controller we're going to say use
use cake / event / event let's see if
that works
no it didn't
should be compatible with cake
event event
and then I think if we go down and get
rid of this since we're using it up
there that should do it
so save that and let's reload and click
register okay so it's letting us to
register undefined variable user that's
fine because we didn't define it yet and
we still shouldn't be able to go any
okay good all right so it's working how
it's supposed to do so we can see we can
see the register form and now we need to
add to this register function all right
so we're gonna say user is going to
equal this this users new entity
all right and that itself should get rid
of that error
or not
undefined variable user register CTP
whose
all we didn't set it yeah that's why all
right so let's keep going so we're gonna
say if this is a post so if this request
yeah this request is and then we'll pass
in post okay so basically if the form is
submitted
then we're gonna then set user to this
this users patch entity and it will pass
in there the user itself and then the
data which is this request data
all right and then we're gonna save
we're gonna put it in an if statement so
we're gonna say if this users save not
Dave let's save and it'll pass in user
okay so if it works out if it saves then
we're gonna send a flash message success
and I'll say you registered and and
login alright and then we just need to
redirect I'll just grab that okay except
we want to redirect to in action because
we're still going to be in the log the
users controller so we want to go to the
log in action
that way when we log out it'll take us
right back to the login form alright and
then we just want to add on an else okay
so for some reason they can't register
then we're going to set a flash message
and this is going to be an error and
we'll just say
you are not registered alright last
thing we need to do is we need to set
the user so we don't get that error
anymore so that's gonna go right here
we're going to save this set and in here
we're gonna say compact user alright and
we also need to sterilize it so I'm
gonna say this set and then we want to
say underscore serialize and then pass
in user and that's it so we'll save that
let's reload register ok the error is
gone let's try and register
ok so we'll say John Doe email we'll say
J doe Gmail password register ok you are
now registered and can login so let's
try it it will say J doe at Gmail and
password login and there we go we're in
and if we go to list users you'll see
John Doe is there alright so that works
logout
that works okay now the last thing we
want to do is we want to hide the logout
link when we're not logged in and we
want to hide the register link when we
are logged in so what we'll do is go to
app controller which runs within every
controller because every controller
extends it and we want to be in this
before render function because this is
going to run before anything renders
okay so let's say log in check and what
we'll do is say if this request this
request session
read and then we want to pass in auth
dot user okay so that's in cakephp
that's one way that we can check to see
if the user is logged in alright so if
they are logged in then let's go ahead
and set a variable or value that we can
access from all views okay because it's
in the app controller and let's call it
logged in and we'll set this to true and
then we want to say else then we want to
set that to false
okay so that way we have this value that
we can check from within the views so
now we'll go back to the default layout
view and this is the this is the log out
link so right here let's say I'm going
to use the PHP shorthand if so we'll say
if login and then right here we're going
to do an else
and then ttle to PHP and f okay just a
different way we can do an if statement
save that
okay so we're not logged in so now we
see the register if we do login
now the register is gone and we just see
logout alright so that gives us a
complete login and registration system
in cakephp alright so hopefully you guys
enjoyed this video and I will see you in
the next one
and be sure to subscribe leave a like
leave a comment whatever you can do</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>