<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Build A Codeigniter PHP App - Part 7 | Coder Coacher - Coaching Coders</title><meta content="Build A Codeigniter PHP App - Part 7 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Traversy-Media/">Traversy Media</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Build A Codeigniter PHP App - Part 7</b></h2><h5 class="post__date">2017-04-10</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Ah65hBRffwc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey what's going on guys welcome to the
next CodeIgniter video i think this is
part 7 in the last video we created the
registration functionality we can now
add a user to the database now what we
want to do is want the user to obviously
be able to log in so let's go to our
views and we're going to go to the users
folder here and our views and say new
file and save that as login dot PHP ok
so we're going to have our form say echo
form open and then down here we'll go
ahead and echo form close you can use
the standard form tags if you want and
then this is going to be submitted to
user slash login ok man we're using
bootstraps so what I'm going to do is
I'm going to put this in a four column
div and then align it to the middle ok
so it looks kind of like a real login
form for our back-end
ok so let's give this a class of row and
we're going to say div class call MD for
I believe and then we want to offset it
for because we want it in the middle so
for that will say call MD offset - 4
okay and then in here is where we want
to put our form I'm going to put an h1
in here as well and I'm going to give it
a class of text center just a bootstrap
class and in here it's just going to say
whatever we put for the title so we'll
say PHP echo title
all right and then we'll do our form
field so let's create a div with the
class of form group another bootstrap
class and then let's put the input it's
going to have a type of text and let's
see it's going to have a name of
username class will be form control and
placeholder let's just say user name and
I'm just going to add on required and
also auto focus so that the cursor goes
right in that field all right so let's
copy this form group and then this one
is going to be the password make sure we
change the type as well actually for the
placeholder I'm going to say enter user
name enter password okay and then we'll
have our submit BTN primary I'll say
login all right so let's go ahead and
save that then we need to go to our
controller users controller and let's
see what I'm going to do is copy the
register function here
all right and then we'll go right below
it say log in user
okay so let's change the function name
to log in change the title to say sign
in and then for the rules we're just
going to have the username and password
so we can get rid of that get rid of the
email validation and the name validation
and we don't want the check username
exists right here so get rid of that but
they are required so that should be good
okay so if the form has not been run or
if there's some errors then we just want
to load the template so that's going to
be used as slash login which is what we
just did and then down here is what's
going to happen when we log in and it
passes so let's change the message here
to user logged in and we'll say you are
now logged in and let's see we'll add
that to the header in a little bit but
what we need to do now is basically call
the model to to verify the login through
the database now we need to encrypt the
password that's typed when we will
actually know what let's to first save
this and see if we can actually go to it
so user slash login let's see what's
this views user login oh I put a colon
here that should be a semicolon all
right there it is so now we have our
login page actually know what I want
this button to span all the way across
so let's just add a class of button
block okay so there's our sign-in form
you know what let's do the same thing
with register we'll make that smaller
too so let's go to see register.php
and
just wrap this in a div with the class
of row tab this over twice because we're
going to need another class and this is
going to be call MD for call MD offset
for okay whoops the office it didn't
work well and then for the title take
that and move it right here I'm just
going to change it to an h1 and let's
also give it a class of text center
there we go and then the button love it
we'll add the button block class so now
we have our register and login forms
let's create a link to the login so we
need to go to our header file and let's
see you'll just copy the register link
and let's put that right he actually put
that first so that's going to go to user
slash login and we'll change this to
login okay so now we have a link good
and it's just yellow because of my
LastPass Chrome extensions your
shouldn't be yellow so now what we'll do
is go back to our users controller and
go to the login function and we want to
be working in this else okay so if
everything passes then first thing I'm
going to do is get the username and
we'll put that into a variable called
username and of course we can get that
with this input post username
and we also want to get and encrypt the
password so let's say get and encrypt
the password so we'll put that in a
variable and we're going to use md5
again because that's what it's stored as
in a database and here we'll say this
input post and password okay and then
we're going to end up we're going to
call a model function but what I want to
do is the model function is going to do
all the matching make sure that username
and password is correct and then I want
to have it return the user ID all right
so let's say login user and we're going
to have a variable called user
underscore ID we're going to set that to
this user model and that's going to have
a function called login and then we just
want to pass in the username and
password so that'll give us the user ID
or it will give us false if the if it's
not a correct a correct login all right
so we want to check for that ID okay so
if there is a user ID then we're going
to folks and we'll go on to go up go on
to create the session
all right and then else if it's wrong if
the login is wrong then we're going to
set an error so we're going to just grab
this right here and cut it
and let's paste that in and then I'm
also going to paste it in here after we
create the session we're going to want
to redirect alright so if it's not if
it's not a correct login then this
message here I'm going to change the ID
here to login failed and then here we'll
just say login is invalid and we'll
redirect back to the login form which is
user slash login okay let's see just to
test things out for now if it succeeds
we'll just do a die function and we'll
say success okay and if it doesn't it'll
do this so let's save that and then we
need to create this login function in
the model so open up user model let's go
right here save public function log in
and that remember that's going to take
in the username and password okay then
we just want to validate so we'll do
this DB and we're going to use where and
then we want to match username to the
username that's passed in or the
variable that's passed in then the
password
it's going to match the password okay
and then we'll say results and let's set
that to this DB get users that's the
table that we're looking in and then we
want to check for the return rows all
right so we can do that by saying result
will say result and then we're going to
use the number o--'s function so if num
rows is equal to 1 then we know
everything is OK and match to match the
user so we want to return and remember
we're returning the ID if it works okay
if it matches so we can say return
result row we want the first one we're
going to pass in 0 and then the actual
ID that will return the user ID else
then of course we just want to return
false because the login didn't match so
let's go ahead and save that and then we
should be able to try this out so let's
sort what's this
23 should be a money sign all right so
let's go ahead and try this we'll try
with something that's not correct and we
need to catch the error message okay
because we have this log-in failed going
off so we need to go back to header.php
and just add that in our messages here
okay so this will be blog and failed
let's change the success to danger so
that it's read and this will be login
failed all right so now it should give
us the message let's reload this and we
get login is invalid if we put a
username that's in there but the wrong
password we still get login and valid if
we do brad and then the correct password
we get success good so we know that that
whole matching
validating the login is working now once
that we get that success we need to then
create our session variables okay we
want to set our user data so let's go up
here and get rid of this let's die and
what we're going to do is we're going to
create a variable called user underscore
data set that to an array and in here
we're going to have the user ID and we
want to set that to user underscore ID
so whatever is returned from here and
then we also want the user name which is
going to be the username variable and
then we also want a value called logged
in so that we can check to see if the
user is actually logged in and that's
going to be set to true because it
passed okay now we take this user data
variable which is an array and we want
to now call this session set user data
okay and then that's going to be passed
in that user data and that will be
stored so that we can access any of
these whenever we want and then this
stuff should all be okay so let's try it
so it's a brad login and there we go now
the message isn't displaying because we
didn't add user logged in to the header
so let's do that
okay and make sure that we do alert
success because it's not an error all
right so we're now logged in now we need
a way to log out all right so let's
create and function in the controller
the users controller alright and
actually looks like I forgot the access
modifier on these I just want to put
public alright
so logout is actually really easy all we
need to do is kill all that session data
so we're going to unset each individual
one first so unset user data and we can
do that with this session unset
underscore user data and we want to get
rid of the logged in and we want to do
the same thing for the ID and the
username so let's copy that so this one
will be the user ID and this one will be
username okay and let's set a message
for this for when we log out so see I'm
going to just copy that and then this is
going to be user logged out and we'll
see you are now logged out alright and
we'll add that to the header real quick
all right so back to the controller and
then after that message we're just going
to redirect back to the login form so
let's say redirect and that's going to
go to users slash login now we need to
add a login link to the navbar so let's
go back to header and go up here and
just let's copy this the login and this
is going to be the last element here so
let's paste it in here and say logout
and that's going to go to users log out
so let's reload click logout and we get
you are now logged out so now we can do
is start to add some access control so
first thing is hiding these up here so
we only want login and register to
display if we're not logged in and then
the rest should display if we are now
remember we have that session data that
we can go back to and we can check ok so
let's go to back to our header and let's
wrap the login and register link in an
if statement
okay so what we want to say here is if
not this session user data and we want
to check for that logged in value okay
so if they're not logged in then this
stuff should show and then I'm going to
copy this and go down here and get rid
of the exclamation mark which makes it
so that if they are logged in these ones
will show and let's end that and then
save and reload and now we only see
login and register okay if we do login
now we get these links and we don't see
the login and register so that's what we
want now if we say create and we just
copy this link and log out and remember
we're not logged in now and if we go
there we can still go to the create post
and we don't want that okay you have to
be logged in to create a post so let's
go to our users controller go up to I'm
sorry not the users we want to go to our
post controller and go to create and the
first thing we want to do here is check
the access to check if they're logged in
or not so let's put a comma here and
we'll say check login and same thing we
did in the view we can do here if not
this session user data logged in then we
just want to redirect to users slash
login alright so now we're if not logged
in if we try to view this page it'll
boot us out which is what we want all
right now we're going to copy this and
we're going to also put this down in
delete so if somehow the user is able to
try to delete it it won't work they'll
just get redirected same thing with
edits
same thing with update okay so we'll
save that and then we also want to do it
in the category create as well and that
should do it
so it's save that now that's all set as
far as that access control but now what
we want to do is when we submit a post
we want our user ID to also be submitted
and we already created the the column if
we look in posts we have that user ID
field which I just want to set to my
user which is the ID of one so whoops
posts I'm just going to say that belongs
to the user one okay so we want this to
happen when we insert the post so let's
go to our post controller and go to
create which is right here and actually
you know what we want to do this in the
model the post model right here create
post so I'm just going to add on to this
right here and let's say user underscore
ID set that to this session user data
and we want to get the user underscore
ID okay so now when we submit a post
it'll also submit the user ID now right
now if we go to a post and view it we
get the edit and delete whether it
logged in or not whether we're logged in
as any user or not so we want to make it
so that we only see this if this is our
post so what we can do is go to the view
so we'll go to posts and then view dot
PHP and this is where the edit and
delete buttons are the delete is
actually a form so we just want to wrap
this including the HR I'm going to say
PHP if
so we want to match the logged in user
ID to this post ID so we can do it with
this session user data note we want user
underscore ID and we want to match that
equal to post and then the user ID of
the post so let's save that go back here
and reload what's this oh I didn't end
it all right and now we don't see the
button so if I log in as Brad which is
the post owner and we go to the view we
can edit and delete okay now if I log
out and we register as another user say
John Doe so nine oh two one oh email
user names so John password whoops okay
so now we're registered as John let's go
ahead and login and now if we go to the
view page
we still can't view or edit this which
is exactly what we want well we can't
see the buttons however if we were to
somehow get the link and paste that in
here to edit we can and we don't want
that either so we want to check to make
sure it's the the correct user so let's
go to the post controller and go to the
Edit function which takes care of
loading this page and let's go right
under where we get the actual post
because we can now we can get the ID
from this as well alright so let's say
check user
all right so we're going to do if this
session user data user ID is not equals
to and then we can grab this because
this gives us the whole post I'm sorry
the post array of it with a single post
in it and then we need to just add on
square brackets here and say we want the
user ID field okay so we can match those
now if this is true then we just want to
redirect to posts okay so now if we go
back here and reload it just boots us
right out all right but if we log in as
Brad who's the post owner we can go and
we can edit right so we now have some
access control now one last thing I want
to do I don't think I've done it yet
it's actually creative post as John well
I know I haven't done it yet all right
so let's say create post I'll just say
test post oops so we'll just call it
test post test I don't have an image so
we just do it without one submit and
there we go
so they read more and we can edit and
delete because that's our post good if
we log out go back in this Brad we
shouldn't see those buttons alright good
so that's going to be it guys for this
now the next video I'm not exactly sure
what I'm going to do yet if you guys
have any ideas feel free to leave them
below I can't guarantee that I'm going
to do all of them or even any of them
but I'm willing to take some suggestions
alright so thanks for watching guys I
appreciate
it if you're actually following through
this whole series and hopefully you
enjoy it so thanks for watching and I
will see you next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>