<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>MEAN Stack Front To Back [Part 8] - Login &amp; Logout | Coder Coacher - Coaching Coders</title><meta content="MEAN Stack Front To Back [Part 8] - Login &amp; Logout - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Traversy-Media/">Traversy Media</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>MEAN Stack Front To Back [Part 8] - Login &amp; Logout</b></h2><h5 class="post__date">2017-02-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/rt6VSxXL4_w" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">you guys welcome to part 8 of mean snack
front to back in the last video we
created our register functionality we're
now able to register through our angular
2 app and now we're going to work on the
login ok so we already have the login
for logging component created so let's
go to our angular app sorts app
components and then login and let's go
ahead and open up both the component TS
as well as the HTML ok so I'm just going
to paste the form in here this is just
plain HTML we're just going to add a
couple things to it all right so first
thing we're going to do is in the form
tag we need a submit event ok so we're
going to say submit and then we're going
to send that to on login submit and then
we have our username and password we're
going to like these two properties in
our components so we're going to need ng
mom will say ng model equals username
and we also have to have a name
attribute with the same value okay we
also want to do that for password ok
password and then name password ok and
that should be all we need to do here so
let's save that the form should show up
good now we're going to go back to the
component PS file and let's add the
username and password as component
properties ok so say username string and
password string ok and then we're going
to want to actually let's just add that
function the on login submit'
okay usually we'll just text this out
okay actually let's test it out by
displaying the user name okay I remember
we have the ng model linking to this
user name property which we can access
with this start using it so let's make
sure that that's saved and then we'll go
ahead and try that out let's reload and
if we go ahead and let's just a test and
user name and we get test down here okay
so that function is hooked up now when
we submit it we want to create an object
for call user and let's set user name to
this dot username and then password to
this dot password okay now what we want
to do is take this this user object and
submit it through our off service to the
backend authenticate row so we have to
bring in our off service so let's go to
the top here and we'll say import off
service actually that should be an
uppercase and that's going to be from
want to go out twice and then into
services and then auth dot service okay
and we need to inject that as a
dependency so private auth service and
we'll set that to auth service
okay and while we're at it we might as
well bring in the other stuff we need to
as well we need the router so that we
can redirect so that's going to be from
angular slash router and then look
what's going on here okay
and then we also want to bring the flash
messaging so that's going to be flash
message service angular 2 - flash
messages and we have to inject those as
well so let's put these on separate
lines just to make it look a little
neater so this will be router and let's
say flash message set that to flash
message service okay so now we're
injecting all the stuff we need to
inject and then we're going to call an
aux service so let's do that right below
this where we created the user we're
going to do this dot off service dot and
we're going to call this some no wait we
want to call authenticate then ACK a
user okay that will get passed into user
and it's going to return the observable
so we want to subscribe okay and then
when we subscribe we're going to get
some data back
and we'll set that to a code block okay
I'm going to just leave it like this for
now and we want to create this
authenticate user so let's save this and
then we'll go into our service our off
service authenticate user that's going
to be passed in the user object okay
and now we need to make a post request
to to authenticate so just like we did
up here actually let me just I'm just
going to copy this okay so we have our
headers we're saying we want to use the
content type Jason and then we're making
a post request except we want to make
this to our Sena Kate slash authenticate
and we're sending the user along so
that's fine and the rest of this is fine
so basically it's the same thing except
we just changed the endpoint okay and
then remember when we only do the
authenticate it's going to return a
success and it's going to return if it's
successful it's going to return the
token for us to store and it's also
going to return the user info okay so
once we make this request we're going to
want to store that so let's go back to
our login component and that's what
should be in the data right here so
right now I'm going to do is just
console log that data just to see what
it gives us all right so let's save that
let's see what how many errors here with
that
no exported number flash message service
CY is I getting that oh its messages
that should have an S and then also
right here all right
so save that and let's go back to our
login page I'm just going to reload it
and let's see what happens if we send
just anything okay so look down here and
we get back an object successful user
not found which is exactly what we
should get now let's use a user that's
there but the wrong password okay now
down here you can see we get wrong
password now let's do the right password
and if we look down here we get success
true we get our long token and we get
our user object so what we want to do is
store this and we're going to use local
storage so let's go back to our login
component and let's see we're going to
test that data we're going to say if
data dot success and let's do an else so
it's success let's do the error first if
it doesn't succeed then we just want to
send a flash message so we can say this
dot flash message dot show and let's
pass in the actual message that comes
back from the server so beta dot message
and then we can add our options and
we're going to add a CSS class and set
that to alert danger okay and then we'll
also set the timeout and we'll set that
to five seconds all right we just put
these on
zipper line okay and then let's see
after that that ends right there we want
to just redirect so we'll say this dot
router we got navigate and here we're
going to go to just a login all right so
let's go ahead and try that we'll save
and login user not found with you Brad
and the wrong password we get wrong
password okay so we don't even have to
create those messages we're sending it
right from the server now if it's
successful what we're going to do is
we're going to have an authentication
off service function called store user
data so let's call that this start auth
service dot store user data okay and
then we're going to tap in data dot
token and data dot user so the response
we're getting and then we're simply
going to send a message and redirect so
let's copy this and put that right in
there okay except this is going to be so
you don't want to send no we don't want
to send that let's uh let's just say you
are now logged in and we'll change this
to alert success and we want to change
this to dashboard all right so let's
save that and then we'll create the
store user data so we'll go back to our
service
okay so that's going to get in a token
as well as user and then what we want to
do is save it in local storage so we can
say local storage dot set item and then
this takes in a key and then the value
now for the key we're going to use ID
underscore token now the reason I'm
using this is because when we use
angular JWT
to to validate the token it looks for
this path automatically within local
storage there is a way you can change it
but I'm just going to keep it at ID
token okay so that's why I'm using that
and not just token but then we just want
to pass in the token that comes in from
here so we're saving that in local
storage and then we want to save the
user as well that item and we're going
to set user and let's set that we're
actually going to say Jason dot
stringify
user now the reason we're doing this is
because local storage can only store
strings it can't store an object so what
we have to do is make it into a string
before we enter it and then when we get
it back we can parse it back to Jason so
we can use it alright hopefully that
makes sense
and then what we'll do is we're going to
set this and this value okay so we can
say this dot auth token equals token and
this dot user equals user okay
so now let's go ahead and make sure
everything's saved and we're going to
try to log in and it should get stored
in local storage so let's say Brad and
login takes it to the dashboard tells us
we're logged in and then if we go and
click on the application tab you'll see
that we have in local storage if you
click down right here we have the ID
token and we have the user okay we can
access this user information whenever we
want so what I want to do now is create
a log out link so that we can clear this
stuff out and it will log us out all
right and then in the next video after
that we will implement the check so that
we can validate the token with angular
JWT and we'll also do the access control
because right now anyone can go to
dashboard or the profile so we'll do
that too but let's create the log out so
in the service go down here and let's
say log out okay so log out what we're
going to do is we're going to first of
all set the local auth token value to
know we're going to set this dot user to
know and we're going to clear local
storage dot clear okay I'll clear it out
let's save that and then we need a
logout link up here so we're going to go
to our nav bar the nav bar HTML and
let's go ahead and copy one of these now
right now all the links are going to
show at all times
but when we do our off guard we'll be
able to hide you know hide the log oh if
they're not logged in and hide the
register log in if they are logged in
okay so paste that in and change this to
logout okay and then we're going to have
this go actually you know what we're
going to do is it's not going to go
anywhere we're going to create an event
and then we'll put the logout event
inside of our navbar component so let's
get rid of this router link and I'm just
going to say H ref to nowhere
okay and then we'll add a click event
and let's set that let's let's set that
to on log out click
all right and say we don't need this
because that it's not going to be active
okay so we'll save that and then let's
go in navbar component TF and say on
logo click and we're going to need our
off service and messaging so I'm just
going to copy from let's say login just
going to copy all these imports and put
that in the nav bar okay we also need to
inject them all so let's grab those as
well everything in the constructor okay
we'll put that here
and in now in the on log out click going
to save this dot off service dot Lago
and it's not an observable it's not
returning anything so we can just do it
like that and then the message is start
flash message dot show and let's just
say you are logged out
put that to alert success and we'll set
timeout to three seconds okay and then
we just want to redirect and see this is
going to go to the login page
and then we also just want to return
false
all right let's save that and let's try
it out we'll reload and let's click
logout you are now logged out and if we
go to application local storage there's
nothing there good
all right so in the next video we're
going to implement angular 2 JWT we're
going to create the profile page and
we're going to send we're going to send
a request to the profile route which is
restricted so we'll have to send along
the token as well all right so that's it
for this video and I'll see you in the
next</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>