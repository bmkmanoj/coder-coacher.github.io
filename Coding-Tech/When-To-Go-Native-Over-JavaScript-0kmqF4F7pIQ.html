<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>When To Go Native Over JavaScript | Coder Coacher - Coaching Coders</title><meta content="When To Go Native Over JavaScript - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Coding-Tech/">Coding Tech</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>When To Go Native Over JavaScript</b></h2><h5 class="post__date">2017-08-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/0kmqF4F7pIQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">at my name is Harry Tommy and today I'm
going to be giving a talk entitled when
to go native over JavaScript the context
for this talk is of course react native
now before I get into my talk I want to
give you some background information
about me so you can better understand my
perspective when I talked to you about
this important topic today so first and
foremost as you might have guessed from
an absence I'm not American I am Irish
but I don't come to you today from the
rolling green hills of Ireland no I come
from San Francisco where I've been
working for the last 10 years as a
native software engineer native software
engineer what does that mean well when I
came to San Francisco first I got my
stars doing cross-platform desktop
application development for Mac and
Windows and C++ when a few years doing
this and then I went on to do Android
development where I was mainly working
in Java and C++ for some startups I then
went on to work at some big companies I
spent nearly two years at Apple working
on iOS and objective-c
iOS applications so again Objective C
and C++ I then went to work at Facebook
where I spent two years working on the
main Facebook app in Objective C plus
plus
fast forward to today and I work where I
run a contracting / consulting company
that specializes in mobile mainly native
iOS Android and most pertinent for
today's talk react native well what is
this to talk about what I want to build
on my native experience to tell you how
native code like Java Swift
Objective C can impact the way that you
build react native applications in the
day-to-day basis in order to do this I'm
going to look at three areas where
you'll need to think about whether a
native code is present or whether you
should be using ways of code and these
areas are tooling third-party libraries
and we actually have to write native
code yourself now in order in order to
explore each of these areas I'm going to
either give some examples or sample code
that illustrate some architectural
points I want to expand upon now my goal
with these examples or sample code is
not one to be prescriptive I'm not
trying to say to you that there's one
three way to write react native
applications because there's not there's
a lot of them I just want to help you
understand
architectural consequences of your
decisions save you time and hence save
you money so the first area that I want
to look at is tooling and the first tool
that I want to look at is one of my
favorites which is Expo now if you have
brands talk yesterday you're probably
familiar with Expo is but just in case
they're going to briefly recap so Expo
is kind of like Ruby on Rails for react
native it's a suite of tools that are
built on top of react natives that allow
you to get up and running at building
react native applications even if you've
never installed the native tool chains
on your computer aka Xcode or Android
studio at so why do you do this well
with that though you download the expo
x2 e you install the expo app on your
iPhone or Android device and you start
editing in your editor of choice and you
can run it a QR code will come up you
can scan that QR code with your mobile
application and your react native code
is there and you can edit the changes
will show up super awesome when it comes
time to release your Expo app to the App
Store expose it hides the binaries for
you that you need for the Google Play
Store or the Apple App Store Expo also
handles push notifications and
over-the-air updates it's awesome
so what's the deal with native code in
Expo well let's say you want to use a
third-party library like say the git of
the Mobile SDK in your application the
github mobile sdk wrap some native code
you can no longer use that QR code
scanner and you cannot have your changes
with the github SDK the third-party
library that wraps these native code do
the over-the-air updates you have to do
something called detaching from Expo it
spits as the Expo SDK and you have to
handle building and distributing that
app yourself this can be quite painful
if you'd be depending upon Expo for
over-the-air updates or to do push
notifications it's something that you
need to think of in advance before you
use Expo or at least factor in that at
some point in the future you need to
diverge from using Expo and manage this
yourself also if you want to write
native code let's say for example you're
really stoked about
11a or KS all these changes to
navigation controllers and stuff like
that and you want to use some of that in
your application Expo does not support
pushing native code to your app again
you'll have to detach and bills and
distribution yourself just a point to
think about the next awesome tool that I
want to talk about is code push from
Microsoft
what does toe push from Microsoft do as
the TLD or for code push from Microsoft
is if the cloud service that allows you
to do over-the-air updates with your
react native applications
it's really awesome I use it with
several of my clients I think code
pushes are great products but once again
if you release an application to the App
Store or you've distributed it with
enterprise distribution like I have and
you want to add some changes that
involve native code like again add a
third-party library contains native code
to that application
you can't code push that you need to do
another binary release submit up the App
Store get that released and then do a
code push that only took targets that's
just something to keep in mind so
building on the examples that I've just
given the next area that I want to talk
about is third-party libraries now as
you can see from the previous example
the mere presence of native code in a
third-party application can have a big
impact in the way that you build and
release your react native applications
so with third-party libraries there's
one kind of your third-party library
that I particularly want to dig into
because I think it gives a lot of new
engineers to the react native ecosystem
and experienced engineers 3 a creative
ecosystem a lot of the confusion and
pain and that category is navigation so
let's say you want to build a react
native application that handles deep
linking or has a navigation stack or has
tabs navigation well you probably want
to use a third-party react native
library to handle that and the next
logical question that you'll ask
yourself is which navigation library
should I use now I want to pause the
talk here and because I think Xavier
bought this pointer fell yesterday but
can you spot which one of these
navigation libraries have native code in
it from the name it's kind of confusing
think about that and think about the
previous point I made
got Co push and Expo this is something
that can be quite confusing but anyway
returning to my talk and which
navigation likely should you use what's
the difference between all of these
navigation libraries well it turns out
that the answer to that question is
rather complicated at some of these
libraries have features that the others
don't some of them have like api's that
are really different in the way that
they compose routes and scenes but for
the purposes of this talk I'm going to
divide all of these libraries into two
broad categories those libraries that
are native based and those libraries
that are JavaScript based so what's the
difference well native libraries wrap
the underlying navigation system of the
operating system that they target so in
the case of iOS that UI navigation so
react navigation native navigation from
Wix and native navigation from Airbnb
are both wrapping UI navigation on iOS
the JavaScript navigation libraries on
the other hand attempt to replicate the
behavior of the underlying operating
system or NAS in transitioning screens
and handling losing and so on and so
forth so we're going to explore this
concept a little bit more to an example
app that I've written this example app I
implemented it twice once with a
JavaScript based navigation stack and
one with a native based navigation stack
and those type stacks are the JavaScript
owners react navigation the native one
is react native navigation from Wix you
can find both the source code of these
apps on my github github comm /h kale so
what will this application do well it's
a single screen application with a
navigation stack that uses read ups for
state management across screens each
screen in the stack consists of the
following a text label that shows its
index in the stack and three views
displaying randomly selected colors a
random animated picture of a cast that's
selected from a list and two buttons
push new screen which pushes a new
screen onto the stack and update all
screens which basically dispatches a
Redux action that causes all of the
screens in the stack to select
new random colors and new random cat
picture kind of a contrived example but
you'll see why I did it in a minute so
let's see what this looks like in action
so as you can see I am pushing a new
screen with this button coming on I'm
now updating the screen the previous
screen as values are different that's
kind of what it does funny cat pictures
are awesome so how are we going to
explore this well I'm going to explore
this from the point of view of a native
developer which is via Xcode so Xcode
has this really cool feature where you
can basically pause the simulator and
you can look at the view hierarchy you
can see what's being rendered by UI tip
the rendering system of iOS so what
we're going to do here with the
JavaScript based navigation stack react
navigation which is included with expo
is we're going to push a couple of
screens we're going to pause the
simulator turn it sideways you can see
the view hierarchy and if you're a
native developer you'll notice something
unusual and that thing is that all the
previous screens are being rendered not
just the screen that's on the top of the
stack and the significance of this is
going to become apparent in a couple of
slides time so let's do exactly the same
thing that we did before but with react
native navigation the native navigation
stack so once again we're pushing a
couple of screens we're pausing the
simulator and we're going to view the UI
harker and we're going to notice
something immediately different when we
turn the screen sideways and that thing
is the previous two screens are not
rendered with the native navigation
stack so why is this well in order to
explain this for iOS we have to kind of
take a step back and look at like an
architectural point of every app native
and iOS in general so with iOS each
screen that you have is basically has a
view controller and backing it and that
view composer is kind of like the native
equivalent of a react component it has
its own life cycle functions but it also
has a view that's associated with it so
react native by default just has one
view controller or I think it's an
activity or a fragment in Android
pretty sure it's an activity and it
basically hangs all of the JavaScript
off of that view so for the JavaScript
to navigation stats that are attempting
to simulate what a native navigation
staff does they hang all of those views
off of a single view so why does this
matter
well this matters and because on Android
is completely breaks accessibility in
certain scenarios so if you have on
Android at two screens on top of each
other with a navigation stack with any
of the JavaScript navigation libraries
like we tested this with react native
Loutre fluffs if there's text in the
first screen that's not visible in the
second screen and you touches on these
emulator with accessibility it will read
the text behind it
so this kind of breaks this can break
your signup flow for blind people
there are ways to work around this but
my colleague Erica cooks use our really
really talented Android engineer she
took the time to write this up and put
it up in product panes you should focus
now I bring this up because this is an
example of one of the subtle things that
can come up when you try and simulate a
navigation stack rather than completely
replicated so apart from that what's the
difference between these two approaches
and and one thing I would say is native
feel so native navigation and react
native navigation they make view
controllers at first-class citizen so in
order to where other than having just
one view controller with the views
hanging off of it they make it so that
they have like multiple view controllers
in Iowa and this allows them to have
exactly the same navigation transitions
and behavior that a normal iOS
application would have so this results
in things feeling exactly the same
especially when Apple changes things
with the navigation stacks like they
have with iOS 11 and the JavaScript
equivalent so this will have to kind of
rush to emulate any of these little
quirks that kind of come up so that it
feels exactly the same the other kind of
consequence of this is performance so if
we look at the perf for react native
navigation versus react navigation there
is less views being rendered to react
native method
and the memory footprint from our
testing tends to be a little bit lower
you know a minor difference because this
example is a little bit contrived but
something that you might want to keep in
mind if you're building more complicated
apps that have complex and navigation
hierarchies so in summary navigation
native libraries pros are performance
and it feels and behaves more natively
but there are some pretty huge cons
remember again you know the reason why
it's important to think about this is if
you have selected Expo or code push and
you decide to switch your navigation
stack ad like we did to use a native one
you know you're going to have to plan
around this with your release strategy
or you might have to completely switch
up the way you do your tooling but again
it's like a you know adopting these
things is a real pain in the ass you
know so we migrate it over from react
native user flux to react native
navigation and you know me and Eric are
both experienced at native engineers and
but all of these native navigation
stacks they're kind of on the bleeding
edge so the documentation for the latest
version of them may not be great you'll
run into linking and building errors and
just as default set up or you have to
edit your app delegate do a bunch of
build settings it can be tricky and
annoying to deal with so again if you
don't have native developers in your
team or people who can jump in and help
you as this can be problematic also you
know iOS and Android their navigation
systems the way that fragments behave in
memory versus view controllers and iOS
it's different so if you're not prepared
to invest in having some native
knowledge this might not be a good idea
for you anyway moving on to my last
section when you actually have to write
native code yourself now in order to
illustrate this point I'm going to refer
to an app that I wrote for one of my
clients and my client is Eve's a medical
marijuana company in California so
medical marijuana is not legal at the
federal level you cannot send medical
marijuana to the post Amazon style
so what ease did to get around this was
they kind of created the uber for weed
if you will so ease in California have
basically this software that they
license to depose and the depot's
employee a fleet of drivers each of the
drivers
as a little suitcase of weed in the back
of the car and marijuana products and
they basically pull the server with
their location for security reasons but
also so that if you're sitting in your
office you're like oh man this code I'm
so sick of updating these react native
libraries I need to get some like
relaxation they will find the driver
that's closest to you and map your order
to that driver the driver will come up
check your ID and they will you know
deliver your product to you and you know
you can continue developing react native
stress free who wants to see me order
some weed yeah don't tell my mom how
much I'm not sure she'd be happy with
that but anyway we're ordering some
expresso beans this is the development
server I'm not actually having a chip to
Gantt at the Armory maybe I am okay so
then we have the simulator up here with
the driver app you're going to see the
order come true soon and there we go and
so you can look around at the order here
basically the driver uses ways or Google
Maps to actually navigate to you and the
question you might be asking is I Carrie
why can't we do this in JavaScript and
to answer this question I created a
little example up the example app is a
you know a react native app that
basically posts your location
periodically and this little nodejs
server that's going to be running the
background that basically prints the
console or the post that gets with your
location and it looks something like
this that one oh yeah there we go and
you can find the source code once again
I'm a github page Gale don't copy and
paste this code into your portland-based
illegal marijuana delivery app or
whatever and there is bugs in it which
I'm going to discuss there's also pull
requests on that at 60 bugs
well you might be saying well Harry why
can't I just use a library like pole or
set interval and periodically do a post
request with this why will this not work
well that has to do with what this
fundamentally is it's a little computer
with a limited amount of battery life if
every single application that was back
rounded
could run forever you know this would
get really slow the battery life would
suck and you would hate life so what do
the operating system vendors do well on
iOS and Android
basically the operating system decides
when to suspend and when to kill your
applications and a large part of when it
decides to do this is if your
application is running in the foreground
or in the background and an important
reason that I bring this up is I think a
lot of you guys are coming from a web
background that would be kind of my
suspicion and so if you're doing web
development and you know from for most
cases not everything Safari Internet
Explorer or whatever you're developing
in is the kind of environment that you
use or seize the simulator is not that
so if you go back to the slide that I
showed you before that if a video you'll
notice that I kind of background that
example app and it continued posting on
the device that will not do that so when
you're testing anything that has to do
long-running background tasks you need
to test on the device you need to test
on the ice with the F backgrounds and
the screen locked locking the screen
actually changes the behavior of this as
well you also need to test to be out
background and so in iOS about eight
minutes should do this Android ten to
twenty minutes you also want to test on
a lot of different Android devices I
know fragmentation is a bitch and you
also to need to test with the device
unplug and not on Wi-Fi because if
you're relying on network connectivity
that can be affected as well so always
testing real hardware if you're doing
this so you're like okay hurry you know
we don't want to know about this though
we're you know crazy react native
developers is there not some
automagically parking library that will
take all of this care of all of this for
you and you might be tempted to try
something like react native background
timer
so will something like this work and the
answer that question is no and the
reason on iOS why this isn't a no for
our use case is that it's based on
something called executing Finnick
length tasks so what is that well
executing clinic lines tasks is
something that apple provides to kind of
give you a single shaft of time as your
app is transitioning to the bathroom to
from the foreground to the background
completely long running tasks like
uploading a file or processing some data
or something like that in Apple's Docs
they don't tell you how long you
actually guess with this from looking
around at staff
floo they say roughly about three to
five minutes but whenever Apple are
vague about something like this it
usually means that they reserve the
right to change this behavior in a
subsequent AB act is release so you
really want to be careful about it and
also I don't know about like Portland
traffic but San Francisco traffic if
you're delivering weed and you're trying
to go from one under the city to the
other it's going to take three to four
more than three to five minutes and your
app is probably going to be back rounded
for that period and the driver is going
to be in ways so how do you deal with
this well on iOS it turns out that Apple
are like well yeah there's certain use
cases that you want to run for long
periods of time in the background and so
they give you a way to do this so if you
open up your Xcode project go into
capabilities flip on background modes
you can select location updates and that
basically says okay I want to go post up
in the background now whenever you
request a permission like this that
could compromise the privacy of the user
you have to actually explain that to the
user so you do this by basically editing
your key list and specifying the string
that gets shown to the user when you ask
for that permission so okay you go when
you do that then you need to kind of
like sprinkle in some magic objective-c
or Swift code this code up here don't
try to read it it's just basically
asking for the location permission I
snuck this into the app delegate because
this is an example application so if you
do all this voodoo will this work can
you just use the pole library or set in
table and you know continue on with your
business no you cannot so Brent faster
from an expo wrote a product pain on
this but the TLDR is that react native
timers don't work in the background so
what you have to do is you have to write
like a bunch of lovely-looking
objective-c to basically kick off long
long-running polling tasks in the
background so again like once you've
done all of that kind of permission
stuff and do all of this stuff I just
use NS climber here to continuously pull
the server because we don't need we
don't actually care about the GPS
coordinate we just need to turn this on
and off for our particular example so
some things to note at this point and
despite having to do a native code for
this one
scenario that's kind of a bit weird 90%
of the driver app is JavaScript there's
some platform specific stuff but most of
it is this and we do use code support
code push with this but if you have to
be very cognizant every time that we
ship some native code with this we
tagged it to the particular binary
release that we're doing and so the
other thing to note as well is that this
the drivers who are using this
application are employed by the depots
so they don't mind having their battery
life destroyed by this approach and it's
mainly done because my clients insist
upon it for security reasons there are
nicer libraries like there's one from
transistor stuff and there's one that
use and kind of differences in location
to actually poll and wake up your app
that's a much more consumer-friendly
approach this is something that's a
really weird scenario that's particular
to my clients most of the time you can
get away with not writing native code so
after finishing this example I have to
say thank you very much to ease for
allowing me to show this to you and to
release some of this code they also paid
for me to come up here they paid for my
flight in my hotel there have been an
awesome client for launch tour so thank
you very much to ease I also want to say
thank you so much to all the infinite
red folks this is the first react native
conference on the west coast I'm so
honored to speak here and thank you all
for listening to me if you one more
thing sorry I wanted to get a slide in
about performance but I had to kind of
cut down my talk a little bit if you go
to my medium blog I have an article on
it I've launched or combi talks about
how to solve some performance issues
with native and when you don't have to
do this you can also contact me here if
you have any questions or you need help
with anything on my twitter handle oth
tour me thank you for listening to me
blather on I really appreciate it</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>