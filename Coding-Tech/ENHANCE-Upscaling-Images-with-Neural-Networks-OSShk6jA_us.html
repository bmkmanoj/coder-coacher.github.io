<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>ENHANCE! Upscaling Images with Neural Networks | Coder Coacher - Coaching Coders</title><meta content="ENHANCE! Upscaling Images with Neural Networks - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Coding-Tech/">Coding Tech</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>ENHANCE! Upscaling Images with Neural Networks</b></h2><h5 class="post__date">2018-01-30</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/OSShk6jA_us" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right hi everyone hi so if you ever
watch the TV show CSI you may have
noticed that while an entertainment
value it's pretty good in terms of
accuracy of portraying what computers
can actually do it is not as good I
found this great episode where they're
like we need to find the killer's IP
address and someone says I know all
could a GUI and a visual basic to do
that and I have I have no words well
part of me wants to say have you heard
of react native but anyway the most kind
of egregious and consistent offense of
this type you see on TV shows is of
course the infamous zoom and enhance
where you have this low resolution photo
of a license plate or a slot you know
the criminals face and you need to
upscale it magically into this perfectly
detailed image that you can use to solve
the crime now if people who know
something about computers you probably
see this and think that is completely
impossible but it turns out that with
recent developments in machine learning
is actually kind of possible and so
we're going to show I'm going to show
kind of how that works so imagine that
you're an engineer in the tech
department at the police department in
CSI you're sitting in your office
questioning your co-workers sanity and
your boss walks in and says hey we have
this this image of this face and it
looks like that can you please just
enhance it like we do all the time
and you say well you know it doesn't it
doesn't really work that uh okay well
we'll give it a shot so where do we even
start
well I know what you're all thinking no
the answer is not to use
that was yesterday we've already enough
Excel for one weekend all right but so
you know seriously what are we gonna use
I guess Photoshop so you know in
Photoshop you can like make an image
bigger by just changing the number of
pixels in it
and it uses this thing called bicubic
interpolation which is a really simple
algorithm all it does you kind of like
put some new blank pixels in between the
pixels you already have and for each
pixel you kind of fill it in based on
the pixels around it just do that
probably pixel and you get this new
image so we do that we get something
that looks like that you know it's not
great but you know it's kind of the best
we have in the real world so we we we
show it to our boss all right it's not
gonna cut it all right so it's 2017 we
have other things we can try like maybe
a neural network all right so what is
the neural network right all I'm neural
network is is a function that takes some
sort of input and turns it into some
sort of output except instead of
actually writing the code for the
function we just train the function
based on a bunch of examples so in this
case what we want is a neural network
that takes this low resolution photo and
turns it into the high resolution
version of the same photo and all we
need to train that function is a bunch
of pairs of low resolution face high
resolution face so we can actually get
those online there's this great data set
of like two hundred thousand photos of
celebrity faces so that gives us our
high-res versions and for each one we
can just down scale it to get the low
res version and that actually gives us a
pretty nice training set so we're gonna
do is we feed each of these into our
neural network and for each training
pair what we do is we give the low res
version or neural network and then it
takes its current best guess at what the
up scaled version should look like but
because we're in the training process we
actually have the real high-res version
available as well and what we want to do
is each on each iteration of training
makes the neural network a little bit
better at actually producing the real
answer it's what we can do is kind of do
a per pixel subtraction between these
two images and see where they're
different and you notice there's this
bright red pixel here and that's because
the neural network guessed that that
bottom left pixel is black but
actually white and the real answer is it
was way off on that pixel so we kind of
want to tell it hey you should fix that
next time and if we take the total per
pixel difference for the entire image
that gives us what's called our loss
function which is basically just what
we're going to tell the neural network
to try to minimize as we train it which
makes sense right because if that thing
if that difference goes to zero that
means that our neural network is perfect
at reproducing the real high-resolution
image every single time it's never going
to get to zero but we train for a while
with that loss function and we just help
minimize that that total per pixel
difference and it can get pretty low so
great that that was pretty easy so let's
see how it worked out so we give it our
low res image not quite the Silver
Bullet that neural networks were
supposed to be interesting so we compare
it to the by cubic interpolation result
and doesn't really look that much better
right but you know whatever we used to
neural network it was cool so let's show
it to the boss no no not good enough we
this is this is not going to cut it for
TV quality so we need to figure figure
out what's going on so why didn't the
neural network work that well well it
actually comes back to our choice of
loss function so if we think about
what's going on here it's kind of
illustrative to use an example where
there's a sharp edge in the image so you
see here the low resolution image you
can kind of see that edge and if our
neural network goes out on a limb and
kind of draws a sharp edge in the
high-res image what you see here is that
it actually got it a little bit off from
where the real edge was and when that
happens our our loss function gives a
really high loss because the sharp edge
that it drew wasn't exactly where the
real sharp edge is and so if our neural
network kind of goes out on a limb and
tries to draw a sharp image it's never
going to get it exactly right and so it
really gets penalized for that and so
what we end up Incentive izing our
neural net our neural network to do with
the loss function we chose is to kind of
generate this blurry blob that will
never be too far off from the real
answer so that kind of limits how far
off it can be but that's not what we
want for our TV quality perfect face
right we want it to generate this
realistic sharp image so how can we do
that well we can come up with a new loss
function that minimizes that total
pixal difference but also makes the
guests look kind of sharp and realistic
so how can we do that well we want to
add something else to the loss and
that's where we come to generative
adversarial networks so this is a cool
idea that was invented in 2014 by a grad
student named in Goodfella and it was
inspired by adversarial games so as an
example of an adversarial game you might
imagine an example people counterfeiting
money so the counterfeiters make some
fake bills and they look ok and they
worked for a while but eventually the
police catch on and they develop these
better techniques for catching those
counterfeit bills but then the
counterfeiters catch on to that and
they're gonna develop some better
counterfeit bills and the police catch
on to that and so on and so on and you
see this sort of adversarial dynamic in
lots of different places like online
fraud or DRM and music and things like
that and so what if there was a way to
apply this idea to our neural network
and it turns out there is so what we do
is we have the same lowest high res
training example and we have we take the
neural network we had before and we we
call it the generator kind of like the
counterfeit ER and so it's still trying
to produce that that high res image and
we have our real high res image but the
difference is that instead of doing the
per pixel difference we add a new neural
network into the system called the
discriminator and it's kind of like the
police so what its goal is it's it gets
an image as input and its output is to
say the probability that that image is
actually a real high res image or
whether it's a fake high RISM is
generated by the neural network and so
we train it to get really good at that
and its goal is to get it right every
time is this real or is this fake and we
just kind of randomly give it either a
real or a fake one each time now the
generator on the other hand its goal now
becomes to minimize the accuracy of the
discriminator to fool that other neural
network and so what that ends up doing
is incentivizing the generator network
to produce images that look realistic
and indistinguishable from real ones so
but the other the one last step is that
every time we train the discriminator
gives feedback back to the generator
that says hey I detected that this image
was fake and here's how you can make it
a little bit better next time that would
make it harder for me to tell so it
would be kind of as if the police were
telling the counterfeiters like what
they were doing and the counterfeiters
were learning from that
so we do that we set that up and we
train for a while and you can see this
is as we're training the results are
getting better and better and they start
out looking pretty weird but as we go
they start getting kind of sharper and
converging on snail looks pretty
realistic and so now let's see how it
worked so we just pull out our generator
Network now which has been trained in
the Gans structure and isn't that pretty
cool yeah so we've kind of imagined this
face just out of these pixels if you
compare it to the original result from
the from the earlier neural network it's
way better all right boss is having so
we can kind of see what this looks like
with a couple other faces and you see it
produces these results that look pretty
realistic if you look at what the
original high-res image actually was you
can see that it doesn't quite match up
so that's that's kind of the catcher
right is that the information needed to
reconstruct the face isn't actually in
the image so we're just kind of making
it up but you know we don't really care
about that it's just TV it doesn't
really matter if you catch the wrong
person so you know it's it's it's not
CSI ready yet in the real world you know
you can also I tried out on my own face
I found out that doesn't always work
that well so this is it gave me like a
really long nose and no mouth I don't
know why
the other the other catch is that we
only train it on faces right so if we
try to upscale like the Bank Bank on
logo for example it's gonna try to like
make a face out of it
I think I think I see a face in there
somewhere I'm not really sure so people
have done all sorts of crazy stuff with
this technique it's blowing up in ml
these days you can dump a bunch of
photos of zebras and horses into again
and learn how to convert between them it
doesn't bow it doesn't always work you
there nice try
I guess what if the input was a sketch
instead of another photo you can
generate a realistic photo of a cat you
may have seen this demo floating around
online it uses Gans
I try drawing a cat myself and it
actually worked pretty well and you know
one other crazy example out of many what
if you take captioned images and try to
convert just from text describing a bird
to a photo of that bird and that
actually people have gotten that to work
and so this is just scratching the
surface of what people are doing with
the Gans these days it's really cool I
would encourage you to go on Google and
kind of check out some the other stuff
that's happening that's it thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>