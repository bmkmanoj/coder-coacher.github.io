<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Pythonic Code, By Example | Coder Coacher - Coaching Coders</title><meta content="Pythonic Code, By Example - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Coding-Tech/">Coding Tech</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Pythonic Code, By Example</b></h2><h5 class="post__date">2018-05-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/o0LohkA3UR4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so let's start this discussion by
thinking of writing Python in code and
working with these ideas the pythonic
code as empathetic ways of working with
your coworkers
all right how many of you came from a
language like C or Java or C sharp a
decent number right when you first learn
Python you probably thought it was this
really simple thing that you could learn
right away like oh I spent a weekend now
I know Python right you now know how to
do things in Python but you don't know
Python right and so a lot of these ideas
are sort of algorithms or ways of
working that you might come from another
language and then write code that way
until you know better all right so these
are ways that you can help your
co-workers or maybe yourself become a
little bit better at writing Python the
way it was meant to be written so let's
start by just defining you what is
pythonic right this is the question
people often ask when they come to
python like i hear this term pythonic i
know it means it's better but what does
that mean
so every language has idioms or ways of
writing code that is sort of accepted by
the community right there's many ways to
write programs and implement algorithms
and so on but there are ways that are
more right in there ways that are less
right for the particular language you're
working with and for Python I think it's
especially important because it's such a
simple and readable language that when
you use it wrong its stands out more
I guess rather than say let's say C
right so when we write code that
embraces these idiomatic ways of working
that's what Python code is right so when
you write code like this there's many
many advantages to it first of all
you're taking advantage of thousands of
very smart developers years of
experience I say thousands not millions
even though there are millions of Python
developers not every one of them is sort
of contributing back to open-source
contributing back to the community but
at thousands hundreds of thousands I
don't know but it's really great to
leverage what has worked for these
experienced developers okay so when you
take it
Vantage of these idioms of the language
you're working the way that these people
have found to be the best you're also
writing code that is expected by Python
and it's tuned to run that type of code
right you could create a sub list by
slicing or you could create a sub list
with the for loop slicing is probably
better it's expected by the language
things like that now I say C Python not
general Python because there's
ironpython Jathan pi PI
Python net micro Python there are many
things I'm not in a show saying that's
optimized for all of those right
although they all have some similarities
but certainly see Python the main one
it's also important that it's easily
read and understood
so when you see common patterns right oh
I see
this list comprehension you immediately
know what the intent of that whole block
of code is before you parse all the
symbols right
but if you do something non pythonic you
have to like go through and analyze how
that code works right so that's not so
great it's often cleaner and simpler so
what I'm going to show you now is a
bunch of examples of how could get
simpler and easier probably faster
things like this now these are all the
obvious benefits these are like your
benefits when you write more idiomatic
Python however there are broader non
obvious or less obvious things as well
for example if you run an open source
project it's easier to get people to
contribute to your project if it doesn't
look like a big mess if it looks like
nice code if you like oh if I work with
this project I'm working on some amazing
code by smart people you know one like
the probably the example that stands out
strongest is PI P I write you know the
thing you use when you say pip install a
thing that has been around for many many
years and it's had traditionally a hard
time of getting contributors the reason
is it's not built on the traditional one
not built on flask or pyramid or Django
or any of those things it's just some
like homegrown HTTP the listener socket
thing and it's it's basically like
thousands of lines of code in one file
and people come along to contribute to
pi pi pi pi and make it better and
they're like whoa I don't I don't wanna
work on this this is them
I'm out and so they're actually
reworking this it's a major project at
at PSF to recreate pi pi now you have pi
pi org and they're finally starting to
move that over that's written in pyramid
and using modern idioms and guess what
they have more contributors the exact
same story applies to you if you work at
a company right you want to keep your
best developers don't make them work on
crappy code right let them work on
amazing projects and so this works
either open source or closed source
there's the same benefits I think all
right common question always these socks
can I get the code that you're gonna
write yes you can get the code it'll be
at github comm / Mike C Kennedy and then
stuff after that I'll put this back up
later all right are you ready what I
hope to do is just show you a bunch of
examples that are you can take as a
broader inspiration we're not going to
touch on everything that might or might
not be pythonic but we'll start with
some real simple examples and we'll get
increasingly advanced to stuff that
probably a lot of you have not used
probably not seen maybe okay so let's
start something real simple string
formatting how's that good you guys like
it
is it gonna run its gonna run badly type
error but haven't technically it runs so
it'll run it'll say no age is a integer
you can't even do this so we fix this of
course stir int much better all right
this is good no this is not good this is
the kind of code you might write if you
came from say JavaScript or C sharp or
something you tried the top one it
doesn't work so fine we'll do the bottom
one I guess Python is a crappy language
that's how we have to do it no it's just
doing it wrong all right Joe you can use
the old older style percent format as
well but certainly today this is sort of
outdated in the modern Python sense but
this this still kind of okay but I
wouldn't say that it's so great so what
do we do well a lot of it starts with
stringing up format right so here we can
format the name in the age get this to
come out it's great if you don't care if
you don't care about reordering it you
can just put curly curly you don't have
to say
the name nothing like that this is great
if you want to do replica repetition or
reordering of the arguments you can say
one you know hi my name is curly one
your hi I'm curly one years old my name
is curly zero yeah curly one years old
things like that that's pretty nice if
you have a dictionary or you want to use
keyword arguments you can do a little
better you can say format and give it at
either a dictionary that you're
expanding the key words or just keyboard
arguments and then you could say on
curly day I was working that curly
office and this is really nice because
at least with the keyword argument
version you can test that it's working
right it's very easy to read however all
of these things have been replaced by F
strings how many of you use F strings
for the record about third I would say
so very cool these are great right
so with F strings we have the shortest
way right you just say F quote and then
in the curly braces go arbitrary Python
expressions here you can see we have
curly name and we have curly age plus
one like next year I'll be that alright
so this is really cool because the
linters can say actually that age is not
defined it's called years or something
like that right so you can actually
check that the formatting is gonna work
alright so here's a real simple example
of how you might start out how you might
get better okay these also happen to be
the most high-performance way to create
Python strings as well so very good all
right merging dictionaries let's let's
take a some kind of web app I've got a
web app and data is coming into your
application from multiple locations you
have the URL which has the route in it
you know like my server slash user slash
7 right that 7 is passed as like say a
user ID or just ID here in the query
string you might have question mark ID
equals something in the forum posts you
have data coming back so you want to
just create like one source of truth
like okay well if use all these
different places I get this information
let's create one dictionary that's like
the answer and we want to have a
priority here we want to have routes
have the highest priority something
appears there first we want the data to
be there query to have the
Louis because people can just put
question mark junk on the end and mess
with your site and post is in the middle
so how do we do that well it's cool we
write some loops we're gonna create this
new dictionary when you go through first
the query let's copy the values over
then the posts to copy the values over
and then the route and copy the values
over and because the order we have the
ID that showed up in the query is being
overwritten by the one in route so we
have our priority right pythonic not by
chthonic now so there's a couple of ways
we could do it obviously there's update
and copy so I could go and create this
in one that I could say m1 update with
the query update with the other but
there's actually a better shorter way we
can do this we do that how many are you
familiar that expression and 28 25
percent okay so this does exactly the
same thing it recreates a new dictionary
called m1 copies all the values for
query over copies olivera's proposed
over and route in the thing that goes at
the end has priority over the thing that
goes before it so exact same thing much
much simpler right okay so those are
interesting
speaking of dictionaries something
closely related to them are these
keyword arguments so here we've got
we're going to connect to our database
and let's see we're gonna give it a few
pieces of information we're gonna give
it the username the server whether it
should use replication and whether it
should use SSL so we're gonna call it
down here connect em kennedy's user DB
servers that yes use SSL true use
replication false the wait is the other
way around which was it was that a
problem
why is my company in the news as losing
all its data so that's that's okay some
of the time but like the last two
true/false values which is which it's
not totally obvious so we could write
this slightly differently it's a little
longer but super obvious right we could
say user is M Kennedy servers that
replicates that use SL is that oh okay
let's switch those maybe I don't know
have to decide what you really want this
is cool that we can do it and we've been
able to do it for
did you know that you can force people
to do this so we rewrite that function
above and we put that little star right
there that tells Python you must write
the bottom one that's an error that's
fine
how many guys know that star did that 20
percent is that the same 20 percent
every time you guys are awesome okay so
this is really cool you can say this
function is so super important I want
you to call it that bottom way and if I
try to do it the way where I don't use
the keyword arguments it says you passed
for positional arguments to this method
zero were expected error right really
cool okay so this this little star of
required keyword arguments is super
awesome all right here's a function that
defines the Fibonacci numbers any
algorithm in computer science has to
somehow involve the Fibonacci numbers
right 1 1 2 3 5 8 so on so there's a
problem with this so right it's not
entirely accurate how many numbers are
in the Fibonacci numbers infinite right
how many are here not infinite well the
problem is if I try to pass some kind of
infinity or something really really big
for limit it's going to take that numbs
list and it's going to just keep filling
it up until you run out of time you run
out of memory something like that ok so
we can obviously fix this by turning to
a generator now we have an infinite
version of it that is actually much more
high-performance than it was before as
well you guys use yield yield yeah
awesome I'd say about half yield is
awesome so this is really great
sometimes though you want to do
recursion so if I'm working with like
any kind of tree data structure a really
natural way to work with it is through
recursion so here I have a function
called get files taking a folder it'll
get all the files and then look for
files in the subdirectory and notice
down below it's actually calling itself
again but with the subdirectory not the
top-level directory right that's all
good and this is a generator so it's
super efficient however you can also as
of you can also use
yield from right so yield from says here
is a generator take all of the items and
give
back so what we're saying in the first
part is well if it's a file here's an
item from the collection I'm looking for
here's an item that goes in my
collection when you get to yield from
you say here's a bunch of items in my
collection just add them all to what's
get in return
apparently my mouse is tired okay so
yield from really cool thing all right
so there's these three of these sorry
these four were the first four because
they have an interesting common thread
between them all the common thread so
the common thread is that they're all
only available to you in Python 3 right
not legacy Python modern Python so
there's been many examples of I would
love to use this library but it's only
available in Python 2 these I propose to
you like these are amazing language
features that are only available to you
if you switch to Python 3 and I think
this is the move that's actually kind of
the momentum is already going it's going
downhill but I just wanted to point this
out as well all right a couple others
suppose I have an iterable or some kind
of thing that is not not a list so I
can't call Len on it okay so here I'm
going to like a data layer I'm saying
give me all the measurements that are
higher than 70 I get like something back
that I can loop over but it's not a list
so Len doesn't work how do you count
those yeah make a loop that's what I
didn't see it was fine totally awesome
so we could create this number we could
loop over it it will add up you don't
have to worry about whether it's a short
and enter a long it's gonna overflow and
then that stuff it's fine right well
there's a better way what if I have this
and I can do it in one line I'm coming
over here and write a little inline
generator that says I'm going to sum up
the number one for each item and by the
way Python makes me put a thing there
but I don't care about it
so I'm gonna put underscore right and in
Python when you have an argument that
you don't care about and you want to
tell Python I don't care about you but
it has to go here underscore right
really really nice feature okay so this
is good let's talk about slicing slicing
is amazing it's something fairly unique
to Python and so on so let's go back to
our our finite Fibonacci thing we're
gonna turn the list and I'm gonna get a
bunch back maybe I only want the first
five so we can write this cool little
code here go to that call the function
bracket
you know either zero or nothing : 5
gives me a sub list yeah 1 1 2 3 5 cool
right what if it's a generator and I
tried the same thing good no good no
good
a lot of thumb down generator object has
no attribute and under get ID on that's
a boy I thought slicing was cool and I
could do this but apparently it's only
sort of cool
well itertools brings slicing back for
generators and other things that don't
have a Len on them right so if you want
to do the same thing as we did before
you can just import itertools and say I
slice and what do you get back same
thing
cool right ok so where where does this
inspiration for what is pythonic come
from right I gave you sort of some of
the benefits at the beginning but many
people point to the Zeena Python by Tim
Peters and they'll say well if you don't
really know what you should do you
should just type import this and you get
this literally what comes up right this
is awesome another amazing thing you can
type is import anti-gravity I don't know
if you ever done that you need to do
that but this this is more applicable
right now so import this and it says a
few things like special cases aren't
special enough to break the rules right
that's good that means we kind of decide
upon one way doing things and so on
although practicality beats purity so
these are this is a bit of a tension
like don't do this except for when you
should do it ok so I'll show you I'll
leave you guys with one final example of
where where you might make this
trade-off and what we might think about
making this trade-off all right so
there's this really cool blog post that
came out a while ago called hacking
pythons memory with slots
how many of you know what dunder slots
means this is
15% okay so this is really amazing it's
definitely a way to break the rules but
to break them in an interesting and
productive sense so there's this company
that does Hotel sort of recommendations
and travel stuff called oyster I'd never
used them but they have a cool blog post
so they were running all sorts of
caching and stuff on their servers and
their servers were using about 25 gigs
of RAM and then they said oh and we
change this one line of code and we
saved nine gigs of RAM per server and it
was faster
Oh what was that one line because that's
kind of cool right all right so let's go
let's go fool around with us for a bit
how are we doing on time I got a few
minutes this will work so every bit of
code that you saw us write saw me talk
about rather is available like here's
the strength stuff here's the dictionary
stuff so this will all be in the repo
but the part I want to focus on is this
last one here so the idea is we've got a
traditional class which I'm calling a
mutable thing not super interesting but
it has a initializer it takes four
arguments it stores them right there
yeah totally standard however when
people come to Python from languages
really especially the compiled languages
like C++ or Java or.net or something
this this expression here is is
mysterious like what does this mean
you're assigning to a variable the
variable doesn't exist but after this it
does of course there's this convention
of creating things like this but if you
come over here and you make a class and
you define a dunder a net for it
like that and you create one of them
let's call there's a little a oh yes of
course one two three and let's do a
little B put a different value there
that really just routes under to the
dictionary right pretty straightforward
yeah Kim just sick how's that so we have
this dictionary but this little B also
has this dictionary right but the thing
is they're not the same every time you
instantiate an object you're
instantiating the dictionary and the
keys are copies of the fields yeah
that's fine that lets me go along and do
things like this now I can make it
dynamic and add stuff to it however if
I'm not going to do that I'm gonna have
millions of those in memory what I want
copies of the fields in memory millions
of times probably the answer is no so
basically that's what slots is it's a
way to say these are the fields I'm not
going to change them please don't make
copies of the name all the time there's
going to be these three values or
whatever okay so here's a traditional
class which I'm calling a mutable thing
and then there's this one all that I've
changed is that little bit right there
it has dunder slots set to the four
values and check this out if like I take
away this D you can see there's an error
right here you can't assign to this
because you've declared it only has
three things a B and C and there's no D
and there's no way to a Daddy okay and
there's a run time error like no you
can't a daddy has slots don't do that
okay so this literally line 26 that's
the line and the assumption is I cannot
do that a dot fun equals true retro
actively I have to agree upon what goes
in it but that's how most code works so
what we're gonna do is we're going to
create a bunch of data a bunch of these
objects
how many check this out this is kind of
cool let's put the underscores here all
right this is a Python three six thing
think so we have a million and we're
gonna create a million of them and we're
gonna use first a tuple which is okay
way better is a named tuple then I'm
going to create the regular class and
finally we're going to create the one
that has the slots we're gonna look at
two aspects how long does it take to run
how much memory does it use to do that
okay all right so let's let's go ahead
and run this first one here and it's
running and it ran in half a second so
I'll keep a little little history here
for you to pull 0.5 seconds you know
that's all right and let's see how much
memory it has that's not running so
we'll come down here
we'll come down here and we'll say
Python it's hard
okay so 209 Meg's let's just do it real
quick for the others let's go down and
say you know what tuple is fun but we
all know that named tuples are way
better what's the trade-off here alright
it ran in 1.4 seconds so three times
slower granted a million items that's a
ton name tuples equals one point five
sec and memory 216 a little bit worse
but not too bad I'm willing to make that
trade-off if I get better usability so
on how's it work for a regular class
let's try it on this one this is like
just no-nonsense standard Python class
about the same amount of time
however in memory 293 so class 1.5
memory is 293 to 93 now final thing in
this presentation put some numbers today
will it be faster do you think
significantly not significantly how many
people say much faster okay 40% I'm
gonna take the opposite to mean
not so fast so so we'll go over speed
memory it seems like it's gonna be
better right if we don't create 1
million extra dictionaries with 4 keys
in it it seems like that's less memory
if we just don't do that so that's
interesting but think about like what
would be the most efficient
representation it's got to be like the
non named tuple right it can't how can
you get better than the non named tuple
all right
that's right
and time a little faster so you're both
right that's awesome and over here for
memory we have 201 which is less than
even the name tuple alright so here's
one of these although practicality B's
parity right it's you probably shouldn't
do this
slots thing almost ever but if it'll
like let you run half as many servers
maybe you should do it every now and
then write things like that all right so
this was just sort of a exploring the
whole import this alright so all you got
to do thunder slots name the things off
it goes and there is no dunder date
right there would be like an attribute
error or something if I tried to print
it out there's no dunder dick all right
so that's it guys do you want to get
more stuff like this listen to my
podcast talk Python the the source code
is up already
I'll zoom in on that and actually have a
course at talk Python data FM / pythonic
that has like 52 of these things so
that's interesting check that out</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>