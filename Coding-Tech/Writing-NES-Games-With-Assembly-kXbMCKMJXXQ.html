<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Writing NES Games! With Assembly!! | Coder Coacher - Coaching Coders</title><meta content="Writing NES Games! With Assembly!! - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Coding-Tech/">Coding Tech</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Writing NES Games! With Assembly!!</b></h2><h5 class="post__date">2018-01-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/kXbMCKMJXXQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right that cool slider so yeah my
name is Christian I'm going to be
talking about the Nintendo so I'm from
Canada from Montreal thank you
hello livestream and I am a ruby
developer so I build web apps full time
but in my spare time I I tend to hack on
random stuff because my brain does that
and for the past three months there
random thing I was toying around with is
the Nintendo it's not because I was
playing in Nintendo it's because I want
to understand how it worked so it all
kind of started I guess I was like
sleeping and for some reason I thought
about the Nintendo and I started asking
myself how it worked and at first I just
want to understand how like all the
little parts work together to display
pixels on a screen but then I went down
a rabbit hole and I eventually want to
display my own pixels on a screen so
here's sort of like the three three
month journey that I'll take you on so
to answer my first question this is what
the inside of Super Mario Brothers looks
like they're called ROM boards they're
called ROM boards because it's basically
just two ROM chips and a ROM chip is a
read-only memory so the chip on the
right is called the program ROM and this
is basically has like machine code this
is actually like the code for Mario and
on the left side you have the character
ROM so character ROM is just graphics
for the for the game so the first first
thing I did was I I wrote a little
program to extract the graphics from a
ROM file and it's actually a really fun
exercise if you you want to do it it's
just a very simple binary format and
it's really well documented it's really
fun anyway but not all the ROM boards
look like this so these are a bunch of
different ROM boards so Nintendo when
they when they built the original
Nintendo they knew that technology would
get better over time so they they made
it so that the cartridges can take
advantage of this this advancement so I
don't know if you're not
familiar with the Nintendo Nintendo
didn't have any storage so the way the
way you would play a hard game is you'd
either have to leave your intended on
overnight for many days or then the game
would provide you a way to input a
password yeah the password a very long
password for some games but then Zelda
came along and Zelda introduced Zelda's
cartridge had a battery in it and the
battery was powering Ram just it's kind
of mind-blowing to me and this battery
apparently last 6 years so if you still
have zelda today well apparently you can
you could just switch out the battery a
really cool stuff then I started going
down a rabbit hole so this is my first
program and you might look at this and
be like wait this is not a program it's
a blank screen like no it's not a blank
screen it's a black screen it actually I
am proud of that black screen because
that black screen took me a long time
I'm a ruby developer I I work with
high-level languages I I am a
self-taught developer I didn't go to
university I never done assembly before
and yeah it took me a while to figure
out how to display black screen had to
read about the NES which is so the NES
was released in 1985 so just finding the
information about that was was kind of
tricky and then I had to find tools to
write assembly for the NES and that was
kind of tricky too anyway
fun times so I was learning this with a
friend and he was kind of doing his own
thing on his side I was doing my own
thing this is kind of like oh jeez this
is the wrong slide doesn't matter I was
talking to my friend and this okay
spoiler alert this was the next the next
kemal stone anyway I have a ball that's
like on a screen and I'm like oh my god
it works
and he's like no way oh my god and I'm
like yeah oh my god and then I was like
wait a minute isn't
is it is it normal that we're getting
excited about displaying a ball yeah
totally so the way so the NES is powered
by the 6502 CPU which is the same thing
that powers the Apple 2 and other other
retro consoles so it turns out you can't
really use high-level languages for the
for the CPU because it's 2 megahertz
it'd be far too slow so instead you got
a you're gonna speak its language you
got to speak machine code to it I don't
know about you but I don't want to write
hex code all day like I'm used to having
like a high-level language so this is
where the CC 65 tool chain comes into
play so this is basically an assembler
and a linker and the linker will give
you any s ROM files they can then run on
emulators and this gives you this allows
you to write code
I say code because well I mean it's
still super low-level it's not the code
you'd expect for like it's not a
high-level language or anything so you
can you can read and write the memory
you can add and subtract and you could
compare numbers and then you could jump
around your code based on those
comparisons so it's very very limited
and what the CPU will do is it will
essentially just go instruction by
instruction it'll execute your code and
and that's that's that's what you have
to build a game so yeah spoiler alert
showed you this earlier but this was my
second milestone I managed to display a
ball and it was awesome I was so happy
so what I had to learn to display this
ball is what what's called the picture
processing unit and this is basically
the graphics card for Nintendo it's
capable of displaying at 256 by 240
pixel image of which you lose around
five percent of the image because of the
the overscan of the old CRT screens you
can't use RGB I learned that so you're
actually limited to a 54 color palette
and you can only use 25 colors at a time
so super limited
yen yes wasn't powerful enough to
display to let you render one pixel a
time so instead the screen is divided by
into 8x8 tiles so you can actually
control
retile you have two layers you have a
background later and a sprite layer and
sprites are just 8x8 objects with an XY
coordinates and it turns out to build
games all you have to do is right there
to the right memory address just kind of
cool you don't have function calls you
just write to the right spot and that's
how you display stuff so milestone
number two we're three sorry the ball
moves and it bounces off edges I was
stoked so here's my conversation my
friend I'm like sending the video and I
wait he's like oh my god wait is that
real and I was like yeah that's real
he's like no way I'm like yeah it's real
so the way what I have to do to get this
working is I needed a way of knowing
when time passes right so it turns out
the NES renders at 60 frames per second
and between each frame you have what's
called a vertical blank and you have
like a small period of time where you
can prepare the graphics for a next
frame and this will trigger an interrupt
so an interrupt is just a way for
something to tell the CPU hey like stop
and go here so if I have this infinite
loop
that's just incrementing numbers all the
time and the nmi interrupts triggers
well it'll bring the clip the program
counter to the interrupt and then I
could do my stuff and then I can return
back to wherever wherever I was before
the interrupt so milestone before yes I
learned how to read controller inputs so
it turns out controller inputs are just
a special memory address that you can
read from which is pretty awesome and it
turns out and then the Nintendo only had
eight possible buttons which fits really
well in a byte so it turns out when you
press a button it just toggles a bit and
if you press two buttons will toggle
both bits and so what you can do in
assemblies you could read the right
memory location and then you could do
bitwise operators to like see if a
buttons pressed or not pretty cool
milestone number five
I'm playing against a robot it's a very
unfair robot because all the AI does is
set the Y position of the paddle to the
Y of the ball so I can never win but at
least I can I can test my program and
make sure you know the bounciness works
and all that stuff tooling turns out
there's a popular emulator called
FC u X I don't know I don't know what
that means but it turns out the Windows
version of it has a debugger I don't I
don't have Windows I run on Mac so I
have to use wine to to run this emulator
this version of the emulator and it
gives you a really cool debugger you
could set breakpoints you can watch the
memories so if you see I don't know if
it's clear but you can see like the
memory justice changing that's because
you're you know the ball is moving
around and paddles are moving you can
see all this really helpful when you're
working on assembly code because you
can't do console.log or stuff like that
right
turns out this emulator has support for
Lua so Louis a scripting language and
you can advance the frame you can read
and write to memory so you can do cool
stuff like you can you can overlay stuff
on top of the UI to help you for
debugging but then I was like wait Lua
can you do unit testing with Lua right
so yeah turns out you can so I wrote I
wrote some unit tests to make sure my
game works and as I develop it I can
make sure you know it I don't introduce
any bugs so yeah two tests yes all right
so in terms of like resources there's
this really great wiki called NES dev
that basically explains everything about
the Nintendo and I I found like learning
assembly was really hard to grasp at
first and it turns out the Nintendo is
really old and Raziel a whole bunch of
different emulators for it and they're
all open source so I ended up finding a
go emulator and whenever I had
understanding how the 6502 assembly
worked well I just opened up the
emulator coded and and figured it out
kind of read it so next steps well I
want to you know just improve the game
have a title screen I eventually want to
put it on an actual cartridge I don't
know how to do that yet but I'll figure
it out
I want to open-source the game so that
other people that want to learn assembly
and 6502 can do it and I'm going to be
starting a YouTube channel and really
going in-depth into how I built this
game really taking the viewers hands and
going step by step on how to build a
game like this so my name is Christian I
hope you like to talk that was it thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>