<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Who Is Spying On You? How Can You Spy With Python Too | Coder Coacher - Coaching Coders</title><meta content="Who Is Spying On You? How Can You Spy With Python Too - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Coding-Tech/">Coding Tech</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Who Is Spying On You? How Can You Spy With Python Too</b></h2><h5 class="post__date">2017-12-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/i8YSaW2tx-s" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so the agenda today I'll first give a
quick overview of like who is doing the
spying but then I'll give some
historical context about what they've
been doing and how we all got here to
where we are today followed by how the
spying is being done and then try and
convince you why you should care and
I'll finish off with how this can be
mimicked with a few Python tools so
let's set the stage about who all is
involved so we have the five eyes which
is the US the UK Canada Australia and
New Zealand while there are multiple
agencies within each country that are
involved in the data sharing the
predominant ones are the National
Security Agency in the u.s. the
government communications headquarters
in the UK the Australian signals
Directorate Canada's communications
security establishment and New Zealand's
security intelligence services service
and a government communications Security
Bureau I think it is and we then have
nine eyes which includes France Denmark
the Netherlands and Norway Germany felt
a bit excluded so we now have the 14
eyes as well including Germany Belgium
Italy Spain and Sweden then we have the
41 eyes just 14 eyes Plus that those
that participated in the u.s. coalition
in Afghanistan starting in 2001 so
visualizing this can make it seem that's
a bit difficult to maintain one's
privacy so you might be wondering how
exactly they are doing that and so
basically they're drinking directly from
the hose so Tier one Network the
backbone of the Internet allows vast
amounts of data to pass via the simplest
path Tier one companies include level
318 T Verizon Deutsche Telekom and about
15 others and some even on their own
transatlantic and trans-pacific cables
so major companies like Facebook
Microsoft Google tapped directly into
these tier 1 into tier 1 via edges or or
they to own their own like under the sea
cables and so the NSA
does like the same thing they tap the
edges shared with Tier one companies
also probably by brute force I couldn't
help but use an xkcd comic here there's
the program called muscular that taps
into Google and Yahoo directly so I
think some is also done by force and so
now you might be thinking why does this
matter and why should I care so first
off there's a lot of unanswered
questions and the first one that I have
is how do how do these companies not
notice being backdoored either their
security sex or their lying and they're
denying cooperation and then how's
foreignness determined am i being roped
in because i interact daily with non-us
citizens or maybe because i'm here in
new zealand are you now a target because
you're one hop away from me what is done
with data accidentally collected on
Americans there have been articles of
the NSA spying on ex-lovers and tracking
people's porn habits and finally how
secure is this information whether I'm
foreign or not if these agencies are
able to crack encryption I'm sure that
there are black cats able to do the same
or perhaps more likely I don't know if
their database admin has actually
changed the default password so maybe
you're thinking so what I've got nothing
to hide I am NOT a criminal
well then I'll ask you do you have
curtains or blinds in your windows maybe
you know let me see your credit card
bills or your text messages maybe you
lead a boring life and are willing to
share all of that but if you've got
nothing to hide and that quite literally
means that you're willing for me to
photograph you in the nude and I get all
that rights of those photographs and I
can show them to your neighbors so maybe
you're thinking it's not like the NSA
really cares about all that well there
are some examples of metadata that they
do pay attention to this particular
slide is
from the e FF presentation from 30 c3
and 2013 so they know that you rang a
phone-sex service at 2:24 a.m. and spoke
for 18 minutes but they don't know what
you talked about they know that you call
the suicide prevention hotline from the
Golden Gate Bridge
but the topic remains topic of the call
remains secret then they know that you
spoke with the 8th with an HIV testing
service then your doctor then your
health insurance company within the same
hour but they don't know what was
discussed so it's kind of obvious what
they do collect can tell a significant
story and whether or not that you're ok
with allowing unknown watchers into your
life
certainly your call but just because I
have stuff to hide does not make me a
criminal nor should I be a target of
surveillance there's even like a 10 year
old Facebook post that I would cringe at
reading now all right so enough with all
the seriousness let's figure out how we
can do this ourselves this is a Python
conference after all all right so the
media tells me that I need to I need to
look like this you know I feel like mr.
robot or something right now alright so
I think this makes me ready to at least
pretend on a black hat I got my
sunglasses somewhere right all right so
let's do this I'm ready so I use a
couple different Python libraries here
main one being called Skippy which is
just a TCP dump or Wireshark and in
Python the overall idea is just the
wiretapping part with particular filters
so if you actually want to like store
the data and then you probably have to
just click it all that you physically
could and connected native database and
store it somewhere and just do queries
off it so the following is just a proof
of concept of how actually actually
collecting particular information and
it's quite easy
so again prove concept and presented
without warranty I'm not condoning the
use of
traffic's buying or sniffing but if I
were you I would probably go to cafe
with open Wi-Fi networks so a quick
introduction to escapee this makes me
cringe but this is what they suggest
from a port star so here's so I'm
sniffing for TCP traffic basically HTTP
traffic and only getting ten packets so
if we take a look at what that is you
can see you have ten TCP packets and
nothing else and the results of that I
had to snip it you can see a bunch of
information here if we just grab the
first packet we can use the show method
and it gets pretty printed essentially
we can see the ethernet layer the IP
layer and the TCP layer and literally
that is all that we need to know just
playing around essentially playing
around with different filters so the
first snippet and because I want
super-slick code names to I've called
this snippet tempura like tempura but
the food so this particular snippet is
inspired by the execute score program so
basically show me everyone that has
searched for a particular term so I have
offline pcap file and then loading it or
if you were to do it actively basically
a TCP and that host and I've limited to
300 packets or you can save it for later
so if you take a look at the packets I
do indeed have 300 TCP packets if you
look at the summary of them all
here's it dumped out if I just take a
look at one of them I can see that
there's a raw payload there if I just
get the layer and then kind of you know
how when you search for something
there's like Q equals kind of thing or P
equals so I just parse this out of the
raw payload and I was at the time
searching for a Montreal and the second
packet maybe about 70 packets later my
second query was sniffed
I was looking for best chocolate in
Montreal and then the third packet and
the best coffee in Montreal you can see
where my priorities lie so I should make
note that this was before Yahoo send all
of its traffic over HTTPS only switched
over a few years ago so it would be
definitely a lot more difficult if this
was over HTTP that's a snippet to I've
dubbed this omnivore like carnivore
it's a xkeyscore query maybe something
like show me everyone from a certain
country that has visited a certain
extremist for him and for this I did not
dare visit in the extremest form I'm
probably already on a list already but I
didn't want to make it worse but this is
the general approach so I have this
filter of like TCP and some host I had
some data offline already and I have 258
ESP packets if I take the 8th one I
guess you can see I have some payload
information there and I get that and
print it and I was visiting PI ladies
because I'm a good person and so
basically it's as simple as like if the
extremist terms I'm looking for is in
the the raw payload of the data thank
God is false so then I did like a quick
and dirty like trace route function and
this wraps around escapees trace rot
method and then let's see I was trace
routing Spotify and get a bunch of IP
addresses I take those IP addresses and
get the coordinates for each IP so I
have a few and then I'm creating like a
Geo JSON file or blob that is
essentially JSON with some like
coordinate information on top of it so I
have this information and then you can
actually copy and paste this into github
gist functionality and they'll
automatically render it so you can see
and I was actually in Canada when I was
trace routing Spotify calm
located in Sweden and you can see that
hops actually went through I think
Netherlands and Colorado so even though
at the beginning and end was choose to
non-us countries the fact that it goes
through the u.s. is still under US
jurisdiction which is a lot of happens
for a lot of internet traffic to begin
with alright so snippet 3 name is Teflon
because that's what ash line sounds like
to me so we're trying to answer the
query of give me all the emails with a
term a certain term in the body of the
email and so I'm stuffing for SMTP
traffic I have it offline already and I
have a bunch of packets as you can see
I'm taking a packet the 12th packet and
I'm just printing the wrap a load and
that kind of looks encoded to me so
decode it and it's an email address take
the following packet do the same thing
some encoded string and it's actually a
password prompt the next one I take it
and I wonder what happens when I decode
it and some password this is just sample
data this is not actually someone's like
email and login email and password login
so here this is just a quick and dirty
like filter packet by particular string
so I'm wanting to see if it's someone
mentioned attachment in the email so I
found a query and it shows me that yes
indeed someone was talking about I had
two snippets unfortunately but some was
talking about attachment I'm in this
email alright some before I got to more
I've called this cold brew because since
reading about storm storm brew it give
me the craving for cold brew coffee and
here we're wanting to see chats for a
given user
during a certain time frame here I'm
sniffing for IRC
traffic the standard part of six six six
seven and we get like a bunch of packets
even some DNS queries are in there some
pretty printing functionality you can
see that there's some sort of chatting
going on and here's the same filter
packet by string function that I had so
now I'm searching for particular user
Amarok you can see a bunch of like
conversations from amarak final one I
called this lucky charms after a
shamrock because that's what I craved
after reading about shamrock and with a
snippet and we're trying to mimic the
Hacienda program by finding all
exploitable machines in a certain
country so this IP address it's actually
for the host for the former New York
City Mayor
they are Rudy Giuliani in January the
then president elect Trump had named
Rudy Giuliani to be his cyber security
adviser which I found hilarious the so
the former mayor had this like InfoSec
consultancy like company and the site
actually no longer exists but I was able
to port scan that site before I was
taken offline
and you'll see why I think it's
hilarious in a second so we scan it
using n a Python a map library and I did
include the whole thing here but we get
back a list of exposed ports and
services including OpenSSH version
released ten years ago anonymous LDAP
and an expose my sequel database we also
could see that there that the site that
was running was a five year old version
of Joomla with unpatched vulnerabilities
I'm so yeah with this kind of
information you could easily figure out
what you want to exploit it's like not
like all that information is out there
to begin with so um if you want to take
a look at what this a type II address
points to doing some getting some
pertinence again and created to you JSON
and putting that in github we can see
that Rudy Giuliani's host was in Denver
okay so um hopefully I've sufficiently
scared you
perhaps you're architecting your own new
bunker with some tinfoil hats I'm Ken
goods and maybe some signal scramblers
or maybe I've inspired you to become a
script kitty yourself just don't blame
me if you're caught I'm the purpose of
this talk was to both talk about what's
going on in the world as well as convey
how easy it is to pick up the stuff even
if you're not an aspiring black hat as I
mentioned the beginning this talk is not
to teach you how to protect yourself
because in all honesty and I hate to say
this there isn't a corner in which you
can hide and there are certainly
provisions one can take but as I say in
the security industry and the defensive
side will always be on the losing end of
this fight as there are always
adversaries finding new ways to exploit
things we very we very well might enjoy
all like what technology has brought us
and for instance we're able to work from
home without pants or stalk ex-lovers
with like Facebook and Instagram and
whatnot we can even hack together your
own script Kitty stuff like me but it's
essentially up to us to keep this
conversation going and being complacent
and ignorant and we can't just blame
technology because we essentially are
the ones that give technology its
purpose so so again unfortunately I have
no advice on how to protect yourself
just to be more vocal and and so with
that I will close this with a pretty apt
quote from Martin de Muller first they
came for the Socialists and I did not
speak out because I was not a socialist
then they came for the trade unionists
and I did not speak out because I was
not a trade unionist then they came for
the Jews and I did not ask me go because
I was not a Jim and then they came for
me there was no one left to speak for me
thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>