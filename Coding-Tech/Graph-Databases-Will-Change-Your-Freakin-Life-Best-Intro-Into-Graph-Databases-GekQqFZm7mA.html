<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Graph Databases Will Change Your Freakin' Life (Best Intro Into Graph Databases) | Coder Coacher - Coaching Coders</title><meta content="Graph Databases Will Change Your Freakin' Life (Best Intro Into Graph Databases) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Coding-Tech/">Coding Tech</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Graph Databases Will Change Your Freakin' Life (Best Intro Into Graph Databases)</b></h2><h5 class="post__date">2017-12-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/GekQqFZm7mA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so yeah this is a talk called graph
databases it's gonna change the freaking
life
so the the question really is what what
are you talking about what what is what
is this thing what is it graph database
and you might say oh hey I've got a dope
visualization for you dawg that's what
I'm talking about this is not correct
not what that means graph database is
about graph theory in math and stuff and
I'm a web developer for the last say
about 20 years I was told there wouldn't
be no math that's why I got into this
gig so that is I mean that that's kind
of what we're looking at there so yeah
there's math but really it's about data
it's about lots and lots of data and we
have lots and lots see many many data
that we're dealing with this is a kind
of a cool visualization that we've got
done by a guy named Kim Albrecht
which is a actually a visualization of a
graph that ties together galaxies in the
universe in the universe and it's pretty
cool I just thought it looked neat and
so a lot of times you'll hear craft day
basis talked about with say big business
data stuff and it changes Enterprise
things and dynamics and words and ignore
all that it doesn't matter and
under that stuff matters it doesn't mean
anything and zoom in your we all talked
about stuff big we want to zoom in and
we want to think about how do we
represent a thing a thing or an entity
or whatever you want to call it a noun
whatever you want to call that kind of
thing now relational databases most of
us have probably used those if you touch
that kind of stuff if you use anything
with SQL that is to please a relational
database relational databases use a
ledger style structure that's what
they're based on is Ledger's and a thing
is a row in a table that is how you
store a thing sometimes you split up a
thing into its parts and it's stretched
across a few different tables but
generally you have at least some level
of entity that's int that is a row
table and then what you use are foreign
key constraints and those represent
relationships that is just means that in
one column in a table in a row or one
column that's in one row in a table it
has this number then in another table
there's a column that has a number in a
row and if they're equal those things
are somehow related it's sort of an
agreement that is in the relational
database pattern that uses that and it
is a constraint because it says that
these two things have to be the same and
like if this is you can set up a
constraint with that foreign key that
says if you put a value into this column
over here in this table and there's not
a corresponding value in this table's
column over here then it won't work
it'll say it will reject that addition
and that's the kind of constraint that
you have same kind of thing is like well
if it exists you may not be able to
delete the row that's in here because
there's this thing that's attached to it
this way so you set up all these
relationships and you set them up with
constraints and that's the keyword for
relational databases how do you make
relationships between stuff you make it
based on constraints the table structure
was great for things like constraining
input and locking things down it's
really really good at that if you need
something that's really really rigid and
you need something that is very careful
about sort of internally keeping track
of that stuff and constraining the the
things that you can put into it
relational databases do a pretty good
job at that
this can get complex and it can get
rigid when you're representing
relationships though and particularly
relationships and things that are kind
of real-world you might have things like
multi-level joins which are horrible
just just terrible things they are
terrible because they are slow and
because they're complex and it's a
difficult it's a difficult kind of sort
of relationship between how we think
about relationship about how we think
about things in the real world and how
we classify them and put them together
and how we might draw things on a
whiteboard and then how we have to
translate that into something that fits
inside that relational database pattern
we get used to it
because that's what most people do
because they store most stuff inside of
those relational databases so we spent
lots of time there's lots of tools to do
that that's why there's things like
object what was it cuz the ORM object
right for mapping yeah yeah yeah I
didn't do very well in computer science
let me tell you heard that yeah well you
have to have that because there is not a
very good match between how we put how
objects are and represented and how
those fit into the relational database
they're not they have different patterns
for storing and structuring things so
for a second let's talk about property
graphs actually not for a second we're
gonna talk a lot about property graphs
to get used to it
graphs are much much simpler they're a
lot simpler when you think about them
those things that you talk about those
entities whatever you want to call them
you call those nodes or if you are from
the graph theory world you would call
them vertices but in the graph database
world you often call them nodes those
are just dots nodes have properties on
them and in a property graph model which
is sort of the most common one you see
with graph databases they are usually
key value pairs so and also nodes will
have labels and that is how you
categorize something now typically in a
relational database you categorize
something based on what table that's in
that's how you tell what it is in this
kind of format you have a label that you
apply to a node and you say this is a
this type of thing is say a person or a
user or a comment or a blog post or a
tag or whatever you want it to be so an
example of a node might be something
like this and this is a node and it has
a label person and it has three
properties on it has an ID property
which is some kind of unique thing that
we use to identify it if we want to
that's that's
numeric usually
right that a lot of systems or there's a
plugin for many craft databases or
things like that will automatically
generate you you IDs and things like
that
for those kinds of things and then we
have a couple properties on there first
and last name so this would be a node
which represents not the entirety of me
because I could not be summed up in this
circle but a first name and last name in
there and then you've got nodes are
connected together by something else and
those things are called relationships
they also get called edges if you're
looking graph theory
so vertices and edges in graph theory
but if you're talking about graph
databases a particularly we usually call
them nodes and relationships
now relationships are another type of I
don't know you might call it a object in
in a graph and relationships have it
type typically and that's the type of
relationship it is and they often have
it
they usually have a direction it varies
some can be bi-directional some are can
only be unidirectional they have a
direction though that they face and they
can have properties as well so if you
got a setup with two nodes this is a
real simple set up you got two nodes
both of them are type of person to have
that label of person that you've applied
to it so we know that these are person
nodes those are person entities or they
represent those kinds of energies and
they both have similar properties but
they don't have to typically graph
databases don't necessarily enforce
schema upon the properties and then
there's a relationship between them and
it's a directional relationship and that
relationship is child of and it points
from the child to the parent and this
and then there's a property on there of
when that relationship was created which
was 2002 when Griffin Fink ler exploded
into the world so at the end of it it's
just dots and lines its adopt two lines
all the way down from top to bottom that
is what a graph database is it is dot
and it is lines and a lot of ways that
simpler which tends to be appealing
usually want simpler things complex
systems break more so conceptually it's
simpler it's also more powerful and it's
more powerful specifically when the
meaning is in the relationships when you
find a meaning in the relationships
between data so sometimes those are
direct relationships and it'd be like
from person a to person B something like
that and those direct relationships are
not particularly harder to do with
relational databases it does not like
the sort of distance between cognitive
difficulty and implementation for
something like this and the speed
increases that you get with that sort of
thing is not particularly all that
amazing with a so you could do that in
relational databases pretty fine we have
lots of tools for those kinds of things
it's pretty simple to do sometimes you
have indirect relationships though so
actor a is related to actor C but
they're related not directly but
indirectly so how do we find that kind
of stuff and so these kind of indirect
relationships particularly these things
are harder to to to do traverse that is
terrible these are harder to traverse
with relational databases to jump across
these things and find these
relationships where there's not a direct
connection between the two things
oftentimes you have to do joins upon
joins upon joins often the solution for
speed sake is to denormalize and end up
having to maintain data in multiple
places and that introduces redundancy
which yes it works lots of people have
done it but it's complex and hard and
there's a lot of challenges with that
particularly if you're trying to answer
questions that you didn't anticipate
when you built the schema in a
relational database and like I said
relational databases are rigid and I
think we you realize that when you start
working with non-relational databases
they're designed to answer known
questions because they're constraint
base and you have to set up basically it
basically it's a big very rigid rule set
says it's gonna have these many columns
it's gonna have these kinds of foreign
key constraints it's gonna have
constraints on this and this and this
and it works well if they're data the
way you're kind of doing it lends itself
to it
when to what you're trying to do and the
questions are trying to answer don't
lend themselves to that it's problematic
it can be put so they're really designed
like I said to answer known questions it
could be very hard to answer unknown
questions questions that were unknown
when you built that structure of that
schema and it can be really expensive to
refactor things to be performant so even
if you can write a query that could do
confine say in direct relationships
between data within the data set it is
probably slow and not and not performing
in other ways to memory and CPU better
all that kind of stuff so let's say
you're the back end EV or the you know
DB person who handles this kind of stuff
and rates these queries that pull data
out of a large data set and somebody you
know the sales person or somebody who's
just trying to do tracking on kinds of
stuff says I want to know how many
people have bought a toaster live in
Kansas and have a criminal record use
the coupon in yesterday's paper
to buy that toaster and you would say
get the hell out as not an acceptable
question you should have told me that
you wanted to do this when I was making
it get out and I think most people who
have ever built a database have had that
experience when somebody asks him a
question and they're like F my life
this is going to be horrible because
there's no way I can do that or if it is
just mine the next several weeks of are
going to be hellish and it's because you
didn't create a schema that they
anticipated that question oftentimes
because there's no way to anticipate
that question there's just no way to
there's no way to know the kind of
question you're gonna ask a year from
now or six months from now sometimes
it's two weeks from now you just don't
know you don't know how things are gonna
change and the nature is that stuff
changes now with the graph you could
answer that question if you have all
that data somewhere in there and there's
some kind of paths between those things
you could answer that question you don't
need to know that was the question
you're gonna answer so you can say okay
we know this person we know what state
they live in
we know if they have a criminal record
one way or another do you think they
don't know they totally know and we have
listings of coupons and we can tie a
coupon to a purchase that ties to a
credit card that's tied to this person
and this toaster was in that purchase as
well and that person is in Kansas and
stuff like that so you can imagine maybe
how those things might be connected
together each one of those things like
the purchase the credit card that was
used the state the person lives in the
person itself if they have a criminal
record you know at the coupon and when
the coupon was used and when it was if
it was applied to a certain payment or a
certain transaction you have all that
data in there and even if you don't have
direct connections between those things
you have indirect connections and with a
graph is specifically designed to be
able to traverse those kinds of things
because that's what graphs do and it
uses math and stuff that I don't
understand but it works it's pretty cool
so and you can add more relationships if
you want to you can say oh yeah well you
know it's kind of a pain I have to write
a really a kind of a complex query it
might be like four lines five lines
maybe what's that
yes so you can add more relationships as
you want and still be performant and
that's what's really impressive you can
start doing that stuff it's an it the
way it's written in the way it's design
is to be able to scan across that whole
network of data quickly so now we get to
that egotistical live query time which
it's not too bad because I just pre
wrote all these and it's gonna be easy
but if you want to see them either gonna
need to squint real hard if you're in
the back or I'm gonna make this a little
bit bigger so I'm gonna command tab out
of here
and go back to this bad boy so this is
this is a database running on my laptop
it's called neo4j it's probably the most
common graph database you're gonna run
it so we're the most popular one like if
you look at graph databases you're
actually like I'm actually gonna use one
new for J is gonna come up a lot I think
it's pretty accessible at my company we
offer neo4j as a service so that's a
thing that we do now up here at the top
please tell me in the back if you can
see or not yes all right
blessed be we're good so we've got a
list of questions up here and that's
what that query is that I've kind of
prefilled in and this is a set this is a
data set of survey data from a nonprofit
that I founded called open sourcing
mental illness if you were here last
year I talked a little bit about it but
this is from the 2016 survey data that
we had and we're I'm just gonna show you
how you kind of extract some different
kinds of data out of that kind of stuff
using graph queries and neo4j supports
this query language called cipher and it
kind of looks like ASCII art to
represent relationships there are other
ways and other languages that are used
to diverse databases a common one is
called gremlin which is a DSL written in
groovy that is probably the second most
common one that you'll see and it's very
different it looks like you have a
fluent interface with like do this dot
do this dot do this dot do this so it's
much more sort of like an object or
in fluent kind of deal this is more like
SQL so to some extent you can probably
kind of figure out what's going on here
it's gonna do a match which is a lot
like kind of like a Select in in in SQL
and it's gonna be a match of nodes of
the type question that wait I have the
label question I'm gonna it's going to
assign in each one of the things the
results that comes back it's going to
assign that to the letter Q that's kind
of a placeholder or variable name so and
then I'm gonna return Q and I'm gonna
order it by a property that's on Q
called order so then I'm gonna go ahead
and just hit play on that bad boy and
this shows me near four J's stuff is
smart enough work and also has C
relationships between the data that
you've returned and this is actually a
network of all the query all the
questions that are in there and how
they're linked together and if I click
on one you can you know you can drag it
around and stuff and just to do this
kind of junk which is it's fun for like
a couple seconds and but if you want to
look at like what its kind of returning
this is really the meat of it and you're
gonna this is kind of hard to see so I'm
gonna make that a little bit bigger
hopefully you can kind of see it's gonna
do a bunch of rows here I'm gonna close
this guy it's gonna return me a bunch of
rows here and each one of these is a map
that represents the entire node that got
returned and all the properties on it so
this is one node question is the field
idea is this question idea is this how
many responses we got back what would
the idea was what the uu idea was which
is Auto it was signed by a plug-in with
neo4j the order is zero if we look at
the text that is completely unreadable
so I'm not going to look at that and if
we look at the code you can kind of see
that stuff down here this is what
actually comes back over the transport
it there are two ways in neo4j it uses a
rest api or in the newer 3.0 versions it
uses also a binary protocol called bolt
either one this is the
data structure you get back which is
just JSON and then you would use some
kind of client to to read that stuff out
so anyway that's a simple query in there
so let's look at some other queries
though and here's a simple one this just
returns a single question and it matches
a property that property is field ID and
this is a particular one that happens to
know it's gonna be have you ever sought
treatment for a mental health issue from
a mental health professional so we go
ahead and hit that and that it only
there's one node it only returns one
note because that's all we've got and it
returns the properties of it that's okay
that's interesting and then let's see
something else all right one more we're
gonna match that same question and then
this is where relationship stuff comes
in this is the query from beginning
here's the tail of it here's the head of
it that's the relationship we're gonna
look for a direct relationship of type
has answer that is pointed in this
direction towards a node that is labeled
answer and we're going to assign that to
a and then we're gonna return Q and a so
this is a one question and all the
answers associated with it there's two
answers associated with it because yes
or no question and so when we look at
the data that gets returned in each row
it sort of builds out the same question
node and then there's two different
answer nodes all right that's all very
exciting and things like that now let's
take a look at something it gets a
little more interesting we match that
same question we have that same answer
but then we have another part of this
path that says I want to tie a person
who has answered that question with that
answer back to that here and this is
going to give us the first 200 people
who've answered that because there's
gonna be about 1500 I didn't want to get
all those back but this is basically
gonna give me everybody who's answered
this question and it's going to break it
out by answer so we have answer 1 it's
and insert one and it's break enough
actually just shows the people I because
I look now looking at this I think I
told you the wrong thing I'm just
returning the a and the piece of the
answer and the person in each row and so
that's gonna return what was the answer
that the person gave and then who was
that person and what we know is like
where it was the refer what was their
user agent stuff like that because it
was an anonymous survey as anonymous as
you can be on the Internet okay so
that's all very interesting but let's
look at something a little more complex
match question has an answer answered
person person lives in country C and
let's do something even that's not
surprising any a relatively easy one to
answer this just gives us rose and I
can't see anything on that let me see
here I don't know if there's something I
think it might be a bug with the see
here let me see if I can change the dark
to light okay I can see that a little
bit better here we can see it's it's
pressing this stuff out so that we're
not returning nodes were and so it
doesn't because we're not returning
nodes or these kind of objects we don't
get a graph representation of
visualization automatically with it but
we get the properties back here q
question a answer C name the name of the
country and how many how many people
from that country answered with that so
one person in Afghanistan said zero or
no one person said yes if we and okay
Australia eleven people said no 24
people said yes so it breaks it out
based on country so that's kind of
interesting maybe here's the thing
which is let me make that a little
bigger and we can see this and I know it
doesn't use the the syntax highlighting
anymore but still hopefully can kind of
see fairly well Holly goes this is going
to give us percentages of the current
diagnosis and it shows us doing a couple
different
things here I just want a count of all
the people so I match people and then
with count P as person's total I pass
that value in then to the next match
which is the thing that you can do with
cypher to sort of filter down through
steps and in this case then what I'm
doing is then I'm getting a count of all
the people who have a current diagnosis
and it done so my next step is I get a
count of that count RCD which is
actually counting the number of
relationships and what comes back then
it passed both of those back diagnosed
total persons total then the third match
is really what's interesting wear a
matching person who has a relationship
to called current diagnosis to a
disorder with count P as count de is
there like the name of the diagnosis
than a diagnosed total and a person's
total and a return all this stuff and
here when I'm doing stuff here what I'm
doing is I'm calculating it as
percentages as opposed to just raw
numbers you of course could do that on
the application side but that's that's
kind of what you're looking at so let's
run that and that gives us these numbers
here and it does that pretty quickly I
think which is sort of interesting you
can see some counts on here 133
milliseconds now that's all very fine
and dandy and real interesting but
here's a more complex thing and I think
it'll show you how powerful some of
these things can get this is the
incidence of self diagnosis without a
corresponding diagnosis by medical
professional
compared to whether or not that person's
employer has provided mental health
coverage so how can I answer that
question if you were looking at this in
a relational database there's gonna be a
number of joints that are probably
happening question to answer and an if
answered self diagnosis and professional
diagnosis all represent pivot tables
then you're probably looking at a
question I answer first and the person
to answer to answer first and a person's
self diagnosis diagnosis person the
professional diagnosis diagnosis and
diagnosis relationship but also likely
be a pivotal table pivot table I'm not
good with that stuff but
help a friend of mine who is much
smarter at those things help me write
that but we did write this out I'm gonna
pull the profile out because that's not
something we need that is a way to
actually sort of like see how things
perform and what was happening but the
first thing we do is we get the totals
so that we can calculate percentages and
that's kind of like how we did that
before and so we take this where we
match a question to a particular field
ID so because we want to we're
interested in what a particular question
we're not returning an answer but we're
gonna get an answer here we have as
connected to a person and then it has
that relation of self diagnosis and a
diagnosis - you can kind of trace
through this thing and see all of the
different levels of a path that you have
to go through here so we get that those
numbers and we get also the questions
all the questions and all the disorders
and if we get those out we query them
just once then we don't have to query
them again later so now we do a query to
get the counts from each answer for self
diagnosis so this is the stuff that gets
kind of interesting so we say that same
question has answer of a so then we're
going to assign each of those answers to
a answered by a person P who had the
self diagnosis D where not had they
don't have a professional diagnosis
where there's not a match between a
relationship of a person to a
professional diagnosis which would be
probably a disorder node that was
sitting in place someplace else so they
don't have a match like that and then we
return the question the diagnosis the
answer and the percentage of people who
matched above with that answer so I
returned question name answer question
disorder name answer text the percentage
of total as percent and then order by
this so let's go ahead and run that so
that is if you line that up that is
depends on how I formatted it that's
five lines of code it wraps a little bit
but this gives us a breakdown then of
okay here's the question it's the same
question every time here's the disorder
they have this is the answer that they
gave that if they have that disorder and
this is the percentage of people who
have that disorder who answered that
question like that
so 33% of people with an addictive
disorder who I said that they're
employed to the question their employer
provides mental health care coverage
says I don't know and this are not only
these are people who self diagnosed with
an addictive disorder these are not
people who and they do not have a
medical diagnosis at all and so we break
those down anxiety disorders Asperger's
and things like that so I break all that
stuff down and we can get percentages
out of that stuff which i think is
pretty interesting and you can do it
fairly succinctly with only a couple
diagnoses which is kind of cool so that
gives us that gives you an example of
sort of how you can do that and let's
pop back into there but I think you can
kind of hopefully you've gotten a feel
for how that works out for you so the
one thing I'd say about this kind of
stuff is that it is powerful and you
could do lots of different stuff you can
find indirect relationships you can find
lots of questions you maybe didn't
anticipate answers for and I think
that's really really cool but it's not
magic it doesn't solve everything for
you you can write queries that are
incredibly non performant and don't do
anything for ten minutes and you can do
stuff that breaks things and that
totally happens and that's certainly
just like every other tool there's stuff
about it that sucks
so they're not magic and they don't
solve all your problems there's some
things that relational databases do
better there's some things that document
databases do better or things like that
but particularly if you're asking
questions about data and it's a really
about the relationships between data or
it involves the relationships between
data they're really powerful and really
nice and sometimes it seems like
witchcraft especially if you have a lot
of data which is very very bueno to me
so there's some links that you can check
out it is for fun and exploration you
can check out craft store calms the
company and I'm CTO at there is so if
you don't want to bring it up yourself
you can bring it up with our trial and
you can ask me questions if you type
into a little web thing web chat thing I
or the CEO answers those questions not
somebody else there's a good example
data that neo4j calm and then if you're
interested in that survey data and
helping us develop an API for that and
doing queries against that kind of stuff
at OSF my open sourcing mental illness
you check it out on github that project
is all open sourcing up there so that's
what I excuse me got for you today
question time and if you got any
questions feel free to ask</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>