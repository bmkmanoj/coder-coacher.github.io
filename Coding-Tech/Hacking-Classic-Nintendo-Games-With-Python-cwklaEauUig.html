<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Hacking Classic Nintendo Games With Python | Coder Coacher - Coaching Coders</title><meta content="Hacking Classic Nintendo Games With Python - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Coding-Tech/">Coding Tech</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Hacking Classic Nintendo Games With Python</b></h2><h5 class="post__date">2017-12-06</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/cwklaEauUig" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">how's it going PyCon I'm Sam Agnew I'm a
developer evangelist at Twilio and I
flew here from New York so who here
likes old video games cool that's a good
thing I think you're all in the right
place so when I was a kid I used to play
my Super Nintendo like every day and one
day my dad trash picked a Nintendo
Entertainment System so I fell in love
with that one too and I kind of always
had like an affinity for classic games
like even when newer systems come out
like I'll still play those but like like
I still have my Super Nintendo hooked up
in my apartment in New York so so all
about those so um naturally when I
started learning how to code and started
hacking on like side projects I'm in my
spare time for fun I kind of gravitated
towards that kind of stuff and I always
thought it'd be cool to like hook up
classic games to the Internet and like
it's the Internet's a magical place and
there's like an API for everything right
so I always thought it'd be cool if like
what if you're playing Metroid and Samus
could order a pizza for you or you're
playing Megaman and you could have it
text your ex-girlfriend whenever you
like lose a life or something like that
right the possibilities are endless
right
so I decided for this talk it's gonna be
a fun one we're gonna have some fun and
I'm gonna like show you firsthand how to
how to you know hook up some old
Nintendo games to the Internet so you
might see on my screen here I have the
fceux Nintendo emulator running and I
have the Windows version of this
emulator running which is kind of
interesting so believe it or not there's
actually like a thriving community of
Nintendo Entertainment System developers
like people who just like make old games
or fun like people are still writing
6502 assembly believe it or not and most
of these developers like I think they
use Windows machines so like a lot of
these like community like tools or
whatever are for Windows machines so I'm
running the Windows version of this on
my Mac using wine because this comes
with some pretty pretty cool developer
tools like like one example this is let
me let me click this debug menu it's
kind of a kind of small I'm gonna click
click this over here and I'm gonna open
this thing called a hex editor so does
anyone heard of a hex editor before cool
so like some people here are
familiar with with such things if you're
not that's cool it's a it's not super
complicated so this this this like
collection of hexadecimal values over
here is a this is basically the memory
of the game in real time like this is
just like what's happening in the game
so if I actually like if I actually
start a game we zoom out you probably
can't see like any other numbers I can't
even so it's not it's not that big of a
deal I'm gonna pause that but like all
these numbers will start changing and
stuff as things happen in the game and
it's just this is what's happening in
the game this is like the memory like on
the side here you have some hexadecimal
like addresses the correspond to address
in the games memory and over here you
have the values right and a lot of times
like hackers will use this this tool to
try to figure out like to kind of take
the game apart reverse-engineer it and
it's kind of fun like you could you
could always like try searching through
this and like finding what address
corresponds to certain things in the
game like for instance if I wanted to
just like edit a couple of numbers to
kill Mario I could search through the
this hex table for like the time up here
I guess like right I have it pause so
it's 395 that's like how many seconds or
whatever unit of time this game uses
that I have left so if I like if I open
up this edit thing and I click find
I can I can think I can assume that like
and I was testing this out earlier you
could assume that like this the 3 the 9
and the 5 are like stored sequentially
in in memory somewhere so if I just
search for like the hexadecimal values
like 0 3 0 9 0 5 I should find something
cool like it found something and over
here like if I unpause the game you
should see these like values are
changing I think because I assumed that
I lost it so I'm gonna gonna find that
again real quick but if like oh no the
the thing changed I should pause the
game again what am i doing I have to
like get that all right so 375 right so
if I change these to 7 now right
so they changed those as zeros
hypothetically mario should die right so
I'm gonna just change those cool so like
I just I just uh just killed Mario from
editing some numbers on a screen that's
my whole talk see ya just kidding
so anyway like you know you can mess
around with this stuff and like a lot of
people will like map out the RAM of a
game by just like if you google any like
arbitrary a Nintendo game like if you
Google like Final Fantasy Ram map you
might find like a table with like oh
this this is the hit points of your
character and this address is whatever
but what else is cool about the Windows
version of some of these emulators is
that you can extend them by writing Lua
scripts like they give you this like
environment so that you can write a Lua
script that runs in the emulator and can
manipulate the game you can simulate
button presses you can edit the memory
in real time these are I think most
commonly used in like the tool-assisted
speed running community so people like
write scripts that will like play games
in the most optimal way and like will
have it press certain buttons at certain
frames or whatever but it's kind of cool
you can have it edit memory too so let
me let me do like some some hello world
kind of stuff let's see I'm gonna I'm
gonna write a file called kill Mario Lua
and so what I'm gonna do is first I'm
gonna fullscreen this make sure my
screen is like big enough I'm gonna I'm
gonna start off with like a quick hello
world I mean I like call this emulator
object I'm gonna write a message to the
screen and it's gonna be like just say
hello PyCon smiley face and then I'm
gonna kill Mario so this is just gonna
be like a like a Lua script that just
prints hello PyCon and kills Mario so I
can call like the memory dot right byte
function and I give it a hexadecimal
address and value and if I like look in
this hex editor and I zoom in more it'll
have like so the address is 0 7f
something let me count 1 to the 0 7 f8
is where the 3 is so that's like f8 f 9
F a so if I just write to that
by zero 7f 8 and if I write that byte as
zero it'll change that to a zero so let
me do that with all three of those
consecutive values 9 and a is 10 in
hexadecimal so now if I go over to this
emulator I think I'm done with the hex
setter now I can run a Lua script looks
like I was already running something
from earlier ok cool so I'm gonna run my
kill Mario Lua and hopefully Mario will
die if I if I did it right cool so a
printed help icon on the screen and we
just wrote some code to to bake make you
lose and Mario super useful as if I
needed help so so that's cool so you see
like we have like a basic idea of like
you can write some code that runs in the
environment of the game that's rad but
what can you do with this I think it'd
be cool to like hook these games up to
the Internet right so what I'm gonna do
is you might you might be thinking like
wow editing the games memory as the game
is playing that kind of sounds familiar
for probably some of you who like had a
specific product that let you do this
when you were a kid there's this thing
called the game genie who here had a
game genie you cheaters well anyway you
could use a game genie and put in codes
and those codes would like to respond to
like memory values and addresses and it
would like change it so you could have
infinite lives or whatever and I think
it'd be cool if I can make a game genie
that all of us can use while I play
games on my computer at PyCon so I'm
gonna be using the Twilio API to build
like a text message powered game genie
type thing where you can text a Twilio
number that I that I'm programmatically
controlling and I'm going to build that
with with flask I bet you were wondering
where the pythons coming in here because
I've been writing Lua so what I'm gonna
do is I'm gonna I need to write a Lua
script that can communicate with my
Python flask app sitting behind a phone
number and I'm gonna use an extremely
advanced sophisticated algorithm what
I'm gonna do is to communicate between
these two Pro
I'm gonna write from a text file in my
Python program and read from that text
file in my Lua program you know not
gonna not gonna write like a socket
server any anything like that just gonna
keep it simple so I'm gonna make a Lua
file called an SMS Lua because like any
s SMS I like puns and I'm gonna start
off by writing a function that just lets
me read from a text file give in like a
file name or whatever and this is gonna
be like a basic file reading function
I'm gonna like create a variable for
that input and that's just gonna just
going to open that file with the read
flag and then I'm going to check to see
if that input is nil because if it is
nil then that file just probably doesn't
exist if it's not nil though I can do
stuff with it so I'm gonna set our like
the input to be this this file and then
I'm going to store the contents of that
file in this variable just like read it
as a string and then I'm going to close
the that file because you always gotta
close your files and now at this point I
have a string variable called content
that just has the contents of that file
I'm going to return that and outside
here I'm gonna just return nil like if
the file doesn't exist so now I can read
from files and what I'm gonna do is I'm
gonna like I'm going to write a loop
that will run on every frame of the game
so so I'm gonna I'm gonna write an
infinite loop here so while true do I
mean this is like my game loop a lot of
times like videogames work on like an
infinite world
it'll like play each frame of the game
and some code will execute while that's
happening and what I'm gonna do here is
at the end of each iteration of this
loop I'm going to call my frame advanced
function which will advance to the next
frame and what this effectively likes me
lets me do is a take programmatic
control of like the game itself because
this is this code is is synchronous it's
not it's not non-blocking
so if I don't put that frame advance
function at the end of each loop it'll
just be an infinite loop running and the
game will be stuck on one frame forever
and that will not be as fun so at the at
the beginning of each loop I'm just
going to read from that text
so I'm going to store the like what
we're gonna do is a you're gonna you're
gonna text my phone number like a four
digit hexadecimal address like
corresponding u address in memory a
space and then a two digit hexadecimal
value and I'm going to write that add
value to that address in memory and I'm
just read them from some text files cuz
you know it's easy way to communicate so
I'm gonna read from address text and I'm
gonna do the same thing for value value
text and what I'm gonna do is on each
frame of the game I'm going to compare
it to like the previous value that I had
for that so like because like if you
text me if like one person in this
audience like let's say you none of you
want to help me out and hack this game
with me if only one person texts like
one time I don't want it to just
continuously write that on every frame
so I'm gonna like have some variables
out here to keep track of those as I go
along and I'm going to compare them to
that so if they change then I'm actually
going to do stuff so so I'm going to
compare these to each previous value of
those so if if that if either one of
these changes then I will do stuff with
it cool right alright so then now if
something changed I know like alright I
need to do something so now I'm gonna
convert them into hexadecimal
hexadecimal values so I'm gonna create
like a hex address thing I'm going to
call this two number function and I'm
just going to give it the the string
version of that address variable that is
just read from the text file and I'm
gonna say like read that as a base 16
integer I'm gonna do the same thing for
the value if I can spell value right
take that yeah cool no do the same thing
here alright and then I'm gonna see if
these are actual valid hexadecimal
numbers because you might just send me
one on hexadecimal numbers and that'd be
that wouldn't be as that would be cool
but you know someone might might
accidentally autocorrect stuff so let me
see if so if any of these are equal to
new then that means they're not
real hexadecimal numbers yes so if
they're both not equal to nil I'm gonna
do that
then I know I'm good to just write some
memory right here I'm gonna call my
memory dot right byte function this is
this is the this is the meet this one
line of code this is like where the real
the real action is happening this is
like the fun stuff memory dot right but
so I'm gonna write the hex address I'm
going to write that hex value to that
hex address and I'm gonna like print out
something I'm gonna print something out
on the screen just so I know like what's
going on I'm gonna print what address is
being written to and what value it is
string concatenation in lua is done with
two dots instead of a plus so that's
what's going on there and then at the
end of each iteration of this loop I'm
gonna update my previous address and
previous value variables to like be
current and that that should be like
that should be all the Lua that I have
to write hopefully I didn't mess
anything up so I'm gonna like open up
this I'm gonna open this up and run that
script and see if it totally breaks cool
so far nothing broke so now I'm gonna
I'm gonna open like address text I was
like messing around with it earlier I
have like a couple of memory addresses
like already memorized in Super Mario
Bros cuz I I guess I'm kind of a nerd
and I just know some memory addresses so
zero seven seven nine corresponds to
like the color palette of the game so
I'm gonna write to that and the value
I'm going to write to that is going to
be 1f so if I write 1f to that to that
to that memory address then the color
palette should change to be like black
and white so write to that
cool all right so my code works so
whenever those files change whenever
someone like writes to that file it'll
it'll reflect that change in the game so
okay I could change it back cool so now
I'm ready to like actually start writing
some Python we're at PyCon after all so
you know get
that they get out of all here so I'm
going to create an app dot PI file and
this is going to be just a like a basic
flask app what I'm going to do here is I
already have a Twilio phone number like
purchased and configured to send post
requests to to a flask app running on my
local machine whenever it receives a
text message but that app doesn't exist
yet so I'm gonna build that now I'm
gonna start off by importing the stuff I
need I'm going to import the regular
expression library because I want to I'm
going to use a regular expression to
make sure you're sending me a
hexadecimal numbers and then I'm going
to import the stuff from flask
I'm gonna import the flask object from
the request object and Twilio Python
library because whenever whenever Twilio
sends a text message to this app i need
to respond with twiddle which is Twilio
set of XML tags and tells them what to
do with the text message and this will
this will generate the XML for me
because no one wants to write XML by
hand and next I'm going to instantiate a
flask app object and now I can create
routes on this app so this route is
going to need just slash SMS and it's
gonna take post requests and whenever a
post request is sent to slash SMS this
SMS function will be called and this is
where I'm gonna this is where I'm gonna
like do all the stuff and write to write
to files in the to communicate with this
Lua script running in the emulator so
first I'm gonna grab the message body
from like the text message so this will
be in the form encoded data of the post
request and the variable name is just
body with a capital B and that is the
actual text that you sent me at my phone
number so I'm gonna grab that I'm also
going to create a variable for like the
text message I'm gonna respond to you
with something to say thanks for playing
put a smiley face in there and I will
say hit ups Agnew shreds on Twitter this
is my Twitter handle it's Sagna shreds
because my name is Sam Agnew so it's s
Agnew and then shreds like on a guitar I
don't want I don't want my line to be
too long so I'm gonna make this one of
those one of those multi-line
strings so hit up sagging shreds on
Twitter for questions cool put an
exclamation point cuz I'm super excited
next I'm going to create a variable for
the error message like so if you send me
like invalid input I'm gonna respond
with something that's not thanks for
playing and respond with something
that's like hey you should enter
something different so I'll say please
enter a I'll say a four digit hex
address followed by go to that next line
followed by a two-digit x-value to write
to that address super descriptive string
and then I'm gonna put some some
backslash ends in there and I'm gonna
give you an example so the one I used
was zero seven seven nine 1f and that'll
change Mario's background black and
white cool so now I'm going to I'm gonna
split this body the message body by
spaces so I'm going to be able to get
like the address and the the value from
your text message and I'm also going to
create a hex pattern that I'm gonna be
able to use to match against those to
make sure that those are hexadecimal
numbers so compiled one of those so
let's see here first I'm going to have a
caret to match the beginning of the
string then I want any character from
zero through nine or A through F or
capital A through capital F so we can
make this case insensitive and then I
want a plus sign because I want this
zero I one or more of those and then a
dollar sign because that matches the end
of the string hopefully hopefully this
is not a terrible regular expression so
now I have the stuff I'm going to see if
the message list is actually like if the
length is equal to two to make sure you
didn't send me like anything with more
than one space in it and if it isn't
then I'm gonna send you my error message
but like be optimistic I'm gonna first
things first I'm going to deal with the
optimistic case and see you if you do
send me like correct
put then I'm going to I'm going to
unpack this list into into address and
value variables and I'm gonna check to
see if those are valid hexadecimal
numbers so Oh accidentally undid that
cool so now I'm going to call my hex
pattern I'm gonna call the match
function on the address and the value so
if it matches with both of them then
we're good and I know we're all we're
all friends and you sent good input and
I don't need to send you like a message
telling you to send me better input cool
so at this point in the code we did
everything like you on your end it's
assumed you did everything right I'm
gonna like take that address and write
it to a text file so I'm going to open
that file I'm gonna start with address
text first and open that with the right
flag and then just write I'm gonna write
the address to that right and then I'm
gonna do the same thing with the value
notice there's like a pattern going on
here right into text files do this all
day
cool so now those those are taken care
of now if if they are not valid
accidental numbers then I'm just gonna
respond with the error message and then
you're just gonna send another message
you try again and I think the last thing
ever it was oh yeah if the message list
so if you send me more than one space in
the message than I know that your input
was also not super great so I'm going to
do the same thing here let me make sure
those line up because my text is super
big yeah it looks like they line up cool
I'll find out if they don't so alright
so next things next thing to do is I
have to create a twill response object
using the Twilio Python helper library
and this is uh this is the object that
I'm going to use to respond to the
requests that Twilio sending my my flask
app once you send a text message
to Twilio and that response is just
going to contain a message which is
going to be that response message string
and I'm going to return a string version
of that response object which will which
will basically just be my app spitting
out some XML next time I have to the fun
part I can run my app now assuming like
nothing's totally messed up so gonna run
it I'm gonna have I'm gonna set debug
equal to true because I'm live coding
and who knows what can happen
so debug equals true awesome no syntax
errors according to my FEM RC yet okay
so now I'm gonna run that cool so far so
good I'm not going to give you all the
phone number just yet because I want to
I want to test it out myself
so Mario's cool right but does anyone
here like Zelda cool anyone play the new
Zelda game rad I didn't I didn't yet so
I don't have a switch yet but I heard it
was pretty good though I'm gonna play
some Zelda though we're all gonna play
some Zelda together instead of instead
of Mario because you already already
seen enough of that so let me see opened
my recent roms Legend of Zelda cool my
computer is playing the volume and
that's cool so I have I have a little a
little a little sag new over here and
you see I'm just I have made zero
progress so far I don't even have the
sword yet I'm and if you're familiar
with this game you know you can go in
this cave and you can talk to this
creepy old man who says it's dangerous
to go alone take this and then he gives
you a sword but I'm not trying to play
this game the legit way we're trying to
hack in we're trying to cheat so I'm I
have the sword on my phone here in a
text message and I'm gonna text this
phone number the memory address is zero
six five seven I think and I'm gonna
text it three which will give me the
magical sword and did it work oh wait
I'm not running the script so okay cool
now I have it rad so I just gave myself
the story you see at the a slot I have a
sword transfer it from my phone
you can shoot that sword around so now I
think I think you all want to play this
with me yeah let's let's play some Zelda
so I have I have a phone number if you
pull all your phones out and and by the
way after this talk I'm gonna send all
of you like a blog post like detailing
this step-by-step like how to get all
this working so if I went too fast or
whatever you'll be fine so the way you
can get that is by texting this phone
number too and playing this game so here
it is if you text seven four three one
zero I have some like some fun memory
locations already up on the screen if
you want to like find even more stuff
you can oh no I accidentally switch
screens if you you can also like just
Google like Zelda Ram map and you'll
find something so I see people are
starting to send some stuff in already
someone someone just like crash the game
so but that's a good thing because like
we're we're at Oh oh man the emulator
just straight up died well we're uh no
that's good that's good well we're at
the point where it's like been
established that my code works so now at
this point it's like if the game is
crashing because you're sending like
you're hacking it that's like that means
this demo is going well so this is very
much by design let me open this open
this game again go to downloads you're
all gonna see my file system now Legend
of Zelda where's Legend of Zelda there
we go
gonna gonna set that config to be a
bigger bigger aspect ratio this is a
super advanced emulator as you can see
all right cool so now I have my Zelda
backup it's cool I got like got like
three more minutes of this talk so we
can we can spend some spend some of that
playing some Zelda I'm gonna run this
Lua script again I want someone to give
me the sword because you know I didn't
save no save States let's see where is
this talks an SMS Lua okay we're back in
business back in business
alright so someone's giving me some
bombs I see some Oh someone just gave me
like infinite life so that's that's four
oh now I'm walking around at the top
that's pretty cool can someone try to
crash the game again that would be uh I
think someone finally crash together
sword is red for some reason so yeah
basically you see a it's a it's not that
difficult to get started and just like
hack some old Nintendo games um you know
I'm not like an expert rom hacker by any
means but you know this stuff is kind of
fun I figured well we'll do something
fun for the last day of talks at PyCon
so I'm going to text all of you blog
post that has like detailed instructions
on how to get started on all this and
how to install this emulator and stuff
if you're from out of the country and
you can't text the phone number because
it's like a u.s. phone number you have
my Twitter handle it's Sagna shreds and
my email address is SI g NE w @ Twilio
com so like I'll even just put it up
here sag new @ Twilio com so if you're
like from out of the country and you
can't text that phone number just email
me or find me on Twitter or like come
tackle me after this talk like in two
minutes I'll be over here I'll be around
for the rest of the day at PyCon um my
name is Sam Agnew I'm a developer
evangelist of Twilio and if you ever
like build anything cool with this like
let me know I'd love to see it</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>