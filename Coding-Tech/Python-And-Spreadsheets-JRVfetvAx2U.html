<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Python And Spreadsheets | Coder Coacher - Coaching Coders</title><meta content="Python And Spreadsheets - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Coding-Tech/">Coding Tech</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Python And Spreadsheets</b></h2><h5 class="post__date">2017-10-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/JRVfetvAx2U" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is my Python a spreadsheet
state-of-the-union July 2017 the reason
is called state of the union July 2017
is because I originally gave this talk
in 2013 or a version of this talk in
2013 and so as it says here on the slide
it used to be I'm currently a QA
specialist for I like that currently
choice specialist for decision health
which is a start-up in Houston Texas and
that's actually relevant in a second
I'll show you something why so that's
what I do now but about 18 months ago
I just became a QA specialist about 18
months ago so as seems to be the theme
for this room I'm some one of those
career changing people and so before I
was a software developer I was an
accountant and also a university
instructor in a couple of different
countries so that's me and the link
there's two the github repo where the
slides and the ipython notebook for this
presentation are so you can take a look
at that at your leisure but the fact
that I used to be an accountant is also
relevant to this talk because this is
one of the reasons I spent time dealing
with spreadsheets so here's a brief
outline of the talk we're going to talk
about sort of how I got here to the
point of wanting to stand in front of
people and talk about spreadsheets which
is you know it's a own thing then also
we're gonna demo some of the fundamental
open PI excel data types open pie Excel
is a Python library that I'll be
demonstrating and as the name suggests
is used for working with spreadsheets
sometimes called excel file and
specifically it works with xlsx XLS or
XLS X Files so you can't use it with the
ODS files that LibreOffice generates
then after some introduction of the
fundamental data types we'll look at
some basic things you can do with
spreadsheets and Python and then we're
gonna look at some problems that you
will run into if you're trying to work
with spreadsheets programmatically so
it's not all peaches and cream but you
can learn from my pain and that you know
make things go more smoothly for
yourself in the future so my secret
origin story so I used to be a
professional spreadsheet fighter which
was also known as accounting you would
be terrified by how many organizations
around the world or literally run on
spreadsheets just please try not to
think about it so I've had an
interesting coding for a long time you
hear about people who have been coding
since they were kids
I first got exposed to coding as a kid
but I was never a CS major so I didn't
need to code I just had an interest in
it but I was sort of dabble and stopped
because I didn't mean to do it so in
late 2012 I decided to get serious about
becoming a better programmer and
eventually trying to become a
professional developer and so I I went
pro in December 2015 working for him
decision of the company where I am now
there have been at least a couple of
talks in this room about changing
careers and so I won't go into that in a
lot of detail but some of my experiences
mirror those some of them are different
if you really want those details you can
talk to me at some point in the future
but on to the spreadsheets so my role in
the Python community and one of the
reasons I'm doing this talk is I wanted
to try to be able to make a contribution
to the Python community and again as
someone who's sort of coming into this
later in life changing careers I don't
have a CS degree I knew I wasn't going
to be writing the wicked codes as they
say but I thought well what can I do to
make your contribution how can I help my
approach is to try to help grow the
Python community and my feeling is one
of the best growth of vectors for the
community is non-programmers not trying
to convert Java programmers into Python
programmers but to try to find people
who aren't programming expose them to
the benefits they can get from
programming and then show them how
Python is perhaps a better tool to get
those benefits also looking at solutions
for people who aren't professional
developers I remember when in in the
demonstration that I'll show you I
recall the first time I showed it to
people I presented this at my Python
meetup my local path I made up in 2013
and one of their suggestions was well
just put it in database well like if
here's someone who knew how to put
something in a database in and do SQL
queries like you wouldn't have this
problem often spreadsheets and for those
of you who work almost anywhere most
business applications is very broad I
know the reality is most business
applications are really just
relational database systems with a GUI
on front-end there was a point-and-click
interface on the front and so you get a
report from some system and when you
when someone gives you a spreadsheet
full of data it's very likely that that
just is a dump from a database so put it
in a database doesn't really solve that
issue so I'm trying to make a
contribution whose the talk for the talk
we're looking at either spreadsheet
users who want to try to you know step
their game up to the next level
spreadsheet users are often very proud
of the ability to use pivot tables and
do things like that but you know there
are that's a whole different thing there
are other things that you can do because
most spreadsheet programs sort of give
you limits so that or if you're a Python
developer who keeps finding yourself
confronted with spreadsheets people keep
giving you spreadsheets and you have to
do something with them so that's who
this talk is for not a lot of code here
the goal of this talk is to be very
beginner friendly again my hope is is to
help grow the community either by you
know by bringing in new people who maybe
weren't programmers and then found hey
you know what I can write some code that
will actually help me at the same time
you all can make new friends in your
places of work by maybe writing a little
bit of Python to help some of your
co-workers automate things and make
things faster and then today I you are
the most popular person in your office
all the you know whenever there's like
food comes to the office if she shows up
on your desk first and then the rest of
those those terrible people who didn't
help anybody then they can pick through
what's left but food has been brought to
you first so this is this is why I'm
here to help you
let me see we're gonna demo time this
demonstration sponsored by Jupiter
notebooks that's what I'll be using a
using a Jupiter notebook let me first
take give you a quick look at let's see
yeah so do I work for this company
decision health and so this is my
Jupiter notebook this is what my company
makes we make medical dashboards that
get used in icy use and each of these
sort of remembered things represent the
patient so if we like to take a look at
say this patient they've got things
going on we see things like there
great their blood pressure you see the
heart beating
you notice the heart rate has a color
yellow the blood pressure has the color
green here this area you see the
respiratory rate the colors that those
numbers are are determined by a JSON
configuration file the data from that
configuration file come from a sprits
initially put into a spreadsheet doctors
and clinicians sort of sit and decide
okay what should these ranges be those
numbers are put into a spreadsheet then
called that I've written turns that into
a JSON file that configures this is that
the optimal way to do this no but it's
the way it is currently being done we're
moving towards other solutions but this
is one example of the nature of
complexity that you can achieve and
we'll see an example of turning some
spreadsheet data into JSON and just a
little bit this is actually a nice way
I'm here at PI Ohio one of the places
where this is in use is at the
University of Cincinnati hospital they
use our product decision and said they
use it in some of their ICU intensive
care units and that's what the software
does so just sort of a sort of a live
demonstration of what can be done so
there you go so demo time and we're
going to start with actually so instead
of starting with the code we actually
you want to start with the spreadsheet
itself so this is the actual spreadsheet
so what we've got here is some simulated
timesheet data and so this is similar to
a task I did in 2012-2013 so you've got
simulated timesheet data you've got an
identifier for the employee the cost
under that employee works in the
division of the company that they work
in which is a US which is a customers or
subdivisions of the division their
manager and obviously there's like a
nonsense name there the date that they
worked the employee's name also kind of
a nonsense thing
anonymized the number of hours they work
and whether or not they worked on our
project you'll find in professional
services organizations like accounting
organizations engineering organizations
there's often a focus on are you working
on a billable project or are you not
working on a billable project and so
that's what this data was is designed to
reflect in this example everyone's
working on the billable project and so
we're not doing we're not doing that
level of analysis here is more of an
aggregation I've made a simplified
example just for the purposes of our
demonstration here but that speaks to
one of the things you have to look at
when you're dealing with working with
spreadsheets programmatically you need
to understand the actual data that's
there what's what underlying data is in
your spreadsheet you can't just write
code that makes things happen unless you
actually understand the data so this is
the data we'll be working with
I've got a thousand words of data here
and so you can see for instance for this
person so for this person you can see
that they've worked it's the same
employee ID number with the same
Department number the same coughs enter
a number these are the different hours
they've worked they build on this
project so this is C so on this day they
work for hours I'm this next day they
work for hours so on and so forth so
that's a summary of the data we're
working with just to provide some
context of the analysis they will be
doing so first things first we take a
look at reading in a file and then some
basic data types and I'm going with the
basic data types because open PI Excel
provides some different data types
beyond the standard Python types so
first things first
and again the talk is geared to be as
beginner friendly as possible so if you
know I don't know what how to import
things go Joe well fine maybe you do but
perhaps you have a friend who might not
be so familiar so we're going to go
through some that stuff so import up in
PI Excel that's the name of the library
then then you pull in this workbook
module and that lets you work with
workbooks and then once you've done that
you have this load workbook function and
this is the name of the file that I just
showed you
mr. demo file here I've got data equals
they're the only equals true what this
does is if you have a formula in your
spreadsheet this would just give you the
result of the formula the last time I
was calculating it as opposed to
bringing in the formula and that's an
important setting now here I want to
talk a little bit about workbooks
workbooks verses worksheets verses
spreadsheet verses tab and I'm pointing
this out because people tend to use
these terms interchangeably and open Pi
Excel tends to use them very
specifically so people just call the
spreadsheet of spreadsheet and then
you're inside a spreadsheet if you have
tabs these little tabs and spreadsheets
okay an actual spreadsheet file like an
XLS file is called a workbook so a
collection if a complete spreadsheet
files got a workbook within that
workbook
you have work individual worksheets so
here and this might not be unfortunately
it might not be visible to people in the
back but you see the spreadsheet before
at the bottom that you've seen the tabs
along the bottom of a spreadsheet each
of those is an individual worksheet so
here when we import workbook and then
load workbook where you're giving the
entire workbook file and then we move on
to working with worksheets so here we've
got workbooks and if I print workbook so
I was a terrible idea to do live coding
but I'm doing it anyway because I'm I am
unwise you'll notice here when I print a
new print workbook it gives me this
object this open pie Excel like workbook
object again this is one of the data
types that open pie Excel provides and
if we take a look at the der command and
if you are a new how many of you by show
of hands we consider yourselves either
new to Python or new programmers okay so
for the people who are newer new to
Python are new to programming this Derr
function is very helpful what this will
do is for almost any thing in Python
type in der that our function and pass
it it will show you what it called the
attribute
for that object so these are the things
that you can do with it so so here this
WB when I loaded this were quick in it's
my work book object so what can I do
with that work with object and I'm going
to ignore the these dunder methods and
these single underscore methods I'm
going to focus on the named ones here so
you can see if the work book is active
you can take a look for instance you can
create a sheet in it what we're
interested in is the fact that you can
get a sheet by name or you can get the
names of the sheets in that workbook so
again that's why I made that distinction
between workbook versus worksheet
freaking good which is another good
question
I know I have run into some spots where
the help doesn't work let me get to that
in just a second so so here we got the
methods here that you can use with the
workbook let's see what else am I
looking for that's I think that's gonna
be it for now also sheet names is the
one brush with you so you can get the
names of the sheets that are in that
workbook and to get to that question
let's take a look at the help function
also almost as useful as the dirt front
why not also just useful deburr function
just does things slightly differently
most Python functions will have what's
known as a doc string that will include
some information about how to use the
function so if you do help for that WB
you get help for the workbook and it
gives you some idea of how to use that
object so you can do this for Python
built-ins as well I'm in a browser I'm
gonna need to open a web browser I know
what does the open so I read the docs if
and if you're not familiar with read the
docs you probably are you just don't
know you are a lot of open source
documentation is on this site read the
docs there are a number of wonderful
conferences about it but so open pi
excel dot read the docs
I oh this is where the documentation for
open pie Excel is there's a tremendous
amount of documentation for it there was
a lot that the dictionary can do I'm
just sort of covering some of the basic
stuff because there's literally not
enough time to cover all of it but
that's where you can find some more
details no problem
all right so we've got so we've got this
workbook and now we want to know okay
but what sheets are in the workbook and
so we see here we've got these simple
reads that will write which will read
Japan spending I was in Japan like two
weeks ago and so I was I was working on
this and also like trying to figure out
where all my money went and so this is a
good thing for spreadsheets clean data
is the one that we're most interested in
well you know what it's the one we're
second most interested in the one that
the one that everyone is most interested
in is kpop draft roster unfortunately
that we won't be using that one today
hopefully I'll have that something ready
to go with that I'm giving this Hakka
Django con hopefully I have something
ready to go by then but until then you
can find kpop on YouTube to tide you
over one thing I will point out is if we
take a look at the actual spreadsheet
itself for people in the front row
you'll notice that the this is why you
shouldn't have your friends come to your
talks people in the front row you'll
notice that the Japan spending tab isn't
visible that tab just like if you've
worked at least you know that you can
sometimes hide a sheet and so that sheet
is hidden here but open PI Excel when it
gives you the sheet name that still
finds it there even that was visually
hidden so just something worth pointing
out is like you can't hide a sheet and
then think no one will find it yes they
will find it that's not that's not how
espionage works don't anything that was
very
okay now that I have mr. I've seen
secured sheets but uh an advertising
system with others then I don't know
okay so so that is a situation where I
think you have to dig into the docks a
little more I wouldn't be surprised but
I haven't gone that deep into that
particular rabbit hole all right so
let's see so so we've done that and so
now we want to build this demo worksheet
and so this is the actual sheet we'll be
using for the demonstration so for that
I'm doing that WB that gets sheet by
name method that we saw earlier and I'm
using the name that I got from the show
names function before so I want the
clean data sheet and that's going to be
my demo worksheet and that is this sheet
here this is the clean data sheet that's
just what I named it so give it that
string and then we've got the same help
and ER function here for the demo
worksheet and we'll take a look at some
of that again there are many many
attributes oh dude it just somebody very
hidden oh look at that see all right so
yeah I said I mean there and I'll get
into this in just a second but there are
there are some may be additional
complications that you run into when
using uh some PI Excel but they're there
for a reason because of things like the
fact that a sheet could be hidden or it
can be very hidden or there are all
these other attributes that come it's
not just the data that's inside so here
in the sheets we're going to see the
active cell you can get a particular
cell dig into cell a little bit later
the columns in a sheet so they're a
bunch of different attributes here the
rows we're going to be focusing on the
columns and the rows and the cells but
you can also give them type you can
change the title you can read the title
and then values values is all is the
values attribute is is where you're
going to get the actual data that you're
after all right so here we go so there's
a worksheet and so now we look in the
rows again each worksheet is going to
have rows you've seen
used to have rows to go this way columns
that go that way and so here when we
look at the demo worksheet with rows it
returns a generator object and so it
doesn't just give you back a bunch of
rows gives you a generator object if you
are a new to Python or programming a
generator object is similar to say a
list or a tuple which is like a
collection of things but let's say you
have a collection of 1000 things if you
got a list of a thousand things that
takes up a lot of memory a generator
object says ok I've got a thousand
things here but I'm going to give you
them give them to you one by one it's a
simplification but that's effectively
how they work and so what open Pi Excel
does is it doesn't give you back that
whole list of roads gives you back a
generator object that will give you one
row at a time
for memory savings but that's important
because you would work with a generator
object differently than you would work
with a whole list or a whole tuple so
your rows is a generator object and I
and I've got a little bit of a
difference here so so what is in that
what does that generator I've been
giving us the generator object is
generating tuples and so a tuple if
you're again if you're certain you would
define it it's a collection the
difference between a tuple and a list a
tuple is a collection of objects where
the order has meaning
so the first object and tuple has some
sort of meaning relative to the second
one in this case you'll notice that the
first things in the tuple you've got
clean data a1 b1 c1 through h1 it's the
first row and if we take a look at our
actual spreadsheet you'll notice it goes
from a to H and so it's the first row
then the second row so on and so forth
so each tuple represents a row so
generate a ryebeck that gives you back
two pools but not tuples of the actual
data values you'll notice but it's of
those cells so cell clean data dot a 1
and so the cell itself is a different
data type and again I point those out
because you work with those a little
so what's going on with the cell so when
you do this here
I've got so four cell in this next demo
worksheet row so you recall worksheet
dot rows gives you that generator object
as I said a generator gives you one item
at a time so to just have one item pop
off that generator object you use this
next function and so what this is doing
is it's giving me and let me have that
here for the purposes of the video what
this is giving me is it's giving me the
first row from that generator object and
then and I'm calling it cell and so I'm
saying give me cell the zero and one
where I'm assigning the cell column in
the cell row and then I'm printing the
cell itself the type of the cell and
then the cells value so the cell about
value is actually what's inside the cell
that's what you actually see when you
look at the spreadsheet and we'll do
that and so I've got it formatted try to
make a little steno so I've got here so
this is the cell cell a1 and then
sprinting the actual cell data itself so
it's of type cell clean data a 1 the
class is an open PI Excel cell so it's
that type of object and then here we see
the actual values so employee num cost
Center division so if we look back to
the spreadsheet cell c1 division we see
here that cell c1 is division just the
headers so but again I point that out
because when you are pulling these
things out of open PI Excel you're
getting this cell to get the actual data
value you need to call that value
attribute and why does this happen let's
see you also get different data types
inside so here in this demo worksheet
I'm looking with looking at cells II 1
and E 2 you can also reference cells by
the specific cell number or the specific
cell identifier so sell you one an e to
viacom e e 1 e 2 here's the text string
that worked here it's a date value so
that's a 1 a 2 if we look here we see
that you want is that string date worked
it's class string and then e2 is a date
and it's a date time object and so
python is able to handle daytime i Bix
and that's what you're giving you so
it's giving your date time object this
next cell is basically just the same
thing well actually yeah so this next
cell is the same thing but it's showing
you just the values and so why is there
this cell object there's a cell object
here because when you're looking and you
dealing with spreadsheet there's data in
the spreadsheet but there's a lot of
other information around a cell in a
spreadsheet and so we'll just take a
look at some of that so we've got all
these other attributes is you know is
there is does this all have a comment on
it
is there a border on the cell what
comments a cell in again the comment is
there some sort of a fill is there some
sort of background color on the cell
what font is on the cell and so you know
what row is a cell and here finally
what's the value on the cell that's
usually that's usually what people are
after is the value in a Cell
what styling is on the cell so this is
why you get these cell objects back but
I point that out because if you go to
say if you tell that to give you cell b4
you're not going to get it value you're
going to get a cell you then have to ask
specifically for the value but you can
also ask for other things I'm going to
take a quick look at cell styles and so
here we're looking at cell e2 we want
the font name the font color the
background color and the border and so
the font is Ariel and then here more
details about the cell color more
details about the border and again I
mean there's there's a lot of detail
here but you can read all of these
values and you can you can write them as
well and so if you want to look for
things that are
in a red cell or you want a certain
result to be returned in a cell that had
the blue background or has a certain
border those are all things that are
available make the spreadsheet beautiful
has been left as an exercise for the
viewer I don't don't have time to demo
all that but again those are things you
can do on your own so now moving on to
the more sort of cortical hardcore
portion of the demo doing its aggregate
time feed information so we've we've
read in this sheet we saw in the earlier
code I read that the workbook in and
then I read in the sheet as demo sheet
the clean data and so now what I want to
do if I want to aggregate this
information if we look at it we see
we've got for this employee for instance
we have multiple rows each representing
a different amount of time they worked
on a different day you want to aggregate
that so what we want to end up with is
how much time did this employee work in
this month so we've got dead here for a
fictional June 2017 so first we're gonna
start out with a creating a list of
employees I've done this here and a
for-loop well then I've also done it in
a set car engine I think for because of
time I'm not going to go into the
distinction between a for loop in it and
a set comprehension if you have
questions about that I'm more than happy
to answer those but I want to make sure
you know that I sort of demonstrate as
much as I can here so what this is going
to do I'm creating a set comprehension
and it's basically going to say I want
the row 0 value for for each row in the
demo demo worksheet rows that generator
object that gives you one row at a time
I want the Rose the I want the 0th index
or the first thing in the row for each
of those rows if that row is not equal
to employee number and that's just a
simple thing I did to get around the
fact that it's gonna grab every row
including the ones with the headers so
I'm just blocking that out and I'm using
asset comprehension here so again if
you're new to programming a set in
Python is if something is a cut another
collection so similar to a list or
similar to a tuple the difference being
a set will only have unique s that won't
have any repetition so each value
that is unique and so if you have you
know you have five people in a room two
of them named mark and three of them
named Steve a set will only have two
elements one mark one Steve so it it
eliminates duplication and that's what
I'm doing here because I only want and
if I want any one individual employee
IDs so that's what I'm doing here and
then so what does that set look like
looks like this so I end up with this
this set of employee IDs and I know from
having looked at it before and having
done some filtering in the spreadsheet
that I should have 49 employee IDs here
because that's how many employees I've
got so now I have this this set of keys
that I can use for employee and now how
do I advocate this data here I've
decided to just to build a dictionary
and for reasons that we'll see a little
bit later so and again so at this point
we're sort of mixing some Python with
open PI excel stuff so here this is
specifically opened by excel the fact
that each of this row 0 is a cell and so
I need to get the value out of that cell
so row 0 dot value that's what's giving
me the value from that cell guessed it
up and PI Excel thing the rest is fairly
standard Python if we look at this
aggregation data again we've got a lot
of standard Python here for each
employee in that employee IDs construct
that I made before I'm going to assign
that employees ID as a key in an empty
Internet as a key in a dictionary I've
created this empty dictionary employee
aggregate where I'm aggregating the
timesheet data and then for each
employee I'm going to set that employee
as a key to another empty dictionary and
then I'm here I'm using a list
comprehension to make a list of all the
hours for that employee
and again row 6 dot value row 6 if we
take a look at again from that demos
demo worksheet that rose construct row 6
what one two three four or five six not
six but
Python hence Hut and this gets tricky
we'll see this in a second so for those
of you who are more experienced Python
indexes from zero and so the first
element is called zero but with this
spreadsheet it starts counting from one
and we'll see how that comes into play
in a second so here we have 0 1 2 3 4 5
when I can't I can't keyboard 0 1 2 3 4
5 6 so I want to i went index 6 the
hours worked and i'm making a list of
those here because I don't want unique
values I want all those values then I'll
sum them later but for a cost center
division and manager each employee
should only have one one cost center one
division one manager and so I'm making
asset comprehension here and so that
will give me back the one value for
those I do QA and I also used to be an
auditor as an accountant so on I mostly
like to double-check things and so I
know that that my cost Center in my
division of my manager should only have
one value so I'm just doing assertion
here to make sure that that's the case
and my calculations and then I am
assigning those values into that
employee dictionary that I made before
and so ours here I'm taking that hours
list and I'm summing the hours in that
list to get a total and then here I'm
just assigning those other values I'm
making them I'm converting them into a
list here because before they were a set
and so I'm making them a list here and
I'm actually I'm making them a list and
taking the zeroth element which is the
first element but since it's a list of 1
it's just taking that value out which in
this case is actually going to be a
string and so what does that look like
now once I've aggregated that data using
the P print function here just to make
it look nice and you end up with this so
you end up with a dictionary like this
where you've got the employee ID number
and then their cost under their division
and the number of hours they're working
the month and so you've got that for
each employee and again the length of
that is 49 so I know I got 49 employees
so I know I've got the right number of
PEEP
here so we're taking it out of
spreadsheet we've aggregated it and so
what do you do with it now
so we've seen reading from a spreadsheet
one of the things you want to do with my
excel read data from a spreadsheet and
then make use of it in your Python
program so we've done that pulled it
into a program dumb things with it at
some point you might have a program that
you've run it's possessed it's created
some results you want to write those to
a spreadsheet how do you do that first
you want to create a spreadsheet so here
I've just you know created a new
workbook object called output book which
is again another open Pi Excel workbook
object like we saw earlier and then in
that workbook it will by default create
a sheet like sheet one like when you
open a new spreadsheet but I wanted to
get I wanted to sheet with a specific
name that I could work with
so here I've said mid this variable
output sheet and use this create sheet
method that we you might remember for
when we looked at the workbook so you
can create a sheet here I've given it a
name aggregate time and then this 0
argument means it's going to be in the
0th position so it's going to be the
first sheet in that workbook so a new
workbook and a new sheet in that
workbook that's going to be at the front
this is all in memory this doesn't
actually exist as a file yet and so when
we look at up a book here we noticed
that it is again it was a workbook
object which is the open PI Excel data
type that make sure I ran that did
everything yeah I ran it ok and so we
have our output spreadsheet target or a
workbook target and so now we want this
to sort of a look a certain way and so
we want there to be a header like there
wasn't the original sheet so that when
you give this to someone they can see oh
what are these values so building a
header here so I'm just making a list
that I'm calling header and this is
another way that you can access values
in the demo worksheet before I sort of
went through by row and picked those
values out you can also just go to
specific cell so here I'm just
referencing the specific cell so go to
cell a1 get that value go to cell b1 get
value and those are gonna be the headers
from the original spreadsheet from that
demo worksheet so I'm just making a
header that way also just to show that
you can go and just grab a specific
value from a specific cell if you want
to and then this is what our header
looks like and so here's what our header
list looks like the list of strings
nothing too exciting then I'm going to
build this output data construct and the
first thing you might do is I'm gonna
append my header to it says output data
structure it's a list I'm going to
append my header list to it and then I'm
going to and again so here we've got
fairly basic Python for those who are
newer developers as you may recall this
employee aggregate that we saw earlier
is a dictionary if I use this inner
function it will iterate over the keys
in a dictionary and I'm going to just go
through each key in the dictionary each
with each key representing a person go
through each of those people I make this
empty new row and then I'm just
appending to that list this new row
which is a list I'm appending to that
list the values that are inside the
dictionary for each employee
so I'm going to basically create a new
list inside that outer list for each
employee so each new row is going to be
a list that I'm adding in so going
iterating through the dictionary each
key each person is going to become a new
list inside so I've got a nested list a
list of Lists so I'm doing that and then
after I have completed that new row that
last new row I'm appending that new row
to the output data structure so first I
appended the header to the output data
structure and then I'm going through
that dictionary and appending each row
which is a person to that up at dinner
so when I'm done with that I have my
output data structure and then here I'm
assigning those values to my my
worksheet construct this in memory and
now this is where beginning to that
difference about indexing from one
versus zero so I'm saying here for Rho
and output data so for every row an
output data which is that nested list I
need to grab the row index which is
output data the list dot index for row
and then I'm also saying okay for each
column in a certain range so columns in
a certain range which is the length of
output data 0 output data 0 being the
first list which is the header so in the
length of the header that's going to be
how many columns I want I'm going to say
output sheet which is this worksheet we
have in memory that cell and so I'm
trying to address a specific cell but
which cell here again and so this is
where you get it into again open pie XL
nomenclature row equals and then you can
give it a value for Rho in this case I
want row index plus 1 because Python
will give me this row index it'll start
from 0 and the same here with columns
come each for columns we're going to
have these this range value that will
start at 0 as well and so I'm had having
to add the plus 1 to make that
adjustment between Python and
spreadsheets and so so for this row
first row first column dot value and so
I'm saying for my for my worksheet this
in memory the value I want for that
particular cell set it equal to the same
row and column index in upper data so
I'm just basically going to you writing
a that's the actual sound it makes
- so don't be alarmed if your computer
starts to make those sounds and so
that's basically just going through and
just writing that out and let me make
sure I run that code and then after
you've done all that support that you
actually save your file and give it a
name so output book dot save up a book
again being our constructs we're saving
it and I get this file name done by Ohio
because I'm at PI Ohio and there we go
and so that's not terribly impressed is
like ok it's not terribly impressive
but when we take a look at our file
listing and I've got the sweater by time
you notice that here at 1640 we've
wrapped this fly up high Ohio know here
we go you have this file done PI Ohio
that XLS and so that file was created
just now let's take a look at that and
see what that looks like and voila
so this is this has taken this has taken
data from this spreadsheet
these thousand rows and compressed it
into these forties
well 50 rows one header row 49 rows of
data so I have one employee and the
hours that that employee worked for the
month and their cost Center the call
center for that employee of the division
their manager and the number of hours
that they work in a month and you can
double check a thing like this let's see
people in the front will be able to do
this but you won't at the bottom and
with the spread you can see 53 and you
say Olivia 53 86 is the total number of
hours in our new construct and in our
old construct we have the same number of
53 86 so if there's a question as to how
much applause spreadsheets actually need
but exactly so so that is what it looks
like to read data in from a spreadsheet
process that do something with it or
take the results of some sort of Python
process and then send them back to a
spreadsheet and so and again with the
style options there are things you can
do if you need to I've done things like
with this where I've created reports
that have borders and nice things around
them and colors so you can do all those
things as you see fit it just requires a
little manipulation
the other thing you can do is you can
turn this into some sort of a JSON
configuration file and so this is sort
of similar there's a very simplified
version of what we do what I showed you
what we do at work that we use to
configure ICU dashboard software so with
that same work that I've done before I
have that employee aggregate dictionary
that was created import the JSON module
and then just give it a file name to
write to and then here I use the JSON
dump and again this is all just standard
Python there's nothing open PI Excel
specific about this but if you know that
you want to create something in JSON
then you just need to structure your
constructs so that it can be done that
way so I'm calling it I'm using this I'm
telling it to dump the employee
aggregate construct and I want sort keys
equal true because I want this sorted in
the order of the employee members
because that just makes it a little
easier to read and then indent equals
four makes a little nicer to look at
then we run that and again doesn't seem
to be anything terribly exciting but if
we look at our output and so if I run
this again you'll notice that the newest
file is now this egregious aggregate
time JSON file so let's take a look at
that and that is actually in my editor
and so this is the JSON file where I've
got again the each for each employee
I've got the detailed information that
costs under what division what hours and
who the manager is and I can then use
this JSON file to use something else to
configure something else to determine
how something else operates that sort of
thing again there's a huge amount of
things that can be done with this you
can take a look at the documentation to
see those things in greater detail let
me go back yeah
and cover a couple more caveats so
reading data in from a spreadsheet
processing it writing it back out to a
spreadsheet not unusually complicated a
few little things to look out for but
not nothing
the complicated you can sort of you know
give a little better without the
practice the problems that you'll
actually run into are the facts that
spreadsheets tend to be often uses the
visual medium so people will create a
spreadsheet that looks a certain way
because like their boss likes to look at
it this way or it looks better when it's
this way I can read it better this way
and so often you will end up with a
spreadsheet that is not easily processed
if all the spreadsheets that you ever
get in life look like this you know or
this you know if they're just like the
sort of database table top the database
table dumps you'll be fine the truth is
someone will make a spreadsheet that
they think it looks awesome and then
they'll want you to do something with it
for bruh matically and that's where the
problems come in so you'll have to learn
how to deal with those things again you
can do you can get around those things
by addressing specific cells or working
with colors or things of that nature but
that's the issue you have this
unstructured input data or data that
only makes sense if it's being parsed by
human eyes and a human brain it's
difficult to look at programmatically so
that's what you know we're gonna run
into trouble or the visual output
requirements so maybe you've done this
processing and you want to send it out
to a spreadsheet but whoever it's going
to needs it to look a certain way it's
like well I'm used to looking at it like
this and not like this or you know I
want you to be borders around it so that
I can see it what have you again with
the style attributes that are available
on the cells you can do things of that
nature you can do things with the ranges
there are a lot of different options
making new friends I talked about this
if you can help co-workers automate
their work you might be able to make a
new pythonista if you can sort of help
them see okay hey you know what there's
actually a thing that you can do so we
can because again the example that I did
was a thousand rows of data and that's
not super impressive when I started
teaching myself to do this I was working
with between twelve and fifteen thousand
rows of data and it was being filtered
and copy pasted manually into a thing
that took like six or so hours to do
writing the scripts to compress that
took it down for about 90 seconds and so
if you're having you do that kind of
thing every week or every day or every
month with a hug
like that a thousand four hours like
that then this code becomes more useful
so if you can show people this sort of
thing you can make new friends maybe
making new Python Easter again would
they be willing to sort of standardize
their spreadsheet in a certain way that
would work better with code if you get a
ninety nine percent time reduction
that's literally what I did the math it
was like from two hundred forty minutes
to two minutes well that's that's the
ninety nine percent reduction in time so
with someone willing to change the way
they do this spreadsheet a little bit to
make that ninety nine percent time
reduction happen and again you can use
the sella the style attributes to create
the look that's necessary that's all
I've got
if you've got questions or comments feel
free to ask me now or while I'm here I
am large and easy to see
I am transitioning on Twitter there is
my website which is terribly
underutilized and the link to my github
repo that has the ipython notebook that
I was demonstrating as well as the
spreadsheets you can take a look at
those so that's all I've got
thank you for your time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>