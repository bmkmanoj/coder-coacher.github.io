<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Offline First Applications In React Native Done Well | Coder Coacher - Coaching Coders</title><meta content="Offline First Applications In React Native Done Well - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Coding-Tech/">Coding Tech</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Offline First Applications In React Native Done Well</b></h2><h5 class="post__date">2018-01-12</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/yxMYt7LyTXQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so what are we gonna talk about in
the next 25 minutes also and first we're
gonna check like some good stuff like
some good UI and good behavior you would
want to have in your application but
also some bad bad practices and then
we'll see a little bit some principles
about what actually are offline first
applications and we'll I'll show some
code on how you can easily implement and
on the way we'll see some tools and
packages that help a lot with that so
let's start with what you don't want in
your application so on my phone I like
to use Facebook lights instead of
Facebook because it requires less
permissions it's lighter and it doesn't
use as much data and but one thing
that's really annoying in this app is
almost every day if I'm on Facebook in
the metro there are like between a few
stops I lose connectivity and the app
does that so okay pops up in my face you
don't have that anymore okay I know like
I'm in the metro it's okay so I press
okay but the problem is I just scrolled
two posts down and it free pops in my
face
that's super aggressive and yeah that
frustrates me almost every time so yeah
pop-ups overlays I died don't think
they're a good solution to like notify
or yeah tell your user that you're out
of connectivity another thing that
happens sometimes is that the app
doesn't show anything anymore this app
for example even after getting data like
network connectivity back just shows an
infinite loader and I don't I couldn't
even tell you which app it is because I
remember and there's no sign of whatever
it is so sure nothing is not a good
solution and maybe even worse like show
only errors no nobody wants that
another use case that happened to me
recently was so this app Kijiji it's a
bit like Craigslist in Canada so you can
like buy stuff from other people or sell
sell your old stuff and when you open it
being in airplane mode so without data
it just forgets a bit everything about
you but it's been a year that I like
I've used this app for a year and like
you don't remember who I am like it
screw you yeah so now let's look at some
things you you want to have in your app
so it feels good
the first one is try to keep the user at
home like give him good points of
references well known yeah parts of your
UI so he's not lost like he knows what
up his in and that's okay and and like
you can still have a lot of things
working even if you don't have
connectivity for example that the Airbnb
apps you you see that like most of the
time when you open the app as a traveler
you're gonna search for a place to stay
for you and your friends and so you can
you still have this part of the UI of
course if you try to use it it's not
gonna work right but you know like this
screen is there Airbnb app you have the
logo on the bottom and you can even
navigate in some of the parts of yet
right so another thing you want to do is
inform the user so there are different
ways to do that and the best ones I find
are the ones that are not too aggressive
so here I think that's the fabric app
and they show us a small message at the
bottom saying okay well we can't get
data so the app is kind of useless right
now but you can retry and and you still
see yeah you still like a B&amp;amp;B the our
B&amp;amp;B app you know where you are and so
okay that's not too bad another very
important point is to leave access to
critical data
even bride does that super well because
every time you get ticket like every
time you open the app I think it gets
your tickets and you can have access to
them any time after that and that's
great because let's say for example I go
to chain react or I come here and I
don't have any connectivity because it's
not my country I still have access to my
ticket and I can still come in the
conference right ok and yeah so and
another thing that you might want like
you surely want is to adapt your layout
so you don't want to leave blank screens
even if the user can manage to
understand why it's blank
I find LinkedIn is doing that pretty
well you have like nice graphic
explaining that it's cut out of the
internet and a small message explaining
all that and again we try button
I think the retry button in this case is
good because it might be a loss of
connectivity just for a moment like just
when the request to the feed has been
done so it can be good to give the users
the Europe or the opportunity to retry
right and another question for you who
uses Trello and who uses the mobile app
for Trello ok quite a lot of people
couldn't and this have I found like
really like kind of amazing because even
without connectivity it acts as if
nothing is wrong basically so you can
still like go in your boards if you have
loaded them before I guess you can still
go in your cards like check stuff as
done in your checklists and it's going
to do everything just like for you you
have done it like it's optimistic UI and
but it's gonna really do it after and I
think that's kind of the like the next
level and I think the new Facebook
Android app does that as well
and that's yeah so act as if nothing is
wrong but then there's a pressure livid
behind it means that you you have to
deliver right so if you're doing a bunch
of stuff in the Trello app but then next
time I'm come you're coming into the app
like there they've all been discarded
that's not a good experience I felt
cheated and I won't be happier as a user
okay so let's look at some of the
principles of offline first apps Google
gives the definition of the principles
for enough line first
so first you should use local data
whenever possible so don't rely on your
server all the time second sip separate
your UI from its data that's other with
what we talked about with Airbnb and so
you can still have your UI even without
connectivity then assume your app can be
closed at any time and that's especially
true I think in our mobile app world
because you can be out of battery you
can have a crash you can have yeah your
phone can be out of memory or stuff like
that so so your app can be closed for
any reason and test your app thoroughly
I in these definitions I have some extra
ones that I think are really important
as many actions as possible should be
doable offline like
you shouldn't block your user because
your light blue like missing some of the
resources for your app only like only
block the minimum you can and keep your
data as long as you don't have the
replacement and that's my talk about
that a little bit later but that's
especially true for user data rate with
the example of qg who forgets that
forgets everything
when you don't have connectivity is not
a good one I type show you a to guide
the user in the uncertainty because as
connected as we are today
losing network is already frustrating or
confusing so at least let's keep our
usual safe and and well in our
applications and then be optimistic
pessimistic that's copyright for Yanni
because he wrote that in Redux offline
and and pragmatic I'm going to explain
these three a little bit after so while
preparing this talk I try to implement
these principles in an application
called insta mail you can find it on the
Play Store it has been refused on the
App Store because it's too simple and
they don't see the point that's kind of
true but so yeah the app is supposed to
retrieve pictures from an API or not if
it doesn't have connectivity and
allowing you to upload several pictures
of cat of course from your device even
if you don't have connectivity ok so
let's go a lit a little bit on the dark
side of things and check out the code
first let's look at how you can easily
adapt your UI so there's a great package
called react native offline that gives
you a helper so it's a higher-order
component you wrap any of your component
with that and your component gets a pro
vertical is connected so it's a boolean
very very easy and you can super easily
with that at at your UI so my example
here is on the page to upload images to
validate so you select your images you
open the picker you're selecting images
and then to validate you want to upload
them you have a button if I'm connected
I want to make my Ted famous right now
right I don't want to wait why would I
wait I have connectivity but if I'm not
connected it makes sense that like I'm
not gonna say to my user I'm going
then right now that's not true I would
be lying to the user so let's just make
it make my pets famous ASAP an example
another example here is my home page so
here I'm offline and I didn't ever load
any data so have a site cat right
because he doesn't have any friends if
you're connected then it should change
and give me the opportunity to get some
more pictures of cats because I want
that and so it's exactly the same
principle I just switched on the is
connected property and yeah and I have
but here so what's important is that my
user counts try to get some pictures if
he doesn't have the connectivity because
I know like that's not possible right
yeah
so now let's be optimistic in in that
sense I mean that like that's my example
when I upload my pictures of cats but
I'm offline I don't want to block the
user or give him errors when I'm still
in control of this situation right I
know I don't have network so my app will
not try right now to upload the cats
that's why there needs gonna try as soon
as possible so in this case request
fulfillment is optional first I'm going
to add the images locally so I'm gonna
store them in my redux and and then only
I'm gonna try to send them and I don't
so as soon as I have them in redux I
don't need to keep my user like stuck on
that page my my user can go back on the
home page automatically because he
doesn't need to do anything anymore on
that page and and we're gonna show him
that everything is ok it's under control
it's gonna go up to the server when
we'll have connectivity back then let's
be a bit pessimistic so
what I mean by that is you want to it
it's again about my images but also
about my user I want to always tell
everything that's supposed to go to the
server locally first so my first example
here I hope it's not too small for you
is that I'm so when I open my app I'm
gonna set the user locally and then I'm
gonna try to update it or set it on the
server and same thing I for my images I
store them locally so even even if my
request fails or if yeah and after only
I'm trying to send my images really good
things I found to make that easy is to
use kind of transactions on my redirects
actions so here I have my three main
actions for adding my images the first
one is that I'm gonna add an image so
that's going to store it locally in my
pending images so I execute my intent is
to add an image then if my request goes
to the server and it comes back with the
success okay perfect so I remove my
image from the pending images and I put
it in the feed right because it's been
uploaded everything is nice in the case
where I try to upload it and I get an an
error back from my server then okay I'm
gonna handle it I'm gonna roll back so
I'm going to remove my image from the
pending images and I'm gonna store it in
the failed failed images part of my
store so I can give the user the
opportunity to retry like right now or
later okay
let's still be pessimistic in here and
I'm gonna talk a bit about the
Google's principle about assume your app
can be closed at any time another great
package is with the expert cysts so
relaxed vs. is super easy to use you
just import the persistent method and
wrap your store with it and that's all
it's gonna persist your store regularly
every time it changes so it's gonna yeah
it's gonna store it locally in the
nursing storage by default well you're
gonna tell me that's useless if I don't
get my data back right so it's also
super easy to restore your reject state
so you just add a middleware cause
called Auto rehydrate and that's all
it's just gonna restore every time you
launch your app it's gonna restore
everything it's stored locally so that's
super easy now every time like I do
anything to my store it's saved and even
if my app crash when I open it again
it's all back there so I'm not gonna
lose my pending images of my cats that's
great even if I kill or I quit my app
another thing that's great about Redux
persist is you have a choice you have
the choice of how you want to store that
data and it's really super easy so by
default it's gonna use a sink storage
from react native but my personal
favorite is the juice realm so right now
I'm using it very simple as a key store
a key value store like a sink storage
and I just had to create a super simple
wrapper around realm'
that uses the same interface that icing
storage you can do the same like if
you're from the native development will
I think your favorite so it might be
sequel I'd so you just use like do you a
wrapper around react native ask a sequel
light storage or if you're really from
node.js background you can use MongoDB
local
- and same thing just a small wrapper
that's doable in like 10 minutes or
something and you can use it with speed
expenses it's again super easy you just
pass a configuration objects to your per
system where you specify the storage you
want to use and here I'm sure some of
you will will tell me that okay but in
my store it may read text oh I have a
lot of stuff so I don't want to store
everything I just want to store the
critical data right oh just my user or
something for that also it's super easy
you can either blacklist some keys of
your store so the the root keys in your
read extol oh you can just whitelist
what you want to save so I could just
save my user if then be pragmatic and by
what I mean by that is that if you know
you're in Oakland mode why even try to
send stuff to your server right it's
just never gonna go through so react
native offline comes to the rescue again
with different parts here so on the
bottom right I have the register that
reg native offline exports so we find
again our is connected property but we
also have another item that's very
important here it's the action queue and
so if you connect that in your react so
you have access to the action queue
another thing that's important is the
network middle way so you can create a
network middleware that's going to work
with your thunks on your actions so
basically by adding metadata to your
action or your thong you can tell the
middleware to catch these actions put
them in the action queue and only try to
like start to really dispatch these
actions when you know you have network
connectivity so when you know
in airplane mode or when you have your
data that's activated and that another
like aspect of that thing that's really
great of that middleware and that that
system is that you can specify actions
to cancel these cute messages these cute
actions or things and that's awesome
because if I go back to my app let's say
I put like five images to upload while
I'm offline and after a bit I said oh
okay but my cat is doing something even
cuter so I want to cancel some of these
images and replace them by something
well that's as easy as dispatching an
action so here I am just creating an
action for each of my image so an unique
action and if I dispatch that my my
actually my thing will just be dismissed
from the action queue so that's a great
feature of react native offline
okay so what's missing in all that and
sadly I'm coming from a web background
but I would love to see native cue
concert and trend what I mean by that is
that if you want to reach trelles level
of like interaction while being offline
your app should be able to use these
actions while your app is in the
background or if you quit your app right
and that would be yeah that's so that's
something that's still open but I would
really like to add in react native
offline another thing that I think might
be important in any way in in my case I
would have I would like to have that is
that there's a difference between
network access and connectivity to my
server so
react native a flame again gives you a
parameter that's a ping server URL the
so you could you can customize it to
detect network changes based on your
server URL that makes some sense because
let's say if your server is down okay
that's great I have internet but I can
still not do anything in my app right so
that's something I started I started to
to add also and and that's actually in
insta mail that's what we do we check
the connectivity regularly to the server
and not just the connectivity to the
Internet and a package that I really
wanted to talk about is redux offline so
done by Yanni and it I think it has a
lot of potential so the readme is
awesome the concepts are really well
explained of offline first and like
doing optimistic or pessimistic
yeah optimistic UI or being optimistic
and pessimistic not block your user but
right now it's not ready yet for
production okay so try when you're doing
your app in react native try to so be
optimistic with your UI don't block your
user try to be pessimistic on your
request like and and pragmatic don't try
to send requests if if it's useless if
you know they're gonna fail try to adapt
your UI to yeah keep the user like show
to your user that you're in control and
that it's okay to not have connectivity
yeah yeah your app is in control and
everything is gonna be fine in this
uncertain moments save your application
state locally and often so that's super
easy with Redux places but if you're not
using Redux you might have to do that by
hand but it's still fairly easy right
yeah and do ya do it often and then to
finish trust your device not your
connectivity so one more thing I wanted
to talk about is that at AWS area we
really want to give back to the
community so we're launching to the a
program called react native need the
idea is that if you have like missing
components or like big issues or complex
issues that you are not able to fix you
can propose them on our website and then
the community the idea is that the
committed community votes for the one
that are the most important the one that
the most people need and then will
dedicate time every week to work on
these and of course publish them open
source so it's brand-new</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>