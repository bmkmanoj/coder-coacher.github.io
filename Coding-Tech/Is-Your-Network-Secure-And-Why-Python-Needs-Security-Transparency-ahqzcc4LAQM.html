<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Is Your Network Secure? And Why Python Needs Security Transparency | Coder Coacher - Coaching Coders</title><meta content="Is Your Network Secure? And Why Python Needs Security Transparency - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Coding-Tech/">Coding Tech</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Is Your Network Secure? And Why Python Needs Security Transparency</b></h2><h5 class="post__date">2017-12-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ahqzcc4LAQM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so to prepare for this talk I did some
research I went into your business I
went into your company and I took a
photo of your network security this part
at the top here are the bad guys this
part of the bottom are the successful
bad guys and I can tell you well
recognize this because this is exactly
what your network security actually
looks like the details of this this is a
little bit of fun bit of interesting
stuff this is what a lot of people think
of for security vulnerabilities this is
an example packet that you could send to
an old version of Python to cause a
buffer overrun in one of the socket
functions and execute some arbitrary
code on someone else's machine without
their permission if I take out the
padding that was just there to space
things out what we have is a couple of
hexadecimal values that are going to be
written into the stack and override some
values the first two are just to keep
things working so it doesn't crash the
last one is actually a pointer to the
system function in a particular version
of Lib C and the part just to the right
of it is the command that's going to be
run in this case bash in reality
probably something more fun than bash
what you may notice from this is that
those are very specific hard-coded
numbers and their addresses you need to
know exactly where in memory someone's
function is that means specific version
of Lib C specific build of the operating
system chances are you can't just fire
this packet at some random server and
get access to their machine but when you
know the Machine you're going to or if
you have a lot of machines to try it
against you can eventually extract this
information and there may be other
vulnerabilities that give you the
information you need to construct this
packet to actually execute something
interesting this is what most people
think of for security vulnerabilities
it's a buffer overrun remote code
execution it's not the scariest
vulnerability that's out there because
there's an easier way to get into
someone's system and it and before I get
there the fix for this one is to patch
everything so many of the attacks the
successful attacks you hear about are
because people did not patch all their
things
and you may only be a few months out of
date on some components but if you
aren't patching if you aren't applying
security patches if you aren't tracking
CVS then you don't know that you need to
add these patches but that's the only
way to defend against attacks that take
advantage of bugs and code but as I was
saying there is a more much scarier way
to get access to people's machines and
it's simply to ask them for their
password one of these pop-ups is fake
can you tell which one it is who thinks
the one on the left is fake who thinks
the one on the right is fake the answer
is the one on the right but there's only
one way to tell and it's because the
batteries are 100%
[Laughter]
but also for those who don't know if you
do see this pop up and you hit the home
button then it won't go away if it's a
real one that does go away if it's a
fake one but this is actually a genuine
attack that it's being used out there
and it shows up in a whole lot of other
places in some of my research for this I
found a Python script called Bella that
uses very simple Python code to pause
iTunes pop up a dialogue saying you need
to enter your password to get iTunes
back you put your password in and then
it just unpause as iTunes and people
fall for this you may also be familiar
with this kind of section of your email
inbox you'll notice I haven't read any
of them they're all unread still most of
them have attachments who thinks those
are good attachments have I really got
an invoice payment copy that I need to
read these are more attacks and these
are going to vary from exploiting
vulnerabilities and PDF readers all the
way through to simply just giving you a
script that when you double click it it
runs and someone now is inside your
machine but of course no one no one here
would ever click on one of those right
so who has a colleague who would
probably click on one of these how
secure do you think your network is
given that this is what people are doing
to attack so how do we protect against
this ok well let's try something else
[Laughter]
there are plenty of solutions to
security issues that unfortunately run
right up against the ability to get
worked on and so those are not the
options so we only really have one thing
left to do here but perhaps you're
thinking this is not so bad that you
know at most it's going to get into
someone's you know marketing intern is
going to open this email and now they
get to pretend to be the marketing
intern but they don't have route and you
know they can't upload stuff to
production or whatever so it's probably
okay let me walk through why this is not
okay here is kind of the idealized idea
of breaking in from somewhere out in the
world to get into someone's piggy bank
and take you know emails social security
numbers whatever information you have
about your employees or customers that
they want to get this is never the case
this is this is wise case this is
someone connects from out in the world
somewhere on the internet through your
crown jewels and takes them you protect
against this this is a firewall that's
easy
so what attackers do is they find a
computer they can get into somewhere in
your network that has access and all
they've got to do is get into one other
machine and then if that user has access
then they can just go in and get it but
if they can't do that I forgot to kill
notifications I'm sorry
but if they can't do that all they have
to do is get into another machine that
then at some point has access to that
second machine that can eventually get
to the crown jewels and what if that
machine they get into is not one of the
ones that you maintain is not one of the
ones that you know is on your network
because you have employees and employees
have phones and they connect those
phones to Wi-Fi they have laptops they
connect them to Wi-Fi they take work
home and suddenly you've got all these
ways that an attacker may be getting
into your network that you don't know
about and from there getting to the
crown jewels you've also got network
switches do you think your network
switch is secure
have you changed the default password
from admin admin have network connected
printers network connected projectors
if you're lucky network connected coffee
machines thermostats light switch
everything you could think of is on your
network in some way if you go and ask a
system administrator what is your
network layout what devices do you have
on it they'll give you some of the
workstations if you ask an attacker what
is on this person's network they will
give you this diagram because this is
the truth your attacker is more patient
than you if they can't get to their goal
within 5 minutes they don't give up they
just spend longer getting there and they
know your network better than you they
will find everything that is in any way
connected to your network and use it if
you are tracking some of the recent
malware outbreaks the ransomware that
hit the entire world
most of those were designed to only
propagate to machines on the same local
network as an already infected one they
weren't designed to cross the Internet
think about that these were released in
like a few companies in Eastern Europe
typically and within hours spread to the
entire world despite not trying to what
devices are connected to your network so
given network security looks like this
what do we do the answer is to switch
mindset because everything so far has
been how do we stop people getting in
there is a concept that's gaining
popularity now and is recognized as the
only sane way to exist and that is to
assume breach to assume that despite all
of our really really good protection the
attackers are in the attackers have
gotten past them they're on the other
side of the sieve they're inside our
network what do we do first what are
they going to do they're trying to
infiltrate but we assume breach so we
assume they're in we try to protect but
if you only protect and have no security
cameras inside
you're building it's as good as locking
the door when someone gets through you
don't know that they're in they're going
to try and persist I'll dive into this
in a bit but while they're persisting
we're trying to detect they're going to
get in they're going to run their code
they're going to hide they're going to
bounce from machine to machine and they
don't want us to find them so we're
going to detect them and then their
final goal is to exfiltrate
to collect whatever data they're
interested in and get it out either so
they can sell it or alternatively
they're just gonna cause damage either
way it's our responsibility to respond
typically by removing them from the
systems persistence requires a handful
of things to be really effective this is
what attackers look for in a target
machine when they're trying to persist
on it they want a typical execution you
don't want to have to have to install
something on a machine that you're
hacking into you don't want to have to
use GCC on the machine that you're
hacking into for your hacking tools you
want some way to get code on there
running that is atypical it's not normal
you don't want any validation of that
you don't want to be caught in any white
list or black lists of bad code malware
scanners for those of us who use them
you need the ability to write files and
to access the network because that's how
you're going to persist that's how
you're going to keep settings on the
machine that's how you'll get onto
someone else's machine and you want to
be able to create servers creating a
running server of any sort that someone
from the outside can connect into to get
information out is very valuable thing
for exfiltration and of course you don't
want any logging because everyone
reviews their logs and will see you very
quickly if everything you do is being
logged you laugh about that and if you
laughed about that you don't care enough
about security for any of this to metal
because the people who care about
security review their logs and their
logs are much bigger than your logs but
they review them anyway because it's the
only way to detect when attackers have
gotten through your wall so the tools
that are very popular for this bash
obviously you can do a lot you can do
all of this stuff with that but then you
have to write bash scripts
PowerShell also very popular especially
on Windows machines it's already there
does a lot of this functionality so much
so that it became so popular with
attackers that the PowerShell developers
went in and added a whole lot of the
functionality I'm about to talk about
for Python and now it's not so popular
there have in fact been many many
stories of attackers completely taking
over networks and simply upgrading power
show has enabled the defenders to get
them out
pearl falls under the scripting language
kateri can do all of these things again
you have to write Perl scripts and of
course the reason that we're here is
because Python is also a popular tool
for this part of attacks again we could
fix this it's very easy to fix this but
it doesn't work it doesn't let us
continue on business because even though
we can be the most paranoid security
person in the room have the most power
and you still can't override the CEO who
wants to sell a product and make a
profit so this is not a viable solution
but the viable solution is to go from
banning everything to knowing what's
going on this is not ordered as in
review all the code and sign off on it
and then forget about it this is seeing
everything that's happening on your
network this is knowing the things that
are going on at all times so you can
detect and respond this is security
transparency your operating system can
already do this if you enable it your
operating system can log every single
process that's run every single command
that's run every single file that's
written every single network connection
that's made and you can have a massive
massive stream of log coming from your
operating system that will tell you when
someone is doing something funky but
unfortunately if someone starts running
Python you don't see those events and so
this is a legitimate statement that many
paranoid security people have made we
cannot have Python running on this
system because it's possible for someone
to start running their code in it and
now they and now we have no insight into
what they're doing to don't take photos
of this slide yet it's going to build up
so pep 551 is my proposal to add
security transparency the main goal is
to give a response to people who see
this so that we can change their
statement we don't want any employers
any networks banning path and outright
because it's insecure what we want them
to say it's okay because it's audited
and because we can show that what it is
being used for is what its intended to
be used for and even adds some I'll be a
tweaked guarantees that that's what it's
doing that it's actually okay to be on
there now you can take a picture of this
slide so here's an example of some
malicious Python code the fun thing
about Python is you can put as much code
as you like on a single line and then
you can execute it from the command line
you don't have to put a file on the file
system to run as much code as you want
this big chunk here is basic C for which
we can tell because we're gonna decode
it simply looking at this log this is
all your operating system is going to
show by the way if someone jumps onto
your machine and runs this using one of
the exploits earlier you'll see this in
the log you can't automatically detect
this it's encoded simply Albi it but you
can easily imagine that you can use
different sorts of encodings with
similar import decode calls and then
they're going to executors a valid
you'll see it used like this if you want
to copy that down and run it go ahead to
save you the time that's what happens if
you do want to copy it down and run it
I'll save you the time go ahead and take
a photo of that I promise it doesn't
really actually download tools to your
machine so by making Python security
transparent we get to see information
that we wouldn't otherwise see in that
case you would get that command line is
show up in your operating system logs
and then the fact that your machine is
totally compromised may also show up
eventually or it'll hit the news first
with transparency in Python you get more
events in your log you get to see
exactly what code is running you'll get
to see what files what network it
accesses and especially what red flags
there are in that code that can help you
trigger alerts based on that logging
without you actually having to read
everything so with my sample
implementation of the pep I basically
dumped all the events that come out of
running that bit of code this is heavily
abridged because python imports about a
hundred and twenty modules at startup
just to run that code but the rest is
here and there are two red flags
straightaway
we're compiling and executing arbitrary
strings
most production Python code does not do
this most Python code that has passed
code review does not do this and the the
production code that does do this I'm
sure is only temporary and has only
actually been running on the production
machines for a year or so but you can
see here we have the full string that
was executed that top one there is that
base64 chunk but now it's decoded and
this is being passed out from the
interpreter at the time when it compiles
it you can't encode this anymore because
the compiler has to compile it now so it
can't still have any sort of encryption
you can't you can't even rot13 this
because python can't compile it so you
get the completely decrypted code that
we didn't see in the operating system
log and then the second bit is the code
that it downloads and executes so this
is a simple bit of code to obtain a
payload from somewhere else through a
redirection link in this case and then
execute it locally you can also see this
chunk of very useful information here
which are the network addresses that
were access to get that code you'd
likely see these anyway from the
operating system but in this context we
know they came from Python we know they
came from the same Python process that
that executed that code and we know that
it was immediately followed by compiling
and executing more code so much more
context on what happened but it also
gives the ability to intercept this
stuff in Python but to be completely
clear
if this change gets into cpython
it does not automatically make python
more secure in fact if it gets in it has
literally zero impact on Python right
away this is about a way for system
administrators a way for end-users to
add the hooks that you need to integrate
with your logging system if you don't
log these events in any way they don't
go anywhere they don't do anything
detection is your job you will see these
events but if you're not looking at them
if you're not reacting to them you don't
get any benefit and overall system
integrity is also your job if someone
can simply bring their own copy of
Python and not use any of this at all by
dropping their own one on there you
haven't achieved anything and of course
you can pay people to be paranoid for
you which if you're not already paranoid
I would recommend but this is not a fix
for security in Python this is enabling
the security people to be told you don't
have to ban Python here is how you can
make it work so what kind of events do
we trigger on I've broken down into
three categories here there's things
that all code does you will get
thousands and thousands of these events
because everyone imports everyone
compiles not everyone should use sockets
but eventually you do and everyone's
going to use URL live at some point
there are things most code never does
you'll be interested in these events
when they show up but they will show up
from time to time exact eval ID RAC type
struct monkey-patching can also be can
also be logged because we can raise
events when you set an attribute on a
type object when you set an attribute on
a module and this is really important
for detecting if someone's trying to
bypass your detection and finally the
things that nobody should ever ever do
except you know when everything's dying
and you need to temporarily put it in a
production for a couple of years adding
clear audit hooks if you're listening to
events and someone else comes along and
says stop listening to events you you
want to know about that because they
should not be doing that to you directly
creating code objects and function
objects great
for party tricks but not good for any
other use and a really big red flag that
someone's trying to do something they
shouldn't directly ask accessing frame
objects or if you've ever been told that
pickle is not secure it's because of
this function unpick allure Dodd fine
class so we'll just let you know that
someone hey someone is unpicking
something here is what they were trying
to unpick or you might want to have a
look because they shouldn't be doing
this so this is the two parts of the API
for adding a hook there's a few more
pieces but this is the most interesting
part you can do it from C this is really
valuable because if you're prepared to
rebuild the Python entry point which is
literally that's it the the POSIX
version has a bit more encoding stuff
around it but this this is all the entry
point is when you add the hook before
that you will get auditing events for
the entire initialization process
everything that gets loaded at startup
everything that gets processed startup
this is a lot of logs on the other hand
if someone has already compromised your
Python before you start then you really
want to know about it before you start
you can also do it from Python code this
is great for testing this is great for
demos I'm about to do a demo with this
it's also very handy if you just want to
actually get the information for some
other reason if you want your unit test
to report who did monkey patching while
I was unit testing you could add or add
a hook and collect all the monkey patch
events and dump those out somewhere so
there are uses beyond simple security
transparency for this there are testing
validation uses for this but this but
this is the motivating reason for
bringing the proposal and of course
these folks don't have to succeed and if
they do throw an error then it's going
to abort the process in most cases
that's probably going to bring down the
entire application and that's likely
what you want but most of the time
you're not going to fail it because this
is really really aggressive and actually
going to be highly disruptive so
detection is the main thing but there is
the ability to have some simple
prevention in place using these hooks so
let's look at an example for that
from our earlier bit of code I've got a
hook here we're looking for the URL
you're a lab event which is going to
send through the URL that someone's
requesting we don't use bitly internally
but that attack before was using bitly
okay we decide it's good enough to say
no bitly for our app this might actually
be useful if you're concerned that
someone might figure out a way to coerce
your app into downloading an arbitrary
URL and executing it
that's an application-level
vulnerability Python can't protect you
against that but many attacks do involve
things like send a carefully constructed
header and then you know we'll take that
URL out of it and redirect to it and
download it so this may be useful for
that case first we're going to print a
message you probably don't just print
this you should be sending it to a log
collector syslog wherever that happens
to be for your case but we're also going
to raise an error and simply just stop
finally we add the hook we do this in
Python code so this warrant applied
during initialization this warn't apply
during side packages during import cite
cite customize a lot of places where
this won't be run but after we've added
the hook it can't be taken out so once
the hook is in you can't actually remove
it so from that point on we'll have any
indication that someone's trying to
access a bitly link so when we run this
sample again instead of getting the nice
ASCII art we get a warning message this
is the print this is telling us hey
someone's trying to download from this
URL we also get an error it's actually
just blocked and those tools that were
downloaded symp completely and entirely
blocked to be clear this is a proposal
this is not yet in C Python we're still
discussing it we're still arguing about
the the motivating cause the value of it
does it need to be in core should we be
giving it to the people who need it
separately as a patch so they can build
it right now it is available as a patch
that link at the bottom will take you to
my github branches against three seven
zero alpha two and
three six three where you can simply
grab the code any operating system build
it play with it use it you can
definitely get it now if you have
questions if you are interested in using
it if you believe your company
organization would be interested in
using it feel free to get in touch with
me I can be reached that email address
that Twitter handle or since we're about
to go to lunch feel free to find me and
let's go have lunch and chat thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>