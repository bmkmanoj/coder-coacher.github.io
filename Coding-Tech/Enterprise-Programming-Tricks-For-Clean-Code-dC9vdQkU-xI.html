<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Enterprise Programming Tricks For Clean Code | Coder Coacher - Coaching Coders</title><meta content="Enterprise Programming Tricks For Clean Code - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Coding-Tech/">Coding Tech</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Enterprise Programming Tricks For Clean Code</b></h2><h5 class="post__date">2017-09-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/dC9vdQkU-xI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">right good afternoon yeah this is a
shamelessly clickbait tea title I got
carried away one day and I have actually
tried to give it a another conference
but it wouldn't actually fit in the the
information slightly they said it was
too long a name and they said what's the
short version of it there isn't one
I've done a couple of things I've got a
very strong interest in how people do
things patterns and how people do things
well but also recent discovery I say
recent about two or three years ago
a discovery that problems in code arise
not because people are being bad or
stupid or evil and in fact it actually
turns out when you ask people to write
bad code it's quite difficult for them
to sit down and write intentionally bad
code but if you tell them to write in a
particular style if you say I want you
to assume a few things use this style
suddenly they are able to generate the
kind of code that we dislike well I hope
we dislike and the editor of 97 things
every programmer should know which may
or may not appear at this point there we
go and style therefore is one of the
things that dominates this book but
there's another thing I'm interested in
I also run a page on Facebook called
word Friday
it's about language and linguistics and
words I'm very interested in words and
language so occasionally when I want to
understand a word I will try and find
out a little bit about its history its
range of meanings so I thought I'm using
enterprise in the title so let's find
out what it means what the problem is
I'm of a particular generation that
whenever I hear the word enterprise
there's only one thing that comes to
mind you know
so you know I still kind of think it's
like whenever people sitting there and
doing enterprise architecture okay think
of tomorrow you know yeah and you've got
a sort of the gorgeous reboot model it's
just like this is great stuff actually
Enterprise has been used as a
hypothetical craft name for a number of
things this is a this does sadly does
not yet exist but it's a it's an
artist's mock-up of what the first warp
drive craft would actually look like and
it's a NASA idea though financially warp
coils and you think I'm kidding no this
is real this is actually based on a
theory by the Mexican physicist Miguel
Alcubierre who realized in 1994 that
there are certain interpretations of
general relativity that actually allow
you to create warp drive and that
actually by using these coils you will
actually distort reality in a way that
allows you to as it were cheat our
perception of speed of light you never
actually break the speed of light okay
you cannot travel faster than the speed
of light in space-time but what you can
do is make space-time move faster than
the speed of light yeah it's clever it's
a trick okay and it's just as reality
distorting as enterprise architecture
this is why I mention it okay there is a
reality distortion field so let's
actually dig through the dictionary see
what's going on so a project or
undertaking that is especially bold
complicated or arduous yes enterprise
architecture is particularly this stuff
readiness to engage in undertakings of
difficulty risk danger or daring yeah
this is getting it a design of which
execution is attempted I love this
because it doesn't say either
it says well we're gonna try it we're
gonna attempt it who knows what will
happen and then there's a bunch of
others yeah these are boring we only
want these we only want these ones okay
so I'm going to write enterprise code
what is code okay so code we think we
know what
code is a set of instructions for a
computer we kind of familiar with out
okay that's good
a computer program normally we don't
deal with the lowest level we use the
term code to describe both the binary
and the source we are they're both
referred to as code a system of words
figures or symbols used to represent
others especially for the purposes of
secrecy hmm you know what you go around
and you look at certain code bases and
you think that's the meaning of code
they're using I have no idea what this
is doing a set of conventions or
principles governing behavior or
activity in a particular domain like a
code of practice and so we have that so
this is the interesting thing that's
because banked what I was saying there
was this realization and I'll show you
the code at the end or the related code
at the end of a systematic code a
systematic set of practices that allows
you to generate enterprise architecture
allows you to create these things and
this is a non exhaustive list but I'm
gonna this is this is these are some of
the common things okay singleton
configuration yeah we're gonna have one
configuration and everything's going to
go and see it and it's gonna be a single
term it's gonna in fact you know what
it's not just configuration its
singleton anything in fact I can get
this to working Singleton's that's
normally just a problem ironically it's
very rare that you will ever find a code
base that has only one singleton in it I
find that ironic the number of
Singleton's in a code base is zero or
two or more verbose naming you see had I
done this talk say fifteen or twenty
years ago I would not have put verbose
naming it I were to put abbreviated
naming I mean we still have a few
abbreviated naming problems but these
days it's it's like some kind of
inflation has taken hold there's a
hyperinflation and naming will come to
that
noisy logging it's just that I don't
know what's up well let's just log
everything okay this is one of the
things I've discovered people often put
arbitrary logging in because they don't
understand what they need from logging
they never ask the question they think
they know what the requirements are for
the functionality but nobody ever sits
down and says what do we need from
logging what are our requirements from
logging you normally get statements like
oh you know just log what you feel like
or my favorite one yeah we know what our
logging requirements are to log
everything when somebody says our
requirements are to log everything you
know they have no idea what they're
doing okay so I ask them little
questions like so you're logging the
logging no no no no of course we're not
logging the logging and I said well in
which case you're not logging everything
you see I have a very simple
mathematical understanding of what the
word everything means and you're not
doing everything you're doing a subset
of it so then the question is what
defines the subset and I will say things
like well you didn't you didn't you
didn't love the fact that you
incremented a variable here or that you
allocated a variable here or that you
did this or that you took this branch of
the oh we're not logging all the things
we're not logging everything well you
just said you were logging everything so
there's this kind of idea that you end
up with everybody's own little version
of everything and you end up with a lot
of noise and just where you need it is
not where you get the logging repetition
and duplication let me just say that
again
repetition and duplication because this
is one of the most popular techniques
and we either do it by explicit copy and
paste or we end up seeing this by
reinvention familiarity recurring
structures unnecessary code just the
dead stuff it's just that either the
dead code or the code that is just noisy
in other words there really is a short
way to do certain things and people
sometimes find the longest way around
mixed levels of abstraction there you
are riding through a function writing
through a function at a particular level
of abstraction you're talking business
that's great business business business
boom socket connection what
socket connection memset what on earth
it's got bull business back down ma'am
copy what what is going on here I mean
you know this I mean great roller
coasters are fun but really not in the
codebase that's not where you want to
see you you know you stay in a level you
say okay well that soccer T in memory
stuff that's down there don't you worry
about it this level we're talking
business stuff and dip down so mixed
levels of abstraction you give you give
the reader a rollercoaster ride they
will be very confused
legacy coding habits this is one of the
things many of the languages that we
work with many of the languages we work
with are either old languages that have
got a history and therefore it is
possible to start programming in one
decade at the top of a file and actually
progress through time as you reach the
end yeah and you know one of most
extreme examples I encounter there a
client who wanted me to give him a
workshop on test-driven development and
some agile development last year and I
said yeah sure fine what language and I
kind of expect it because they do some
numeric work I thought it sort of
thought they might be doing some see
some C++ Fortran no I did not expect
Fortran that proved to be very
challenging I thought I left Fortran in
the last century but one of their one of
the discussions that we had during the
day they said yeah we actually have some
Fortran that goes back to the late 1950s
Fortran was invented in the late 1950s I
mean so you know this is beautiful
museum piece but apparently it's still
running so that means they basically got
code that smears through time through
the 50s the 60s or 70s and 80s the 90s
into the naughties and now into the
2010s and it's just wow that's
impressive
it just makes some of the C++ code bases
I've seen look really quite young so the
point here is it's not just the codes
the habits and there although you may be
given a new language and you can pile
you still end up with the older habits
sometimes you take on a new language but
your habits from wherever you've come
from they care
/ so we find a lot of this and that's
also builds up the unnecessary code and
the noise and then there's programming
by coincidence what does that mean
it means that sometimes things work and
really they shouldn't yeah the talk
after mine is undefined behavior okay
and unfortunately one of the definitions
of undefined and the clue is in the name
it's not defined one of the one of the
possible interpretations of undefined is
it does exactly what you expect it and
nobody questions it until maybe about
four or five years down the line you you
move platform you change the compiler or
something happens a small disturbance in
the force it's all it takes and suddenly
you're on the dark side okay and there
you are you you know but you don't feel
like a really cool syslog you just feel
like you're debugging till midnight so
what is going on so there's just stuff
that kind of works but actually you know
and this is important because one of the
standard phrases that software
developers use when you sort of say when
you point out something a question
there's a better way of doing it they
will come out with the phrase it works
as if that's all it needs well yeah it
kind of worked that one time on this
compiler in that phase of the moon but
don't count on there in future and then
programming my superstition sometimes
people have these strange beliefs so why
are you doing that well I look I'll
optimize things really yeah yeah if you
do this it kind of speaks speaks
profoundly to the compiler and it just
goes a bit faster so you do know that
hasn't been the case since the 1980s
yeah Oh some of those beliefs people
have about exceptions and stuff like
that it's great oh you got other great
ones oh we're not going to use the
standard template library why not well
you know it's not as efficient as
rolling your own code doing it by hand
and it's too far
you know I I actually did that with one
client we was one of their concerns was
that a lot of their developers were they
they were C programmers C programs Java
programs some C++ programs but whenever
they program C++ they always ended up
with this I mean what I would call
c-plus you know it's kind of oh yeah but
not quite you didn't get the second plus
I mean yeah you're using a C++ compiler
in yeah you've tightened up the type
system and you've got a few things oh
look you've used the word class once at
the top of the 10,000 line files well
done but sometimes you end up with stuff
that you sitting there going what are
you doing all this memory management for
well it's faster than using fact so so I
did I did this example by showing how
how different the code was if you wrote
it using something in the standard
library or if you wrote it out longhand
C style and I had tests to prove that my
code was correct and did the same thing
the final code was the fully expanded
version was something like five or six
times longer and far more complex and
when I say five or six times longer that
is source lines I'm not including the
fact that some of those were curly
brackets because the actual version
using the standard library was mostly
space so we end up with these little
beliefs and those beliefs guide us so
what kind of enterprise the example and
I'm going to try and explore well you
know real real software fizzbuzz
legitimate Enterprise II okay so
fizzbuzz quick show of hands who's come
across this bus a number of you so a
number of you haven't right so the sink
of all human knowledge wikipedia says
fizzbuzz is a group word game for
children to teach them about division I
have to say when I looked this up on
Wikipedia I was very surprised because I
know it is a drinking game I am NOT in
Tyre
I am not entirely sure what kids are
doing with this but you know so you know
there's a basic idea players generally
sit in the circle the player doesn't
laugh let's just pick out the important
bits okay what are you doing is you
gonna count one two any number divisible
by three fears for but any number
divisible by five is bus fears seven
eight now if I say nine I get it wrong
and normally there's a forfeit
of some kind if you're a kid that means
you no longer play which I don't think
works it's not a good incentive model if
you're a child that doesn't like maths
then you get out of the game as quickly
as possible
yeah so I don't think that works anyway
divisible by both 14 this bus okay so
not exactly the hardest programming
problem in the world however I found the
most unusual thing about the Wikipedia
definition was their use of the word
dense fourth credit to whoever wrote
that because thence fourth is I mean if
you can get that into a conversation
well done because that is just not a
word that we've used for like 200 years
okay in English I mean thence forth is
really archaic and it's just like but it
fits perfectly I mean you know well done
I mean Wikipedians this is what happens
when they get bored okay so what do I
know adults may play first buzz as a
drinking game we're making a mistake
leads to the player having to make a
drinking brighter food yes hi this is
more like it but the best bit about the
Wikipedia page citation needed
[Laughter]
yeah every was too drunk to kind of you
know yeah anyway so things we know first
bus has been used as an interview
screening device for computer
programmers but my best best comment I
saw it last year or a couple of years
ago this buzz was invented to avoid the
awkwardness have realized that nobody in
the room combined research and array
it's just like what are we gonna do is
buzz you know what about binary search
we always get off by one error so let's
just do this buzz okay so let's have a
look at how not to do this there we go
that's outstanding this is a work of art
I had to really sit down and create this
with some effort but it's based on stuff
I've seen so let's walk through some of
the craziness here first of all let's
just go retro okay let's let's just
channel that kind of like macro stuff
forget the Const keyword okay and we're
gonna and and and so we're going to put
a constant in for Fears and for buzz
because you never know they might change
which will never confuse anybody if
you've now got a constant named fizz and
it does something else and then because
you know you're everybody seems it seems
to be almost a rite of passage you've
got to put a null macro in there yeah
okay yeah now it's a real file yeah and
then PI because you just never know yeah
so you know it's a constant isn't it you
know there's not much of it but you
never know we might need a couple of
decimal places then we have you know
let's go for meaningful names yeah we
could call it fizzbuzz no we're going to
call it fizzbuzz calculator I mean we
could actually make the name longer you
know you can use your creativity here
but this is just really and then we're
going to bunch all the declarations up
at the top so they can huddle like a
family which is great but that's not how
declarations are supposed to be it's not
cold in the code they don't have to
they're not like penguins okay and then
we get some great stuff here oh we've
got our we've got a chart we've got a
buffer how big should a buffer be well I
don't know I'm gonna I'm gonna sprint F
into it so I know 512
want to know what about 1024 yeah it
sounds safe so yeah that's kind of
reasoning that goes through them just to
make sure it's all empty we're gonna
zero it because you just can't trust the
compiler to do it itself I did actually
see a few years ago somebody wrote our
not gonna say his name but he wrote two
articles that were about initializing a
character buffer a fixed length to
articles and lots of template code I
remember my comment was you can do this
in one line in C and it generates the
same code that you've done it's just I
really trust the compiler they they
they're pretty good this kind of thing
memset if memset it's the fastest option
the compiler will use memset if it's not
the fastest option then why are you
slowing it there let it do its business
okay and then because this programmer
having worked happily in the 1970s and
80s with those macros heard about
lambdas decided to go mad and just put
it all on one line so we've got these
crazy lambdas for doing the division
then we got a range checking normally
the problem is defined from the range to
1 to 100 then we do our serious printf
business because you know that whole C++
thing and then we log to our unique
instance and if it's bad and then we
throw so we log and throw very popular
technique and you know that takes up a
few lines and then we have comments I
haven't mentioned the comments here this
is great they just repeat what we can do
we do our we use our lambdas we do some
more sprint F and then we have this
beautiful result statement that
clarifies the name of the variable read
Val just in case we hadn't figured it
out its return value and some
parentheses and we say assign return
value revel and return what's the next
line ret Val dot assign and the flying
after is return ret Val so you know that
comment just make sure it's all good
okay you just you know just in case the
compiler says I have no idea what you're
doing with a code let me look at the
comment oh that's brilliant thank you
yeah
okay so this is a great this is a great
observation this is Paul Anderson is he
was a science fiction author the coin is
thing called Anson's law I have yet to
see any problem however complicated
which when you looked at in the right
way did not become still more
complicated this is the manifesto for
software development okay
and how can we do this what what are
some of our favorite crazy examples in
something like C++ well that code was
the code it was the code that launched
it all it was the code that launched
template metaprogramming it was the
realization by Irvin Unruh in 1994 that
he could create a program that did not
compile and lots of people are going
like yeah I can do that every day of the
week but his compilation message was the
first few prime numbers he discovered
that templates were cheering complete
and then from that point on the result
has been anything but temporary it's
been permanently in certain code bases
and every now and then you're just
looking at stuff and just there's a
flock of angle brackets and you're
looking this no idea what this is doing
and your colleague will say it's really
clever
so what's it doing I have no idea it's
it's like it's it's out of my short-term
memory just don't don't ask me to do
anything with it so yeah why am i
showing this because you can do some
really crazy stuff with hey if it's buzz
and this is by Adam Peterson who used
the boost libraries to create fizzbuzz
and when it doesn't compile it gives you
fizzbuzz see that's far more interesting
than most of the error messages you get
these days sadly C++ 11 onwards have
come along and spoiled our fun it turns
out we can do compile time compilation
and stuff and it's you know we can do it
all cleanly we don't have to just sort
of wallow in the mess that is template
metaprogramming now I could I've got
here in modulo 3 and n modulo 5 I could
reduce that to n mod 15 because that's
going to be the same but there's a
there's a reason I want to try and keep
it here because if you look carefully
what you'll realize
and this is one of the fun things about
the fizzbuzz problem is that there's no
way seemingly no way of writing a
fizzbuzz implementation where you do not
do some repeated state check so your
eyes are going to check you're either
going to say okay divisible by three
let's and fizz to it divisible by five
let's add buzz to it so that means you
feel really clever because you don't
have to do the 15 case and you've used
concatenation the only problem is you
still have another if to do if something
happened otherwise I need the number so
you're always going to end up with some
state dependencies some temporal
ordering alternatively you can have
something that doesn't rely on temporal
ordering but then leads to duplicate
condition because effectively we are
testing three and five twice so this
observation was made this as wonderful
paper and presentation by amateur Parag
the default action is executed only if
some previous actions were not executed
so you know the example that as I
mentioned before there we go there's
honor there's our accumulation
accumulate it if it's empty then do
something
but we're still depending on it
alternatively I get try and get really
clever I do this in a much more
declarative style okay and I say look
I've got an array it's got empty it's
got fears it's got another arrays got
empty and bars and then the result is
well let's just do modular arithmetic on
each and concatenate it but I still have
to have the second check I still have to
go back and say did something happen so
there's no way of her of avoiding these
repeated checks or is there well I was
the whole thing this guy did this in
Haskell and say we we asked if we can
accomplish this without having to check
the conditions for the previous actions
twice in other words if we can make the
control flow follow the information flow
without losing modularity so you have a
perfect flow with no rechecking
discontinuities or anything sounds
perfect yeah I had a chance late at the
Haskell it was quite fun you know if you
really want to keep your job this is how
you do it because nobody's going to get
rid of you so we've got fizzbuzz and i'm
going to throw in a lambda just
just for the hell of it and that Lander
is going to take a function object that
takes a string and returns the string
and the lambda
well the first lambda is going to do a
mod 3 check and if it is divisible by 3
then it's going to return a lambda so
when people talk about higher-order this
is what they're talking about it's
slightly confusing in that says so we're
going to return fears plus the execution
of that function on empty otherwise
we're going to return the thing that was
just passed in and we've got buzz here
as well yeah and then we just do the
things at the end what we do is we have
a function that just returns whatever it
was given and then we compose them
together and we chain them together so
that what we've got is the identity
function so when I pass in anything to
the identity function it returns it then
it's passed to the buzz which then
returns a function that is dependent on
whatever was passed in here through to
ID through to the buzz and then gap gets
passed into phase so we've got this
chain of lambdas that normally at this
point your you might you might find your
brain is sort of leaking out of your
ears or you're falling asleep I don't
know which one and you're thinking
either your work either you're doing a
sort of standard thing in other words
what the hell is this or you're thinking
he's got duplicate code if you're
thinking to placate code you're right we
can get rid of that ok let's have a go
at this one so here I'm going to factor
it out even further so now instead of a
function that just takes a Lander it's
gonna take a divisor and a string and a
lambda and so it's really generalized
and it's obviously much easier to
understand and then I'm gonna learn to
this I'm gonna use bind because I feel
like I want to use a little more of the
C++ standard library so I'm gonna use
bind and then I'm going to use so I'm
gonna bind that together for 3 so I've
got a phizzer
now got a buzzer and then everything is
as before and you're done
and it's amazing in just a few lines of
code we've reclaimed that lost territory
of template metaprogramming is now dead
basically for most uses so where are you
going to write your obscure code like
this this is how you do it and this is
this is how you create you know this is
how you create the kind of code that's
so clever
the
you you feel like you are an artist
Oscar Wilde observed a work of art is
the unique result of a unique
temperament please don't do this in your
code I'm only joking let's be very clear
about that I don't need to walk out it's
going well it's a really cool technique
yes it is really cool do it at home but
not at work okay one of the other
aspects on the opposite side of the
clever clever range is the Congo cult
programing cargo cult program is a style
of programming characterized by Richard
inclusion of code or program structures
that serve no real purpose so ah you
know what we end up with is a problem of
signal-to-noise ratio okay
signal-to-noise ratio is a measure used
in science and engineering that compares
the level of a desired signal to the
level of background noise we often use
it as a metaphor to refer to the ratio
of useful information to false or
irrelevant data in the conversation or
exchange or a code base so you know this
is the the classic this is a great
Twitter feed to follow by the way the
expert beginner yeah what are those
people in operations want from me I'm
already logging in the beginning and end
of every method yes I'll do the middle
too it's just like yeah now we've got
this perfect example one of the other
cases we've already hinted of this is
the way that people will often just
comment stuff and there is that what are
you commenting well I'm just commenting
what the code does I'm just commenting
it so anybody can understand it
I made this observation a couple of
years ago it's probably my most
retweeted tweet : fallacy is to assume
authors of incomprehensible code will
somehow be able to express themselves
lucidly and clearly in comments because
if you think about it what you're
effectively asking somebody to do when
you say we need to cut please comment
that code it's not entirely clear what
it does I want you to comment it so that
people can read it and understand it now
wait a minute who's going to write the
comment the person who is unable to
write the code clearly is now going to
try and explain the code clearly so
suddenly there I mean it does happen I
have met people who have a incredible
ability to explain things and and to
actually write decent comments and
documentation and yet their code is as
obscure as the lambda code I just
but I'm going to say they're fairly rare
for the rest of us it's a case of like
well I had no idea what I was doing in
C++ so now give me English yep still no
idea and that's what you're left with
you've now got the same problem twice
but now everybody feels happy because
you've got comments okay what's the
other aspect of cocoa co-op program and
can also refer to the results of
applying a design pattern or coding
style blindly without understanding the
reasons behind that design principle
previously I was very rude about
singleton so I'm going to continue to be
rude about singleton singleton there is
actually a good singleton it is a
whiskey and I discovered I was clearing
out it's kind of tying up my office
earlier this year and I found an empty
bottle of singleton I also found my my
next-door neighbor gave me a bottle II
said oh did you know there's a bottle of
cider with your surname on it and it's
possessive Henny so that's great and
then my wife gave all of us in the
family
those customized coke bottles so that's
careful in any singleton if you want
yours you get your own okay that's my
one okay but this one is actually better
for code than the one you put in code
yeah it'll cause you to think reasonably
so but it does lead us into this kind of
cargo programming style this was a
thing that appeared on bonkers world
last year the world seemed by an
object-oriented program and you had this
is the naming gone mad this is exactly
what I was talking about look there's a
living space separation decorator a
visitor monitor interface my favorites
the multi but supporter and there's also
the entertainment provide a single turn
it's just that our dear God no no and
this is the problem we've ended up with
what might be called homeopathic naming
you know as we keep diluting the names
by making them longer and longer because
I'm just making it more meaningful it's
just like no you're it's like you know
you're not going to make the whisky
stronger by adding water okay so you
know this is an easily solved problem
one of the ideas behind object
orientation is you say hey look that's a
door you can't call it door everybody
will understand what you're talking
about look put some other things in
front of it like controller or interface
or some other wording
so all of the other things I'm
interested in is actually writing
writing fiction short fiction and
there's a book that has a series of
prompts and cards to try and get you to
focus on things and I found these were
quite relevant to code choose the right
name get specific the problem is that
sometimes people trying to over
generalize and the thing is that nobody
wants overly general names and they also
don't want overly general code this is
where a lot of complexity comes from
people don't have general problems they
have specific problems if you have
customers that have general problems
I want those customers because they're
great because they'll you know what
they're going to do is they're going to
contact you hey we need some software oh
that's cool what would you like it to do
oh I don't know it's something really
general I suspect that's brilliant just
send them an operating system because
that's so general that you can build
anything out of it and with it you know
here is a compiler from that you can
build the universe okay that's so
general that you're able to customize it
well how do I customize it you configure
it using a special a special
configuration language what's the
language it's called programming
language and you know you can then make
it do anything so get specific don't be
afraid to be specific now when it comes
to naming our current troubles are not
actually they're modern all my favorite
books of advice actually comes from
outside the C++ world and small talk
best practice patterns from the
mid-1990s and Kent back he he observed
back then you say look people will be
using the words you choose in their
conversation if in the next 20 years we
are now at that point 20 years on from
the netbook was published you want to be
sure you do it right unfortunately many
people get all kind of formal just
calling it what it is isn't enough so
what we end up with they have to tack on
flower and computer science the
impressive sounding but ultimately
meaningless word like object any fast
that ends in the word object is no
really honestly it's blindingly obvious
it's a brother object because that's its
class I mean I can't say fairer than
that thing I've seen that I've also seen
stuff in Co
component part manager entity item these
are all really popular and they were
popular back then but not as popular as
they are now and I had this interesting
this is actually relates to a client
visit as I had I've this is my
recollection of the code although I'm
pretty sure they didn't get it Const
correct so but I do remember the bits
that are correct they had a class at the
root of a hierarchy it only it was only
a pure interface of one function the dot
dot there is is to cover the virtual
destructor pure virtual and the class
was called condition checker which
sounds meaningful I mean it's got lots
of syllables it sounds like it's a
proper word it's describing things and
then you have a single function check
condition it seems very self-explanatory
but I remember asking them when we
started looking through the code and the
hierarchy it's basically checking rules
you know there's something true in which
case we fire an event otherwise here and
you're able to compose these rules what
does this really do and I said you mean
it's a condition yes and you're checking
whether all is true yes right that's
what it is it's a bit like the bit in
the matrix where Morpheus says to neo
stop trying to hit me and hit me it's
not a condition checker it is a
condition you're not checking the
condition it's true or it isn't it
really is we keep adding these extra
levels of indirection
you know yeah I'm expecting one day to
go into a code base check to see if it's
okay with you if that condition is true
and the full name is there and then
probably put equals equals true just to
be sure yeah
I believe the Italians call that lavell
overeater you know it's the true truth
as opposed to the false truth yeah but
you gotta be really really sure you
gotta check that condition because it
might move around when you're not
looking anyway the great thing is c++ 11
onwards it's just that you don't need
any of this it's just like boom just
disappears a puff of lambda and it's
actually quite simple not the lambdas I
had earlier okay so we need to worry
about tidying things up we need to worry
about clearing
things up so I want to walk through a
kind of a it's kind of area that this
question of refactoring and refactoring
is something that is often abused as a
term I've had discussions with people
where you know they've used the word
refactoring as I as I observe I saw some
you you're just using the word
refactoring to mean change the code well
I said that's not what it means
oh well you know that you won't have any
effect here Kevin because that's how we
use the word so you know these guys
would be sitting there and you'd say
what are you doing refactoring because
that's what they're doing they're
touching the code they're doing
something and you'd say well what kind
of refit while I'm trying to make it
faster well that's called optimization
yeah you performance tuning I'm trying
to fix a buck that's not refactoring
that's I'm afraid that's just called bug
fixing we don't have a really cool name
for it I'm sorry okay so the thing is it
turns out we've already got names for a
number of activities and refactoring as
it as a term it goes back to Bill Updike
about 25 years ago funnily enough in C++
and people have kind of forgotten that
there is a history there and it turns
out C++ is one of the languages that has
the most rubbish tools for refactoring
but it does have a precise meaning it's
a change made to the internal structure
of software to make it easier to
understand and cheaper to modify without
changing its observable behavior and
come back to that I'm going to be more
precise about what Martin means by
observable behavior and therefore to
refactor is to do this to restructure
software by applying a series of
refactorings now of course when you
refer to things things you're not just
improving the code or hopefully not just
improving code you could be making it
worse
sometimes as we've seen but there is an
idea of there is an idea of the behavior
what is the behavior that is unchanged
because clearly it might get faster it
might get slow and that's not what
Martin is referring to and now a number
of years ago I felt really uncomfortable
with I realized I was very uncomfortable
with one of the most common phrases that
we have in coding and software
development as a whole is the idea non
functional requirements and
non-functional behaviors of a system and
I'm just just to let you know that is
just terrible English go just think
about it for a moment
you got functional requirements okay
this is good you got all these
functional clothes and then you got
these other requirements what are we
going to call these I don't know they're
not those do we have a better nap No
okay let's call them not the functional
requirements that's a bit long it's
quite non functional problem is the word
non-functional in English already has a
meaning it means broken it means not
functioning as the name suggests yeah so
when people say you know you know what
are your non-functional requirements I
want it to crash every Tuesday I want to
not work okay I wanted to not work
because that is a non functional
requirement I want it to be out of
service for the whole of Tuesday that's
not what they mean it turns out so it's
it's a it's a complete failure of naming
a complete lack of imagination okay but
also it actually groups lots of
different things together that are
coincidental
and they're not actually the same so for
example and the this this is kind of one
of the sort of kind of classic example I
think I've taken it in James likes book
on chaos just imagine going to the zoo I
went to the zoo what did you see I saw
elephants oh cool what else did you see
I saw none elephants
tell me about the no elephants well you
know there was a very big elephant some
pretty small ones there were ones that
flew there are ones that swam there were
there were non elephants that like the
cold and non elephants that like the
warm it's just like you know what we
might be missing something about the
domain here a certain richness and
texture to it so yeah so one of the
observations you know up with it is you
can do this is roughly a right home rule
okay what you can do is you can separate
out a number of aspects functional
behavior
oh that's the semantics well this is all
good this is the stuff that passes all
fair
the unit tests operational behavior is
how it operates how it runs does it run
fast as it runs slow what's its
availability how does it scale there's
all those ill-at-ease but importantly
those are the runtime elytis there's a
properties of the system at runtime and
therefore they are in some ways like the
functional ones in that they can be
experienced by a user they can be
experienced in the running product and
then we have these down here
developmental the developmental aspects
of a system some of which we may have
requirements about the aspects of what
is it like to be in that code what is it
like to live in that code what is the
quality of the code that's your that's
your portability maintainability this is
properties that developers experience
not the users of the system that
developers and grouping those together
doesn't help us because it's really
those guys so refactoring when we say it
it doesn't change the behavior doesn't
change the functional behavior what
we're doing is we're trying to keep that
vertical axis the same stable don't
break the code then the developmental
axis we're trying to improve the
operational axis may get better or worse
it may go faster make a slur may use
more memory may use less and obviously
once you've got this model you've got a
really simple way of talking about
things like performance improvements
such as I'm going to improve the
performance the operational axis but
what happens to the development for
quality oh by the way do keep the
functional axis the same because
otherwise you end up with that kind of
classic problem of like well yeah it
runs really fast yes but it runs
incorrectly
yeah but the bugs run really fast don't
they there's a site No so the idea is
that both our functionality preserving
transformations but flip through 90
degrees so let's go have a look at some
code the code that kind of inspired me
or I accidentally recreated my clients
coding style by making just a few simple
assumptions and so we've got a function
here and so I want to zoom in let's have
a look at what we've got so we've got
I've got a function called create server
connection returns a pointer to a
connection we've got a bunch of
declarations at the top then we've got
some checking we're going to check the
we're gonna get the address from
configuration man attack it's a K do log
and throw if it's not Oh same again
more of the address and then OH same
again you know I keep on going and oh
yeah something actually happens now
we're going to do a conversion put bytes
all look interesting a to I and I'm
using data of the config port which is a
string I'm not sure about that and oh
I've beginning to get worried I haven't
seen a log and throw for a while but
it's okay there's one there and so we're
going to do that we can actually create
the damn connection that we said we were
going to do and we're gonna do lots of
checking on it we're going to check that
the result of new is actually not null
mmm yeah and then we're going to ask it
you okay you were right are we good yeah
no oh okay log and throw and then and
just to make sure because it's such it's
such a build up it's like practically a
film finale you know the the the you
know the ships exploding at the end I've
got a comment return the connection
because it's not obvious what we're
doing okay
so let's let's just go through this the
first thing I want to draw to your
attention it's actually the thing I
didn't say the comments
dear God the comments if you end up
writing code that comes in sections and
you put a comment at the top of every
section effect of it you are naming a
block it turns out there is a really
cunning little feature in C++ for naming
blocks it's called a function I know I
know
there you know this is straight out of
1970 okay so really what we want to do
is not that you never want a comment
it's just that if you are simply
compensating for other negative aspects
of the code then that's not a good
comment that comment is they're trying
to kind of hold the thing up but
actually I'm not just going to delete
the comments what I'm going to do is I'm
a fact that they are there's bad grammar
and bad spelling in there so I'm gonna
fix that first of all okay and gonna so
we're gonna fix the spelling and we're
gonna fix all the mistakes and then
we're gonna delete it
okay Heidi okay so you know so yeah it
just makes you feel more comfortable
check that version in and then check the
next version yeah
it's gone right so now the next thing
we're going to do is those you know
those those declarations they were
huddled at the top of the functions like
they're scared of the code okay
this let's distribute them amongst the
code let's just move them down and the
code becomes well shorter and more
logically structured because we have
we've moved everything to its
appropriate point and we moved
everything closer also I'm going to sort
of take advantage of the fact that Otto
does an awful lot of work for us
sometimes I mean some people it had got
to the point a few years ago when Otto
was initially introduced to do automate
automate it tie production people say oh
you're messing with the type system now
really or not the type the compiler
knows the type you know the type you
know it why are you typing it out again
why are you having to do this ritual and
with some of the type names we get these
days they get really long and in fact
some of them we don't even know so
therefore I'm going to go with that if
something is not obvious then we need to
make it clearer but normally the idea is
you want to make your code more obvious
you want to improve the obvious nough so
it's clear what the intent of the
right-hand side of the declaration is
you don't need to worry so much about
the left-hand side just as we want to
improve it so we don't need the amount
of comments so let's zoom in a little
bit so yeah we've got some legacy coding
practice here this is kind of whole
let's just check when let's just check
that new it's just like really well I
think I'm gonna get rid of that because
mu does not return null it's as simple
as that when people say well you know it
does still on some compilers I get this
every now and then and I asked people
what compiler they're using and they're
they so are using GCC you know I'm using
Visual Studio and I said oh right so you
using Visual Studio for answer no I
didn't even know the numbers went down
that low
you mean this was like you know four ad
no no no no no they will say well they
were numbered they weren't just years
originally and so there's this idea of
like actually it hasn't done that for so
long
that the world has changed in that time
so really just just go with it because
trust me if you haven't checked for now
there are far worse things you should be
checking for okay
now there's a little bit of a thing
going on here because let's have a look
at that we've got this raw pointer
floating around there's an allocation
there yeah so some people look we've got
a thing that does that Auto pointer
stand aside non C++ 11 person I've got
something better and so there you go
yeah pointer what word is this this
pointer doesn't work and so yes make
unique actually this is one of the
subtle things this is the wrong time to
do this refactoring because that
refactoring ends up with a signature
change so what I'm going to do is I'm
going to change the internal stuff
before I start changing bigger stuff so
actually I'm gonna be a little modest I
can say right I'm gonna keep the
external API stable and I'm going to use
unique pointer internally in our release
at the end so now is be very careful
there is a natural kind of sequencing to
refactoring so that means you don't
break the universe at least not all the
time so let's go back to the big picture
what we got here well there's a few bits
and pieces let's zoom in on a couple of
things
so configured rest data I feel very
uncomfortable that because data from a
string is not guaranteed to be null
terminated now it's very unlikely you're
going to find an implementation that
doesn't do that but this is programming
by coincidence it's not intended to do
that so there's this idea of like
actually it should be C straight if you
want it to be null terminated then it
should be that but if you look more
closely it's like why are we doing this
at all
a - I that's a C function we already
have s - I and C++ 11 onwards so
therefore I don't even need to worry
about data and dot's easter I keep
finding people trying to wrench the port
beating heart of C out of there C++
objects and it's just like let it be
it's okay they're good so the next thing
is then starting to look at the Sprint
F's and it's really funny because people
just get into a habit and these are kind
of copy and paste lines new york's
printf buffer
we've got the magic 1024 up there and
then we got the message percent s and
then we look who think that's really
funny because we're doing the same thing
basically what we're doing a string
concatenation except for the one at the
bottom
it's like well hang on isn't there an
easy way of doing this is there a safer
way of doing this well first of all yes
we can make it safe in other words
actually not run the risk of buffer
overruns let's use n let's use s n
printf to actually make sure that we
don't run off the end of the buffer no
but that's why I made it 1024 to make
sure we'd never run off it yeah cuz of
course you know one kilobyte is just
like yeah nobody's ever accidentally
gonna run off the end of one kilobyte he
says looking at his multi-gigabyte
machine it's like no nobody ever does
that kind of mistake
so yeah so we do that but then if we
zoom in a little bit it's like hang on
we've got this we're just concatenate in
strings you know this is this is this is
all doing and that string out there is
actually constant this is the funny
things when you start looking closely at
things you realize you know what we
could just get rid of some of this stuff
we can first of all make it safe by
using string stream but then we can
start getting rid of stuff and realizing
that one is actually a static string and
this one can you use ordinary string
concatenation why we're using a separate
F or string stream at all okay so if you
zoom out again things are looking a
little bit tidier but what I've done
here there's a number of different paths
we could take at this point there
sometimes people will say well let's try
and rationalize the logging let's a tank
that sometimes the best thing to do is
say I really don't like that log and
throw technique but what I'm going to do
is I'm going to put it to one side I'm
going to have a function fail to connect
and that will do log and throw okay so
in other words I don't like the log and
throw but we're gonna do it and I'm
gonna wrap that up and that now reduces
everything to one-liners and because I'm
rebellious like this I'm going to get
rid of those damn curly brackets because
oh the code gets readable there's this
interesting idea that we should always
put curly brackets absolutely everywhere
and sometimes it becomes ritualistic and
there is a good reason that people do
that but I like the alternative way of
looking at this which is perhaps I
should try and make perhaps I should try
and make the block one-line long in
other words why is it longer you know I
was challenged yourself the other way
why have I got along the block yeah can
I make it shorter particularly for these
guard style clauses so now we're getting
something that's much much shorter so
it's a little bit more tidying we can do
here so we kind of zoom in and there's a
few other bits and pieces so one of the
things I'm now going to start doing is
I'm going to start at this point I feel
comfortable enough to actually make a
signature change so let's go and make
the signature change let's go back to it
let's actually transfer ownership
explicitly in a way the API makes it
visible the next thing I'm going to do
is I'm going to get rid of this kind of
like object-oriented assembler you can
always spot object-oriented assembler
it's kind of like get and set and create
and stuff like that
create server connection that's not what
you want to do and you might say well
yes it is I want to create server
connection no no what you actually want
to do what are you really trying to do
what I'm trying to do is connect to the
server that's what you're trying to do
that involves the creation of something
but don't tell everybody about the
mechanics tell them what your intent is
you can the intent is connect a server
which also by the way happens to be
shorter at this point okay yeah okay
right let's have a look at this
singleton configuration first thing I'm
going to do is configuration manager
can't get value okay first of all it's a
value off stop getting everything I'll
talk a bit more about getting tomorrow
something getting everything just it's a
value of something that's what it is not
getting anything the next thing is is it
a configuration manager or is it just I
don't know you know the configuration oh
I can tell what it's doing now is
actually the configuration that's what
we're talking to we're not we don't have
a manager that's been controlled by an
entity that the level of indirection
that's no it's actually the
configuration so we've tidied this up
but if we look closely we will realize
that why are we doing all this
processing in here why don't we just
pass them in as arguments two string
arguments there we go there's the
configuration address and so in other
words what I've done is I actually I
didn't need to do all that stuff on the
singleton configuration because it turns
out that we shouldn't have been using
singleton anyway and parametrized
behavior using yeah wait for it
parameters that's why they called
parameters parameterize behaviors just
like wow
actions were built for this so pass that
stuff in and then if you look carefully
you'll see there's a lot of stuff to do
a string conversion and if you pause a
moment you think well hang on why are we
passing in strings why doesn't the
caller sort this out why are we having
to do this and this is probably being
repeated elsewhere in the code so we're
going to come back to that and just
realize you know what we've got here is
this it's like Oh most of the code
disappeared because what we've actually
done is realized that we're working with
the wrong types most systems we find
these days are what we call string ly
typed and so there's an awful lot of
work going into conversion and
validation conversion and validation of
course if you are getting paid for the
line of code that you're right ignore
everything I've said but the point is
you want to get those types as early as
possible binding them to the right thing
bind them to the right abstraction in
this particular case we already have a
UNIX level abstraction and it's just
like right oh that's it
so now what we're doing is we are
talking to the object creating it and
then we gonna ask it are you okay and
then we're gonna do a fail to connect
but why are we why are we having this
dialogue with it if it failed it should
throw an exception it shouldn't be
create the object and then to forget to
call OK on it it should just be this so
if it fails it fails a constructor is
not simply a an ordinary function a
constructor is a special function it is
a transaction and it like a transaction
it either completes and creates a new
valid state of the system or it rolls
back to give you the previous state in
other words it aborts with an exception
so it's a special kind of function so if
the trail if this succeeds we get a
connection if it fails we get an
exception and the world hasn't changed
except for the presence of the exception
and at this point we realize there's no
point in having this function at all
thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>