<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>HDR Photography in Microsoft Excel?! | Coder Coacher - Coaching Coders</title><meta content="HDR Photography in Microsoft Excel?! - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Coding-Tech/">Coding Tech</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>HDR Photography in Microsoft Excel?!</b></h2><h5 class="post__date">2018-01-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Qj1bvWMDhtg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">if you've taken photos before you might
realize that there are some areas that
are too bright and you can't really see
what's going on in there
and so photographers will tell you that
there's a solution for this
you just take more photos and then you
combine them together on the computer
using a high dynamic range algorithm and
as any business person will tell you the
right platform to implement your
solutions is always Microsoft Excel so I
thought long and hard about this and the
conclusion I came to was that we need to
do HDR in Microsoft Excel so I'll just
skip straight to the background
so let's let's try to think about like
what we might need for an HDR algorithm
so let's say we have these two pictures
here and one's brighter than the other
so we'll just take these areas that are
kind of blown out and copy and paste
them from the darker picture where
they're a little more detailed to the
brighter picture and we also need to
brighten them up a little bit because
the picture on the right is brighter and
we want everything to match up now the
problem here is that we don't know how
much we should brighten up this image so
let's learn about cameras for 30 seconds
this is a shutter and it opens and
closes to let in light now the longer
this shutter is open the more light is
going to come in and this principle is
called reciprocity so if we open the
shutter for twice as long we're gonna
let in twice the amount of light into
our camera okay so I'm just going to go
through take all these numbers in my
image and multiply them by two times and
we're good right but it's not that
simple because there's this thing called
non-linearity so I have this chart here
and what it shows is basically how the
camera responds to different amounts of
light coming in so you can see here that
if we increase the amount of light on
the bottom axis by the same step each
time we're gonna get a different number
in our JPEG file when we take a picture
so two times more light doesn't mean
you're going to get a twice as big
number inside your file so if only we
had some way of knowing what this
function in our camera is we would be
able to fix our images so that this
statement down here is actually true and
fortunately we don't have to figure this
out for ourselves because some smart
kids in the 90s at Berkeley already did
but the way they solved this was with a
lot of math and a lot of equations and
this is making our business people kind
of bored
but I it's okay cuz I told them at the
beginning that I'm gonna explain this
using emoji and pictures and now there
now there's a lot of synergy right now
so let's let's get started back to these
three pictures but I'm not gonna look at
the whole thing I'm only gonna care
about these pixels in the roof so I'm
looking at the same location in three
different images and I'll tell you that
this first pixel has a brightness value
of 31 and because we took these pictures
you know we know that to get from the
first picture to the second picture we
let in twice the amount of light as
before but we're also not tricked by
this because we know we're not going to
get sixty two we're gonna get something
slightly different and the same thing
happens when we go from the second
picture to the third picture we get
twice the amount of light but we're not
gonna get a number that's twice it is as
big so now I'll take these data points
and I'll rearrange them on a graph and
this is the same thing we saw earlier so
this tells me that when I have when I
open my file and I see 31 here and then
when I open a different file and I see
78 there I know that the difference
between these two pixels is twice the
amount of light that was coming in to
the camera at that time and so this is
just the information we get from looking
at a single location in the image what
if we could look at every pixel in the
image and collect a bunch of data that's
just like this and as it turns out when
we do that we fill in all these gaps in
the middle and we would recover the G
function the function that we were
looking for earlier okay so now let's
write all this down using math so of
course we know there's some function
that we don't know and it takes in the
amount of light and gives us a number
that we can store in our digital files
and we also know that the amount of
light is just the brightness multiplied
by how long we let the shutter stay open
so now I'll just give these some letters
and you know this function f doesn't
actually do what we want right
it takes in light and gives us a digital
number
but in this case we already have our
digital files with our digital numbers
so we actually want to go the other way
so I'll invert this function f then I'll
just rename it so I'll make another
function G that is just f inverse and
this function G is the one that we want
to recover now this actually this
equation down here I've written it as
one equation but it's actually a
template that can be used to create many
equations right so for each pixel value
in our images for each Z value we're
just going to write this equation out
another time and we're going to end up
with one equation for every pixel in
every image and so this system of
equations when you solve it it gives you
the G function that we've been looking
for so okay now let's solve it and the
way you do this is you use linear
algebra so you put everything into a
very big matrix and then when you solve
this equation you get your answers out
now I didn't really understand how to
set up this problem so I googled around
and basically this is what I found this
is how you slice and dice your pictures
to form those matrices and so I was like
all right sounds good
so that's how we set it up and now we
have to solve it and to do that we need
to invert this matrix a here that's the
key part of solving this system of
equations and there's two types of
inverse there's like a real inverse and
then there's like a fake inverse and
this plus sign means the fake inverse
but as it turns out Excel only has real
inverses and so I googled around some
more and I found this website that told
me how to rewrite this fake inverse in
terms of only things that we have
available in Excel and you know that
this equation is legit because it comes
from a website called math ass
so that's what we're gonna go with now
its Microsoft Excel time so I put all my
data into this spreadsheet I made the
images black and white but you can't
really tell what's going on here it's
just a bunch of numbers but don't worry
because the business people have us
covered they have this thing called
conditional formatting where you give it
one color for the bottom range another
color for the top range and it fills in
everything in between so now all we have
to do is make our cells square and then
once we set the zoom level here
so that's the first step to turning
Excel into an image editor so I did this
eight seven more times for all of my
images and after that Excel started
using 13 gigs of RAM so like any
obedient Microsoft customer I rebooted
my computer in order to continue working
and so the next thing I did was I just
started entering more things like this
is all of the shutter times for all my
eight pictures and you know we don't
want to use the entire image in our
calculations because pretty big so I'm
just gonna pick a few coordinates to
take out and use those values in my
calculations and it's starting to get
very complicated and you can't really
tell what's going on so we need to leave
comments in the program that we're
writing in Excel and the way to do that
is you use word art but if you zoom in
here there's a little bit of problem
these are all really boring styles you
know I want like the rainbow one and
like the 3d one but fortunately fifth
grade me had the foresight to save one
of each type of word art into this file
so now all I have to do is copy and
paste and so now you know exactly what
this sheet is trying to calculate and so
this is the first step on the road to
success for this project now this is
another sheet that uses the sheet I made
before so before we were picking which
coordinates were interested in in the
image and this is actually pulling out
the values at those locations and so I
have one column for each image and this
is just reformatting it for my next
sheet which has also zoomed out at 10%
and it's so small that we don't actually
look at the numbers we just look at
whether there is a number there or
whether it's zero so if there is a
number I basically make it red so you
can kind of see the shape of this a
matrix then I solve it and this is the G
function that we've been looking for
this whole time and this equation up
here this formula up here looks kind of
long and confusing but it's just the way
that you write this thing that we saw
before in Excel so it's done so I've
pulled out this G function here and as
we remember this is going to take our
digital number and give us a brightness
value but we're not quite there yet we
still need to output our final image so
that we can get into National Geographic
because this isn't going to make it and
this got so long that it had to edit
this formula and sublime but it's
actually pretty simple this basically
just calls into this G function to get
the light intensity and then the rest of
it is just doing some fancy averaging so
I pasted this into my
spreadsheet and it actually took about
30 seconds to calculate but I cut that
part out and so this is our final result
so you can see here that the windows on
the right you can actually see the
stained glass artwork where you can't on
the left so you can tell there's like a
picture of Jesus on the cross and like
some other stuff in the other windows
and so this means we're successful and
our business people are so happy now
because they can uninstall Photoshop and
only use Microsoft Excel so that's all I
have if you like this please go to my
website click on LinkedIn and don't
forget to endorse me for Microsoft
Office</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>