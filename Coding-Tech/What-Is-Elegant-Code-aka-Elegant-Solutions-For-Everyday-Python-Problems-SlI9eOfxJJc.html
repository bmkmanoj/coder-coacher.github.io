<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>What Is Elegant Code? (aka Elegant Solutions For Everyday Python Problems) | Coder Coacher - Coaching Coders</title><meta content="What Is Elegant Code? (aka Elegant Solutions For Everyday Python Problems) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Coding-Tech/">Coding Tech</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>What Is Elegant Code? (aka Elegant Solutions For Everyday Python Problems)</b></h2><h5 class="post__date">2018-04-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/SlI9eOfxJJc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">now what is elegant code what kind of
problems are we trying to solve here
when I started working as a developer I
started my career in Java as an
enterprise Java developer and I worked
with some popular libraries at the time
that provided features like dependency
injection or M capabilities but it
always kind of felt bolted on to the
language I had nightmares about things
like abstract singleton proxy factory
beams for those of you who've worked in
Java before you're nodding and when I
discovered Python it kind of really felt
like a breath of fresh air has some cool
innovative features and they don't feel
bolted on at all it feels like a natural
progression of the language now how do
we make code Oh again we've all seen the
zone of Python that beautiful is better
than ugly explicit better than implicit
simple better than complex and complex
is better than complicated those are
great ideas but how can we actually
accomplish that by picking the right
tool for the job and I'm here to share
with you some practical code that you
can use to make your code simpler more
elegant and more explicit today but you
have to remember that beauty is in the
eye of the beholder
so what's elegant for me and beautiful
for me might not be elegant and
beautiful for you the first way that we
can accomplish this is with magic
methods and there's a little bit of
terminology here that I want to talk
about before we dive in and some of you
might have heard the term dunder than
like what does that even mean
it stands for double underscore so like
when you have two underscores before a
method name now
you're used to implementing dunder
stirred under wrapper but there's really
a whole world of other powerful magic
methods that you can explore and by
implementing a few of them you can
really take your objects to the next
level and make them behave like
built-ins such as numbers or lists
dictionaries and lots more a little
example of this here we have a
straightforward currency class
and it knows about the conversion rate
between two different currencies based
on the dollar here we have a dollar and
a euro which is 85 or 88 cents of a
dollar and we also have a constructor
that accepts a symbol and an amount it
also knows how to represent the currency
using dunder upper so here we go and
print out the symbol and lastly it knows
how to convert from one currency to
another so what can we do with this that
was pretty basic stuff we can represent
the cost of two meals and different
currencies for example a soda in dollars
and a pizza in Euros and because we
implemented wrapper it looks like a nice
print out but let's implement another
magic method this one is called
dunderhead for addition and if we wanted
to we could also do things like support
subtraction multiplication and other
mathematical operations so let's see why
this is so powerful this is going to
allow us to use this currency class in a
really intuitive way its currency you
kind of expect to be able to perform
operations on it here we can add the
cost of a soda and a pizza together
independent of what currencies are
represented in so these methods are
currency aware which is really cool and
it acts on the currency of the first
object if we do this addition operation
some magic methods will act on symbols
like square brackets in this example the
D the dunder get item acts like a
getting the dictionary key to from the
dictionary D here or like in the example
we saw before the plus symbol this
example that I'm showing for a
dictionary works with a list - and
remember dunder again I don't we'll look
at it a little bit later and another
interesting thing about magic methods is
some of them mapped
built-in functions so in this simple
example here dunder land maps to the
built in function one so when I call the
built in Len on my alphabet it'll go
back call that dunder align method and
get the length of the string that I have
represented there next we have custom
iterators these can be really confusing
at first there is a lot of terminology
but if you remember these guidelines for
how to make a class arable it should be
pretty straightforward so first in order
to be iterable a class needs to
implement done diretor next dunder it er
needs to return an iterator lastly in
order to be an iterator a class needs to
do two things first it needs to
implement dunder next and lastly it must
implement must raise a stop iteration
exception when there are no more items
to return if you follow that formula
then your an iterator so here's a
scenario let's say I have a server
instance and it's running services on
different ports some of the services are
active and some are inactive and when we
want to when we loop over our server
instance we want to make sure that we
only loop over active services so here's
our iterable server we have defined a
few different services running on
different ports like HTTP and ssh and
ftp and some of these are active some
are inactive so in my little example
here ftp is an inactive service now I
want to make this server iterable and by
Dubai in order to do that I'm going to
set a start position when we first
initialize it and I'm going to implement
dunder next so as we're looping dunder
next is what's going to get called by
the next method here we have a little
bit of logic to filter out what's active
what's inactive and a little bit of
optional Python 2 compatibility at the
bottom here I'm a liasing next to dunder
next in Python 3 its dunder next and
Python 2 is just plain old next a little
bit confusing so by having this Alice at
the bottom we can be compatible now the
piece that we're missing here is we've
implemented under it err and here we're
returning self we can do that because
we've done two things we've implemented
it under next and our dunder next we'll
throw a stop stop iteration exception
when it's exhausted dunder it err is
called when we first start aerating
before ever calling next for the first
time and if we're looping over it like
in a for loop or a comprehension that in
an initialization will actually happen
under the hood for us but if we need to
we can also get that iterator by hand by
calling the inner built-in method now we
can do something like this we can just
loop over our iterable server get the
protocol important one step and we don't
have to worry about accidentally looping
over an inactivated service that's
pretty cool but here's the tip if you
don't really need to maintain a lot of
state you don't necessarily have to use
an iterator you can use the generator
instead here we don't need that gem for
Python two three compatibility ever we
only implement under it err and we're
looping over our services and if that
service is active we're going to do
something now a generator doesn't care
or know about its origins it really only
knows what the future holds and we can
do that with the yield keyword now what
is yields yield in this case is like a
return sort of and we're going to cover
it in more detail later but what you
need to know for now excuse me is that
after yields we still maintain state so
the next time we come back after a
yields we're just going to continue
looping from where we left off and this
means we don't need to mean state
maintain state
that current position it's kind of done
for us now why does this work
here we use the single parentheses to
generate a generator comprehension
technically this is called a generator
expression but I like to generate our
comprehension a little bit better so in
this example here we're returning a
generator expression now remember that
an iterator needs to implement dunder
next in this case the generator has next
implemented so in my previous example
here I had made a generator for range 1
meaning it only has one item 0 and we
see that here at the top when we call
next if we try to call next on that
generator again we're gonna get a stop
iteration so that generator fulfills
everything that we need for an iterator
and that's pretty cool it's a lot less
code and we don't really need to waste
any resources on maintaining statement
next we have a little bit of method
magic that we can use like I've shown
you before we can alias methods and we
can do that because those methods are
just objects they're just labels another
cool piece of method magic that you can
use is called get adder for this example
I have defined dog class and that dog
class implements a method called speak
then if I wanted to use get adder this
is a built-in it takes three arguments
the first is an object the second is the
name of the method that you'd like to
get and the third is a default value
just like in a dictionary that you
provide in case that method isn't there
now I can use get adder on my dog
instance that I created previously and I
can ask for the methods speak and what
it returns here is a bounds method
once I have that bound method I can go
ahead and call it so I've gotten the
speak method here by using get adder on
my dog and asking for the speak method
and then I can just use the parenthesis
syntax to call it and it'll say bark
bark we can use this for something like
a command line tool with dynamic
commands here I've defined a class of
operations there are three of them I
have say hi say bye and then a default
operation that's going to get called if
someone tries to call our call our
little command line tool with an
argument that's not supported now in my
main method I'm going to get the command
and the argument from user input and
then I'm going to call get adder on my
operations instance with the command
that was specified but also provide a
default value in case the operation
isn't supported lastly I'm going to call
that method with the argument that was
provided so if I run my little class if
I call the say hi method and pass them
the value of Nina then it'll go back and
say hello Nina if I try to put in some
junk values it'll call the default and
say that that operation is not supported
this is kind of how the CMD module and
Python works and let's assume there's
some more error checking here but I
think it's a pretty good small example
to show you the power of get adder
lastly we have partials func tool dot
partial it's going to return a new
partial object which behaves like a
function it's called with arguments and
kwargs if any more arguments get passed
in they're going to be appended to arcs
and if any more keyword arguments are
passed in they're going to extend and
override the keyword arguments a little
bit confusing let me show you by example
here I'm importing partial from funk
tools and I'm creating a new partial
function called bass 2 I do that by
calling partial I pass an int which is
the function that I want to call and
here I'm specifying bass equals 2 so I'm
specifying some keyword arguments if I
look at base 2 the type of it is a funk
tools dot partial I can now call that
partial object in this example with a
binary number that represents 18 and
that's the same exact thing as calling
int passing in that number that binary
number that I specified and specifying a
keyword argument of 2 so that partial is
kind of like an incomplete function we
haven't called it yet but we could if we
wanted to a library I really like to use
personally is called a github and it's a
really badly named to rest api client
matt has some i really it has
transparent syntax that allows for rapid
prototyping of any rust api it's
implemented in four hundred lines of
code you can add support for any rest
api in 30 lines of code and it github
knows everything it needs to know about
your protocol like rusty HTTP tcp but it
really assumes nothing about the
upstream APM and just a little plug this
project is currently looking for a new
maintainer so first someone who would
like to be involved in an open source
project this would be a really great way
to get started so how does this work
first you define an endpoint URL and any
other connection properties here in my
initializer i am setting the github URL
and then we can start using the api in
my example I'm providing a token enough
education token and then when I call a
GH which is my API user dot repos get
what I'm actually doing is writing a get
request to the user slash repos endpoint
notice here that it's up to you to spell
things correctly there's no validation
on the URL at all if the CRL doesn't
exist or anything else goes wrong that
the error that's thrown by the api is
just gonna be returned that's kind of
black magic right it's pretty cool so
how does this work well firstly each
call on that API class is gonna ferry
that the call to the an incomplete
request if the last call is not an HTTP
method what it returns is an incomplete
request with an appended path so as long
as we are not providing an HTTP method
that path will just get longer and
longer and longer we build on it but if
that last argument is an HTTP method
it's going to go and fetch the
corresponding method on the client and
return a partial method and then I've an
interesting thing to notice here is that
we have alias to get item to get adder
and if you remember that allowed us to
fetch an item from a dictionary by key I
will go into that a little bit later but
I think this is pretty cool this library
is really elegantly written I use it all
the time when I'm prototyping different
working with different REST API is now
given a non-existent path it just throws
the 404 and because getitem is alias to
get a tour we can also provide custom
values in this case my github username
and a repository that I want to fetch
and then I can call that by using the
keyword arguments so it's really cool
the source code is pretty small if you
want to see how it works I recommend
checking it out next context managers
when should you use one if you need to
perform an action before after an
operation some common scenarios are
things like closing a resource like a
file or a network connection when you're
done with it or performing some cleanup
before and after a function call an
example problem here is feature flags
what's a feature flag sometimes it's
also called a feature toggle it's the
ability to turn a feature of your
application on and off really easily for
example EB testing if you have a
shopping web page and you want to show
50% of your users one version of the
shopping cart 50% of your users another
version and then test and see which
version results in more conversion you
can use a feature flag for that you can
use it for rolling releases like when
you want to slowly roll out a feature
for example only turning on your feature
for 5% of users and seeing how it
affects performance or maybe showing a
beta version of your application to
users who've opted into your beta
testing program here is a little example
class I only have one feature flag it's
called show beta do I want to show the
beta version of my homepage to users or
not this slug is currently turned on so
it's true and I have two methods is on
is this feature flag on or not and a
toggle method that will let me toggle
the feature flag between on and off now
I want you to do something like this I
want to be able to temporarily turn on
that feature flag when I'm testing how
can we accomplish that we can use the
magic methods enter and exit here step
by step in the initializer I'm sorry in
the constructor I'm I am holding onto
the old value of that feature flag so I
want to know if it was on before or not
and before before calling my method I'm
going to toggle that feature flag to
whatever setting was passed in and after
I exit that method I'm going to switch
it back to whatever
the value was before the better way of
doing this is with a context manager
decorator that's going to allow you to
define a factory function for with
statements without the need to create a
whole class or setting up separate enter
or exit methods so in this example I am
importing it from contacts Lib and I'm
using it as a decorator and we see that
yield keyword again so I saved the old
value I toggle the future flag and then
I yield
and after they yield I'm going to toggle
again I'm going to talk about feature
flag back to the old value that it was
before we ever entered this context
manager so let's get back to yield for a
second what exactly is happening here
yield is giving up control for the time
being you do what you need to do before
the method is run then you're going to
yield the control to the method you just
called to the to the method that's
wrapped with the context manager now
once that method completes its run the
yield is over and we re-enter our
context managers so we can just run the
code that we wanted to run on exit with
either implementation we can do this we
can get the home page URL if the feature
flag is on will return beta if the
feature flag is off will return the home
page and for our tests we can also use
the with syntax here so with our feature
flag on we want to test that our get
home page URL method returns beta when
it's off we want to make sure that it
returns the regular home page now
decorators the simple explanation for
them is that it's syntactic sugar that
allows for modification of an underlying
function and a quick recap of them for
those that aren't familiar they wrap a
function in another function and then
they can do something either before the
call after the call
both with provided arguments and they
can even modify the return value or the
arguments and even if you aren't
familiar with decorators and regularly
use them I find that it's a topic that
can be hard to understand something that
people are frequently confused about so
let's dive into a quick recap of how
they work here's some example code that
we might write if we didn't have access
to decorators so we have one method
hello at the top that just prints hello
and the Paston name and we have a second
method called say after and what we want
this method to do is given any type of
greeting function either the Hello that
we have on top or maybe a greeting in a
different language we want to print out
that it was nice to meet you
so we have a say after a function and it
takes an argument of a hello function
inside that function would take the
argument of the original name that was
passed in so we call the original hello
function and then we print it was nice
to meet you and what this say after
function returns is another function an
uncalled function in this case so if I
were to call hello Nina it would print
out hello Nina
if I were to call out say after and
provide the argument of the function
hello and then call that with the
argument Nina it would print out hello
Nina it was nice to meet you so this is
the kind of this is what it would look
like if we didn't have a decorator but
if we do have a decorator we can just
use this syntax it's the same two
functions from before I wrap I add the
at say after decorator to my hello
function and now when I call hello Nina
it'll print out hello and then go into
the decorator and print out it was nice
to meet you so in this case the
decorator just wraps a function
and before I talk about decorators with
arguments which is kind of an extra
layer of confusion I want to give an
example of a closure in this case you
can think of this closure as a factory
for multiple team multiple
multiplication methods excuse me so I
have a parent function x and then i have
this inter nested function that actually
does the multiplication given a number
it'll return the multiplication between
that number and whatever argument was
passed into x and the value that it
returns is a function so I can make a
function called x 5 by passing the
number five and two multiplied by what x
five is is a function and then I can
pass number arguments to x five like
four and end up with the result 20 but
I'm not limited here I can make this
factory function for whatever numbers
I'd like so decorators that take
arguments are kind of the same as the
closures from the previous example the
outermost function becomes a factory
it's the same as calling this on an
undecorated function so here I have a
decorator that takes an argument I want
to say it was good to meet you or it was
bad to meet you or whatever and I'm
wrapping my hello function into the
three layers of arguments there the
problem with decorators is that you lose
some context here I have a method that
I'm sorry a decorator that's called say
bye if I use that decorator on a
function called
my name if I try to get the name of that
function after wrapping it with a
decorator it just its wrapper if I try
to get the doc string of my name even
though I have a comment here that says
say my name
it's gonna be empty the way that you can
get around that is by using wraps or the
wrapped library in this example I'm
importing wraps from contact slip and
I'm wrapping the inner function that is
we're gonna pass in which function we
want to wrap - that wraps decorator and
after I do that I retain more context I
can ask for the name of the function
that I decorated and get the right value
back and I can also ask for the doc
string and it will return the right
thing some common uses for decorators
logging timing validation rate limiting
mocking patching so context decorators
are really cool they're context managers
and decorators combined as of Python 3
to context decorators are in the
standard library and they're really the
best of both worlds by using a context
decorator you can easily write classes
that can be used both as decorators with
the @ symbol and context managers with
the width statement and context
decorators is used by the context
manager so you're going to get that
functionality automatically and let me
show you a code example remember that
context manager decorator from earlier
we imported it from context Lib for our
feature of flags we can also use it as a
we can use it as a context manager but
we can also use it as a decorator just
for free we don't have to do anything
else in the lower example we'll see I'm
adding a decorator a feature flag the
flag itself is show beta on is false so
when I'm getting my profile page well
return beta HTML if the flag is on
otherwise we're just going to return all
our plain old profile HTML a library
that I really like that
what's her Python test travel through
time is called freeze gun
we can use it as a context manager or as
a decorator what it does is freezes time
in this example to 2012
I really recommend reading the source
some time it's pretty mind building and
there's the section I'm going to skip if
you guys want to see it you can look at
my slides online but in the meantime I
want to tell you that perfection is
achieved not when there is nothing more
to add but when there's nothing left to
take away lessons more elegant code is
what and I've taught you some new tools
today taught you about magic methods
that can make your objects behave like
built-ins I have taught you about some
method magic like aliasing get adder
partials context managers decorators
context decorators and iterators and
generators to loop over your objects and
explain what yield means so don't be a
mindless code monkey it's really easy to
copy and paste code from Stack Overflow
or try to stubbornly stick with the old
paradigms of your old programming
language it's fine when you're working
on personal projects or scripts but it's
really not a great idea when you're
working on code that's gonna be
maintained by a team so resist the urge
a deep dive into Python is going to open
your mind to some new insights and you
can use these tools today to get started
but remember that with great power comes
great responsibility for using the same
decorator and every function in your
class maybe you're not doing it right
sometimes simplicity is better but it's
really up to you to choose the best tool
for the job and thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>