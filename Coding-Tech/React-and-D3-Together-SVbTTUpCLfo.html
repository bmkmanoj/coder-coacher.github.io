<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>React and D3, Together | Coder Coacher - Coaching Coders</title><meta content="React and D3, Together - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Coding-Tech/">Coding Tech</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>React and D3, Together</b></h2><h5 class="post__date">2018-02-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/SVbTTUpCLfo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">good morning how are you know yeah
second day so I want to thank you so
much for having me here and in a
reactive coffee and so my name hi my
name is Shirley I'm a freelance software
engineer and I'm based in the San
Francisco Bay Area and I built data
visualizations for the web and built
data visualizations for product I built
them for a story I built them mostly I
built them all with d3 and I also used
mostly react with my d3 so when I
mentioned to anybody that I used
reactant e3 together the question that I
always always get is how should I use d3
and react together who should get
control of the DOM and I want to
rephrase that question to be who needs
control of the Dom after all if we want
we have to keep track of our updates we
need the virtual DOM and that needs
access to the DOM and since d3 is for
doing data visualization in the web that
of course of course also needs to render
to the Dom right actually actually d3
only needs access to the Dom in three
different places the first were
transitions or animations between one
state to the next so what happens here
is that we tell t3 exactly the
attributes that we want to animate in
transition and d3 goes in and figures
out all of the in-between points all of
interpolations for us and updates them
directly to the Dom so that we don't
have to the second is with axes so every
single time it's very very boring and
repetitive for us if every single time
that we need an oxys we have to go in
and
our own tics and labels in SVG and
canvas so we tell d3 the kind of axis we
want and d3 goes and does it directly in
the Dom for us and finally we have
brushes so much like axes with brushes
it's quite a really repetitive task for
us if we have to every single time we
want it to create the brushable area the
little rectangle to bind the event
listeners for the draggable areas so we
tell d3 the parts that we want to be
able to brush and d3 goes and does it
for us and with all of the things that
we so commonly associate with d3 things
like the layouts the force layout the
tree maps chord maps and yeah and geo
with projections and maps shapes like
line charts area charts pie charts all
of these things that we so commonly
associate with d3 actually doesn't need
access to the Dom at all instead what
happens is that we tell d3 our raw data
we give d3 our raw data and d3 gives us
back that same raw data but now with the
information to be able to render to the
screen space and that to me is really
the power of d3 which is that it helps
translate transform for us our raw data
so let's say average temperature of a
city across time and it takes that raw
data and translates it into screen space
and that could be XY positions that
could be a radii that could be colors
and the way that I like to think about
d3 is that it helps us abstract away all
of the most common repetitive tasks a
building data visualization in the web
so that we don't have to
which means which means that for most of
our use cases we can just have d3 do the
data calculation and reacts do the
rendering and it's only when we need
these specific things from d3 the
transitions the acts ease the brushes
it's only when we need these that we
have d3 doing both the data calculation
and the rendering and having it react to
kind of just hang out in the background
for structural support but before I
start talking and getting into the how
of using react in d3 together I want to
take a step back and talk about the why
why are we trying to use reactant e3
together after all if all we want is a
data visualization then d3 is more than
enough to do the job
take for example oh don't take for
example because it's not loading there
we go
take for example this visualization I
did last year at the top summer
blockbusters in the last two and a half
decades reimagine those flowers each of
the petals are parental guidence ratings
each of the colors are their genres and
the number and size of petals are the
movies I'm DB ratings out of 10 so
there's some really really beautiful
ones in here like The Dark Knight Rises
I always always loved Harry Potter
his inception right here but my absolute
favorite that I always loved telling
everybody is the 1997 Batman and Robin
because of how tiny and cute it is but
the only interaction only user
interaction I have in this visualization
is a click interaction for the user to
open up the corresponding IMDB page
I also have this visualization of the
four years of vacations and 20000 colors
for this visualization I took all of my
vacation photos about 4000 of them I
extracted the five primary colors out of
each of those photos and I grouped them
by the trip that it was taken on and
arranged them by the date of the trip
that I was taken on so this is one of my
favorite visualization pieces I've done
it's not a very complicated one but the
reason why I love it so much is because
I learned so much about myself from this
which is that so when I travel I like
taking pictures of nature so I love
taking pictures of the mountains of
trees at the sky I love water rivers
oceans so all of these blues and greens
made a lot of sense to me but I was
really really confused as to why I has
so many oranges and so many Reds because
there's no way that I was waking up for
all of those sunrises or watching that
many sunsets so I took a look at what
those pictures were and there turns out
they were actually food pictures which
means that this is what I mean by I say
that I learned so much about myself
which is that for example this
particular trip to Asia in 2014
that's my Japan trip apparently all I
did in Japan was eat and nothing else
and this trip is to Iceland so you can
see that I took a lot a lot of like
waterfalls and pictures and again in New
York apparently all I do is eat so I
learned a lot from himself about myself
but as you can see the only interactions
here are hover interactions to see more
details about the specific date of their
trip and so the way that I like to think
about it is
three is more than enough to do the job
if all I have or want is a visualization
with hover click and other simple
interactions but if instead if instead I
want a visualization with a whole UI
built around it then I need react then
react comes in very handy this is an
example a very very simple example I
made of an expense app to show how
reactant III can work together each of
these circles are categories I have made
each of these dots are little dots are
expenses there are actually my expenses
from June it's a little bit embarrassing
I'm because of like how much yeah
anyways so each of these dots these
expenses are then grouped into the date
that the expense was made and the date
is colored the background is colored by
how much I spent on that date so the
writer that is be more thy spent which
is not good and the greenery is the less
I spent which is good I can then toggle
through all of the weeks I can drag one
expense from one from one date to
another to edit the date and you can see
that the background color is adjusted
automatically I can of course drag it
back I can drag one expense over a
category to link them or even multiple I
can drag them back to unlink them and I
can also this is my favorite interaction
that I've built I like had a really fun
time with it but I can also add a
category let's say coffee I enter and it
goes in there so I'm very very proud of
this interaction it's like such a simple
one but uh yeah so I can add a category
and I can also delete any of my
categories
with this example I'm using react to
help me update automatically with the
visualization with each user
manipulation of the underlying data I
also got to work with a company called
brain sites last year last of last
October where they went and tracked
viewer brain data as they watched the
final US presidential debate and I got
to work with them in visualizing it so
this up here is the overview of the
ninety minutes of the debate where each
of the line charts is the overall user
and/or the viewer engagement during the
debate itself with the background
colored with the speaker and I can drag
this brush along any part to dig into
that particular moment I can select a
particular viewer demographic to dig
into and I can hover along the bottom
part to look into the details of that
particular moment and for this
visualization there we go
and for this particular visualization I
use react to link multiple parts of the
visualization together so that when the
user interacts with one part of the
visualization the rest of the
visualizations update to match and
finally this is an interactive
visualization of every line in the
musical Hamilton for this particular one
each of the dots represent a series of a
set of lyrics from the musical itself
and as I scroll down the screen
the dots follow me and as I scroll
through the analysis my findings the
correct parts of the correct songs are
highlighted until I get to my very end
where I give the reader my exploratory
tool dye used to do my own analysis
where they can filter by any set of
characters in the musical any of the
conversations that they had and any
recurring themes and dig into the
remaining lines and remaining songs so
that the reader can do their own
analysis and for this one I use reacts
to manage the initial scroll as well as
a final exploratory tool so I use react
with d3 when I need to componentize my
visualizations and be able to manage the
state as my user interacts with my
visualizations now that we've talked
about the why of using react in d3
together I want to get back to talking
about the how how to use reacting d3 the
way I like to think about my
visualization my react visualization
components is as self-contained
components where if I pass it in raw
data the visualization component is in
charge of translating that raw data into
screen space rendering that data and
managing the interactions with that data
so let's look at this really really
simple example of a node and link graph
the only interactions I have are this
update button to change to update the
graph and the ability to select one of
the nodes and highlight or update the
paths cities of its neighboring nodes
and links and let's take a look at this
with effort with the react doing the
rendering and d3 doing all of the data
calculations so here's the full code I
only have an app component and a graph
component and don't worry about reading
through all of the code because this is
all available online and I'll tweet it
out later so the app component is in
charge of getting the graph comforting
in the graph component and rendering the
update button and it's also in charge of
getting the new data when the user
interacts and hits that Update button
and the graph component is in charge of
taking that raw data that's been passed
in from the parent as props and I use d3
force layout to calculate its X&amp;amp;Y
positions and here the best practice
I've established for myself over the
years is that I make a very clear
distinction I make a very clear mental
distinction of where I put my data
calculations so any calculation that's
related to rendering the visualization
itself goes into this visualization
component and anything else any user
manipulation of the data any edit any
updates from the server's is taken care
of elsewhere in this case in the app
component I take the data that's been
calculated with the new x and
y-coordinates and i pass it and i use it
in my render function and loop through
it to create my SVG circles and lines I
of course do I of course call the data
calculation function before that my
render function in the react lifecycle
so in this case and my component
mount and component will receive props
and the reason why I like putting him in
my component will receive props is that
it has the benefit of only being
triggered when the parent passes in new
props in other words when the user has
updated the data the data has been a
mutated in some way and it does not get
called when state is set on the
component which means that it helps me
avoid unnecessary recalculations of the
data and it has the added benefit of if
I want to after i calculate all of my
data if I want to then set that date on
to my component state I can do that
without triggering an additional
extraneous react lifecycle and finally
the user interaction of clicking on the
node selecting a node to highlight its
neighboring nodes and links the only
thing I have to do here is set that
selected node as state in the event
callback and I use that information in
my render function to calculate the
nodes and links that should be
highlighted so that I can take that data
and then use it in my the looping advice
to create my SVG circles and lines I can
use that data to set the pasties and
return it in that same render function
so when react renders if the user
interaction does mutate the data
propagate that update from the parent
and recalculate the data and component
will receive props if the user
interaction does not mutate the data
like in the case of selecting and
highlighting the neighboring nodes and
links set state in the component and
calculate and render now let's take a
look at that same exact example but now
with d3 dream both the rendering and the
calculations
the app component remains exactly the
same as before but the graph component
has changed significantly
the most significant change being that
in the render function I no longer
return as VG circles and lines and I
returned and said an empty SVG container
so that I can take that empty SVG
container and wrap it around into a d3
selection to use later in my render code
also in my component amount and
component to update I call all of my
calculate and render functions and my
calculate function might calculate data
that hasn't changed at all from my
previous version I still use d3 force
layout to get my x and y positions but
what has changed is that I've taken that
calculate highlight calculating the
neighboring nodes and links I've taken
that code out of the render function and
I put it into I have it be called in the
component amount and component did
update so that in the next render step
when d3 is doing the rendering I can use
that same information when I'm entering
and exiting and updating the opacities
and here for best practice the way I
like to think about my d3 rendered code
is that it should issue create issue
render exactly the visualization what
the visual it should be a layout for a
blueprint for what the visualization
should look like given any props and any
components day much like how you would
think of and format your what your
reactive render function returns and
this is so that if in the future I want
to do any additional features or
interactions all I have to do is write
the code to change the data and the
visualization will render correctly with
very little additional coach
and finally that user and user at
interaction of selecting a node it looks
exactly the same as before all I'm doing
is a sighting that select a nude on my
component state and I'm letting that
same reax lifecycle what i've already
set up in the component did update to
take care of rendering all of the
correct visualizations for me and a
final new on performance if the user
interaction does not require a full
recalculation of the data of full rear
end during of the visualization i do i
update the subset and should component
update and return false to terminate the
rest of the render cycle the react
lifecycle so when when d3 doesn't
rendering define exactly what the
visualization should look like in
component amount and component to update
and never ever ever let d3 in react
controls same parts of the Dom or else
really really bad bugs so at this point
you might be like WTF surely this is
exactly what I already go through in my
day-to-day when I create my non
visualization react components what
gives
and you exactly right but that's also
absolutely my point which is that as
front-end developers the design of data
visualization might be foreign to us but
the implementation of it the coding of
it in the browser shouldn't be it's just
like any other UI project and the
thought processes that we go through are
exactly the same when we architect and
implement a data visualization projects
so when we talk about the how of
reactant III together there's already a
lot of really great literature out there
but we still haven't seemed to have
agreed on the one best approach and to
me I think that's absolutely okay
because to me the most important thing
is that
you and your team agree on the best
approach for your projects and that
brings me to my final point which is
that there's been a lot of really great
advancements and improvements that's
been made in the design of data
visualization but since the browser has
been or since data visualization has
been in the browser for the last few
years
I'm really excited as we go forward to
see what can we take and apply to d3 and
data visualization that we already do
with react and the UI so as we go
forward I'm excited and hopeful that
we'll stop concentrating and talking so
much about the how of reacting d3
together and start talking about the
what what can we make what can we create
with d3 and react that will push forward
the practice and fields of data
visualization and user interface thank
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>