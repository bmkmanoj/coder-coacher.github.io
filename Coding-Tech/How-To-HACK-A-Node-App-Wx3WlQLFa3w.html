<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>How To HACK A Node App | Coder Coacher - Coaching Coders</title><meta content="How To HACK A Node App - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Coding-Tech/">Coding Tech</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>How To HACK A Node App</b></h2><h5 class="post__date">2017-10-31</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Wx3WlQLFa3w" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">before I begin I just like to ask a
really quick question could you put your
hands up if you've ever been so scared
in your life so frightened that a little
bit of pee has come out keep your hands
up okay that's about 50% of the audience
and there hopefully by the end of this
talk I will have increased that number a
little bit because today we're talking
about web security and hacking my name's
asked me same on Twitter you can find me
at Joe 8 I blog about JavaScript and
angular on my site code Croft TV and I'm
something called a cloud developer
advocate Microsoft so I work on the is
your team or with the usual team and
yeah I talk about cloud insecurity
internet and JavaScript and apples bunch
of those things but to begin with today
I want to talk to you one tell your
story the story of my first startup it's
called it in sushi it was an event site
that aggregated events from a bunch of
different places from meetups Facebook
last.fm a few of the places at the time
I used to work in investment banking my
career was going very well it was good
money but this just this was just a side
project but you know it was going
slightly okay very very slightly so I
did where everybody does in this
situation on I I quit a really good job
well-paying to work on something quite
risky and then I told you I was in
investment banking so of course I was
very very arrogant had it at the start
had investors who are interested
investing in me but I was like no no no
this is gonna be a billion dollar
startup I don't want your money I want a
hundred percent so I said no so you can
probably guess where I'm going with this
six months later the product hadn't you
know didn't wasn't a billion dollar
startup I was running out money this is
my money no investors money my money I
didn't have enough money to pay rent in
two months so I then start going back
after the same investors saying hey look
I'm interested now but they could tell
they could tell that I was now desperate
they were backing away they didn't want
to invest upon one guy we've been
talking for six months he lied me liked
the product and he said asked him okay
look give me another demo in seven days
show me what you've built recently and
then we'll talk him was a good chance
who's gonna invest yes but then 48 hours
before the meeting with the investor I
got emailed by Linode Cellino were the
people I was using to host my website
and they said look awesome it looks like
your servers being compromised we can
see it's making hundreds of requests to
other servers and if you don't solve the
problem in four in 24 hours we're going
to shut you down
so in 48 hours I was gonna have a
life-saving meeting with an investor and
in 24 hours I was gonna get shut down by
Linode so I panicked now jumped onto the
server I started looking around and to
cut a long story short I definitely got
hacked definitely got hacked
I found stuffed in a temp folder there
were scripts that were running that was
doing brute force attacks on a bunch of
IP addresses I'm not hooking like what
what is going on how did I get hacked
and then after a bit more investigation
I saw the PHP was running but why is PHP
running I'm not a PHP developer
right then I remembered when I first set
up the server I'd installed WordPress
okay I got rid of it straightaway but I
forgot to remove it from the start
script so when the server rebooted PHP
started and that's how the hackers got
in so you know I cleaned everything out
removed her from the start script
contacted they know they were happy had
the meeting with the investor he
invested the startup still failed but
had some money so I'm no fool I'm an
idiot
and I took security very very seriously
when I set up a server I'd followed all
of the instructions
I just forgot on one tiny tiny tiny
small thing so I think the lesson is
that if it can happen to me it can
happen to you so you might guess I love
stories so today I'm going to talk to
you about hacking but through a series
of four different hacking stories some
of these stories are going to be
specific to nodes some of some of them
in more general web development each
stories gonna have a moral at the end a
lesson to learn and perhaps some steps
you can use to protect yourself and I
think to begin with let's just start off
by breaking down exactly how I think I
got hacked on event sushi but first let
me just explain a few terms so a
vulnerability is a hole in your security
or weakness so for instance not setting
up a firewall is a hole in your
Security's of vulnerability an exploit
is a tool or a piece of code or even
just a sequence of your of commands
that you execute which takes advantage
of a vulnerability to do bad things
okay so who here has heard the term zero
day exploit yeah so zero day exploit is
one that nobody knows about yet
okay so secret but once a zero day
exploit is found out about who's known
about perhaps a white hat hacker is
discovered it and informed the company
it's not called a zero day exploit
anymore it might be called a a one
there're 330 or a six-month exploited
yeah what do you call it that but just
to think about just the way to think
about it basically once a zero day
exploit becomes known the clock starts
ticking let me ask you a question how
hard do you think you would be to get a
hold of a zero day exploit pretty hard
right now you need to be the right kind
of person you need to know the right
kinds of people as a study done car
number when maybe last year they
estimated that zero day exploit it
solves about quarter million dollars
each the usually sort of criminal
organizations or state-run acting
organizations but how hard do you think
it would be to get hold of a six month
old exploit not very hard
in fact it's it's just it's actually
really really easy you can just find on
the internet this is one website exploit
DB this lets buncha size this is just
one of them and please type in PHP it's
got a capture hit search and take a look
at this these are all the exploits is
fine look at the date
we're still in 2017 PHP isn't very
secure okay I can tell but some PHP
developers in the audience so we all who
knows this yeah mr. robot so we all like
to believe all of the Oliver hackers are
like this blackhat mysterious geniuses
and I think we like to believe that
because it makes us feel better when we
do get hat I mean if we got hacked and
you can just say how am I supposed to
protect myself or mr. robot come on but
mr. robot didn't hack mean they didn't
use a zero they exploit to get into my
server I was running a really old
version of PHP my attacker googled how
to hack me and followed instructions
it's not hard in fact it's even easier
than that I mean we're all developers in
this room how many of us has been a day
writing a script to automate something
that takes us two minutes we all do all
the time so why won't hackers do the
same and they do all the time this is a
an automated tool called Metasploit
which you can basically pointer a
website and it will scan it for known
runner built boner abilities and it also
has a bunch of plugins in here and you
can store other plugins that you want
that will also perform automated attacks
as well there's another study that
estimated about 27% of all websites in
the world can be hacked automatically
so what can we do what can we do to
protect ourselves from this let's not
not much you can do about zero day
exploits okay you still you can't
protect yourself from something you
don't know about but you can defend
yourself from the unknown all you've got
to do is make sure you keep all of your
stuff where updated all the time you
know make sure you keep the webserver
updated oh the operating system itself
make sure you keep the outdated oh I'm
using nginx got make sure I'm keeping
that dated and on my database I'll make
sure I'm gonna keep my database updated
all the time and oh my god I'm using MPM
sneeze Mitchell mmmm modules are based
all time also need to listen to security
bulletins as well and make sure I patch
my software as soon as soon as anything
gets updated especially not that easy
and your job isn't to do all of that
stuff your job is to write
functionalities to write software for
your end users and that's why after I
got hacked this one time I started to
exclusively use houses just explain what
up house is back in the old old days or
even now if you sold it now and if you
want to deploy something yet have some
sub on-premise Hardware you'd buy a
server you maybe you hope you put it in
your own room or you go to server farm
and they will just put it in there for
you but you're in charge of the hardware
if the hard drive fails it's up to you
to fix it but then you're also
responsible for the operating system
keeping now baited and the web server
run a database and everything else and
your application as well you've got
obviously keep validated and then we
have infrastructure as a service so that
stuff like Linode Amazon Web Services is
your Google we've all got stuff like
this and that's basically when you get a
VM so somebody else is responsible for
looking after your hardware if the hard
drive fails
they fix it but you still have to handle
the operating system the web server the
database everything else and of course
your application as well and then we
have pauses platform as a service so
they handle the hardware they also
handle the operating system depending on
the powers of another web server and the
database and everything else as well and
you just focus on deploying your
application and the thing with passes is
they've got teams of people teams of
security experts and all their job is
every single day is making sure there's
no security holes patching every
vulnerability as soon as it gets
released okay I know there's a bunch of
them out there I work in Microsoft so
we've got one called as your app
services Google's about Google App
Engine Amazon Beanstalk and that's
another one I've used for the rogue
there's a bunch of others as well so and
and if you still kind of a little bit
and there's a lot of people who kind of
used to using vm's and installing all
around software and managing all this
stuff themselves that a little bit
suspicious of what I'm saying who's
heard of the Equifax hack happened
earlier on this year okay it's the
largest ever hack in history but 200
million people's records were taken
Equifax the billion dollar company about
ten thousand employees did the hack is
gained through a zero-day exploit no
they got in through a known exploit of
Apache struts which is a Java web
framework patch to the fix was available
for two months before the hackers got in
all the Equifax had to do to defend from
this attack was applying update
that just never updated the software
largest hack in history only firm the
coop one of the coolest things about is
your that I like is something called the
is your security center so as far as I
can tell and cut me from wrong no one
else has got this yet so one of the
problems with detecting attacks is as
low as a different signals all over the
place and if you just alerted on every
single signal then that just be too much
noise you need to start ignoring the
ellipse so to solve this we trained an
AI so we took a whole load of attack
data we said this for a whole load of
data we said these signals are from
definite attacks we trained up an AI so
now we feed in all of your signals to
this AI and we alert you only when well
the AIS now it's not perfect but it's
easy just switch a button in switch on
and I'm lazy so why does that switch on
anybody know this show nobody don't
worry about it I think I'm one of the
three fans of this show in the world
it's called this so it's always sunny in
philadelphia very funny i recommend i
think that on the 11th season now and
this is one of the characters called
charlie kelly and he plays the dumbest
guy in the show he like cleans the
toilets and kills rats that makes sense
you watch it one of the things is he
thinks he thinks he's a lawyer
so never he gets into trouble he always
represents himself in court very badly
representing himself in court so my
closing arguments of this I'm thinking
you can create a secure platform
it's a holster application when you're
not a security expert is like thinking
you can represent yourself in court when
you're not a lawyer so did I scare
anybody just yet
no you're all pretty pretty calm I can
tell there's no I can't see the fear in
the you I can't smell it maybe the next
one so I'm in the UK and based in the UK
in the UK when you register a company
you have to register with the government
was something called Companies House so
if you actually went to Companies House
website and search for my company Dell
Reaver Limited you would find mean it
and this is an actual company in the UK
space this is the address and what this
is this is an example of an attack
something called an injection attack
something specifically called a sequel
injection attack and the point of any
injection attack is to run untrusted
code in a trusted environment so
basically to trick you in running this
see for code here so how does that work
maybe you've got a script which gets all
the names and you want to grab some
details from your database but if you
actually put the name of the company in
here you'd end up with something like
this select star fraud company where
names you mmm nothing drop table
companies and then a comment man you
might be saying so what a scene I've
backed up my company's table
I'm not reaching bothered about this
that I'll just restore it but then the
drop table isn't the only command you
can run on a database and just like a
lot of things there's automated tools
which help to attack so look at this one
sequel map automated SQL injection and
database takeover tool takeover swear as
this dude
well you would run it there we go it's a
Python script pass it some endpoint is
an API endpoint which has a injection
attack runner ability if they're scans
it figures IO is my sequel the version
number different aspects about the
database and then okay now we know it's
my sequel let's try it with a common set
of passwords for my sequels it's brute
force attacking and there we go
found the password for it now let's have
a list of the databases let's list all
the tables
let's now what's it going to do now oh
yeah let's dump a table let's dump the
user table yeah okay no biggie but my
sequel also lets you do things like OS
shell which they she want commands on
the server my sequel running on so we're
running LS and now we're catching the
password file all from warn
vulnerability in your script so in about
a minute
that's a minute in about a minute we ran
that script and got the etc parser file
from your server
or some moral this story - the moral of
this story is never assumed that your
inputs will arrive in the format that
you expect okay and the kind of solution
for this and this kind general across a
lot of problems a lot of whole
vulnerabilities in this base is to be
something called sanitization okay
you're you've got untrusted import that
name was untrusted someone else is
providing that so you have to sanitize
it it's a bunch of different methods of
sanitizing on node for sequel you can
use sequel string where you pass it some
untrusted sequel it will escape stuff
that it knows is dangerous and that you
run the output command output sequel and
if you're using as your sequel database
we also have detection capabilities or
you can detect injecting the sequel
statements that we know are suspecting
are basically injection attacks and we
alert you on it we don't stop the sequel
from being executed we just alert you on
it and then feed him it's their AI as
well so you can change you can actually
see in a chain how we think you got
sequel injection attacks oh we think
that somebody's logged into your server
and you can follow this path through
your system so that was a second story
I'm feeling now little bit more right I
didn't just show everybody how to
completely take over a server in a
minute using okay you get a tough crowd
well I don't know maybe the next story
anybody heard of this this company no I
still use them perforce so this is
github we all know github hopefully and
github has something called a bug bounty
well basically they'll like pay you if
you find a security hole in their
software and you tell them about it
first
you tell them about it privately and you
give them a chance to fix it
before you tell everybody in the world
so um there's a really great exploit
found by this user called orange sigh
this is their Twitter follow them I
think posting smelly interesting stuff
and it was with github Enterprise and it
basically found a way to run any command
on a github server the server itself
okay and they did this by chaining a
number of smaller exploits together and
so on really big exploit and and I
really liked it because it reminded me
of like a heist movie know movies where
they robbed a bank this story really
reminds me of something like that so
though I'd love to share it with you so
you know web hooks or with maybe we know
web hooks and github where you can set
up github so when you do a git push it
does a post to some end point but you
define pretty straightforward right but
what if you set up the web Booker's
localhost what what happened then well
then when you do a git push behind the
firewall it would then do a post to
something internal to the server
remember you can have localhost with a
port number so you can post to any hose
that's running on that same machine but
you know this is github very known
beneful x' they were using a sanitizer
because that is untrusted input and that
sanitizing knew the local host was a
potential problem so we strip it out
but forgot about zero okay on some
server zero would also point to
localhost so then okay found a way in so
now we've got one small vulnerability
where you can do a git push and post to
some process on your server but what
what can you actually do with that
well the server was also running elastic
search you know elastic search that runs
on poor 9200 and if you do a post trick
hate HTTP POST request to this poor and
this end point it shuts down elastic
search but you know not a biggie it's
not a big note biggest issue in the
world then started looking for another
vulnerability to chain onto this start
looking at the code and found this okay
so well this isn't I think don't worry
about it I'll take you through so the
server is also running another process
called graphite is the Python process
that lets you do kind charting and
things like that and it's open source so
it's checked in to get help so on github
you found the source code for it and
then this was one of the functions that
gets called on a on an API request and
just to take you through what this is
doing it gets there the URL from the
query parameters gets the path and then
does a get request to that path it does
it get request that part so what we're
talking about here well now if you set
your your web hook to this URL 800 is
graphite we need to get Porsche it will
post
to this end point that end point is that
send email function it will take this
URL and then do a get request so all
that is done is a turned a post into a
get a post into a get on its own maybe
not such a big deal but but the actual
method there's a library they use them
to make that request for HTTP connection
it's a Python library now has a known
vulnerability something called carriage
return line feed so Tara turn the
backslash R is how you did new lines and
windows and backslash n is new line
everywhere else so but if you convert
that to hex it would look like this oh
do a so now what happens when you make a
get request to this okay so when
converting to the protocol they might
look like this but hey CP connection
library will convert these to new lines
and then we're sending this okay so what
is HTTP what is it what is hey sleepy
HTTP is you open up a TCP connection to
this host and port and then you're
sending it a bunch of strings and if
that host and port recognizes those
strings it goes oh this is a deep
connection with a sticky message I know
what to do but if it gets something this
doesn't look like HTTP it's just that um
this is a malformed a message it's going
to kick it out of the way right that's
what's happening here
okay so what you can send a malformed
haste VP message from the server but
what if you did this okay
that port is memcache now if you try to
get requests to this you actually end up
sending a hasty D method message like
this again we're opening up a TCP port
to memcache memcache doesn't know what
this means
oh it's back memcache doesn't know what
the first line means this is gonna
ignore it right the second line is a
memcache understands this it knows what
this is this is setting the key the
value data into the key key so it will
do something with that
it will then ignore this line at this
time this thing doesn't know what these
are
okay what have we done we've done
something called protocol smuggling okay
in a HTTP message we've managed to
smuggle the memcache protocol and so now
we can set data in memcache oh I forgot
have these lines okay so as developers
we all like to store stuff in memcache
you'll restore some Co serialize explore
a memcache deserialize it execute it
we're happy but we're all pretty lazy
people so we probably don't do that
serialization manually you probably use
a library where you pass an object
serializes if forest doors a memcache
take it back to the lab your uncie
realizes it i'm execute some code but
now we can set some beta in memcache
so as a developer you're gonna serialize
your objects you're gonna store it in
memcache later on you're gonna
deserialize your objects but you don't
DC realizing your objects but
deserializing my object you're gonna
execute a function not gets execute your
function you can execute my function
okay I'm looking through the keys in the
memcache found this
so when you say realize a bunch of
objects you might depending the library
might store the name of the class which
is getting serialize so they were using
deprecated instance variable proxy
instance variable proxy hadn't known
vulnerability so they put deprecated in
front of it but they still use them so
then it basically had a vulnerability
where if you deserialize an instance of
instance variable proxy you can execute
a command so then this is what the
eventual web thought looks like you've
got the first one it's that simple posts
gets converted into a the second ones
that get then this is the memcache key
so you can see set that's the key this
is the deserialize data and Eikenberry
is somewhere in here this is it this is
the command when we deserialize this
object the ID command gets run on the
server so this is what we used to prove
their case and get get the money
examples are working you go to your
profile click on the repository settings
add a web hook
runs a script to get the eventual name
okay
gets their webhook URL puts it in gets
ready to listen to any commands that get
run on the server and then to run that
thing just basically does a search any
search that's gonna request that data
from memcache the D serialization then
runs the ID command on the server
hmm the moral of the story
big exploits are made from smaller
exploits okay we like to think are our
attacks coming through one big giant
secret e halt well they don't you chain
multiple smaller exploits together so
you know if you find a vulnerability in
your software anything yeah it's not
that big a deal
now fix it cuz the github is
vulnerability the only thing they had an
ad code pretty small how you feeling now
little more
okay brush do the next one will go
through fast all right what does this
code do it takes your environment
variables see what the guess the string
of the environment variables okay what
does this code do what's why is my
surprise my server Oh if you ran this
code it looks like it would take all of
your environment variables and post them
to my server what if I told you I could
make you run this code on your server
who here puts like private things in
their environment are balls I don't yeah
okay
maybe maybe this makes it clearer what
this is I should get an extra minute for
this maybe this makes it clearer it's
some sort of set of scripts in fact
maybe this makes it clearer
it's actually an impaired module and
this is a setup script for an NPM module
if you install this NPM module you would
send me all of your environment
variables okay
you probably saying Assam iodine store
your npm module you saw this in almost
two months ago now so Kent Dodds had a
npm module called cross ends and they
found that somebody else had create
their own cross named module the real
one was crossed - M the fake one was
cross and without the - this is
downloaded a million times a day by the
way so if you installed cross M without
the - you are sending your environment
variables to somebody so hacker how many
times have you sat down and can't quite
remember the npm module names you try it
without the - and you're like yeah
whoops great that's what happens so the
moral the stories were a little bit too
trusting okay
and I think maybe it's because it was
open source we kind of trust open source
day that we don't really question it mmm
have taken down cross them that they've
got rid of all the ones they could find
associated with that account but you
can't really protect yourself from that
okay well you can do with NPM now as you
can absolutely possible packages
basically you can own the scope and then
only you can publish things under it
that's a solution to you stopping
yourself getting typo spotted on which
is what that's called but it doesn't
stop you from accidentally installing
something like cross and so yeah this
needs to keep your your mind clear on
that one just in summary okay what the
takeaways stop pretending
stop retaining that because you spend a
few minutes thinking about security that
you can create your own platform to run
software and use the pass don't assume
the inputs will come in the form of you
expect sanitize don't think that just is
just a small one durability act ignore
it fix it don't trust anyone and I don't
have a solution for that so there's a
unicorn and and that's it if you do want
to know a little bit more my colleague
has a course on no jet security and I'll
post up these slides on Twitter in a
second so you're going to follow me
follow me at joy and then now post up
all the slides and I'll have links for
everything and that just mentioned in
this course in this course in this talk
including all the links to all that
vulnerabilities and things I mentioned
and that's it I do much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>