<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>The Paved PaaS To NodeJS MICROSERVICES (JavaScript @ Netflix) | Coder Coacher - Coaching Coders</title><meta content="The Paved PaaS To NodeJS MICROSERVICES (JavaScript @ Netflix) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Coding-Tech/">Coding Tech</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>The Paved PaaS To NodeJS MICROSERVICES (JavaScript @ Netflix)</b></h2><h5 class="post__date">2018-01-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/QcNqfvMeWow" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right so my name is you know thanks
for care for that fantastic introduction
she stole my punchline but lots of
people watch Netflix as you all know and
we've recently had a really exciting
milestone 100 million subscribers how
many in this people in this room
subscribe ok who steals their accounts
from like to their parents hands up
right I'm just kidding uh-huh
we're over 190 countries and apparently
people just binge a lot of content every
day that's like an insane amount right
so that's Netflix what about no the
Netflix a few years ago my wonderful
colleague Alex Lucas in the audience
gave a talk about our first production
service running node and any of you who
use the website will be using it right
so that's the watch the service of
fronts or website and it uses technology
it's like rest if I react
Falkor really exciting it was our first
production ready sort of in that in the
line of fire build app worked really
well for us in 2016 we launched their
first backhand based back in micro
service on back-end service on node
rather it's something called codecs and
that's our dynamic asset packager that
serves out javascript and CSS and Jason
for some of our clients again directly
in the line of fire that goes down
websites down the TV UI is down now that
uses technologies like I street and
dynamodb and Resta fire and a bunch of
the Netflix platform so what do we have
in store for 2017 yeah right well let's
first focus on sort of the use cases
that we're trying to solve who's got one
of these devices in their pocket come on
everyone you've all got a smartphone
right and so that's kind of the value
proposition here in Netflix is you know
we you can watch our really amazing
content on any device really practically
any device that exists and our UI is a
super responsive and modern and they're
bespoke to each device and so these
devices that's out there where there's a
big 40 inch TV 80 inch TV or a small you
know four and a half inch screen on your
on your on your in your pocket I'll need
to get data
spoiler alert I'll need to get data from
the Netflix API right and what does that
Netflix API look like today as many of
you probably know we're very well known
for a microt services based approach and
so we have a bunch of back-end
micro-services there
on the right and those are the back-end
services that provide all the data for
foreign clients and we have you know ten
fifteen different client teams that
provide all the client code and the
Netflix API is really this integration
point so it lets the clients harmonious
or integrated with all the backend Micra
services because imagine if every client
has to talk to every back-end service
you kind of have this big spaghetti
twine it doesn't really work well so you
know a few years ago we introduced the
Netflix edge API and this really unlock
the puzzles that possibly for clients
just to upload their own API to our a
centralized managed service and to be
able to mutate and change those API so
whenever they want and not be beholden
to you know rigorous release cycles and
also give us the flexibility to be able
to run these api's update them won't
update them whenever we want without the
infrastructure and not have to sort of
make sure make these client teams
running in any of the infrastructure
since that was all taken care of so this
is really good it really unlocked some
of the velocity that we want to be able
to enable you know all the great client
that we have and when we first started
running services on top of the Netflix
edge API we had we had about a hundred
of these data access scripts right
fast worded today we've got more than a
thousand of them and so this this is a
GPI is getting to be a very very much a
monolith in terms of there's like
thousands of live scripting production
they change all the time and there's
some issues here with this right if one
of these scripts go down takes it takes
down the entire process all of the
clients are down so maybe you know you
pushed a bad bill for iOS out there's
the memory leak it crashed the process
all of Netflix is down so the isolation
was not great additionally this service
got so big that you couldn't run it
every possibly running locally and so
developer productivity started to go
down you have these five ten minute
turnarounds where folks have to upload
their code to a test instance running in
the cloud somewhere
wait for that to come back hit it with
their with their client if there was a
bug they have to be able to some code so
that was really really painful and so we
decided you know to sort of come up with
a new architecture and we talked about
this a little bit last year but we
decided to break all those different
outdated access scripts into their own
micro-services rankest where you know I
think that that gives us the isolation
that we wanted and most of our clients
today are written in JavaScript those
things like the TV the Westside and
others and so it
perfect sense - then hey why don't we
provide you and use note on the server
side for these for these services right
because if client client teams were
gonna be writing JavaScript on a client
already comfortable with JavaScript made
natural sense to go go with no plus we
had all that experience in the last few
years running and building no services
but there was just a slight hitch right
because we have this ethos of operating
what you build in what you own now we
have client engineers and need to
operate really robust reliable services
in production right they need to
horizontally scale and that's why we
decided to sort of you know to go with a
path based approach so in 2017 I'm
really excited to say that you know
we're in the process of migrating you
know the 1 1/2 of the the Netflix API -
no so really really exciting news were
no than uh Netflix and this is gonna be
the streaming path of every single
device whenever it needs to make it
request Netflix so think really really
big scale and so when we first started
we had 15 engineers around there that I
was working on on the on the the website
right I was running on node when we
launched codecs we had about three
engineers when we're working on the API
we're talking about 200 engineers right
and so now we have to really think about
how do we make sure that these engineers
like we said earlier who our client
engineers are able to operate this stuff
in production was lively right because
again our customer are these client
engineers they don't have the they may
not have the experience of a back-end
engineer who has who has a distribution
system Sirians they've they've never
operated service before probably they're
really great at responsive design and
cinematic hue eyes and so how do we
enable them to be able to run production
great services and that's where paths
comes in right if we can offer a pass
for them which is platform as a service
basically allows them to build run and
deploy and operate services without the
complexity of having to build and
maintain the infrastructure or the
platform which is a huge win for us so
today we're going to talk about our path
to achieving velocity and reliability
because those are the two things that
really we really want right one thing is
the engineers to be able to quickly
deploy and and innovate on the client
side but they also these services also
have to be reliable if they're down
Netflix is down people are happy so it's
really about three things one
standardizing the components that that
goes into going in microservice to
having a preassembled platform and three
having automation in tooling so let's go
through the first one standardized
components who here build micro-services
at their work or on time right so we all
know there's a whole bunch of components
that go inside a micro service house
there's a whole bunch of them and
luckily here on Netflix we've got this
great set of common runtime services and
components and libraries that already
exist and we've open sourced them lots
of other folks in the community use them
so a question for the audience is you
know why do we have standards right why
our standard is important because we're
talking about standardizing these
components and a good good example of
this actually is uh as an analogy in the
real world which is this despite was
title slide type confusion leads to Mars
failure so this is this is a Mars probe
it's called the Mars climate orbiter if
you zoom in this has caused the British
width the Mars climate orbiter now in
pieces on the planet's surface right um
eat that NASA but the so the reason this
thing crashed is because you had one
team of NASA using imperial units and
then the team using metric units and so
of course they got their wires crossed
and the lander is unfortunately you know
now on the surface of Mars in bits and
bobs and so we could talk we could take
this analogy and move it to into the
world into the microservices world and
we take one example of a component say
RPC right you know I've been around a
while but you know we're in this really
great time in the world where we have
we're spoiled for Charlotte choice when
it comes to RPC right there's so many
different RPC choices we can make and so
if we gave our team say the flexibility
to say like hey you know with with all
your micro services stack used whatever
RPC mechanism you want they're gonna go
do that right so you could have write
some words your PC somewhere else for
Nagle somewhere else and this will work
perfectly fine when there are no
problems with a service right but we all
know when you're always going to have
problems right your service is always
going to fail and when we fail get a
bunch of angry - angry tweets and you
know the biggest deal for us is really
how do we fix our failures when it
happens so the you know the things that
we're trying to optimize for is mean
time - detection and mean time to repair
if we can speed those up we can resume
our services and also our managers will
get office right I mean you know
um so if we take those n flavors RPC
right and we have a problem with one of
these services imagine the complexity
now of how I'm trying to debug all of
these services with their different
different RPC mechanisms right you have
if it you have a site reliability
engineering team and they're trying to
figure out what's wrong with the
specific servers or set of services but
now they have to understand how each and
every single one of these different
standards work and that's gonna be
really hard to deal with and so what we
want to do is decrease MTTR and MTD it's
the thing we could do is make sure that
we have a standard set right with
standardized almost one RPC mechanism
that we can use and if we extract
extrapolate this out to all the
components that we've got then you know
the benefits are standardizing become
even more apparent right so for one you
get consistency right and having a
consistent set of components means that
everything's easy to debug but even more
than that you get a lot of leverage
right because now I can focus a bunch of
core teams to go and work on these
specific components and they're the ones
that make sure that these components
work really well I work with lively and
you as a service owner aren't really
tasked with reinventing the wheel every
time you can just take these services
and ensure that they're always
interoperable with everyone else right
now it makes debugging easier that makes
development easier it gives you high
velocity and better reliability
speaking of reliability you're gonna
have better quality software because if
you have one team or set of folks
dedicated and focused on specific
component and you focus on only that
component at the company that means that
everyone else is not spending time
rewriting the software or rewriting all
those components they can focus on their
software and that software that they're
using from their their partner teams are
going to it's going to be a better
quality and support as well right you
now have this really good knowledge
knowledge base of hey world where all
the components located what are some of
the issues that we've seen so
consolidation is really important and so
and that's like well I can start we've
got a bunch of these components that we
already own and they're all written in
Java right because we're still mostly a
Java shop so how do we get to a world
where we're running micro services that
skill unknown or for a long time what
we've done is used to sidecar right we
crammed all these Java based components
into one Java based service which is a
proxy and instead of our container or
the
we have this Java sidecar that's running
and our note effectively proxies all of
its requests and all of its integrations
to the Netflix ecosystems through this
sidecar and this has worked well for us
you know for through our first couple of
services but as we start to scale up and
ramp up the number of services we run
into we're running there are some issues
right one it's pretty inefficient right
for every single no app without that
process I have to run I have to run this
Java service probably long sighted
that's not the most efficient user
resources we're often the last to get
new features sometimes we don't get the
new features at all because again we're
not really you know we're like the last
people to get them just for the Java
folks we're kind of like the last thing
on their mind and again we also need the
expertise now in all these teams they
know not going to have to learn how to
run node and now have to learn how to
run Java and that entire stack so I'm
happy to say that you know in Netflix
we've actually taken all our java
components and I've got week Vonk on the
role to polyglot and are in the process
of making making all these components
now available as no modules as well
which is really exciting for us and so
we have all these components now let's
talk about having a preassembled
platform right so I want to build a new
service what do I do
well someone says go here are all the
components and you need to go build a
service sculpt you're you're good to go
right well turns out it's a little bit
more difficult than that just even
getting on the blocks what do I have to
do right we'd have some documentation to
figure out how which components go
inside of a reliable micro service maybe
copy/paste some code somewhere right
that's all in the wiki somewhere figure
out which versions of each thing that I
need how do I initialize these new
things how do I can figure them
correctly oh wait maybe I'm missing
stuff I don't even know that I'm missing
stuff and all this takes days or weeks
and we're trying to foster product
innovation by driving the developer
velocity and reliability and it turns
out if we follow just that model
bootstrapping a service when not neither
get will lossy or reliability right at
service and we spent all this time we
have a new rid of single line of
business logic yet and remember our
customers are these client engineers
we're you know maintaining their data
access services it's just a means to an
end for them right they just want to get
data so we what we decided we could do
is take all of these components sort
them and put them into a preassembled
platform that's just ready to go and so
all you have to do now
an old service developer is just
dropping some JavaScript that's it and
that's ready to go you skipped all those
steps that we just talked about right
and by default you're not writing a
single line of code and your app service
starts and it behaves with a Netflix
ecosystem and yeah it has all these
things out of the box so let's talk
about some of them right so out of the
box with a platform you're gonna get
stuff like component management so you a
little bit ensure that you have every
single component that you need to be to
run a reliable successful micro service
some of the things that people often
forget to build into their micro service
are things like alerts metrics logs the
essential institution might need cuz you
just forget them right and so if we're
pre bundling all these components inside
of the platform you won't forget cuz
they're just be there
speaking of insights even if your
services generally speaking even if your
services do have insight they're all
going to output a different set of
inside right so service a could have
different alerts and dashboards versus
service B and now extrapolate that cell
up to 200 engineers and 1520 services
you can't really reliably operate this
because there's so much cognitive
dissidence every time you're trying to
look at all these services because their
insights are different but because we're
bundling all the components together in
a platform we're able to emit a
consistent set of metrics for every
single service that runs on top of the
platform right and this really helps to
reduce MTD DM and MTTR when there's a
problem before the dashboards are
identical all the metrics are identical
and the logs aren't identical it makes
it a lot easier to figure out what's
wrong with the service another really
nice thing about having all the
components one building a platform is
that it configures and initializes
itself correctly every single time right
so again you know you have 12 13 14
different components inside of the
platform just because you have them it
doesn't mean that you actually know how
to configure or initialize them so
having all this stuff pre bundle for you
it's basically like a pre-flight
checklist right every time your the app
starts it follows the patterns of
already know and it's all there you
don't have to think about them and you
get reliable performance and and quality
every time another thing that people
often think about is you know folks is
generally pre sort of averse against
upgrading specific components in your
app because hey go I'll play I'll go and
update this component and now it stops
working nicely with the other components
my app like magically breaks and I'm now
causing knowledge so by bundling
everything together in a platform
you know we as the platform team can
really control the upgrade cycle so when
we upgrade the platform we ensure that
all the updates all the components are
updated they play well with each other
we've tested them and all the
compatibility is really great and this
again it helps to unlock the velocity
and reliability right you as a client
team who's writing these services can
focus on the business logic and not have
to worry about oh my god do I need to
update this component is it gonna break
my app etc so having a really a good pop
platform is no good though if it's hard
to use wrestles that Start spend a
little bit of time to talk about the
developer ergonomics of this platform
right how easy is it to use well there's
really only two things that's part of
the platform API one it's there we have
a JSON based route definition that's
based off of an open source rest of our
module and there's no matter did it in
there but essentially unless you specify
a rest route that points to a file
that's highlighted there right so here's
my ping route right there and then what
my route looks like it's just something
that everyone's eminently familiar with
in the know community it just connects
down middleware so the friction of
getting started is really low right so
here I've written like five lines of
code and now I have a fully capable note
service that runs within the context of
the Netflix ecosystem it's reliable I
get access to all the different platform
components to the request objects just
like I would expect if I'm writing any
other type of connect still middleware
on whether it's not something Express or
happy or rest afar whatever else it is
and so we really tried to make this
platform as easy as 1 &amp;amp; 2 there's no
step three you just drop in some
JavaScript and now you have a really
truly reliable ready to go micro service
and you can now deploy and test to the
cloud which business to automation and
tooling right remember that our target
audience here are our engineers who
never deployed or operative services
right and we're breaking that one model
with now to maybe hundreds of micro
services now and you as an engineer when
you use to just upload code to a server
somewhere you don't have to deal with
operating managing developing 4 or 5
micro services at a time
and so what does that mean right we need
automation to it so for executive ship a
feature and you give something gyros and
ultimately that ends up being a feature
what are the steps that you need to do
right in order for this feature to make
it out live it's part of your new
service do some development right do
some testing you may have to deploy it
out to the cloud and once it's there you
have to operate that service
right so if we talk a little bit about
development what's like one of the
really two things that we really want
for developer experience or one we
wanted to be high velocity right wanted
to go fast is that's kind of the
complaint that we've heard with the old
system is that gosh it would take me
5-10 minutes to turn around it build can
I just do this stuff locally can I get
everything set up for me so we've
invested in a set of come a CLI for a
common developer experience so it takes
all the things that are generally sort
of hard or tedious about setting up the
environment makes it easy so for example
to see how I boost jobs your entire
environment for you so it brings things
like NPM and the installs the know
version of submit to make sure it's
consistent and gets get up and running
maybe darker machine whatever else all
the dependencies that you need to get up
and running with that service it
integrates against all the tooling and
services that's available on Netflix
things that lets you deploy to the cloud
like our spinnaker which is our CI CDN
deployment tool integrates against
source management the docker registry
against Jenkins right it makes it really
easy for you to integrate against all of
these things so you don't have to worry
about them again what we're shooting for
is for you to have the ability to just
write some code and be able to easily
take that to the cloud and so again with
the CLI we're also able to provide
interfaces where you can run your
service both locally and in the cloud
and that's really really powerful
because you know we want to speed up
local development so because we're using
docker now we can drop a docker
container locally on your laptop instead
of having to upload your code to a
remote server somewhere and wait for
that to finish you can actually do live
reloads now on your local machine so you
make some changes boom that's instantly
reflected in the docker container now
you know you can attach to your favorite
debugger right right there locally on
your machine step through it you can see
all the logs that's coming out of the
out of your service and you can hit it
because it's all just local but the nice
thing about all of this is because we're
using docker I can always drop in a
production container as well right so
I've got I've got a service misbehaving
on and prod pull down a docker image
using this tooling and boom it's there
I can deploy it and I can debug it to my
heart's content without without having
to uh - without having to do that stuff
in production which often can be
dangerous so what about deployment right
you know as a colleague of mine once
said going to production is like going
to war right it's painful and one thing
that we remember is that
that you may be more likely to get
killed on your first tour of duty if you
actually go to war than like on your
third or fourth try because you don't
have any experience and we have some
experience differences here in Netflix
right we've got these wise and Noble
veterans who've been in the war many
times they know exactly how to offer
their services they know where all the
tools are they've got the experience of
getting a page at 3:00 in the morning
and we have our client engineers some of
them who just basically graduate boot
camp
some of them who've probably never been
at boot camp right are we really gonna
drop them into into the jungle and
expect them to say we won't and they're
most likely just gonna shoot themselves
in the foot and that's what we don't
want right and so how do we make sure
that they can deploy manage services
reliably and operate them well let's see
if we can put them on Rails right so
those are things like why don't we pre
configure pipelines for deployment and
rollback so they don't have to figure
out one learn how to generate them and
to have that we can give them that years
of experience already have on how to
reliably deploy service whether that's
without the red/black push how do we
liable all that stuff up and we can
generate these as patterns that they can
use it with the tooling that we've got
right give them single command so they
can deploy their services to any staff
without having to jump through the hoops
of having to integrate with all the
tooling that we have we can just give
them a single command it makes it much
easier and safer for them because they
they're less likely to get it wrong
things like integration with our
automatic canary analysis tooling right
that lets them see them when they have a
new build whether they be requesting any
way and that's all automated so they
don't have to worry about something
setting that up see a theme here
automation right pre configure their
auto scaling for them so basically take
all those patterns that we've learned
operating services in production and
Netflix and really creating these
patterns and integrating them with this
tooling that we have so that when we're
writing note services you just get that
stuff for free you don't have to go in
edit it again from scratch so what about
operations right now deploy my service
off the prod it was really easy to
develop on I've got my servers on the
prod now I have to operate it right and
that's pretty difficult in its of itself
and on Netflix we have a whole bunch of
really great tools that you can use to
offer your service things like - ORS
looking at your bills logging but you
have to know where those tools are right
and so for us for these new engineers
who've never operated services before we
give them a consolidated view so
consolidate view that lets you see all
the different different versions
your service the traffic the traffic
that's taking activity linked back to
source control linked to dashboards
linked to alerts and that makes it
really easy for them to go to this
one-stop shop to see what the statuses
of their service again trying to reduce
MTTR MTT D increase reliability and
because we own the platform right we can
generate a consistent set of dashboards
for them right so you can get stuff like
our PS latency CPU utilization all this
stuff generated for free whenever they
have a service they don't have to worry
about setting it up
similarly with alerts right how many of
you have set up dashboards forgot to set
up alerts and then the next morning you
find out your stores is down for like
three hours you do have alerts right so
we again are also generating all this
stuff for them I think we've also
building things like automated analytics
and two lanes of things like flame
graphs right just get that for free
things like core Dom analysis so really
think about building automating tooling
to really help them operate their
systems so they don't have to go invent
their stuff from scratch so today we
talked about in our past - velocity and
reliability and it's really about three
things one standardized components right
if you have consistent standards you can
leverage all these building blocks a lot
further and there will be much higher
quality so that you're getting better
velocity because you don't have to
develop them yourself and you get really
great reliability because you have a
consistent set of these components and
they're managed really well by your
partner team's putting them into a
preassembled platform means you can
reduce friction and increase reliability
when you're trying to create a new
service right and then finally having
automation and tooling means that we're
able to increase the development
velocity and have by having reliable
deployment operational tools for folks
who may not have that experience so
hopefully we can take some of these
stats and learn about how we build our
path with velocity reliability in mind
and I hope you guys find a useful
maximum you think about using node as
the bedrock of your servers organs
oriented architecture with that thank
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>