<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>AMP in the Wild, with The Guardian (AMP Conf '17) | Coder Coacher - Coaching Coders</title><meta content="AMP in the Wild, with The Guardian (AMP Conf '17) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-AMP-Channel/">The AMP Channel</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>AMP in the Wild, with The Guardian (AMP Conf '17)</b></h2><h5 class="post__date">2017-03-28</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/T-RplasFnb0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello so first I want to just check that
everyone can hear me I haven't used this
one this type of mic before yes okay
close okay um so yes as Thank You
America my name is Natalia and I'm a
software engineer at the Guardian I
worked on what we call the dot-com
platform team and for us we're
responsible for the website we're
responsible for the website as a whole
and we're also responsible for making
sure that other engineers that work for
the Guardian can contribute the website
the big are the most important things to
us is making sure our website is fast
reliable stable and fun to work on I
also AM so food that is not sliders
written apologies so the animation of
our article pages is one of the big
things I have worked on our since being
at the Guardian and and my team is
responsible for maintaining okay here we
go so I just wrote backstory in October
2015 we joined a few other news
organizations as a launch partner with
Google to create some of the first and B
HTML pages so today I'm going to cover a
few the difficulties we had when
creating the aunt version of our
articles and this includes how we do on
resonance and also how we actually had
to change our header and navigation to
to fit of the restrictions of amp I also
wanted to spend some time today to talk
about how we monitor our amp pages for
validation and also some of the pros and
cons in building the app version of our
website so first I will start by
mentioning that quite a few people in
the past have asked me why we built our
amp pages and subsequently whether they
should build amp pages as well well as
everyone knows the biggest benefit of
amp is that it's fast and the truth is
some website especially news websites
aren't aren't as fast between
constantly dealing with future requests
from editorial between the drive-in need
to make money and an ever-changing
climate and also between feeling like as
all of developers do they need to kind
of catch up with all the latest
advancements in web development not by
surprising that web pages can get out of
hand
that's that our website is pretty fast
multi-donor talks said that the Guardian
the only known media site where the non
ant files are actually faster of course
this is loading loading ant file outside
of Google search loading the same ant
page from Google search where it could
be pre fetched and pre-rendered it loads
instantly and for users coming to the
Guardian calm for the very first time we
would not be able to provide the same
experience this is why we are so keen
increasing the ant version of our
website we all know that the quicker and
article load the more likely user is to
read the entire thing the more that
creates trust between the user and the
website in the branch and if the user
trusts the website they're more likely
to engage in content in much more
meaningful ways of course when we
started building our amp pages we ran
into the same problems that a lot of
people did you end up asking yourself
constantly how do you do X without
JavaScript but obviously the more you
ask the more you realize that you don't
need of is great for a lot of things but
you maybe thought you did and and
actually if you do find something that
you can't do in ants as everyone's that
the an team are super recessive and the
project is of resource so you can just
get involved in contribute so this is an
example of something that we wanted to
do on our website that where we wanted
to do an amp that we have on our website
and we called it onward journeys at the
bottom of the article here we serve
related content the article content in
this section that the article is in most
viewed content of
websites and also created sections from
our front page on our website
even though articles are cached for an
hour this these onward journeys are
updated far more frequently for example
the most read stories we take that data
and it's real-time and so it actually
changes quite a lot within that hour and
so for that reason we couldn't include
them in our amp pages originally so we
suggested a way for us to be able to
have these on-road journeys on amp and
the EM scheme were going they took on
the feedback that we provided and made
something that was immediately useful
Angeles and Atmos - was what was created
and actually we use them a lot in our
pages so another big problem that we had
when converting our article pages to amp
pages without geo based editions in a
cache we actually have four versions of
every article these are our four dia
based editions we have UK us into an
Australia and international the header
is slightly different the navigation is
different we replaced the instructions
and links with words that make more
sense depending on where you are so for
example for follow and focus and without
being able to serve different versions
of the same article from the cache like
we do on our websites there was
absolutely no way to replicate our
navigation on app but we took the
challenge and tried to come up with
something better instead we also did
some research where we did this and what
we found is that users that were
unfamiliar with the Guardian brand
actually saw a page like this one and
didn't even realize that we were a news
organization at all they often think
that we write about science so clearly
this isn't doing enough for a branding
anyway so yes this was the first
iteration of I simplify enough it's the
first map that we had on amp and even
though it is a lot simpler we actually
found that it did a much better job of
explaining our brand
some users it also simplified our
offering to ignore the problem that we
couldn't have a different map per year
based Edition and the treatment of
matter is we really we really entered up
liking Oh simple nerve it solved a lot
of problems for us and it was just
simple but we still needed a way to show
a menu and we couldn't do that without a
way to show a different menu per Co
based edition so again we explain this
to the amp team and they provided us
away thankfully they didn't call it
expand oh I have to do justice but
instead included it in there and side by
component that they were already working
on so now we can use an amplified of an
ant sidebar I touch the menu for most
users we can get their location from
their IP and use that to inform which
geo based additions are served from but
many of our users have very specific
preferences with us for what geo based
Edition they want to be served and for
on our website we saw that information
in the cookie and we can find cookies
across with the request from our aunt
pages by using this credentials
attribute we can send cookies because
even though we are serving from a non
Guardian page on the Google CDN for
example we request the Guardian page
which has access to the same cookies as
a website does the Guardian page in this
case is am doctor Guardian home so if
the user has a preference we serve them
that geo based edition otherwise we give
them something based on the location of
their IP so once that was in place we
started working on a redesign for our
menu and this is what it ended up
looking like content in the menu is
spatula burger is correct and that
content is based on the user's location
the content is then sorted from most
popular to least popular and what goes
into those lists are largely editorially
defined so what we've learned from amp
has actually led to a massive redesign
on our website as well as you can see it
looks pretty similar
thanks to discoveries an amp users who
are unfamiliar with us are now much more
likely to write to know of us as a news
organization and in fact based on the
u.s. research that we did afterwards
people in the US who are unfamiliar with
the Guardian brand people who saw this
navigation were three times more likely
to recognize as a new site as a warning
if you go and the Guardian calm now to
see this header only about 10% of users
on mobile will see it it should be
rolled out to 100% fairly soon but that
will most likely wait and fly them back
in London so apologies um yeah so we're
always monitoring how our amp pages
perform and we're always comparing that
with how a mobile web pages perform as
well and it's a big goal of ours on the
website to make sure that we keep
iterating and making changes to both
based on what we find
so the next big problem that we had on
our amp pages was making sure that they
just continuously validated there's two
main ways we found that we might break
an amp page for us there's a developer
errors and journalists errors I will go
through how we deal with both but I will
first focus on the easiest one to fix
which is developer s I'm sure a message
like this looks quite familiar to anyone
who is an ant developer it is definitely
something we used to see a lot so how we
built ants is we made it part of our
websites we don't have another text box
to support ants and instead have chosen
a current class to do it instead so this
means that if you request an article
from our website normally we would get
the content from our content API and
we'd render it as you see here for um
you just have to change the URL the same
content is fetched but the markup is
different once we said it some
supporting amp we realized that if you
implement something on our website you
also have to implement a slightly
different version from
well for example you can't just embed a
YouTube video you have to embed an
amputee print permanent components even
iframes need to become anti frames and
might have different restrictions on
them than we would normally have so
given that you can imagine how easy it
might be to break an app page an example
of this is on May 27th last year we
actually invalidated all of our app
pages by adding the facebook Messenger
share button to them this was added to
both aunt pages and non on pages and the
developer students that it would be
fined because there was just a button
and it seemed like a fairly innocent
change to be said as it turns out
support for the facebook messenger
protocol hadrons has been wait-listed on
aunt pages quite yet as support for the
project have actually been added to the
github project two days before this but
it hadn't yet been released into
production so in other words we are
about few weeks early to make this
change and this is what it did to our
aunt page validation yeah the blue line
indicates aunt index pages and the red
line shows index errors you can see
where the errors are started to spike
where it's clear that something went
wrong and you can also see where we fix
it and think those regulating back to
normal
so it's prevent this from happening
again we started using the aunt HTML
validator and PR module and we added a
sense caller integration test that could
easily be run locally and in RCI's these
are run on every pull request that is
major project and after every merge to
master before deploying into production
for for these tests the validator
runtime is fired up in a separate
process and uses a headless browser to
load up content for validation
these tests run on a specific list of
articles and we add stats that list
every time we implement a new feature on
article pages or every time we fix a bug
so this helps catch most of our
or introduce errors and definitely helps
avoid regression so that only covers
developer introduce errors of a
developer introducing code to our
repository but we have found that we can
break amps in other ways so an example
of this is a drainer HTTP to HTTPS
migration we were most of the way there
but we were stuck on one of our of our
most important editorial section
politics unclad a few of our UK politics
articles we embed videos of the official
UK parliament TV which happens to be an
insecure source because this was
important to a journalism we have to be
able to continue to serve those of those
videos and articles until we find a
solution at least so that it didn't hold
up our progress in other areas we wrote
a rule in our CDN configuration to
redirect all politics traffic to the
HTTP version of The Guardian com
the result of this is that we we
actually rejected all ABS traffic on the
post expected to burn not HTTP non and
version of the site the result of this
was another massive drop in an traffic
after this experience we of course set
up another set of tests we created an
odious utility which runs against
production on an hourly schedule and in
our CI if it fails we look into it
straight away
we do expect any problems we see here to
be looked at and fixed immediately the
bank covers most of the developer
introduce errors but it still doesn't
really help us catch validation error
might be caused by a journalist
being something unexpected the truth is
right now we have limited control over
what a journalist might invent paper
examples and example of separating camp
as on one of our lives laws when they
popular live blog stop receiving and
traffic so on this single biggest
traffic day of the year and I chose in
tow this is a single biggest traffic day
we've had ever a journalist embedded
what we call an interactive item at the
top of the main live blog covering the
US election results if it had been
anywhere else in the page that would
have been fine because it would it was
automatically changed into a resizable
an iframe unfortunately this was I in
the first screen of the page and within
600 pixels from the top of the page
breaking a rule and ants and thus
invalidating this live blog this is how
that affected our ant traffic that day
the green shows our traffic to amp and
the gray is our traffic to the website
on a mobile device even though we still
had amazing traffic that day most of it
was to that particular live log and it
would have otherwise been on camp if it
will handle invalid so help us catch
these airs just a little bit sooner
using the same know JSP 13 I mentioned
before we also have an option that
fetches the top 15 most read articles
from our in-house real-time traffic
tools and that list is then run against
the validator if errors appear again we
fix them as soon as possible so for this
article if we'd have this in place then
we would have caught this area and be
able to and would have put a fix in
place so the last thing we've done to
help stretch Aires is set up alerts on
our ant traffic if traffic drops below a
certain point we assume there's an issue
and then work to fix it as soon as
possible this is a last resort though
and we've actually found in putting the
rest of our tests in place we haven't
actually had these alerts go off and
let's hope by continues
so at the end of the day as mentioned we
have limited control over what a
generous my investment and as soon as an
article is published it's been
accessible on the website and therefore
an amp as well we have new content
appearing every minute and so if it
doesn't make its way into our top 50 we
might not notice an error or because
this is an ideal what we've discussed
doing is actually utilizing our preview
service that our CMS uses to check
whether or not an unpublished article
might validate on amp to be clear this
would never stopped someone from
publishing that article but what what it
would mean is that we could have a
real-time status on how our unpublished
articles would be doing on amp and we
might even get a chance to fix some
errors before they happen but regardless
of how we find our errors there are a
lot of things that could potentially
break amp and we do have to be pragmatic
with what we fix we currently only focus
on errors on a large number of pages and
and of course errors on popular pages
and we do ignore order content
completely so to summarize the main few
ways which we might break an amp page
rather by developer doing something or
journalist doing something if it is a
developer we test with one on every PR
and a cron job against production which
catch most of these ads for journalists
introduce errors we currently only run
validation against our top 50 however in
the future we would like to track the
latest errors from pre published content
so when someone asks me whether they
would want to build an amp page I do try
to be really honest with them and tell
them exactly how it was for us so though
amp is a great thing there are costs
associated with it first there's the
initial setup cost this is the time you
either have to spend creating a new
start to serve your amp pages or add it
to your existing stacks which is what
we've done after there's the continued
developer cost every time a new feature
is added so either need to be
it from M or specifically added to M and
each new developer who works from a
project has to then learn about Amp and
the restrictions to develop on it
properly and of course there is a
general maintenance cost to be fair
there's almost always a maintenance cost
for every new piece of work and answers
add complexity to a project and we do
need to do more to compensate for how
easy to spray
we also it is also a goal of ours to
keep our project up to date with the
newest advancements in the amp HTML
project but despite all these cost
we still think amp is a good thing for
us and all the reasons mentioned before
ensuring our users can access our
content and providing a good user
experience for them our few the most
important things that we do so an vs.
The Guardian yeah it's not really that
it's much more about the Guardian and I
really just wanted to take some time to
share some of the metrics that are on
pages are doing so first
where does am traffic come from well
unsurprisingly the main source of
unperfect comes from Google search over
the past week at seventy four point
eight percent of our traffic came from
Google search to be exact
other sources include news and Google
News Twitter and Facebook this is all
our traffic mobile traffic from Google
search in the past twelve months
the massive spike is of grass you
actually solve Okla it was right after
the US election when we when we are
showing the results so an account for
roughly 60% of all Google referred and
mobile traffic it is a bit higher in the
US and UK and a bit lower for the rest
of the world as you can see and has been
slowly taking over on mobile web traffic
and we expect this might increase even
more as there are more platforms that
are starting to support amp and we're
continuously working to make sure more
of our content types are available by
amp as well
so we found that add links in Google
stats have a roughly two percent higher
click-through rate
we haven't validated for sure why this
might be for us but we do think it's
possible that some users are more likely
to click on an on page because they know
it is guaranteed to be faster more and
more users seem to be recognizing the
lightning bolt as a symbol for Facebook
and for articles and arms and
potentially no it's just less of a risk
to click that link they know the page
will load instantly once on an amp page
users shown 8.6 percent overall higher
click-through rate to a second page on
the Guardian com this is mostly because
out of the onward journeys that we have
at the bottom of the page one of the
reasons why this is is because we do
show more stories there and we do some
more breadth of options as well there's
also less merchandising and like other
things to click on at the bottom of the
page for this was intentional because
for us the big kind of amp was to drive
people to the website well then we have
teams who work on I'm dealing with
loyalty between users and so for us this
is this is a great thing
advertising revenue for the most part ad
revenue between is pretty similar
between amp and our mobile web so those
in the audience who might not know CPM
or cost per thousand impressions as a
marketing term used to denote the cost
of 1000 AD impressions on a website so
for us the price the price of 1000 AD
impressions on our mobile web is quite
similar to that on amp on average
overall our region for an CTN is within
5% of each other regarding add the
ability even though we also lazy load
ads on our website we have found that
actually does show the ad slightly
student and so we do have a greater ad
viewability on than we do on our mobile
web
the most other aspects of our aunt page
perform in quite a comparable way to our
websites and a few biggest problems geo
based editions of our articles and and
validation both turned out to be quite
surmountable problems and I suppose vice
I give people when they ask whether or
not they should create an pages as well
of course I mentioned the validation
issues and potential costs and of course
I mentioned needlessly the Amber's past
and all the benefits that can come from
that for example more trust between the
website and the user but I also talked
about how amp can be good in in some
more unexpected ways for us we have
found that that and provided this
amazing opportunity for us to improve
our mobile web articles do the
restrictions of we actually worked to
simplify article pages and create
something that was immediately more
useful to users and even from the
beginning our goal was never about
replicating the guardian comment but
instead about creating something new and
actually through that process we've
actually now changed our non mobile web
to be better as well thanks for
listening</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>