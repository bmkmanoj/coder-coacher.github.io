<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>I can't believe it's AMP! with WompMobile (AMP Conf '17) | Coder Coacher - Coaching Coders</title><meta content="I can't believe it's AMP! with WompMobile (AMP Conf '17) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-AMP-Channel/">The AMP Channel</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>I can't believe it's AMP! with WompMobile (AMP Conf '17)</b></h2><h5 class="post__date">2017-03-28</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Em-tZ4WMMps" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so I'm Madison Minor I'm the founder of
want mobile and today I'm going to going
to be talking a little bit about if you
might guess by the title of the slide
some things that you can't believe that
you can do with them but you actually
can and I'm I'm Sebastian I'm a
developer advocate at Google and I'm
going to talk about what's possible if
you really Porsche performance thank you
a little background about wom mobile and
how we got here what mobile from doing
nothing since 2010
except for optimizing the web for mobile
and as you can imagine performance has
always been a huge focus for us so when
we first heard about amp we got really
excited and we dove in and started
playing with it and the very first thing
we did was tried to create an e-commerce
amp which was a bit of a challenge but
we got it to work it was a pretty simple
ecommerce page it didn't show up in the
lightening bolt or with lightning bolt
of trust yet but it it was amp it was
very fast it allowed you to configure a
product and it integrated with the
existing site checkout system we thought
it was a success and we really enjoyed
it
since then our we've developed over 1/2
million ecommerce amps and the results
for our clients have been tremendous but
it hasn't always been smooth sailing
through this journey so we've
encountered a lot of skeptics we've
talked to clients and potential clients
and their developers that have said
things like amp just adds another step
to the buyer journey or you really can't
big build interactive highly functional
ecommerce pages with amp where that amp
was just for news publishers and it
really wasn't ready for e-commerce and
so what we'd like to do today is dispel
all those myths and really show some
examples of how we've created rich
interactive experiences of amp and so
the point of today's talk is really not
to showcase or describe the best way to
create a specific piece of functionality
but really show that you don't need
third-party JavaScript and you can build
a lot of functionality just with HTM
PSS if you're willing to think outside
the box and some of the solutions all
show today thanks to improvement in amp
there's now easier ways to do them but
we still wanted to present them just to
really prove that not only is amp ready
for primetime in commerce now but it
really always has been
I'm going to share four solutions the
first is a pad interface the second is a
full-screen modal air the next is a
voting mechanism and the last is a
payment system actual checkout system
built into amp we're going to dive into
the code and kind of show the details of
how they were created the first three
are in production today and live in our
client sites the last ones under
development and will be live soon and
instead of showing any one of our client
sites and really picking on our clients
too much we decided to build our own
store just for this conference to
include all of these solutions and one
amp page just to make it easy to share
and we really thought about what should
our store sell what's an appropriate
product and we decided on a cycle with
no breaks launch be nice and fast so we
created amped-up kids
so our store sells one product which is
a cycle with no breaks the first one
we'll jump into is paths tabs are a very
common interface you see all over
anytime you're using a computer but it
wasn't really apparent how to create
tabs and amp and we saw a few requests
for this on the good head journal and a
few requests from other developers we
thought it'd be worthwhile to share on
the left you can just kind of outline
the tab so it's clear what's happening
and on the right you can see our user
tabbing through the About section the
reviews and the warranty so the code for
this is actually pretty simple sorry
about the black background next time I
do this I will put my code on a white
background hopefully you can read it but
we have a tab container that is using an
amp selector the selector contains three
groups of divs each group contains a
button and a tab content you can see on
the right how this would typically
layout in
in a HTML document which is not very tab
like however by adding just a bit of CSS
we're using flexbox here which we love
and use in a lot of our amps we can move
all the content blocks below all of the
divs the key here is hard to tell it's
highlighted but the order property of
the Flex blocks of the Flex box that
we're applying to the content div that
moves all of the content elements below
our tab elements here we're setting it
to four which is a number of options
plus one and that will move them all to
the end so it now looks like this which
is pretty close to the critical tab
interface now all we have to do is hide
all the elements and only show the
content area that is associated with the
selected button and tab selector is nice
enough to make that very easy for us
and selector wrong button sorry so here
we're setting all the contents to
display none by default except for if
it's the content block is immediately
follow or preceded by a selected button
amp selector when you tap on any option
inside of an amp selector it will add
the selected attribute to that element
so here by tapping on a button it adds a
slice of attribute which shows our
content for the correct tab and you can
use the same pattern for all types of
different interactions here simply by
swapping out the order of the Flex box
we have moved all the content areas
above the button the buttons in this
case are color swatches and the effect
is that when you tap on the color swatch
you can scroll through the content area
which is using an amp carousel to view
images of the product in that color and
you can tap the different colors and
view swipe through the images a very
common ecommerce experience all done
with no third-party JavaScript another
way to do this which is we're really
excited about is amp buying I'm not
going to spend too much time talking
about that because we're going to learn
more about it soon but with am fine you
could make this type of interface even
more powerful and that'll be really mean
so now we've got a really cool color
selector but what happens if the user
orders the product is out of stock now
we wanted to have a very prominent error
message that the user had to dismiss
before continuing and again it wasn't
readily apparent how to create this an
amp so we thought we'd share here you
can see the effect where when the user
tries to order a blue tricycle the not
playing oh there we go the error message
is displayed
so the way this works is we're using amp
form and with each amp form you get two
templates you can work with based on the
response of when the phone is submitted
here we're using a success template to
continue and an air template to display
an error message if the product out of
stock our air template contains a full
screen disc which is followed by a full
screen label which is invisible but will
receive all the clicks on the screen the
label is associated with a check box
which immediately precedes our full
screen div and then we have some CSS
that will hide the full screen div when
the checkbox is checked the effect is
that by tapping anywhere on the screen
you tap the label which checks the check
box which in highest a div this is a
fairly common hack it's called the check
box CSS hack and here we're using it to
dismiss a modal when it is displayed
again you can see it here when the image
is displayed they can tap anywhere on
the screen and dismiss the error message
again thanks to improvements in amp we
could have achieved the same thing using
the form the forms on attribute
listening for submit success event and
then displaying an amp lightbox we were
doing max we would not need to use the
check box CSS hack but there's still
lots of applications to use the check
box CSS hacked in fact we could have
done the tabbed interface with the same
instead of using amp selector using the
check box gives effect so next we'll
dive into is a review mechanism reviews
are very popular online you might have
reviews just to increase user engagement
because people like to load on things or
determine which image is the most
popular here we're using reviews to
ooh or voting to determine if a review
is helpful here you can see when the
user taps on the thumbs up icon it will
update the form give them a new count
and give them an indication that their
boat would successfully cast it looks
pretty simple but there's a fair amount
going on here we're using amp lists to
pre populate the form and bliss
downloads from JSON which includes the
number of votes for and against the
review that gives us our initial state
our thumbs up icon is a label which is
associated with a radio button when you
tap from a label it check the radio
button and both of those two are nested
inside a button which seems a little
weird but we've tested this and it works
in all major browsers the effect is that
when you tap on the label it checks the
checkbox that event then bubbles up and
clicks the button which submits the form
so it's one tap you're completing all of
this the form then post to the server
cast your vote the server responds with
a success message and the form updates
showing a success template which is
absolutely positioned over the original
form so that the user can't vote again
and they get an indication that their
vote was cast and they see the number of
votes update group can see it again when
they tap on the thumbs up it checks the
radio button
oops got ahead of myself sorry let me
tap on the thumbs up it checks the radio
button bubbles up click submit button
submits the form and then we have an
updated success template
again thanks to improvements in amp we
could have achieved this without nesting
a radio button inside a button by using
the radio buttons on attribute to listen
for a change event and then submit the
form to accomplish the same thing these
types of interactions are constantly
getting easier and easier now next one
we want to talk about is actually
building a payment system inside of amp
a checkout system for getting a little
bit ahead of ourselves here this one
won't actually work until chrome 57 is
released but that should be in the next
week or two so it's pretty close we have
this under development now and are
really excited to launch it this is
using the browser's new payment request
API from an amp page to allow a user to
checkout directly from the amp page
here again we're using a form and inside
the form we have a submit success
template and the template contains an
iframe which downloads documents that
contains the JavaScript which runs the
payment request API important note here
is this only works if the allow payment
request attribute is on the iframe and
amp is now allowing that so that's valid
amp however if the this amp document is
inside another iframe as in Google
search Google search as we just
discussed during the panel or was
discussed during the panel will load
amps inside of Google using an iframe
that iframe inside Google also needs to
have the allow payment request attribute
and Google has committed to adding this
and it will be rolled out soon so soon
this wall will work well so one thing
you can't do with amp is use the
templates the success templates or the
error templates to change the source of
an iframe so we cannot pass a user ID or
the order quantity or color or items
like that through the query string so
instead we have to keep track of the
user through a cookie the way this works
is when the user clicks the Buy button
that posts the order information to the
server the server stores it returns a
200 response message that contains a
cookie the cookie stored on the phone
when the amp framework sees the success
message it renders the success template
the success template contains the iframe
when the iframe makes every its request
to the server the cookies present so the
server can recognize the user and
display the proper payment request
information here we see the user go from
ordering one red trike to ordering two
pink trikes and the payment request API
correctly reflects the users order
information now we're really excited
about this because like I mentioned
we've built a lot of e-commerce stamps
we've seen excellent conversion rate
analytics and it'll be really
interesting to see when you combine a
super frictionless easy checkout that's
possible from Google search what the
conversion rate looks like it removes
all extra steps it's one page from
search that allows a configuration and a
purchase and we're really excited to
launch this and see what happens now I
will hand it over to Sebastian
medicine showed us some really weird
hacks that already worked from the real
world and I decided to to look a bit bit
into the future and see what is what is
really possible if you push the
framework and so I thought when I was
preparing this for like what is the
craziest thing you could try to
implement an app and you see the demo
earlier that I decided to create a
messaging app in amp and I said myself
three goals so the first one if should
have a working live method stream you
should be able to send and receive
messages the second one it should have a
dynamic your I that means like whenever
you click on something you shouldn't
have a full page reload and instead the
UI should be snappy and responsive the
third thing I wanted to accomplish is
that it should be a really engaging
experience so it'd be a proper PWA
you should be able to install it to your
home screen and even support push
notifications cause the messaging and
apart from that I set myself one rule
now I press like they are kind of the
duct tape of amp
and whenever some not supported the ant
is usually just use an iframe here I
don't want to use any items at all so
let's start with with the live messaging
stream and so what we need is something
that updates the amp like wallet in real
time and an amp there's only one
component that is capable of doing that
and it's the the em live list component
and the end life list component is
usually meant for like news articles
which describe an ongoing event and
editors can post additional updates to
the item to the article and what usually
works is that whenever there is an
update a button appears you press it to
refresh the article and this is not
really how you would expect
to have to work because you expect
method to automatically appear and
that's also possible with with life list
and how it works is like you have an
existing item and if it changes you can
update its timestamp and it will update
its content so this is something we can
use for building a messaging app app so
the basic structure of the hour stream
is we have the lysis in centralized
service we have a list of messages which
are rendered on the server then we have
an an amp form which we use to compose
messages and send it via an xhr request
to to the server now this works quite
well however this one problem that is
like the way whole and lifeless works is
that it pulls the server for you change
and the minimum interval you can fall
into 15 seconds so this means when I'm
sending a message I have to wait 15
seconds until it appears in my message
stream which is not really acceptable so
I try to improve this and it's actually
quite easy if you're using amp form and
their dearest use the informed
capability to render a response inside
the document so at first we have our
server-side render list of messages then
we compose a message and send it and
then render the result the updated
message list inside the amp form form
success block and at the same time we
have to make sure that we don't show
like both versions of a message stream
at the same time so we hide the Nate
initial version of the messages so that
works quite well so now we can send and
receive messages and when I send a
message
the results are instantly RPM the stream
over there's one problem and so you
start carefully crafting a new message
but when it takes you longer than 15
seconds and a new message comes in in
between the end lysis will
date and replace the form so it's going
to delete the content of your text
import while you're typing which is a
very frustrating experience I can tell
you so I try to fix it as well and this
was a little bit harder and it starts
getting a bit a little bit dirty now so
I decided to introduce a second form
outsider and largest and the form will
be submitted it sends a message to the
back end but it doesn't render any
response instead we use an forms
capability to listen for the submit
success to access event when this is
fired we trigger the other form to
submit which is embedded in the life
IFFT and this does nothing except
pulling in the new messages I call it
the the cascading amp form submit era it
probably shouldn't use it but ever and
now we have a fully functioning
messaging stream and app and like yeah
before you start looking we at me and
laughing there's one thing you should
consider about this so we have a working
messaging stream implemented with zero
lines of code and this is a really good
thing because like no code like the less
code you are the less likely to create
any bugs on your application and I think
this is a really interesting thing
aspect of amp that that you can try to
create quite complex atoms and
interactions just by creatively combined
combining the existing app components
now let's go onto to the second bit
creating a dynamic UI and here it's like
I'm fine it's really helping you and I'm
really looking forward to using it more
and you see here at the sample so we
have two pages we have some chat list
and we have a chat detail page and we
see we've got quite a few animations so
we have got a slide in effect the Campos
field appears on the bottom the floating
action button dropped in the title
change so a lot of things are going on
in this app and it's actually quite easy
to implement this using the new Empire
features so the wait-wait-wait works is
we have two pages within the same
document and so the first one is the
chances and is initially shown and then
we bind the class of the the its class
to a global stay in this case a viral
called active chat which contains an
identifier for the active chat or minus
one is no chat is active and depending
on its value it's going to add the show
or hide chat as class and the same we do
the same for for the the chat page and
here again we recheck for a specific
check and the trick is the way you
implement the button to to the switch
tube ship they use the clear in action
so to change the stage of the specific
chat and this will trigger the changes
in the class
when you press on the button and then
again we are using the normal CSS
animations to perform the actual
transition between the two pages in our
application so that looks quite well and
now let's go to to to the last bit so
creating an engaging PWA
and the first thing i wanted to do is to
support adding our messaging app to the
home screen and you know that on Chrome
Android you've got this built-in feature
to add so you get a dialog asking you
whether you want to add the flash
Nigerian home screen and there are two
things you need to do in order to
actually they're free first of all your
patron you just need to be so free HTTP
the second thing you need to do is
provide them an app manager
which describes the name of the
application I can start real things like
that so this is fairly trivial to add
and the second one is adding a service
worker and an ambulance and install sort
of a component which you can use to
install service worker from your amp and
this even works for cached versions so
it's the am slowed from the cache it's
going to install the service worker for
you on the moon which is really powerful
and we use a member the service worker
to to cache page requests so you can
even use the app when you're when you're
offline but now that we've got a service
worker in place we can also add an
additional speech and this is push
notifications the very push web push
notifications work are you need first of
all service worker and the service
worker needs to run in the background so
when your page is not active so that it
can listen to incoming notifications and
then show a system notification this is
your problem as we am support service
worker but the second thing is a little
bit harder so you need a little bit of
client-side code in order to ask the
user to an for the permission to send
push notifications and this is currently
not supported by them and so if you see
in the demo so this is the bottom of the
button at the top so when you press it
dialog appears which asks you to give
the AB the permission to send
notification and this is only not
supportable however there's a workaround
we can use here and it's it's quite a
simple trick use the service worker
which once in the background and you can
use it to intercept page requests and we
do this so every time you request in
your page we're going to take we want to
fetch this page and then pass the
response
and add a tiny bit of JavaScript through
the document that we need to enable the
push notification so the interesting bit
of this is let let's make your amp
invalid but that's not really a problem
because if your amp circuit we own and
cash and anti just don't support
serviceworker so these caches will never
see the invalid version of your amp so
it's really just a progressive
enhancement for your amp if they are
served from your own domain I mean you
have to be a little bit careful with it
that you doesn't break with the amp
constraints for example embolized on
knowing where everything is placed so
you shouldn't like introduce objects
which change the layout so you should be
careful doing about that but apart from
that that's definitely something you you
can do and if you have this in place
it's actually quite easy to you get a
really great experience so here's what
it looks like on your home screen you
get system notification and then it
launches your app from the home screen
directly into the chapter and I think
this is already using the new improved
at home screen feature which it has been
recently introduced as an experiment and
in Chrome and I think it's a really
fantastic integration so as we know
Revere what we've done to probably
actually accomplish to create a proper
messaging app we have the live message
stream there are a few quirks are not
too happy more about but apart from that
like the basic basic functionality is
definite there we have a dynamic
responsive UI and it's a fully capable
PWA
which includes push notifications so I
think it's definitely a great example
for what is possible if you're using app
however I'm not telling you now that you
should build your next messaging app and
amp we definitely shouldn't do this
because
still like it's a restrictive formant
however what I really want to show with
this is that it and it's a lot more
capable as you might imagine if your if
your greatest in the way how you combine
the existing and components so that's my
sample and I hope you'll find a few more
creative ways to build
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>