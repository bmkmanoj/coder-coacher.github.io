<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>From AMP to PWA: Progressive Web AMPs (Google I/O '17) | Coder Coacher - Coaching Coders</title><meta content="From AMP to PWA: Progressive Web AMPs (Google I/O '17) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-AMP-Channel/">The AMP Channel</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>From AMP to PWA: Progressive Web AMPs (Google I/O '17)</b></h2><h5 class="post__date">2017-05-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/xF6mjl-wOqU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey good morning everybody
good to see y'all here and on the
livestream
good morning around the world if you're
joining in welcome my name is Paul Vikas
I'm a developer advocate working on
making the web faster and use them up
user friendly and currently with my
focus on accelerated mobile pages em and
I'm here to tell you about a combination
made in heaven as I would call it and
what I'm talk about is the combination
of amp and progressive web apps now M
makes the first hop blazing fast if
you've experienced it before you know
that it's usually the case but in
progressive web apps enable amazing
reliability and engagement that you will
only see from a native world but that's
just on the surface so on the surface a
combination kind of makes sense but then
we had to start from the beginning
because once a once out of time the
story starts with a web modern day web
developer in 2017 with a growing
impostor syndrome and the feeling of
drowning and so in 1999 if you created a
web page what you did is you created
some HTML markup we added some CSS and
you hit the publish button you had some
really cheap server there was no slash
dot or anything to have to slash dot
effect so video was a pretty good and I
felt like I could do anything I felt
like oh yeah it was amazing
I'm connected to so many people around
the world and it's a free entry for the
one but now let's look at 2017 so you
could mark up the add some CSS then
someone tells you to debit use a bill
tool and make sure you choose the right
one yeah at Basel webpack and obviously
react because I heard Millennials like
react and then so many other things that
you have to do to actually be
competitive in today's landscape and
then so yes being a modern web day web
developer is hard but in fact if you're
looking at it from a company angle you
know what does your company let's say
your publisher
what is your company trying to
accomplish and what do they need to do
now you go one level up and you see it
gets even worse because you have a
number of different deploy targets the
mobile web the desktop web native
Android native iOS instant articles
Apple news and so on so there's a number
of growing ecosystems that you need to
support and now I'm here to tell you add
two more to the roster and you're like
oh no so yes I get it I get it but hear
me out so let's take a summa world view
a bird's-eye view until what we're
actually trying to do now if we look at
an e-commerce case what we're actually
trying to do regardless of technology
I'll take a guess
you want to sell stuff you want to sell
lots of stuff to sell stuff you need to
bring your product landing pages to lots
and lots of places where they're seen by
millions of people and landing on your
brows and product pages should be
effortless and instant and finally the
payment process should be effortless and
simple as well
the user should automatically be
inclined to come back and buy more of a
time to reengagement that's the kind of
experience I want I want to start tasks
and then stay fast so why does amsoft
part of this problem well I'm just going
to recap briefly why I'm mad at here so
think about your apartment key would you
give you a cop apartment key to all of
these people ah well that's usually does
use you one or two let's say you sure
could turn into an epic house party
however that's really optimistic I think
this scenario is way more likely however
on the web there's a I'm going challenge
of having a lot of monetization and user
acquisition methods in play versus the
user experience and this happened
because we're giving the keys to
everyone we're giving the keys to
everyone
for everyone to our web pages so as soon
as we add a script from a third party to
a web page or better off all right if
you if you don't trust that you can't
trust that source they could do whatever
they want on your web page it is really
like giving a key to a stranger and so
what we get because that is loading
pages non-responsive content content
does shifting around that is really
really not really great to experience
and we just had that some girl skip this
now the current situation is pretty bad
we have over 200 server requests per
mobile web page on average and 19
seconds is the average mobile load page
time over 3G now out of those 19 seconds
77% of all mobile sites take longer than
10 seconds to load but I'm worried it
gets worse
in fact if you look at that 10 socket
number in particular it's really
important because at 100 milliseconds an
interaction force on clicking a button
feels instant one second it still feels
natural
you still have your context model and
but then at 10 seconds you lost the
users attention yes that has been
measured multiple times before the fact
that after 10 seconds if you load a
mobile page almost all users drop off
now if you've been listening to the
previous that yes that means 77 percent
of all pages likely never seen on mobile
so that's why we created amp to actually
combat this problem to bring back the
beauty of the mobile web so we have
three components in amp the amp HTML
which is a superset and subset of HTML
but adds new components that also
restrict some of the things that you can
do then we have MJ as the powers those
things and then we have the amp caches
now just two quick examples what amp
does a few of the things it does for
instance it can prioritize content
loading so it knows exactly where
everything is rendered on the page
before all the external assets are
loaded so that we can pre
Renda be above the fold and not render
anything else below the fold and the
caches can then use that the platform
that uses the caches to deliver your am
pages can use that to smartly pre-render
quite a set of pages so the arriving for
instance on the on Google search and you
get the top stories carousel which is
powered by amp some of those links are
often pre-rendered before you click on
them which is why they feel so instant
and I would go back to one step and look
at this come present mellitus before of
1999 versus 2017 how does this look like
in M let's have a look yeah I think it
looks way better in fact that's what you
do you create HTML markup because we
have high-level components like
accordions and also the things in the
HTML markup you never write JavaScript
so you create HTML markup you add some
CSS out of it you get a fairly nice
responsive interactive content page if
you want to and then you just hit
publish and it can be read on a really
cheap server because the caching
infrastructure on top automatically
cause and caches all of your content to
be displayed in the apps so you get back
to a really really cheap deployment
model
so why progressive web apps well they're
engaging they give you push
notifications and homescreen stickiness
and they're also reliable they give you
a line access and responsive UI and
those are the things that you know
usually from the native world of things
and that's a common reason why
developers build native apps but in fact
80% of the time is spent in the top 3
native apps on the phone and this zero
number of apps that get installed on
average per month so that means that
it's very very expensive for instance to
advertising to acquire new users through
the app store model and so what we want
essentially is a combination of those
things we want the capabilities of the
native app ecosystem but we also want
the reach of the mobile web
and we get that with progressive web
apps because they have many of those
features built in and they're also
basically a website so it's a pretty
good way to get both of those six so why
is the combination of those two a good
idea they seemingly seem to attack
different spaces on a different level
well if you just feel the progressive
web app then you have the challenge that
your first load is still going business
long and the reason is that progressive
web apps are really dependent on a
technology called serviceworker
a client-side proxy that accelerates and
caches the delivery of your app shell of
articles etc but the serviceworker only
kicks in after the second request so on
the first load you don't get those
performance benefits and usually it's
the first impression that counts if you
want to get a new user button on the amp
side of things
you get no user off of JavaScript so we
don't allow you to write user of a
JavaScript except in an iframe x'
there's no custom service worker and no
push notification no web app manifest
when served from the app cache on your
origin that's it works but when served
on the amp cache you don't get all of
those benefits and so that is in order
to be predictably fast so the difference
really on the inside you get reliable
instant delivery and optimized discovery
but no JavaScript static content mostly
but in on the progressive web app side
the first delivery is usually slower
it's not it's easily embedded as some
documents I'll talk about this later but
you get access to the latest Web API so
you can do whatever you want and it
supports much more dynamic content even
and to combine those two is what we call
start fast stay fast and now of course
you can forget all of that and simply
focus on the fact that the combo makes
for some mesmerizing led animations and
if you've been doing web animation so if
you've been doing web development in the
90s and early 2000s I think this one
might work even better for you wait for
it mmm
yeah okay okay let's not go there
um but how do you actually do it how do
you actually get there when we have
three application patterns that make it
happen first I call em s progressive web
app second M to PW a and a third amp in
PW a now if you've been listening and
I've been comparing the two you're like
wait M s PWA we have actually four sites
that have static content mostly and
don't have a lot of interactivity you
can have an amp that is both a
progressive web app in fact my net who
is the one of the leading publishers in
Turkey has done that with their pages so
what you see here is a fully compatible
M page all this is amp with a full
navigation concept back and forth
carousel whatever
all of it is amp and it also has
progressive web app features so it can
be installed to the home screen has a
web app manifest and so on in fact just
by doing that they saw tremendous uptick
and quite a few numbers they got over
25% higher revenue for article page for
you that is really the important number
because that means the bottom line is
better and four times faster average
page load speed over 40% longer average
time on site over 30% more page views
possession and much lower bound slaves
so in the end really something
worthwhile to do but you can actually go
further than that with our pattern you
could actually because you have to
service work in place on your origin you
can insert anything into the amp page
that you want random stuff that amp
doesn't like because you are in control
as soon as the serviceworker is running
now I had some nostalgic nostalgia so I
thought why not insert some 90s the HTML
magic into the amp website and I found
this amazing mouse cursor and this is
exactly what I did so here we go I'm
going to enable the serviceworker I'm
going to reload and yes I have a fancy
mouse cursor and animated backgrounds
all the things that amp doesn't like and
first of all what have I done
ah so you shouldn't do exactly that
maybe but this pattern still comes in
useful if you want to insert ad set up
for instance not supported in the eco
system yet or other things that you need
on your origin to run so next is m2
progressive web app now all of this
space is based on the technology on a
component that we call em install
serviceworker and the amp install
serviceworker the way if you've used to
have to work it before you register it
in JavaScript on your page and because
you don't have access to JavaScript we
have an equivalent that is amp installed
serviceworker but the cool thing is that
this component also works when your
pages loaded on the amp cache let's say
in the top stores carosone google it can
install the serviceworker from your
site's origin from your own domain so
that subsequent clicks are accelerated
and the way this looks is the pattern is
always the same the user discovers
content the serviceworker installed in
the background while the user is
consuming the content and then the user
is upgraded instantly to a PWA let's
let's have a look at how this looks in
real world production examples so first
let's look at crossing our king which is
a job search site similar to linkedin in
all over europe and so the if the user
discovers content they check out a job
that they like they click on it and then
the service worker installs in the
background and now if they're actually
interested in one of those jobs they're
instantly forward to the progressive web
app that can add push notifications can
remind them to come back if their job is
not available anymore
etc so the next click is going to be
instant now next example with Goethe
boom which is a leading travel search
company in India you get the same
pattern in a completely different
vertical user discovers content second
page the service worker installs in the
background now this page is a page that
just shows you show to the hotel
but now there's a get availability
button at the bottom if you click that
button again you instantly redirect it
to the progressive web app that allows
you to check the availability if we
could have even checked in advance in
the serviceworker if there's
availability so that even the API call
wouldn't be necessary anymore
and then Rakuten Japanese recipe website
there that I've created recently it's
called Rakuten err recipe and in this
case same pattern the user discovers the
content arrives on a recipe side and so
you browse through the recipe you
realize okay there's a couple of
connected recipes that I like even more
or I want to bookmark this and then the
user is instantly upgraded to your
progressive web app now with racket and
in particular I have some stats to share
in fact if you look at the different
combination of things they've done it's
quite impressive in my plane so with amp
they've seen over 50% more time spent
per user over three that six times
higher CTR within the amp page compared
to other records and recipe actually is
not to other crackling recipe sites and
then with add to homescreen with a
progressive web app feature the seeing
over 70% more visit per unique user and
over three times more page views per
unique user once that install to the
home screen and push notifications the
same thing a lot more reengagement three
times more weekly sessions per user
after the first puke week four times
after second week and five times up the
first month and now this is really
important with push notifications they
get 3/4 so seventy-five percent lower
bounces for those users coming in by a
push notifications then by a sorcerer
shares so they're seeing much more
reengagement through that channel ok so
this sounds hopefully pretty good but
they're still a problem now if you copy
the URL and the progressive web app you
share or send it to a friend then that
friend will not go through the m2m it's
all serviceworker flow so they will open
the progressive web app without a warm
cache
now what do we do with this well usually
you would have amp pages deployed on one
subdomain and you have the progressive
web app deployed on others of the men
and a link from an amp page leads to the
progressive web app sounds pretty
straightforward however you can change
that and reuse the same domain the same
URL space for both of these and you can
do that because the service worker can
intercept navigation requests so if you
click a link the service worker can say
okay no I'm not going to give you the
next n page I'm just going to give you
the progressive web app instead even
though you're on the same domain and
it's actually just a few lines of code
to do that so you check for navigation
requests respond with a progressive web
app now what happens if we do this a
couple of magical things because without
the Service Worker we still just get em
so for browsers that don't support it
you always get a fast experience and
then with serviceworker you get the
combination of em in the background and
the progressive web app because the
serviceworker intercepts and delivers
the progressive web app instead and if
you don't have a serviceworker and you
still want people to lead to a richer
experience a progressive web app that
might not work fully because there's no
serviceworker and some browsers you can
still do that with a technology that we
call shell or rewriting that's part of
amp install serviceworker basically what
this does is it says detective
serviceworker is available in this
browser if it's not rewrite the urls on
this site to go to a fallback domain now
okay we have this complete but now we
have another problem we still have this
problem with our deploy targets we still
have plenty of deployed our targets in
fact in this case we probably have to
content seconds we have amp HTML on one
side and then probably JSON or some
other content back-end for the
progressive web are the powers to
progressive web app now that is where
the final pattern comes in handy and in
progressive web apps
in fact em pages aren't just web pages
they're ultraportable embeddable content
units I can stand on their own and if
you think about it this way if you don't
think about it just as a website some
magic things can happen because we can
get from this step to this step we're an
HTML powers all of my experiences in
this case the amp experience and the
progressive web app experience now one
way to do this is to build an
application show and then use an iframe
but iframes are slow and what we do
instead because we trust the content is
our own content we use shadow Dom so how
does it look like without shadow Dom to
get one window for every iframe that I
initialize infinite number of my pre
instance and then an infinite number of
documents so lots of overhead to
initialize the amp library over and over
and over again for every iframe but then
with shadow Dom you just have one window
one library instance that we call a
shadow amp in the top of the page and it
simply connects to lots of documents and
renders them out so that's a much
cleaner flow and in practice the PWA
hijacks navigation clicks fetches the
requested and Page puts the content into
that shadow root and then calls it a
shadow Dom but this was a slide that
showed it just very briefly I actually
want to show it a little bit more in
detail because we have a little bit more
time today in fact I think you can do
this in an hour
this flow of inserting content via the
shadow Dom if you already have amp pages
I think you can do an hour now you don't
believe me do it in five minutes okay
all right so the first thing that we
want to do is and this is a caveat we
want to have a content source somewhere
that serves as the navigation so in this
case we need to have an overview page
from somewhere that has a bunch of links
a bunch of images maybe in this case I
just used YQL
to fetch an RSS feed from somewhere
which is a really nice hack to create a
compelling demo I would say and this
gives me a nice list of articles that I
can use and I use the Guardian as a
back-end thanks again for the Guardian
for letting me use their RSS feeds and
so as you can see this is what I have so
far so this is just using the RSS feeds
to YQL and so far so good mmm
and and this again this step is not so
hard to do so I I shouldn't be saying
this but I started on Monday and so next
one we at the amp shadow library to the
head of the page in our progressive web
app now again this is a special version
of amp and then we wait on the amp is
loaded which is using this technique
that you find a lot of frameworks
nowadays so this is just a wrapper that
the code inside the wrapper runs as soon
amp is actually fully loaded and then
when you have that you fetch the amp
dock via xml httprequest and now again
straightforward you know the link from
the previous navigation you know the
link to the full article you fetch it by
an excellent a HTTP request and then you
return something it'll call response XML
now response XML contains are ready to
use document objects are not that
well-known feature of XML HP breast and
I'm not using fetch here because fetch
doesn't support this yet this is why I'm
using old-school XML HTTP requests so
now we have our actual document our amp
document it's not rendered anywhere yet
but now it's step 5 we rendered using
shadow amp so what we do is we create a
shadow root what this is what it means
it's just a fancy way of saying we
create a div by container and we we give
that div to call the shadow root now the
amp doc does all the magic the attached
shadow dot function does automatic so
give it the container that we just
created actually this should say shadow
root so that's just backslide
then we give the dock that we just
fetched via Ajax and we give it the
original Earl and then in this case we
can also have a function that notifies
us a promise when the page is ready and
rent it out now that's a basic flow but
there's a few things that make it even
better for instance if you don't need
certain things in the am page because
the M page usually has its own sidebar
its own navigation so it can stand alone
but if you don't need that stuff while
in embedded mode you can actually remove
those things before you give it to the
amp cello life 3 you just remove the
header remove the sidebar etc so this is
actual code from the demo but also cool
if you if you don't want to do something
as complex that's cool too because
there's a class that we add to the body
of the shadow am part of the embedded
page which means that you you can in
your CSS of your M page you can use the
dot and shadow page to simply hide
things that you don't want in em better
mode so that works as well and finally
if you don't want to remove things but
you want to insert things back in into
the am page features for instance like
Java Script highlighting or something
like that into the embed you can do that
as well by using shadow slots and they
provide a path for progressive
enhancement of amp docks when shown in
the publishers own context so how does
this look like in action let's have a
look here we go
so the content experience is now all
powered by M as soon as you click on one
of those links in the overview the amp
page renders and loads and because it's
everything in our control we have the
whole document available we can do some
really nifty transitions to animate the
windows to instead of a full page load
thank you
now finally let's wrap things up with a
progressive web app with a progressive
web amp sometimes I also call it plump
because I like the sound of it it's
always fast no matter what there's great
distribution built in its progressive
enhance it's really just one back-end to
rule them all and this les client
complexity fuel deploy targets and to
visualize this last point again you know
remember how we had this plenty of
destroy targets before in our previous
slide well in fact we're now down to
just three if we want to we have that
PWA shell the native shell and NATO zone
and iOS and those are just thin layers
that serve as the application shells
that provide a navigation model and
maybe some features on top but then amp
is the backend that runs it on the
content source all of those could use
amp as a content source and so you
support the web you support IO Android
and iOS at the same time with very thin
layers of extra code so finally a word
of caveat when do you actually do this
well you do this when you have a site
that has lots of static content for
instance so you don't want to do it if
you build the next tree mail because
it's it's really more like a like a
really dynamic app that doesn't have
landing pages what we call these pages
that are accessed via organic search or
social discovery so your site has to
have lots of static content to make try
to make sense and ideally you already
have a lot a large corpus of M papers
that already gets you through the first
step and it this works extremely handy
if your engineering resources are
constrained or to reduce infrastructure
complexity and finally you need to test
out if you haven't done amp before you
need to test out if your content
monetizing works fine within the amp
ecosystem so before I leave you and I
think I have some time to open room for
questions I'm going to leave this up for
a second so you can take some
screenshots so we have a react sample
app as well that's not the one that you
saw today but it it users react so it's
great for Millennials
so usually react sample apps to see how
how you do it in and react it has
similar nice transitions we just
launched the amp channel if you're not
sick of my face yet you can see it again
over there and AM projector org we just
published a big new guide about all of
these patterns I just talked about if
you want to recap all those things and
go through the tutorial so you can do
that now on ambrosia org with that I'm
going to open for questions they thank
you everyone</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>