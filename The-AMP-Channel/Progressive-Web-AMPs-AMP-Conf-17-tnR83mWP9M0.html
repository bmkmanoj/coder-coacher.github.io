<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Progressive Web AMPs (AMP Conf '17) | Coder Coacher - Coaching Coders</title><meta content="Progressive Web AMPs (AMP Conf '17) - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/The-AMP-Channel/">The AMP Channel</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Progressive Web AMPs (AMP Conf '17)</b></h2><h5 class="post__date">2017-03-28</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/tnR83mWP9M0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">good morning I'm Alex Russell I'm a
software engineer on the chrome team and
it's amazing to see this event because
back in 2011 and 2012 with Dimitri
glazkov an element's Komarovsky I helped
lead a team that did some I would say
kind of crazy we spend about some crazy
time thinking about what the future of
the web platform could look like we did
a bunch of prototypes we ripped apart
the tools and libraries that we had we
built a bunch of small applications to
see what the problems would be in a web
platform if we could use the tip of the
tree if we could actually just fast
forward to what everyone would have in
three years what were the what was still
left as problems and one of the things
that jumped out to us from this process
was that we didn't have a component
model we were missing a way to build
custom things integrated well with HTML
and to fast forward to today web
components are a thing and amp is the
most successful web component library in
the world which is astonishing so it's
it's incredible to see that there is a
diversity of web component libraries in
the world which is something that we had
sort of postulated might happen someday
in the future but also that amps really
interesting restriction on some content
has delivered these extraordinary
benefits to end-users at a moment when
it's really critical for users to get a
much faster level of experience you
heard a couple of talks ago that there
are some ads in many geographies where
the cost of the user to download the ad
outweighs the actual value to the
publisher of placing the event or
running the ad and to be an to the
advertiser and that is a terrible thing
that I see every day in traces so I am
an engineer on the chrome team and these
days I'm working on progressive Web Apps
part working with partners to try to
help them get there progressive web apps
launched and working on the new
technology around it and so I spend a
lot of my day looking at mobile web
sites I'm looking at web sites from
emerging markets on 3G networks and I
can tell you that amp is an incredible
leveler before the problems that were up
against so 2011 we start working on web
components ESX a bunch of new features
in the web platform
and then time happens and then in 2012
13 2014 we start looking at what's still
missing from the web and so what was
missing from the web was an application
model let's say we have a component
model right it's three to four years
later great we have we have a component
model life is good
right we've solved all of the problems
that the web ever had except that mobile
came in at our lunch we had one on the
desktop we had actually built a world
where we could spend most of our time
doing email in a browser we could do
most of our documents in our browser we
didn't actually have to leave the
browser to do very much except on mobile
we never really quite got there today
we're seeing that users spend between 12
and 13 percent of their time on a mobile
device inside of a browser of one form
or another there's a bit a little bit of
dark matter there we don't kind of know
what time is being spent in the sorts of
in-app browsers that you may see
commonly but we know that it's not
growing dramatically we don't know we
know that the time that users are
spending on the web on their mobile
devices is not growing dramatically and
that's sort of a problem whereas on
desktop we had seen a huge growth and
it's definitely more than 13 percent
today we're sort of static like so
what's missing right why is it that the
web is still a difficult thing to get
back to them for users and so we talk to
a lot of developers we looked at the
evidence of what people were doing we
again built some prototypes and we
realized that of course we're missing a
home screen presence right if you can't
be part of that tap and swipe ecosystem
for the user it's very difficult for
users to re-engage with your experience
and when we talk to publishers and we
talk to partners they frequently cite
that as a reason for building a native
app they want to be on the home screen
now users of course aren't going to put
every app on the home screen we know
that users have a fatigued around this
but what that means is that there's a
bit of a mismatch right publishers are
having to spend a lot of money to go
build a separate experience to go get
their brand on the home screen for a
subset of users who are extraordinarily
engaged but that's not all of their
users and in fact in many cases it's not
even a large proportion of their
universe it's often a vanishingly small
extraordinary profitable subset so
that's interesting and those users
really do
want to have the best experience of that
brand they want to be able to come back
to their habit their daily thing they
want to be able to get back to these
things they don't want to have to go
through the indirection of opening a
browser tapping something in waiting for
the autocomplete maybe the network isn't
working right that's that's terrible and
speaking of the network they also really
want reliable performance one of the big
differentiators that I don't think that
we spend enough time talking about on
the web between what native apps can
deliver and what the web has so far not
delivered has been that when I tap on an
application on my home screen I always
get something it always loads something
I don't get the offline asaurus that
never happens to me in a native
application there's no platform wide
expectation that things will fail just
because I happen to be on a different
network type that doesn't happen with
native apps so we need a way to give the
web reliable performance reliable
communication with the user about what's
going on from the application we can't
continue to have a situation where
everyone expects that things will be
slightly slow or that that might be
broken in some other time and then
lastly of course the brand-new surface
area that we didn't see coming is the
notification tray and as part of that
happens swipe ecosystem and the web has
been absent from so we need to fix it so
we added a bunch of this stuff and today
it's all sort of wrapped up inside of
that notion of a progressive web app so
it isn't one technology it's not like
ham it's not like that thing where we've
got a validator for it although there is
a new tool called lighthouse that you
should totally use if you're building
your progressive web app because it will
help you validate that you have met the
criteria that we would like for you to
hit but all of these things are
available all apart so you can build
like seeing I did a progressive web app
that will load offline and it can get
that add to homescreen prompt from the
browser if the user engages with it a
couple of times or for a couple of
minutes actually these days it can be on
the home screen they can tap it go to
this full screen experience and then
eventually just you know continue to tap
the swipe through this card base to UI
as you can see on the left we've got the
same experience loading inside of a tab
in the browser and then once it
relaunches from the home screen it acts
like an app it's a standalone activity
in the task switcher you
would be forgiven for thinking of it as
an application service workers provide a
fast reliable experience that makes it
possible for the developer of this
application to deliver that experience
fluidly every time at every moment
flipkart.com
the largest retailer in India has booked
an extraordinary progressed web app
which for my money is indistinguishable
from their native application and I
recommend you check it out
most adaptations are also one of these
one of these big deal things you can do
it ala carte so for instance whether
comm today isn't too progressive web app
you can't install this your home screen
it actually doesn't work that way but
you can add push notifications the same
thing is true of facebook.com today
facebook.com on desktop and mobile will
offer to give you push notifications
using an open standardized protocol that
we spent several years developing with
our friends and partners at Mozilla and
Microsoft and other folks and is now
available widely in browsers and so that
means that even if the developer hasn't
decided to make their experience act
like it can still re-engage users when
there is something important for them to
come back to and that's available to you
again ala carte these things all add up
to an app like experience but you can
have them piecemeal you don't have to
add the manifest file that gives you
that metadata for the icon you can just
have a serviceworker you don't have to
do push notifications to have a
progressive web app you don't have to
have offline capability to do push
notifications but when you get them all
when they all add up it does feel like
you've been transported to a new world
and that's all I think is worth thinking
about in terms of keeping those engaged
users who want who are already on your
site who have already come to your
experience keeping them more engaged
over time so does it work well we're
still looking as hard as we can to try
to understand whether or not it does
work but what we're seeing from a bunch
of partners is that the acquisition cost
for an engaged user on a progressive web
app is radically lower now most folks
that we talk to aren't willing or able
to share this sort of data with us but
the housing comm team built
exemplary progressive about which is
something that you should try out on
your Android phone and it dropped their
engaged user acquisition cost by 50 X
now this is a bit of an outlier it's a
little bit higher than some what we've
seen others like celeea which is to
start up in Europe working on a local
marketplace drop their user acquisition
cost by 10x so this is not this is not
unique necessarily it is just very large
but the numbers are eye-popping even if
it's only 10x right getting a user today
in a native application we've seen over
and over and over again is
extraordinarily expensive between native
app installation ads between the sorts
of in-house marketing that you have to
do to convince users on your website to
go through the application installation
flow the amount of friction that it's
involved there causes the distribution
of your native applications to be a very
expensive proposition and so when we
talk to many publishers it is
interesting to hear how they are
attacking that problem and the value of
progressive web apps is that you can
simply turn the application that the
user is already on into the application
that they can reengage with and you can
do that without a big upfront install
right so this is working pretty well in
the marketplace Flipkart saw 70% higher
conversions for the users that did do
the add to homescreen flow
Junia has nine times more conversions
for versus previously abandoned carts
Aliexpress one of the largest retailers
in the world
I saw a 74% increase in time spent
across all browsers not just the
browsers that support progressive web
app features natively for instance
Safari doesn't support most of this but
investing in your mobile web experience
your owned and operated web site and
adding the source of focus on reliable
performance that you need to get to
progress Web Apps does pay off
everywhere so this is great and this is
amazing for your website but it seems
like there's a bit of an infinite
mismatch if amp is about creating this
extraordinary experience for users when
they come through the side door when
they come through the Federated versions
of your content
and progress web apps are about creating
an extraordinary aplex perience for the
users who happen to be on your website
directly it seems like having instant
delivery and optimized discovery are in
direct competition with having advanced
platform features and having dynamic
content so can we solve this and we
bring these two things together right
this is what we want is for users to
have that extraordinary fast experience
of an amp document wherever they first
discover your brand and then when they
come to your site continue that journey
but have the upgraded version right amp
is constrained and has natural
constraints and there are constraints
about how amp is distributed that mean
that we'll never be able to do things
like push notifications directly from
amp documents we will not be able to ask
per se for that because it's served from
a different origin most of the time you
can of course serve amp content from
your origin but most users will
experience your amp content through a
viewer for instance the Google viewer in
search have we heard about in the last
talk so given that that's the case given
that that's from a different origin and
we can't for instance provide those
permissions to those users in that
instance is it possible then to just
keep the performance where we hand off
from the user who is engaged with our
content and the amp viewer and then when
they transition to being on their
website can we get to starting fast and
staying fast and yes of course there's
value in doing that because we all know
that faster is better this is data from
so asta from last year and what they
show of course is that bounce rates
really really really really really
matter
double-click did a study last year they
saw that users have much higher bounce
rates if they don't get to the content
in 3 seconds and that most seconds take
on mobile take 19 seconds to load so we
have a long long long long way to go amp
is an extraordinary way for us to help
the front part of that conversation with
the user who's coming through the side
door but then how do we fix this for our
sites what do we do about our pages so
there's a couple of complementary
approaches that I think we can
investigate
we have sort of played around with a
couple of things and I think Paul asked
me to give this talk because no good
deed goes unpunished and in 2015 I
prototyped away for amp and progressive
web to sort of work together but that's
not the only way that they can work
there's two approaches sort of called
amp up and amp down amp up is the
background bootstrapping of a
progressive web app shell while the user
is on the amp page we've seen a couple
of examples of that already and I want
to show you a few more today and amp
down describes reusing amp content
inside of a progressive web app so these
two things are possible we sort of
thought that they might work but we
started seeing them working together so
let's talk about amp down first
embedding amp as the source format for a
content inside of a progressive web app
so the way this roughly works is that
you build something like a shell a host
for your amp content now there are
several ways to do this you can do this
using an iframe you can use the shadow
Dom that's part of the web component
specification to do this but your
content inside of this shell which is
built-in whatever technology you want
that's running on your website so for
instance my comm is using react this
content is running inside of a shell
that provides a very fluid in site
navigation right you don't have to think
about transitioning between pages
because it's all Ajax Dan right you have
a stable UI nothing goes away you can
provide things like push notifications
which is that toggle on the upper right
and you can get to this today I've dated
my comm this is a great way to deliver
an experience which reuses the work that
you've already invested in amp because
once you've got ampion a PWA you have
this tension about like is amp just a
sort of a side format is it just an RSS
for my PWA or is this actually the
source format for all of my content and
what we see with the amp down pattern is
that this can be the source format for
all of your content resolving a bunch of
the ambiguity and the tension that you
may have felt about what you should do
right you get the benefits of that fast
content but you keep the responsiveness
and capabilities based on the progress
web app so
CNN espanol has been building an
experience exactly like this this is
what you gets you when you go to their
new site which is not yet launched but
you'll see it soon and I'm grateful to
be able to show it off today
it implements push notifications it
works on the home screen it's a light
fluid fast experience and when you go
there you can see both articles and
videos in a nice swipeable package it's
it's really really really well done and
when you tap into an article like that
first one there what you get is an amp
document that is a shell that has been
built an app shell which can always load
that app shell is something that the
progressive web app will even when the
network is flaky or your offline will
boot up with no matter what recreating
that experience that we sort of covet
from native applications where whenever
I tap on the home screen icon I always
get something and that's the experience
the progressive web apps can deliver an
CNN espanol has done it by hosting the
amp content in an iframe very much like
the ant viewer that you heard about in
the last talk CNN espanol has built
basically their website as an amp viewer
so this is a pretty good pretty good
pattern and what it does is it removes
the distinction between the URL perhaps
between the amp content and the
owned-and-operated content you don't
have to fight about what is your source
format is just the amp format so amp as
a way of keeping your own pages fast and
lightweight using the validator to
ensure that that's possible is a really
nice way and a really good pattern for
making this all happen well so there's a
variation of this which we sort of call
shell rewriting and Paul Backus does put
a lot of time into this and this is sort
of the amp down stable URL option and
the way to think about this is that the
progressive web app loads and then it
hijacks the navigations so you start
clicking on an article and instead of
reloading the entire page like you
normally would it fetches that content
in very much like the CNN espanol page
does it puts the content inside of a web
component shadow root which is a
can i frame except it's not actually
isolated as a separate document and you
can call the attached Shadow doc method
on the amp instance to ensure that your
content is actually shown so now we've
got a conflict because the content might
have its own navigation you might have a
camp menu you might have a bunch of
other CSS that would be fighting for
control over that top-level brandy and
navigation UI but there's a clever hack
here that you can do that Paul sort of
put together where you can use
conditional CSS on the shadowed amp
document to automatically hide stuff
like headers and the embedded content
that you don't want to display in this
other mode so the shadow slots allow you
to also add a bunch of interactivity
that you might not in a regular amp
document right one of the big advantages
of progressive web apps is that you can
do anything you can actually extend what
you thought the platform could do much
further and that means doing things like
VR and audio web audio and really
immersive experiences a Bluetooth like
you can make anything on the web these
days and what that means is that in
order to be able to access that you
really want to be able to do it on your
origin but maybe the same document
degrades gracefully when it's being
served someplace else
so using this sort of slot technique
where you wind up rewriting the content
a little bit in order to make sure that
when it's hosted you can load these
richer elements that you provide
dynamically but only when they're on
your own site you can use the shadow Dom
to ensure that you have a great place to
put this more dynamic content when it's
hosted on your origin versus when it's
being hosted on the amp CDN all right so
how does this work well this is the only
code I'll show basically you have an
effective end Handler and if you decide
that it's happening from your from your
amp shell then on your own origin and
you're navigating to it you can actually
send back initially the content of that
shell the progressive web app you can
send that back all the time every time
and then start downloading in that
initial fetch exactly what you want it
to get from the network so you can load
the shell immediately every single time
that you navigate to a URL that might
otherwise be an amp page once the
service workers installed the important
part about this pattern
is that it means that you don't have to
have two sets of URLs you don't have to
build a slash amp or an amp dot you can
just host everything at the same URL
users who don't have support for
progressive above technology like
service workers will just get the amp
document which for most users most the
time is a great experience that's
actually where we want to be we want to
give users a fast experience when they
can get it now the users you do have
this can get that upgraded thing they
can get the version of it that adds new
technology that we've just made
available in browsers alright let's talk
about the other pattern and warming up
the progressive web app so the
Washington Post demoed this last summer
there's a new amp element called ant
install serviceworker that you might not
be familiar with but the basic idea in
this pattern is that when the amp
document is viewed through the amp
viewer on a different order on a
different origin not your origin the amp
is all serviceworker element makes a
dynamic decision about whether or not
the document is actually from where you
thought it was whether or not the user
is engaged enough to go do this extra
work but if they decide that it is it
points at a bootstrap file that is on
your origin so for instance example.com
/pwa dot HTML and that bootstrap file
just installs the serviceworker this
element when it's loaded on your origin
also points at the serviceworker file
directly and installs it ins that in the
other case so it gives you a chance when
the user is reading the article on the
for instance the Google and viewer to
start getting your app installed so that
when they tap on the next link you
actually get an instant handoff you
never have to hit the network because
once the serviceworker is installed it
can handle that navigation you can get
that starting fast experience of the amp
viewer wherever that happens to be
ending you up at an extraordinarily
responsive next load so who's doing this
well the Washington Post did an
experiment and they turn it off so
they're not doing that anymore but it's
interestingly and I'm happy to talk
about this Forbes is doing this now so
if you google for something
for instance Forbes investments advice
and you click on any of the amp colored
links later in the page
and you'll get this in the end fewer
today's and fewer which is pretty great
it's a fast experience and if you scroll
down far enough in the page the amp is
all serviceworker element will do
roughly what you expected it to do and
when you tap on one of these links that
for instance the training on Forbes
links this will take you to their new
progressive web app and that new
progressive web app has a great tap Abul
swipeable card based experience but it
installs extraordinarily quickly in the
background and if you engage with it
enough what you'll get is the Add to
Home screen so now we've gone from a
fast experience hosted by the amp viewer
to a navigation out to your own site
without potentially ever hitting the
network it can be extraordinarily quick
it can stay instant the whole time and
then when the user engages enough it can
transition into being an application for
the user in fact they can live on the
home screen along with all of your other
progressive web apps and when you launch
it you'll get a custom splash screen
just like all of your other applications
and now it's running full screen so this
is an experience that has been upgraded
out of the tab and into the app world so
now we're part of the touch and swipe
ecosystem without losing the user at any
step in that in that flow so does it
work well we heard yesterday from we go
and Hani's talk was amazing that we go
is there progressive web app is doing
exactly this sort of handoff and the
data that they showed was amazing a
couple of seconds to load the
progressive web app for a new user but
if the user gets to that content from
the app cache it loads in less than a
second to start with and if they do the
handoff and they've installed the
serviceworker you're again less than a
second you stay under that one second
threshold which is today on the web but
almost impossible to do the RTT time the
3G networks make it almost impossible
for us to do anything in under a second
if we're waiting on the network right
that flash of white that dreaded flash
of white where you tap on a link you're
just sitting there waiting that goes
away when you implement a pattern like
this because the user has gone to Google
and Google has started to pre cache all
that AM content from your origin and
then you started pre cached the PWA
content for your origin
the amp content and so you know the the
data that we Co is showing us is
incredible organic visits up 12 percent
searches of 26 percent conversions up 39
percent and visits conversions up even
more so this is a pattern that you can
deploy today it works it's not black
magic
the anti-stall serviceworker element
works well if you're implementing a
progressive web app it's easy to do if
you also happen to have amp content and
if you're building from scratch thinking
about amp as a source format as a way
for you to reuse the effort that you've
put into building great amp content to
host it inside of your progressive web
app is also just as possible people are
succeeding with it and you can do it
today anyway thank you so much and I'll
be around if you got questions later</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>