<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>MongoDB Tutorial 4 Map Reduce Finalize Group | Coder Coacher - Coaching Coders</title><meta content="MongoDB Tutorial 4 Map Reduce Finalize Group - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Derek-Banas/">Derek Banas</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>MongoDB Tutorial 4 Map Reduce Finalize Group</b></h2><h5 class="post__date">2015-12-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/5B7mJtiwbMg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello internet and welcome to part 4 of
my MongoDB tutorial because of numerous
requests in this video I'm going to
focus completely on how to use MapReduce
with MongoDB now MapReduce basically
just allows you to split a large problem
into many smaller parts and this
tutorial going to teach everything by
providing numerous different examples so
I have a lot to do so let's get into it
ok so here I have my terminal or if
you're on Windows your command prompt
and I'm just going to start off the
MongoDB server and then in another tab
I'm going to open up the Mongo shell and
here we are and let's get going so I'm
gonna use my test database which is now
empty and what I want to do here first
off is provide some just straightforward
examples on how to use map and reduce
with straight JavaScript now quite
simply map is going to accept data and
then transform it into key value pairs
by applying multiple different
JavaScript functions while reduce is
going to accept key value pairs and
reduce them into a smaller aggregation
of key value pairs so let's just use an
example here this is just a simple
JavaScript right here what we're using
first and I'm gonna keep it simple so
I'm not gonna get into complicated
things until a little bit later in the
tutorial what I have here is just simply
an array of different JavaScript objects
and what I'm going to do is provide
information on all of these different
objects and print them out the screen so
I'm gonna show you the non map way of
doing it and then the map way of doing
it just understand that this is going to
be simple here in the very beginning so
I'm just gonna create an another array
of student names and what this is going
to do is take the objects that I have in
my students array and then push them
into this other stud names array and
this is how you would do it if you
weren't using map so I'm just going to
create a simple for loop and we're going
to say that we want to continue cycling
through all of this data as long as we
have students to work with and then
we'll go student names and push on each
of those individual students or push on
their name part of the student object
and then close that off all right so we
have that all set up now we could just
simply come in here and
student names like this and you could
see all of those get printed out to the
screen now let's see how we would do
that using map then of course all of the
code that you see here is available in a
link in the description now with map
what we can do is go variable student
info equal to students and I will use
map and what this is going to do is
cycle the values through a callback
function in that function
there's gonna be this guy right here
just call that X and then we can come in
here and go return X name plus is in
plus X class and then close off that
function like this and now we can come
in and go student info and we could have
just printed out the students names but
we decided to do something a little bit
more complicated I must add a little bit
of a bug here in the object that I
created so just ignore that but as you
can see we just went through the student
object array and pulled all that
information out and you can see
basically how map works by just calling
this callback function over and over
again for each item in the array so
that's just the basics of using map
inside of JavaScript now let's take a
look at reduce using just basic
JavaScript so again we're going to be
creating a whole bunch of score objects
in the array called tests and what
reduce is going to do is receive an
object and a starting object that we're
going to be iterating through what we're
gonna do here is sum all of the values
that we have inside of this array and
then output that information so this is
how that would be done inside of just
plain old JavaScript so we'll go to
tests and we'll call reduce and here is
our function sum is going to be our
final value that we're going to be using
and tests is going to be the thing that
we're going to be iterating through then
we can quite simply go return some plus
tests and score and then we can close
that off this is going to be our
starting value right here and then we
can just come in and go test some and
you can see that it goes and takes all
those different values and sums them
together and outputs the final
information so that's just a very basic
look at using map and reduce using
regular JavaScript now let's jump over
in the MongoDB and show you exactly how
we would use it inside of MongoDB what I
want to do here first
is I'm in my
Stevi database and I want to delete
everything that's inside of this so I'm
gonna call drop database don't know if
there's any I guess there was some stuff
in there okay so that's all clear and
I'm going to add some classes to our
collection here so I'm gonna go classes
and insert must be kind of a little bit
of a review of creating documents in
MongoDB so philosophy 101 is going to be
the name of my class and it's going to
have a start date and we'll go a new
date I'll say it starts on 2016 10 we're
going to have a list of current students
that we have currently signed up for the
class and we'll have first-name lastname
and then finally age close that off put
a couple more in here and close off that
array of students will say it cost
sixteen hundred dollars to take the
class we'll have a professor and Paul
slugman topics we'll be covering some
information on the book that we'll be
using
book title price for our book close off
that document and then even put all that
information now we'll go and get a whole
bunch more and there you can see I added
a whole bunch of other additional
classes inside of here so we also have
astronomy we have geology all in the
same exact format biology chemistry and
so forth so like I said if you want to
get a hold of those you can either pause
the screen and just throw in some
information or I have all the code
available in the description it's what
I'm gonna do now is use map to call
every document in our collection and
then I'm going to use map to send the
total student name list to reduce so how
we would do that is I'm just gonna call
this map function just to keep this very
simple and you can see a callback
function here and here I'm gonna go to 0
cycle through all this information as
long as we have students to process this
is going to allow me to target each
individual document so I'm going to
target each individual document and then
the students inside of it and cycle
through those in
Bijlee one by one and then aim it is
going to get two arguments being the key
on which you want to group the data and
then the data itself so we'll go
students and get our first name here and
we can combine these of course and then
students last name and then one because
all we want to do is output all the
student names that's all we're looking
for here so we can keep that very simple
and close that off so now what we're
gonna do is jump over into reduce and
reduce is gonna be called by map and
it's gonna receive all the values for
each of the given keys and then just to
keep things a little bit more
interesting then what we're gonna do is
add how many times the student name
shows up in the collection of our
documents and for reduce again I'm just
gonna go reduce function and go function
student is gonna be our key and we'll
have our values and I want to count how
many times these students show off
inside of all the different classes that
we have here and will cycle through as
long as there are values for us to bring
into this and count increment the counts
and then whenever we're all finished we
will output our results close that off
so now what we need to do is to define
the map and the reduce functions and
where to output that information so how
we do that as we go Map Reduce and we
define our map function which you just
saw a second ago and our reduce function
which is still here on the screen and
where we want that information to be
output to I'm gonna have that go to map
X and then close that off and then there
you go you can see all the information
here on the screen so basically what
this is saying is that we had six
classes that were sent to our maps that
was six of the total classes that
students could sign up for
II met sent 20 total students input and
that would include duplications so if
the students showed up in multiple
different classes it would show that
information reduced then showed us that
seven students are in more than one
class and then finally the final output
shows that we were able to output all 11
students and their classes and then if
we want to take a look at what that
looks like we can just go DB map X find
and there is all the information so here
are all the different students and in
many classes they are signed up for so
pretty neat we were able to jump through
all of that data and pull out some
pretty useful information using very
little code so now I'm gonna do another
MapReduce set of functions and what this
is going to do is jump through all the
different classes and do a similar thing
with the professors to show how many
classes the professor's show up inside
of so what we're gonna do with the map
function first is we are going to get
all of our professors put them in a
document we'll be able to work with here
so a function want to get all of the
professors go this professor and we're
just counting these guys so we can just
throw one inside of there make sure we
spell professor right and there we go
that's the map function now we can do
the reduced function
professor count and if we want to sum
all these we can do that by just summing
the count and then we can output our
little query we have here class's Map
Reduce
once again define our map function name
our reduce function name and just do
something a little bit different we
could also further cut down on our
results by issuing other query
conditions so what we want to do here is
say we only want information on a
professor that is Alice Jones so we only
want her information but whenever we do
this we want to throw in a curly bracket
at the very beginning of this because we
also are going to insert where we want
all this information to be output so
then we'll go out and here I'll just say
map
example 2 then close off that curly
bracket and then the function all
together and here you can see we
inputted three bits of information we
output three we're going to reduce that
down to one and then we output that one
piece of information do a find and there
you can see Alex Jones pops up and we
also know that Alice Jones teaches three
different classes so pretty neat so
let's get a little bit more complicated
another thing we can do is let's go and
do something a little bit from here it's
good classes so we can revisit our class
information let's clean this up a little
bit pretty okay so now what I want to do
is come in and mess around with topics
parts so what I want to do here is I
want to cycle through all the topics
that are covered in all the other
different classes that we have
and then count up the total number of
times each topic is going to be covered
across all of our potential different
classes that we have here in our
database so let's create our map
function get map function 3 and we can
go function and topics this topics and
then all that information is going to be
separated by commas so I want to split
those out so I'll be able to access each
individually and then we'll just go for
I in topics and omit topics I and then
one again close that off and then close
that off so there's our map function
it's not what we want to do is count up
the total number of times each topic is
covered across all of our different
classes so we'll go variable reduce
function 3 there's equal to function
receive the key and the values we're
going to be counting up this information
and for I in values and they'll just go
count equal to values each individual
one close that off whenever we are
finished returning the total count of
all the different topics and close that
off and we'll just come in here and
execute all this with MapReduce and map
function 3 and reduce function 3 and
let's just keep this simple I'll put all
this information without any queries
example 3 and then close that off but
have a little bug there let's go in here
forgot to put the e C up here whenever I
did that I didn't put an e there so
let's just get rid of that and execute
it again there you can see input all
those different topics that we have
reduced them down to three and then our
final output and if we do a find on this
let's go map example 3 and there you can
see all of the different topics that are
covered across all the different classes
and you can also see that Earth was
covered in three different classes
energy was covered in to the moon was
covered in two and so forth and so on
it's no it's issues even more
complicated queries let's say that we
wanted to come in and take a look at all
of the costs for each of the individual
professors classes well
map function again function call emits
and we're gonna say that we want to
output our professor and then we want to
output some real values this time
instead of just you know adding up all
the different values and one of the
things that we're going to be also
sending to our reduced function is the
cost this gets a little bit more
complicated and I think helps explain
better what's going on and that's the
end of our map function now let's go and
create our reduced function what this is
going to do is reduce down to just the
professors and the costs so reduce
function for function professor is going
to be our key and values we're going to
contain information on the costs and
then I can get individual create a value
object here it's going to have a total
count as well as a total cost which are
all going to be initialized to zero and
then we can create a for loop here
continue cycling through all this
information as long as values contains
additional information that we can work
with increment of course and then we can
get each individual piece so we go count
and increment that values and
specifically we want to count and then
we're gonna do pretty much exactly the
same thing with cost get values once
again except this time we're going to
get the cost part of that object close
off our for loop and then finally return
value after we're done and close that
off and now what I want to do is show
you the finalized function what I'm
gonna do with this is I'm actually going
to come in and condense the results down
to show the average of all the the
average cost of all the professor's
classes and for finalized call this
finalized function for again we're going
to be getting our key which is going to
be the professor and then the value
that's going to be passed inside of this
and now I can go value average is equal
to and then go value cost divided by
value count the total number of classes
and then whatever we're done return that
value and then of course close that off
of the curly bracket and now let's
execute all this and again we're going
do it in much the same way except we're
gonna have to put the finalized part in
there
so go Map Reduce putting our map
function put in our reduce function
we're going to be outputting this
information to map example 4 and here is
where we define finalize which is going
to give us an average finalized function
for closed-off that curly bracket and
there we can see there and now we can
jump in and see our results fat and then
jump down here and change this from 3 to
4 and there you can say went through all
of the different professors so we got
Alice Jones here total cost for all
three of our classes if you were going
to attend those and then the average
cost of those 3 classes you can see here
once again Paul slugman and it is
teaching a total of two classes total
cost 30 to 550 and the average cost and
the same thing for Rhonda Smith so there
are 4 different examples oil on how we
can use map and reduce inside a MongoDB
play around with them mess around with
different types of data and I'm sure
you'll get it the only way to really
learn this stuff is to practice at it so
just to finish things off want to cover
a couple random database commands that I
missed previously we're gonna be able to
come in here and use something called
distinct to get distinct results and how
you can do that is we can just go run
command and what you say something like
let's say that we wanted to get a list
of all the professors just using the
name once across our whole entire class
schedule and have no duplicates that's
where we would use distinct and what we
do is we put distinct in there of course
classes is going to be the collection we
want to search for then we put key and
then after that we put specifically the
information that we want back from our
database and you can see right there we
were able to jump in and grab just those
names and only use them one time so
that's just a way of using distinct now
I'll use something a little bit more
interesting something called group and
what groups can allow us to do is
perform complex aggregations and then
separate the results into groups so
let's say that we want to take all of
our book information and we want to
at every book title that cost more than
110 dollars let's come back here and
take a look first off at our book
information so classes and there you can
say all right so here's our book
information each book has an ISBN a
title and a price so we're going to be
jumping inside of here and we want to
get a list of every book title that cost
more than 110 dollars how would we do
that with group
we're gonna go DB run commands and we're
gonna type in group and then right here
what we're gonna do we're gonna put NS
and we're going to type in the name of
the collection we want to use so we want
to use the classes collection then what
we want to do is come in and list the
keys that we want to receive and you can
get more than one of course so in this
situation I want to get book and I want
to get price from that class's document
throw one inside of there and I also
said that I wanted to get my book title
so let's go in here let's get that
information close that off and we said
that we wanna only the books that have a
price that is greater than 110 we can
come in and list conditions inside of
here that we want to work with so we
want to come in and target book price in
this situation and let's say that we
only want those books that have a value
greater than 110 do that off that curly
bracket and we could also call a reduce
function on this but in this situation
in the next part i'll use reduce in this
part I'm not gonna do anything with
reduce so I'm just gonna go function
current oh you show you in a second what
exactly that does and let's just throw
nothing inside of there it's not gonna
do anything and then we'll have initial
inside of this and this is gonna store
the initial value the first time reduce
is called but we're not using reduce so
we don't need to put anything inside of
there and then we'll just close our
curly brackets and boom and you can see
right here is a list of all the books
that cost more than 110 dollars as well
as the title for said book so let's do
something a little bit more complicated
we're gonna use reduce this time what
we're gonna do is we're gonna calculate
the total costs of books for each class
so we're going to do much similar things
we're gonna go run
and this and here will go group once
again we're going to be using the same
document so we'll go classes and then
we're gonna list the keys that we want
to be pulling information out on so
we're gonna get our book price as well
as our book title and in this situation
I'm not going to put any conditions
inside here so I'm just gonna put
nothing inside of there I am however
going to come in and create a reduce
function current and result what this is
gonna do is cycle through all that
information and give me the total cost
of books for each of the classes so we
get a result total and we're gonna go
and get the current book price and
multiply that or what I want to do here
is get the total if this one doesn't
make sense what I want to do here is get
the total number of students as well as
the total price of the books and I want
to multiply them all together so the
total cost for books for every signal
student that is currently attending so
I'm gonna go current students and length
that's gonna give me the total number of
students in the class and then close
that off and then I'm gonna have to put
an initial value inside of here for
total since I am using reduced this time
and that total price or that initial
value for total is going to be 0 and
then we can close that off and there you
can see all the results so we jump
through all of the different classes you
can see all those listed right here and
you can see the book price as well as
the total cost for books to supply every
single student with a book in said class
there you go guys
there is a bunch of examples on how to
use map and reduce inside of MongoDB as
well as how to use group and run a
couple other different random commands
please leave your questions and comments
below otherwise until next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>