<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP Security Pt 4 | Coder Coacher - Coaching Coders</title><meta content="PHP Security Pt 4 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Derek-Banas/">Derek Banas</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP Security Pt 4</b></h2><h5 class="post__date">2011-01-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/oE_9BTiTN4E" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">oh hello internet and welcome to part 4
of my PHP security tutorial back in part
2 of this tutorial which is required
viewing before you proceed by the way we
created a registration page and as I was
creating it I was pointing out some of
the different ways we could fix it and
make it better well in this tutorial I'm
gonna take some of the knowledge that we
learned from part 3 of the PHP security
tutorial and make this new user
registration script much more secure
what are we gonna do we're gonna require
the user to put a user ID and we're no
longer going to use the email address as
the user ID and we're gonna require that
this user ID have a letter of both cases
and at least a number and be at least 8
characters long and as we learned in
part 3 of this tutorial series often
whenever people are told to do this what
they do is they have their user ID and
password be the same we're also going to
come in here and make sure that that
does not happen and on top of that I'm
gonna institute a CAPTCHA system to help
block out brute-force attacks from
hackers and as I had mentioned before in
regards to querying the database how it
is very good to end your query with a
very restrictive value I'm gonna show
you how to use the state abbreviation
last in your quarry if you don't
remember it only it will allow for a
maximum of two characters which is gonna
make SQL injection much harder so first
off what we're gonna do here is we're
gonna show you how to get this CAPTCHA
system set up and working all you need
to do is go to this address we have
right here on-screen
code.google.com/apis/console you want to
go to that website and if you do you're
gonna see exactly what's on the screen
right here and this is so easy to set up
what you need to do is come in here and
click on reCAPTCHA PHP library and then
you're gonna want to download this code
right here and the only file that's
actually required is this one that you
see here on the screen reCAPTCHA Lib dot
PHP you're gonna want to save that in a
folder that you'll be able to get ahold
of on your webserver so that's all you
need to do is download it and then copy
it to a place where you can locate it on
the web server that's all you need to do
then you basically just have to follow
the rules that are here on your screen
meaning and I'm gonna show you exactly
where to put this information here in a
second you're gonna have to get a public
key and how you do that is from this
same exact page you're gonna go over to
sign up for an API key and click on that
and then you're gonna type in an email
address and you do need a Google address
here and a password and they're gonna
give you what is called a public key and
a private key whenever you sign up for
that it's extremely simple so I'm not
gonna go into it and then what you're
gonna do is you're gonna insert the
public key here and your public key here
and then on the code that's gonna lie on
the server you're gonna enter your
private key I'm gonna show you exactly
how to do all this step-by-step so don't
worry about it that's basically all you
need to do this part right here is gonna
go into your HTML and this part right
here is gonna go on the server side and
I'm gonna show you how to do that so
first thing we're gonna need to do now
that everything's gonna be based off of
user ID is to actually create a user ID
field for the registration script and
all this code is that new think tank or
com I have a link in the underbar to the
code you can download it and do it
anything you want with it
so what we're gonna do is we're gonna
base the user ID on the same
restrictions we put on password so I'm
gonna come in here and actually copy the
restrictions we have on the phone number
copy that paste in here except now check
for a we're gonna put user ID in here
and we're gonna copy the restrictions we
put on the password down here I'm gonna
copy this regular expression which I
talked about previously
basically all it's doing is requiring
that there be one uppercase in at least
one lowercase letter and a number
and also that it'd be six characters in
length let's change that to a to make
this a little bit more restrictive so
that means we're gonna have a minimum
length of eight characters now in order
user ID then you're also gonna have to
come in here to the post area and we're
gonna type in user ID instead of phone
and come in here and type user ID
instead of phone again and then please
enter a valid and we're come in here and
type in user ID all right that's all we
had to do now we have that section set
up for user IDs and since we are already
here in the password section we're going
to also like I said before require that
the password not be equal to the user ID
because that
it stank so we're gonna come in here to
this section where it's checking to make
sure that the D password 1 and password
2 are equal to each other and we're
gonna put in other parentheses right
there we're gonna come in here put and
in space we're actually gonna copy this
right here copy paste
I love the copy and paste as much as
humanly possible and we're gonna say
that we want password 1 to not be equal
to use write it close that off both
those brackets and if that is true we're
gonna send all this over to be escaped
else I'm actually going to move this
down here and type in else if else if
I'll jump in here to copy this copy
paste this in and we're gonna put equals
this is the test if password 1 is equal
to user ID we do not want that and then
we're gonna have to tell it what to do
and that's real simple because we're
just gonna copy this copy paste your
password can you do user ID all right so
that's gonna protect them from being
able to have a user ID and password be
the same and then we're gonna close this
off just like that I don't let the else
handle this situation in which the
passwords do not match so that is all
the changes we need to put inside of
there and then down here right after
please enter a valid password this is
where we're gonna put all of our CAPTCHA
code and where are we gonna do that
we're gonna type all that out of course
not we're gonna come over here because
they provide all this for us and I'm
just gonna copy from the require once on
the web page that I pointed at before
and I'm not going to have an else
statement actually here because I don't
need that there and then right in here
before we get into checking that
everything has been entered I'm just
gonna paste all that information in
there and then I like to clean this up a
little bit all right everything else is
fine here you're gonna put your private
key that you got from Google I'm not
gonna show you mine sorry
and then here where it says what happens
when the CAPTCHA was entered incorrectly
well this actually killed died this
function actually kills the script which
is gonna make your user retype
everything in and I think that's kind of
mean so instead what I'm gonna do is
just put this echo command out here and
again we don't need the else statement
in there so if it was invalid we're
just gonna put this little thing in here
failed to enter code okay real easy
then this if statement right here it's
closed off and remember we're creating a
user ID and I'm gonna call it UI again
I'm keeping these kind of abstract as
possible so I definitely want to check
that a value has been entered in for you
I representing user ID and then down
here remember we don't care so much that
the email address is right we care more
that they have a valid user ID so we're
gonna change this query right here so
user ID and UI right like that
and then we're gonna come down here
where it says sorry there's an account
sign to that email we're gonna put to
that user ID and you could also check to
make sure they don't do cook any emails
if you want it to do that but that's
completely up to you and then here's the
query where we're gonna be entering all
of the new information into the database
and from last time you probably remember
that I said it's better to always have a
very restrictive end for your query and
the most restrictive and this is to
block SQL injection because if we can
only put in two characters in here and
everything else is gonna be like no we
will not accept it that's gonna make it
order for a hacker to put malicious SQL
in here so to fix that up and make their
life a little bit harder what we're
gonna do is just change this query up a
little bit and how we're gonna do that
is take state out of here and instead
put user ID inside of there and then
after work fun we're gonna put state
inside of there you might be saying well
wait a minute you didn't put the user ID
in the database that's fine we're gonna
get to that one second so we're just
gonna come in here user ID right there
and inside here we're gonna put quote
state so now the state is gonna be the
last thing entered into the query and
then we need to come down into the form
area and actually put in an area for
them to enter user ID yeah just so you
know if I was gonna I'm not gonna jump
into MySQL but if I just wanted to
create a new column in the table for
users what I would do obviously I'm
gonna type in it let's go find user my
SQL admin - P and then hit enter and
it's gonna ask me for my password I'm
gonna type that in I know I'm gonna type
in AMD B because that's the name of my
database I want to use
and then this is what I would type that
table users and this isn't in MySQL by
the way and I would just I want to add a
new user and it's gonna be called user
ID and yeah it's kind of a variable
number of characters just 20 in length
we're gonna require it so we're gonna
put not and all inside of there and put
a semicolon at the end and then hit
enter and that's gonna create the new
user ID part in my SQL so that's all
wonderful and great and to make her life
easy we're just gonna copy this password
thing right here because it fits exactly
what we're looking to do copy a except
of course we're gonna put user ID and
I'm gonna leave this up type password so
that people don't see the password but I
leave that to you however you want to do
it give it the value user ID or the name
for this variable we'll leave everything
else the same and I'm going to change
this actually to something that actually
makes a little bit more sense must
contain a letter of both cases a number
and length of 8 characters all right and
let's actually copy that into the
password area as well that's just a
little description so that they can type
in a user ID that actually is useful and
we're almost done
that's how awesome all this stuff is in
my opinion you should always use capture
systems because why not they're simple
alright so how are we gonna do that are
we gonna type out all that code of
course not we're smart we copy and paste
so we're gonna jump over here Google did
the work for us
and we don't need to worry about this
because we already have all that
information saved but we are gonna have
to copy right here and just so you can
see exactly what I'm copying I'm gonna
copy this right here and I'm gonna copy
that right there right out of this copy
zoom back out over here and want to come
into here in the form area and we're
gonna paste that in and then right here
is where you're gonna put your public
key and of course you're gonna want to
make sure you change permissions on this
reCAPTCHA lived PHP file saved in your
web directory or wherever you save it
and in case you forgot you're probably
going that type in sudo change mod seven
five five that allows them to execute it
copy/paste I don't hit enter and that
would be in your terminal and then that
would give it it
secure nobility and remember just put
your public key inside of here and if
you do all that and of course save this
guy this is exactly what you're gonna
see on your screen and let's just do one
real fast and then there you go and then
next up I'm gonna get into sessions and
how to secure them but just to prove
that it actually worked I jump over here
to my terminal in MySQL clear scroll
back so you can actually see this and
I'm gonna zoom in even more and select
every user and da da da da da you can
see Paul Paulson ba da da de da da da da
da all that information was entered
everything you can see right here is
coded and encrypted and the world's
wonderful you have any questions or
comments leave them in the comment
section below otherwise till next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>