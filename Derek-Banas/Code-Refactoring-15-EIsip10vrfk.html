<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Code Refactoring 15 | Coder Coacher - Coaching Coders</title><meta content="Code Refactoring 15 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Derek-Banas/">Derek Banas</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Code Refactoring 15</b></h2><h5 class="post__date">2013-02-07</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/EIsip10vrfk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">well hello internet and welcome to part
15 of my code refactoring tutorial today
I'm going to talk about how to replace
primitives with a class or in other
words how to improve type safety now
type safety is extremely important and
it is a topic that is very often
completely ignored what we want to do
here in this tutorial is we want to
eliminate all operations on values that
are not of the appropriate data type and
we're gonna do this by protecting the
program from bad input and how we're
gonna do that is we're gonna replace a
primitive data type with a class so
let's just jump right into the code okay
so what we have here on the screen is
some bad code and all the codes
available in the link underneath the
video and of course it's free and if you
get it it'll help you learn this better
okay so what we have here is a type of
ATM program and this is going to be the
focus of what we're going to replace in
this tutorial to make this more type
safe so this is the focus of the
tutorial is to eliminate the string name
state so what we have here is code that
looks pretty good we have all of this
information that is going to hold all of
our potential values for State and then
we're gonna verify a corner to pin
number and a balance request based off
this information which would come from a
database or something this isn't the
focus of the tutorial replacing state is
then after the user comes in here and
slides a card in we're gonna verify that
the card number is good we're gonna
verify that the pins good we're gonna
verify withdraw amount is good and down
here is where we do it and whenever we
execute it you see what you see on the
right side of the screen what we're
gonna do is step by step go through this
code and improve it dramatically and the
reason why I'm doing this tutorial is
I've gotten a ton of questions about
type safety recently so I'm gonna walk
you through the process right now
basically the very first thing we want
to do here is because we see that state
is not encapsulated because we see
things like this down here and we do not
see anything in regards to get or set
state so we want to incorporate
encapsulation inside of this code so how
we're going to do that
I'm just gonna highlight state right now
come in here go down to source and I'm
going to generate a getter and a setter
so there we go we got that and we want
to just do the get state and the set
state right like that and we're gonna
have it show up after state okay so
there it is it's already but we were
nowhere near being done yet now what we
want to do is go through our code
piece-by-piece and replace horrible
things like this with good stuff like
this and we're gonna do this in a series
of steps so just go through anytime you
see that value being assigned we're
gonna do that and we're gonna do this
and we're gonna do that over and over
and over again and we could put all
sorts of tests inside of these setters
to make sure that they do not enter the
wrong information and that is the reason
why we encapsulate our code so there we
go and there and that all looks good now
we're gonna set up the getters forget
state which is only found down inside of
here
and there we go and then after we're
done with that we want to save it and of
course execute it and yes we got exactly
the same answer so that's good we want
to constantly test as we're making
changes to make sure we're not breaking
anything then the next thing we want to
do is take all this state information we
have down here and move it to a separate
class all of its own so I'm just gonna
copy this for now and I'm gonna bounce
down inside of here and create a new
class okay so what this class is going
to do is it's going to represent the
state of the ATM access object that we
have above so I'm just gonna name this
ATM card state because that seems to
make sense for it and then I'm going to
create a private final string inside of
this and I'm gonna give it the name of
name because I don't know what else to
call it and then we're going to create a
constructor here and it is going to
receive name right like that and then
I'm gonna go this name is equal to the
name that's passed in to it and then
because we're going to want to have this
information come out as a string we're
going to create the two string method
inside of this or function and we were
going to return
name whenever it is called whatever the
current value is for it then what we
want to do is take those type safe
constants that we had above and instead
have them live in this class so they
cannot be impersonated in any way and
now we're going to keep them from being
impersonated is we are actually going to
create them as objects and the object
type is going to be ATM card state so
we're gonna replace all the strings with
ATM card State and there we go and then
we're just going to create these as
actual objects so right like that and
then we're gonna do exactly the same
thing for every other one of these guys
paste those in there and paste that in
there and close these okay so now all
that information is going to be stored
inside of there so we can come up here
and we can delete all of this because
it's in an external area an external
class and then we're going to define our
types a field inside of here it's gonna
be that external class and it's gonna be
private ATM card State and I'm gonna
call it card state because that seems to
make sense and then I'm gonna walk
through the whole process of fixing all
this okay so whenever somebody calls a
get State what are we gonna do we are
going to instead of returning state
we're going to return card state and
call to string there we go
this guy isn't going to be eliminated
altogether or actually let's just go in
here and just delete it and then we're
just gonna walk through step by step and
fix each one of these guys so for a set
state we're going to use card state
again so this is going to be this card
state and this is going to be set to ATM
card state right like that and then
we're just going to incrementally keep
changing everything here so down here
what are we create hey TM access bad
this is going to still be set State
however it's going to be we're going to
make a call to anyway ATM card state
like that and call that constant and
there you go whenever we get down into a
verify card going to get the colored
number passed over inside of it but here
we're going to call get state and we're
going to check for equality equals and
here we're going to pay reference to the
external class again so we're
go ATM card state and this is going to
be card entered rid of that altogether
and then we'll call to string on that so
we're checking to make sure that the
card was entered and it was now if it
was entered I'm actually gonna throw
another if statement in here and check
the card number as well so if card
number is equal to and ATM card state
card number then we know that we have a
match for the card number that was
entered as well as the card number in
the external class and under that
situation this is a valid card so let's
set it as so except let's set it as an
ATM card state valid card right like
that else we'll just copy this we want a
set state blink and blink as denied
there we are using the external class
again they want to come down into the
verify the pin number and what do you
think we're gonna do we're gonna come in
again and go get state and check for
equality equals and inside of this
delete that I'm gonna go ATM card state
dot I'm going to again check for valid
card and then go to string I'm adding a
little bit extra stuff here to the code
that I have in front of me and then I'm
gonna get rid of that altogether so
there again we're gonna verify that the
card is valid if it is we're gonna go
does the pin number that was passed over
equal the ATM card state pin number and
if it does then we're going to actually
set the state like we have here paste
that in there except of course we're
gonna have ATM card state inside of
there and there we go have that all set
up and then ATM card state for denied if
it is not a match it's just
incrementally walking through and
verifying everything then we'll get down
into verify withdrawal amount and here
again I'm going to add a little bit to
this so let's just get rid of that and
here we're gonna go get state equals
side of they're gonna go ATM card state
I'm gonna check that the pin is valid
before I check to verify the withdrawal
amount because I know the only way that
would be valid if the card and
everything else is valid and then if
that is set properly
I'm now I'm gonna go in and go if
withdrawal request is less than or equal
to ATM card state and this one's going
to be card balanced so that means I have
enough money in the account to take out
and then after that we're gonna come
down again take out the set state this
is gonna be set to ATM card state valid
cash request otherwise it's going to be
denied and then we can step down into
this guy and check to make sure
nothing's changed so this is still going
to be set up exactly the same way that's
gonna be the same and that's gonna be
the same and everything else is going to
be the same so we're not going to have
to change any of that code inside of
main if we execute it I had a little bit
of an error so I'm just gonna come up -
line 21
and change that to a double equal sign
hey whenever I do this stuff out of my
head sometimes I make a mistake so let's
file execute it and there you see I got
exactly the same results except now
state is a hundred percent type safe
because it's only pulling information
from that external class so that is an
example of how we can replace a
primitive with a class please leave any
questions or comments below otherwise
till next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>