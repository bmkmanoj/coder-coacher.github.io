<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PHP Security Pt 5 | Coder Coacher - Coaching Coders</title><meta content="PHP Security Pt 5 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Derek-Banas/">Derek Banas</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>PHP Security Pt 5</b></h2><h5 class="post__date">2011-01-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ZQ0Uy147FKE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello internet and welcome to part five
of my PHP security tutorial today I
thought I'd be kind of interesting to
actually show you a real-world problem
so I guess it was about seven eight
months ago a friend of a friend of a
friend contacted me because their
website was receiving an immense amount
of spam and they didn't realize it at
the time but there was a lot of
underlying problems I'm going to show
you here just how dangerous SQL
injection can be and based off my own
personal research it seems to me that
SQL injection seems to be possible on
about one in every four websites
research actually says one in three but
you can see just here how dangerous it
is
well after I found out they were having
problems with spam that's normally a
pretty elementary problem that should be
fixed by most programmers and in the
next tutorial I'll show you exactly what
was going on with that but I decided to
poke around in their website now what I
did was I cut out just the login part of
their website here and I'm going to show
you real quickly a way to see if a
website is objectable to SQL injection
I'm going to do is type in one character
a quote that's it nothing else well
whenever I did that on this website and
clicked on login I was provided with
pretty much all I would need in regards
to hacking this website I know a lot
about the field and the different column
names that are used and a lot about this
website in general and whenever you look
at this query right here on screen you
might think it's well protected because
it is requiring both an email to be
added as well as a password or you're
going to see here real quickly how easy
it is to subject this and also I saw
that this person did not suppress errors
on their site so this also points at the
fact that this is a pretty elementary
programmer that didn't know what they
were doing I'm going to show you how
easy it would be based off of this
script right here to find out all the
user information that's currently stored
on that database but another way to
prove that SQL injection can actually be
used is to type in not one quote the two
quotes after doing that and clicking
login if the errors go away I know that
this script is easily hackable using SQL
injection and I'm going to show you here
just how easy it is to be able to pull
out as much information as I want now
I'm going to type in one quote followed
by space or if you saw my other previous
tutorials you know what's going on here
and then what I'm going to do is type in
something that is always going to come
back as positive so what I'm going to do
I could actually just type in a 1 that's
what I do so what I'm doing here if you
look at the code here what it's going to
do is I want to pull up the user ID
first name last name email user IDs and
passwords and this also contains all
kinds of credit card information on the
other script from the users part of the
database and what I'm doing here is I'm
closing off the end with a quote right
here so I'm closing off the end of the
email and then what I'm saying remember
this is a where Clause and entry points
for SQL injection are almost always
located in the where clause and the
reason is is this is normally where user
inputs start in a query so knowing that
all I need to do here is put in a clause
that's always going to pop back as true
and if I can do that I'm going to get
user IDs first names and everything else
for every single user in the database so
I'm going to show you how I did that so
I type in a single quote which will
close off that email part and then what
I'm going to do is put in an or and then
I'm going to put in something that's
always going to be true well the problem
is is it's going to then ask for the
password it's real easy to get rid of
that in all of the major databases out
there you could comment a line out by
just putting two dashes in and by the
way don't do this in real life this is
purely for security practices you're
getting a lot of trouble if you do this
on other people's websites so on
Microsoft SQL and Oracle and so forth
what these two dashes mean is you want
to comment out everything that precedes
it well with MySQL you have to also put
in a space and if I do that and click
login you can say that it popped up all
the information on every single user
that is currently stored in the database
quite dangerous well let's look at this
script and exactly how it works okay so
we're going through this is the actual
code on large it here and you can see
here it has this set ups if you saw the
previous tutorials this is checking to
see if information is submitted and then
as I look here I see that they did
absolutely nothing in regards to trying
to keep people from putting malicious
information that's what's going here
they're accepting the information
entered in at the email and the password
area and not scrubbing it at all now we
could easily solve this
just by using my escape data and this is
not all I'm going to do by the way to
get rid of these problems so we just put
in escape data and I run it through the
function that I showed you previously
and boom that's all I did right there
now if I save that and open this guy up
and try to do the same thing again
you're going to see that it
automatically all I needed to do was put
this little tiny bit of information in
here and it solved the ability for the
person to come in there and mess around
in the database but we're not done so
we're going through here and also if
you've seen other tutorials you know
that I do not like it whenever the user
ID is email so we're going to change
that but let's go through here another
thing I don't like about this is you
never want to put any SQL errors out to
your screen so I got a ditch that I have
no idea why they're using MySQL number
of rows here because it would be much
better to use MySQL affected rows and
then have this be equal to one meaning
that one result if you only expect one
result to come back then you should
protect yourself from getting an
unlimited number of results so they
could have changed this right here and
that would have solved the problem also
I don't know what's going on with this
code right here I left it as it is just
because this is the way that they were
using this information to fetch again
this is kind of a sign of a program it
doesn't know what they're doing then
they close the database then whenever
you also see a bunch of comments in code
is a sure sign person doesn't know what
they're to and it can and then if we
come down here to the email address
where it's taking the information you
can see that there's no maximum length
defined so we want to come in here and
fix all this code up and I'm going to
show you exactly how to do it step by
step by step okay so the first thing
we're going to do is just get rid of
this all together so that's gone and now
what I'm going to do is come in and run
a regular expression on this information
so prague underscore match right like
this and then i'm going to say alright
well i'm going to check for a user ID
this time instead of a email so i can be
a lot more restrictive i'm only going to
allow the person to enter letters and
numbers makes it almost impossible for
them to be able to do anything and i'm
going to say that's going to be eight to
twenty characters in the length right
like that so now I'm restricting pretty
dramatically what they are able to even
enter in here use the old strip slashes
again and I'm also going to trim off any
white space and like I said before we're
going to use user IDs here instead of
email addresses so there's a regular
expression now if it passes that regular
expression am I done
no I'm also going to run it through my
escape data function and all this codes
on website you think tank comm if you
want it it's all free bowels if it
didn't pass when a mark user ID as false
and then I'm going to echo to screen
sure you get your quotes right okay so
there's your warning message and then if
I want to perform pretty much the same
thing on the password I'm just going to
copy and paste this out of here except
I'm going to type pass in here instead
and pass instead here these enter a
valid password and technically I
shouldn't even tell them that this
information is wrong so I'm going to say
or password in here like this boom so
now they're not going to know which bit
of information they entered incorrectly
if they're just hacking away at this guy
okay and now and am I done no I'm
actually going to put in some CAPTCHA
code to make it even harder to log into
this I'm going to pull that from what I
did in the previous tutorial and you can
see here I assign this variable to the
value of one which is equal to true and
then I'm going to be pulling in all this
code right here this is where you insert
your private key as I showed you before
and here's an error message and here I
set the CAPTCHA security variable to
zero which is going to be equal to false
okay so that's all that's going on there
I just copied and pasted down from the
last tutorial and then now before I
actually query the database I'm going to
check that all that information was
entered incorrectly so you and password
and copy that right there clink all
right now I'm also going to have to come
in here and change this to user ID and
this to you and everything else can stay
the same that's for the query itself and
then here I'm gonna get rid of the
capability for them to put an error on
the screen that's a big no-no just like
that I'm going to get rid of this mess
right here and instead for affected rows
from the last corner now if we're
expecting that there's only going to be
one row of information sent back to us
well we'd actually want to block if more
than one
cent so we're going to put in one right
there saying we're only going to accept
it if one row of information was sent
back to us and then I'm just going to
leave this mess right here the way that
it was again I'm trying to secure this
not do anything else and this has no
purpose in being here so that's going to
get deleted as well also another thing
that's not done here is I want to close
this script after I close the database
because I don't want it to run any
longer no point so I'm going to exit
both of those out and then I'm actually
going to copy and paste this right here
because I put in another if conditional
so we're going to be able to close that
out make sure that is correct and also I
should put in here either the user ID or
password wrong but I'll leave that the
same as for now because it's not
technically that important this wasn't
originally called bad locking by the way
I'm gonna call this good login and then
I'm going to come down here and while
this doesn't really provide that much
protection because you can subvert this
information I'm still going to put in a
max length bit of code just to mess with
them a bit I have no idea why they put
25 and let's put 20 in here and then
don't forget to put the CAPTCHA system
in here inside of the forum area and
again you put your public key right here
and then just that quickly I turned a
really volatile mess of a login script
into a very secure login script and
let's see exactly what it looks like if
we type in goog login and you can see
here now if I type in quote even if I
fill in the CAPTCHA area say please
enter a valid user ID please enter a
valid password da-da-da-da-da-da so it
blocks out SQL injection altogether you
have any questions or comments leave
them in the comment section below
up next I'm going to show you how a lot
of spam gets injected into people's
websites without them knowing and I'm
going to proceed into directory
traversal on how to protect from that I
understand</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>