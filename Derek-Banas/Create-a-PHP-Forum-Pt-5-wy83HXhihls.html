<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Create a PHP Forum Pt 5 | Coder Coacher - Coaching Coders</title><meta content="Create a PHP Forum Pt 5 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Derek-Banas/">Derek Banas</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Create a PHP Forum Pt 5</b></h2><h5 class="post__date">2011-03-26</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/wy83HXhihls" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">well hello internet and welcome to part
5 of my PHP message board tutorial and
this I'm gonna show you how to make the
login part for your website which is
right here I've gotten a lot of requests
on how to create a captcha system that
is nice and compact and yet still works
and functions just as well as yeah the
one you're gonna learn that you're gonna
learn how to verify a secure user IDs
passwords I'm also gonna show you how to
make secondary token IDs that are gonna
be stored in separate cookies and a
whole bunch more so let's get into it
basically what I have here on the left
side of the screen is a lot of things
you've seen in the previous part of this
tutorial and if you found yourself here
somehow without seeing those parts
definitely check those out first
otherwise you will be confused and also
I know you should always keep your
styling and any external scripts
external rather than having them on the
page I'm just doing this so that I am
able to keep everything pretty much on
one page and then down here we have the
login part that you saw in the previous
tutorial and then I'm of course going to
add to that first to get this CAPTCHA
system here nice and compact what we're
gonna have to do is go into the styling
area and I often do this whenever I'm
writing code I'll put in little comments
on exactly what I need to put where if
you want to style the CAPTCHA system
this is how you do it and all this codes
available in the underbar below there's
a link and you should definitely get it
because that will save you an immense
amount of time okay so we just go
reCAPTCHA image which is this image over
here and we define a width for it and
I'm going to put 185 pixels because that
just works for me and a height of 28.5
because that just ended up also working
for me and under border I'm just gonna
put one pixel solid Gainsborough because
this was a default so that's going to
make that image a little bit smaller and
then you have to come in here do a
little bit more styling this comes from
reCAPTCHA itself and that is all you're
gonna have to do for that part of the
styling to make this a little in tiny
I'm sure you understand everything that
I did there it's quite simple and then
in a script area you need to come in
here and do a couple other things and
here you're able to perform additional
styling inside here you have to define
that your theme is going to be custom
custom theme underscore widget and like
I said before this is all stuff that is
part of the reCAPTCHA system so that's
the scripting that needs
there and now what I'm going to do is go
down into this PHP section and verify
all the user input for the user IDs and
passwords and verify that the account is
activated and a whole bunch more if
again I'm checking if submitted is set
for true just like I've done previously
that's what's going to trigger this code
to start running then I'm going to
provide a security check to make sure
the user ID is valid and doesn't carry
any characters inside of it that could
be potentially harmful and I'm going to
do that by performing a regular
expression check but in my delimiter
carrot signifies the beginning of this
string and I'm gonna say that I will
accept A through Z and lowercase a
through Z 0 through 9 and no spaces and
eight to twenty characters in length and
then it's gonna end and that is it and
then I'm gonna call strip slashes on it
turn out any white space which there
shouldn't be any and like I said a lot
of times I just do stuff and double and
triple check everything it's just part
of my paranoia and then I'm gonna scrub
this use your ID again I call an escape
data which is located in my header dot
PHP file and we went over that
previously so it's just gonna send it
over there clean it up make sure
everything's all nice and tidy now if it
did not pass what I'm gonna do is set u
equal to false and then later on
whenever I check if u is false it comes
back positive then that means they
messed up and then I send them an error
message and then here you should define
up this outside again of this page but
like I said before just to keep
everything neat and tidy I'm defining it
inside oops made in there I put double
quotes because it's contained in single
quotes and then I want to close that off
and then I'm going to perform a security
check on the password and of course this
should be heavily commented and the code
that I have linked to in the bottom is
heavily comment and I'm just going to
copy and paste that because this is
going to be very similar basically I
have to come in here change user ID to
pass and then I have to change right
here to pass and then down here please
enter a valid and then this is gonna be
password instead of using it and now I
have to do the PHP code for the CAPTCHA
system and I'm gonna first set CAPTCHA
check just like I used you here oh and
I'm also going to have to change these
to P just like I did this
right here that's what this guy is I'm
gonna set it originally for one I know
I'm gonna scroll this up you can see it
all then you're gonna enter your private
key you got from Google private key
whatever that is
RESP then private key this is all part
of the capture system and you should
type everything in exactly the way I
have these things defined here because
this is going to go off and verify that
the CAPTCHA was set up right and the
information was entered right by whoever
is using your website so you would just
enter it in there like that or go and
copy and paste it because it's gonna be
the same every single time and then this
checks if what they entered is valid and
again this is part of the CAPTCHA system
it's gonna be the same and here this is
custom this is where you have to enter
exactly what's going to happen if it
isn't now I'm just going to take this
and then close that off all right like
that and then of course if they entered
it incorrectly I want to take this guy
right here and jump down here and set
this to zero or false or whatever you
want doesn't really matter
false or zero and then close that off
and what I'm going to do is query the
database and verify that the user name
the captcha system and everything was
set right and how I do that is go if
dollar sign you or username and P and
let's just paste that in there I chop
that and now you can see exactly where
that is coming in to when I was putting
falses and throughs and zeros and all
those things in there so if they all
came back positive that means the user
ID the password the capture system
everything was done right so now I can
issue a query and realized all this
information is right so I'm going to say
to my SQL I want you to return my user
ID my first name last name email address
user name password
active there's all things that are
inside of the MySQL database which is
right here you can actually see all
these things that I'm talking about
right here on the screen so if we zoom
in a little bit see user ID username
password email token ID first name last
name active is the account act if it
says null that means it is active if it
has this long string of numbers in there
that means it is not so that's what I'm
getting there so then I have to say from
the name of the table is users and then
I'm going to say where
username is equal to right like that and
password is equal to and I have to run
it through that function which is going
to encrypt it so that I never know what
their password is and da da da da so
there's the query that I want to issue
so now I have to issue the query and see
if it came back positive and I do that
with the MySQL query function which only
accepts one query at a time which is
also a security feature and if that
query did not work I've shot back an
error issue that error right there on
the screen
then if I'm going to check here that the
number of affected rows from the last
query that I issued is going to be equal
to one which it always should be if it
isn't I would also make a note in the
log file or have an email sent or
something that somebody is messing
around with your system because if
they're entering a user ID and password
there was only one row it could possibly
affect unless somebody ran a query
through here that was potentially
dangerous and then I'm going to take all
of the results and I'm going to store
them in an array called row and you do
this to free up resources now I'm going
to check if they activated the account
or not remember I said if it's activated
then the value of active which I can get
right but like this say six we go up to
the query user ID at zero first name is
one two three four five six so what I'm
doing is checking the value of active
I'm saying if it's not equal to null
then that means they haven't activated
their account so I need to do something
about that what I'm gonna do is direct
them to a different web page and how you
do that is exactly by using this header
function here and I'm putting in
localhost because this is on my site or
my computer and of course you would have
it go somewhere else
unless you're testing it on your local
computer and then I'm closed in my
database and I'm closing this script and
they're gonna be redirected then so that
is going to handle if they haven't
activated their account and then I'm
going because in the header.php file I
decided to use sessions what I'm going
to do so that I know when the person
comes back that they are already logged
in to the account I take the value
stored in the first position from
that query that I performed and I'm
gonna save in a variable first name the
first name that they entered so all this
is and I'm gonna store user ID equal to
row and the value that's stored in the
fourth place while we're inside of that
array and then I'm gonna create a
secondary or what is called a token ID
and what this is gonna do it helps fight
off what's called session hijacking
which I talked about in the PHP security
tutorial basically it just stores inside
of a cookie another random number and in
it is stored on their computer so it
makes it hard for somebody to get on to
somebody else's computer and steal it so
this is another layer of security and
then I'm gonna run another query here
call this query to remember if it's an
uppercase that means it is a minus QL
command or a sequel command whatever you
want to call it if it's lowercase that
means it is not and I'm gonna set the
value of token ID whatever it is and I'm
gonna set the username so whatever they
have stored in the session under user ID
and then I'm gonna run this query and
just so you understand this right here
is the token ID right there see this one
hasn't been logged in yet this one has
been logged in and you can see that this
token ID changes whenever the person
logs in again and again and again again
it just helps people avoid session
hijacking because most people do not do
that and then I'm gonna set the token ID
in the session as well and then on top
of that I'm going to regenerate the
session ID number again and then I'm
gonna redirect the user just like we did
before and how about I just go up here
in coffee in that so here I'm going to
send them to the login page and
everything else there is the same and I
just want to close this off else that
else comes from not this guy here but
this guy up here so that means either no
rows were changed whenever we issued
this query or more than one row changed
so we want to handle that problem and
we're just going to put in out the
screen break statement paragraph font
color is equal to read size is equal to
plus 1 and just print that out close
that off close off my paragraph tag and
then anytime an error is triggered when
we shut down our database connection and
shut down the script altogether and that
is the end of the submission area and
now we're down here this is actually the
end of the pea
HP for that part so now we're down in
the body area and like we went over in
the last tutorial what this is doing is
it's checking to see if first name is
set using sessions and you saw just
above exactly where I'm checking to see
the first name is and if it is set we're
gonna display different results over
here so if it is set with first name
that means they're logged in so what I
want to do is I want to display all the
things in reference to what it would
look like if a person was indeed logged
in so I'm obviously not gonna have login
being shown and just so you see it let's
go over here so there's everything
entered in there and then I'm gonna hit
login and you can see welcomed Eric
shows up and it only gives me the option
of either logging out or changing my
password it doesn't give me any other
options because it didn't make sense
that give me any of them so here what
I'm gonna do is actually there is nicer
ways to do this but I can't really think
of anything I could do here if I'm
trying to keep everything all in one
place I would normally do this in a
separate page because it can get sloppy
here what I'm doing because I'm starting
to do more complicated things I'm
actually gonna have to go inside here
clear browsing data and all I just did
was I just deleted the cookie so when I
log back in say it's asking for a login
because I deleted the cookie and all of
the session information so it doesn't
think I'm logged in and all I'm doing
here is just putting in all of the
information you see on the right side of
the screen so user ID putting in the
input text box word name is equal to
pass size is equal to 16 pixels that's
just so everything lines itself up but
I'm gonna make my maximum length equal
to 30 so they can put up to 30
characters in there actually I'm gonna
leave this as text so that it's easier
to read and a user ID and then I'm just
gonna copy this paste it in there and
then change this in the password section
to password and name as passed
I don't leave everything else exactly
the same and I can take that out also
okay so I'm just echoing all this
information out the screen depending
upon whether they're logged in or not
that's all I'm doing here it's not
really that complicated
I'm gonna go echo and do pretty much
exactly the same thing but here I'm just
going to copy and paste this from what
Google provided on its cap ship
page so you can either copy and paste
this out of my link that I have any
underbar or you can go to google and do
it the roundabout way it's totally up to
you and I'm just gonna paste all that
information in there because there's no
point in typing it all out it's the same
every single time and all this does is
puts these links in here and all this
other information that's it handles all
the CAPTCHA stuff and of course you
wouldn't want that comment there but
everything else is pretty much perfect
and then you'd have to come down here
and finish off with a double quote no
semicolon and then the only thing left
to do after that just come in here and
go echo give a line is equal to the left
and this is going to create your submit
button login will be on the button and
it will close the div create a hidden
field name equal to submitted this is
going to notify my code above that they
have submitted information that needs
processed and then close off the form
and then register dot PHP and this is
just a link gonna be set for register
and then a H reference is equal to
forgot password which is gonna allow
them to retrieve their password and I
went over that in a previous tutorial as
well and that is the whole shebang of
course we're going to want to close this
off and I'm also gonna want to come in
here and put single quotes in here or I
could back slash them but I'm just gonna
save them and single quotes because
that's just easier and that's the whole
shebang that's all all the code that's
everything that you need to create this
guy over here you have any questions or
comments leave them in the comment
section below otherwise until next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>