<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Code Refactoring 17 | Coder Coacher - Coaching Coders</title><meta content="Code Refactoring 17 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Derek-Banas/">Derek Banas</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Code Refactoring 17</b></h2><h5 class="post__date">2013-02-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/4tLSDAbe8QY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">well hello internet and welcome to part
17 of my code refactoring tutorial today
I'm going to show you how to add
functionality to your classes using the
visitor pattern so basically one of you
guys sent me this problem I got a whole
bunch of questions about the visitor
pattern cuz I guess it's something
that's brought up in class very often
basically this is the problem a company
needs a program that's gonna calculate
bonuses for each type of employee that
it has it wants to have the capability
to calculate quarterly and your end
bonuses and it also maybe want to give
monthly bonuses and so forth and so on
so we want to put together a
functionality to allow us to provide
bonuses in different ways maybe a middle
of the Year bonus then each employee is
gonna receive a bonus based off of
completely different criteria we're
supposed to use the visitor pattern in
this situation and employee classes can
only be added to and nothing inside of
them can be changed so we're not allowed
to touch the code we're just allowed to
add to it
visitor pattern is often confused but in
this tutorial I hope to completely
explain it so basically this is what
we're gonna do we're gonna have our
salesman which we have right here and
we're also gonna have sales trainees and
we're also gonna have bosses all of them
are going to receive different types of
bonuses then we're going to have this
guy yearly bonus visitor and it is going
to calculate the yearly bonus for each
of these different employees there's
also going to be a quarterly bonus
calculator or visitor or whatever you
want to call it and basically what the
yearly bonus visitor is gonna do is it's
gonna contain a bunch of over loaded
methods all named visit salesmen is just
going to be one of those there's also
going to be a sales trainee and a boss
and double is going to return the bonus
amount whenever it is called and of
course it's going to perform
calculations on whatever object type
like in this situation salesman is
passed over to it salesman which is up
here of course is going to implement the
visible interface which means that this
calculator is going to be able to visit
the salesman look at its numbers and
calculate its bonus and the salesman is
going to contain a method named accept
that's going to receive a visitor in
this situation the yearly bone
visitor so it's just like it shows up at
the salesman's office and says hey let
me look at your numbers and in exchange
I'm gonna give you your bonus or this
double amount right here and then over
in Maine where we're actually going to
be creating all these different things
all we're gonna need to do is create our
object that's going to calculate our
yearly bonus treat our sales person and
provide their numbers and then whenever
except is called which is over here
inside of sales it is going to be passed
the guy that's going to calculate the
yearly bonus and then it is going to
calculate it that's it so let's look at
it again so it's basically if we want to
look at this in pictures this is the
salesman and he's basically saying I
have my numbers on my computer
tell the yearly bonus person to get my
bonus here is accept visitor is going to
be the person that's going to calculate
the yearly bonus and this whenever it is
passed in to this guy up here this
visitor see visitor visitor it is going
to be past this which is a reference to
the salesman's computer that contains
all the information on how to calculate
the bonus that's really it this is the
whole thing if you understand that the
sales person is going to receive a class
that is going to perform a calculation
on its code and all it needs to do is be
passed a reference to that code which it
then will return a final calculation
over here and then accept returns it
back to the main function you understand
the visitor pattern now of course I'm
gonna get into code here in a second
basically it's just accept receives the
person that's going to calculate the
bonus then we pass over the salesman
object to the person that's going to
calculate the bonus for it then it jumps
over into the very specific overloaded
method that handles salesman's bonuses
and calculates those bonuses for that
salesman jump back to the previous slide
and then it's gonna return that amount
which is right here and then at the end
of accept the accept method is going to
return that value over to the main
function to provide it to the client
that is the visitor pattern now let's
jump into the code and create it piece
by piece and all the code in this video
is available and I like underneath the
video and of course it's free
okay so this is what I got and I cut out
the extraneous things that didn't really
matter from the problem that was sent to
me from one of you guys so we have a
sales trainee a salesman and a boss all
of them contain different types of
information that we are going to use to
calculate the bonus and that is all we
have here is those different types of
information a constructor and then a
whole bunch of getters and setters now
to allow the guy to a visit and look at
the sales trainees numbers in this
situation we're going to implement
visible just like that and let's jump
over and take a look at what visible is
gonna do basically this is going to be
an interface and it is going to be
called visible just like you see there
and what this is gonna allow classes to
do that implement the visible interface
is allow a visitor to pass in an object
so that the right calculations are done
depending upon the object type being
whether their salespeople sales trainees
or bosses inside are visible we're just
gonna force it to create a method called
accept which is going to invite in an
object to perform those calculations
that's all it's doing an accept is going
to be in each employee object and those
employee objects then pass an object of
their specific type to a concrete
visitor concrete visitor is going to be
guys like yearly bonus visitor and
quarterly bonus visitor to different
classes that calculate bonuses in a
different way and like I said before the
concrete visitors are gonna contain a
method named visit that is overloaded to
handle each of these employee types and
can then perform different calculations
based on whichever employee type is
passed in and there is visible it is
done so let's not worry about visit
quite yet we got visible all set up here
and sales trainee is gonna need some
unimplemented methods put in there and
there we go and there you can see the
accept method is inside of there now
and all we're going to do is go a
visitor the person that is going to my
calculations for my bonus I am a sales
person and that's what this tells us and
that is all we need to do we need to
type in implements visible and then a
now the person that's going or the class
is going to be doing the calculations to
visit and then know what type of object
it's going to be performing calculations
on well guess what now all we need to do
is do the same thing for salesman and
there that is and then we're gonna do
exactly the same thing for boss as well
and there that is and then everything
else is gonna be the same - so let's
just copy this because that's not gonna
matter jump over into salesman paste
that in there and it is just inviting
the person or the class that is going to
do the calculations into the class so
that it can access numbers just like I
did in that little picture alright so
those are all saved and they're all
ready to go now what I need to do is go
into visitor Java and each of the
concrete visitor types or the different
types of ways to calculate bonuses
that's what I mean when I say concrete
visitor type are going to implement this
visitor interface so I just go interface
visitor pretty easy and then I tell it
all of the different types of employees
that it will need to be able to handle
so it's going to need to be able to
calculate bonuses for sales trainees so
there we are now it can do that sort of
anyway it knows that it needs to do that
and it's also going to have to do the
same thing for sales and then I'm just
gonna type salesman in here it's also
going to have to calculate bonuses for
the boss and there you see it can do
that and we're done that is all we need
to do well now we need to go into the
yearly bonus visitor and have this guy
create those overloaded methods and it
is going to implements visitor just like
that and then add-on implemented methods
tells us exactly what we need to do
pretty easy there they are and then we
can put pretty much anything we want
inside of here these are going to be
calculations that are specific to sales
trainees so let's just say we want to
print out something like print line and
then put trainees yearly bonus or
something like that print out on the
screen so that we know what we're
looking at and then I need to find my
bonus percentage and then multiply at
times that your yearly salary and I'm
done so I'm just going to type in
something here yearly bonus
percentage and I'm going to say Trini
I'm just gonna use a ternary operator
here to figure out what to do so let's
say six days if they are less than 10
and Trini what else do we have in there
get failed test that looks like a good
one let's say if they've failed less
than two tests we'll give them a bonus
of ten and if they didn't reach those
requirements we'll give them a bonus of
0.02 so there we go now we have that guy
and now what we need to do is calculate
the bonus amount yearly bonus amount and
let's say I want to go and get the
salary for this training and multiply it
times yearly bonus percentage and there
we go and then I want to return yearly
bonus amount and there we are it's done
now the trainee works for the yearly
bonus and then I'm just gonna copy this
I'm gonna do sort of the same exact
thing for salesmen and also the boss so
this is going to be salesman's yearly
bonus so we're going to change this to
salesman and let's say we want to
calculate total sales amount and if the
total sales amount is greater than a
hundred thousand say and salesman's get
new customers I think that's it all
right get new customers yes is say
greater than fifty then we're going to
give them a bonus of 12% these numbers
actually come from the question that was
sent to me so that's where they are from
and then I'm gonna go salesman's I don't
think he has a salary so we're instead
going to go get total sales amount there
we are and multiply that times your
early bonus percentage and everything
else there is perfectly fine so let's
keep it that way
and then please leave any questions or
comments below if you don't understand
anything here and then I'm just going to
say boss yearly salary and change this
to boss and then let's say that the boss
in this situation let's see what they
have I forget get office expenses
there's one of them if they kept their
office expenses below 50,000 and new
customers get new customers okay that's
good so let's just change this the boss
get new customers are greater than a
thousand
we're gonna give the boss a 15 percent
bonus and if not we're just gonna give
them a 4 percent bonus and then this is
just boss get total sales amount
everything else works great I'll save it
then let's jump over and calculate all
this ok so I have this all set up here
and I just put yearly bonus and
quarterly bonus which I'm going to let
you do the quarter of a bonus I'll leave
the code to how to calculate the
quarterly bonus underneath the video and
you can go take a look at it if you just
need another example and basically the
reason why we're using this is so we can
have completely different calculations
performed on completely different
objects just by defining a new concrete
visitor like we did with yearly bonus
visitor and like I did in the example
code for the quarterly so we just have
to say ok your Li bonus the visitor
which I just created and I'm just gonna
call that yearly bonus calculator is
equal to new yearly bonus visitor so now
I have a way to calculate the bonuses so
now I just have to create my sales
trainees that have very specific data
new and this is gonna be sales trainee
and let's say well five one and twenty
thousands their salary I'm gonna do sort
of the same thing for the salesman and
for the boss so this is just gonna be
Salesman and then I'm just gonna say
this person's named Tom salesman and
this is gonna be salesman and then let's
say that he did $150,000 in business and
put on sixty two new customers then this
is going to be boss and I'm gonna call
him Ross boss and new this is gonna be
boss as well just creating the employees
with the employee information and that's
gonna be passed over and calculated
Saints on that work say he did a million
dollars in sales what is that new
customers and office expenses okay say
did 1200 new customers and his office
expenses were forty thousand dollars
okay so we have all that all setup all
those guys are there well now if we want
to print out this information it's
pretty easy so system out and I'm gonna
go bread trainee except and what it's
gonna accept to calculate its bonuses is
this
early bonus calculator pass it in there
and it's done it will calculate it then
we're gonna do the same exact thing for
the other type of employees so Tom
salesman also uses that same exact thing
same exact method and the same thing for
Ross the boss and there we are and let's
execute it and there you see trainee is
yearly bonus mm salesman's early bonus
eighteen thousand and bosses yearly
salary or bonus one hundred fifty
thousand dollars so there is an example
of both how to solve the problem that
was sent to me and how to use the
visitor design pattern please leave any
questions or comments below otherwise
till next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>