<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Code Refactoring 11 | Coder Coacher - Coaching Coders</title><meta content="Code Refactoring 11 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Derek-Banas/">Derek Banas</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Code Refactoring 11</b></h2><h5 class="post__date">2013-01-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/m7eXOJofIuc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello internet and welcome to part 11 of
my code refactoring tutorial today I'm
going to go over building a composite
with the Builder pattern now this is a
fascinating refactoring and the major
reason why is as I've done a lot of
research on it I've noticed that lecture
presentations from every major
university that I found blatantly just
copies from a book called refactoring to
patterns the only problem with that is
is the code in the book while the book
is absolutely fabulous
the code in the book is incomplete now I
don't copy blatantly from books what I
try to do in these tutorials is try to
improve on what is written in these
fabulous books so in this tutorial I
will try to improve on how this
refactoring is taught basically the
composites based off of our idea where
we're going to create a tree structure
like you see here on the screen now the
refactoring in the book while it allows
you to create a tree structure like this
it does not allow you to say create a
pair and then jump up and create a new
type of cereal that's just not written
in the book which is fine because that
wasn't the idea behind the book it was
just to give you some ideas on how to
improve your code in this tutorial I'm
going to take that refactoring and
improve it so that you can bounce
throughout the tree structure and create
different nodes as well as children of
those nodes and on top of that add
information on all of the different
products that we create now to really
help explain everything here I'm going
to be going over things a couple
different times but basically I'm going
to be working with two different classes
class item they're going to represent
all the nodes on our tree an item
builder this is going to be the Builder
pattern that's going to structure all of
our items in a tree fashion and just to
make sure you understand this I'm going
to go through what every single one of
these fields and methods do inside of my
program before I jump in and write all
the code here on the screen for you now
item info hm is going to store item
information in a hashmap
so for example maybe I'll have weight
the one string in the hashmap or
key and the value for weight being one
pound I'm going to have a hashmap for
every single item this is not in the
book by the way I'm also going to have
item names that's going to be stored an
item name children is going to be all
the children of this item in the tree
structure ad is a method that's going to
add children items add item information
is going to store information in the
item info hash map to string in my
examples going to return the item name
item information and all children of the
item as well as their item information
and then display product infos going to
return all info for each one of the
items then we get into item builder
items is going to store all items
created in an ArrayList also not the
book root current and parent are going
to be used so siblings and children are
going to be able to be created in our
tree structure item builder which isn't
displayed but it's a constructor it's
going to be to create the route item for
our tree structure as well as assign it
to the ArrayList add item information is
going to add info about the item in the
hashmap add child is going to add
children items or nodes add sibling is
going to add sibling nodes in a tree
structure add item to ArrayList is
obviously going to check the item into
our ArrayList that we have up here named
items to string in this situation is
just going to print out the name of the
item display all items is going to
display item name and its info that is
stored in our hash map edit this item is
going to change to a item object that
you want to work with and that item
object's name is going to be in this
string right here set items parent is
going to set the parent to the right
item in the item builder this is also
going to allow us to traverse the tree
and one method I don't have here is
called get item by name it's going to
return an item object based off of you
passing the items name into it so that
is all that we're going to create in
this tutorial it's a big one if you
stick with it and if you get the code
that is linked underneath the video in
the description you will get this and
you will probably be one of the only
people on earth that understand how to
build composites using the Builder
pattern so let's get into it
ok so I have on our screen here the
class 4 item and here's public static
void main and I'm just going to take
those class diagrams and throw all that
information inside here so the very
first thing I'm going to do is create
our hash map that's going to store our
key value pairs for items
so hash mount and it is going to store
string and string everything's gonna be
stored as a string inside of it and this
is just what I was able to throw
together here just think it on my own on
how to cover this topic and we're gonna
have private string and that's going to
be our item name and I'm just going to
give it a dummy value then I'm going to
store all my children of this item in a
tree so that's going to be an array list
is what I'm going to use here and it's
going to store items so item and
children new array list item and there
we are so we have that all set up then
we're going to provide a way to get our
item name so piece of cake get item name
and I'm going to type all this out
rather than use the shortcuts this time
just go through it nice and slowly and
feel free to leave questions below I
will do my best to answer anyone's
questions and then we're also going to
want to have the option to set item name
by passing a string item name this item
item name is equal to item name passed
in and obviously throw an equal sign up
there then we got to create our
constructor for us here public item it's
kind of it the item name passed to it in
this situation and I'm going to make a
call to super because I'm of course I'm
skipping out on the component part of
this because it would just become too
complicated you could definitely do that
as a homework
believe me I'm covering way more than
I've ever seen anybody else covered in
this tutorial so set item name then I
want to create my hash map that's going
to store all my item information info is
equal to new hash map string string and
I'm going to give it an initial size of
20 because I don't have any idea what
that should be of course because this is
a product sort of database tree hanging
then I'm going to provide the option to
add children to this so it's just going
to be item child node and just go
children add and add that to our array
list and then I want to provide a way to
add the item information for the hashmap
add item information string is going to
be info name like weight or whatever and
I'm also going to pass in a string
that's going to be the actual
information so that would be like one
pound like I said before and then I'm
going to add this to the hashmap hm
by calling put and then putting info
name inside of here and then putting
info inside of there so there we are
that's how easy it is to add that
information to our hash map and then
we're going to go public string get item
information and I'm working off of the
class diagram that you saw there so
that's the reason why I put it up there
and very often when I make tutorials
that's what I do I work off of either
class diagrams or sequence diagrams
depending upon what I want to do and if
I want to get the information from the
hash map I just have to pass in whatever
the item name is well in this situation
I would add or call for weight or
whatever I wanted to call there then I
have to figure out what I want to occur
whenever to string or whenever the name
of the object is printed out on the
screen so I'm going to go string item
information is going to be equal to item
I want to print out the name and then
let's say that I want to do like a new
line there don't know if I want to
continue doing that but we'll see how it
works out and then I'm gonna go item
info hm I'm going to check to see if my
hash map is empty and if the hash map is
empty I'm not going to do this obviously
because I don't have any information in
here but however if I get into this
point I know I do have information to
print out from the hash map so I'm going
to add that information on there and I'm
gonna do that by calling a method called
display product info which doesn't exist
yet so that's going to give me a red
line right there which is fine and then
I'm going to create an iterator it's
going to iterate through all of my
different items I'm just going to call
this IT and children and it's going to
iterate through all of the children for
this item
I love covering so many things in one
video I don't know if you guys love it
as much but it's fun for me and I hope
that you like it because like I said
this isn't exactly
information you're gonna get anywhere
else okay so then I'm going to check
next as long as I have additional
children that I can print out on the
screen I'm going to keep going through
here
I'll item information and I'm going to
get that item information to string and
store that in there because that to
string method is going to give me the
item name and all that other information
which is going to like call itself which
is kind of cool like doing that and then
after it's all done storing all that
information together
I'm going to go item information and
return it okay I think that works all
right so what do I need to do here I
need to do display product information
so might as well just do that right now
so I don't forget so then I'm going to
go public I'm going to be returning a
string obviously so I'm going to go
string product info this is what this is
going to store or just give it a nothing
value right now then I want to cycle
through every key value pair and return
them and to do that I'm going to use
entry set which is a function that's
going to return a set that's going to
contain all those map entries for the
keys and the values let's do that map
and I'm on purpose using a hash map in
this tutorial because I've gotten a lot
of questions about how to use a hash map
so if those people have no watch this
tutorial I guess they'll see this and
then we'll go entry and I'm going to go
item info and cycle through the hash map
I'm going to go entry set which is going
to allow me to cycle through all that
information which is great this is just
an enhanced for-loop you've seen those
countless numbers of times because I
like to use them and product info I'm
going to store so if I want to get my
key from my key value pairs just do that
and let's say I want to do something
like this okay and then if I want to get
my value I just go get value pretty
simple and then let's do another space
after that and that should be good so
I'll save that and then after I'm done
doing all that craziness I'm gonna get
return product info and there we are I
think I got that all right don't see
errors looks good okay and that is all
that I think I need to do for item for
now I need to go down here and right
here in the same file I'm going to
create item builder and what is item
build are going to do remember I said
that there's a whole bunch of things I'm
doing here that aren't in that book that
I mentioned which is kind of considered
like the Bible of refactoring new okay
so there I got my ArrayList it's going
to hold all the items that I'm going to
create and then I need to store my root
my parent item objects and the current
item that I'm going to be working with
so that I can add siblings and children
based off of the location of the current
item in the true structure over that
makes sense so basically for every item
inside of this I'm going to have the
route which is going to be you know the
room element for our tree and then I'm
going to have item current that's going
to be the current item that I'm going to
be working with then I'm going to be
adding things like information in
regards to our children or whatever and
then I'm also going to store parent and
that's going to allow me to traverse the
the tree structure so that we'll be able
to move around in the tree and add
things to it which otherwise we wouldn't
be able to do if we didn't store that
information and then I'm going to give
route name is going to be passed into
this item builders constructor and this
is where we're going to assign route
it's going to be new item and route name
is passed into that guy so that's going
to create the route item element at the
top of our tree and then I'm going to go
add item to arraylists
which I'm going to add here in a second
instead I'm using the class diagram and
that's the reason why I'm not forgetting
everything here that's also why I need
to create that and then whenever this is
created I need to say okay well I just
created the root element so the current
element I'm going to be working with in
our tree structure is going to be equal
to root and the parent for the root
element is also root okay that's the
only time that's ever going to be true
and then what I want to do is store the
parent for my item object inside of our
hash tag so I'm going to hash map I'm
sorry information and then I'm going to
call this parent that's going to allow
me to both test that I'm doing this
right as well as use it in the future so
I'm going to go parent get item name and
I can store that inside of there is a
string see so that's where that add item
information comes from and I don't think
I need to do anything else that's good
alright so now what do I need to do well
then I need a way to store item
information so this is kind of a quick
and dirty
I know there's an easier way to do this
but you know can't always create the
whole world here inside of these
tutorials so this is the first thing
that came to mind I'm just going to keep
this real dirty and simple I'm just
going to get the name for the key value
pairs I'm going to store in my hash map
and the value itself and then I'm going
to call current add item information and
pass over name and value so there we go
got that set add item information right
up add item information I should have
made that capitalized so something to
remember to correct in your code if
you're typing alone I named that wrong
and now I add item information is
correct and no longer gives me an error
and let's also go up here and change
that boom got that fixed as well and yes
that's the only error I had there sorry
about that then I need a way to add a
child element to the current parent item
and I'm going to use public void add
child and it's just going to be passed a
string and then I'm going to go item
child node is equal to new item and just
give it the child string name that was
passed over there that's going to create
that new item for me and then add item
I've been troubled with my capitalized
today to array list so that I can
remember these guys and Traverse and
find them inside of the ArrayList which
I'm going to create here in a second and
then I need to say ok well the current
now is going to be equal to child node
automatically threw that in there that's
cool and then parent is now going to be
equal to current and current is now
going to be equal to the child node so
see as I create a new node in the tree
it's automatically going to make it the
current node that I'm going to be making
all changes to thereafter until I then
create a new child or a new sibling and
that's just refactoring the patterns
book code which is written very very
well ok so then I'm going to go child
node add item information and here I'm
going to store the parents name inside
of this hash map and to get the actual
parent name I'm gonna go parent get item
name there we are and there we are so if
I can add children well that leaves me -
one more thing I need to figure out a
way
add sibling items to my current item
which is stored in the current say when
I see current and all this stuff these
are the guys I'm talking about these is
the things that are being stored up
there so now I want to add a sibling to
it so I'm going to go public
Lloyd add sibling and again it's just
going to be passed in as a string name
because that's all I need because all
the items are created using names so
then I'm going to create the actual item
I'm going to go item sibling node is
equal to new item and pass over the name
for my new sibling object there we go
add item to ArrayList and this is a
really simple methods that's why I'm not
jumping in and creating it right now
you'll see in a second and then I need
to add a child node to my parent element
so I'm gonna go parent add sibling node
and then assign the value of current to
the sibling node because remember as
soon as a node is created I want it to
be the active node so that all change is
made immediately thereafter or done on
my newest node that I create in my tree
so I'm going to go to sibling node dot
add item in formation and this is where
I'm going to store my parent name again
just like I did before so I might as
well just get this and copy and paste
that inside of there so now I'm going to
know who the parent is for this node
because it's gonna be stored inside of
there and I think that's all I need to
do and then I'm going to also add items
to my Rae list I just want to get this
done with so I'm going to copy this
you're so simple this is just going to
be public void item new item and of
course it's just going to be items dot
add I just want to get that out of the
way because it was tired of seeing this
little red underlines up there wants me
new item there we are okay so there I
got that out of the way and that's gonna
get rid of all our red marks right right
right right right right right right yes
good okay so now I know I'm writing at
least good code in a syntax way then
we're gonna go public and string to
string and this guy's gonna be simple
I'm gonna go overturn just going to go
whatever route is to string and there we
are
bingo okay so that's just going to print
that route name out
and then I want to provide a way to
display all items so I'm going to go
display all items like that then I'm
going to create an enhanced for-loop
again
and cycle through all the items that I
want to print let's just say I go
system.out.print line item I want to get
item by name this guy right here and
then let's say I want to put a colon in
there like I did before just to be
consistent say I want to go down to the
next line and then go item and display a
product information this guy right here
there it is and that's going to print
out all of the information that's stored
inside - map which is the whole point of
display all items so let's save that and
then let's I'm also one on one I do or
provide the option for the user this
system to change the node that they're
currently working with so I'm going to
call this edit this item and I'm just
going to say they can just pass in
whatever the items string name is that's
stored inside of it and then I'm going
to do enhance for again so I'm going to
cycle through here real quick I know
there's an easier way but I'm going to
do this for now cycle through here and
try to find a match for my name or for
the name that they passed I'm going to
go if item get item name and then I'm
going to go equals the item name that is
passed in to see if it's matched to any
of the items that I'm using or cycling
through my current enhanced for-loop and
then I'm going to go current is equal to
item and as soon as I make current you
could item that means I'll changes from
now forward we're going to be done on
this current item that I just selected
here so that's good then I want to get
the name the stored parent object and
pass it so that the parent can be set as
the parent in the item builder again so
I'm going to go set item items parent
like that and then I'm just going to go
current get item information which is
this guy right there and then I'm gonna
say parent which is stored in every
single one of these in a hashmap because
that's what I've been doing say let's
Gary here I'm just saying hey what's
that parent stored there and set items
parent I'm gonna have to create here in
a second and I don't need this okay so
get rid of that I'm almost done so now I
just need to create set items parent
which is actually gonna be very easy I'm
just gonna go public void set items
parent and it's going to receive a
string and that's going to be parent
item like that and then I'm just gonna
cycle through here do it and enhance for
like addicted to enhance for loops like
that
say if actually I'm just going to copy
this as well if item get item name
equals in this situation it's going to
be parent items say this guy passed in
here and if it does I'm going to go
parent is equal to I don't I'll say and
this is a parent item and if I did in
class diagram right everything works out
here this should all work so let's go
into public static void main and start
messing with this now the first thing I
have to do inside of here is go item
build or create a new item builder and
I'm just going to call this products
like that is equal to new item builder
like that and so this is going to be my
route I'm going to call it products
there we are so that's going to be the
one and only route okay so now if I want
to add things to this guy it's going to
be pretty easy so let's say I want to
add a new section in my grocery store
for produce a problem I'm going to click
on that and I'm gonna cycle in here and
get add child and then inside of this
I'm going to type add produce like that
and there we go
so added that in and then we could add
another child because if I want to add
say orange I'm going to do this in a
lopsided crazy man or just to double
test my code to make sure it works good
and then let's say that I also wanted to
come in to products and add some item
information for orange because remember
we just create a new node that means
it's a current node so add item
information there's all that and let's
say that I wanted to say okay well I
want a price associated with orange and
I want that price to be one dollar for
orange and there we go just created that
and let's say that I also want to come
in here and say how many stock oranges
we have and maybe we have a hundred of
them in there and then after we do that
let's say we want to go products to
print everything out we just go products
display all items just double click on
it and that's going to cycle through and
it's going to print out every single
thing we got here boom there we go
products and the parent for products is
going to be products because it's the
route a child under that's going to be
produce the parents going to be products
still orange the parent is produce say
right there and then there's all the
information in regards to the product
information so that's cool and we can
continue going through here and adding
additional things and testing out all
the code that we wrote so that's really
cool
do that now let's say that we want to
come in here and go products add sibling
that sibling and this is going to be
added to orange because that's the last
guy that was created so we could say
something like Apple Apple would be a
sibling and we could also say something
like grapes grapes would also be a
sibling of orange in the produce section
and if we execute it you can now see
Apple in parent proto's and grape is
also in there so we know that's working
as well so that's good now what do we do
if we want to add something like cereal
under products so it's going to be a
sibling of produce how do we do that
well I'm gonna go products and we say
edit this item edit this item right here
and the item that I want to edit is
going to be products which is going to
be my root remember this isn't in the
book so this is my code now that I'm
editing this anything that I create new
like if I say okay well I want to create
a new child in the products root well I
can now say cereal and I just did that
so that's cool and then I could also add
information let's let's say add child
now where's child going to go it's going
to go under cereal this time and let's
say a special K which is a cereal by the
way okay so we got that in there and
then maybe we can add some product
information for Special K so we'll say
something like the price for Special K
is four dollars or something okay so
there's that and then we can just hit
this and boom there goes Special K
parent is cereal and the price is $4 say
everything's in there it's pretty cool
and I can continue to bounce around and
do pretty much anything that I'd want to
do and then I could also come in here
like let's say after this which is just
printing out everything if I would want
to just say print just the information
on cereal inside of here so let's do a
system out and let's go and add a couple
more let's say add sibling copy and then
do a couple more siblings for the cereal
so let's say something like raisin bran
and fiber one and then we could do
something also like add information on
this situation let's let's just say that
five ones four dollars and let's say
that raisin bran is four dollars and
special case four dollars let's say that
I just wanted to print out cereal as
well as the information in regards to
the children
neetha cereal I'm going to do that we'll
actually have to add something to it
so after this this is going to be in the
item builder class item builder wait at
the bottom this is something I just
decided to do just on that just for the
heck of it
so I'll here I'm going to go public if I
wanted to print out just information on
a very specific item inside of here
just by passing the items name I could
just pass in the items name inside of
there so item to get then I'm going to
go item to return and just give that a
null value right now and then I'm going
to create an enhanced for-loop
slick through all the items inside of
here and then I could do something like
if item get item name right there equals
item to get like that I like that well
in that situation item to return is
going to be equal to that item and then
after all of this craziness is done I'm
going to return item right like that and
this is going to allow me to go and dump
all types information in regards to any
item inside of my tree so where is my
main there it is so now instead of not
having total utter control in regards to
how this stuff prints out now I did so
if I just want to print out serial and
all the information in regards to serial
inside of this so I want to throw a
newline in here just to separate this
you can see real quick and I can go
products and then I can go get item by
name an item to get and in that
situation when I type in serial let's
see if this works
should work and let's execute it and
there goes there you can see I printed
off cereal and products Special K blah
blah blah there's like a little bit of a
line problem there I'll fix that up here
inside of this I'm going to put the new
line here and then here change this to a
space see if that fixes it execute yep
serial parent products special k parents
cereal price ba ba ba ba ba ba ba so
there is a ton of things in regards to
how to create composites using the
Builder pattern please leave any
questions or comments below otherwise
till next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>