<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Django Tutorial 4 : Django Testing | Coder Coacher - Coaching Coders</title><meta content="Django Tutorial 4 : Django Testing - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Derek-Banas/">Derek Banas</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Django Tutorial 4 : Django Testing</b></h2><h5 class="post__date">2016-11-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/WWa4bzTJZgI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">well hello internet and welcome to part
4 of my django video tutorial in this
part of the tutorial we're going to
focus in on generic views and we're
going to cover a lot in regards to
automated testing if you haven't watched
the previous parts of the tutorial you
have two starting at part two because
this is a progression we're creating
things over numerous videos so
everything has to be set up correctly
otherwise nothing will work and down in
the description underneath the video you
will find a link to all of the code used
in this video along with a transcript
for this video and I have a lot to do so
let's get into it alright so we're
mainly going to be working inside of
five different files we're going to have
URLs py views dot py tests dy models py
and admin dot py and we're going to
start off in URLs dot py and on the
right here we have Google Chrome down
here we have our terminal on Windows
this is going to be your command prompt
and you should use your virtual console
if you're on Windows actually on both
you should use it but I set it up this
way on Windows and either way everything
is going to work exactly the same now
the very first thing we're going to talk
about our generic views now generic
views are normally used from the
beginning and they help you to avoid
having to write a lot of custom code so
what we're going to do here is we're
going to come in here and we're going to
fix these URL patterns so that we'll be
able to use generic views first thing
we're going to need to do is go right
here where it has views and we're going
to change this right here into index
view dot as view and that's all we're
going to change there we are then going
to come down here and change question ID
into pk we'll get more into what we're
doing there with that here in a moment
we're going to come down to detail and
change this into detail view dot as view
and leave this set as detail we're also
going to come down here and change this
into pk and for our results we're going
to type in results view dot as
underscore view and leave everything
else here the same and down here for the
vote section which we created in the
past tutorial we're going to leave that
exactly the same all right so we're
going to save all that
and then we're going to jump over into
our views py file inside of our polls
directory and replace our previous
versions of index detail and results
alright so here we are and we're gonna
go and replace those guys that I said
we're going to replace so detail right
here is going to get replaced let's just
delete it out of there
votes is going to stay exactly the same
so we're going to leave that there
results is also going to change so let's
get rid of that and index is going to
change so we'll go and get rid of that
as well all right so we have a stripped
down sort of version what we had
previously and now we have to go and
create all of those things we just got
rid of now we're going to be using
generic views so I have to come in here
and add the generic module so I'm going
to say from Jango dot views import
generic and make sure this is of use and
then we'll come down here and create the
index view and that's going to be this
guy that we created right here and to do
so we will go class index view pass
inside of it generic list view and this
list view is going to display your list
of questions and that's going to be your
latest question list that we had
previously inside of here we're going to
use the or list the template that we
want to use for this list so we're going
to use all of our same templates that we
had previously nothing there is going to
change and we just need to point at that
template so that it knows where it's
located we're then going to define the
question list that we want to use and to
do so you're going to type in context
object name is equal to and we call that
latest question list then we're going to
define get quarry set which we had
previously for listing our questions and
it's just going to return the last five
questions that were entered and to get
those we just go question we reference
our question model and objects and we're
going to order by their publication date
and we decided that we only wanted to
receive the last five of those and
that's how we do that now we can come
down
and do a similar thing with our detail
view and it's going to display the
details on the object specific you know
to you the question that you want to
show more information on so here we'll
say class detail view and once again
this time we're going to be referencing
this guy right here detail view and then
we're going to create results view and
after that so detail view pass inside of
it once again generic but this time
we're going to use a detail view we need
to define the model that we're going to
be using so we're going to specifically
want details on the model or of the
question for our model once again we're
going to define the template that we
want to use for this guy and that's
going to be in polls four slash detail
dot HTML just like we use previously so
nothing's changing there and now we're
going to do the same thing for our
result view I already told you shows you
what that was so results view we're
going to come in and get generic and
we're going to use the detail view
that's built inside of there once again
we have to define specifically what
we're looking for here we're going to
look at the questions for the
information we want to display and then
here quite simply we just go template
name and we're going to define the
template for this so there's that and we
call that results and that's an HTML
file as well now at this point what we
can do is explore automated testing now
you can either check your code by
entering values randomly and more than
likely miss a bunch of errors or you can
automate the process and now I just want
to take you through some examples here
we'll get into some further examples
later on and we'll explore a bug in the
function we created which was called was
published recently and that is inside of
models dot py and you can see right here
was published recently
now when the Django people set this up
they set this up to give a bad
information ahead of time basically what
it's going to do is it is going to
actually post questions that were
created in at a future date beyond what
our current time is now it's going to
list
them out on the screen as current
questions and this function specifically
even if a question was created at a
future date
is actually going to be listed as if it
was published recently even though
that's not possible
so through testing here we're going to
walk through this bug and try to fix it
and how we're going to test this is
through using the shell so let's open up
our terminal or our command prompt make
sure you're in here where we have
managed py inside of your site and we're
going to import some modules well first
off we have to jump into the shells so
on Macintosh we're probably going to
type in Python 3 whatever you have been
typing and manage type py of course on
Windows you're going to type in Python
and there we are we're in the
interactive shell and what we could do
is import date times because we're going
to need that to calculate our current
time and we're going to also import our
timezone in our module so utils import
timezone we're going to import question
from our models so polls dot models
import question so that we can work with
that and then what we could do is say
future question and go and create a
question inside of here and define its
publication date to some point in the
future so we'll say time zone now going
to give us what we are currently at and
then we're going to say take time time
Delta and set that for 30 days so this
is going to be at a future date this new
question we just created now we can come
in here and check that function to see
if it gives us the wrong information
saying that it's a currently published
question even if though it most
definitely was not we'll call that
function and how you call it is just by
referencing that question you have right
there and it will say was published
recently and see what the results are
and it comes back is true so you can see
right there there is an error in our
system that we are going to correct and
how we're going to book go about
correcting it is through automated
testing now to do so we have to open up
test py create it there and to
youth are shell we just type in quit and
now we're out of it so here we are
inside of test py and once again this is
going to be in our polls directory make
sure you have the right information here
and the very first thing we're going to
do is import the modules that we used
whenever we tested this out in the shell
so we're going to go import date time
from Django utils import timezone and
then we're also going to come in and
call Django test import test case and
what this is going to allow us to do is
to run tests without affecting the data
and how it do is about doing that is it
creates a temporary database for testing
purposes so specifically to test our
question we're going to create a class
here and we'll call this question method
tests and this is where test case goes
inside of there we're then going to put
the code that we created over in the
shell directly inside of here and we're
going to call this test was published
recently with future question now what
we're going to do is create a time that
is going to be 30 days into the future
so we'll go timezone now just like we
did in the shell plus date time time
Delta and days is equal to 30 okay so
that's just a future date now we have to
create our future question just call
this future question is equal to and
it's just going to be a question that
has a publication date in the future and
that date is going to be assigned the
value of time which is 30 days in the
future also an error here because I
forgot to come in and import our model
so I'm going to say from models import
question now I'm going to check to see
if the output is false like we would
expect meaning that it is not going to
say that a question with a future
publication date is a current question
and to do so we'll just go future
question and then we'll call was
published recently
and we will say that the answer we
expect to receive is false and now we
can run this test in our terminal open
this guy up here and to run our test I'm
going to say Python 3 manage py test
folds and it's going to run all the
polls tests and you can see right here
that it failed we expected it to come
back as false it came back as true and
that's the reason why I'm moving out of
a failure here so now what we need to do
is jump over into models pyf and correct
that error so here we are in the models
py file and to correct that error we're
going to come down here this is the
function that gave us the bad results so
we're going to come in here and let's
just get rid of all of this alts well we
can leave that in there hey let's get
rid of it
alright so we got rid of that guy get
rid of this trailing port right here now
what we're going to do is we're going to
go now is equal to and get what the
current time is now so we're going to
say timezone dot now to get that and
then we'll come in and we'll say return
now - daytime time Delta days equal to 1
is less than or equal to self
publication date less than or equal to
now we could save that and now we're
basically saying things that are current
are going to be things that have been
published in the last day and here if we
load this up and we run our test again
now you're going to see that it comes
back ok so it verified the test and
everything is perfect now we can jump
back over into test py and create some
more tests now in the question method
tests will come in here and add a
verification to make sure that we are
only going to say something is a current
published question if it's been
published in the last day so basically
what we just did in the show or in the
art test that we just did previously so
we call this test was published oh and
by the way all of these need to start
off with a word test if I didn't say
that before don't think it so all your
tests have to start off these functions
have to start
with word test so test was published
recently with old question and what
we're saying here is we should return
false if the publication date is older
than one day and to verify that we're
going to come in and say time timezone
dot now - daytime time Delta days is
equal to 30 and we will create a old
question right here to do so just go
question and we will create our
publication date and have it be equal to
time which is going to be an old
question and now we will test it so
it'll say assert is old question was
published recently and we expect to get
false back whenever that is called let's
create another one here we want to
verify that true is going to come back
win this one whenever this guy is called
if the questions been published within
one day so we're going to go test we
call this test was published recently
with recent question and we're going to
verify it once again in much the same
way so we're going to go time is going
to be equal to times own dot now - date
time time Delta hours is going to be
equal to 1 and this is going to be a
recent question being that it's been
published within the last hour and we'll
go and create this once again this isn't
affecting the database at all with these
tests that we're doing we're going to
set the date time to be equal to time
which is one hour from now and now we
will define our tests and to do so we
will go assert is pass in recent
question that was just created right
here and then we will check to see was
published recently and once again we
will verify that that comes back as true
which is what we expect once again we
can come in here and verify these tests
and we did and they all come back as
okay so everything is awesome another
thing we're going to be able to do is
simulate user interaction at the view
level inside of our shell and to do so
what we're going to do
clear this back and let's open up our
shell and have that in here there it is
run it and we're going to import some
modules import Gengo test utils import
setup test environment and what this is
going to do is allow us to access
variable values in our templates and in
this situation we will be using our real
database and to execute it you just go
set up test environments will then also
import a client that we're going to be
able to use to simulate it like it's
running in a browser and to do that you
go to Django test import client and then
alcohol client go and create a client
object now what we can do is get the
status code for our localhost so the
status code for localhost colon 8080
that in part 2 of this tutorial and to
do so first I have to go and call for
that page to be loaded and that's how we
do it right like this and now what we
can do is go response and say that we
want to get our status code that is
response status code with an underscore
and you can see that comes back it's 200
just like status codes do and we can
come in and do a similar thing let's say
we want to get the index for our polls
directory here we're going to use
reverse again so be able to use a
namespace to grab specifically the index
of our polls application for our Django
application so I'm going to get a Django
URLs import reverse and now if we want
to go and load this in our client will
go response clients get just like we did
before reverse and then we'll point at
our index page for our polls application
plus ID off close that off and close
that off and now we can go and get the
status code for that
so we'll just go response status code
and that also comes back as 200 we could
also go and get our content for that
page
spike on the response content you can
see what that looks like we could also
get the value of our latest question
list so we could go response and context
context like I said it's going to allow
us to access specific variables inside
of our template so we could say a
question list is what we are looking for
and that is and it says what's your
favorite color who are you voting for
and what's up so the three questions we
have created inside of our are the
different question objects we've created
in our model and now what we're going to
do is jump over into views py so that it
will not show questions that have been
published in the future so here we are
back into views dot py and I'm going to
import another module here that's going
to allow us to get our timezone
information so I'm going to say from
Django utils import timezone you can use
that down below go down inside of our
index view and make couple changes with
get query set what we specifically want
to do here is return only questions with
a publication date that is less than or
equal to whatever the current time is so
let's just come in here to this guy and
just eliminate all that right there and
here we'll say objects and we use filter
once again then inside of here
publication date for our question two
underscores and then less than or equal
to that's that guy means timezone
followed by now and then we'll jump down
here to the end of this and we will say
order by and we'll specifically say that
we want to order this by publication
date and then we want to limit our
results to just five that reminds me
that I didn't put choices as an option
inside of our admin panel for our Django
application so I'm going to do that and
to do so I'm going to go into it MnDOT
py and I'm going to say choice add
choice inside of there and then if I
also want to have choice be an option in
the admin section I just go like this
and I go
like this and that's simple and I'm done
and just like that I can now come over
here and go to localhost 8000 forward
slash admin and load it whoops I have to
run the server first silly guy
so let's come down here type in quit
close that off and then I can run the
server just like I have countless other
times and now go reload and now you can
see the choices shows up inside of here
so I could come in and let's say we want
to see our questions one of them is what
is your favorite color
and I didn't make any choices for that
let's get back and let's come in here
two choices actually it's increased the
size of this so we'll say that we want
to add a choice and what is your
favorite color and have the choice text
be blue we could then come in and say
save and add another and we come in here
what is your favorite color
and we could say red and saving that
another and what's your favorite color
and say green when let's just keep it to
that and save and continue and now you
can see all of those are all set up
inside of there okay
now we're back inside of test py and
inside of the question method tests
class just like we were before and we're
going to create another function inside
of here and this function is going to
create questions at specified dates that
or you are passed into it so let's call
this create question and it's going to
get whatever the question text is and
then the number of days from now to set
for its publication date and it's not
going to have self inside of there
inside of here we'll create time go and
get whatever the timezone or whatever
the time is currently and for getting
any errors in regards to the time zone
that means in settings you didn't set
your time zone so go do that I showed
you how to do that in previous parts of
the tutorial so I'm going to say time
delta and the days is going to be a but
whatever the days were passed into this
function and then we're going to say
return and we will return this question
object and objects and we'll say
that we want to create this question
object and the question text for it is
going to be whatever the question text
was that was passed inside of it and
then the publication date is going to be
the publication date based off the
current time and the days that they
passed inside of this and now that we
have that set up I can come in here and
add more question tests so let's say
create a new class and this is going to
be called class question you tuss test
case again that means we are going to be
working with a temporary database we
don't mess anything up and inside of
here I'll just create some tests so
we'll get a test index and what this is
going to do is test to see what happens
if there are no questions to show and
basically just create tests for
everything you can think of and then you
can just click on the test and see what
happens and then inside of here we first
want to get a client
so we'll say response is equal to just
like we did in the shell so self client
gets and we will use our name space to
get specifically our index part of our
polls application if we want to check
the status code here we can go self
assert equal and then response status
code just like we did inside of our
shell and we're looking for two hundred
come back from that and make sure that
says assert equal that's how we can do
that we can then verify the response
contains a string so we can say
something like self assert contains and
the response to taste send back to us is
going to contain no polls are available
and also we can come in here and check
if the latest question list is empty so
we could say assert query set equal and
go response context once again is going
to allow us to get values for variables
inside of our complete that is generated
question
list and to verify if it's empty or not
just do it like that now let's create
another one here we're going to make
sure that questions with a publication
date in the past are going to be shown
so call this test index view with a past
question up let's give me an error
because I don't have a cert right there
there right error one away we'll create
a sample question will say create
question and if you want to wear create
question comes from it's right here we
just created that right there no that
can be a little bit confusing though
create question in our sample temper or
a database and it's going to have
question text is going to be equal to
past question and we can set our days be
equal to negative 30 we then get a
client like we did previously clients
get and use reverse to get our name
space provide our name space for our
index which is what we're looking at
here specifically and then verify that
the question that we just created shows
up like it is supposed to so search
query sets equal and then response
context we'll be looking in our latest
question list inside of here and
specifically we will be looking for
question that has the name of past
question which is this guy right here so
we're looking for the guy that we have
right there close that off and then
that's fine and let's create some more
these guys so we'll go define say we
want to make sure the questions with
future publication dates don't show so
we'll say test index view with a future
question once again we're going to
create a question inside of here I will
call and we're going to do that by
calling the create question function
pass inside of it our question text and
we'll call this future question this one
we're going to set the days to 30 so 30
in the future once again we'll get our
client start that
client get points at our index part of
our polls application will then verify
that our response is going to contain
text cert contains and look in the
response no polls are available and then
verify that the latest question list is
empty and to do so we'll say cert query
set equal call response contacts latest
question list and verify that it is
empty and let's create some more let's
go and create another one that's going
to verify that if past and future
questions exist that only the past is
going to show so we'll set fine test
index view with future question and past
question here we'll create our questions
by calling old create question guy and
we'll pass in question text again so
let's go paste that in there we're going
to create two questions this time
so the question test here is going to be
passed question and then we're going to
leave this be future and this one is
going to be negative 30 days from
whatever the current time is and this is
going to be 30 days in the future we're
going to get our client once again so
throw that inside of there and then here
we'll verify the question list only
contains the past questions self
assert query set equal and the response
context from latest question list is
going to contain the question that we
expect it to contain so it's going to
contain a question that we created and
its name is going to be past question
and verify that this right here is
exactly the same as what you put right
there it's a past question close off
that bracket we have right there and we
can also verify that the list is going
to show multiple questions so let's
create another one and let's call this
one test index view with two past
questions and we're going to create two
questions I'm just going to copy this
right here and I'm also going to copy
the response right there just change
these up a little
but so create a question and let's call
this past question one ask question one
and then this is going to be past
question two and let's have this be
negative thirty and have this be
negative five both of them are going to
work have our client that's created
right here and then verify that both of
them show so self assert Korie sets
equal change that to query set if you do
this enough it just sort of gets
ingrained in your head
so we'll say response that that's what
we're looking at specifically we're
looking for context again we're looking
for the same exact thing let's just copy
this paste that side of there it's good
to type this stuff out though whenever
you're first learning because it makes
it stick more in your head and then this
is what we're looking for
copy that paste that inside of there and
here we are looking for two questions
we're looking for past question one and
we are also going to be looking for an
additional question which is going to be
question two
last question - all right so there's a
whole bunch of those guys now what we
want to do is make another test to make
sure that future questions can't be
accessed if the user guesses a URL and
what we're going to do that is over in
views WY and what I'm referring to is if
they in the details section if they
would type in the URL with a forward
slash and then one two three four five
or whatever and try to guess what's
inside of there that's what we want to
block them from doing so we're going to
go get query set inside of the detail
view part class right here then inside
of it we will say return question
objects filter publication date less
than or equal to the time zone whatever
the current time is now and that fixes
that problem now we can go over into the
test file and create some tests to make
sure that this works so we're going to
create a new class inside of here call
this class question index detail tests
test case meaning we're going to use a
temporary database so we don't have to
worry about messing anything up now what
we'll do is make sure the future
question detail pages
a 404 error so if a question they look
for something that doesn't exist or it's
a question that hasn't been published
yet then we want to make sure that they
get a 404 error
so we'll say with a future question we
will create a question inside of here so
we'll call this future question equal to
let's go create question up here throw
that inside of there call this future
question and have it be five days in the
future now what we'll do is open the URL
using the future question inside of the
URL so I'll say reverse and polls and
specifically we're looking at the detail
page here and the arguments we want to
attach to it is going to be this future
questions ID we will then get the
response from our client self client get
pass in the URL specifically we want to
look for and then we will verify that we
got a 404 page for that equal and how we
do that of course is go response status
code and make sure the status code back
came back is 404 all right so if we do
that then we will know we can also come
in and verify the pass questions show in
detail so test detail view with a past
question that's just verifying that
things that should show up do show up
and once again we're going to create a
question for it we're going to open a
URL we're going to do all the same sort
of things here let's copy all this and
then just change couple things paste
that in there and this is going to be a
past question this question that's
already been created and we'll change
this to past question and we'll change
this to negative five in that situation
change this the past question everything
else there is the same we're going to
get the URL just like we did right here
and here we're just going to verify that
it's going to contain our past questions
so a response and then down here inside
of
response we're going to look for past
question and question text and there you
go guys and you can go and verify and
test the way to your heart's content
that is an immense amount of information
about how to perform automated testing
inside of a Gengo and like always please
leave your questions and comments below
otherwise until next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>