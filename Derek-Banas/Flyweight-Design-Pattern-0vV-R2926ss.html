<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Flyweight Design Pattern | Coder Coacher - Coaching Coders</title><meta content="Flyweight Design Pattern - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Derek-Banas/">Derek Banas</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Flyweight Design Pattern</b></h2><h5 class="post__date">2012-10-12</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/0vV-R2926ss" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello internet and welcome to part 19 of
my design patterns video tutorial today
we're going to talk about the flyweight
design pattern so what is the flyweight
design pattern well it's used whenever
you need to create a large number of
very similar objects when I say large I
mean like a hundred thousand instead of
five thousand or whatever you're used to
and you use the flyweight design pattern
to reduce memory usage by sharing
objects that are similar in some way
rather than always creating new ones and
what I'm going to do in this tutorial is
I'm going to shoot a hundred thousand
rectangles onto the screen and often
when using this pattern you hear about
intrinsic state and extrinsic state well
every time I create a new rectangle that
has a color that has already been used
I'm not going to create a new rectangle
object I'm just going to share what has
already been created with that similar
color so that's just going to leave the
extrinsic States which are going to be
the different sized rectangles and all
of the speed loss you're going to see is
going to be in what is extrinsic which
is going to be the different sizes for
rectangle and all the things where
you're going to see a speed improvement
are going to be based off of the
intrinsic state which is going to be
color which all of the rectangle objects
are going to share so let's get in the
code okay so I'm inside of Eclipse and
I'm going to first create flyweight test
dot Java this is also to a certain
extent going to be a review of action
listeners gooeys and drawing inside of
interfaces so of course I'm going to
have to bring in a whole bunch of
different things here Java x-wing and
all of the code that is used here in
this tutorial is available in the link
underneath the video if you want to see
something that's heavily commented to
help you along take a look at that so
those are going to be all the libraries
I'm going to use for this tutorial I'm
just going to get in here and just start
creating this class so flyweight test
and it's going to extend jframe because
we're going to be drawing on a GUI
interface here and I have a ton of
tutorials on this but I just thought
it'd be interesting to do it once again
then I'm going to create a J button and
it's going to signal that we need to
start drawing on a panel and then I'm
going to define my window width equal to
1750
so it fills up to the screen
you'll be able to say it and 1000 for my
height and then I'm going to create a
color array the college shaped color and
I'm going to give it a whole bunch of
different types of color okay so those
are all the colors and that's going to
be based off the intrinsic which means
that every single one of these guys
meaning the rectangles that I create are
going to share a color and if a new
rectangle is needed to be drawn and it
needs a new color a new rectangle
object's going to be created otherwise
they will all be shared with each other
and here is main and it's just going to
call a new flyweight test and then we'll
open up our little GUI interface and
start drawing on it then we need to go
public
lightweight test and then I'm going to
create my frame that I'm going to draw
on and throw my little things inside of
it window width
window height set location relative to
pass that null which means that's going
to throw it in the center of the screen
set default close operation jframe exit
on close that means whenever they click
on the close button in the window that's
going to exit the entire program
altogether and then I'm also going to
set my title by weight test so all stuff
that you've seen before then I need to
create a J panel and this is going to be
content pane and this is going to hold
both the button as well as another J
panel that we are going to create just a
draw inside off content pane set layout
on this to a border layout create
another panel it's going to be my
drawing panel which I'm going to draw
the hundred thousand rectangles inside o
start drawing is going to be a J button
just like you saw above and I'm going to
give it the title draw stuff and then I
just need to go content pane add drawing
panel order layout I'm gonna throw this
in the center copy that
and then start drawing which is going to
be my button throw that to the south all
right so we got those all in there so
now what I'm going to do is add an
action listener for the button so that I
will be able to start drawing the
rectangles whenever that buttons hit
start drawing add action listener new
action listener then I need to define
everything I want to happen inside of
here so I'm going to go public
Lloyd whenever that action is performed
action event
define the drawing panel is where I'm
going to start drawing inside of and
then what I'm going to do is I'm going
to measure how long each of these take
now it changes every single time you
execute this but whenever I use the
flyweight pattern you're going to see a
decreased amount of time to execute it
then I'm going to go for and when I say
executed I mean the amount of time it's
going to take to draw a hundred thousand
rectangles on the screen right here I'm
defining I'm going to draw a hundred
thousand rectangles and there I'm just
incrementing I now the first thing I'm
going to do is I'm going to go G and
this is also going to teach you
something else get random color which
I'm going to create here in a second and
I'm also going to create get random X
random and this is going to be random Y
and this is just going to define how big
are rectangles are this is the extrinsic
now if we could get everything to be
intrinsic which means that we could have
a even smaller number of objects that's
going to make them draw even quicker but
in this situation we're not going to be
able to do that and then just bounce
down here we're going to time this as
well except when I call this end time
this is a way that you can calculate how
long it takes to go through a method and
we're going to go to system.out.print
line that took then we're going to go n
time - start time and that's going to
print out in milliseconds and then at
the end of this put a semicolon and then
after that we need to make our panels
and everything show up on the screen so
ad content pane like that that's going
to make the content pane that contains
both the drawing area in the button show
up inside of the frame that we're
creating the jframe and then we want to
say that we want the jframe to show up
on the screen and that's how we do that
so now what we need to do well we needed
to find get random color so let's copy
that bounce down here and we're just
gonna go private color this is going to
return one of those colors from the
array above that we created early on and
we're gonna get a random number
generator here new random go int random
int is going to be equal to random
generator and we're gonna throw nine
inside of there and don't forget to put
it next int like that and then we're
gonna return shape color based off of
its place in the array and this is what
I'm talking about right see it right
here this is shape color see it's just
gonna
pick one of those colors at random that
works pretty well so that we got that
random color generator then we're going
to do the same thing for generating
random X&amp;amp;Y coordinates so create those
and these are going to be very easy I'm
just going to go private int and then
right here all on one lawn I'm going to
go return cast this to an integer now
random and I'm going to base all x
coordinates based off of window width of
course make sure they don't try to draw
a rectangle that doesn't fit on the
screen and then we're going to do
exactly the same thing here
forget random Y value so if this is
going to be height and of course this is
going to be Y I'll save it got all those
done and we can actually execute this
and there it is right here and we just
click this button I don't know if you
can see it see it says draw stuff down
here click on that it's going to draw a
hundred thousand rectangles out on the
screen there it is looks like it's done
and that took 5,000 87 milliseconds
that's pretty quick so now what we're
going to do is we're going to actually
force a new rectangle to be drawn every
single time we want to use a rectangle
and draw it on the screen this isn't
slowed things down and this would be
before the use of the flyweight design
pattern we're going to do that inside of
my rack Java so we're just going to go
import Java on think that's the only
library we need and then I'm going to go
public class my rect define a couple
things inside here private color it's
going to call it color and then private
int X Y x2 y2 those are going to be the
coordinates for a rectangle change that
to color there we are then when we
create our methods so that we generate a
unique rectangle every single time so
it's going to be past color and then an
integer upper X upper Y copy that paste
that in there and then this is going to
be lower X and this is going to be lower
Y and that's just going to go this color
is equal to color this X is going to be
equal to upper X copy that say Y x2 y2
change this to Y and then change this to
lower and then change this to lower Y so
that's going to fine all the defaults
for a rectangle then when you go public
loyd draw graphics capability for
drawing stuffs going to get passed over
and we're going to say g set color to
whatever the color is
Angi fill rectangles who's going to draw
a filled rectangle on the screen and
there we go and we'll file save that and
we're going to jump back over into
flyweight task Java and we're going to
create a unique rectangle every single
time to slow this guy down dramatically
so to do that we're going to get rid of
this and we're going to create our
custom rectangle is equal to new and
then we're going to go get brand color
call that method get brand X to get a
randomly generated x value and save
themselves some time I'm also going to
get my random Y value and then copy this
paste that in there and there we are now
I have to each random X and random Y
values to create this custom to force
the creation of this custom object that
we want to draw and then I'm gonna go
rect draw pass at the G value and file
save it and if we execute this now if we
look over here this took 5,000 eighty
seven milliseconds let's see how long
this takes
here it is draw stuff just like before
and you can see they're creating this
guy forcing it to create a new rectangle
every single time that took 4170 three
milliseconds so now let's see how much
quicker we can make it if we share
rectangular objects and to do that we're
going to go into my rect again and we're
going to get rid of this all together
let's just throw comments around it and
this time we're going to go public
my rect color color is going to be
passed over to it this color because
remember that's going to be an intrinsic
thing we're going to base all of our
rectangles based off of drawing that guy
right there then when you go public
lloyd draw graphics G I'm just going to
copy this right here and then with this
method when I give G set color and then
G fill rectangle all that goes in there
automatically and file save that well
then what we're going to need to do is
go into we're going to create a new
class called rect Factory Java and this
guy is going to create a new rectangle
if it uses a color not previously used
otherwise it's just going to use a
stored object that has already been
created and we're going to store
everything inside of a hashmap import
Java lot color and then go public class
rect factoring create a private static
final hash map and the key is going to
be
and it's going to store my custom
rectangles and we'll call it Rex bicolor
because they're being stored by their
color and then you get a new ash map and
I'm just going to copy this and type it
out again like that and then close that
so that's going to create our hash map
for us and go public static my rect it's
going to be passed a color and I'm going
to give it a name of get wrecked it's
going to go my rect rectangle I'm going
to be creating here is equal to convert
it to a my rect object my Rex by color
get color and this is just a call up
here to rex by color say rex by color
and then i need to ask it if rectangle
has a value of null if so I'm going to
go rect is equal to new I'm going to
create a new rectangle for it because
this is a new color this rectangle with
this color object has never been created
before and then I need to go rex by
color and put this new type of rectangle
object inside of this guy like that and
otherwise if we already have a rect with
that current color created I'm going to
return the rectangle object that already
exists so now to run all this just go
into flyweight test Java again and then
inside of here we're going to replace
what we already did I go in my rect
create a new rectangle go rectangle
Factory
getrekt which remember is only going to
return a new rectangle object if one
with the color that I'm going to specify
right there hasn't already been created
and then afterwards I'm going to go draw
pass over G and then get R and X call to
that method and then do the same thing
for the other x and y coordinates and
then just change that to Y and change
this to Y I'll say I know that's
executed see if we save any time this is
41 73 and you see it's done and that
only took two thousand and two hundred
and ten milliseconds so we were able to
save a considerable amount of time off
by sharing objects rather than creating
new objects every single time and that
is the flyweight design pattern like I
said before if you didn't catch anything
the code is underneath the video it's
heavily commented otherwise leave any
questions or comments below the last
till next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>