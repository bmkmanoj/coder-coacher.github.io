<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Create a PHP Forum Pt 6 | Coder Coacher - Coaching Coders</title><meta content="Create a PHP Forum Pt 6 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Derek-Banas/">Derek Banas</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Create a PHP Forum Pt 6</b></h2><h5 class="post__date">2011-04-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/VudKt9P3l1g" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">well hello internet and welcome to the
final part of my PHP message board it's
actually become a PHP / JavaScript / -
ql / jquery message board but either way
it's all done and in this presentation
you're gonna see how to put all the
final pieces together to make it work
and at this point whether you know it or
not you pretty much know all you need to
know to create most anything using PHP
javascript jquery and mysql so what have
you learned in this tutorial how to
register you users how to activate user
accounts how to set up capture systems
how to verify user identities and how to
create the login scripts among numerous
other things so what are you gonna need
to finish this off well we got to make a
couple changes to the database real real
simple stuff you need the login script
code from the previous tutorial because
we're gonna be using that almost exactly
to create the form part of the message
board you need the config message board
PHP file and all of this code is
available there's a link in the underbar
if you want to go get it we're gonna
make a couple changes to that config
message board code and also we're gonna
have to create a new file called send
info to server and we're gonna do all
that in this tutorial and here is the
previous login page we're going to be
using this almost exactly we're just
gonna be making a couple changes and
after we make those changes you can see
it's going to be a work in comment board
or message board or forum or whatever
and you can see here never I click on
comments it shows all the comments
underneath I here but it doesn't open up
these comments but if I click on that
I'm going to show those comments and if
I click on it again it's gonna go away
and on top of that if I decide that I
want to leave a comment like who cares
I'm just typing in anything and post
comment you're gonna see comment has
been submitted and indeed if we reload
this guy and scroll down here who cares
and you can see that it went right in
there so this actually doesn't take much
code so let's just get right into it
alright so this is the code from the
previous login page and I just really
have to make a couple changes inside of
here in the script part where I have the
reCAPTCHA options variable what I need
to do is come in here and insert some
jQuery code that's gonna add button
events and get comments dynamically and
allow commenting period like we saw
previously and also dynamically send
comments
to the server so I got to put all that
code in there really not that much and
then down here in the main section I got
to grab all the messages from the server
and display them so that's all that
needs changed inside of there so I'm
gonna just jump into it right after I
make a couple of changes over in the
database and Here I am over in the
database and I changed a couple things
but I'm gonna show you how to change
them on your own and here is the message
table inside of my MySQL database and
what I did differently here is I made it
possible to not have to insert a value
in the subject area because I found that
that was unneeded because whether you
saw it or not subject isn't listed
multiple times so I allowed this to be
null and it also helps me in a couple
other different ways and I also created
this brand new guy inside of this
database called message block what
that's going to do is it's kind of an ID
that represents all of the messages in a
string of messages and what I mean by
that is every single message or comment
that it's placed inside of here is going
to have the same message block so it
allows me to very easily organize them
and how I was able to create those two
things is first to change and allow
subject to have a value of null I typed
in alter or let's keep it all
capitalized alter table
mes si G message modify subject variable
number of characters and I just set that
for 50 just like the floor and a
semicolon whenever I put that in there
by default whenever you make a change to
anything inside of here and you do not
put not null
it automatically considers that you want
null to be a possibility so by not
putting not null in there I now I'm
going to be able to allow null
characters or nothing to be entered in
subject and then to create the message
block the very last thing in the table
I used alter again and I typed in table
message which is the name for this table
and then I typed an add column mess
Blanc int and value of 10 in there
unsigned and a semicolon and that is how
you create this additional piece inside
of this table and then you can also see
if I want to list out all of the data in
there you can see it's kind of a little
bit messy but it's because everything
so blowing up if I stretch this out you
can see exactly right here see
everything is in the same message Blanc
if it's a comment that pertains to the
same subject and then I'm also tracking
message ID user ID topic IDs and dates
and all these other different things so
let's get into the coding area so I
created a new div inside of the login
script and it is called main I'm going
to come in here I'm going to show you
how to grab messages from the server you
just have to understand that this was a
hard tutorial to put together so I hope
it comes across and also I handicapped
myself to only be allowed to use things
that I have previously shown you in
other tutorials alright so what I'm
gonna do here is I'm gonna put a span
inside of here and I'm gonna give it
name class comments sent and what this
is going to do is whenever a comment is
sent a little message is gonna pop up at
the upper top of the screen if you want
to see what that message looks like you
can go back to the beginning of this
tutorial it popped up there but I'm
gonna leave it empty right now and I'm
gonna later fill it in whenever a
message is actually sent then what I'm
gonna do is I'm gonna start putting in
some PHP code I'm gonna say if is that
what I'm doing here is testing to see if
the person is logged in so I'm checking
if the first name is set I'm going to
create a SQL query here select token ID
from users where username is equal to
the value stored in user ID what I'm
doing here is I'm verifying that the
token that is stored in the browser that
they're using is equal to the value that
is stored or the token value that is
stored on our database and that token
value changes every single time they go
from page to page so this is a pretty
good security thing it's not perfect but
it is pretty ironclad and then I'm gonna
perform a query or trigger an error or
not logged in and then what I'm gonna do
is I'm going to check if only one row
was affected since there's only one user
ID or people are only allowed to use a
specific user ID once I know right here
that there can only be one result and if
that's true I want to fetch the result
of this query which is going to be the
token and then here I'm gonna get rid of
the result here to free up some memory
and then what I'm going to do is get all
the messages off of the server because I
can be pretty certain that this person
is now logged in so what I'm gonna have
to do is jump over into another file
we're gonna come back to this here in a
second but I have to jump over into
another file and make a couple changes
and that file is gonna be the config
file all right so now I'm in the config
file and you've seen this before
it's config message board to be very
specific and all of this stuff is going
to stay the same nothing here is gonna
change right up until this point and
here I'm gonna put a function inside of
your called retrieve messages you just
saw that and here all this is gonna do
is retrieve messages from the server so
I get a jump inside of this guy and I
think now you might understand why I try
to cram everything into one file because
it can get confusing to explain this
stuff and here I'm just paying reference
to the database that's all I'm doing it
and now I'm gonna create a new query
select M which is going to be a
reference to the table called message
and I'm gonna get the subject message
text username and you as a reference to
the users table you get the date that it
was posted I'm gonna get the parent ID
and user ID I'm gonna get the message
block and then the user ID for the
messages itself and I'm gonna get this
from the table called message which I'm
gonna refer to as M I did that for
shorthand reasons and also I'm going to
retrieve information from users as you
again shorthand reasons why I did that
we're and here I'm gonna say m dot user
ID is equal to the U dot user ID so I'm
making certain that the user in the
users table is the same user that posted
the message and I'm gonna say order by m
dot message block and then order them by
the date that they were actually posted
and then close that off so that's the
query that I'm gonna create and I'm
gonna say result is equal to MySQL query
and I'm gonna just issue this query for
trigger and error if there was one
trigger not trying and I'm just gonna
say and error happened
just to put anything in there and then
what I'm gonna do
let's go if my SQL again checking that
the affected rows from this query is
going to be greater than 0 and if it did
here I'm going to put something in here
tags which you'll see in a second one
exactly that says and then here I'm
saying that while there's additional
messages it came back from this query
and we're inserted into an array I want
to continue to cycle through them and
I'm gonna say if messages this is the
messages array this guy right here well
I'm gonna be able to actually get all
that data from the database from it if
the parent ID is equal to zero I want to
treat that information differently what
do I mean by that let's open up the
database see over here parent ID is
equal to zero that means that it was the
very first comment that was posted
inside of here everything thereafter is
going to be a number until it's the
first original comment so that's what
that's checking cuz we want to treat
that differently so if that was the
parent what I'm gonna do here I'm going
to show you what tag switches for I'm
gonna say tag switch I'm gonna put a div
around this guy meaning the original
comment and I'm gonna say here print out
a closing div statement or if this is
false I'm gonna print out an opening div
statement and I'm gonna give it a class
equal to comment box so it's just gonna
create a custom div based off of whether
this is an original comment or not
that's all it's gonna do and then after
it does that it's going to go tag switch
I'm gonna just change the value of this
to the opposite of whatever it is that's
all I'm doing that allows me the ability
to create custom opening and closing
parts for my div just something I hacked
together well then I'm gonna want to do
additional other things like for example
turn out this object which I'm not
always gonna do and then close off the
paragraph tag there and now pronounce
the subject this is from the messages
array the array that was created
whenever I created the query that got
all the messages from the database this
is just printing out custom code to the
screen via and then here I'm going to
create the actual comment word that
whenever it is clicked on it's going to
trigger a call to jQuery I hope this one
this is understandable it's just very
hard to explain things this complicated
in a video tutorial you have to
understand that then I'm gonna creative
of class time equal to comments and this
is where the form that will allow people
to
comment will pop up and here I'm going
to create a text area just basic HTML
you're looking at here and this is going
to be called comment and I'm gonna give
it columns equal to 60 and rows equal to
I don't want ten and here is the default
text that's gonna show up I'd like that
echo and here I'm gonna put all a whole
bunch of hidden values which is going to
be information I want to pass to the
server there's another intricate way of
doing this but like I said this is kind
of getting a little complicated so I
didn't want to make it even more
complicated in here I'm going to pass
the username again all this was taken
from that query that you saw above and
then what I'm gonna do is copy this to
save myself some time and create six of
these I'm gonna put a space between them
actually okay I got six of them right
there let's put a space here too okay so
now I'm gonna just change what I'm going
to be passing okay so I'm passing
username I also want to pass over the
parent ID and there's parent ID and this
actually is going to be equal to one
remember parent ID for an original
comment is always zero so anything else
is going to be considered a regular
comment hopefully that makes sense then
I also want to pass over a message block
right like that and I also want to pass
over the token ID and the topic ID so
I'm just changing these values and the
user ID and then I have to put in almost
done here actually I'm gonna echo out
the screen button type is equal to
button it's gonna have an ID equal to
one button post comment which will show
up on the button and then I got to close
off my form and then I have to close off
the div altogether right like that now
in circumstances whenever this is not
the first original comment this is
actually gonna be real simple I'm gonna
echo to screen div class and it's equal
to comments and I'm going to echo to
screen messages message text which is
going to be the actual message the
person left echo via it's gonna be the
name of the commenter their user name
and then echo the closing div and then
close off everything and you're done and
those are all the changes you need to
make to the file called config message
board dot PHP and in all of those are
all
so all this code retrieves all of those
messages so now I need to jump back over
to the forum part of this guy which is
right here and I'm gonna continue that
was retrieved messages you just saw that
I just created now what I'm gonna do is
I'm gonna kick the person out if their
session is not active or they're not
logged in this is simple session token'
underscore ID here I'm checking the
result meaning the zero index of the
array that was created up here see Row
is right here this is an array and part
zero is going to be the token ID so if
the token ID that's stored on the
browser is equal to the one that's
stored on the database I'm gonna come in
here then go to logged in is equal to
one just as a note to myself later on
and if it token ID is different than the
one stored on the database well we want
to perform a completely different action
which is to kick the person out so they
want to say better this is how you kick
them out and change the location and I'm
going to type in localhost obviously you
probably won't unless you're doing this
on your computer and not on a server
somewhere so if they're not logged in
I'm going to send them to the login page
and tell them to login and then I'm
gonna say MySQL close and exit out of
this script and this is done I just need
to close off this else statement and
then close off the other if statements
and we're finished with that part now
what I got to do is if you remember
whenever I was in the config guy over
here I created a button and that button
is right here and it's called one button
what I'm gonna do is I'm going to create
over on my message or my forum part of
my program I'm going to put in some
jQuery code so scroll up in here to the
script area right in here where our
reCAPTCHA options is located and then
inside of here we're gonna write some
jQuery code so I'm gonna hook up some
events to one button and with jQuery you
bind events with the bind function in
the event I want to bind is a click
meaning they click on it and if they do
click on it I want to call dynamically a
function called send info to server so
we're going to dynamically send
information to the server using jQuery
and under here what I'm gonna do is I'm
gonna say the div with the class called
comments I want to hide all of
them whenever the page is loaded so that
is all the additional comments meaning
these guys whenever this page is loaded
they are all hidden so that's what I'm
talking about this this down here is
what I am hiding in the code that I'm
showing you then what I'm saying is I
want to target a link of the class get
comments and if it's clicked on meaning
this is going to be the link called
comments over here this guy right here
is what I'm targeting what I want to do
is I want to get any clicks on it and
run some code on them I want to say this
meaning this link I want to target all
the siblings being all of the divs with
the class name comments and I want to
toggle them meaning I want to show them
or hide them based off of their current
situation and then I want to return
false here and then close this off so
that's just gonna toggle whenever the
comments link is clicked on all right
now what do I got to do well I got to
create the function called send info to
server so I'm gonna go in here and go
function so I didn't photo to server not
actually gonna put anything in there and
what I'm gonna do this is what we call a
jack in that span that I originally
created I called it comments sent what
I'm gonna do is I'm gonna load into it
comment submitted or comment rejected
based off of whether the person was
logged in or not and using load what
this is gonna do is it's gonna actually
call the PHP program that is right here
and execute it and what I'm gonna do
here is say that I want to target all
the values that are stored in the form
with the ID form and how you do that is
by calling serialize array like that and
what that will do is it will send all
the values that are stored in the form
with the name the form and then that is
all the changes that need to be made to
this forum page altogether that's it I
know it seems like a ton but it really
isn't that much and then all I need to
do now is create the file that is called
sending photo server so let's jump over
here and let's start making it it's not
actually that long and you're almost
done if you're still there I'm gonna do
is go require once and remember this is
a different file so it doesn't have
access to the database without calling
the config message board or PHP file so
that's in essence what this guy's doing
right here call
then what I get to do remember I said
all the values in the forum are gonna be
passed to this guy well I'm going to
scrub all of those guys meaning I'm
going to send this to the escape data
function and it's going to perform some
cleanup duties on this code and I'm
actually going to copy this and paste it
a bunch of times right like that I'm
going to change you to T ID and that's
gonna stand for topic ID and then I'm
gonna make this MT and that is going to
stand for comment and its message text
is what that is
PID so what I'm doing is just cleaning
all that information is being sent from
the forum parent ID this tells me if it
is an original comment or a non original
comment message block it's going to tell
me exactly what subjects are being tied
together here and token and there's
token then what I do is perform a query
we call it query one I'm gonna say what
I'm doing here is verifying that the
user ID and the token ID on this system
are the same again this is for security
reasons from table called users where
user ID is equal to the value that is
stored there and I verify that the token
ID is the same as the token that's
stored there right like that
that's the query so I gotta go get the
result I'm gonna call this result to
call the MySQL query function which is
going to run this query on query 1 or
trigger an error if it's not right here
I'm gonna verify that only one row was
affected and if only one row was
affected that means the token ID and the
user ID both match so then what I can do
is run the query that's going to
actually put the message in this guy
this is gonna be called 42 and what this
is going to do is actually insert all of
the information into the message table
so I'm going to insert user ID topic ID
message text or the actual comment that
they make date or an ID and the block
that the message is contained in and
these are the values I'm going to pass
in well the now function is going to
insert the current date and then finally
message block then I'm going to scroll
this up and I'm going to trigger this
query using the MySQL query function and
if it doesn't work trigger an air
Minako to screen if the message has been
sent or the comment I'm gonna put that
in the spam that we created previously
then I'm gonna exit out of the script
and exit out of my school actually I
should probably put those in reverse
direction but either way else if the
message was not submitted I'm gonna put
in here has been declined so that they
scratched their head and wonder what
they did wrong don't want to draw blame
into myself if I can avoid it
and there you are that's all the code
that you need for this whole entire
thing now everything will work again
it's available in the underbar so what
have I not done to totally complete this
whole message board well I don't have a
create for our forgotten password script
however I provide a link here to a place
where I actually teach you how to make
one of those you could of course make
this a hundred percent dynamic using
more jQuery and of course I have a
jQuery tutorial if you haven't seen it
and I could easily turn this into a chat
system pretty much by just using a
JavaScript function called set timeout
that would then call a function called
get new messages or whatever you'd want
to call it every five seconds or however
often you'd like to do it and then go
and retrieve those messages
automatically and also I did not put a
place inside of this message board for
you to create a new subject or a new
question what have you on purpose didn't
do that this is what I call homework I'm
also with this tutorial trying to figure
out how many people actually like these
types of tutorials because a lot of
people asked for them but I don't really
believe many people aren't watching them
and in the time that it takes to make
tutorials this extremely long and this
extremely complicated I could actually
probably make 10 easier ones that could
potentially be a lot more useful to
people so I'm kind of using this as a
template and if I don't get any comments
on this tutorial I am going to guess
that that is because nobody waited and
actually watch the whole entire thing so
this tutorial is kind of going to help
me decide how to teach in the future if
you have any questions or comments leave
them in the comment section below
otherwise till next time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>