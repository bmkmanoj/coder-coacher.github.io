<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>M04-Part5: Uploading image to s3 with React-Native and presignUrl | Coder Coacher - Coaching Coders</title><meta content="M04-Part5: Uploading image to s3 with React-Native and presignUrl - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/EQuimper/">EQuimper</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>M04-Part5: Uploading image to s3 with React-Native and presignUrl</b></h2><h5 class="post__date">2018-02-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/bFkoRSco3_I" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everyone welcome to the point
number five of this my so number four so
what are we gonna do for today it's now
we can choose a photo and enter some
caption but we don't upload any photo
yet so so this is what we're gonna do
finally so what I want it's when I start
type here I want a nut one eye so to
type but I mean when I came to this page
I want to add a shape button right there
and what I want it's if I click here I
want to applied this image to Amazon s3
bucket so the planets you we need to
fetch the server also ever forgetting
the s3 you remember this prison URL we
have here after that we're gonna get
this upload URL why are we going to push
the photo from XML request and after
that what are we gonna do is we're gonna
save that work for now and for the next
six up we're gonna just push that to the
database in the server so what are we
going to do first is go inside your
screen capture on screen indexed and now
right there what are we gonna do it's
first thing we're gonna upload like this
next button so right there we're gonna
do this that props that navigator that
set button and right now we're gonna see
right button to be an array of wire or
someone gonna have an IDE R share pose
then we're gonna say title of shirt just
to get this share text finally and here
we can say animated to be true right
there okay so now if i refresh my screen
what's gonna happen it's if i click
you're gonna see sherry happen right
there what i think also it's when we
push right there you can also pass that
but i think it's going to be just
employed to get that right there so now
what we can do here
it's after that we need to bind this
stuff in having a function so what i'm
gonna do it here i'm gonna have a
function called sure post
like that and here you can also say
shirt maybe it's a phone it's an action
so we can say on shirt post press like
that and now what do we want it's inside
the constrictor so we're gonna put the
concept are super props and we're gonna
do like we did on the other episode so
what are we gonna do is we're gonna take
this line of code right there in there
create for the whole screen while we
bind a navigator even here I'm gonna
just say this that's taylean I'm gonna
take this round right there and now I'm
gonna create this function on navigator
even so if you remember this one get an
even and not even but yeah I think it's
even here and now here they do we do if
either type equal equal nav bow button
press and if II that ID equal and now
the idea of the buttons or share post
here what we're gonna do is we're gonna
call that this is the unsharp post press
right there okay so now just for singing
work we're gonna put that console log
hello and I'm gonna take my react native
debugger right there and I'm gonna make
it a bit not that much like that I'm
gonna clear it and now if I click on my
next on my share button we supposed to
CLO if atomically perfect this is what
we want now what we want is we want to
create the query so the same query we
have right there okay so now what we can
do for that
it's we're gonna import JQ well from
graph QL tag and we're gonna create that
right there we're gonna say cons s3 sine
s3 and like that tree equal GQ well it's
gonna be a curry and now you know what
why not just copy and paste this pre
sign URL right there so present URL URL
and upload well this is what do we want
and now all can we call not from the
component did not because if you put
that inside a graph QL i order component
right
we're gonna get that as the component
didn't mouth uh oh I find it it's gonna
use something called with Apollo coming
from react Apollo and this one I'm going
to show you something this one when you
wrap your component like that and you
control all your props my props
there's the props look what's gonna
happen we're gonna see inside that we're
gonna see exactly
next my props well now we get access to
the client and the client have something
called chewy so now this is what we can
do so now what we can do right there
it's called the decree by doing this
that perhaps that client that Ruri where
you can pass a curry and you can pass
your sign is trickery like that okay
but this thing is going to be any
synchronous cow so we can put a sink
sink urns wheels a rest equal away this
value okay and now I'm gonna put this
next to the ello or I can just say Ria's
like that okay so now if everything is
work what I'm going to click on share we
are supposed to see the mutation coming
in from the server so what are we gonna
do first
it's add my server running I'm gonna
click share and you see we get that and
look boom that's it so we see it's
pretty fast also so if I click I get
that right away
I love Phoenix so now we have the pre
sign URL so you see we get that as the
rest that data that present URL upload
URL and blah blah so now we have all the
stuff but now oh can we upload this
stuff so what we're gonna do is we're
gonna create a new youths ill upload
image that GS okay and now be ready to
code we're gonna have at least I think
almost like 3540 line of code maybe less
and now here what we're gonna do is
we're gonna start with a function call
so that's going to be anything function
call upload image okay
and we're gonna have another function
Google we're going to export and it's
going to be called upload image to s3
and yeah I mean we can do the same here
adjust currents equal anything helps you
think like that and I miss the arrow and
just to keep it simple
yeah so we have to function here both
gonna be synchronous okay now what I
want okay so we're gonna go I don't know
you say that in English but back forward
like I mean we're gonna go we're gonna
start from the end and go to the bottom
so what we need it's this function here
is gonna be the function we're gonna
call inside the caption screen okay so
my plan here it's what I call the
caption screen I want to pass my upload
URL and what I also want to upload is
the image so I want to push the image
first and after that I'll float variable
so this function here gonna receive two
things the image and the sign s3 objects
so this full object we get when you we
click Next okay so this full object
right there so now what we gonna do with
that it's this thing here we're gonna
avoid the upload image function we're
gonna create okay
and finally my plan is to return right
there
the image because the URL is gonna stay
the same so if you want to show this one
but also we can add the remote URL who's
going to be equal to the sine URL that
URL so that's gonna be this URL right
there I don't know if you follow what I
mean it's like because if you upload an
image to the web okay to the s3 that
time you go there and you fetch it with
react native you gonna have some kind of
blank screen so that's why a we just
want to return the image whole thing
here this image okay
this image
all the image inside the local phone
okay so it's already there so that's why
I want to use it again okay so now I
think it's going to be time to work so
now this function here when I receive
tree argument the method a URL in a file
okay and this method you're gonna return
a new promises while here we receive
resolve and reject like every other
promises you have certainly build and
now right there this is where we're
gonna do some kind of magic so for those
who don't know XML requests I will
really would like you to read this stuff
here
it's a finally it's a way to send some
kind of of data finally and you can be
good for sending file and thing like
that and this is the way I'd like to
send my image so here what we do is
we're gonna create a new instance of
that so we're gonna call that X H R
equal new XML request now what we're
gonna do it
it's H R that open okay so this open may
turn right there
you need to receive the meta you need to
receive a URL like that after that you
see this is all you need to start to
read this stuff I think about doing like
a flow type and type script tutor or
something like that I think I have
already a flow type one but more deep
its when they say is sing / with a this
interrogation point that means this
thing can be undefined that so that mean
you don't need to pass them that's it
but one not like that you need so now
this way I'm gonna say each H X H R that
set request a dart so we're gonna set
the request header and now we're gonna
say content type it's going to be equal
to the file that type so the file that
type we're gonna put show that's going
to be amazed at GPA so am on what we
done on postman and are we're gonna say
in a new line unload okay so this thing
it's when they even start so it's a
narrow function like that and now here
we can say if each HR that stereos so we
know now it's it's finished okay we're
going to say if the side is it's not
equal to 200 yeah now we can reject the
premises with a new error where we can
say finale request fail we can say
status and now here inside each HR X H R
we have service and we can see maybe
like content and now I will say X H R da
response text just to give us a way to
debug if you get an error are key so now
outside of the F here now we know that
work so we can resolve the result with
the premises with each HR xhr response
that text again and finally we can send
the file right there
okay a lot of code but yeah so now now
what we can do for the with this stuff
okay it's going to be to put you the
metal so that's going to be a put
request because you remember the URL is
already create so finally amazon create
the URL and wait you to push that IL
inside that so it's a put request it's
not opposed so so here we're gonna put
that and now here for the URL we know
we're gonna get that from the sign s3
dot upload URL so this thing right there
so upload URL and for the file we can
add aur e of image so the image here and
we're gonna have a type so that type
we're gonna add right there image that G
peg okay lot of code but trust me I mean
it's a really nice one I mean you don't
put your credential in the front
just some kind of request and now here
what we're gonna do okay it's now we're
gonna import from my user folder upload
image and the one we want to upload is
the upload image s3 okay first thing I'm
going to show you my bucket right there
only to image so this is the two image
we have practice and postman and now
what I can do with that it's inside my
my share post here now because we know
we have the rest so now what we can do
here it's we're gonna create a new
resolve from s 3 like that result from
s3 and now we're gonna say avoid upload
image to s3 and now remember we need the
image and the sign is tree right there
so for the image that's gonna be the
same value of the image right that we
have put like that and now here for the
for the data you need to remember then
we're gonna receive rest that data that
present URL so where's that data that
pre sign URL like that okay and now if I
log my result from s3 like that and we
try it like that okay make it a bit
smaller so now I'm gonna go here and I'm
gonna share and now look what's gonna
happen take some time boom we get a
result right there
and now you see we get a remote URL okay
so if I copy paste this remote URL right
there and I remove the quote I click
enter boom I have my image and now if i
refresh right there I'm gonna have my
image right there so now if you want to
retest again you can maybe say I want to
send this one and I'm gonna click share
inside my debugger now I'm gonna receive
a new one not a new one once it is right
there
remote URL paste that right there boom
boom
and now we get that brand-new image and
now here we are supposed to ask for
image I don't know why not showing c5 do
we get the same
yeah pretty strategy we get that same
URL back when we call so this is what I
think a pen is the show we get already
the result so if you want to test again
I'm gonna just refresh but don't worry
we're gonna just push the user back when
you have finished their share so now we
are supposed to receive a new image
right there and now this one is not
supposed to look the same so now if I
paste this one now I get this one and
now if i refresh it and I'm gonna get
four perfect so you see that's why we're
gonna push back the user to the the
photo to the photo screen so that's it
for this one so for that the next one
we're gonna let the user write a caption
share when all the stuff we just did
it's done we pushed the DB when the DB
confirm we close this model and that's
it for this kind of feature we're gonna
add the tag after that and yeah so I
hope you enjoyed this little tip design
and we're gonna talk in the next one the
Qunari bro back</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>