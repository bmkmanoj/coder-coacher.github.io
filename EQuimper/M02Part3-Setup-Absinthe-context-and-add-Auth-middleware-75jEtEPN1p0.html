<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>M02-Part3:  Setup Absinthe context and add Auth middleware | Coder Coacher - Coaching Coders</title><meta content="M02-Part3:  Setup Absinthe context and add Auth middleware - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/EQuimper/">EQuimper</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>M02-Part3:  Setup Absinthe context and add Auth middleware</b></h2><h5 class="post__date">2018-01-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/75jEtEPN1p0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everyone welcome to the poor
number three what we left in the last
one was this thing here where I can
finally logging and I'm gonna receive a
GWT token right there so yeah so right
now okay we received a GWT but hey I
mean how can I make sure this is now I
mean secure so what I'm gonna do is I'm
gonna open another tab doing command T
and I'm gonna run irfan and adjust the
comment to run all the photo and I'm
gonna see like example caption my plan
now it's when nobody have the GWT ear
not be able to see the photo this is all
we gonna test it and not worry about the
testing part I'm gonna show you all we
can write tests and everything in like
is own milestone so that's gonna be a
milestone about testing so yeah so how
can we do this so now we're gonna need
care another meter wire so something
we're gonna stop one day user is not I
could use or NLE so what i'm gonna do it
i'm gonna create account I'm gonna clean
my context to make it secure so inside
my program web I'm gonna create right
there a file call context let X this one
is gonna be in Siam web context so
that's gonna be the context and here are
really 8 when that happen here what I'm
gonna say it's amp that's gonna be
plugged so for those who have done it
serially before you can add many plug
here and create you unplug you can think
about the plug like a middleware and
nodejs
so here what you need it's to import
plug that curl or the connection you
what we're gonna do is we're gonna add
es the Instagram that out the thing we
have green in the last one pizza and now
I mean you need when you create a plug
you need two things you need in it
why you don't need this an ear because
the way I'm gonna handle that is I'm
gonna sit there in yet Hui receive some
option and what I do is just returning
this option and here I'm gonna have
another one a color you're gonna receive
the connection and the Australian
argument we don't need that now this is
the to function always needs inside a
plug so all this stuff again you can
read that like you can I'm gonna put
some documentation about about blog and
stuff like that in the description
that's gonna be something like that
where you get like all this information
like what is a plug plug like what they
do and thing like that and gonna see how
awesome they are and you see this
documentation about Phoenix you really
need to read everything and the thing
about this I like about this
documentation about Phoenix is one of
the I think is the best documentation I
have ever found online and you see if
they have the overview where if they're
gonna talk about why the queer Phoenix
what they have done the input is the
controller and blah blah blah well okay
what is cowboy
Plourd like tone thing like that after
that the thing is they have a guide with
the up and running so you can like
create a project just by following all
this stuff and you go one thing at a
time
it's awesome I'm gonna put this link in
the description okay so now we have do
the contacts area but what we need you
so now here what we're gonna do
its ear I'm gonna call a function well
I'm gonna call that dual context so this
function gonna be the one where we're
gonna build a con the context so here
what I'm gonna do is I'm going to set
context equal bill context we need their
connection and this one just for helping
us working with that I'm gonna call you
that inspecting about console work when
I'm going to see context context so
that's gonna let us I wait to see what
is going to be
context another thing I forget is inside
the Facebook just go here and remove the
IO inspect yeah maybe you don't have it
I have put I think and now here we can
have the context and we're gonna shoot
the context right there so what are we
gonna do with the blue context hey what
are we gonna do it we're gonna do a with
statement so we're gonna do a width what
are we gonna say it now okay for those
who have don't do a lot of NX here
that's gonna be maybe maybe looks pretty
weird but follow me here first thing
it's when I'm gonna add the GWT in the
door sorry no it's I'm gonna oh you say
that like put there are in front of my
GWT like in my adult role in JavaScript
with the GWT like that but now that's
gonna be bearer and now area I'm gonna
put a space and finally what I mean it's
a one do like to get the token so what I
mean it's here I can finally take
whatever you're gonna be after this this
string so all the stuff after this space
to become a variable token so I can make
use of that so I don't even know I can
call that but string not string
interpolation but like kind of I mean
you can be like I can get this variable
from that you see what I mean so so if I
have a bearer like that this thing here
then I become token so that here we're
gonna do a get req either return the
value of the request add or specify by
key so now you're gonna on the someone I
mean it's you need to pass the
connection but I said I need to pass the
key and the key gonna be authorization
so that's gonna be which key you're
gonna search one we're gonna do here
inside the others right there so that
we're gonna put a coma I'm gonna create
a new line like that no so I'm gonna
just say and already and now here I'm
going to say to polio
okay and I'm gonna get the cures are and
my plan needs to get this cures are
committing from a function I'm gonna
call authorize would this one that I
just receive the token from here and I'm
gonna call I do this function authorize
now we see the token I'm gonna do a case
statement what I'm gonna say out so the
outer IDs here the Gordian I don't know
why I don't have the autocomplete okay
giorgia dot decode and verify it's
another function inside the rhodium I'm
gonna do it do like that
and on this one gonna put this case so
the decode and verify ear gonna give us
finally like gonna verify then the token
is good and if it's good gonna give us
like finally the payload and we need
finally to say okay and claim so right
there on the out the Guardian that
decode but resource from claim while
here we passed a claim so if you follow
what I done it's right here but Guardian
right there this function here resource
for from clean okay here we're gonna say
so it's a key state monarchy so you need
to understand and when it's okay here
we're gonna do this thing about like
almost like a switch or something like
that I'm gonna have to eating I'm gonna
say when it's an error
we can have a reason and I want to
return the error and the reason when you
return here another tuple with an atom
err err err err graph QL gonna give us
as an error in our ear we're gonna sit
when he gets fine anything nothing we're
gonna say error and that gonna mean unit
arrives so what that mean here is when
we have a user will return our key with
the user so that mean okay he can go
when we have an error maybe because I
don't know the server is not on or
something like that I'm gonna get the
reason here but when is auto return like
except for this is not a real user the
GWT is not good or thing like that
you're gonna get you know to rise okay
so now I'm here so I get the ok careers
are so when this thing get caught so now
what I can do with their just returning
this thing by doing careers are here
user tada
else I'm gonna do pretty weird oh I get
indent one sec take me this and yeah
okay
else that mean we're gonna add an error
and we're gonna go with unit arrives you
know to rise you can have done here like
reason and sing reason I'm gonna keep it
like that for now and other stuff like I
mean yeah when it's not near I'm gonna
return the thing that just mean the user
is not a tactic it at all so just return
it and empty context okay now it's good
okay now we have the widt below context
but now how can we use it
so we need to thing to do yeah we're
gonna do a foot private would say finale
assign and you private key and value in
the connection and everything about that
like you're gonna just like a keep in
mind who's gonna be the user ear and
this is what apps I'm gonna need so
we're gonna say app sign here the whole
thing you wanna you want to get the
days like that nothing more so you're
gonna take the context we just built
here so all this stuff plus this stuff
gonna get now in the context of app sign
now what we need to do it's good inside
your router and inside the router we
need to add one thing it's gonna be
after this plug AK except reasons you
see it's already another plug we're
gonna say plug Instagram where that
context to the plug would just create so
now if everything is still work I shall
at least be able to refer this thing
okay perfect don't get me stick that's
good that's good okay that's good
now example all we can do this it's now
I can log but you see when I learn you
see what happened my context dear it's
empty and that's why that's like I told
you when I pain it's now we get here we
get this is not okay but this is not
Neal this is just we have nothing so we
get no user that's because I have no
others so now all we're gonna manage
that it's now I'm gonna copy paste that
and I'm gonna go inside my other query
right here this one we can say get
photos you have easier to follow and
this one we're gonna call that logging
do the bulk it and now here I'm gonna
add authorization I'm gonna put that in
there in front and paste I'm gonna say
okay now you follow me when I clear this
one I'm gonna run my graphic you'll you
know run now what I pen oh I get my
contacts and now what I got
I get the true user the full object from
my DV the thing I need careers are is my
avatar my email first name last name and
you see the user name has nothing the ID
insert add and everything I need here
you can have maybe like example here
it's maybe not the best practice what
I've done right there but you can have
maybe like example right there when you
get the the user or the resource to have
we're like I get user for GWT or
something like that and just putting
there or you can also just I mean do
whatever you want but if for now I'm
gonna just put the user I I'm gonna just
put the full user okay but now you see
right now if I remove that okay I'm
gonna remove this one i'm gonna click
again i can keep to going to the photo I
want to see you know to rise so all can
I do this we're gonna need to go inside
the schema so ear is going to be now
another like we're gonna need to create
like another step and that's going to be
to create a middleware for app sign to
make sure that apps I'm gonna check if
we have the context to make sure then
they we can let the user pass away like
okay you can go there you can go there
blah blah blah
that's gonna be a media where none let
upload so what we're gonna do is we're
gonna create in the schema a full door
called middleware because that's gonna
be me no word for the schema and we're
gonna see here authorize that e^x this
one is going to be a module and teiegram
where I'm the schema the middleware dot
authorize here we can have a behavior of
AB sine dot middleware middleware in the
app custom resolution behavior on a fire
fill here we're gonna need a cull
function this one you're going to
receive a resolution so use Aleutian and
again I receive also just resolution
yeah now what I'm gonna do is I'm gonna
do a with statement I'm gonna say cure
user like that
and I'm gonna say from the resolution
that context so think about that so
that's gonna be like wow okay I told you
it's the resolution going to be this
full thing
so when you see position that context
now that becomes the queues are due so
finally when we have the user in the
resolution will just say a bit on the
resolution else we're gonna say
resolution we're gonna take this really
tradition in what are we going to return
it AB sine dot resolution you see what
it was right
walk it nothing really
put Rizzo port without and D function
for a ping user function result tuple
for I resolutions charge now here what
we can do it just returning to power
we're going to error because you cannot
be here and we're gonna put you know toe
rice ok still follow me here we miss
like we have one little thing almost to
do now that's it
so now what we left us to do it's gonna
be sorry it's going to be to add the
demeanor wire on the request we want him
to become secure so what are we gonna do
here it's we gonna come here on the
schema X and ear what we're gonna do is
we're gonna do this at the top in yes
what we just create that schema the
middleware and now I'm gonna say example
getting the list of photo I want you to
become you need to be
attached Kate I'm gonna do this it's I'm
gonna put finally the term middleware
and I'm gonna say right there
middleware dot and now the the the the
one we just created that was oh so rise
we just create okay follow me here okay
now I'm gonna create that and now I'm
gonna be run again so now you see no
HTTP header I'm gonna run that first I'm
gonna refresh okay perfect
no bug and now I'm gonna run with our
boom run and now I get an error and I
mean did you mean one of the cold okay I
say okay here I need I what I forget
it's deer call whoops the call for what
we have create here
I shall not put no finally an argument
here this is what I was missing i
refresh sure of that and now if I run
see I get unit arise okay this message
here is pretty like it's pretty big but
it's the error you get also when you do
this window yet we can manage that to
make it better in the future but now you
see unit alright I try unit arise why
it's because you see I have no user in
my context but now we need to make sure
that that's gonna work we're gonna have
one so I'm going to log you see I can
learn why because my schema here
I don't put me the word in front of the
Lord I put it just for the photo so now
I can learn I take this GWT I get here
create an adder put authorization bearer
and I put the other like excite and now
I'm going to go here and here
now if I run boom now I can fetch on my
item oh no you see so that's it for the
attached occasion part for this like
milestone we're gonna draw on the react
part so you see so it's going to be
pretty simple because what we need to do
now it from the front end we need to do
this query just this one so it's gonna
be pretty simple the the artist thing is
going to be to install SDK and maybe the
design because under the ended that good
so with the design so what are we gonna
do is we're gonna need now to get this
token we're gonna get that from the a
Facebook SDK we can I call the provider
we're gonna put Facebook when you're
going to click and we're gonna send and
we're gonna ask em to be getting back
the token we get after that put this
token inside the async storage so like
the local storage where you can save
some key value and with this tool can
now what we can do is we're gonna put
that in the editor so we're gonna do
this boom get that save that in the
icing storage put that in there doors
and now we can ask so that's it for this
one and we're gonna tell you in the next
one again thank you for watching I mean
just seeing one view one more view it's
always motivate myself and me so thank
you everyone and again don't don't
forget I put I push this call always on
github just follow which milestone you
are and you can in you can see where we
already know so I hope you enjoyed and
we talk either bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>