<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>M03-Part1: Adding Reaction context with LikePhoto Mutation | Coder Coacher - Coaching Coders</title><meta content="M03-Part1: Adding Reaction context with LikePhoto Mutation - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/EQuimper/">EQuimper</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>M03-Part1: Adding Reaction context with LikePhoto Mutation</b></h2><h5 class="post__date">2018-02-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/jdwuk4OON1M" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everyone welcome to the point
number one of these turn milestones so
as I say in the introduction we're going
to start by doing a new feature is going
to be the light feature because we know
if we look at the application we have
right now it's pretty boring we have
just we get the image but at least we
get some identification and now I would
like when I click here to be able to
like this for actually right so what my
planets when here I click light one this
so one here when I click on the like to
get this earth in real and I want when I
click back to become like that so at
least the user know the like has changed
and also we want to update this number
of of people who have been like when
we're gonna see when we're going to add
real time on that on the at the end of
the project but what we want to focus on
this milestone is gonna be just be able
to like from the front end and so what
we gonna build it's gonna be like a a
new table it's gonna be a like photo a
table maybe not the best name but I
knees we know what that dude does so
this like table is going to be pretty
simple gonna just take to like feel
you're gonna take user ID in photo ID
and both are just reference of other
table so this word finally if you think
about that this table gonna be like a
joint table for for the user in the
photo
so the like photo here we don't gonna
even need to add an ID because we're
going to finally create an ID by using
the idea of the user in the photo this
way we make sure then it's impossible to
have to time the same user will like the
follow and also the way we want to work
is we want to add like a toggle what I
mean by that is I want to have this
imitation for doing my like creation
what I mean by that it's if you like a
photo and you click again
the same mutation this one gonna just
delete the light so I don't know if you
follow what I try to say it's finally we
gonna just do it I get inside the DB if
the user in the photo ID exists in this
table if if yes that means the user ID
already liked this photo so we can just
delete it so now the user don't like
anymore this photo and if when we do the
get we get Neal foreign attempts now
would be nice to just create the light
so this is what we're gonna do so go
inside your project and what are we
gonna run is this comment here we're
gonna run a mix Phenix Jenn context
reaction like I told you we're gonna
create a reaction context why are we
gonna put all the following stuff and
the like so everything about like a
reaction about like yeah I mean we can
put like like a photo or like a common
example we can all put that in the same
place after that we're getting into put
user ID referring the table user and
photo ID reference the photo table and
oh I get this name it's pretty simple if
we go inside the Lib and we open example
post we have photo ear so the schema
it's photo and in account user its user
so you just need to make sure this is
user info - like this one so now we're
gonna click enter so now that Cree for
us at third context so now we have this
reaction context so inside this one we
have the light photo and we have like
the basic stuff here as you know I like
to delete the comment so we're gonna
start with that we're gonna delete the
comment here
I love the comment but I think that just
take too much place inside that tutorial
inside my screen so we're gonna just
delete that and don't worry keep one
that's it okay
so now this my grade so that create for
us a migration to do and this is what we
are here we are a new table like photo
and this one gonna add filled user ID we
reference the table users and on delete
like we do nothing maybe later we can
change that plus yeah so here what we're
gonna do
it's this it with with this table we're
gonna add some stuff here pretty simple
we're gonna just add new to be false and
nil to be fought on both but that mean
it's it's impossible to create a like we
thought the user ID in the photo ID so
that's going to be just more validation
database side after that we're going to
just delete this index from here and
we're going to just create one index
we're gonna say create unique index for
light photo so always remember this is
the name of your table then we're gonna
put square bracket what we're gonna put
user ID and photo ID so to get like at
some I can't concatenation think this is
the name of both ID so if the ID of user
is one the photo it's one's gonna be 11
and now here we're gonna just give it a
name to this like new index right there
and we're gonna call that use our like
photo okay
so now what we gonna do it's we can go
inside the server which being a we're
gonna run Mixtec to migraine and it
looks like everything it's good now we
can open that in portico or open that in
your terminal or whatever you want so
now if we go inside the dev now we're
gonna add we can add a new table like
photo and as you can see here we have
the ID we got I'm gonna show you that at
the end of the feature all to delete
this ID because we don't need that
anymore
we maybe gonna need the insert add an
update at so that's why I've kicked the
timestamp because maybe you want to know
when did you like this photo or not
something like that
we don't know how and if we look at the
structure so you can click here we see
their user ID in photo it's not new we
get that from this both value we have
put there the validation you know so
inside index we get the usual I'd follow
index unique index as you can see they
take the column of the user ID in the
photo ID
boom-boom bag so yeah so yeah we cannot
change all that in the future don't
worry that's I just want to have
something to show so ok so right now we
have the table create but what we should
do
after that it's we should go inside each
of the schema we have for the user and
the user in the photo and what are we
gonna do is we're gonna add as many I
don't know you say that like as many a
relation between the photo and the user
with this this photo like so all you do
this it's you go first thing we're gonna
go in the user okay and a user from here
what are we gonna add it's gonna be here
as many so our user can add as many
we're gonna call that like photos our
user can add many food like you can like
many photo this is admin sorry and here
are we gonna do this it's now here we're
gonna need to receive from the Instagram
dot reaction and ear that's gonna be the
like photo so you just finally to put
the other schema to to let ACTU manage
this as many relation ok so a user can
as can have many like photo so what I'm
gonna do like a user that like 4 or
something like that now I'm gonna have
many of is like from him so maybe a what
we can do because we know are you
Zor can't like many common a excetera
we're gonna just say like it you like
you can remove it here if you want but
for now we're gonna keep it
now after that we're going to go inside
the photo it's gonna be almost the same
so we can copy/paste this one okay
and now we're gonna put that right there
but now because a photo we can just save
lights it's gonna be more simpler
because a user can like a comment in a
photo but a photo don't have like you
see what I mean okay so now from here
what we gonna do it's now time to work
with some like the plan right now will
be to maybe doing some kind of the
resolve our and also putting that with
the schema so that's gonna be pretty
simple so what are we gonna do it so now
we're gonna go inside the Instagram web
and we're gonna go inside the schema
right there so it what we gonna do so
we're gonna just go from finally from
the top and go down well I mean like
that it's it would gonna create a
mutation first so the mutations gonna be
light or unlike a photo at the
description yeah I'm gonna say a field
we're gonna call that like photo and
what we're going to return here so oh
I've done that it's I just say okay what
my friend I need to know you need to
just get China off like a tall girl like
you need to know if you like or not what
better than a booty end so you can
return from here a boolean on it okay
now here one of the argument we need is
going to be the photo ID and this one's
going to be a known new ID because for
sure you have no choice to give this for
the ready after that because we're gonna
need the user and user ID but we don't
need to pass it as a as an argument why
it's because we're going to add the user
ID if you remember from the context so
we're going to get the
i D right there when we create the
context so now the only thing we're
gonna need is to put this middleware
middleware that authorize the same as
the one we put here in the photo so now
we know this mutation you need to be
authorized and also that gonna give us
access to the user and now here we're
going to result with the result bar and
now time to create a new result bar so
right now we're going to create a new
reservoir we're gonna call this one
reaction don't forget that s to just
follow up all the other okay so this
result bar is going to be about the
reactions gonna be pretty simple so what
we're gonna do first
it's we're gonna dev the module after
that we're gonna see Instagram where the
resolver and we're gonna call that
reaction after that here what we're
gonna do it's we're gonna create one of
the first function it's gonna be like a
photo on me do okay so that's going to
be the function we're going to call
right there so resolver that we lover
that reaction the like like that so this
result were like photo right there
we're going to receive the argument
wynia so here inside this one remember
you have all the ways three argument
first one we don't need is going to be
that parent we're gonna need some stuff
from here and we're gonna need again
some stuff from here so we can start
from here here we're gonna get the photo
ID so we're gonna get that from here and
now we can also get the user by doing
context here and right there we can say
curve these are going to be quote cues
or if you want to know where I get with
this idea of the curves are if you go
inside the context we have a call this
one when we secure user so these careers
are go right inside this context right
there okay so now here
the plan will be to just finally cow
from the doing a call from the reaction
service we're going to create where we
gonna finally just like the photos so
we're gonna do a wit stickman
we're here we're going to return a 2
plus with ok and message or you can call
that a status or but I'm going to call
it the message and this one we're going
to get that from we're gonna address
this Instagram the reaction well now we
can say reaction
don't know why I get that in singular
okay we can adjust change that so every
that was in the generator so reaction or
change the name to be a s change this
one to be a s we're gonna just change
all the reaction I just want to follow
the same pattern everywhere and you put
the s inside your like photo so make
sure that every place where you place
where we have a reaction we have a s
like that do you want you don't forget
to do this in your test so we have
reaction reaction okay you know we
should be good with reaction like that
okay so air we're gonna create a
function called light photo in this
reaction where we're gonna pass the
photo ID only with the cure user that ID
so the ID of the user with log and we're
gonna finally just return to AB sine
graph QL the message with a top L with
okay atom an atom of okay and message as
the boolean okay so now this light photo
here we're gonna need to create this one
so go back inside your reaction here and
now we can like the photo so what I'm
gonna do here I think we can delete all
of them because they don't gonna really
looks that what we need but you can keep
it then so what I'm gonna do is I'm
gonna just come in out this one for now
okay and now here I'm gonna create what
I need inside this reaction services
right there so this one we just need to
think about the logic of what we're
gonna do with DB finally so it's gonna
be the place where we're gonna finally
call what we need to do in the database
one final user click on this photo lock
okay so now what are we gonna do it's
right there
we're gonna do def like follow follow
over the name the photo remember what I
got
you get a photo ID and also get the user
ID okay and now what I want to show you
it's if you go to ecto website
okay if you go to ecto website you can
see active query okay and actually it's
gonna be a way for you to provide to do
some kind of sequel query right inside
like an exceptionally and this is video
awesome to like finally when you want to
do complex stuff and you want to have
like more control about that I'm gonna
put this thing in this description don't
worry so this one here so we add the
ecto Creek from you so we are good and
inside this one world what we're gonna
do is we're going to do like the the
just show here to create a query and
after that we're going to pass that
inside the repo so here we're gonna do
three equal so now I hope you know a bit
about sequel so there's gonna be that's
gonna be easier for you here we need to
find if this photo exists with the user
already in the photo ID okay so we're
gonna do from t in and alright there we
can say like photo so this is one of the
thing I really like about working with
Alexia nectow and the sequel it's you
can like you don't need to have the same
name because they just gonna take the
name coming in from your schema and
tough like that so that's gonna be
pretty like it's more exciting okay here
we're gonna save so finally from p4
photo or you can call that LP if you
want or whatever in like photo where and
now we're gonna say T so there P we have
here the photo ID because remember a
photo can have a photo ID right there
and now we're gonna say equality quo
don't do a three quotes to equal ears in
elixir and then we're gonna say photo ID
but the thing is if I do this that don't
gonna be dis photo ID if you want to
have access to this photo ID right there
as you know if you have a following like
adore elixir tutorial you're gonna need
to put this carrot symbol right in front
of that
yes so it's really important here to add
your carrot in front and now here we can
say N and do the same with the user ID
so the P that is Rd equal equal Terrell
user ID now another kind of convention
I'd see it's when you have a coma-like
ear to just put that in other line and
people I sell out the winged thing like
that just to make it easier to read so
as you charge I think I'm gonna go here
because I'm not a fine a fan of really
long line but I know it looks pretty
well when you came back from when you
came from like know Jesus or thing like
that okay so now we add a curry so now
all can we create distinct finale it's
by do using the repo so we can do repo
and we know that gonna give us one so if
you go with all that gonna give you a
list but if you go with one that's gonna
give you back your element if you
receive it okay but now oh you can
search what we put that one we give you
so I want to I want to make sure then we
understand or to search you go to we put
right there and now inside this one
you're gonna have the value you search
so the one okay so one fetch a single
result from the curry and return nil if
no result was fun so if you under
someone I mean it's now I'm gonna put a
variable with that I'm gonna call that a
as a result sorry now a what I can do is
I can say if rizal equal equal nil I'm
gonna do something else I'm gonna do
something else okay so if I have nothing
I want to create a photo line I create a
like follow and else I'm gonna delete
that but now look at that oh we have
already create like photo who need to
take some attribute that's it here so
now why not put that there so if you
don't exist what that mean the user
didn't
didn't finally like this photo yep we're
gonna just put ear with a map right
there we're gonna put photo ID with the
photo ID and use our ID we use already
that's it so now if we're going to
create a photo and because of the way
this one and finish we should do that
with okay and true because what we want
to send back if you remember sorry in
that ear but in the schema we want to
between a boolean okay and for returning
this boolean like if like ear that gonna
return us that like the object the
product like the command you have career
and not the boolean so that's why so
here I know okay the user click on like
and we return true because now we just
show to the user a you just like this
photo it's true you have like it and now
your what are we gonna do it's now we
get a on come in the delete
I like photo right there so we do don't
for us why not use them and take this
delete our photo put that right there
and in this one what you need to put is
only the result because this one this
delete it take the photo you take the
full photo and you're gonna delete this
one and on this one if you follow what I
do okay because we don't have an error
it's done so it's a okay but now hey you
don't like it anymore okay how that
makes sense so make sure to understand
that it's on the table we have created
with some reference to do that as many
as many each so many too many relation
to that make sure to add the as many ear
for the with the like photo to make sure
that now when you want to add access to
all the photos are usual like you can
have access to it by using some stuff we
have this in the future but we'd like
follow same with the photo with the
light here in the schema we have to the
mutation and the reaction
resolver we call the like services we
have created in the reaction context and
we receive the ok message because this
is whatever you see okay message and
when we show back it's okay with the
message so finally the most thing about
like we destructuring the okay and we
just send it back okay so now if i go to
my project
okay now we get some error okay
invalid Association light photo in
schema associate
okay so as you can see we see some like
a reaction like follow without s so
inside the users are here you see we
have forget the s right there
and inside the polls we have forget the
s in the reaction also know if I run
again
clear let's finish okay and now we get
another error cannot inspect expense
truck Instagram reaction like photo
inside reaction like photo okay so that
must be inside this one right there you
see line for re s reaction so we forget
another s here I think the best bet
should have been to do shift cannon F
and search for reaction like that and
after that you can do like click here
and we place that's it but you know some
time yeah run a server perfect looks
like it's okay so now we're going to go
to the graph QL endpoint and in this one
I think
oops I think if I do photo just to make
sure we have an ID Nate made URL okay we
get a unit all right okay so we are not
at all right yeah so now I'm going to
load
take a token from my user I'm going to
open on the dough well yeah I'm going to
put the header right there
add the header put the bearer no sorry
optimization Oh to musician with there
are piece that
so now if I fetch now should be good
perfect now I'm going to do command T to
open another one I'm going to create I
see like a photo okay and then this one
because I've done a command T from the
other one I get the other so I don't
need to care about this one okay and now
if I open the docs now in some imitation
I'm gonna have this like photo and need
your photo ID and inside my database you
know I have nothing okay so now what I'm
gonna do is I'm gonna do here a mutation
like photo yeah I need to put a photo ID
so inside the photo I have the ID number
one so we're gonna put this one ID
number one and now we don't need to do
nothing for returning because this one
between a boolean so now time to cross
the finger and click when we get an
error but something at least get we get
something working here we get insert
into like photo so we should see nothing
but no because when we insert we get a
problem so now right there what a pen as
you can see we get nil value in : okay
so it's something pretty strange so so
we did the stuff we asked so as you can
see we get the user ID so the user ID so
if we see here we have finally the photo
ID was one and the user ID was a so I'm
gonna look in the database I'm gonna go
inside user and we see ID number eight
was me and we like the foot to one so at
least we know this logic is good the
insert is good but now look sites when
it's time to say ok and we get that
inside reaction like photo look here
while we forget as you know when we do
like you want to add attribute you need
to put that a pass that inside a cast
and a PETA given Peron has changed for
the giving data so if that don't go
there you don't forget it
you see what I mean so now here what we
need to put these inside this gas
attribute right there we're gonna put
user ID and we're going to put photo ID
and inside they require the same thing
so what that mean it's that don't gotta
be the database we're gonna do the
validation but much more ecto right
there
so photo ID time to say and now I'm
gonna be run again okay like photo oh I
get true okay sounds good so now we did
a search we get nothing so we add
inserting the DB so now if I go in like
photo now refresh now this is what I got
I got the ID number two because as you
can see the number one was create before
so was create I like to think about like
you take some kind of memory in the
database but finally didn't really say
but that's why but now you see the user
I didn't photo ID but now what's gonna
happen if I rerun again
as you can see that we have seller first
thing look at the color we already know
what at them we have select a photo with
the ID number one and the user ID number
a we get it there and now why not delete
that because finally we don't like it
anymore now if i refresh you see so
right there
a user can like unlight like unlike like
unlike like unlike a photo so you can
like this one like that number two
number three and number four because you
like every photo and as you can see now
we have user ID number a like photo
number one user ID number eight so this
way it's gonna be a way for us to know
if this use our I've liked this photo
nothing more to do here so I hope you
enjoyed this part in the next one we're
gonna create the mutation inside react
native to make this like on like blah
blah blah and after that I'm gonna show
you another way of thinking I don't say
it's gonna be the right one but it's
gonna be about thinking in the viewer
setup what I mean by that
it finally when we're gonna fetch the
photo here inside here I want whether
you like viewer like like that was gonna
be a boolean what I mean by that it the
application you see new screen it's your
application it's not mine it's not my
state it's your state so if you have
like this photo here this photo should
return you are like should return like
true or false anything like that so this
would our front end is become almost
like dumb gonna just show the value you
have yes you take a bit more you work in
the back end but I think you win a D in
the long run so I hope you enjoyed this
video and we're gonna talk in the next
part as I go 90 roll by</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>