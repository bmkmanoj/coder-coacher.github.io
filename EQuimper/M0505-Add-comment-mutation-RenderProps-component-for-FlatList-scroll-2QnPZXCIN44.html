<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>M05-05: Add comment mutation + RenderProps component for FlatList scroll | Coder Coacher - Coaching Coders</title><meta content="M05-05: Add comment mutation + RenderProps component for FlatList scroll - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/EQuimper/">EQuimper</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>M05-05: Add comment mutation + RenderProps component for FlatList scroll</b></h2><h5 class="post__date">2018-04-24</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/2QnPZXCIN44" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everyone welcome to this episode
father in Serbian clone
so what we're gonna do for this one so
I'm gonna first thing show you the demo
about what that's gonna be looks like at
the end of this episode so here when we
click on add command what we want is to
get all the command
scroll the list right there and we want
also to be able to other comments I can
say a loop there and when I'm going to
click Sam we see a loader right there
so this is the plan for this episode I
hope you can enjoy it and we're gonna
start it right now
perfect so now what we've done in the
last one we forget to do one thing and
that was one of my mistake it's about
Luke here I've add some demo command and
what I'm gonna click on add a command
looks what's gonna happen then what is
this thing right why it's like
transparent like this what happened so
this is what we need to fix so what are
we gonna do is we're gonna go to the
command screen and inside a comment
screen what are we going to need to do
is to fix at the background color of
this input section so we're gonna say
background color and we want it to be
white so now if I save and I rerun the
app and I click add a comment at least
is not why it's not the transparent
anymore so this way at least we see all
that stuff okay
after that what we gonna do it's we're
gonna if we want to be able to add a
comment because right now if I come in
nothing happened I get just the alert
we've done in the last one right there
so what are we gonna do it's we're gonna
start by creating a new mutation so
we're gonna create a mutation inside SRC
graph QL mutation and the file we're
gonna create it's going to be called
create common
the GS so if I use it but that do this
in graph QL mutation create command
mutation what we can do it just get all
this creat photo mutation just to go
faster and inside this creat comment
we're gonna do this we give and I remove
this feed we can never remove that from
it we're gonna do create come in I just
like to name my mutation and my query
and what we gotta do now it's we're
gonna say what we need so inside graph
QL when we create a command we need to
have the photo ID in the text so if we
look here quick command photo ID and
text now what we do it's photo ID it's
gonna be a type of ID and text it's
going to be a type of string after that
we're gonna say create comment it's
gonna be a photo ID right there so photo
ID gonna be of type photo ID and text
text after that because I don't want to
work with fragment for this one I'm
gonna just copy and paste whatever we
have right there and put it right there
you can use Frank man or whatever I mean
it's it's for tutorial so I just want to
go quicker to run more on feature so now
we have this imitation we're gonna just
keep like we did with the last one so
we're gonna go inside the index @gs and
sanitation inside graph QL and we're
gonna do expo default as create common
mutation from create common mutation
like that
so now inside this file we're gonna
import from react Apollo graph QL and
we're gonna import the mutation
okay don't know why the debug the
Karishma so now here what are we gonna
do
it's we're gonna scroll down and we're
gonna make use of the graphic well why
don't use the mutation component like we
did here with the curry so the one would
do render props and thing like that I
mean it just because I don't want to
bind my text input value
I don't want to rebind inside the render
but it takes input value and thing like
this and my submit and stuff like that
so that just one preference so I keep
the curry for this but the mutation I
keep it outside so now your we're gonna
put the create photo mutation and now
here we can pass props though that
perhaps we're gonna pass gonna receive
mutate and on prop so the component
props this thing here need to return an
object and we're gonna call the finally
the props action on create comment this
one gonna receive a text and you're
gonna call the mutate function so this
mutate function I'm gonna receive some
variable so this is the variable we have
put like the text and you need to have
also the photo ID and now we get that on
props that photo ID because remember we
get the photo ID just by doing this that
perhaps that photo ID on props equal to
this thing so that's why we can do this
after that just by doing this we're
gonna test it so I'm gonna add the
uncrate comment so now what we can do is
just right there remove the alert and
just say this that props the on quick
comment
and put the dis that state that comment
inside that what I'm gonna do is because
I've put a lot of testing comments I'm
gonna go inside one I have nothing so I
think this 31 yeah so now I'm gonna say
L oh well I'm going to click send
nothing I then we get an error so that's
maybe why also so now we're gonna open
that and now we get an error we get
image URL can be blank what I've done
wrong create comment and the quick
command mutation quick commands oh my
god I did the photos sorry about this
that was creat comment so you must have
you must have loved a lot of me right
there so right there
so the third one I'm gonna say L oh well
so now I'm gonna take them inside my
electorate back-end we see now the
insert into photo common with the photo
ID and the text and the user ID with all
of our added value right there so
sixteen for the photo ID hello well and
the user ID number six and this is what
we want so now as you can see it the
thing is we don't see this coming at all
so we're gonna need to add this to the
cache so what we can do is we can make
use of the optimal of domestic response
so this we're going to optimize user
sorry optimist UI it's about you change
the UI before even the server responds
to you what I mean by that it's example
you here we're gonna create a comment
we're gonna shoot a comment if we get an
error from the server we remove the
comment if we get a success we still
show it to the user
this way the user win a lot because for
anything it's really quick and I mean
you're gonna looks like real time so
it's really really awesome if we get an
error
Apollo gonna manage it for us and for
this what we need it's to add first
thing attack name yeah we're gonna
system it a shot because we create a
comment after that we're gonna say
create comment so we need to pass the
value to this
object right there and we're gonna say
and I have an idea okay because right
now we don't even know which I did
that's gonna look sly and we don't want
to use example that date because I don't
know like maybe someone see they come in
and get another with the same idea if we
use that date and we use subscription
you see what I mean so what are we gonna
do it's mad that wrong mad that Ramdin
not appalled by 9s and that's gonna be 1
million like that now here what we can
do
it's type name and now that's gonna be a
type of comment this is the type we got
right there after that we're gonna say
for the insert add value that's gonna be
new date for the text we have access to
it right there and now that's going to
be the weirdest part just we're gonna
need to manage it in the future we can
use their a polluting state anything
like that it just because we need to
have the user and why I say that it's
because inside might create a photo but
create command mutation we have the user
avatar and username okay and we need to
have it to recopy finally whatever we
need to show so for now we're gonna say
for the ID we know it's six so I'm gonna
just say user six so this is the way you
can say an ID for app without the
default get the D for that ID just take
the finally the type name and just put
the idea after that so if that would be
a photo that would be like this so this
is me take yours if you want the
username is going to be equal power so
this is mine again you can change in for
the avatar in this file we have already
imported figure that also we're gonna
use it again this thing it's just for
protecting prototype you're gonna need
to change it for sure for your app
inside it just at least you see which
kind of you need maybe with your
appalling state or something like that
or you get it from your prep so you get
that the user object here so you know
this is the the viewer himself so you
can do this
right there are even thing you can do a
middle word for this so after that here
what I'm gonna do is I'm gonna do update
and update take two argument the first
one is gonna be their cash order store
whatever you want to call that you need
take an object with why are you gonna
receive data and the create comment and
now here what I'm gonna do is I'm gonna
say I want to fetch my data from my
store that read query and I'm gonna say
my reach worried my career is gonna be
this get comment we had at the top of
this file after that what I'm gonna do
is I need to pass the variable a same
variable we have so photo ID it's equal
to the own props that photo ID it's like
that after that we need to write to the
store the new change so this data is
gonna be an object we're gonna add the
comment okay so what we can do is we can
say start that right through this thing
need again the query and the variable
but now you need the data why this one I
have an object where you have the
comment so and this thing because we
want to add the comments we're gonna say
da da da data that comment because it's
an array of comment and we add finally
dis create comments object we're gonna
receive back oh that's gonna work so now
I'm gonna go here inside my third one
why I'm supposed to see just lol and I'm
gonna say just I don't know like ello
again if I do this and I click send boom
I get right there my hello again anyway
if we look in the debugger we get no
error so this is what we want
I'm gonna just put it right there a bit
smaller perfectly so now we have this
stuff so now we can say I don't know
like yo and we get this right there this
is what we want perfect
now the thing it when you're gonna get a
lot of comment this is what gonna tell
where are my command blue
so now you need to scroll to get the
comment and now you see first thing when
I scroll I have one comment below right
there if I close my keyboard you see
I've so many come in the thing it's it's
our about this keyboard ID we don't know
the keyboard I and this is what we're
gonna need to fix and we're gonna make
use of something we're gonna make use of
a way of writing a component like Apple
ooh I've done here this query this
render props and this is what we're
gonna need we're gonna do so if you have
never learn about render prop I think
that's gonna be a pretty good place to
learn this but before that we need to
prepare this file for so what are we
gonna do it's we're gonna create the
stuff we're gonna create the stuff from
here and after that we're gonna manage
it outside okay I think this is gonna be
the better ID first thing we're gonna
want is to get the keyboard object from
a real native okay also one of the other
thing we can do it's going to be to wrap
the flat list with this keyboard
avoiding view putting the behavior to be
a padding and what we're gonna do after
that it's we gonna say keyboard vertical
offset and we're gonna say the input ID
okay if I just do this what I'm gonna
happen it's at least right now you're
gonna see at least now I can scroll but
again I have some miss thing right there
so now what I'm gonna do is I'm gonna
add to my flat list right there I'm
gonna add a content container style so
that's gonna be the style of the
container inside I'm gonna call that
content list and what I'm gonna do is
I'm gonna just say finale padding button
I want it to be the equal of the input I
and I'm gonna send multiple by two just
because I want to have more space so I
want to add a padding equal to the input
I so at least now I don't know I'm gonna
see the last input you see now I have
despite
maybe you want to see this input I so
that's gonna looks like this but I like
to have some space okay now what we're
gonna do
it's we're gonna change there we need to
keep track of the keyboard plays okay
and also the eye of the screen so are we
gonna do this so we're gonna use
keyboard I can remove alert and we're
gonna make use of dimension the
invention is the way for you to get the
dimension of the curved screen and we
can get that I'm gonna save it right
inside the state so we're gonna say
screen height I'm going to be equal to
dimension the get here you put window
and you do the height so that's going to
be the dimension of the curved screen
now what I'm gonna do it's inside the
component in mouth okay I'm gonna create
to listener I'm going to call one call
keyboard did show listener equal
keyboard that add listener we call that
key board did show all that is inside
the dogs operative so you can check it
and I'm gonna call my function I'm gonna
write right now so keyboard did show and
I'm gonna put right there this function
so this is a even listener finally I'm
gonna do the same but this thing's gonna
be did I so what I'm gonna do is I'm
gonna just selection this show do
command D command D so now I can do I'd
like that you see right there
so keyboard did ID and keyboard it right
like this that's our own thing we need
to do it's putting a component wheel on
mal we need to unsubscribe for them so
we can say it is that keyboard show
listener that remove and this that
keyboard did I remove like this but now
we need also to cry this did I'd like we
did here like this perfect now what's
gonna happen
it's I'm gonna show you what I'm gonna
get my keyboard I'm gonna say key bar up
and when it's gonna be ID keyboard ID so
now if I show my debugger and I go here
keyboard up if I click outside key bar
I'd keyboard key bar I so this is the
the this even is an hour and why we call
the remove when we all know is because
we want to make sure that we don't gonna
get prone of memory anything like this
so we don't need we don't even need to
listenin to it because the screen don't
gonna be there anymore so now I'm gonna
show you something.if inside this
keyboard did show we have an even okay
and I'm gonna just put the even right
there in the console log what's gonna
happen it's we know you're gonna see
we're gonna get some value we can add
comment and do what we're gonna get we
get an object with a duration and and
coordinate and start coordinate but what
we need is the end coordinate so now we
know the keyboard measure 258 pixel ID
so now what we can do what we can do is
maybe change the ID of the flat list so
one of the thing you're gonna maybe
thing it's okay what I'm gonna do is I'm
gonna have a style inside my flat is
maybe called a flat list right and by
default is gonna be this size okay it's
gonna be the same size of the screen but
when my keyboard gonna show one oh sorry
one my keyboard gonna show maybe I'm
gonna save this at set state I'm gonna
say flat list ID
it's the ID of the screen - the EDA and
I'm gonna just this is n coordinate that
I'd like that and maybe gonna see okay
when my keyboard did ID is gonna be just
back to this we can close it and now
while we can do it's inside my flat list
I'm going to do it-- and I'm gonna do
this that stay that flat list ID so this
way that's going to scroll for us you
can see what I mean by that if I click
that now one second make something wrong
let this i flatly slide okay yeah I mean
it's not I know why
one thing I forget it's if we want that
to scroll for us now we're gonna make
use of the inverted value reverse the
direction of the scroll okay and I so
what that's gonna do because it's
inverse we need to change that also I'm
going to show you what's going to happen
you see now the last one the yeah get at
the top right there and now this input
padding button it's at the top because
the bottom is top now the top is there
so now we can see padding top now you
see also what that happened now okay
just by doing this if I click that boom
and now we have the last one run right
there so if I click here boom if I click
that we see but it's not really nice I
mean it's not like it don't looks like a
scroll I know some people are gonna so
just use the ref and scroll to and but
for me what I like to do is using the
animated library so we're gonna use
animator first thing is we need to
create animated flat list because we
don't have access to flat list animated
by default so flat list equal to
animated dot create animated compiler
and you pass your flat list so now you
need to change the flat list with this
value if you do this now nothing gonna
change that gonna still be a flat Lee
you just now you can receive some
animated value okay which one we can
animate that I think one going to be
good it's going to be this flat list and
I so we're gonna say new animated value
it's going to be equal to this dimension
I'd by default and now right there what
are we gonna do is we're gonna say
animated that timing this is that stay
that flat this side I'm gonna say to
value we want this value and fall
duration
just for now - example 1000 also we can
make use of use nets of driver but we
can't because we're gonna make use of
the ID so we can't if this is one of the
question you want to ask you can't
because it's an ass right so I'm gonna
do this and when that's gonna be the
keyboard that I'd I'm gonna do spoken
and I can just remove it from that and
changing this so if you don't know
animator work it's gonna be really nice
for you to learn it because I mean it's
awesome library and we need to use it
when we want to do some animation and
thing like this and you react native so
what animated timing need you need a
value so animated value so the animated
value is this flat list ID so that's why
we have new animated value so the new
animated value are going to be equal to
the height of the screen to example 1000
other we just see we change that in a
timing alike in that time so the
duration gonna be one second so in one
second I want you to go from 1,000 to
one thousand minus this thing so example
700 or here we want to change the these
things will be maybe 700 now and we want
to change back this to 1000 and we want
to take one second to be at will so now
if X like that look what's gonna happen
nothing I mean nothing
no it work you see right there but we
see one circle by these you see scroll
so now if I click here boom you see this
little effect I pretty like you
but now one thousands too much so we're
gonna say 200
200 I think is gonna be pretty good
don't know just by doing this scroll we
at the end we are at the end right there
I click here we are at the M if I click
here we are at the end now I'm going to
fix one problem before we jump on the
render props if I say Wow
right there and I click sin where is my
message it's right at the top because
it's the way we send the crit command we
need to put that at the beginning first
now by because we use a spread like this
it's pretty simple so now if I get there
the last one is Wow
I'm gonna say whoa again if I click sin
Y again it's right there perfect now I
think it's I cannot use anymore this
this little animation we have done and
we maybe want to add this inside a
shadow something like that so what are
we gonna do is we're gonna go inside the
component right there and when you got a
we're gonna create a new component
called this space or that GS go back
inside you command component copy and
paste everything first thing we do
command D comment screen this space are
after that here at the bottom we don't
need any more than emission so we're
gonna remove the graphical thing we
don't need that we don't even need a
style we don't even need nothing here
we just need a render we don't need this
unsummon constructor we don't need that
we don't need the comment here and we
don't need this set amount right there
so that we don't need this thing we
don't need that we don't need animated
fatness we don't need all this stuff
pretty nice why we assign for this we
don't need all this stuff we don't need
format and we don't gonna even need
react because we don't have any gsx why
it's because we're gonna create the same
thing as what react Apollo I've done
here a render props you see this
seized a component children right there
this is the disappered the children you
have right there they receive this data
so this thing thing about that this is
almost like a children we give two back
now what we can do okay here you're
gonna see we're gonna create here a
valuable inside or under props call
render props here what I want to return
back is just a flat list right equal to
this that say that flat list i okay here
what I'm gonna do is I'm going to say if
we add a children I want to return this
that drop the children and I'm gonna
pass the render props inside that else
because that's going to be there else I
want to be able to do something like
that like render like this and having my
function from you so what I can do can
do return this that throw-ups that
render so that's gonna be the function
window code and I'm gonna do the same
thing okay now I save this file so the
file is pretty simple now it's get just
all the even just this this component do
nothing more than just matching the
space order with the list finally okay
and now what I'm going to do is I'm
going to go to my index the GS I'm going
to export this list spacer so we're
gonna be easier to import and now inside
this one I'm gonna import it from death
but now I need to remove a lot of stuff
I'm gonna want to remove this thing this
thing I don't need done anymore I don't
need the keyboard I don't need the wind
mouth I don't need all this stuff right
there
and now what I'm gonna do I want to have
access to the dish that stood as a
height but know what I'm gonna do is I'm
gonna see this spacer I'm gonna wrap it
like that I'm gonna do like we do with
react Apollo like that right there I see
pretty bracket and I'm gonna do this I'm
gonna pass my keyboard stuff all this
all this component right there there
flat list I've now got a king from this
one
so this flat list ID came from this
thing here and now look okay look here
has nothing about keyboard nothing you
see I don't even import keyboard we have
nothing more so now if you work we know
this is coming from the component we
just built so now if I click here that's
it you see
I really really like this pattern now
you may be a sake yes what is this like
why we can use it it just yes you can
write a high order component but the
thing is I think it's pretty it's much
more better to do this way why first
thing you don't get named in collusion
with the props you get and also other
thing thing it's multi clarity it's more
easy to see what that does so the list
space are just returned f at least I'd
and give access to the Flatley site so
now I can use this thing always to wrap
other component do anything we can
change just to make it better here the I
the duration we can change it to become
a duration variable so if we change it
we change it on both like that and I
think it's pretty good this one and now
we're gonna just test it now if we click
here boom that's cool for us if we go to
a component where that little less you
see you know if I say hello world
yeah right there so I think that's gonna
be dead for this citizen I hope you've
learned let me know in the comment I
hope you learn the render props and you
see this is not that this is not we
sorting here like it's not dark magic
it's pretty simple to understand I hope
you enjoyed this this one and we talk in
the next one bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>