<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Create a NodeJS + MongoDB Rest API [Part: 4] | Coder Coacher - Coaching Coders</title><meta content="Create a NodeJS + MongoDB Rest API [Part: 4] - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/EQuimper/">EQuimper</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Create a NodeJS + MongoDB Rest API [Part: 4]</b></h2><h5 class="post__date">2017-05-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/iBnLWrw3NpY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">a time for the next part so we are in
the part number four so we're going to
work a bit more with the user again so
in the last episode if you remember we
finally been able to create a user but
the problem we got was the user when we
save it we say with the pass were like
password 1 2 3 and this is not what you
want you want to make at this more
security and so we're going to create
the password after that my plan is to do
the stuff with Passport
so again remember always are going to
push to get up the mast are going to be
always the latest version where I put
all the ring and everything and if you
want to see the branch example like in
the episode 2 you can click here and
you're going to see what we've done in
the episode 2 so so this is just for
sewing telling you that so the planet
for this one a decrypt and passport the
first thing we're going to do is I want
to add vim RAF so remember us finally
it's for the user of Mac OS you know
like you can delete folder just by doing
M or F but the Windows user don't have
access to this comment so rim RAF make
it available for everyone to just make
this delete folder so we're going to
just make it running before we finally
run the bill so that just going to be
sure we like to we're gonna make it like
if we remove some stuff that's going to
still working like I mean you just
that's going to get cleaner to do today
we're going to click the password
credo lock a strategy with passport and
I want to be able to log in as a user so
time to start so in the terminal yarn
add NPM add and there the princi we am
Raph so rim Raph
perfect so I'm going to just run your
yarn because yeah so after we have in
polymer app just to be sure we have it
yeah so now what we're going to do it's
inside
we're going to create another script
called clean this comment gonna be
simple rim wrap disk this photo right
there so here before we build what we
going to do it MTM run or yarn run so
yarn run clean and wet back W so now if
I do this look what the atoms here at my
disk folder so now if I run yarn Dave :
bill I delete my discolor and now it's
coming back perfect because now it's the
the new one perfect this is what we want
now we need a library for create the
password so that's gonna be the name of
this library it be crypt that node here
so why because no GS when we are decrypt
it because if you use Windows you're
going to get some kind of tournament
again so I want to make it available to
everyone so yarn add decrypt no Gia
perfect so just for every capital what
Adam I'm going to do user signup oh it's
so easy why because that's save it in my
collection in postman when I create a
new Zork don't worry if this user it's
going to I need to make my server run
first so yarn there perfect so now if I
run it so now this is my user so if I go
to my Robo Mongo and I we special don't
worry I delete everything if you want to
delete you can just do Kyle right click
and delete document so here this is the
user discreet this is the problem right
there
password its lol one this is not what we
want so what I'm going to do is I want
to click this stuff it's really the
don't worry with that we go to user
model so entire user model we're going
to make the crip when the user pre-safe
so at the top right there we're going to
import from
bcrypt nodejs we're going to import
something called
ash sink
so I want the difference between ash and
ash Singh is Asha Singh it's synchronous
tool I don't need to care about like
promises and everything so here what I'm
going to do is I'm going to create first
thing a method inside my user I'm going
to open an object here and I'm going to
say ash password that's going to be a
function this function takes only one
argument that's going to be the password
of the user coming from the front-end
remember this password is the password
coming from the front end the user go to
your app enter his email enter its
password and this is the password we
just sent right there return h sync
password nothing more we just return the
password cryptid so err that very
synchronously so here when we going to
call this method the result of this
method gonna be the password crit tell
when do I'm going to use it this is what
you asked right there user schema we're
going to add a critic so Mongoose it's
awesome and they have add some prey look
coming with MongoDB so one of them is
proceed so before the user is safe here
I'm going to use function and I'm going
to put the call that next year
so here what happened what I'm sure what
you ask it why do you use function
because I want to add access to the disk
and if I use IRA function I am going to
lose my this fine area that is don't
going to be my user a what I'm going to
do is if this is modify so and I'm going
to pass password like that what this
line of code do right there this is my
user so remember this equal user is
modifier so what I mean is if you we
want the user to be able to update this
profile example we
on the user to be able to maybe change
is email if we don't do the if this is
modify the passwords going to be recruit
again so anyway we study cuz remember
when you update a user in Mongo you
going to call the dot save so the save
the third that's why we need the signup
code here it's just because we don't
want the server to made a crit again
that's it but if we want to change the
password because the user don't remember
a password that's going to work because
a well we see if this is modified so if
the the password is modified here
there's the password so the password of
my user now going to be equal to this
that underscore Ash password because now
a method it's available inside this user
and method go to a user so it's like a
pro you it's like a prototype of the
user finally now set up do this and now
I'm going to do this at password so now
finally will happen if the new password
going to be equal to the password
cryptid remember this is the value
committing air after that here I'm going
to just return next so this thing is
done that's it in air what I'm going to
do it's return next if nothing added so
here I can just do like that perfect
time to test it yeah nothing more to do
I mean this is the free site we don't
need to do nothing
mangu is going to make it pause test
don't do that sir I'm going to send boom
password man we are really far away from
the lol one no now we have a cryptid
password do we work in one moment go so
if I open rebel Mongo I'm going to
refresh my first
was encrypted in a world 1 9001 boom
password like that this is good this is
what we want now we want to logging in
Europe so what we're going to do it's
now we need to use a service called
passport so here that point it just a
library easy to use to make a
toxification in OGS they have a lot of
strategy you can use some strategy like
Facebook Google Twitter you can use
basic out and everything the two we're
going to use for this tutorial going to
be the local strategy and the GWT today
we're going to work it with the local so
if we search air inside the strategy
we're going to use the path for local so
they don't have it don't trust me they
put the nut inside adults but the apps
so so what we need to do it's inside the
your terminal we need to install two
library yarn add passport we need the
first password and one of the strategy
pad for local so after that I'm going to
create a new folder inside my suit
folder that's going to be called sir
this services yet so that's going to be
all my service in my application under
the create one call out that services so
service I'm going to have multiple out
here what I'm going to do it is that's
going to be my logic of passport so I'm
going to book is going to do sorry
import passport from passport but before
I do this I need to do something I need
to initialize my application my expert
application with platform it's easy
really the copy/paste align with just in
with command see what I just did it
shift come in and I go there and I do
command Z go to your middleware config
at the top at the top of the file right
there
import it
so that screw down after the body parts
are right there we're going to do app
that use as I'm either way we're going
to use Pat for that
initialize nothing more to do for
initialize the application with passport
after that inside the service here we're
going to import the locals to energy so
HG from passport local after that I want
to have access to my user models so my
user model coming in from the database
after that I'm going to create some
options for my local strategy so I'm
going to call this object call local ups
and the only thing I'm going to say it's
username still going to be equal to
email
why did I need to do that because by
default passport use username a pad for
local you username and password I ate
that I like more use email because I
mean if I use our forget its email it's
it's that's going to be or Danny but you
can don't remember is its username so
that's why here I'm going to create my
local logging oh I can call this one
strategy in our case so that's going to
be a new local strategy
here we're going to pass a two thing the
first thing gonna be local UPS so that
we're going to need to pass a callback
and the callback gonna be email password
and done so this is what's coming from
Annapurna
but what I told you in the last one in
the in the last akiza or maybe the
second one I love using avoid I don't
like promise I like promises but I like
more using a wait I don't like callback
so what I'm going to do is sing right
there so now I likes s to the word
teasing I'm going to start with a
try-catch why I start with that it
if I have an error in everything having
time I try I don't need to do another if
error because my church can I catch
everything here I'm going to do the
catch again first we turn the error and
false so here my dumb mean I'm returning
my call back with an error as a first
argument and no user a lot nothing here
I'm going to fix can't use are equal a
wait user that's fine one because we
want only one user and we're going to
find it by email that's it if have no
user I'm going to return dawn with no
error cut if I have an error that's
going to be there and false so finally
the user it's not like Leggett here
because we don't have a user so that
means this user cannot be long because
it's maybe that create it's not the good
email so L if use our the password it's
not equal to password I'm going to
return dawn nil and false here what i
show you it's something like that don't
go nowhere you're going to see what I'm
going to mean in one moment so it just a
surprise so for the one who don't know
what happened
you're going to see in one moment for
the other one don't worry I'm not crazy
I'm gonna make the change here and
finally if this to both case it's not
the one attorney we're just going to
return a done with no error but the user
this detail user right there after that
we're going to sleep passport to use as
a middle word for him loco strategy I
told you you can use many many strategy
with Pat for test passport it's not some
library and they add a lot of strategy
so that's why they let you use the one
you want
at the end we're going to export as it
comes because we can add more than one
strategy later I'm going to call this
one out loco at execution local I'm
going to say fast porn that are Tatsuki
print SC local so I'm going to use the
local strategy so this is what if we
told to passport and I'm going to say
I'm going to on open an object and I'm
going to say a1 no session why because
I'm going to use GWT and we don't need
this thing I don't want to complicate
the this stuff and I love more gwt's
then these are for your border for you
don't just have to go with mobile so now
we have the local logging we need to add
this thing to one of the route we're
going to use for the user so what we're
going to do first
it's we're going to create a controller
inside the user controller here after
the sign up we gonna export
another async function another missing
function sorry we're going to export a
function log in with react rare and next
next it's because of the middleware of
passport here what I'm going to see it's
rare that status 200 Jason read the user
why are this reg that users coming
passport gonna put the user inside a
variable of the require so we're going
to put it as a user so you can have
access to the user if you are in you app
after that just by doing react that user
after that year I'm going to do return
neck nothing more
so this is my logging yes not a lot of
stuff I know we already made almost
everything time to jump on the route go
down at the end of this line do share
command B or shift control D in Windows
the
delete this thing we don't need ship
coming years you can see if we don't
telling that in that Cappy phase the
line below use our controller dot
logging hold that logging perfect did I
have some error I'm going to look no
ever perfect no I'm going to jump here
so I've created my user logging so I'm
going to take my email so I'm going to
go to use oral again I'm going to create
my email and I'm going to take my
password so think about this this is
what the user sent from the front end
for the login page I'm going to send and
now what happening oh I know why
passport is done there that's for do
nothing now and we get that to annual
but we get nothing because the user is
not committing from the the direct that
user because password didn't do nothing
we need at the top of the file right
there I'm going to import from my
service that out service I'm going to
import out local this is a middleware
put it right before the controller
that's it now start on test send for one
unit arrives why did I get that what is
the problem I'm going to go to my out
service just point out and ear what I'm
going to do is I'm going to log my email
my password and I'm going to reload
after that my user I want you to
understand what can happen I'm going to
send again this is why I
Sen tes Gmail calm so this is my email
arrow well it's my password this is the
use our convening from the database now
so you see what happened now password
password it's not the same thing that's
why this thing is brittle is thing break
everything now how can I make it work so
easy don't worry go to user model at the
top here we're going to need to import
and now the compare sync function bcrypt
don't gotta let you who withheld this
comparison I mean the app build
something already in fact user method
here I'm going to add another one called
authenticate user this thing and I take
again the password so that's going to be
another function in here what I'm going
to say which I'm going to return compare
sync and I'm going to return I'm going
to pass the password so finally take two
thing as you can see here you take at
the data you want for the compare region
comparison and ash one and look what is
returning a boolean so I'm gonna hit
this that password because remember now
users Timo it's like a prototype of the
user so now that this mean their user
you search and yeah back set the
password coming from here and this
password is the one coming from the
front end so now so now what I'm going
to do is I'm going to just remove this
thing and now what I'm gonna do is here
I'm going to just make if use our that
authenticate I think I make a typo right
there but the ticket user that's a good
place
oh yeah right there
that's underscore so I mean if it's not
so if that means this thing is Falls I'm
going to return this if it's true I'm
going to return the password so I'm
going to try like if you do in testing
I'm going to try the submit in
networking I'm going to say pass in a
world zero nothing same units are write
in a world of one so this is a good
password boom I have now my user so now
my user it's inside my read that user
because of passport and now that's why
this controller here now add access to
the read that user and this is what we
sin so that works this thing for this
it isn't of hearing something you and
let me know in the comment I mean is I
make some error and stuff like this and
so what we gonna do in the next one we
get a jump so what we're going to make
its now I mean we add new security we
send the password everything this is not
what we want to send after the user is
logging after that we're going to setup
the GWT login so that's going to be I
get a passport stuff so that's going to
be the next port
hope you enjoyed this not a new series
let me know how you find this share this
stuff if you think that can help someone
else and we see later Anna goodnight bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>