<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>12 Apps in 12 Weeks Challenge - Week1 - Part4: Server validation and shortUrl function [English] | Coder Coacher - Coaching Coders</title><meta content="12 Apps in 12 Weeks Challenge - Week1 - Part4: Server validation and shortUrl function [English] - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/EQuimper/">EQuimper</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>12 Apps in 12 Weeks Challenge - Week1 - Part4: Server validation and shortUrl function [English]</b></h2><h5 class="post__date">2017-01-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/s7KhVLu9skg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everyone so today we're going to
continue the story about the short URL
so today we have five step we need to do
the first one I'm going to be to set up
some validation in the server just I
don't want is to make the short version
of the URL pass by the client so lonely
we're going to create a crypto algerie
up for make the short version after that
weenie I'm going to show you a method
come in Mongoose who is a cold place and
after that we're going to work a bit on
the controller so right now when I left
you yesterday so I'm going to just store
the silver when I left you yesterday we
can create we can create what we can
pass a website so then told i'm going to
pass his book one that calm and we get
the end floor and we can see this one
inside database but right now if i put
nothing i'm gonna get error but this
error is coming from the model is coming
right here and this is not a good
pattern because you see here as I
require so my controller don't do
nothing for my controller left this free
and make the model in the lab and this
is really not good to do so first thing
we're going to work with that so
remember long URL is there and is a
property inside the body and this is
what the client gave us so we're going
to create a if statement here okay say
if we don't have any long URL we're
going to return rare that status for on
the world and with a JSON object with a
message you must provide a URL so now
we're gonna say will
and now if I send this we receive you
must provide a URL so if I have nothing
this is the info i'm going to get if i
type some random URL I'm gonna I can
continue to create but from the thing we
got you must provide a URL so for this
one is good but right now what happen if
i type this who is really not a URL and
i sin oh that face this is really not
good this is not what we want we want to
put some layer the default model Adam so
what we're going to do is we're going to
install a library called Valley Dexter
so this is use a full library with a lot
of l / for validation of like see
something is an email something is a
value value at the URL etc so here I'm
going to restore my server we're going
to import the library but here I'm going
to import is you will see the URL is all
capitalized so like you expend see I
always important top of my what I
important it inside my friend ray so I
know everything at the top is going to
be the library so here now I can use
this URL so here what I'm going to do is
I'm going to make it else if so remember
ear if something pass this if statement
that means we have something so now we
can work with that I'm going to think is
URL so if this long URL is not a URL I'm
going to return almost the same message
but you must provide a valid URL time to
test and then wait a bit
I'm going to send up you must provide a
valid URL so now we have if we have
nothing you much provided URL if we have
something with our URL we validate that
and now if I sang google com I can
create so this to stop are good to go
after that now think about this inside
the application when you create a short
knee if someone pass short fat a URL who
is already short inside your app what
you want is to send in the same one you
don't want to make use of this of this
URL again so here what we're going to do
is just return the one we have inside
the app and don't create again I'm gonna
just remove everything we did there
we're going to use the URL coming from
the model we're going to use the method
called find one inside MongoDB you have
a lot of metal and one of them is fun by
ID who find on the by ID and find one is
something who is returned only one
document with some condition and the
conduit addition we're going to pass it
along URL remember in es6 we don't need
to pass the same key value which we have
we can just fat one so if the long URLs
equal the long URL we don't need so how
would you like this one so we get back
at promises promises at to call back one
going to have their URL if we have one
and the second one I'm going to ask
there ever a I'm going to rock the work
right now with the error going to be
easy we has a status and a i'm going to
say 500 el fondo en n jason going to be
error that's it so here inside this
callback i'm going to open the bracket
like that
so air inside the song let's say if we
don't have an URL so that means it's not
already safe it's time to create one
we're going to do current new URL the
same way we did in telepathy that we
passed the long URL right there after
that I'm going to return the URL that's
safe so the method for saving this one
going to ask at premises this one going
to receive gonna ask again to call back
one going to be the URL when I do
something like that always keep like the
first that or just for myself so I don't
keep up with this URL i just remembered
this one so here where the setter so we
create this one so we're going to go
with at 201 with a json with the URL
going to beat you so the one we create
if we have an error right there where
that status here that's going to be a
500 / server so we cannot save and the
JSON object gonna return the error so
here what we did here it if we find a
URL with the long URL coming from the
client we're gonna create a new one so
then I save this one and we're going to
push that to the front ask them if we
don't if we find a URL already create we
just need to return this one with the
status of 200 Oh status of 208 the JSON
object with the URL coming right there
that's it so now we're going to test
this one so here you see have ID this ID
radar so if I son again I'm going to
state IDs at the top cause this is an
object already get it is algae already
in the database you see I get a status
of 200 but if I create something I'm
gonna get 20
1438 so you can see just there who just
said it if I create something I get this
ready if I if I just give them back the
one we have ascended 200 right there so
now for the validation for the
controller we're going to stop with that
for now now it's time to work with the
point to fall apart it's we're going to
join the model now inside the model we
just add one prophecy call long URL
right now we're going to quit on the 10
short URL we're going to save the short
version that'll be a type of train going
to be unique true and after that we
gotta pass validation coming from coming
from mongodb called maximum so we check
the maximum length of something inside
inside this property so the messin of
that will 16 and the second argument
here is the error so ever with the
length that's going to be the arrow
right now so now we have a short rail
but we right now we don't touch this one
we don't want to touch this one we want
the server to create another rip create
I mean a random string moves going to be
the one we gave to the km and this one
that is the the main logic of the
service so what we're going to do is we
create a function so the first thing
we're going to import crypto Cristo is
the library right inside the GS no need
to import this one to install this one
so we're we're going to create a
function just type some current so
function for make short version so we're
going to call this function and make
unique make you new URL when I take a
lamp so just L am here in es6 if you had
a narrow function and this isn't a thin
line you don't
to return so what I'm going to do is I'm
going to enter tab a so that's going to
be like just follow the des in line let
us to be smart enough to see this one
I'm going to take crypto crypto add a
method called random by will give
something when them here I'm going to
just put some of your ribs so Matt
saweet on the smallest number greater
than or equal to the integer I'm gonna
pass the lamp the lamp sorry lance and
I'm going to make a 34 like that right
there so this is a random a good rip for
make random string finally yeah I'm
going to put that to string with a
base64 basics for me we want every
number of 0 to 9 and 11 and the
character so a to z m lowercase and
uppercase after that we're going to put
a slice of 0 with the lamp after that
we're going to replace every plot so
every plus globally to wither 0 and
we're going to replace every dash every
this character right there / like that
with a 0 I mean something like this and
this is the finally the function we just
need but now we never eat this function
at all so this is the time we're gonna
see a new metal inside mango pre safe
what is pre-safe proceed it's a book a
great look for the document so this is
something Adam before you do something
in MongoDB so pre-safe mean before we
say something so it's a good day a good
place to example you create a user
application and you want to ash a
password so this is the place where you
do this
after that we you have pre removed why
if example you create and medium website
where someone can create a lot of blog
post and if i delete is on account you
want to delete h blog post yes so in the
pre remove you're going to look over
each of these hoes and you can remove
everything so this kind of is really
elephant this kind of lettuce or here
inside the presale i'm going to have a
cold back metal and air this is a place
where you need the function and that the
error function because they are we going
to lose the context of this so here i'm
going to pass the neck and done because
this is a middleware now you're going to
see yes and say i want to i want use the
weather i will call back so a i'm going
to just put yes invisible line so that
going to DC about this line only so here
I'm going to call next and I'm gonna
console.log this you're going to see
what I mean so now if I create something
and I do enter the disc is the object we
just create right now so it's the
MongoDB object that's MongoDB so it's
all that right there before it safe so
what that what I let us to do is to make
the short URL right there so we're going
to call this that short URL going to
equal to make unique URL with six
remember in JavaScript a function it's a
value so we're going to call this
function we're going to make a random
string with the ln6 and this short URL
is going to be this one right there so
now if I save this one if I save this
one and I take this URL right there and
I pass it right there I'm gonna get when
I good oops and make it people weep
place
ok so now if I say now that a random
string for the URL right there so you
see all easy that was so we would get
there cuz the death right there is the
document before it being safe nothing
else but now we get a problem we never
seen if this one going to be unique so
we're gonna just make a validation for
be sure this stuff going to be unique so
we're going to use the Mongoose right
there a library good model can i search
for URL who is the name of this one
right there so we just use the URL right
here it is the same of when here we
import the URL but here right inside the
mongoose well that's you find one here
I'm going to find one with a short URL
going to be equal to this that short URL
they're going to give me a premises with
to call back the first one going to add
URL and the second one error if I have
if rather than ever I'm gonna just done
with the error remember this is a
middleware so we have access of next and
inside the callback we ever done we can
call that like CD or something you want
for this to come back here I'm going to
do a if URL what I'm going to do here is
that short URL equals make unique URL
again so if this one is not unique I'm
going to do again and they're going to
give me my unique form that's it so now
we're going to watch if everything is
working so I'm gonna pass a new URL so
this one right there going to pair this
form and now we get the short version
nothing more so right now we are good to
go to start working
with some kind of channel in the next
episode so I hope you enjoy if you have
any question don't is it a to ask me on
the youtube on my youtube the video in
the comments and if you like video it
lies don't forget to subscribe if you
want to follow the story on hope you
enjoy have a good day bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>