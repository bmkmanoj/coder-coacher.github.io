<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Create a NodeJS + MongoDB Rest API [Part: 5] | Coder Coacher - Coaching Coders</title><meta content="Create a NodeJS + MongoDB Rest API [Part: 5] - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/EQuimper/">EQuimper</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Create a NodeJS + MongoDB Rest API [Part: 5]</b></h2><h5 class="post__date">2017-05-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/fVq3VFjASqY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">a welcome to part 5 time to jump on some
GWT stuff so in the last design we did
the hotel again so we are able to sign
up so far right now what we are able to
do it if we go to the sign up we can
create a user so I'm going to create a
user right there so I create my user and
now with this thing here what I can do
is I can now be able to log so now I am
able to look so this is what we are able
to do right now
now time to do some GWT application so
for today what we're going to do is
we're going to create a secret password
for a GWT we're going to add the
password GWT include a strategy like we
did them with the last one after that
we're gonna do the we're gonna add the
JSON library using what token library so
this library it's the one the one we
need for reading the GWT trip and
finally we need to send less stuff to
the application because right now one of
the problem we have is we send
everything so as you know right now when
we send stuff from to the front end this
is what we sent so I mean if it's not
what we want why an application will
send the password and thing like that to
the front end the front end Dominic
discuss all the secret stuff need to
stay in the back end so time to
germinate so first thing I know maybe
some of you don't know what is GWT so if
you go to this website GWT that IO
they're going to give you a good
introduction about this so what they are
is they show you like what is a JWT
so this is what looks like the final
JSON web token so as you can see the
first thing we are in red is the adders
so if the algorithm now second-team is
the payload so here is the user data you
are right there you see here when I
decrypt this thing I get a sub so I'm
like this ID the name so John do and the
admin so
turn onion - so this is what you sent to
the front end why you send that to the
front end because the front M now going
to be able to to take this is the WT
with him and finally you're going to add
it for fall on every request so now on
every request you're going to make a new
application you're going to need to add
variability in the others it's your work
with the web a good way to make it
available if use local storage and take
it and make it on every request you're
going to make that's going to be a
really easy if you use react negative
like I do on my other tutorial we use
easing storage so time to draw me the
code first thing we need to do we need
to create a password so because as you
can see we need to add attacks also the
password secret so as you can see like
ever invalid signature if I change the
password so what I'm going to do is I'm
going to add this in time I constant so
in time I can't stand I'm going to
create now another prop called GWT
secret so I add this thing in their
country because when I'm going to
general my prod and one maybe two as a
debtor stuff because now I'm good I'll
just this is a secret
you see our secret is that it's not a
lot
so now after that we need to install two
library to open a terminal and add JSON
web token and passport GWT now what we
do need to do go inside out service
we're going to add the service of the
GWT so at the top we're going to import
strategy and GWT - energy and we get
export to extract GWT from path for GWT
after that we need the content because
we're going to need to use the secret so
come see Const em perfect we are set up
so here here that's going to be all the
locals through TG after that I'm going
to do screen another one called GWT -
strategy perfect we can I create again
some option so fine Annie sorry I'm
going to just take this thing up and I'm
going to just make it here so we know
it's all about GWT local strategy here
the top current GWT o pts for option I'm
gonna say GWT from request now I'm going
to extract from out others so
authorization headers and I'm going to
call my other authorization because a so
this is why the GWT going to take at the
reason we're talking Tanabe so when
you're going to log this is why passport
gonna take the token coming from the
front end after that year sikri up our
key we're going to add the content GWT
secret that's it so the secret we want
for the GWT gonna be that after that
current GWT strategy equal new GWT
strategy so new strategy so it is going
to be GWT option and now I'm going to
add a nice thing a callback right there
the payload and the done payload gonna
be the result of the GWT finally so if
we jump back to where we are in the
chrome payload is this thing here is the
data coming from the GWT so now what we
can do with that is I'm going to add a
try/catch again like always I'm gonna do
my wit book my error first to return
done e and false for my error and have
no user after that I do countries are
equal await you
are that fine by ID why here did I did
sign one and a I do find by ID because
the payload the only thing I'm going to
add inside my GWT going to be the user
ID so that's going to be all we're going
to know which user as it thing about
this the ID tell you it's unique so this
is just a waste figure out which users
so now it only thing we need to do is
pillow that underscore ID if has no user
a I'm going to return done with no error
but souls because I have no user after
that the only thing we need to do for
final this stuff so near this curve it's
returned all done with new and the user
so here if we add a user and we find it
from the GWT we're good answer no error
in the user that's after that last part
going to want to use GWT strategy good
export current out GWT equal passport
that at a decade GWT session fall so
here we're going to just create a new
diet application middleware perfect this
is what we want so now all can we test
this stuff going to be a really easy
what we can do is if we jump inside the
module so I'm going to just add a way to
add a test so I'm going to import from
my out service I'm going to import my
out GWT after that here I'm going to
clean another route just for fun
/hello going to be the name of the route
and AI get method I'm going to put the
out GWT as a middleware I'm going to do
reckon my rails not like always and ear
I'm going to realize that sense this is
the
proverb route that's now I'm going to
jump on Posner I'm going to open a new
terminal I'm going to go to my local
oath no HTTP a node API v1 just below
that I'm going to send my request unit
arise what happening my ADD node GWT
like I say we want we need the GWT ad
here so I'm going to say authorization
don't worry we put lowercase but by a
policeman this morning up to find it
here here I'm going to put something
like that no working passport GWT check
if the legibility it's a real one and if
it's don't give them a user that means
it's not one your application is given
so I mean this is a really good way to
make identification now yes so now the
question is how can we add a GWT finally
because right now we we have no it so
time to join the user model here at the
top I'm gonna import the GWT from the
JSON web token library we just install
after that I'm going to import my
constant object coming from the config
folder and constant because I need again
the secret thing about this a GWT take a
secret to crip itself and after that
with this secret I can be trip and get
the value of the user in what I'm going
to do it's a good change again to add
inside the method here so inside the
methods of the user I'm going to create
a create two can method if thing take no
argument this function but it's going to
return a GWT that sign so this is all
you need to create a GWT so I'm going to
open created a bracket after the print I
see I'm going to put
a bracket because you take an object
first thing you take it to the payload
so what you want to sell in the GWT so
I'm going to say underscore ID and I'm
going to say this that underscore ID
remember this means the user MongoDB use
the underscore ID that's why I still
using on the squaddie the struggle
argument after the object is the secret
so this is GWT secret and did I did
something no make a typo perfect now
it's working but this crypto can need to
be tall girl where do I'm going to
toggle it so that's why we're going to
do two things in one
so I'm going to show you a better way to
make it so what I'm going to show you
it's a way to just go inside you'll use
our route controller sorry and see when
you'll be logging we're going to say reg
that use our that create token so right
here I can do something like that if I
do this what I'm going to get when I
love you it's only the GWT you can see
now I have the GWT so this is how that
looks so really pain to read that I mean
it that's why it's really are I mean to
to make bad stuff with that but this is
not we want to serve we don't want just
to send edgy WC we want to send
something else plus passport GWT need to
add a GWT in uppercase in front of this
so what are we going to do you're going
to see how easy is that here I'm going
to delete that I'm going to still use
that here as you can see we send that
inside that JSON object by default
Mongo's other methods called to JSON who
eats tauriel
when you say it is DC you send the duck
man from a to a JSON object but you can
overwrite that
all we do this inside the method again
I'm going to say ear 2j7 upper case by
doing this I'm going to return now an
object so thing about this this is now
what you return when you use an the
Jason I want to have the ID in the front
M Y because I need that maybe to see if
this user do like I mean the for doing
stuff in the which react and redux or
angular like whatever you want to use
after that maybe I'm going to want the
username so there's that username maybe
first thing like welcome any well or
something like that and after that I'm
going to send the tool cube I'm going to
use the back tip es6 feature I'm going
to put GW confirm like I told you and
after that square a dollar sign square
curly bracket and I'm going to say this
so that create token so you see now I
add ID the username in the tool camp
this is what I'm going to send that is
that tree token is this thing here so
now if everything worked now if I learn
I got treating ID username and token you
see oh maybe I want to send the email
give the email example just go there and
you change it so now you do you go there
Sam boom add the email so this is an
awesome way to my security in your app
you don't need to do nothing more you
don't need to clean another content to
make it with this way you're going to
love it and the thing is you can use
this for any kind of document in your
app so you can just about user you're
going to see it when we're going to add
the blog post okay now do the GWT work
I'm going to go there no GWT I have one
but is that perfect
you know terrorised is available what do
you want I'm going to copy paste this
value
I'm going to go there and now I'm going
to replace this thing with the value and
now time to sift that going to work this
is a private route that's it
that's working this is what we want so
we just finally the attack station part
of the education for now so what we're
going to manage all other stuff and
everything so in the next two done we're
going to do other stuff like the polls
change the error stuff and we're going
to return back to the user when we're
going to want the user to be able to
favorite oppose follow another user and
thing like that so I hope you enjoyed
this it's done like I always I'm going
to push all this code to my repo and
again with the report it's really easy
for you to just see why I am at the
point of the application so I hope you
enjoyed this series let me know in the
comment if you liked that and please
subscribe if you didn't so you can
receive notification when I add a new
video
and so I hope you enjoy have a good
night like</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>