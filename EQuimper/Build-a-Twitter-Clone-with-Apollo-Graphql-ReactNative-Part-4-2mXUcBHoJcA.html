<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Build a Twitter Clone with Apollo Graphql &amp; React-Native - Part: 4 | Coder Coacher - Coaching Coders</title><meta content="Build a Twitter Clone with Apollo Graphql &amp; React-Native - Part: 4 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/EQuimper/">EQuimper</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Build a Twitter Clone with Apollo Graphql &amp; React-Native - Part: 4</b></h2><h5 class="post__date">2017-07-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/2mXUcBHoJcA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello if you want
so part four so what we're going to do
is we're going to continue what we did
in the last one so the last one we make
use of SQL and MongoDB to create a user
we can sign up and log in but we don't
have kind of like a certification for
the front-end so this is what we're
going to do so so what we're going to do
today is we're going to set up the GWT a
token creation and verify and also we're
going to make use of the context for the
graph key well to make sure the user is
always at a decade on the route who need
to be hurt of the K so when we live left
the the last Excel what we may get if I
can sign up and receive my user in my
email as the response so again this is a
graphical app I put in the description
in the last one and here I can create a
tweet and I can create a still creat to
it if I'm not logging and again hello
here so this is what are we going to do
we're going to make sure only a user
with a particle in their app can create
the tweet so this is what we're going to
do so first thing what I want to do to
it I want to thanks AB an hour here with
an awesome channel about the grass QL
and sometime when I get stuck on my past
app I came here and watch a lot of this
tutorial about SQL and yet a lot so a
big thank you for you so I'm going to
put is a youtube link in the description
so that was this thing so what are we
going to do so the first thing what
we're going to do is we're gonna we're
going to set up a new schema type why
are we going to finally return a token
what we're going to create for the one
who don't know what is a GWT editor it
is a visible token who is finally like
kind of a stream who have like a cryptid
version of a lot of stuff in your app
and finally inside that
gonna add the the user object so if we
go to GWT that IO you're going to see
what I mean this side here like air is
kind of the GWT and inside the day code
version when we decode that we get a
payload what we have there the the user
status so availability can experience up
like that so finally it's a way to don't
use like cookies and stuff like that and
make use of a server less way of out
application why we make use of it it
just because it's really good for mobile
app plus we can also use it in like in
in web and stuff like this so if you
want to push you up after that in the
web without with the same server that's
going to be pretty easy so we're gonna
first thing create the Eskimo about the
attached occasion so what I like to do
to make is I'm going to create here
inside the scheme are gonna pin another
type call out so that's going to be the
type of application in here what we're
going to return is going to be a string
which for sure we're going to return a
string at the token string so that yeah
I'm going to change my user at both side
here by doing coming di can select both
ctrl D I think for the windows user and
now I'm going to return the out
education so now if I do this and I go
to my graphical the thing about my sign
up is now anymore don't gonna take any
more the username but that's going to
take a take and like the token so this
is what we're gonna return so if we go
to the sign a mutation now we know we
return a dart application and that's
going to be a token string so that's
where we're going to start so the first
thing I like to do is I like to module
my stop so what I'm going to do is I'm
going to create a folder inside my
source and I'm gonna call that services
side this one I'm going to create a new
services call out that year so this one
this is where I'm going to put all my
stuff about identification and here what
I want to do before it I want to create
a method on my user to create a token
because right now I can create my
service but my service don't get a make
sense for you
if you don't see where oh I can create
this thing so the first thing I want you
to do is do to your terminal and add a
new package called JSON web token so
this package is a package build by the
team of owed oh we have bill and finally
a JSON web token generator and make your
life easier so here what we're going to
do is at the top we're going to import
GWT coming from the JSON web token
package we just create our setup like
you know I really like to model my stuff
I'm gonna go there and I'm going to
create another function in my metal
crate program here I'm going to return
the GWT that's fine and this one takes
three arguments so if we check here take
three of your men and take like the
payload the secret and other option so
here the payload what I want to add
inside my GWT token so when I mean the
payload is this thing here so I will
keep this one I think it's this pedal
here so for me the only thing I want to
return here is the ID of the user I
don't want to return nothing else for
now I'm going to say underscore ID to
keep my code that convention with the
MongoDB and I'm going to set this the ID
because remember that's going to be an
instance of the user and that this going
to be the user ends up at salary I need
to put my secret so what I'm going to do
is I'm going to go to my config folder
I'm going to go to my content I'm going
to create a new variable here called GWT
secret and I'm going to put a secret
phone also this is a secret one two
three so that's going in my secret for
now and then going to join at the top
here and I'm going to import my constant
object coming from my config constant
and like that and now every one I can do
is I can say take my constants that GWT
secret to be the password for the token
so the day I need a secret and I don't
want to expiry dates to Tori oh we don't
make it expiry so we're going to just
keep it like that so now we know we can
create a token
so we can already make use of it going
to be pretty simple we can jump on the
we have ql resolver user and now here
what we can do
it's now we're going to create this
thing as an async function and now here
what I'm going to do is I'm going to see
current user equal avoid that use all
that create so we're going to finish the
premises of the user create so this way
we can make use of the user object to
return the token so now here what I'm
going to do is I'm going to return like
my GWT asked it for so in turn my schema
that need to be an object with a token
in clients I'm going to stick token and
now what I'm going to fix user that
create token so the function we just
create inside the user object right
there so now if my server still work
perfect you work now I'm going to draw
on a graphical app and now if I send
that I'm supposed to receive a token now
if I sell boom now I get my token so now
I can play with this token and that's
going to be my way to make a
substitution so inside this token when I
decode this thing I'm going to get the
idea of the user so this is all you can
make kind of server less and that's over
less but I mean stateless pacification
in your app so you don't keep stay
because on every request we're going to
send the token in the headers and inside
the others when we get that we're going
to make it accessible on each resolver
and this way we're going to make sure on
every request the user is a real user in
your app so we sure we don't get someone
else gaming in your app and that's
that's a thing for now here what I'm
going to do is I'm going to go and send
my out service to my source and I'm
going to import my GWT from JSON web
token so the GWT library here after that
what I'm going to do is I'm going to
import my constant object where I can
get
GWT and secret one sec that config
understand and now I am going to import
a function called decode token this
function going to take a 2 here and a
we're going to split this token inside
an Eric why may be asked is because like
that what I want
if this tool can going to start with
bearer and after I'm grandma to here so
this way I want to split this token I
want to make sure the are zeros of the
first index here going to equal bearer
curl L I'm going to turn a run a new
error and I'm going to say to Cal it's
not value because I want to have the
bearer so this will make sure I did my
client like my friend there so that's
going to be asked for this tutorial
no you need to put the bearer on every
request so this way we just know that
like someone can came here and we be
like put something like that yes this is
a 210 but if you don't know how that
works
so you see what I mean so here now I get
my token so now what I'm going to do is
I'm going to return the dude ability
that verify with the function
synchronous be important to know that
give that very forgiving token using a
secret or a to the key and decode this
tutor so this way I'm going to put the
r1 because remember that was there are
like that and the song is a token and
now here what I'm going to say is I'm
going to say constants that GWT secret
so now I'm going to view fight this is a
valid GWT for my coming from my client
but not a question it ok
yes it we can decode but how we're going
to put that in your code so before we go
there we're going to do a cleanup in the
code so why do this right now it because
we have to not a lot of code time to
make it so I'm going to create a file
called middleware that GS here inside my
configuration I
you know for the one who all who follow
me on my other tutorial it's I like to
model my stuff and this is almost like
always the same kind of pattern I'm
always using so inside this one what I'm
going to do now is I'm going to export
behold a function will take a nap and
now what I'm going to do is I'm going to
jump to my index and now I'm going to
take all this app that use and I'm going
to take it outside I'm going to take
this one here I'm going to jump on my
middle work now I'm gonna make my code
like that after that I'm going to go to
the top my index I'm going to take back
index my body force or sorry
so now my body parsing that anymore in
red after I need my graphical so now I
can import this thing
yes and it's awesome for that like that
annoying my constants so my constant
going to be pleased to import we are
just next to it like that and now I'm in
my schema so now what I'm going to do so
I'm going to create my schema inside
here now I mean might make executive
schema I'm going to take this one don't
worry the coach gonna be in the repo and
so you can check where we are and now I
need to get my type def in my resolver
so I'm going to put it right there but
now this is committing more from to like
that
and now we good but now to make sure it
still work I'm going to remove this
thing I'm going to go here I'm going to
import my middleware function from my
config middleware just make sure it's
normal if this thing is going to brew is
gonna break but yeah so get a break but
now if I send something no I'm that's
going to bring so that's why because
here now I'm going to similar where
these are where I'm going to put my app
inside that look at you term no pull
word now if I down there now I can sign
up perfect so we came back at what we
were before but now everything is inside
the middleware so we finally get key the
index just to make
the beginning of the Act okay so now we
did one thing something we need to do to
make a middle wire for the execution
port we can make use of passport GSM
stuff like that but the thing if if I
make this a passport that's going to be
on every route and I don't want that so
you're going to see what I mean
so here we're going to create a function
called out Rex read and next so this is
all we cured emitter wire inside Express
there's going to be a server I catch
because we're going to have some
promises inside that I synchronous code
and I want to take it after that I'm
going to take turns to Ken going to be
equal to read that adders because you
make it an object why we add an endures
and not inside that I want to add it
from the a dorsal authorization after
that what I'm going to do is I'm going
to see if token it's not Neil why do
only one Newlyn that like that is
because if I would do this thing I make
sure that if it's on the phone I get
this error because nuts not strict on
the new give you the on the fine too so
after that I'm going to confuse are
equal a wait and now here I'm going to
call my function decode the one we just
create so I'm going to say from the
services out I'm gonna get my decode
function and I'm gonna say I wit decode
and now I'm going to pass my token in in
remember you're talking gonna come with
Bearer so that's why my decode pickiest
and speed after that I'm going to take
my rag that user so inside my rack I'm
going to create a new object called user
and inside I'm gonna call user after
that I'm going to run an ESN disabled
line because I'm going to get an error
if not and that's going to be no power
reassign and because we're going to have
more than one I can take this one and
I'm going to come here like that when
the ESM disabled no parameter else
you have no token I'm going to just
select the user equal knew of this word
I make sure like it if I have no token
my rate that users are just going to be
no and finally here I'm going to return
next so we don't stop there the deckle
right there after that we need to make
sure we use this out and I'm going to do
app that use and I'm going to see here
out like that so here we make sure we
make use of it as a middle word for the
app so now if you follow the pattern
what is gonna happen it on each request
we're going to check if the user are at
the others authorization and if e that
you're going to take it and we get a
decoder we're going to get the user ID
on it we're going to put it inside a
user inside the request object and after
that we can make use of it but for make
use of it we need to go down there and
put a callback right there what we're
going to say react so for the request
and now we're going to wrap this thing
like that so we don't need to return so
here they record a return an object
we're here I can click context where I
get to use are going to be equal to reg
that use R so I'm going to have a
context inside my my graphic SQL and I'm
that's going to be an object and inside
the subject I'm gonna have the user who
is going to be equal to the user object
to add the idea I hope that makes sense
that we don't accept what we're going to
work with it so perfect so now we good
to go
so just for showing you what we can make
use it I can do inside my example my
tweet resolve are right there now I'm
going to put it inside the crib is over
for now let that create like that like
this so here what I'm going to do it's
here I'm going to return that because if
I don't return the dinner break in here
I'm going to add the context and now if
I console.log con text now Dulce TX like
that
just to make sure my code is not
breaking perfect now I'm going so what
I'm going to do is I'm going to first in
sign up take this token go inside my
free tool can go inside the others
create iadder so that's going to came
like that Oh to ization a plan this
bearer really important and not paste my
token right there now five sites now if
I run Mike retweet is okay but now look
what what happened right there this is
the context where I get my user object
and whereas now my ID in it so this is
the ID of my user so now I can make use
of it and do what I want with it
but now as you can see I can still
continue to create just for showing you
I can came here delete my others and now
if I assume I can keep create because we
don't require my users would be at
applique and this is why we're going to
jump back to the services at attestation
then we'll get a create a function
called require notification so jump back
to you out services I'm going to create
a function here we're going to be easy
and we're going to call that require out
this one going to take the user object
inside this one we're going to do some
check out first if no use are or no user
that on the so ID we're going to true a
new error call you know to rise like
that like this so now I can make use of
this in sunlight which resolver so I'm
going to join at the top I'm going to
say import from services out now I can
say require out now I'm going to
transform this create weak inside
anything because now I'm going to do a
weight require out and inside this one
now I need to put my context I can do
this by doing contacts that use all like
that but again I can be structuring this
thing by doing
user and now I can see user Nick like
that and now for showing you that work
what I can do
it came here I have no withers and now I
create and I guess units arrived as you
can see now that worked and this is what
we want so they require out world but
now we're going to need to reinfect some
stuff here so era one every resolver
here to have this require all so what
I'm going to do is I'm going to make it
right there and now we're going to make
it easy and because there's going to be
already about this thing I'm going to do
a try-catch on all that I'm goin to
katroo error you know all of them I'm
going to also avoid require out take the
user coming in from my context like that
in here I'm going to return finally this
function and you need to do this only
view every one ear so try-catch to air
are so that we jump that we're going to
return here we do away so we make sure
we have anything one a we should require
out attach the user so a we need to do
on the score because we don't going to
make use of it and user remember this is
always the third argument after that
year we have already so we can just
drawn a try/catch show an error and here
we're going to return and keep doing
that's good we can get at it okay we're
going to take the user when I build a
try-catch through the error groups true
error and here we're going to do avoid
require I'll put the user now here can
return this thing and we make sure this
is an async hence on I did this one
where I'm gonna put the user if we have
already so so before we can do require
out and user perfect if I check here
nothing is very perfect we good to go so
again I'm going to just test it we
tweaked the word get tweet maybe with
the s because I don't know to pass an ID
don't work when you see in a tie right
perfect this is what we want so now
we're going to need to manage something
so another thing I want to do to it - I
want to get the information of my career
user and I want to show you them with
that with the ideas and do with it
everything we need for and you're going
to see that right there so first thing
I'm going to create inside my schema and
then the earth type I'm going to tell
that me so that thing this is what I
told in my other tutorial about the new
GS recipe I always remembered on the app
used by the cure user if if app is so
what I mean by that
it's everything attending in the server
for M it's always about him not about
someone else that's what we have a
toxication we make sure this is this one
so think about the user as a viewer so
this is the viewer and maybe here we
want to get the information oven example
after we do the log we want to maybe
fetch again get all the information
about him and get like this avatar and
stuff like that so what I'm going to do
is I'm going to copy paste all that I'm
going to sick neat right there again why
you see why you paste it there it maybe
in the next one we're going to manage
and other stuff about this and that's
why so here I'm going to see me and I'm
going to create another query right
there call me and this one gonna return
me nothing more me return me after that
to make sure all my stuff work I'm gonna
jump on the user resolver and this is
where we're going to manage the Donita
so here I'm what I'm going to do is I'm
going to import and I require out from
my services call out
and I'm going to create an me we're
going to be an another racing function
and now here what I'm going to do I'm
going to arch like that what I'm going
to add the user in the context because
they me going out on the opinion if the
user is there that's going to be a
try-catch where i can through the error
true error so now what I can do is I can
do currently equal always use our that's
fine by ID and pass it the user on the
soy be your can return the me but what I
want to do yeah but I have a one before
I wait require out and get the user that
unless quality so what I'm what I'm
going to show you this thing first
like that and air we're gonna change all
that - we're going to just create that
inside a track app because we have so
many thing I forget to put that inside
the other one we're going to being good
code I don't want you to get bad a bit
like have a lot like that
perfect so know what I'm going to show
you is this me so go back in your
resolve our first and put the meet year
put user resolver that mean okay so now
make sure the app is still working
perfect so we're gonna first thing
signed by user because remember you be
time the app refresh that we remove
everything so now if you're single gonna
sign up now if I call my me so if I call
my me wow my ID my email and maybe like
my username I'll do this right now
guess you gotta rise so now after my so
I'm going to just log because oh yeah
okay I see I forget to do something and
sign my user resolver here I return the
user but this is not what we want to
return a we want to return token well we
return the create token so that was a
good but that was a good error because I
forget to do this so I'm going to sign
up perfect
now I get my talk young I'm going to
jump on my knee and go to my headers
I'm going to take this thing after the
bearer I'm going to save it and now if I
check that now I get unit arrived
happening
oops because I click user that on the
square ID and remember inside out
service we already do this we're going
to get it don't worry sign up so that's
why you see I remove all the users
because I want to make sure I can just
keep continue to make this one if I say
now get the meat now I get live use all
my stuff because I get my ID so if I say
oh maybe I want to have my I don't know
like my first name my last name boom so
this is me this is my store okay now
that works but now what I'm going to
show you is if what I want to show you
is this thing now I can create a talk a
tweet so I'm going to create a tweet so
I'm going to do a mutation create tweet
with a text lol when I want to add the
ID in the text about what f3 I'm going
to go to the HTTP I'm going to say at
our relation I'm going to say bearer I'm
going to put my bear right there now if
I sell I can get what sure I seem one
sec sorry lol ID and text now you ii
still consume to write tweak but now the
thing is look at that I'm going to
restore my server or F this is all you
can resolve in Oman
yeah like that no idea now I can get
there
so you remember I'm a GWT method ability
gonna be still work but now look what
happens I still work but like GWT is not
working why is because yes a decode my
stuff here but maybe my old users as
creator
account yes the sorry get the token
beneath is that coming after I can still
work with the app and this is really not
what we want so all we can manage the
apps you can see so we're going to do
steadily to thing in one we're going to
jump on the out here and I'm going to
import my used or model all we can
manage this error is by doing here
checker I can click current me equal
away user that's fine by ID with the
user that on the square ID because
remember we can add access for it if I
see it's not me here now I'm going to
see the same error so finally the user
is not there and we're gonna return it
so this way we can make use a bit so now
by doing this what I mean it's now if I
go back to my ear and now I sell now
again you not all right because my GWT
now it's not below someone so this is
perfect this is what we want but now
what we can make use of Oh like a second
thing I told you it's now in my me I can
change my Rizzo over right there why did
use all the time by Tibet because now
remember every request we're gonna check
if the user ID is there so add it and
that and I'm return it right there I do
return me so that's going to be the user
himself so now that makes your life
easier you can come here
and I can see current me equal I know
want me a call avoid we require out
because now that return the object and I
can return to me like that so now if I
do this and I jump back here now I get
my wrong so now I'm going to sign up
first I signed up boom I go to my me I
go to my HTTP I remove everything Spain
they were safe and now if I sell boom I
get my user now in my career I get in at
arrived I get there I put my real GWT so
keep it pace it safe an hour
Sam boom now I can create and just to
make sure I go there and now you see I
create tweet so this is perfect this is
what we want so now as you can see we
have access to the user on every request
or the ID because a lot of time we gonna
just gonna make use of the ID and why I
don't want to use kind of Pat point
stuff like that is because if I make use
of the passport and stuff like this
we're going to work on every route
and now my son up in my login cannot be
done with the SQL because remember your
SQL always start with the same here the
same kind of URL in the seminal work so
perfect so we are almost done with the
server what we're going to do is we're
going to create the data then just wait
below the use are we're going to do to
the favorite thing so I mean the lights
so this is what we forget after that
we're going to do some other stuff so
finally what I think is we're going to
have done the server in the next part so
part 6 that's going to be about the
mobile stuff because yes we can have a
lot to do so I hope you enjoy again I'm
going to put all the link in the
description about the banner well our
YouTube channel and my repo and after
that too you can comment on my video I'm
going to response and you can like if
you like this thing and then share it I
hope you enjoy have a good day bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>