<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>M05-Intro: Creating Comment Feature | Coder Coacher - Coaching Coders</title><meta content="M05-Intro: Creating Comment Feature - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/EQuimper/">EQuimper</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>M05-Intro: Creating Comment Feature</b></h2><h5 class="post__date">2018-02-26</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/VpREHMUk1vQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">LOV one welcome to this point number one
for this milestone number five so what
are we gonna do for this one it's we're
gonna start to cook ad to build on the
server side their command feature so
it's gonna be pretty simple so first
thing what we're gonna do it's we gonna
add we're gonna add finally on top of
what we have already in the server so as
you can see here we have the photo here
inside the post context and I think
would be a good idea to put that inside
the pod can't poss context also for the
comment thinking about putting data like
we did here as a reaction because
command can be kind of a reaction but I
think it's more going to the post where
we can have like the photo and stuff
like that so we're gonna start with that
so what are we gonna do it's we're gonna
make use of the Phoenix generator so
we're gonna say Jen and now a what we're
gonna do it's we're gonna jam inside the
context sorry
inside the context we're gonna add that
inside the post context so just follow
the post so that was post with s so post
after that we're gonna say that's going
to be comments and ear after that we can
put the table name so for this one's
gonna be photo comment and now so here
is the name of the module here's the
name of the table and now what we're
gonna need for that it's gonna be pretty
simple what we're gonna need it's a text
text we don't go in a single thing
because if we say text string is going
to be the same thing I think yeah like
that here what we can s also it's we're
gonna say you're going to add every
friends for a to boat table okay you're
going to add a reference to the user so
we're gonna say here use our ID
reference the table user and after that
we can sa photo ID
reference photos like that I'm gonna
click on tar
and we gotta check what they give us so
inside the private repo migration the
last migration right there we see what
we get okay we get the text as a string
string I think I forget that will be at
text because the thing
it's string it's you don't have many
character you can put after that ear you
see here we get inside a migration on
delete so here what happened it's this
comment okay we're friends this user
okay the user ID if I delete my user
what I want to do here I say nothing but
what I want it's on both to deal it out
so what I mean by that it's if I delete
my user I want to delete this comment if
I delete this follow I want to delete
this command Y I will keep this Y I will
keep this command you understand what I
mean so and also we want to say note we
fall so just inside the server the DB
make sure that nothing can be saved if
we don't have any comments any user ID
and photo ID inside the comments okay so
now make sure to work by the ring egg to
make egg to migraine perfect so now if
we look here but if we look inside the
database what's gonna happen it's really
good to always check so here we're gonna
see for two comments okay so here this
is the flu command so we had the insert
added up data why we need that is
because we're gonna show me be the
comments the last comment at the top or
at the bottom whatever you want and we
want to show that date we're gonna have
an an ID to be the unique stuff in the
text user ID and everything so you can
see you inside of structure the ID the
text blah blah blah user ID go to the
user ID and that's so this is what we
want so here I just always go to my
database after migration to just make
sure everything is right okay so now we
are here now what we should do
it's now working on this command right
there
we're gonna need to add some stuff
because now you need to understand and
this command it's belongs to a post a
photo and
come in a photo and I use our okay so we
don't want this field user ID and
belongs to user ID like that what we
want to do here I just sing belongs to a
user who's going to be the Instagram and
nothing spec but Instagram the icon the
user and you're gonna be belongs to
photo also from the Instagram post photo
like that so now we can remove both here
okay also here make sure that when you
we cast cast so when we put any man
inside that where we want is to have the
user ID and also the photo ID right
there and we're gonna say also they need
to be required okay so now we have that
but now what we also need to do it's
going inside the photo and say now then
I follow can as many comments from the
Instagram that post the comments like
that and that's going to be the same for
a user a user can as many come in also
so here you can put photo comment if you
want or thing like that I mean it's the
thing it's like right now we can come in
on a photo but maybe later I don't know
like you're gonna maybe have a table
called video or something like that and
you want to come in on a video so that's
why I did this kind of stuff but I mean
you just naming convention so just do
whatever you want here so now we are
here okay so now what we've done it's we
have a table for the comments now a user
can have many comments and a photo can
have many comments and also their
comments it's belongs to both of both a
user or photo now what we shall do it's
because we work with graph QL we should
add the comment inside the schema inside
the scheme okay so inside the post type
because it's inside
the post context we're gonna add the
comment so we should do this right the
bottom so object come in do and now here
what we're gonna have we're gonna have
an ID who's gonna be an on new type of
ID we're gonna have a feel of text and
in graphic where would you see the
string after we're gonna have a feel
user because we're gonna have we want to
have access to who is the author of this
command example if a user I've come and
maybe gonna want to show is avatar and
his username also next to the text so
now that's what we're gonna work with
the first kind of association with AB
sine so are we gonna do this it's now
we're gonna need to import here at the
top we're gonna do two thing we're gonna
say use apps sign that ecto here we're
gonna say repo it's equal to the repo so
the repository we have so repo like that
and after that we're gonna say also
import ecto that curie by doing this now
a what's gonna happen it's now we're
gonna add access to the user object so
the user object we have just create i
think we didn't create so we're gonna
create and this thing we're gonna get
that by doing resolve association we get
that cause of the actor curry right
there and now we can see user so what
happened
it's apps on gonna find app sign an ecto
gonna work to get our to give you access
to the user inside this user object so
we can have access to follow the command
the user that avatar command that user
that ID so what I mean like gonna do the
doing table right there they join an
association we're gonna do the same with
the photo so we're gonna say it's a not
nil yeah we don't really need I think
about this we don't really need the only
thing we need here is going to be the
is both stuff okay so now here we have
the command ID text user insert add up
data
yeah that's we don't really need a photo
here because I mean we're gonna get that
below the photo already so but we need a
user so I think now it's going to be
that time to create the user it's gonna
be pretty simple for that I mean I use R
so if we're gonna do this here a user
what can I use our app okay so if we
look back inside the table a user can
have an ID a user name an avatar a
Facebook ID an email first name last
name and start add and update at okay so
here what I think we should just put
accessible to the front end is the ID
maybe we want to access the email we're
gonna just see string like that and
we're gonna need another towel so and
also maybe they use our name like that
okay
I think that's it for the user maybe
like if you want we can give it access
also to the insert and update I always
remember with graph QL as the back end
developer you just give it access to
whatever you think the front-end can
need but example here I will not put
like the password you don't really need
the password different and stuff like
that this kind of secret you want to
keep it in the back end so you don't let
him accessible right there but this way
you can for that so now we add the
comment and everything so we have
created a schema of the comment so no I
think the stuff we're gonna need now
it's going to be to do some mutation so
we're gonna add a mutation inside the
resolver via post and alright then we
can finally create a comment this is
what we're gonna do first we need to
create a comment so we're gonna create a
new function called create comment and
now this function a what we're gonna
need first it's gonna be we're gonna
need nothing in the parent we're gonna
need that text here and what are we
gonna need from here is gonna be this
user because when we create it okay and
not just the text but also the photo ID
so here what you want because it's going
to be all with it as a map we can just
send the argument okay and now what we
want here it's we want to send finally a
map we're gonna have the photo ID like
that we're gonna have maybe like this
photo ID we're gonna have the text and
also we want to send a user ID okay so
right now what we can do for that its
merge both attribute so we can create an
active attribute variable what we're
gonna merge in this map the ARBs maps
with finale user ID equal to the value
of the cues are that ID so now this
attribute gonna be equal to just to what
I just show you and now here we're gonna
do a with okay function so with function
Wow finally we're gonna create right
there
pose that create comment we're gonna
create this function don't worry
and we're gonna put all the attribute
and when it's done we're gonna send a
comment like that okay so what we miss
is inside a schema inside this chemo
we're going to need to add the field
we're gonna need to ask inside a
mutation remember like all the other
mutation we've done right there so what
we're gonna do now it's we're going to
need to do a new one for create a
comment so we can say create come in for
a photo now your we're gonna say create
comments going to be the name of the
mutation we're finale we're gonna just
return comment back and now you're gonna
say argument what we need is the photo
ID who's gonna be a non nil ID and also
we're gonna need the argument text who
is gonna be a non new string and here
we're gonna add the middle water rice
and finally we can add the resolved like
that but now there's gonna be loops
create comment the function we just add
create right there so now if we go
inside the post we should have now some
function already create and now we have
this pre comment is all with the bill
for us cuz of the generator if you want
we can remove this comment really quick
yeah because take a lot of place for
right now like that like that sorry like
this and this okay so now we're gonna
open graphic um that graphic you well I
can I can get all the photo I don't know
why I get like that so photo ID and I
can get all the photo and as you know
now we can see also inside the context
we add the user we have built right now
so with my ID number six so now we're
gonna try to create a comment so we're
gonna try to create a command so I'm
gonna say create come in so here we can
add a mutation create comment so the
thing we just did and now we have the
photo ID so we're gonna say photo ID
number one and we're gonna say text this
is an awesome photo and maybe what we
want that put that bigger what we want
back is the comment so we can say ID
tags like that okay I found that we get
an error and they say function
PostScript is undefined module post is
on is module post is not available so we
must have done a mistake here we have
say post in that post with s so now if
everyone now look like you get create so
we see now we just create the first
comment if I go to my foot to come in
and my first comment so the ID number
one use our ID six they gave us equal
per and the photo one that gave us this
photo with this caption looks nice
perfect I can I create another one this
is an awesome photo again I can create
this same ear I get the same stuff but
now do I get the user that's maybe a
good question so why now I need to have
this kind of this kind of function
inside my schema so you see here we have
the query so we shall have another curry
called desk get all come in for photo
fill comments where we're going to add
ear list of comments and also we can say
that's going to be no new list so at
least we're gonna get the square bracket
when you get a need to be at all right
so also we're gonna need to have the
resolver air we're gonna call get
comments but now also we're gonna need
to have some argument and one of them is
gonna be the photo ID because we want
all the comment below a photo ID no no
idea
okay so now I have create the like the
function not create a function but now
what happened it's I finally create a
new setup of the resolver for getting
all the comments for that so now what
we're gonna do here is we're gonna jump
back on the resolver post we can create
a new function called get comment this
one as you remember gonna receive
nothing in the parent but we're going to
receive photo ID ear photo ID and here
we can just create okay post that get
comments for photo photo ID that's it
okay so now this for ID this get comment
for photo we need to create that inside
here inside the context not inside of
context but I don't know you call that
in English but it's like your
abstraction of the context okay and now
this function now what's gonna do if any
need to get all the comments for photo
and we're gonna this is what we're gonna
do once okay so now here we can I create
a new query remember it we have the
photo ID well we can just call that ID
but photo ID I think it's good curry
from did I have my yep perfect from P in
photo comment so photo come man you have
my alias I'm gonna put my 80s right
there and now when you have many many
areas inside the same
kind of mojo like that you can put them
inside square curly bracket like that so
it gets cleaner so you add as both so
from see in comments of the comments
inside come in finally we're see da
photo ID equal the value of the photo ID
variable we just add at the top and also
here what we maybe gonna want it's order
by this and then with the value of
inserted like that I know you're we
because that's gonna be an aviary we're
gonna do ripple curry out okay so now if
this thing work and you don't worry
either mistake but we get type math
exist if we friends comments it's not
defining a new schema fill command it
have list of command the object was in
singular remember the object was right
there is in singular i refresh i have
another mistake we say again come in
inside your schema
yeah that maybe not the best ever what
happen here so what we have done wrong
so we say feel command on your list of
command do are with the wat arise
perfect pose get command so inside the
resolve are we have this get come in we
ask for again its pose like that I know
another ever it's not available
what did I did wrong
sorry this is the thing about life
cutting so here I have my deaf come in
here sometimes we can get some kind of
weird error because you cannot do this
query if you didn't import ecto query
but we have so it's good also here we
have what we need this thing it's not
here the problem it's pretty hard to
read this error I think so
you know just restore the server
sometimes I ever get better when
function is undefined then you mean get
comment to I know why it's because of my
resolve our air I need to pass the
argument like that because we don't use
it remember Alex I always do pattern
matching so like that we have two
argument for him but like we have before
I was just too so you don't find this
month so now inside the ducks now we're
gonna have a new query call comments for
a photo walk you know what we can do can
call that so come in with commands with
a photo ID of one and we can say ID so
now we get their comment for both so if
we say text we have their comments this
is an awesome photo again blah
now time to try the user because a user
will be Aven a baton ID and also a user
name and if we do this this is what we
got we get the comments array with the
user object right there and the text and
the ID remember Allah with how we get
that was inside the post type here the
comments we see the failures are it's an
owner object finally what we're going to
receive result finally the Association
of the user so we gonna return the user
object here so this is what we do return
the user object so this use our ear and
we say the Association use our inside
the command we have this association
user right there someone happened here
and now we get this query and source
photo command we say give me the user
with this idea on number 6 because the
this is the the idea we get if the user
don't worry about the in one problem
anything like that we get a man-eater
now as you can see now we get holy stuff
pretty simple now your question will be
may be ok but now now you have to thing
to thing about that it's so what
happened
it's we're gonna call this function when
we're gonna get to the screen so finally
inside the project when we're gonna
click your ad come in we're gonna push
on at our screen and we're gonna get
this get request right there what we're
gonna get this ID from the navigator
params what you see was in that that are
here and this is one thing I pretty like
about using ACTU and also using with
apps on is they do this kind of stuff
pretty simple and I really love this way
now I think the only thing we're gonna
need to manage later it's gonna be about
how we can get the comments can ear and
that's it and also maybe one of the
things you may be one it's when you get
all the photo like that you may be gonna
want to add all these comments so this
is something we can do in the next
episode so I hope you enjoyed this
so at least we see we have the neck new
feature we can create a command
so again again and we can get your all
the the command we just create for this
photo like that wasn't that hard but I
about this you learn sorry for my
mistake and I hope you enjoy and we
talked about bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>