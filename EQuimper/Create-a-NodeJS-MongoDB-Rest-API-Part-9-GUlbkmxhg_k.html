<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Create a NodeJS + MongoDB Rest API [Part: 9] | Coder Coacher - Coaching Coders</title><meta content="Create a NodeJS + MongoDB Rest API [Part: 9] - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/EQuimper/">EQuimper</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Create a NodeJS + MongoDB Rest API [Part: 9]</b></h2><h5 class="post__date">2017-05-31</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/GUlbkmxhg_k" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello guys today were going to consume
the soil for nine time to do some update
with the post so what we're going to do
for this part 9 is going to be all about
just updating a pose and make sure the
odor is the one who has created the post
or what I mean is I want their use open
when I update the post to be the the
author of this post because I mean its
own stuff so so for this part 9 and the
part 10 is going to be really simple
small video for it 11 and more and now
is going to be the fun part so I really
hope you're going to continue with me on
the next video because we're going to
make more kind of relationship like a
user can tolerate something and follow
another user stuff like that perfect so
time to start so we're going to jump on
the post controller and we're going to
go down here and we're going to create
the new function for the update so here
pretty simple like always export a nice
thing function we're going to call this
one an update post we're going to create
a get the request and the response we're
going to add a try-catch with an error
here I'm going to copy paste this line
30 right there because it's going to be
almost the same and here what I'm going
to do the first thing I want is to find
my post so I'm going to do current code
equal a way that post find by ID and I'm
going to get my ID by that parent so
that's going to be coming from the route
so here we have the post
I know I can do something like find by
ID and update and and stuff like that
but because I want to add more control
and make sure Ike I can send a unit
arise route and authorize the error
that's why I do this stuff here so here
I'm going to do is something pretty
simple it's
here I'm going to make if it's not the
posit user that equal what I've just
done here
Mongoose add a method call equals when
you go with the object ID so by doing
this if I do that and I do now wreck
that wreck that user that underscore ID
so what that means is we're going to
check right there
yes the posters are equal so if the user
ID inside a phone it equals the real
user ID who is coming from the GWT
passport so here I'm going to return so
if it's not the real user I'm going to
return area that same status nothing
more than just sending a series of HTTP
that is that unit all right that's why
do I just anaesthetise I don't want some
msh2
so what I do is when I send an estate or
something like that I always use that
status because I send something else but
when I just want to send a set it I use
this method here after that you we want
to update only what we we need I'm gonna
use patch and what I want to do is I
want to just update the part of what we
sell because if you use put the thing is
you need to send the full object when I
mean a full object it you need to send
everything the ID all the stuff coming
from the object but when you use patch
you can just with the I did for sure but
you can sell only what you need to
update so err example if my user want to
only update the title you can with the
patch but if you want only to update the
the title with the could we get a name
to sell also the full object close with
the new title so hey I'm going to do
object that keys and I'm going to put
rock reg that body for the one who don't
know what do object that keys so what
that mean its object that key is going
to make an array of keys communing from
an object reg that body is an object
remember reg that but you're going to be
something like
: Cole is an object and here with
objective keys we make an array with
that so finally that's going to do
something like we're gonna have like
title and maybe like text something like
that
also in JavaScript this is not what we
need to do but you had also values so
when you do this you're going to have
like the title one and now you're going
to add the campaign so what I mean is
values make an array of the values of
the object but what we need for today is
the key after that I'm going to make a
for each here a for each it's like a for
loop but it's I mean you just make the
code cleaner for me and some people are
maybe going to ask why I don't use math
ear map return a new array so for agents
transit in map and for each it's for you
don't make a new array so this is the
the thing in ear my for each what I'm
going to do it here I have a key so the
key going to be like title or text
because remember this is the update post
here I'm going to do the course so this
is the post here
and I'm going to use the bracket
notation to make use of the variable so
post and a site also here if they keep
its title I'm going to change this one
so you're going to see right there I'm
going to just say rec that body that key
so by doing this the only thing that do
is add an array
and I map alike a look over it and I use
this variable we're going to be maybe
title our text and I just put it inside
the post and going to be equal to the
regular body that key so always remember
recognition it's a way to use variable
with the after that we all really close
to finish this one it's return rare that
Terrace we're going to send a HTTP okay
because we mean it's done and I'm going
to send a JSON here the only thing I'm
going to send it avoid post no post
that's safe so another promises it's
called duck tape inside a post and this
is the way to just make sure we save it
to the database because if I don't do
this all the stuff coming here going to
be work I mean we're going to update but
we don't save so we don't reset the
database so it's really important here
after that what I think would be a good
idea is to join the validation and
create a validation for the update here
we have done that for the create pose
and we say like this is a string with a
minimum of 3 but we want to keep this
minimum of treating if you update I mean
if the user I put a tree length at least
of title I want him to again put a new
tree length so I don't want him to make
just a one letter that said if you want
to update that need to go with what we
asked at the beginning so here I'm going
to say update post again I'm going to
use the body and now here the title then
it pretty simple joy that string
let's string but string
min I'm going to just say three why I
don't put require because maybe don't
want to update the title you maybe just
want to update the text that's it
so joy that string
and that min of 10 so if you want to
update tactics that's going to be made
up there that's nothing more to do here
after that we go back to post that route
I'm going to create a new route well and
I told you that's going to be a patch
after that the route we need a parent ID
so we put color after that we want it to
be a tab key to have a discussion on it
so we add the attached creation
middleware after this we're going to add
the very day middleware where we're
going to put post validation the update
post and finally now we can put the post
controller that update post because I
use prettier I'm going to run a ship
option F and now that make my code a bit
pretty and now what we can do is now I'm
going to get all my post so if I send
here I get all the pasa now I want to
update because we know where you need to
be logging so what I'm going to do is
I'm going to send a log n so now I have
my token and my route I'm going to go to
my new tab I'm going to put my token
with right now so in tighter position
I'm going to put it inside a value after
that I'm going to put patch here I'm
going to copy paste this URL I'm going
to paste it there just because that
they'll me and now I'm going to want to
update the first one here really easy so
I'm going to take the idea of this one
when I copy paste / ID to get the
parameter ID right there and now what I
can do it's inside my body I'm going to
just need to toll which way you want to
update so it's remember to put it's from
your LM credit so what I want to update
is going to be the title so I'm going to
say title and I want the title to be
site title 11 hello will something like
that
and now if I sell and now that's work
you see I receive my title 11 with lol
and now looks but it's funny to my slug
act change yes how did I did
that was pretty simple it's inside the
mother when we do
pre validate every time you save you
validate
so that just make a noose sluggy file so
you see that's why I use that matter and
that just make you like so much simpler
after that you don't need to be run for
yourself but now do this thing I have
really saved inside the DB that maybe
your question now for checking that I'm
going to just we've run again get all
post and now you see I get title 11
arrow will now maybe I want to just put
title 11 like before now let's come back
my sis come back but now look what you
gonna tell that's the thing I love about
my unique ready data now if I put 10 you
know what to title 10 it's already taken
so you see so the usual Google update me
to update against what you have asked so
if just mo don't want it to have another
title that's gonna work there too and
now we have work with the title I'm
going to just change the text I'm going
to just say example I'm going to just
check if that's gonna work for both I'm
going to say tech this is an awesome
text again and ello well just be sure
and now if I send this is an awesome
text again in a world that's it so we
are sure right now everything is working
there and so we're good to go with the
update method so I'm going to push again
the code in github so I'm going to let
again the github link in the description
I hope you enjoy I'm going to try to
make a video today about the delete and
after that Chris stay with me that's
going to be really fun when we're gonna
do the more relationship stuff with
MongoDB and I'm sure you're going to
love this part
and I hope you enjoy I really like if
you put comments I really appreciate
that that's really motivate myself and
so without data add a good day bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>