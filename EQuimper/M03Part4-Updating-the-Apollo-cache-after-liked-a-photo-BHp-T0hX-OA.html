<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>M03-Part4: Updating the Apollo cache after liked a photo | Coder Coacher - Coaching Coders</title><meta content="M03-Part4: Updating the Apollo cache after liked a photo - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/EQuimper/">EQuimper</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>M03-Part4: Updating the Apollo cache after liked a photo</b></h2><h5 class="post__date">2018-02-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/BHp-T0hX-OA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everyone welcome to the poor
number four of this third milestone so
as you know in the last episode what
we've done it's this is possible to like
but the thing is we're going to need to
refresh to get there like showing there
so now it's going to be time to update
the store I mean like updating the Apple
ooh store like the cache if you you like
more and for them and I have to work if
all you're going to really need to do it
about that it's going to be like
updating the store and using fragment in
Apollo I'm going to give the link in the
description but finally first thing the
fragment going to be pretty important
it's you can share piece of code for the
logic so in logic so example you can
create a frame and call a name sparked
who's going to be a type person why are
you say finally I want first name and
last name so every time you want to get
the first name and last name you're just
gonna sing import or you don't need to
say first name last name so if you
update first name to be I don't know I
use our name you just updated that ear
and that's going to be update here but I
can get pretty good and now here we're
gonna use the update function inside add
imitation gonna look like this so this
is where we're going to update the the
store finally and everything about that
so this is what we're gonna jump for
jump back in the cold
make sure your simulator is running and
your server is running
and now what we going to do it's
everything gonna start inside the feed
screen because this is the place where
we add here the plateau time to create a
fragment so I'm going to create a new
file inside this feed screen call
fragments the GS inside this one I'm
going to import gql from your ful tag
and I'm going to export current photo
feed
photo Ragman equal a gql yeah this is
all you start fragment you say Frank man
feeds photo I call that pitiful because
these the feeds screen and there's going
to be a photo so piece photo on photo
type photo and all right then I'm going
to do is I'm going to copy phrase what I
need here like that here
now I'm going to need to do at the top
of this file so the fit screen I'm going
to import from my fragment like that and
I'm going to import my feed photo
fragment
then I take this P photo fragment and
now I'm going to delete that ear and
outside of the query you're going to put
a dollar sign treat fragment and now if
sig da da da in now here you put their
name you put right there P photo like
that in your spread make sure you work
by refreshing your screen and you should
work yes perfect
well now we have the frame meant there
and why I want to do this when
everything was working before it's
because now inside the photo car go
inside the index address here while we
do the update we're gonna need this
fragment to find any change it
I'm going to import a fragment we just
create and I know I should have let's
place that somewhere else and we're
going to manage that in other if you
done make it better I think
but for now we're going to be good and
now here we have to put a frog now the
thing after that it's ear like photo I
don't want to just be called like for -
I want to be called like automata so
then I click enter ear and say like
photo mutation mutation and I'm going to
change like photo at this 3-play by
doing MND or control-d I think in window
like photo mutation now you came here
and you change this we like
accommodation and now we gonna change it
here
a second thing after that now we're
going to remove all the code we have
done that xep that we don't need that
anymore ear because we're going to
manage that in this props and now we
don't need any more than name but we're
going to open the bracket I'm gonna sip
props and this props are going to take
you're gonna do like ever having a
function hope that I return an object
like that okay so the props are gonna
receive to thing then I receive mutate
and we're going to receive on prop so
that's going to be the props of this
component as you know we're going to use
that to getting their own props that
data that ID okay you get the idea of
the photo after that right there we're
going to create a function called on
like photo mutation so this function now
become a prop getting passed to this
photo card so we can call that right
there by doing this and now this
function unlike photo mutation here
we're going to be a function oh now that
I called the mutated function we take an
update so this is the similar as what we
have before this won't take a variables
object why now we take the photo ID but
we're going to get that from their own
props that data that ID okay
after that we're going to add the update
on can I just show you right here using
update give you full control over the
cache and this is what I like I like to
have the control right there so now
we're gonna say update and this one add
the store and after that we're gonna add
the data and inside the data we can then
structure in and get the like photo so
this thing need to have the same name so
this thing to have the same name as your
what you're going to receive inside your
right there
so now at the store finish here so now
we're going to do an aviary function
here and put in credit bracket
I think I'm going to stay
it says once get too much
like photo like that no we're going to
do you like that like that variable
update and update we have this arrow ear
finishing and
what should be grilled with that
what I've done wrong
I'd like you to bracket here
we must want to break it power but this
one is this one 26 after that we have
gifts for air but this one
okay the we miss Wang recollect it
yeah okay
now I'm going to import from
my so as you see I'm going to impart
default data object from that default
data ID from object so you're gonna get
the ID from an objection to that cash so
you import that for the from the
in-memory cache and I'm going to show
you here you create an ID by calling
this function default data from the soul
data ID for objects we're gonna pass it
a type name of photo and now we're gonna
just pass it an ID of own props that
photo that data that ID okay now we're
gonna control lock this ID so we're
gonna go in step okay but what this ID
gonna give us well now if I open my
reality debugger and my project and I
click I get photo 1 do you see because
it's a type photo and the ID is 1 so 4 2
1 4 2 2 tone oh we can update that
inside the cache because this is what
you need to understand the way I follow
save it it you put the type first and
after that : a new ID so this word if
you have like a I don't know like him I
use all with the ID number 1 like we get
in progress if we keep the auto
increment it's that going to be kind of
art for a pollutant know which ones or
they put the type first
you
okay and now what we can do is we can
get this photo from the fragment inside
the cache so we can say proxy and a
persist or the read fragment and this
won't take two things for reading the
frame at you take the ID what we have
here when you take the fragment and we
pass it the B photo fragment that's it
now we're gonna take this
put it below this because I want to
control of this wall like that
you're pushing your screen diagram we
pick now now this is what I get I get
when I lie my photo putting in my full
photo inside a cache as you can see we
have a tag name photo the symbol ID get
Perdue - you are like - you're like oh
so now you see we can change that but
how can we do this so you see we have
this update function here and look here
what they do you can write Curie but
also you can update a fragment I like to
update more fragment here because it's
just the least little part I will update
my Curie or something like that when I'm
gonna add example an item inside that
example when we're gonna create a new
photo you're gonna add that to the curry
we have got but now because this is a
fragment it's this thing about that it's
just a simple object we want to just
update a simple boolean
that's why now we can do star right
Frank man Oh take the same ID the same
fragment
and now you take data so what do you
want to update now as you know the photo
is the full object so we're gonna just
say that the photo keep the photo like
you were before but now that you are
like going to be equal to this function
here but before I show you that I'm
going to show you what this thing give
us I'm gonna say like photo like that
okay this thing if you follow what I'm
trying to tell you this thing just
returned
finally the butea you see so now we can
use it or do a photo like like that
now if we remove all that and we're
refreshing the screen
block now looks what's going to happen I
can kick
and you see
I can like whichever whatever the one we
want and all that is being persist I
click you see
so now we have update the cache and it's
still safe now the thing is about that
I don't worry about this we're going to
manage to do another way we're gonna use
that unload or anything like that in one
of the letting that export because this
thing is really bad for the n1 problem
but at least you can see it's pretty
fast so but now the thing is we need to
wait again to get the like and now you
see some time we click too much fast and
now we're gonna get some kind of error
because sometimes you're gonna have like
I don't know how to call that but like -
two things one to happen in same time
but we have kind of thing about like a
course not that close but like a erase
yeah the name so if we gotta manage that
for sure
and we're gonna make use of the
optimistic or anything like that but
don't worry about that I think right now
we are pretty much done what we need in
this part here so what we gonna need to
do is the optimistic UI and I think
after that what we should do all suit
for finishing and this kind of a
capstone it's gonna be to like maybe
adding be able to add a photo so I think
I'm gonna maybe do this in the form of
milestone so the for maximum can be
about adding a photo because we know
yeah we have the photo we have in the
backend but a user can even add a photo
so that's why we're gonna need to
install one library we're gonna first
start by the user can only send the
photo inside is phone
first and also we're gonna make use of
pre sign URL from the s3 far from is
tree bucket in AWS so the user can
select a photo inside the phone and push
that and after that we're gonna do the
same but now I use our can take a photo
and take the photo we have just create
and pushing back also that to the s3
then you get a series on URL is pretty
simple to you so so this is that for
this milestone so I hope you enjoy for
the this optimistic you why we're gonna
do like maybe to getting more fast or
anything like that you're gonna all do
this at the end when we gonna want to
like see it's almost done for the
production like because right now thing
in MVP we can like so but the real-time
data like in tough stuff like that it's
something we you can do after we get at
least the product so you see so we're
gonna talk in the next milestone and I'm
gonna surely start this one to the our
tomorrow so either gonna go back</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>