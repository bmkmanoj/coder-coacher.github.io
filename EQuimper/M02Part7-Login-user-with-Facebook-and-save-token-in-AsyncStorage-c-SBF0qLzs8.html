<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>M02-Part7: Login user with Facebook and save token in AsyncStorage | Coder Coacher - Coaching Coders</title><meta content="M02-Part7: Login user with Facebook and save token in AsyncStorage - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/EQuimper/">EQuimper</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>M02-Part7: Login user with Facebook and save token in AsyncStorage</b></h2><h5 class="post__date">2018-01-28</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/c-SBF0qLzs8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everyone welcome to the part
number 7 for this second milestone so
what we're gonna do for this one is
gonna be about finally make sure then
the user can be long now with Facebook
and after that's showing the the main
application and nurtures this login page
when you get log so this is what we're
gonna do today so first thing we're
gonna do
it's we're gonna jump back in the code
also I'm gonna show you I've run a react
native debugger or you can do this in
chrome and just click command D and put
putting an emoji as debugging or I think
in Android it's coming em to make that
open and now what are we gonna do it's
here we're gonna log this result we get
here so inside the login page we're
gonna log the rest right there just to
see what we got oops sorry when i
refresh command R and now I'm going to
open my react native debugger I'm going
to click on continue with Facebook and
I'm going to click on continue
and now you see what I got so I got an
object here why I get three value one's
gonna be east can sell so it's really
good for you if you want to know if the
user get canceled and also we gonna get
the great permission so this is what the
user and give you access as a permission
okay so here we just get the public
profile here because we also want the
email we're gonna add the email so here
we're gonna add email right there so now
after that what we gonna do
it's we're going to do some kind of each
statement right there so we're gonna say
if friends that grant permission and
rest that is can sell is fault so we
want to make sure then we have been
permission plus the rest is cancer is
foul so the user donut can accept it and
what we do now it's after that we're
going to make we're going to call
another function coming from the react
native Facebook SDK and that's going to
be access token so this function access
token what we're gonna do is going to be
again a promises and we're gonna see
what we got so we're gonna set current
data equal our access token dark get
your access token so get our for the
access token that this curve like for
finally the user you have inside this
application okay so now I'm going to
remove this controller and now what I'm
gonna do is I'm gonna come so lock this
that I right there to see what we got
okay so now I'm gonna save refresh my
screen open my reg native debugger and
I'm going to click on continue with
Facebook now when I click on continue
what I'm getting now is the this is the
data we receive okay so now we receive
Facebook token the access token and also
we receive like other information and we
have u23 permission the email to blick
profile in the user 3m okay so now if I
open graphic QL and I'm going to click
on my login right there and I'm gonna
change my login with this access token
I'm gonna copy paste this logging right
there and now I'm gonna kick plate now I
get my login
token so this is what we want so now you
see that create for me my user so this
is the plan we need to get this access
token for doing the mutation but how can
we do the mutation so now what we're
gonna do is we're gonna jump at the top
of this file and we're going to import
to library first going to be gql from
react ql tag to create the SQL query
mutation and also we're going to need
the graph QL wrapper to react Apollo we
have ql e to see right there so first
thing we're gonna do its ear we're going
to create a mutation we're gonna create
logging with asia
equal jakku yeah the QL for putting the
crew back there back tip don't forget
back tips begin as a mutation here and
now right now we're gonna say dollar
sign provider so probably is going to be
a variable so and this is a style of
provider so this is the same style as
what we have right there so provider and
toolkit okay we're gonna say to can with
the dollar sign because we create a
variable to Ken to Kenda to Len gonna be
a string okay and now after that here
what we do we're gonna set logging we
pass the provider going to be equal to
this variable we just created a tub and
the same for the toolkit okay dollar
sign token okay
and now here what we're gonna ask back
is the token so almost what we do here
after that we're gonna wrap this login
screen with a graphic UL tag and we're
going to put the logging mutation inside
that
and also you can put some name you're
gonna see why I want to put any I'm
going to call that logging edition and
now just for showing you I'm going to
controller
inside my render the props okay I'm
gonna call crops I'm gonna sit this that
props there's gonna be easier for you to
see it when I'll just make it a bit
bigger okay and I'm gonna refresh my
screen and all you're gonna see my props
so my props what I receive we don't need
that what I receive is the logging
mutation function so now I can call this
function right there so here I can see
if we ask data now right there what I
can do is I can call my function right
there this that props that loading
mutation but the thing it's I want to do
to put also variable here and this thing
it's gonna be any synchronous call and I
can receive the response right there
into my component so here what I'm gonna
do is I'm gonna call that
server response equal avoid this prop
limitation and now this thing can take
an MJ while you can put fireball in this
variable is going to be the variable you
have right there so provider and Tokyo
so yeah well I'm gonna send as a
provider it's going to be pretty easy
it's gonna be Facebook in uppercase and
for the token we're gonna sit data that
access to can we get out to complete
Facebook ad on their job they have all
type this library okay so now we have
the server response here now okay so now
we can controller the server response
here if you want to see it make sure you
are inside the scope of the if okay and
now so this is what we're gonna do so
I'm going to refresh my screen I'm going
to open my debugger I'm going to click
continue with Facebook and now if I
click on continue
I'm gonna get inside the data we survey
response this is now this data object
data logging okay so now this is the
tool can we add this is the GWT - can we
just clean in the server so now what we
can do is we can save this tool can so
we're gonna get this token by doing
because server responds that the login
here I can receive my token from this
destructuring that and now I want to
save that in my using storage so using
storage came from the library react
native and now these two can I can do
our words because they sing so it is a
promises set to can proceed it's a
promise as you can see that right there
okay it's a tool can and now here I need
to put the string we want to save it in
the to camp it's a key value now if you
remember inside a patent is initialize
I've put a Instagram come to here but I
don't want to retype that so what I'm
gonna do is I'm gonna sorry I'm gonna go
to app initially and when I got copy
paste this one here and I'm gonna now
save that inside my constant and I'm
gonna create a constant now called ode
to K it's gonna be equal to that so it's
gonna be easier for me to work with that
because now the Oh token I know if I
change it I just need to change that in
one place and they're gonna change it
work so now I'm gonna go back in my app
initialize and I'm gonna import that
from my youth cell consent puller
so that's gonna be out to K and now I'm
going to just change this get item right
there to change with oops to change with
this out to can for your boat a long
time I indexed I'm gonna need to import
it from my constant cooler so this is
out to camp and now what I'm gonna do
it's ear when I save it I'm gonna change
this string to be called token so now
they're gonna be safe at the same simply
okay
so now I'm gonna run that so now I'm
gonna save this stuff right there and
I'm gonna see my copia okay
so now look what's gonna happen I'm
gonna continue with Facebook when I
continue now that's if the token
but you see we don't pull the user to
the main screen but now look what's
gonna happen I'm going to refresh again
it now look so what happened we now are
in the main screen so if you follow what
I happened right now it we have saved
the token but we don't do any logic to
push it back to the main screen but at
least we know now then this app
initialize work so that what happened
it's if we have a token we start with
the main map so we should call this
function in the other one what are we
gonna do for now to at least make sure
that's gonna work it's I'm going to copy
paste that and I'm gonna do for now we
move to again just to delete the token
so make sure the user gonna be deluged
so now I can just you we put it and now
we don't have any more disk okay so now
we can redo the allergic what we gonna
do now it's finally here
we're gonna import from the nav here
we're going to import the start main app
so now what we do finally it's right
there when it's done we're going to call
the store main app and also we can put
that just to make sure we can put this
code inside that's right catch so we
sure then that's going to add in after
this one is being done and for now I'm
gonna just throw the error if we have an
error okay when saving
okay so now we are here and yeah you can
also put another like you can also put
another try-catch for this one right
there and do whatever you want but at
least for now it's good if you look in
the server also what happened if you
remember we do the stuff so yeah they
ask we do use our and now we don't need
to create any more so now time to test
it so I'm going to click on continue
with Facebook
and now I'm going to continue
and now you see and now we get to the
domain application what you see nothing
more to do what we can do it just again
change it back this one to do remove
item because what I want is you see we
get some kind of loading spinner and
stuff like that so what we can do
it's going back to the login page came
here importing from the react native
library the activity in theater right
there and what we can do it's creating a
state writer colluding to be taught in
here when the user click on looking
press we say there's at set state
loading know to be true and when all
that it's done
so after we see the toucan here we're
gonna say building now it's folks okay
and what I'm gonna do it's here if this
that stay that loading so if we get a
loading we're gonna return here a view
and if we look the style rule you see
that go right in the middle so we can
take this route
clicking that in air just here we can
put the activity indicator we're going
to put a size of maybe large and if you
want to put some color you can put the
same color of the Budhia right there
inside that now we're going to remove
the console.log here and that's it so
now I'm gonna be refreshed now I'm going
to click continue with Facebook and now
you see if I click continue now loading
and now we get to the Instagram main
page
so I hope you have enjoyed this one so
in the next one is going to be now the
mics on number three so I hope you have
enjoyed this my song number two with
this education part and yes one second I
think I forget one thing it's gonna be
inside a graph QL thing right now yes
it's pretty easy that we get there
logging but now all we can make sure
than this graph QL stuff gonna work with
the backend because right now if you
look in the item look what happen the
contact is always empty chains I didn't
forget it
so here what we're gonna need it's
really neat winds on a new library call
a polluting context so add this thing
and now what we're gonna do
it's we're gonna need now to create a
new HTTP link but for the attached
fication so what we need here in the
HTTP link appalling HTTP we're going to
use the create HTTP link this one what
we do it's we gonna say right there
current HTTP link equal create in CTP
link what we take a you worry and now
this you re going to be equal to the
value we have done right there okay like
that after that we can delete this link
here we don't need that anymore
and now we are we're going to create
another one called all link and this one
gonna take the context from the library
we just finally create install so Apollo
link settling context we need the set
context so if this is for setting a
context like a user entire link for set
context here is going to be any
synchronous code we're here finally I'm
going to juice I don't need the first
argument but I'm gonna need the others
we have right there those with the S
don't forget this one and now here what
I'm gonna do it's inside that here I'm
going to put another function with curly
bracket so finally it's going to be the
callback right there
and now here what we're going to do I'm
going to need to have my token here
because I want to return
I want to return here the others who now
is going to be equal to everything the
other is ad already but now we can also
have the authorization headers or this
one now it's going to be equal to the
token okay
and now finally it will change the link
to be now equal to the out link that
concat we're going to come cut that with
the HTTP link but how can we get the
token first thing it's we're gonna need
to import the easing storage library
after that we're going to need to import
the variable name we have create inside
the constant pipe
remember all token right there after
that are we going to start that it's
we're going to create here a token was
going to be empty by default
okay and now here we're gonna create a
new function called get token which
going to be an asynchronous crown would
this one penny what are going to do it
if the two can it's not new so if this
variable so this global variable it's
not new
we're going to return this variable okay
else we're gonna say token is going to
be equal to the avoid acing storage call
get item with the out to camp and
finally we return the token so if you
follow what I do it's finally let we can
aliens going to be empty and the first
time we get to do it to this application
so when the user research the
application opinion after that here what
we're going to do is we're going to call
the function await get token right there
this function we're going to do
what I've done one sick
once I don't see why I've done my
mistake right there
coal's context is saying okay I don't
need a comb oh okay sorry okay and now
follow that token is empty by default we
create out link yet your color function
get to okay get to can see okay the
token have nothing so we're gonna get a
token from the all they're using storage
and now we save it inside this variable
so now this variable gonna have the
value of the token all the life of the
application if every time we're gonna
call is the old link so if on every
request with Apollo we're going to set
again they get token but now they get
token gonna came here and gonna say a
the token now it's not new so we turn it
so finally just a way for you to don't
make you add on every Apollo cow to
fetch the easting storage so the a sink
storage don't get a get cow every time
just just the first time finally so it's
better for the application at the end so
here the terrorization we're gonna just
see token so if just like here little
tip here to can we're gonna sit there
are because we have asked for that in a
we say to can else we just say no that's
nothing more to do okay so now look here
I have no context at out I'm gonna just
clear this page and now I'm gonna
refresh my screen you know as you can
see now we have the context because now
we get the user right now for this is
really what we want so now if you want
to take to test it you can open the
application the server right there you
can open a server and just if you want
to make sure we're going to uncomment
this otherwise so now if i refresh my
screen you see this authorize make sure
you work so just to show you if i get
the photo right there and i don't put
any GWT and I do enter like that I get
unit arrived you see so now the orthotic
ation part is working so all that happen
with this magic we'll just create inside
this dysfunction whether they get to
here so I hope you enjoy now this is the
real end so now this is done for the
summarized on this the turn milestone
be ready to do some like function and
also the bookmark function we're going
to add and maybe the sharing function so
I hope you enjoy
we're gonna talk in the next milestone
are they gonna derail like</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>