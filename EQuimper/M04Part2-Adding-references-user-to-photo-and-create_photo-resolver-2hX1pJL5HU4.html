<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>M04-Part2: Adding references user to photo and create_photo resolver | Coder Coacher - Coaching Coders</title><meta content="M04-Part2: Adding references user to photo and create_photo resolver - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/EQuimper/">EQuimper</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>M04-Part2: Adding references user to photo and create_photo resolver</b></h2><h5 class="post__date">2018-02-10</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/2hX1pJL5HU4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome everyone to the poor number two
of this my sole number four so what
we're gonna do in this one is gonna be
about adding the reference of the user
inside a photo so each photo gonna have
is author so it's gonna be a way for us
to have a user as many photo and a photo
is belong to a user after that we're
gonna make sure we can create a photo
with the URL we we get in the last one
inside the prison URL and that's it for
this one so because right now the way we
enter that it with postman we send the
photo and this is not what we want the
user to do for us so now what we're
gonna do is we're gonna jump in the
terminal first thing make sure you do
source that env2 get audio in via
variable now we need to do this and now
we're gonna run mix ecto that gen that
migration and we're gonna say add user
reference to photo okay when I click on
tar so now this code here you're gonna
see this generator just run to thing it
just finally go inside the migration for
one thing finally go inside the
migration folder and create this file so
if we go inside private we pull
migration we get this I think I need to
refresh you and now we get this one so
this is this add user reference so if we
do a migration so now all we going to
end all that it's we're going to say
alter table and now here you put the
name of your table inside that the name
of the table is going to be this one
here photo so we're gonna put ear inside
the quotes photo in here what we're
gonna do is we're gonna say add use our
ID reference and now we're gonna say we
friends the user so you want to make
sure that your reference this table use
our and we're gonna say on delete we
want to delete all and also we're gonna
sing news to be false so it's gonna be
impossible to seven an image if you
don't have the user ID in this delete
all mean its if this user delete himself
you're gonna delete every photo EF
this is what we're gonna do so just make
sure we type it good me yeah perfect so
now what are we gonna do it's now we're
gonna go inside the database and not
inside at the base but inside the
terminal and we're gonna run mix egg to
that migrate and now we're gonna get
some air now because as you can see now
you : usually contain new value so what
happened is because you already know
that I'm sure it's my database right now
it's always this start and we have
already inside Instagram we have already
some photo but the photo don't have this
user ID so now we're gonna need to to
add this thing but how can we do this
it's just by finally drop the database
so now you're gonna drop the database
and now finally we don't have it anymore
but now if we run mix act to the create
and now you can see mix egg to that my
gray I'm gonna run all the migration and
now what's gonna happen I've closed
particle because if not it get get
finally connect and you cannot drop so
but now you're gonna see inside a photo
ID image URL captioned insert update and
now we have the user ID right there and
if we look in the structure the user ID
it's a user that I did not know the
thing we just create and they get that
from the table user so like that but the
one of user perfect but now that I've is
it's empty so we're gonna need to manage
that so we're gonna need to create some
seed a user and add this thing later
because right now when we see you can
see we just add a photo so but now what
we can do it's we're gonna just go
inside the Liam Instagram we're gonna go
inside icon in user so now what we can
do it's a USR I'm gonna put that right
there as many photo
and we get that from the Instagram the
post dot and now here photo are what you
can do if you don't want to do this way
you can use the print s season module I
think it's like that module like that
yeah no no no sorry it's because it's
the post so we cannot sorry about that
so Instagram post yeah when are we doing
on our journey going to go keep inside
the module but it's not for us so don't
do this sorry it's a bad thing idea
so now yeah user can have many photo so
now go inside your photo so now a photo
gonna go belongs to a user so belongs to
a user from the Instagram the icon the
user okay so a photo can as many like
and it's belong to a user and I use dark
and as many like and as many photo too
but now what we need also to do it's not
when we create an image the photo we're
gonna add a user ID coming here and
we're gonna say it's required like that
so now when we create a photo we can add
the user ID so now you cannot create
that anymore okay without the user ID
okay so now what we're gonna do it's now
we're gonna go inside the seed right
there and now we're gonna create finally
a user so what we're gonna do
it's we have we can import your icons we
can add yes down and now what I'm gonna
do it here I'm gonna say mark user and
I'm gonna call that five okay so we're
gonna have five fake user first thing I
want to create this user first I'm gonna
say user and there it's my photo
now here what we're gonna do is we can
just do a for loop we're gonna say 1 2
the mark user we're gonna create a
wrench from that and now what we're
gonna do
it's as you know when we create a user
we have at the avatar key and for giving
this avatar to make sure the app gonna
looks more like more like a real
application we're gonna make use of the
random user oops
random user me okay
API so this one give you some fake photo
and a fake information but for the
freaking formation I'm gonna make use of
the faker but for the photo what I'm
gonna do is I'm gonna do example if I do
API for trip slash an example I'm gonna
say one example yeah not one but men in
our example I can say one that gee peg
I'm gonna get like its face of him okay
so this is the plan it's now we want to
just add this kind of Photoshop photo so
we can use the index but now what we're
gonna do is we're gonna do if statement
okay here it's 10 men with the odds what
I mean by that it's when the number is
going to be example 1 how odd
I wanted to be a man when it's an even
is gonna be a woman so how can we do
this its ear first thing at the top
we're gonna import a function coming
from sorry
you know import a function coming from
integer and the only function we're
gonna import it's gonna be is odd yeah
but I don't need like that okay so now
inside my if statement what I can do is
I'm gonna say if is odd so determine if
eating your if anything girl is odd and
now I'm gonna pass my ID X inside an and
I'm gonna say do man so return
men so that sex gonna be Mel else it's
gonna be a woman death so now here I'm
gonna send that at all
I'm gonna be equal to finally this URL
right there
inside double quote and I'm gonna do API
portrait slash now I'm gonna see sex so
the sex value but we have career and I'm
gonna sit here and the index that GPA
okay now here what I'm gonna do is I'm
gonna create my user I'm gonna see email
email it's gonna be equal to
faker that internet the email I'm gonna
say also what we had that he did require
we need to have an avatar ok a Facebook
ID for now with a Facebook ID we're
gonna just fake one a first name and
last name and yeah so what we can do
okay yeah Facebook ID and also another
yeah so I'm gonna say that our first
thing equal at that hour the one we have
create username
I know figure I have some username and
as you can see we have it here so we can
add this stuff and did I username yep
like it figured that internet that
username okay I'm gonna say first name
equal to fake our dot figured that I
think it's person if I remember if not
you know what I think I'm gonna know
yeah fake r dot figured man so many
stuff so you know what are we gonna do
it's when I go inside ear they use the
use our and when we guess it we don't
require this stuff here the first name
and last name okay
and if we go inside the data the inside
the migration it's okay we don't say new
leads fall so we don't need to do
nothing more so we're gonna take the
first name last name if we provide but
if not you're gonna put Neil okay so
fake our dot so yeah we don't need that
and for Facebook ID we can just say fake
our that random hey sorry
fake yard you till you till no so you
know what we're gonna just use the ID x1
now okay nothing more and finally we're
gonna say we pull that insert okay we
when you work with the seed they always
ask you to use the bank symbol so use it
here and now the only thing we can
interchange now it's when we create a
photo we can add this user ID so we're
gonna say use our ID and now we can do
this now we have we know we're gonna
have one to five users are okay so now
what we can do is do a non dot random
one to the mock user that's it
so this thing gonna take a random number
between that so maybe I'm gonna have
like usual number one gonna have three
photo anything like that so it's all
random and now time to see if that gonna
work we're gonna say mix act oh that
yeah formula the way I like to do this
it's resale so and now you see what
happened is my particle was opening
and now we get value one in certain on
match type string okay so now it's
because of this thing so we're gonna
pass that inside a string so you need to
do like that okay so now if we look back
inside the database now we're gonna add
inside the Instagram dev now some user
know the user add an avatar username at
that our Facebook ID you see the
Facebook ID don't make any sense but at
least first name last name we have some
email and now if we look some of the
image if I copy paste this one inside my
Google Chrome what I'm gonna get is this
woman right there okay so I have some
woman and I have some man like ever
okay so now so now we have the CICC done
so it's gonna be more more easy for us a
little work and showing like the abbot
of the user actually but now what we
need to do is we're gonna go inside the
resolve are of the post so inside your
Instagram web resolve our post
now we're gonna create that the new
resolve our create photo and ear as you
know we don't need to manage nothing
inside the Instagram like not this one
but Instagram post module because the
create photo is already done and at the
change but a quick photo is already done
by the generator so now we're inside a
quick photo we're gonna have no around
we're gonna get some more human and
we're gonna get context what we're gonna
have inside that the cure use our map
cure use our anchor we're an user like
that okay you know now inside this one
what are we gonna do is we're gonna
build an argument we had finally the map
that merge so we're gonna merge two map
together okay we're gonna merge the
argument so the thing we're gonna
receive from the schema and here we're
gonna map it with the user ID and we're
gonna secure user that ID like that so
now finally that's gonna just become
like something like that
image URL blah blah blah and use our ID
example one like this you see what I
mean like he's gonna merge together in
one map and now here what we're gonna do
is we're gonna make use of the width
with the okay photo tupa why I'm gonna
set your post Instagram post so you see
we can add yes I think it's gonna be
start to become much better area to do a
DES and I'm gonna call that Instagram
the post so now we can remove all the
Instagram we get here okay so now Erin
can see post and now I can say create
photo
so this create photo photo like that and
now why didn't get it I think created
photo is right there yeah so post that
create photo and now this one you could
just take the argument that's it and
we're gonna return the okay and the
photo we just have create so now if you
see the create photo that we were you
receive some attribute and just dude
inside the change set and if you look at
the change set you're gonna take the
image URL the caption and the user ID
and that's it so now what we left for us
to do it's going inside us chemo so
inside the schema here we have either
photo where we have the ID image your
real caption blah blah so now we need to
add that to a mutation so we're gonna
say right there a new description what
I'm going to say create a photo fill and
I'm gonna call this one create photo
while we're going to return a photo
finally okay and now this one which
argument we can add first thing is gonna
be an image URL who's gonna be finally
the image URL we have ear here image URL
it's gonna be no
for now we're gonna just say string
we're gonna have me be caption string
also and now nothing more to add but
what are we gonna add is the fact that
you need to be authorized for that and
we're gonna call the resolve are both
the create photo / tweet ok so now first
thing I'm gonna run my server okay here
sorry when I run my server
okay nothing crash it's good
and now what I'm gonna do is I'm gonna
just first thing get all photo and I get
an error and I got okay yeah so no it's
because my use are it's not it's not
creates I'm gonna just create get a new
token because now you need to remember
that now you use are don't exist anymore
so now if I go here and I'm gonna change
my token I get long I change my token so
now I can get all the photo back okay I
can get that get some you made URL also
perfect none more we gonna get the user
later but for now just like this so now
we want to make sure then this user now
can create a photo okay so what are we
gonna do is we're gonna do a first thing
we're gonna get the present you around
I've again my GWT tool can save so I can
rerun it here I'm gonna get a prison URL
but for that I'm gonna just set up my
mutation first so create photo right
here I need the caption so I'm gonna say
maybe like lol or if you don't need a
caption you can just not put I'm gonna
say image URL and now this image URL
what I'm gonna do is I'm gonna go to
post man I'm gonna run this one again
I'm gonna send the same image I've put
in the last one yes what item I'm gonna
take the bigger one was better I think
so I'm gonna be run again
take this one okay it's safe so now I
know in this one I get my image right
there so now what I can do it's inside
my create photo here I'm gonna face my
image URL you know what I can return is
the ID the image URL the caption maybe
if you want actually I know if I send I
know you see I get my s3 bucket right
there nice two bucket maestria URL the
ID number 11 of my photo because I have
10 orders were to create before and add
the caption in a well so now if I go
inside my Instagram Devin my photo I get
this last one right there saving you
know you see the user ID is the ID of
the user I've just create right there
I'm gonna just put a user name for now
just to match other people okay now you
see I get my real ID so first name last
name blah blah blah I have my stuff and
I have my facebook avatar and inside my
photo and match this so you see some
some like ear this photo of the ID
number 4 and this is my ID number 4 I've
1 2 3 &amp;amp; 4 photo because of the random
stuff I've just show you but now you see
we can create a photo actually and this
is what we need so now we need to be
able to create a photo and now I think
that's gonna be the time to jump on the
mobile side to make it so I hope you
enjoyed this little episode and we're
gonna talk in the next one bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>