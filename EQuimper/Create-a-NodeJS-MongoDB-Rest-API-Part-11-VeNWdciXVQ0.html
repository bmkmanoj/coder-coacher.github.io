<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Create a NodeJS + MongoDB Rest API [Part: 11] | Coder Coacher - Coaching Coders</title><meta content="Create a NodeJS + MongoDB Rest API [Part: 11] - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/EQuimper/">EQuimper</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Create a NodeJS + MongoDB Rest API [Part: 11]</b></h2><h5 class="post__date">2017-06-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/VeNWdciXVQ0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I know if you want 4:11 time to do some
cool stuff now so what we're going to do
on this part is going to be make the
user temporary opposed and we're going
to add another function for increment
the server it comes so when I mean
increment of America I mean inside the
post model right now we have the
favorite son here and this is still at 0
so this is what we're going to change so
the first thing we need to do is going
to be pretty simple so all we're going
to set that it we need first thing to
add a way to know where is the post
which pose is covered by their user and
we can after that add this another
method what we going to add a way to
make the user favorite
opposed
so here what we're going to do we're
going to jump inside the user that model
the GS in air after password so be sure
you are inside of a good curly bracket
so as you can see I use the rainbow
bracket so that makes me know where I am
so I'm going to cover it so far is going
to be an object Y because maybe I'm
going to want to cover something else so
how we're it gonna pose so here as you
can see I can tell it may be like I
don't know like you want to cover it
like a - do you see what I mean like you
can have multiple stuff you can cover it
so this is what I try to told you yeah
that's going to be an array of objects
in you we're going to fit type of Chima
type object ID and we're going to put a
ref of post so in what we did is a way
to make the populate working so we have
already used this to work when inside of
both model we say the author
it's a rest the user
and era as you can see that was just an
object with the user the thing I want
you to see from right now is to know
what is the poll
what is the name here so I suppose with
uppercase so here this is my rear and in
as you can see there's going to be an
area of objects of an ad that's going to
be an area of objectid
and when we gallop a play we're gonna
have an area of fold don't you see what
I mean so here we have the favorite now
we need to make a way to add a post the
favorite so inside the metal I'm going
to go there I'm going to create a new
method and I'm going to put underscore
favorites
I'm going to show you in a moment why I
put underscore ear so a I'm going to add
multiple favorite function because I'm
gonna have Mimi in the Diplo palette sir
so inside my favorite I'm going to say a
post and I'm going to pass a post ID as
an argument
you
we're going to do a if statement so
finally Mongoose is really smart for do
a lot of stuff but something we cannot
do it's sending something and change the
boolean like yeah I mean here we can
have an array of both and what if we
want to be sure if if the post is not
there we add it if it's there we remove
it so it's a way to make like a cowgirl
like it if a favorite of Oren favorite
so here all we can do this is by doing
an if statement and there's going to be
pretty simple we're going to fit there
that's have a rib so when I sit is that
server read this is here
that post so that was the post into the
fire area and I'm going to use the
method index of who is working inside an
array so index up is if it's an area
method and because post is an array
that's where I can use the index up then
they give me the index of my post ID
because remember we can have an array of
ID in here so if as it so if this post
ID is inside my array I'm going to add
an index we're going to be equal or more
than zero so that's why here I'm going
to say that so if the post is definitely
so they index it the be zero one two
three now what I'm going to do here is
I'm going to sleep this that server
ripped the post so again I want to total
my post here and I'm going to say the
remove so this is a method inside
Mongoose and I can do this so I'm going
to remove this post ID inside my Eric
after that I'm going to make a nail
statement if
and I'm going to say that like the
opposite of that and that's going to be
deal that's all read that pose and I'm
going to take that push and I'm going to
put your ID
that was pretty simple no yeah but we
could have a lot more stuff to do here
here that's okay we have we add the
stuff but we don't forget - don't forget
inside the depot's metal here to return
the saving method for this that stage so
we want to save the user with that
because if you do this at your award but
that's all don't gonna stay inside the
database in the body def save is there
because we want to say to the DB now we
want to to change it in the document
because if you do this right now that's
going to work on the document right
there but the stage going to be don't
going to stay after like every stress or
something like that so now we add that
so now time to jump on the post
controller because yes we we finally
it's not the user the favorite method is
inside apart the the pose and you're
going to see why in a moment there's
going to be much more simple to make it
with that so inside the post now we're
going to need to do something it's to
import the user model at the top because
we're going to use the user method and
we need to find a user so a I'm going to
assign my users are coming from user
model and I'm going to go to the bottom
here and now I'm going to create my
favorite post so it is going to be I'm
going to export an async function again
call server rip / rip post we're going
to take a read and everywhere so request
and response we can add again the famous
try catch and we're going to return 964
here in 972 perfect first thing we need
to do is find a user in the database so
the first thing we need to make a it's
considered an equal to a chrome assist
called eager that's fine by ID and
because we're going to use the attach
occasion with a GWT we can have access
to is ID and we have access to this by
doing what we do on the other stuff by
the way read that user that underscore
ID so here read the user the underscore
ID so now here
I'm going to have my user user it me
after that I'm gonna say avoid now my
user of the method on the score
favorites so the method will just create
here underscore favorite but this metal
is just an object so I need to target my
post the closed don't forget this and
now I am going to pass the parents that
ID is the post so here maybe you
understand now why I put on Castro
because if I don't put the underscore
what happened if I told you that do you
see
I don't put on the skull what I'm going
to fit that February is that dongs going
to be the method that's going to be what
I have inside my schema
so that's why I put it there so here I'm
going to set user favorite the Touareg
that parent that ID I send the parent ID
right here so this is there and after
that I do my if statement it is there I
remove it so I'm favorite if not I push
it
Parr was there and finally here I'm
going to return in ear the only thing
you need is to return a rare that sin
spiders and I'm going to set that HTTP
set is that okay this is that - yes sir
be some of you asked why don't L like
this is like or unlike on whatever you
want I mean that's going to be pretty
simple I mean like there I think about
making the front end with that on other
tutorial and what I'm going to show you
is the way to just like the front end
just need to manage the state or is
right now and you make some kind of like
the front end exposed to stay okay now
it's all so now if I great now it's true
if I get an error I'm going to remake it
fall but if I get no error I keep it
true so now here again okay now I
receive a two hundred or now it's two so
I just keep it as true so you see what I
mean like the difference supposed to
keep the state in the in the front so
you're going to know what Adam so go
inside the post route and now what I'm
going to say is I'm gonna say here
that's going to be all my favorite route
and I'm going to say route route sorry
that poster yeah so because we
both yep and now I'm going to say ID so
that's why we get on this Friday but I
need to make it with the Tyra read
because it's going to be much more
simple to keep my red thing make it
easier for me after that to work but now
I know here is the favorite letter
after I'm going to put my all GWT so I
get attached acacia and I need to add my
post controller and I'm going to use my
favorite that post
time to test it I'm going to draw on
postman and I'm going to admirable Mongo
so what you need to do first it's inside
postman
my postman first thing get all your post
I get all my for surface after that you
need to login to look after that take
you JWT and now go inside post hyper rip
create the post so I take finally the
first ID of my photos this one
I go inside my doors and I'm going to
paste this GWT
and now I'm gonna send it I guess okay
so do like Oh can I know if that works
you go inside Abu Mongo you open user oh
look at that
now I can fill out this one and this one
has nine field that must be the first
one the first user who I make the change
so though yes so that what you don't do
perfect now inside my very I have one
field and inside my post you see it's an
array of element and now if I open it
add an arrow and move the first animal
at the first index is the object ID
loosen it by one eight four and this is
this one one eight four so now right now
my user has favorite the folks so miles
or we know yes every dispose we have
only the object IDs whitey doll Jagadish
because we have a maximum in in storage
with a document in MongoDB and if you
don't want to like fill the shoes or
like with all the coats that you can
that's going to decrease in put all
animals if you see the object ID just
like a string so this is just less big
and that makes you to add more code so
maybe like if the user had 100 favorite
post then it will take less play with ID
air then adding 100 full objects of post
for you see what I mean
but now look what can happen I'm going
to sin again
now I get okay when I it down if i
refresh
program an arrow or control air now open
that attack you pass one field but
because it's depth but now look my post
now add no element i just unsavoury it
so I remove the ID from my array so now
add unfavorite my user and you're gonna
see for you that must be like - so this
is the version of you user and because
we change it because of this you're
going to see like this thing then I
change a lot
perfect but now I mean I told you I need
to change the Sava return like inside
post mother I'll have a return here do
this thing has changed so I'm going to
go inside my post I'm going to refresh
and 104 is this one but look no I
returned at no change at all so how can
I do this you have a lot of way to make
it but I'm going to show you and a way I
think that it makes sense with what we
have already done and I hope you're
going to enjoy what we got are you going
to learn there there's going to be
pretty simple and pretty good stuff I
think so we're going to jump on the post
model and we're going to add static
method so as you remember the static
method is on the who steamer and not on
the document so a method it's when like
you have initiate like it's almost like
when with your work with class when you
have a static method or aesthetic the
turning class you can toggle this metal
without initialize the class but method
you need so that's why like you need to
find the user and do stuff so think
about like the find a ID it's almost
like a static meta so here I'm doing
this because I don't want to find the
boat the only thing I'm going to do is
I'm going to in so for increment travel
rip
 and this thing the only thing that
I need to average the post ID again this
one we're going to return don't forget
to return here don't forget to return
there because if you don't return that
going to break with the avoid metal
we're going to use after that this that
sign back ID and update rule it's a
static method on the schema so we're
going to sign right in when you're going
update again it's going to be pretty
simple the first thing you need here
it's a so it's a manga meta update
comment by document ID field so the
first thing you need to pass is the ID
first thing so we're going to pass post
ID and after that we need to say what
we're going to increment and I'm going
to sit inside MongoDB you have a method
called Inc and so in change the old
number by the number you want I'm going
to sleep right there here I'm going to
subtract a real one for the name of my
method I've written here by default is 0
0 and I'm going to say 1
so this method in travel red card going
to add to the pose I find here and I put
in I'm going to increment the favor
returned from one so it does that one
going to be to it to the Demetri so you
follow me here I'm going to do select
everything here
I'm going to shift command D I'm going
to put a common error on don't forget
but now I'm going to change the name
here because now we want to be criminal
because when if ever read I want to add
one to the third red code but when on
top of it I need to remove it because I
mean if I favorites if I perish 100 time
a post and I at the end I unfavorite it
so I don't keep it I'm gonna have a to
return of 100 and that didn't make no
sirs I mean if no not 100 users like it
but now if all can I did that by I'm
going to use there you can use like Dec
and everything but I'm going to just
change that I'm going to say minus one
so we're going to just increment by
minus one
so here now we're going to need to jump
on the user model and we're going to
change little stuff of what we did today
so we're going to go at the bottom
and now here this is the place I think
it's a good place to make it because if
we remove it so why don't make the
method for like it decks have a red con
and so what I mean here what are we
going to do I'm going to pick import
posts from
pose that post model I'm going to take
my post object and a what I'm going to
say so we are access to the post ID
so I'm going to say both that deck
so I'm going to just use so be sure I'm
going to go to put my dad I'm going to
copy and paste this one and I'm going to
see how it's done and the only thing I
need to do here oh it's that mypos ID
but the thing is this thing is that I
supremacist because if you seen the post
controller and post module that was fine
by ID in a day so this is a pharmacist
so a what I'm going to do is I'm going
to say acing on my posting and now I can
use a wait
be the same for one now it's time to add
the Farrakhan I'm going to sink like
that
nothing more to do now if you jump on
postman
now have no favorite just for showing
you I'm going to go to my user in a
refresh 10 shell but our year
development now I'm going to send
I get okay perfect I'm going to jump on
the rubble Mongo I'm going to refresh my
youse are
one element perfect so this is my folks
now if I go there and now i refresh and
I check my pose 104 fabric on one
so we just finally add one to the animal
movers zero before and now if I click
again
I'm going to jump on Robo Mongo again my
user I'm going to refresh
favorite zero and now we're going to
refresh them in error again the last one
and now zero you see and now maybe like
some of your going to ask okay yeah but
there maybe you can get to minus 1 but
here if I put put again that's going to
increment by one
yes I mean this is maybe not the best
prediction code but this is working for
now and I think this is good for this
tutorial and at least that let you know
what is the favor in detergent and a
network anesthetic there you see the map
decided I don't need to find the default
because it's on the post kima so this is
what I told you when I see static but
when I tell you about Bala method you
need to have the user in self
so I'm going to put the code on the get
up again and I hope you enjoyed this
part so if you liked click the like
button please subscribe if you didn't
and we're going to drum on the part 12
where we're gonna have I get again more
fun so I hope you enjoy and have a good
day bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>