<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Tutorial User Authentication System with NodeJS - EP02 | Coder Coacher - Coaching Coders</title><meta content="Tutorial User Authentication System with NodeJS - EP02 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/EQuimper/">EQuimper</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Tutorial User Authentication System with NodeJS - EP02</b></h2><h5 class="post__date">2017-09-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/OaiuN6VtR6s" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">arrow if you want it is on number two
before I go too much further in this
corner just want to give you like other
rapport finally work here it's the repo
I put the description in the link in the
description it's you can follow each
episode by by following like the branch
so a pieces at zero zero one and the
master gonna always be the latest
version in the slash demo it's for me I
mean I need to sometimes check my code
to make sure so it just I just want to
make sure that you understand everything
all that work so oh this thing gonna
make sense and now time to jump on the
code so back where we are before we are
able to create a user I can we send a
user and I'm gonna create a user now
really bad thing it's if I want to try
to do it at finisher I need to make sure
than add a unique email because I'm
gonna do the identification with email
and a password so it's time to do some
validation and the model of the user so
this is what we're gonna do for this
episode and also we're gonna do the
ashing function for ashing the password
and don't let this pass one two three in
the database so go inside your model and
we're gonna add some value to this email
first thing we're gonna say that's going
to be a type of string because now we
need to do this in a type because it's
an object now we're gonna say unique is
two we want it to be unique we also want
to trim everything so if the user has
some space at the end we're gonna remove
it we're gonna see it require two cannot
be saved without our email and now here
we're gonna say validate so validate
it's an object we're gonna take a very
data function this validator you're
gonna take the emails and you're gonna
do some validation about the email now
this thing gonna just be too much crazy
it's gonna be it's gonna be I rejects
for the email I know you can use some
library but a
we all develop our time to code a bit so
we're gonna do it reject so we can I
start by the way a slash with a this
arrow symbol and we're gonna sit here a
Z oh and I know finally what I think I'm
gonna do it I'm gonna just copy what I
have gonna be easier for you so here
this rejects finally just gonna make
sure then the user gonna have value I've
found any valid email so as you see err
we're gonna make sure you first we're
gonna have this symbol and also we're
gonna make sure then we have thing
before the symbol and think after the
symbol and a dot with some other value
that kamek shall arrive so just for
rejects for the email if you don't like
this will go with your validator and
everything again this tutorial just for
the flow of I user data fusion the code
it's for you if you want to you can use
the same tutorial with possibly us if
you want I mean it just it's your it's
your way so yeah I'm going to say email
rejects and I'm gonna say test and this
is how you can test reject and this
thing gonna return a boolean this is
really important the validator err need
to return a boolean so you see I just
put my mouse and the boolean return a
boolean so that yeah I can put a comma
and I can say message how this message
going to be what MongoDB gonna show when
this email is not valid I'm gonna save
value so that's going to be the values
that's going to be the email of the user
a enter value it's not a valid email
like that so we set up the email that's
perfect so now if I want to test that
what I'm gonna send this thing
validation error email Jones no it's not
don't know it's not a very male so you
work we're gonna make sure to work with
a valid one so we're gonna say John like
that calm and now your work okay so now
we're gonna do the same for the password
where I'm going to set the type of
string
require to trim to validate again the
same same thing validator
air gonna take the passport and now
you're gonna see just password the
length so that's a string so I just want
the bastard that lent bigger than six
and also I want the password password
password that match and here I can see
some reject and I'm going to just say
slash D plus G yeah like that and here I
can just see if I want that it password
but I can just say not a valid password
this way because I don't want to be some
value so now we set up the password we
set up this thing like that now the
thing it's about a unique if I send
right now so at the same value so just
for showing you my Robo Mongo observe in
the DB this John no no right there this
one so if I send again now looks at so
one sec yeah what happened maybe know
why it's because I'm gonna need to drop
my my collection because I think the
connection they didn't get every stuff
it's like the schema they didn't get the
unit to on or if I resent pretty weird
okay sorry about that I get it work so
what happened it's you're gonna need to
drop your database and also restart your
server so here you click drop database
you've closed your server and now that
should work and just to make sure that
work what you can do
it's click back here click on collection
sorry I'm gonna just delete it delete
this thing yes now you click here on out
you click on statistic you get here the
key you get you user education there out
and stuff like that and now just make
sure that the index here gonna have to
index the ID and also the email if this
is there now that should work so now I'm
gonna create first time John Snow and
now if I send again now look at this
ugly error that don't make sense I mean
if you send me there as a like if you
send me that if I'm working in the front
end I'm gonna really don't like it so
what we can do for make it better we
have a simple package here call a call
unique yarn mongoose unique validator so
it just which was a good unique
validation when you have something
already taken your ad mongoose unit
validator when it's done you go here at
the top of the file you call unique
validator from unique validator here and
now the only thing we need to do now
it's go here and say out schema the
plugin so we can add some plugin we're
gonna pass the unique validator and
oiled only thing we need to say its
message so which message we want to have
when we add a unique thing we're gonna
say oh the value it's already taken
that's it
and now if everything is working and i
send email jason Balala snow already
taken so you see we did already one
thing really good it's now we have the
email this way now the thing is look at
how we saved that the
the password it's really not good we
save pass one two three so all we can
manage that it by adding a package
called bcrypt no GS we're gonna add this
package first bcrypt
no GS this thing gonna help us to crypt
so to do a like to finally do a ashing
version of the password so it's gonna be
order to to read it so from the bakery
no GS library we're gonna import the
Asch sync so now what we're gonna do its
ear what I'm gonna do is I'm gonna call
the Alt key mode 3 so pre it's a method
define a pre oak for the document yeah
I'm going to do this on the safe before
you save yeah even if you remember my
drill I told you here because we want to
have access to the disk and in the
contact we don't want to lose the
context of the disk we need to use the
function keyword and now here what we're
gonna do so remember that this is going
to be the user in creation first thing
we're gonna say if this is modified
password so the name of the key so it
what that means--it's
if we are in the processing of mod of
modifying a password I mean create order
the password we're gonna we're gonna add
the password if now we're gonna just
return the next so the next it's like
it's it's like a middleware so we're
gonna just continue the thing it's why I
do this is because if the user want to
update is username example I don't want
to react is password on the thing I mean
it's update is username why ashing again
the password so this is what that means
so yeah I'm gonna say this that password
so this password now it's gonna be quote
this that and now a I'm going to call it
from Genco ash password now you may be
asked what is that don't worry we're
gonna see that in your past that there's
that password and now finally we're
gonna return next else ear we're going
to return
next and if you so this way so now I'm
gonna create this method now you may be
a sake well yeah but why are this is
coming this method yeah this coming from
something called methods and we're gonna
call this metal right there would take a
password so take the password right
there and now you're the only thing we
need to do its return ash sink password
I get it just for abstracting some of
the code so now here I make everything
work to make it a shit now you're gonna
see just by adding this code now if I go
there I'm gonna deal in my Robo Mongo
because I'm too easy to change your
email delete document now I'm gonna
click post man and now look this is the
new path of the user right there so now
try to break this thing I mean the
password want to twist we follow away
from this I mean it's really it's not
the same so so now we are able to add
the password now we maybe want to be
able to log but I think it's the
question you may be asked yourself it's
okay yeah I see what you mean
with the ashing password but now how can
how can my code will read this thing I
mean it just crazy and bcrypt give us
everything for that comparison compared
data with a single synchronously and you
see that's returned I'm gonna just
import that return a boolean
it takes some data as version and we can
boolean so this thing is going to be
again a method so what I'm gonna do here
is I'm gonna say hey I'm gonna say
authenticate user so that's gonna be a
function we're gonna take the password
so I'm gonna take the password from the
front end so the password the user gave
you and when you say it's you finally
come per sync with the password so you
see the data and after that you need to
pass the edge version simple there's a
password so the password of the user
inside
so now this function is there but now
you may be asked yourself okay yeah but
now I see your point but now how can I
use it
and now that's why I passports gonna
came for us so if you go to the passport
GS last port yes it's a notification
with the orphanage es you just help you
to make it really simple
like they give you a lot of code for
help you with the passport thing like if
you want to do like Facebook or
everything and also we do with local so
the local mean this is your own version
what I'm gonna do it inside my out here
I'm gonna create a file called fast for
that G yes even now I'm gonna need to
add to library yarn passport and
passport local passport is the library
you always need when you use that sport
that's poor local is one strategy so you
add the strategy as you want so if you
want passport Facebook you install
passport Facebook and you add it that's
it
so in this file we're gonna really go
with some boilerplate so we're gonna
import passport after that we're gonna
import the local strategy from passpo
local yeah after that I'm gonna import
my out model coming from my out model
and now here what I'm gonna do is I'm
gonna create some option right there by
default passpo want to check the
username field if you want to override
that like we want we because we want
that by email this is the way you do you
say you create an object like that after
I you say current locale no game so
that's gonna be my my variable my
function here who's going to be a new
local strategy who this one gonna take
the local option so you see local
strategy strategy here I think maybe say
no it don't say so some flow type so now
type scripts and now your this one I'm
gonna have an easing function here I'm
going to be C the email the password and
also done who's gonna be the callback
method like that now here what I'm gonna
do is I'm gonna do a track
if a Venera here what I'm gonna do is
I'm gonna return the call back any of
this callback gonna take gonna take two
thing so can I take the first argument
is gonna be the first on your man is
going to be the error if you have an
error the felon argument is going to be
if you are the user or not here I'm
gonna say fault because I have no user I
mean you have an error why well you
should have a user so I'm gonna see ever
like that now in what I'm gonna do is
I'm gonna first thing to find the user
by doing avoid the out model the find
one and I'm gonna sit by email by doing
this so I'm gonna just only find one
user if we don't yet have the user I'm
gonna return my call back with no error
but so far I mean it's not there we have
no user with the similar else
authenticate users anyway pass the
password so what is that is the other
ticket user is the same function
right there we take the password and
because this is a method view you added
it on the instance of the user this is
not a static method is inside the
instant and now here you can return
again done with milk and Falls and else
finally if if is add this user in the
password match so this is what I mean so
that means if the password on Matt here
I'm gonna return done with no and the
user now and the resort these are going
to be saving direct that user I'm going
to show you that in a moment
you know I can say passport let use I'm
gonna set my local okay and now we're
gonna import a variable called Oh local
who's going to be passport that
authenticate with the local so you see
here it take the strategy and after that
a I'm going to just this session because
I don't want to civilizations doing like
that so now we are pretty close to I've
done with the this one so what are we
gonna do after that it's we're gonna go
to the service because I don't want to
put this code right inside my controller
so I'm gonna go to my
I'm gonna import something coming from
my passport file and that's gonna be the
out local so the variable we just create
right there and now this thing what I'm
gonna do is I'm gonna go there I'm gonna
see login
we're gonna get here they read the rest
in the next coming in from the
controller request index you need only
thing I'm gonna do is filter out local
rec rest and next now you may be asked
yeah but that don't make sense what you
did here that gonna make sense in a
moment please stay with me this thing
finally just gonna call this out local
thing we just do with the request the
resin then next then exits the way to
when you have a middleware but now what
we need to do is go to the controller
we're going to create a login controller
and this one gonna take the wreck the
rest and the next and this one gonna do
finally where's that status 200 if the
user is working because remember this is
a middleware so the passport gotta
happen before the login so what that
mean it's if this controller get it that
means we have it so that's why we can
return a 20 right here and just say
react that user we want to return the
reg that user to the front end for now
and now after I can just say a after
that just continue the code that's it
now the part here it's gonna be where
we're gonna do the route so what I'm
gonna do with the route here now I'm
gonna need to import my out services
coming in from my services file and now
what I'm gonna do is I'm gonna sit route
that pote slash flow game and now here
what I'm gonna do is I'm gonna pass my
needle were logging and now I'm gonna
put my controller
okay like that you can we be called
services a logging or the gang
middleware something bugging me that
we're gonna make more sense I'm gonna go
there and I'm gonna just put logging
middleware right there now make sure
your code is not breaking with this
error s this is a way to restart no none
perfect so now I have my user we just
I'm here my users are still there now
what I'm gonna do is I'm gonna go to
slash login because remember this sprout
here and now what I'm gonna do it
something the first thing we move the
username and first I'm gonna just do the
email first thing I'm gonna get a better
because because I absolutely need a
password now if I have the good password
a good email I get 500 the good
incorrect argument incorrect argument
what I think it's I maybe did and never
right there and passport so I'm going to
just check Michael really quick so I say
usernames he'll put the email sounds
good here
I put the option here
it's pretty strange right now well I can
so I'm gonna post a video I'm gonna be
right back when I find it okay so I
found my work look at this I make a typo
right there with the password so now go
back to postman and now if I sin I get a
200 ok so that means my user can log if
you don't trust me at the for ear sin
you're not arrives it's not a good one
so if example I send a bad email like
that also it's gonna be you know the
right so now the log in system work so
we look so mature that it didn't make
this error so I'm sure you have seen my
work before me so so now you know so the
flow here right now it's we send that go
to the route here look out there go to
the logging after that go to the middle
we're logging me the word from the out
service so the old service is this thing
here we'll get the REC reason next and
get the out local all local came from
the passport so here is the Midd trying
to debug who finally you're gonna find
the user if no user returned no error
but unit arise if the password don't
match the one safe return no user info
and that's gonna return the user the
user here when you return the user ear
that gonna go here inside the Reg that
user and that's why now you can see the
user in my postman so I hope you enjoy
it sorry if I get some bad error I mean
this is the the beauty of life cutting
so I hope you enjoy and we're gonna talk
in the next episode wire now we're gonna
start to do the email services where
we're gonna send a verification email so
I hope you enjoy and we're gonna talk
later yeah good night bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>