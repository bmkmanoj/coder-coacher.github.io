<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Meteor.js Hosting &amp; Scaling 101 | Coder Coacher - Coaching Coders</title><meta content="Meteor.js Hosting &amp; Scaling 101 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Josh-Owens/">Josh Owens</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Meteor.js Hosting &amp; Scaling 101</b></h2><h5 class="post__date">2014-12-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/YBnGFU9h2uU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">alright I'm on my slide showing up on
your screen then yeah yeah let me see if
I could full screen
it is for this chrome is full screen all
right no no no you there we go okay all
right yes there we go we can see your
slides okay awesome so um for anyone
that's watching this this is you guys
are the the Raleigh meteor meetup right
yes yes all right so we're in Durham
Durham nice okay so um I'm giving a talk
on hosting and scaling with meteor j/s
if you don't know me i'm josh owens you
can find me at this plethora of places
below I run the meteor podcast I do kind
of like a weekly blog post an email call
me do jazz club and I also run crater so
feel free to check any of that stuff out
so when it comes to meteor you have
actually quite a few options for hosting
now probably the simplest and the
easiest is just hosting on the Mediacom
infrastructure and you can just do like
a meteor deploy and the given an app
name and it'll deploy that that sub
domain so if we say like meteor deploy
talks then talk stop meteor calm will be
your app and then they tie that to your
user your mediator meteor developer a
user account for security purposes so
someone else can't deploy your your app
unless you give them permission to I
think that this is great for prototyping
or showing off to a client or showing
off at you know a demo or anything like
that but for me the meteor com host
has a few downsides one of them is like
who do you email when something is
busted or it goes down there's really no
official support behind it you could
probably go hassle slava who might be
watching this on Twitter and maybe he'll
help you and maybe fix it and maybe
that's changed but that was my
experience quite a while ago the other
thing is you don't really get full
access to the environment so you can't
really figure out what your Mongo string
is for connection and like remotely
looking at your database there's really
no way to like scale up and and have
more app servers handling things so it
is a really basic solution right now but
they are working on galaxy I'm guessing
we'll see something within the next six
months from them for officially hosting
Production apps but for now like I would
you know this is great for doing little
tests but I would not put a production
app here next up is modulus so this is
what the dashboard kind of looks like
here this is an older screenshot it may
have changed a little bit here and there
but basically what you get there is it's
a platform as a service so they give you
little containers they call them servos
that run your app and so you do like a
meteor deploy are not a meteor to play a
modulus deploy you install their little
command-line tool from mpm and then you
can do the modulus deploy and it'll ask
you like to log in and then the last
year which app you're deploying if you
have more than one I have and then
though it'll take that code and it will
I think the process is that they they
compress it and ship it to their server
they recognize that it's a meteor app
and they do all the proper things on
their end to host that meteor app the
only gacho with modulus is that you have
to set up a lot of the environment
variables and you have to set up the
database like that stuff is not
automatic with them and so you can go
into
their admin interface and create a Mongo
database and stuff but I wouldn't even
really recommend that like if you're
doing production I would host with
modulus but I'd probably put my data
over on composed I oh and I didn't put a
slide in here for them but we can talk
about that at the end too they do great
Mongo hosting and I think the key here
with them is you know one they cost
about 15 bucks a month for a servo too
they do sticky session tracking for
their router which means that you can
scale out beyond just one servo so the
kind of the the way that you would scale
out on modulus you would probably host
with something like composed I oh and
get an oblong enabled Mongo database and
then hook that up to your your modulus
set up using environment variables and
then anytime you need to like handle
more traffic you just tell it to like
just boot more servers there's a little
slider and you go from one to you know
for whatever you need and then just hit
apply and they'll spin those up for you
it's pretty quick and then they've got
nice logs in there and that kind of
stuff as well so for me like I hope some
of my have some modulus of them at
Heroku and someone want digitalocean so
I can kind of speak to the differences
once we get to the questions portion
Heroku is the other kind of easy hosting
solution the only thing that I would say
is with Heroku you use what they call
build packs so they have little
containers as well and they call them
gosh what do they call those things
dinos and there there little containers
that run your app as well but they they
use get to ship your coat up there and
then if you're not using rails then you
need to give them a build pack which is
essentially like a series of bash
scripts that tell Heroku what needs to
be installed in order to run your app
and so there's a large community effort
you can go out there and look of Heroku
meteor build packs but the latest one
that seems to work with one point 0 is
called like the horse build or something
like that I I can find the link and put
it up somewhere but I've got an article
that kind of compares all these and I
link to the the horse build pack but it
does a good job the the gotcha here is
that they don't do sticky sessions for
their routing so you can run into
trouble because they're doing like login
tracking and that that's all kind of
dependent on on the sticky session stuff
so if you scale to more than one you may
start to run into some weird issues so
it's great you can host for free there
for your first I know I think if you're
if you don't have a high-traffic site
hiroko does a great job and you know
their ad on marketplace has a lot of
options as far as the meteor or the
Mongo hosting and I think by default
when you use the the horse build pack it
installs the free Mongo hosting option
for you uh so the third option is just
hosting it on your own and there are
numerous ways you could set that up I
mean you could use ansible or darker
chef for any of this stuff but the
easiest tool to get started with this
meteor up it's a package from Aaron Oda
and basically it just it's some scripts
that you have that you can run it uses
ssh to like put your app over on the
server and so you do like meteor up I
think set
or something along those lines and then
once it's been set up like it will
install node and it'll stall if you if
you wanted to you can tell it to install
Mongo again like I still use compose for
when I'm using meteor up because I want
that that up log capability from them
and then once it's set up you just say
meteor deploy and it'll grab the current
version that's on in the folder and it
will ship it up to the server for you
and deploy it and then restart
everything so he you know meteor ups
taking care of the upstart scripts and
installing everything and and then it's
also your deploy command and so you can
use this with any hosting provider like
lineno door digitalocean or amazon ec2
so pretty pretty basic option but i
think it it probably gives you the most
flexibility in the long run is if you're
hosting on your own and then like you
control the routing and that kind of
stuff so you can set up your own load
balancer and make sure it's done the
right way all right so the other part of
this talk is scaling I think the biggest
piece for scaling when it comes to to
meteor is Mongo itself and in zero dot
seven they added up log support and
basically what that is is is a fancy way
to say that you know you're going to set
up a Mongo replica and you have a master
server and you have a slave server or a
primary and secondary and the secondary
servers listen to a special collection
called off log and it's basically a list
of data changes that are happening in
the primary at any given time and so
those secondaries are listening to that
and pulling it down and applying those
changes well meteor has with their off
long support they just act like they're
a secondary and they listen to that off
log and they
sit there and they process all those
data changes that are coming through on
the meat on the Mongo server and they're
applying that and so down on on the
server side of meteor they have what's
called a merge box which is a the way
that they're tracking what data the
clients that are connected are
interested in and so they're able to
look at the changes that are coming in
and then based on what's in the merge
box they can push that down to the
client so if you're subscribed to some
data that's changed they'll know you're
subscribed they'll see the change came
and they'll push it down the DDP pipe to
you and so that's that's kind of how you
scale Mongo out but the problem is this
is really kind of a double-edged short
so the problem that up log fixes is the
fact that if you have more than one
meteor server in place you're going to
have update delays by default without
off log turn on without the off log
support enabled so what happens is like
server a may run an update and send
something to the database it gets saved
server a already knows that that data
has changed but server be doesn't have
any way to know that it's changed so
what happens in in regular meteor
without off log is it's going to sit
there and one what they call it Poland
if and they're going to query the server
and say were there any changes on this
data and then they're going to see that
the data changed and it's going to ship
back down to server be and then any
client that's connected that subscribe
to that data is then going to see that
change but that code was runnin like
every 10 seconds so you're getting a
10-second delay rather than full real
time so the way to get around that is to
use a vlog so that that's kind of what
we were solving with the off log change
but the issue there is if you're pushing
too much data into the Mongo server
there's no way to say I only want to
subscribe to this data from the hot blog
it's all going to come down so like if
you're pushing a ton of
data into Mongo it's you may actually
start to run into performance issues
again like CPU spike issues where like
it's sitting there and trying to process
all that all those a blog changes and it
may not even care about all of them but
it still has to process through them all
so you know I've seen other people like
Aaron Oda and khedira he's actually got
two databases he's got one that's
sitting there it's fronted by node API
the data comes in from the applications
goes into the first Mongo database then
he runs aggregation queries and then
pushes the aggregate data into the
client connected Mongo database and so
that's that's one way you could deal
with having too much data being inserted
into a Mongo database so I touch a
little bit on the merge box but that's
that's another place where you kind of
have to worry about the the scaling when
it comes to CPU and memory so the merge
box kind of eats up the memory on the
node side so the more clients that you
have running a subscription on a meteor
server the more memories going to be
used as far as I guess as far as I know
and then the the thing to be concerned
about with the CPU is you know whether
you're running Poland if or are you
running the OP log how much is coming
through like I mentioned before and then
what kinds of things are you doing on
the backend server side as well so in
particular like we had I helped build a
fantasy hub calm website that did
real-time fantasy sports where you build
a team and when a game would become
active on the server side we were
checking every minute to see if a game
was active and then once a game became
active we started pulling in the stats
every 20 seconds for all the players in
that game and some of that stuff got a
little CPU intensive so you know that's
another another thing to kind of
consider when you're writing your code
so that's kind of it
now does anyone have any questions as
far as the experience you've had
deploying on the different options is
there one that you have a personal
preference for my personal preference
would be the modulus probably first and
then digitalocean would be second and i
would say it just really depends on how
comfortable you feel with running your
own server if you feel comfortable i'd
say go with digital ocean and use me
here up with that correct yeah okay I've
personal um if you are using modulus how
long does it usually take before you
have to scale I mean I know it varies
but how many she was getting good on
consistently before you find that you
have to start scaling outward so early
on oh we found it was somewhere around
whoop some of his wrong person here we
found it was someone around like seventy
to a hundred people could be connected
but with a blog that numbers actually
gone up pretty significantly so again
like if you're using AA plug enabled
hosting then that works out pretty well
wrong account actually don't know that I
have anything running here right now
yeah I don't so you talked a lot about
composer Gotye Oh as a good hosting mock
laughing I never heard of that the two
iron over this Mongo HQ and mongolab
does not offer the OP log or do you know
anything about those two okay so Mongo
HQ changes your name and it's now
composed that I Oh rather
they decided to get into more than just
Mongo so they're doing here they've got
these words humungado and elastic search
and rethink and what's Loretta sizzle
and uh yeah so they've got a blog
enabled and i'm pretty sure mongolab now
has an awful ugh enabled option as well
so I I definitely check them out but for
me like I know the Mongo HQ guys they do
a good job I've had like no downtime
whatsoever i also love the UI that you
get right here and so i can log in and
show you you can see kind of real-time
what's going on with crater so composed
helps manage like the sheer shards and
and all that um or do you have to set
that up manually like yeah how well I
haven't worked much personally with
MongoDB prior to meteor so I'm just
starting to learn about the shards and I
conflicted was it the mango config vs
The Shard is yeah headings and I haven't
done any guarding with Mongo yet and no
caucus-meteor so I I couldn't really
answer that question sure let's see
heaven no that's not what I won't either
where's the nice screen
alert oh it was pondering there we go so
if I load crater we'll start seeing some
spikes here this crater currently being
hosted on a digital ocean with composed
yeah okay yeah i wrote an article that
kind of compared the three and this is
where it ended up so this was kind of
the last option that i did so i never
moved it anywhere else after that but I
the whole time that I was testing all
three platforms I kept the data act
composed and that made it very easy to
move because I just had to set that
Mongo URL directly to the composed
database and so I wasn't transferring
any it anywhere i was really just
deploying something meteor files and
then pointing it back here to to get it
working and you're able to set up the
the environment are the Mongo URL via
the meteor up settings right yeah yeah
pull sure looks like there's just a a
JSON file that you create and you just
tell it like the host username and
password or if you're using ssh keys
just pointed at your key and and then
you just tell it like you know I set up
Mongo as false for me but set up note is
true so don't install the node version
and I tell it to install Phantom give it
to happen aim just crater and then you
pointed I don't know why he does this
but you pointed at your local user
directory like where the app is located
and then you just set these these
environment variables here soon may I
think it doesn't it ends if it like
packaged up and zips it up locally and
then pushes it yeah but it seems like
this this piece he could probably just
guess from your current location true
so I don't know that option seemed a
little weird to me but it works well and
so composes pretty much just like a
one-click install kind of thing is there
some configuration that goes and
initially setting it up project yeah
this is just pretty much a one click the
other thing you do is you go into the
admin section and just set up your user
accounts okay yeah and so you can see
like it's not I mean you know there's
there's a ton of posts and comments and
whatnot on there and I mean it's only a
48 Meg file size total and the data size
is eight point two nine eggs so it's not
Mongo doesn't take up a lot of space
necessarily sure the other thing I would
recommend is installing khedira and it
kind of it gives you insight into what
your meteor app is doing we go back to
the dashboard here so you can see like
the pub sub response time is hovering
around 100 right now the method response
times they spike everyone so on these
are probably posts if we go dig deeper
cpu usage seems to hover around ten
percent usually and there's a there's
about 60 for 265 people connected right
now kind of show you your memory usage
as well and then you can dig into the
pub sub here and we can sort by response
time we can see whenever someone pulls
up a user profile this seems to be the
slowest publication but if you look it
doesn't have a high sub rate it's like
0.02 per minute what is like this post
list users it's 287 milliseconds but
we're getting about a half a sub a
minute a little over
so this would be a good place to maybe
optimize and dig in and look you can
look at the chart here we can click on
the response time and then you can
actually pull up a trace of the
subscription and you can see post list
was the slowest returner and actually
for some reason it it got ran twice so
three times actually so there's probably
some kind of optimization in here that
could be done in the subscriptions to
make this a little faster so give any
thought the best way to set up your
collections in my home the best way to
let collections in Bongo you know how
having set up document structure they
can get a experience of doing one way
that works better than another um yeah
so I think to me like i tend to
denormalize my data a lot of time so
i'll have collections for each kind of
thing in a nap so for instance i do a
training class and we built a Twitter
clone and in that one you know I've got
users and tweets and you know we've got
the idea of mentions those are tracked
separately um gosh what else is in there
I think that's about it right now it's
pretty basic but I you know I try to
keep those in separate collections and
then we do we do lookups based on you
know the keys that are being passed in
does that answer your question are we
looking for something different no and
it was really those kind of touches on
that the comments on right yeah yeah
that's what I was gonna say so um kind
of a fun way to drive a join in here I
take a like an ID off the route
so like / post / ID and then I subscribe
to both the post and the post comments
based on that post ID so it's kind of a
easy way to to get that data to flow in
correctly without having to go to too
much trouble home this might be too far
on the side but have you looked at pure
TV and you have any thoughts on that
kind of um merging um so I haven't
actually used it as far as I can tell
this is only a meteor thing and it looks
like it's really just a layer on top of
mongo so I mean I I don't know i don't
know how i feel about this honestly like
I've been investigated at all but I mean
it could be interesting I just again
like I I'd prefer for this piece of my
architect shrug probably prefer
something that's from mdg itself right
now but there I mean there are other
interesting things you can do as well
like i've got some blog host blog post
in the hopper one of them is about
consuming DDP data as a client but i'm
also trying to get someone to write
consuming like an interview style posts
about consuming DDP data from a
different server and so I've got some
guys I know here in Cincinnati they've
created an elixir app and they've
created a DDP server for that and
they're exposing the elixir app to
meteor through DDP and so they're able
to just say like meteor not subscribe
and you know they can they can point at
the elixir server and the data starts
flowing out that way so I mean the
possibilities are endless when you think
about it from that standpoint you could
go make a rails app backed by my sequel
and use the DDP library for Ruby and
like start publishing data that way as
well so there are a lot of options out
there
last night I am I was made aware of a
Mongo commerce site specifically Kevin
do you remember the name of it ok Mongo
Mongo Commerce com comics com yeah maybe
I'll hype him in there forward oh gosh
yes so these guys are building reaction
Commerce which is built in meteor
because this may be what you were
thinking of well this is actually a
president presentation by somebody it
was a it was a dotnet presentation oh
she's using it he was using a site
called Mongo Commerce and the rates the
the rates they were charging for space
space and processing of their sight word
really cheap hmm yeah I don't I don't
know all right well um that anyone else
have any more questions I did it one
more in this baby antithetical to the
philosophy behind meteor perfect with
the reactivity built in but if you
looked at cashing it all it's an action
to improve performance um
I honestly I haven't really had to think
about that a whole lot I would think you
know if that's a concern you could
probably move some data to Redis Redis
is pretty zippy but again I know that
there are people that I've also worked
on shorting so that's another way you
probably enhance performance without
getting too crazy Abigail Watson's done
some stuff that I think was shorting but
no I really honestly haven't gotten to
the point where I've had to cash a whole
lot I can't think of any instance where
I patched anything yeah by the way this
is ty moogly was the presenter list was
one of the presenters said this this
might just be his his thing he called it
Mongo Commerce yeah he needs docs some
elements a write some docs man it's a
work in progress yeah August ok for
presentations so one more question I on
the Heroku side you mentioned you've
tried a couple different acts and the
best one was something with horse in the
name which I thought was buried oh well
so it's funny because if you if you read
through the comments um I think even
says somewhere on his uh on his github
page or something he's like I went with
horse because why not do you think is
that like a rapidly evolving space so
you think people are coming around and
starting to condense on that one so I
guess for the clothes disclosure I work
on a product that's built on cloud
foundry which is also build build packs
but I have no idea what direction to
head in in terms of hosting whether we
should use kind of straight nodejs or
whether we should use a specific build
pack Keth negated to dedicate it to
meteor I would use a specific build pack
dedicated to meteor this is the horse
build pack so it's admit hub / meteor
dash build pack dash horse
and basically the reason this one works
and the others don't is because no one's
maintaining the older ones and when 09
came out obviously with with meteorite
going away and the native Package system
coming into play you know they they had
to make some changes to the scripts and
so this guy's kind of been keeping it
up-to-date and it seems to work well so
oh yeah here why horse there are a
gazillion forks and branches various
build packs remix in the words Heroku
build pack a meteor many of which are
abandoned or outdated or broken and it's
really hard to keep them straight so
this is the horse one and it works I
remembered you know thanks coach and I
ok she goes it's ok is this guy or this
community like active in the community
or just some random guy or no no um
Charles guitar I hope I said his name
right um I've seen him helping out with
velocity as well so I don't I don't
think he's random you can see here he's
got commits from this month and last
month so I honestly like this space
probably isn't changing that much
anymore so you know with 09 there were
big changes and then 10 came out
something broke the older build packs
again and so you know he had to fix for
that and then you know there's just not
been there's not been a whole lot that's
happened since then you can see like
most of this has just read me stuff from
the looks of it yeah I got burned by
trying an old an old one and it didn't
work and then I went to the nodejs one
and got it to work using instructions on
the meteor site yeah I that was the way
I was going to go I still sort of
leading that way but maybe keep an eye
on on this one and see Thanks yeah no
problem and the other thing to consider
to that was weird for me with Heroku
hosting is that a lot of the build packs
use some kind of like node version
detection let's see if we find it in
here compile yeah somewhere in here yeah
they use this sem VAR i 0 / no / resolve
and for some reason you know it was
coming back with a weird version it
wasn't coming back with the version i
wanted so you can manually override that
as well with your own version and i
would recommend that rather than using
letting it do this this curl look up and
you just somewhere in here you just set
there's like a file you put in here like
a node version file and my machine slow
today yeah i don't know i can't find it
but anyway that was the one gotcha that
I had is I ran into some problems
because it was installing the wrong note
version basically and it was because
that that curl call was coming back
weird so and he was there anything that
you wanted to since you were so kind to
do this presentation that you wanted to
tell us about I know you do a meteor
club saying do you wanna yeah just um if
you haven't I'd say just go to a meteor
jazz club pop in your email address a
name and you'll get like weekly emails
about the the blog post that I'm doing
and you know I do a Q&amp;amp;A so there's
probably one coming up next week with
Sam who's watching but I haven't set a
date yet so like I'll email that data
out to the mailing list and you know you
can come and we'll kind of do like a
live question to answer I imagine a lot
of that'll be about velocity and then
the other thing that I've started doing
is a tree on so you can go to
patreon.com/scishow club
and if you sign up for like the ten
dollar per month support then you'll get
access to the slack chat room so it's
kind of fun got a couple people hanging
out in there very cool yeah all right
well thank you very much Josh yeah
thanks behind again if you ever down in
the raleigh-durham area should contact
us and come out for a beer</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>