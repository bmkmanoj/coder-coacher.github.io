<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Meteor Podcast #64 - The security edition | Coder Coacher - Coaching Coders</title><meta content="Meteor Podcast #64 - The security edition - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Josh-Owens/">Josh Owens</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Meteor Podcast #64 - The security edition</b></h2><h5 class="post__date">2015-06-12</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/E2XmAE56kak" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this episode is for friday jun 12 2015
almost at 14 holy crap give my ears
mixed up no such checks that way yeah I
had too much beer yeah don't know
anything about that ah you might be you
might get there faster me man if you're
not watching the video we've got alcohol
um so welcome I've got i'm josh owens
I'm the host Josh Owens not gonna
special guest co-host this week welcome
back Dean hey hey from Chicago grajeda
so right it was completely m.i.a i
texted him and i never heard back so
luckily Dean was able to fill in and
save the day especially like I was so
crazy busy last week I just couldn't do
it so just call me joshs little helper
nice think of my my media shirt on today
yeah yeah I gave uh I gave a talking
some was like well how do we how do we
get that shirt and I was like oh you
can't get that shirt that sure it's
deprecated been hun they don't make that
sure didn't you get this shirt but not
that sure um yeah so we've got a
exciting show there was like two weeks
worth of stuff to cram in but I'm kind
of in a hurry to today so we've only got
four stories but they're good ones I
promise and if you're not reading crater
and don't know about all the other like
30 stories I had to choose from what's
wrong with you um as always you can find
this podcast I never say this anymore on
meteor podcast com you can find it on
twitter.com / meteor podcast we
occasionally do the tweeting there yeah
so this week we're talking about you
cute that's awkward a proposal to
deprecate sessions meteor security 201
in the meteor around and I security
challenge dawn sunday sunday sunday so
um the cute
yes yes that one was interesting uh this
was from is their name on it a lot of
cute action going on lately but I don't
know those lv oh well they're the
package author but they're not blog
author yeah i don't know who wrote this
blog let's see maybe some crater this
makes me sad um more we calm don't know
that yeah so I i hit the about link and
it totally didn't have the guy's name
either he's like I'm a meteor rails apps
well what did this what did this humble
advisor of the community have to say um
yeah that didn't help either i found his
user account creator ha it's the same
name ok so i don't know i don't even
know how to pronounce that but mark
Hurwitz there you go night in the apolis
minnesota get a plus goldstone so mark
wrote a post about getting started with
cucumber and so number one like hats off
to him because my tutorial is sadly
outdated because in the world of meteor
testing if it's more than a day old it's
too old I it's getting better it's
getting better i will say that but yeah
like my cucumber tutorial was way out of
date like Sam did a major refactor on
cucumber and mark says here in the blog
post he took it as an opportunity to
learn how to get going with things and
so I think he he just he replicated some
of the work that I had done kind of
showing how to do a login and all that
kind of stuff and I don't know like
again I will say this every time if you
want to be a good developer learn to
test and write tests you know like it
that's it that's all there is that's the
biggest secret to being a good developer
is writing good tests that the function
I like the addition of the word good
because at first it is all about getting
some tests in
and learning that workflow which prior
to being given the nice label TDD was
also known as the scientific method so
it's a it's the best method but yeah so
anyway yeah no you're right i mean it
it's very much the scientific method
right because we can't we can't know if
we've improved things if we don't
measure them first right and to me
testing is like measuring to make sure
we're getting the right output mm and
the prediction that says i predict that
i'm gonna get a read okay gotta read if
you didn't then you know the do not pass
go right and then I predict that by
fixing this I'll get agree etc so also
not to take anything away from mark in
this tutorial but also a thorough shout
out to Sam hatoum for pairing with me on
something that I was doing wrong all
along but it kind of just because I knew
cucumber in a non JavaScript environment
I missed certain things regarding that
callback parameter that has to be passed
into your steps yep so whether it's
called call back or done or finish yeah
you still gotta like call it or pass it
on right yeah it's kind of like a game
of telephone there you always got to
pass it on haha the right right uh yeah
no that's awesome so I did you guys talk
about that in the the media club side
chat room where that yeah a little bit
before he took it offline to pair with
me for about like 30 or 40 minutes and
ice it was good so I think with
tutorials like like this one and the
other ones that are you know definitely
getting out there now people will be on
the right path um it was it was a not a
it was something that I was could have
been avoided if I had followed a
tutorial like this yeah yeah awesome
yeah i mean that's why i wrote the
tutorial to right i mean the more we
have these good examples out here the
more likely people are to read that and
start writing tests and I I think that's
the most important thing for our
community is to get behind testing and
do a better job yeah yeah yeah what do
you think when you find a package that
is really useful and really awesome but
then you find out it has no test for it
makes me a little sad but you know
honestly like I'm not going to say like
mdg does a better job either I i forked
the other day mdg and ran the test suite
for you know the stuff I was gonna work
on and there were failures like who
wasn't even working oh yeah just totally
crashed and so it has something to do
with like new code that was in
development in master yet or something
and it just didn't work and so I
commented on all those tests and then
still got like a couple failures and
like it just I don't know my pull
request i said hey are your tests
working they're like oh they're not
working for you and it's like I I was
just asking for a CI link or something
move like it was working before my stuff
yeah but you know I don't know they
didn't have one so yeah yeah awkward
yeah no it definitely makes me sad to
see a package without tests said as a
guy who tests none of his packages
hahaha well you know it's it's a battle
we're all working towards it so thanks
for you know advocating for the the good
fight the good road yeah definitely
alright so speaking of mdg next story is
a deprecating session yeah speaking of
the good road or the low road or the
global variable road or whatever
whatever you want to call it session is
just it's one of those a you know things
that you fall into right away in all the
tutorials and there are certain
applications that make perfect sense to
use it
and or something like it and so I think
what uh Abigail Watson started this hack
pad about deprecating session did she a
lot of sashko really I would hate to
miss a tribute that um yeah this is all
sashko i see i see so there's just
comments yeah yeah there's a ton of
comments Mina and Sasha yeah yeah Louis
I assume that's how you say Abigail
vincit dominate the yeah there's quite a
bit of comments in here by the way I
read some of them right I read a lot of
them and I I so to distill to distill
the issue down there are packages that
session are is a thin wrapper around and
if we advocated for for example template
level reactive variables we could get
you know better scoping by by using
tools differently is that about it yeah
so I think I mean in my practical
experience the downside of session is
the fact that you know once people start
shoving things there you have no idea
what's in there who did it hasn't been
cleared out like you always have to
remember to clear out your sessions when
you're done basically and it's just kind
of like if you don't it could lead to
weirdness right so if you leave a
session in there and someone was on a
page and it was indicating like a you I
stayed to come back to that page maybe
that's a good thing that you tracked it
but maybe it's a bad thing to I don't
know right and so there's always like I
did you know we ran into bugs we relied
on it super heavily in the early days of
us use meteor differential and you know
I probably about two or three projects
and I'm like at session just seems like
a bad idea mm-hmm and we didn't have
really far back then so we just would
kind of like track things on the
template somehow yeah yeah so you can
you know new up I'm personally very
interested in the lower level
reactive primitives like the reactive
dictionary which has that unfortunate
name that I think is another part of the
discussion III think reactive
dictionaries a fine name but this one's
actually reactive dicked yes and Leo try
mentioning that in a room full of people
talking and when the heads turn around
because they didn't hear the tea on that
I don't know it's just you know one of
those things saving a few letters
doesn't add clarity to this for me at
all yeah and so one of the proposals was
reactive namespace reactive dot
dictionary reactive variable reactive
object and I think it's a good
discussion to be having about where to
put in these things that kind of evolved
over time not necessarily to a standard
naming convention but you know could we
could we standardize and do a little
better on naming yes could we get rid of
sessions from meteor documentation I
don't know I'm trying to think of an
example but I've worked in other
frameworks where there's some ability to
do something in the framework and
they're like oh yeah but don't do that
and I know you hate making that kind of
statement and then having that tribal
knowledge but I don't know if it's
feasible to get rid of session entirely
you could I think you just make a lot of
people mad right yeah so like it's I
think it's a noob crutch that's the
right and to call it yeah and really
like if I think back to it I do show it
in my both my training class in Michael
Cordova tutorial and it's just honestly
it's just easy like I could just as
easily you a global scoped uh reactive
you know dictionary of my own mm-hmm
nothing to say I have to use theirs yeah
so I mean yeah it's just a one liner to
replace it and put something else in
place and kind of get your own little
namespaces and honestly that was one of
the suggestions Sasha put in there was
reactive namespace and I think that's
perfect
for it because that's really what you're
doing right like it's just a big big
variable that you can carve out and
shove whatever you want into it yep that
can be handy yep and naming is one of
the hardest things in computer science
yep what is it there's three hard things
in computer science it's like caching
and naming yeah and the third one is
remembering what the third one is no
it's counting is counting off by one
error yeah exactly happens all the time
okay all right so session I don't know
like is there any practicality to
deprecating it I actually don't think so
I don't think we gain anything by
removing it I mean it's just a one-liner
global namespace and I just don't think
we're hurting anyone with it personally
yeah I'd like to see now the template
level variables and autoruns are a lot
easier to use maybe courses will start
teaching it that way and session will be
delegated to an afterthought like via
well so I'll say you know honestly my
cordova tutorial the latest revision of
it uses template level subs it's got
autorun and it's using reactive ours to
kind of determine everything and redraw
the map as it needs to but I still use a
session to grab the location and frankly
that was just the fastest way to do it
you know session dot set location and
it's reactive and it works so well and
if that's the semantics you know if
you're on a game that has 20 questions
the current question for each person
might be tracked in a session variable
cuz that does represent you know what
they're what they're on right now yeah
yeah yeah I don't know I feel like we're
on a witch hunt here there's better
things to do guys all right just kidding
sashka um yeah so so how can we make our
apps more secure regardless of the
variable names I think actually having a
different namespaces is potentially a
way towards security but that's not what
the security to
one's about is it no all right break it
down for us josh this post was from a
jerk I don't know ha I'm just kidding
I'm just kidding it was mine um so you
know I wrote a meteor what I one meteor
security 101 topic and uh it was it was
alright i think it was good um it was
kind of like the obvious stuff like
don't deploy with insecure installed and
and in all honesty like a lot of my blog
posts come from like a real world like I
actually saw this happen like I saw a
big public startup that had insecure
installed and they were running in
production with it so you know I mean
it's not crazy I don't make this crap up
uh but meteor security 2010 I I did a I
did a security audit for someone and we
sat down for two hours and kind of went
over things and a lot of that a lot of
what I put into this article was kind of
takeaways from you know how and why this
security is important and what what you
need to like trust and not trust and I
think the keys are here you know on the
server side you need to trust this user
ID you know don't die an input and and
make sure your keying your data off that
user ID and when I say that I mean like
find the user or you know kind of if you
think about it this way like if we're
looking at Twitter I've got a user ID
and then we got a bunch of tweets and
those tweets probably have my user ID
and so don't just accept a user and put
it user ID make sure that the logged in
user has access to see those tweets
right I mean this is what we're talking
about um and so like if it's if they're
private messages you don't want to
necessarily just release those to me you
need to make sure that they're allowed
so that was that was one of them kind of
verifying that that user input and don't
trust it um also don't you know
iron-router and using an on before
action and not rendering something
that's not security that's just you not
showing some HTML if it's not allowed
all right right
the true security happens on the
publication so you need to double check
and make sure you don't publish the data
if they don't have the access to it you
know so that's that's kind of important
yeah um let's see what else did I put in
here Oh someone thought the allow deny
rules applied to code that they were
running in a meteor method on the server
and that's not the case allow deny rules
are only there to restrict the client
from doing certain things or allowing
them to do certain things so you need to
understand that when you're using a
meteor method even if it's split and
goes to both places right client and
server ultimately it's going to run on
the server and commit whatever data you
tell it to commit and that's independent
of you're allowed to die rules yeah and
that's a subtle one because the the
meteor method call you can picture
exactly where that is in the code but
and the server side code right but it's
a little less easy to picture exactly
where that endpoint that when the client
updates its own MongoDB and that data
syncs across that's subject to the allow
and deny rules but maybe it's the the
wording that the media API has where you
say companies that allow it looks like
it it applies to the entire company's
collection but it really only applies to
that automatic sync that's happening
when you update from the client yeah
yeah there maybe there's some clarity
that can be gained in the way you
structure that mmm yeah maybe yeah I
think you know for him the the problem
was that you know when you put all this
stuff in your company's jas file or
whatever like it all sits there together
and it looks like oh hey you know this
allow applies to this method and that's
that's totally not the case you have to
understand that any data committal you
actually do happens on the server and
you know that's ultimately where you
have to rely on the security this kind
of stuff
and honestly I think that was just the
major theme of this post is don't trust
the user and only do things on the
server indeed and furthermore allow deny
rules are tricky to get right they are
they really are I was one of the first
to attempt to tackle the security
challenge but I didn't have time to go
through with it but man did I learn some
things by looking at these proposals so
background of course is that this I'm
just gonna make up a name because I know
I'm gonna get it wrong slava Kim posted
this meteor security challenge right
Noah sasha grey wasn't it Sasha grief
grief okay that's my Spanish are rolling
which doesn't belong in there but
nonetheless the proposal to say hey
here's a here's a little security
challenge it's kind of like out of
telescope people can like links I
believe hmm it's if you're if you're
familiar with a blogging platform it's
kind of like the meteor forums and can
you make it so that people only can like
once and they can't delete other
people's likes or set likes to arbitrary
values and you can only edit a post
that's yours you know a typical set of
business requirements for what is
allowed to be done and there were so
many different approaches that people
took which then sasha was kind enough to
shoot holes in a movie and then
summarize the typical anti-patterns and
mistakes that he saw so this is so
incredibly valuable you know it was
funny to be is the fact that a lot of
the solutions that had problems were
like five or six line solutions you know
one of them was pretty long but still
missed it but like Luke
the user accounts guy he just had like
an allow call that had he was close but
he still missed it right like it was a
one liner and he didn't get it and then
you go down and you check out my good
buddy Pete therapy Corey mm-hmm totally
nailed ain't got it right but this
thing's probably like you know I mean
with proper wide spacing readability
it's it's like 20 25 lines I bet yeah oh
and he factored things into you know
using the matcher part of meteor which I
thought was a clever take on it right
the same things that allow for you know
checking arguments to meteor methods so
that was a good use of that to reduce
the you know amount of I don't have to
segregate the the amount of things that
you're doing yeah yeah yeah the other
thing that was interesting was um you
know Luca came back and decided to try
Adonai rather than allow since his first
failure and he he did a couple denies
and basically he had one update
statement that said returned true or one
allow statement that's a return true and
then he had a bunch of denies that
basically looked at the modifiers and
made sure that they were valid but he
had one two three four of those so again
pretty complex and I'll just say you
know for me if I saw this this challenge
I'd be like man screw that i'm just
gonna write a method yeah yeah so we you
know uh I feel like methods are not a
silver bullet I either um so what is it
that you would get out of writing it in
a method that would be liberating and
and and better for you uh well in
particular the method would handle the
one function and you would hit so to me
like what you're trying to do is
replicate the Facebook kind of like post
thing right and so
you need to track both the user ID and
increment the light count and so all you
have to do is call method called you
know like post or whatever pass along a
post ID and that's it just a post ID on
the server side will already know the
user ID and will already know the count
can just call increment on it so you
know all we have to do is just run a
check on the post ID and make sure it's
one that they should have access to or
something and then we move on in life
you know they're not passing in any
other inputs so for a compound document
instead of validating like the document
as a whole you could just have a method
that modifies this part of the document
with certain security rules sure yeah
and in its server side code so you can
trust it that's the biggest thing here
this with the allowed and I were
allowing the client to send in any old
data and if you're allow returns true
you know and they did something
nefarious in their statement which
anyone can issue a statement from the
console that's that's the other thing
most people don't realize like you just
call meteor subscribe for the console
and yeah data that's available you know
so you got to think about that from a
security standpoint same thing with the
inserts and updates you know it's just
something that any any old any old black
hat can open up the console and do get
your black hat on yeah so you know I to
me like I look it I teach the class and
we build a follow button and it's a very
specific update to a very specific thing
you know we're tracking an array of IDs
and you know we probably honestly
increment a counter somewhere and that's
it you know like that's the perfect use
case for a method yep and you can use
these a mango modifiers to increment so
there's no like race condition if
multiple likes come in at the scene
right right totally I should have you
know I should have been funny and
responded to his security challenge with
a method version I still may do that
that would be pretty way um so I don't
know it probably like
three lines of code or something yeah
and then he'd be like but I said only
using alandi nine well I think he's kind
of proving a point here right and he's
not odd he did it in a really good way I
think to put you know these these kinds
of easy to fall into errors I think that
kind of illustrates the point almost
better than than any blog post because
it has community content and he's
showing like how people i think mdg
should pay attention to this for
structuring AP is right this is how
people are trying to use it this is the
real world validation of okay you've
written the docs you've written the
api's and this is what people are doing
with them is that what you want or is
you know they're a little more
prescriptive advice and that's how
things iterate I'm not faulting that for
where it is sure now Dan is perfectly
valid for certain types of collections
yeah but as things get complicated here
they are the problems yeah so i'll say i
had the pleasure of emailing back and
forth with david glasser yeah from mdg
and I specifically asked him because
there was a this was back when there was
an actual security hole in the allow
statement stuff that you could like
bypass it and they released an emergency
patch for it and I was like I don't you
know honestly like I find myself using
methods more than allow deny you know
what like can you explain the situation
you guys envisioned using allowed to die
and David glass or responded and said
that he feels like when he's prototyping
app he'll use allowed Knight to kind of
get started and then once his security
or his application or whatever gets a
little more complex he moves to methods
for updating or inserting yeah and
that's a pretty fair approach I think
and it's a similar I think paradigm to
with the session right there's a thing
that you can use to get started and then
there's the thing you'll probably want
to evolve into and I think that's been
part of meteors charter from the get-go
is that it's accessible to beginners
yeah and and yet there are still growth
paths into into better things
yep yeah all right how's that strawberry
beer doing it's gone ah I pour it upside
down but I'm not sure I've got all the
drops out of it i feel like i should
disclaim that this was at least as much
apple juice as it was whiskey okay so
well you still seem sober so maybe yeah
you know all right well first I want to
say thanks for letting me put you on the
spot there Dean always pleasure and as
always i know we hit the the patreon
mark to stop with ads but i'd already
secured a year of ads with modulus so
we'll keep doing this till december if
you need hosting check out modulus taio
you heard that at the beginning they do
a good job honestly they've got a lot of
smart guys we had our last Cincinnati
meteor meet up there it's kind of cool
mmm they got kegerators and their office
pretty cool um so check them out and
then as always if you want to be in that
that infamous infamous slack chat room
you or just support this podcast in
general or crater in general like just
go to patreon.com/scishow aab and you
can sign up there 10 bucks will get you
into the slack chat room I think we're
almost at a hundred people in there now
so we got some of the greatest minds
like Dean in there and Sam and Sasha and
we also have some people that are brand
new to meteor so everyone's in all
stages of learning and very hopeful and
open to talking and chatting it's always
a fun time love to hang out whenever I
can yep alright guys thank you for
tuning in and we will be back next week
all right ciao this video has been a
meteor club production you can find out
more information about media club and
join the mailing list by clicking on the
meteor club button below if you enjoyed
this video you can also hit the
subscribe button below
get more content like this thanks for
watching</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>