<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Building a Meteor.js mobile app with Cordova, MongoDB, and Ratchet | Coder Coacher - Coaching Coders</title><meta content="Building a Meteor.js mobile app with Cordova, MongoDB, and Ratchet - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Josh-Owens/">Josh Owens</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Building a Meteor.js mobile app with Cordova, MongoDB, and Ratchet</b></h2><h5 class="post__date">2015-01-25</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/7iqdkVwtuvg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome to another great Oh Riley
webcast hello everyone thank you for
joining us today
I'm use Mina Greco I'm with O'Reilly
Media and I will be your host for
today's webcast today folks we have Josh
Owens with us and he's going to talk to
you about building a real-time mobile
app with meteor and cordova josh is a
proprietor of crater io host of meteor
podcast and open source are that helped
create over 10 meteor packages and 40
apps in 12 months he is also the author
of testing with meteor and part of the
velocity core team helping to make test
stay more practical with meteors when
he's not writing podcasting or teaching
you can find him running the Cincinnati
media or meetup or helping people out
with meteor.js over air pair folks were
really excited to have Josh with us
today to present this webcast for you
all as we get the event started I'd like
to go over just a little housekeeping to
help you get the most out of today's
webcast first you'll want to open your
group chat widget if you haven't already
done so this is where we can interact
with each other during the event and
where you can submit your questions for
Josh we find that our audiences usually
have a lot of good knowledge to share so
we encourage you all to chat freely
during the event however if you have a
question for Josh please preface it with
a capital letter Q so we know that it's
for him and we can make sure we see it
for Q&amp;amp;A you can also open move and
resize any of the other widgets if you'd
like to tweet from the Twitter widget
today you might need to give it
permission to access your account the
Twitter widget will automatically append
the events hashtag to your tweet so you
don't have to and today folks our
hashtag is meteor jf all one word if you
have any trouble with the event please
take a look at your help widget if you
continue to have trouble just post it in
the group chat and one of our staff will
help you right away we would like to let
you all know that we are recording
today's webcast and we will have the
recording ready usually within 48 hours
and folks at this time it is my pleasure
to turn the program over to Josh for his
presentation hello Josh hello thanks uh
thanks everyone for tuning in today just
one quick note I actually stopped killed
off the testing with meteor book and
merged that with Sam Petter ohms and
he's writing a book now so not doing
that one anymore but I'm excited this is
going to be a crazy ride when I try to
build an app
in 60 minutes we'll see how far we get
there's gonna I'm going to throw a lot
at you so if you're not familiar with
JavaScript or HTML or anything like that
you know this may seem like like a lot
but feel free to ask questions and the
group chat as we're going along I don't
know if I'll be able to keep an eye on
it just given our our time limit but
I'll definitely take some questions at
the end so real quick Who am I
these are the places you can find me on
Twitter and github if you want you can
join if you go to media jazz club I try
to send out a weekly newsletter talked
about blog posts and other events that
I'm doing I do like a monthly Q&amp;amp;A where
i answer questions about meteor and i
have guests on and that kind of thing so
excuse me that's always fun and then we
do a weekly podcast meteor podcast and I
also run crater dot IO which is where
you can find all the kind of latest news
going on about meteor all right so what
is meteor meteor is a platform that's
been built specifically for building
real time applications and now they
they've added in this component for
doing easy mobile applications using
Cordova so they've got kind of like a
first level integration with Cordova and
exam realizing I should have put this in
my slides maybe I can just share my
screen real quick I've got a fun
infographic here that I made wait for
that to go throw up and so you can kind
of see what what meteor is here so we'll
be using kind of in the center there the
command line and that's where you know
you type meteor run and it's it's got
some libraries that have been glued
together you know it's got its its build
system
and let's get the atmosphere integrated
which is meteors packaging system it's
got cordova integration so you can pull
in cordova packages
it's got MTM integration so we could use
that if we wanted to and then from there
it'll actually spit out it runs node and
it will spit out a meteor app which then
runs and on the server side it uses
nodejs with fibers and futures kind of
built into it and then they've got Mongo
DB and they've got some other libraries
in there as well so like live query
which watches Mongo DB and streams of
states to to the front-end and then over
here on the on the left hand side you've
got the client side of things and when
you when you hit that URL of the running
node app it'll serve up the client and
it's got a bunch of libraries and
there's such as blaze which is similar
to react Jas it's got space bars which
is the templating system is based on
handlebars
and then they've got some other stuff
like mini Mongo and tractor which makes
everything reactive on the on the client
and then everything is just kind of
communicated via DDP that they've
extended JSON they call it a JSON to add
some some new data types I think most of
it is around date but then you can also
extend that even further if you needed
to but it handles the serialization and
then pushes everything back and forth
over DDP and the great thing is it's
able to detect which version of the code
you're running so if I deployed a new
version it has this hot code reload so
it'll it'll refresh the page and you'll
be able to to like they'll get the
latest code automatically so that's
that's a pretty awesome feature as well
umm someone asked if there's any AM eyes
built for this yet I would say most
likely I've mostly done my hosting on
let's see karoku I've done they're on
digital ocean which is pretty easy using
meteor up and then I've also done
modulus they're a great one they've got
great support and just kind of works out
of the box so alright C go back to the
slides here
we go some of the other libraries that
we're going to use today I'm going to
use leaflet underscore it's really
considered part of meteor but I didn't
want to highlight it because it might be
new to some people and then ratchet and
I've got some examples of those we'll
look at that the websites real quick
before we dive into deep and then so the
goal is to use those libraries use
meteor and we want to create an easy
kind of Urban Spoon knock off like
that's that's the direction we're
heading we're not going to get there but
you know it'll it'll use your location
it'll hit a Google API we'll be able to
pull down some information and put that
all on a map so we're going to be using
Mongo we're going to use their 2d query
stuff for finding things in a location
using a box query and then at the very
tail end we'll take a look at the
Cordova integration it's pretty easy so
you know it should should only take five
minutes hopefully and we'll get all that
working you'll see you know what kind of
impact crater can have one on your
development all right so now it's time
to share my screen again and we'll get
into some live code
if you let to catch up so I just want to
make sure can people read my text just a
quick yes or no on the chat I can bump
it again if we need to but this is a
maybe a comfortable size all right
lots of yes good we'll get going so
we're going to make we're going to make
one called city forks so I just did a
medium create city forks will come in
here so I usually make directories
there's some special directories that
you can have such as public client
server so any code that sits in the root
of the application or doesn't sit in the
client or server folder will go to both
environments any code that sits in
client will only be served to the client
may code that's it the server will just
fit in the will only be sent to the
server directory so anytime you need to
do things that are secure you do it in
the server directory usually make a
collections folder there's a special
folder called Lib that you can add that
always gets loaded first anything in
there no I don't use scaffolding someone
asked if there's scaffolding there is a
tool called e/m which I'll help you with
scaffolding if you want so by default
you just get these three files CSS HTML
and J's file and they're pretty basic I
think it gives you like a click counter
by default can't quite see we're doing
meteor run and that's all we need to do
to get it started so we're running on
port 3000 reload so there's a little put
counter you get by default also this is
what we're going for in our application
this is the kind of a final version I'm
trying to end with today just so people
can see
so you just roll around things pop up
alright I'm going to kill off these
files they gave us but there were files
that we did get that we are keeping so
if you look there's a dot meteor folder
and you can see there's a tree here if I
use tree here and you can see there's a
lot of stuff going on down here so this
is really what I was hoping to get at
the ones we care about our packages that
shows you what you have installed
platforms this will change will add
cordova to this later so we'll get an
iOS package or platform I mean release
shows you what version you're running
and then versions is kind of like if
you're familiar with Ruby this is like a
chimp pop out lock just make sure that
you're locked to the version that I'm
locked in the same version that you're
locked to if you were to pull just pull
this down that kind of stuff so all
right what is a map extension good
question I don't I'm not sure that I
understand the phrasing exactly but
we'll be using a mapping library so I'll
show you some of these libraries real
quick first if you want
I would suggest checking out the meteor
docks just docks top meteor comm and you
can read the basic docks but I usually
just go to full API great great resource
they do a pretty job there this is
underscore this is a library that I
mentioned that we'll be using as well it
gives you a bunch of ruby esque array
and object handlers for iterating over
things and that kind of stuff so that's
always nice and
leaflet this is the the mapping library
that we'll be using which gives us kind
of this drag-and-drop ability gives us
the pin all that kind of stuff and then
guess I forgot to pull up ratchet so
ratchet is just a CSS framework similar
bootstrap but directed more at mobile
platforms so you can see the components
here they've got like a title bar and
different things up top so this looks a
little more fun like I would say this is
probably for iOS like if you're looking
for something else something that that's
within the two platforms you can always
use the ionic there's a good project
called meteoric I didn't have time to
really investigate it for this but this
also works for they're doing this kind
of stuff so alright so we need to add
some packages I know we want iron router
that's going to catch the URLs from the
browser for us and we'll we'll be able
to to route that appropriately into the
right things let's see we also want you
we can bring ratchet in through the
packaging system I guess there's a good
time to show you the packaging system
looks like
this is atmosphere these are all
different packages here these are
trending which means that there's some
seems to be some activity going on some
downloads that kind of stuff or updates
these are the most recently updated
packages and then these are the most
popular packages and you'll notice some
have clean and some don't
these are core packages and these are
user added packages
let's see we'll go back and see which
package you want a couple ratchet
packages so on make sure I grab the
right one
maybe temperamental today of course
there we go so get the package all right
and now we also want to add the HTTP
package this is a core package and it
basically allows us to make HTTP calls
to remote servers so we can do some API
fetching work with this this package as
well and then the other thing that I
like to do is just that will remove auto
because I do want to show off what what
the recall that pub/sub looks like so
the the back end communicates with the
front end over a DDP and it does it
through publishing subscribed system so
by default auto publish and it just
takes the entire Mongo database and
pushes it down to the client but I don't
want to do that so I kind of show you
what what the other way looks like um
but while we're doing it we can do a
meteor add code oh wow location pack so
this is going to pull this from if
you're not familiar plugins plugins that
Cordova dial and you can pull in any
package from here and I'll kind of get
this isomorphic JavaScript code
basically that'll it'll detect the right
platform and do the right thing for you
so you can see that down here at the
bottom there's a Cordova geolocation and
that's the one that we've grabbed
alright so we're
to actually start writing some cool here
guess we'll start with let's see I
usually do like client views do like a
little each you know
and what meteor just uses a template so
like I said it's called space bars it
was based on handlebars and they toss
into its own thing to make it work
better with blaze and make it reactive
and that kind of thing so but if you're
looking like that that you can pretty
much use the handlebar docks and iron
router I think is heavily influenced by
Ruby and rails so we just have a yield
here for the main section and then we
can add a yield for the footer as well
so if we wanted to put something there
we could on the header will actually
make just a quick little view pour it
client views edit on HTML so we just
make another template here and that's
all that we're doing is we're telling it
to a little that greater than sign we're
telling it to render a template right
there for us or we're calling like this
is a helper right here that we're
calling the line 5 on the Left we'll
just make one named header
and then what do we want so this is
gonna be some ratchet stuff going on
here header equals bar - now right h1
tag in here the classic title and you
call it city forks yeah I think that's
about it so save that guy we need to get
our router going on so I always put this
in Lib this ensures this will get loaded
first I like to make sure I write header
files always in place and so there's
great docs a guide for iron router on
github github also I don't know if you
can kind of monitor the questions you
guys mean and just let me know when
we're having them because I can't see
the window now I'm gonna break in and
ask this question okay so we do have a
couple questions here one's from
Christopher will you prefer seeing this
project on github so that we can review
the code absolutely so if you just go to
github.com slash meteor clubs are shitty
Forks will probably end up with six or
seven Commission today and that's where
the code will be so good point
that's just a better there you know if
you do have a question for Josh as he's
going through the life code here open
that group chat widget type it and send
it in and we'll take as videos we have
time for as well on Twitter we're using
meteor J s as the hashtag and we're
monitoring that so you can send
questions in there too
we'll turn it back to you now Josh thank
you sure all right yeah so these are the
docs again he's got a great guide here
totally totally worth looking over as
you're getting started I think there's a
lot to absorb right here but he's got
some example projects that you can look
through I always recommend like looking
at others others code I think it's a
great way to take a look at things
there's fontsize there there we go
all right so runner dr. figure and we
need to tolerate the layout template
that we want to use everywhere so this
um this just takes a JavaScript object
layout template one of the things we
want to say it and we'll just tell it
app layout that should get that going
and then we just want to route so we'll
catch the slash route we'll run a
function here and we'll tell it to
render the home template
thank to Neeta
I'm gonna put this here for now I don't
will pry delete this now we'll make a
client views home.html good template and
then you just need to put a Content
wrapper in here class equals content now
we'll put a div in here an idea of map
and this is what our Maps gonna go a
little page map and we'll just set the
style height 100% that seemed to fix fix
it for most browsers so that the map
took up the whole thing just close I do
we should be good we've got a bar there
we crashed unexpected token on line nine
oh just the parentheses so we'll just
say I'm doing this in JavaScript so
hopefully everyone can appreciate that
I'm a CoffeeScript guy my heart but I
knew most people would probably be more
familiar with JavaScript so all right
this is what we want to see at this
point we've got our top bar here if we
inspect we should see an empty div we do
so we're good there and now what we want
to do is pull in the leaflet source
we'll put that into our app layout here
so they offer their libraries over CN so
just pull it now
so meteor does a good job too
I try to keep this at the app layout
because I feel like it's it's kind of
part of that but you can put this head
stuff kind of anywhere and it'll it'll
figure it out and put it into the header
for so if we go look now we should see
this
Lincoln script call up in the header
somewhere in here yeah
oh I gotta save the file silly me
keep going down the end I would think
yeah there we go so there's the link and
there's the script give you a bump bump
in there so you can see these guys right
here beside this wonderful put this one
over here alright so I'm gonna go ahead
and we'll make this our first commit
point we don't even have a git repo so
I'm just gonna add everything here grab
the URL
I dunno let's set you all right there's
our first commit so now what we can do
is we'll get the location stuff working
off of Cordoba and and then maybe look
at the map at it as well so I just put
this in the root folder quarter yes um
we're going to put some functions in
here basically when the client starts
we're going to want to remove Ron want
to run the cordova code and the way we
do that is by wrapping in in a meteor
storm well again I would take a look at
the docs in Java oh here we go I just
moved in there's a train coming by sorry
that's wrong so the call is a navigator
dot geo location dot get crimped let's
just then you just give it a call
to exit Oh Oh we'll have a call a
success callback here
and I will make a quick call back
that'll take that it'll get a position
I'm gonna call back and then we're gonna
use session which is different than
maybe the notion of a session on other
platforms this is something that is
stored on your client it's more related
to the UI and it's going to be something
that's kind of global and so this is
this does not survive a page reload so
unlike a session say in rails land or
somewhere else that session is actually
cooki on your machine this is actually
just stored in memory and would get
wiped out anytime that you're you know
doing a page reload or something if you
need it to survive a page reload there
are some libraries that you can add like
session amplify there's actually some
now that you can install and they use a
local storage and they'll store that
session storage for you
so we'll just save the location variable
and we'll just save the entire position
object in there so now thank you
session not get location you can see
we've got something there so what I'll
do I'll go ahead and we'll clear this
permission oops
we'll reload you can see session not get
location is undefined now and but I've
been prompted up here if I want to use
once you allow this website to use the
computer location so if I say allow now
when we come back you can see
we've got this location stored and if we
drill down into the coordinates we can
see the latitude longitude please don't
fire miss look at my latitude and
longitude all right let's see any
questions so we'll keep going so
actually I think the direction we'll go
will take we'll do the back end real
quick and we'll start grabbing some
locations and put them into our database
so if you're not for that I use
something called Robo Mongo it allows
you to connect to a local Mongo database
you can see we really have nothing here
yet we would see a meteor right here and
it would house our collections with all
the documents if we had anything yet but
we don't I'm full but on that real quick
just another quick thing to know when
you start meteor by default it starts on
port 3000 that means that started sewing
the instance of Mongo it's a running
version it's going to start 142 on port
3000 and one and that that version is
going to be specific to this meteor app
so anytime you start this meteor app
that database is going to start on
whatever port you ran on plus 1 so we're
connecting to port 3000 1 here all right
so earlier I made that collections
folder we're going to make a dot J s and
we're going to make a collection yeah
so we'll just store this on the window
here and we just just call a new Mongo
collection and you give it a name and
this is the name that it's going to use
to store things in the Mongo collection
on the server so we'll do that and then
I usually keep my meteor methods here as
well unless there's security concerns
methods are kind of like a remote
procedure call way to interact with the
server so you can either send data back
and forth through DDP or through
collections or through methods are kind
of the two ways to do it there through
pub/sub I guess I should say or through
methods and since we're touching a bunch
of stuff I want to use a method will
just say fetch nearby locations and
we'll have it take some coordinates and
see yeah it should be about it so I
could this this whole thing could
logically be moved to the server who
wanted to do only want some of this to
run on the server but I don't think
there's really any security concerns
here so we'll just keep it here for now
I think logically when people come to
look for stuff this is where they're
going to take a look to try to find it
so I like to think about what the
obvious place is for that kind of thing
and so this is where we're going to do
our call to the Google API we're going
to use Google Local to find food based
locations around us and so
say this off is a request we'll make a
get request and I'm gonna paste in this
URL because I want to make sure I get it
right
it's got a key and everything in it so
we'll just walk through this Google's
got great Doc's as well but I'm just
doing nearby search we give it the
location you just give it the latitude
and longitude the comma in between
really give it a radius I set it to 500
I assume that's miles I didn't even look
but that I think I let me get a like 10
results anyway get to paginate through
the results if you want to get more and
then we six types equals food and then
we give it a key here and that's just
the key that I've set up for this demo
and then what we want to do is use
underscore and we're going to loop over
these results from the request
it's just request dot data dot resolves
each function on the function here and
it's going to get a place
and what we're going to want to do is
just pull up cert into the database long
ago did it cool here we'll do an up
shoot there I'm tracking that this may
be cleaning to say maybe Google ID you
know cleaner to look at it and also
place that ID so that's going to be the
ID that schools giving us back on their
API key therefore that location then
we'll go ahead and use dollar sign set
so if you're not familiar Mongo has some
great Doc's as well but dollar sign set
just basically says don't just add two
things don't like completely override
the entire records so please so we'll
press in the entire place there the
other thing that we want to do we're
going to go through extend the place and
we want to add on basically a 2d point
in the format that Mongo is going to
want it so they've got some great
documentation on that as well but
basically we need to and this is this
was weird to me I've always hinted
latitude and longitude but for the 2d
point and Mongo they want longitude and
then latitude so we need to to lunge
this up a little bit
yeah we need to give it a type no it's a
point let me give it some coordinates
and this is just an array again
it's longitude first and then latitude
so place that on the tree location dot
LNG this is just coming back from the
API here so I'm just traversing down
with the hand it back on the tree all
right
and so what we want to do is on that
success call go back over here to the
khludova yes right here we can just add
a meteor call that's nearby locations
and then we need to pass in the
coordinates that we want
yeah position that chords what we want
put a debugger here so you guys can kind
of see what this looks like if you're
not familiar you can just say debugger
right here and in your code and then if
you're in the chrome console it'll
actually pause on that oops some code
and let's go I'm going to see somewhere
we
gosh this is the downside of live coding
to the line for your bias miss stone oh
yeah good call
definitely misspelled but not the one
hole looking Courtney alright well I'm
just gonna tell you what I want to spend
time figuring out when I'm missing
something so just copying pasting code
name
yeah that'll sleep that'll load yeah so
you can see the debugger stop right
there so positioned up chords just gives
us access to the latitude and longitude
in the accuracy we're not going to use
the accuracy but if we wanted to we
could keep that now we reload this guy
you can see we've got a meteor database
collections places and now we've got ten
places in the database so you can see
this is uh maybe quarter of a mile for
my notes if that gage cafe and so if we
had the mapping working these points
would start showing on a map just to
give you an idea of what maybe these
results look like an easy thing you can
do is just console dot log results
you'll spit out over here let's get past
that and so you can see you get a lot of
stuff back but I've done the work to
just figure out kind of what we want to
grab at up here basically these results
which contains each location object for
us so and then I'm just shoving the
majority of that end of the database so
we could lick the vicinity here shows us
the actual address versus the latitude
and longitude if we wanted to we could
probably get photos working you can see
it's open now the weekday text isn't
there but eat a lot of stuff geometry
a big thing though is this guy right
here the location so what we want to do
this is a good breaking point now we
have some working code yeah she want to
add our collections and we put over stop
sign up all right now one real quick
thing is we want to put an index and an
index.js file we want to add the index
here or picking up that it's a 2d point
so we can do a search on it
and so basically because there's an
underscore in front of this method over
here places dot underscore insure index
this is kind of a private meteor method
I think it just kind of lacked
documentation before 100 came out and so
they didn't they didn't make it public
it's really the only thing I talked to
some of the core people and they said it
just just got missed before launch so
but basically we're just telling it to
create a 2d sphere index using local
coordinates which we've saved into the
database here and when we save this the
server will restart and that index will
run and if we look here we've got this
local coordinates underscore cheating
sphere a way to pull out you can take it
cuz here I'll show you those indexes if
you want to dig into a more to tell you
much more all right so now we'll make a
quick publication I usually just have a
publication digest folder that's when I
get started with things and we just need
to make a function here call meteor dot
flesch when you give it a name let's say
nearby places chain take some chords
here
I'll just go call places not fine and
let me find exact syntax but basically
we're going to do a box a Geo within box
search I'll just go ahead and paste this
guy in
so
we just say we're telling it we're
searching on the look the local field
the one we added the in-depth on the geo
within tells it we want to do a geo
search and then box tells it we want to
find anything that's inside of a map box
that we're going to give it and you just
have to give it the bottom left in the
top right and then it'll find all the
points in between there you can also do
a circle search with the radius or you
can do I think that's that would be the
center point search and there's another
one as well so you can look that up if
you want and the other thing we want to
do here is check to make sure we have a
bottom left and great because I changed
my signature on my nothing here so the
chords will take right you know we'll
just return an empty array if we don't
get those guys let's see maybe missing
parentheses here
yes
no we should take that to photograph
let's give up my nerves all right now I
think we're ready to go to find the
 call
no we need to do get back Maya your
client views home we'll make a home yes
and so whenever you're working with a
template you get some methods and and
callbacks that you can add to them so we
use the render to callback which is just
a nice way for me to run code when this
template is rendered and not only happen
when this type of this rendered so kind
of ensures that we're only going to run
this code when we first put the home
template in and then what we want to do
is we'll start working with our map and
so we just track our auto run they this
will rerun this block of code any time
something changes inside of it but
basically we're wanting it to key off of
our session location we're wanting to
make this rerun anytime the location
changes so we'll take a look for our
session location because we don't want
to add a map unless we have a location
and if we do have a location what we
want to do is set up a map the paces
code in as well but basically I'm
going to save off the latitude and
longitude there you go and then we're
going to sew line four or five we're
just setting up some variables save
myself a little piping down the road and
then line six here we're going to create
the map object and L is for leaflet so
we're just going to tell leaflet we want
to map we want it to map - the map ID we
want to set the center of the view to
the latitude and longitude and then the
comma 13 is for how much we want to zoom
in
I actually think maybe 15 is better so
to see what that look like I'll keep my
invitations right to get a map it's sort
of not really we get our location oh
we're gonna give it some titles so this
is the one thing that's weird about
leaflet you don't get any tiling by
default so you gotta kind of add your
own this is the one that given the
example but basically I think this is
OpenStreetMaps
and we're just gonna add those to it so
we can actually see something behind it
there we go so this is uh senator
roughly on my house on right about here
you can see that the grey line that's
the railroad tracks that you keep
hearing and just so we can see maybe a
little more clearly we can control the
latitude and longitude marker right in
here
okay there we go
this is a marker right on my ass okay
and someone pointed out that you can use
all kinds of all kinds of different
tiles if someone asked about session so
it is only for data you care about on
the users kind of UI that's the
important distinction here and that's
maybe different than elsewhere it is
global for that user when they're in
that UI session so to speak
but if they hardly load the page or the
page gets refreshed for them that
session data goes away so you want to
make sure that you you say that
somewhere else all right so I'm going to
go ahead and take the monitor back out
of here and we'll start working with the
router and we can get some data
available to the front end and then we
can add some actual Mar Thursday note
that one down there all right progress
close on the hour I'm gonna go a little
over hopefully everyone can stay and
watch if not again this will be recorded
and probably be up in the next two to
three X that's late convert this syntax
we don't need to call Andrew here
actually so we can use this wait on and
it's just a function call and we wanted
to return we're going to call meteor dot
subscribe so this is the other side of
the publication with the driver here and
we're going to take this out maybe it'll
be a little easier to read
so just call me you're not subscribe
when we tell it the name of the
publication you're by places near me I
would I call it oh my God my places yeah
and what we want to do is give it these
more sessions animals to track the
positioning of the map and so we'll use
bottom left and top right and pass those
guys in as well so there's that and then
what we want to do is make that
available as the data in our template so
we'll just return places dot find and
this just means anytime that I'm in the
template I can just expect any data that
I find is going to be in a way of places
essentially and I'll show you we use
that in just a second start adding the
markers oh it it's about it and so the
nice thing is since we're using this
session variable right here this
subscription anytime our bottom left and
top right change because the session
variables changed this subscription is
going to know that the calculation is
different it's going to Reese obscure
and get the correct data plus so we can
kind of watch what that looks like as
well it's kind of a fun thing
oops rather unexpected token
Phunk shank that's why where did this
back there we go didn't need all that
jazz before all right and so what you
can do is if you go to the network tab
in chrome you've got these things across
the top here it shows you everything if
you don't see this this view right away
just to open the network tab and then
refresh your browser and you'll get all
these things populating in here we just
go over here to WebSockets it's one of
these last horns you're just filtering
down this list and we just want to see
the WebSocket and so you can actually
see how meteor is talking back and forth
so there's a lot of interesting stuff in
here you can see like this is what it's
doing kind of the version and it's doing
an auto update so it's got like an ID on
it and it's able to calculate see which
version of the code I'm running you can
also see we made this call to subscribe
to get data back the nearby places that
that we had created and so the green is
the client sending stuff and then the
white is the server sending stuff back
and so you can see we're getting some a
lot of update data back but then we're
not we're not really getting anything
else back yet so we need to set our
bottom left and our top right right
so we can do that back over an hour
rendered call over here we'll just keep
building on this guy oh yeah there we go
so basically we will just call Matthew
pounds and that's just a leaflet call
and it's going to give us the
information back that we want sort of
give us a bounds object which has a
southwest and northeast corners and we
can grab the latitude longitude out of
there I'm going to set those to the
bottom left to top right and you should
start having some data flow in now when
I do know places don't find fish we
start objects back so these are objects
around me
so there's Gabby's cafe and you can see
so this is probably worth noting too so
when I call a place is duck blinds you
get what they call it cursor back so we
haven't actually like fetched anything
from the database we've just kind of
started to create a query that can be
built upon similar to all there's a
pattern this is still two after
yeah I don't live in pattern right now
the top of my head so kayak there's no
controller or scope like an angular so
you this is probably unintended like
outside of the scope of this
demonstration but yeah you can you can
use either a router to create your
controllers and kind of Kindle
inheritance that way if you want to do
that kind of thing if you're talking in
the sense of like Rails controllers you
know setting up your data and that kind
of stuff that's that's what that iron
iron router bit was over here wait on in
the data so we're just setting the data
up for our template so this would be the
equivalent of a controller alright
and so now we've got the data what we
want to do is loop over it and put the
markers on the map so I'm going to paste
this code and we'll talk through this as
well basically I'm looking to make sure
that we have a template instance and if
we do then we want to make sure today I
guess I should be looking for data there
data and if we do have some data we want
to use this special for each method this
is something we get from meteor it works
in particular with cursors and it'll
loop over the cursor and give us an
actual object in its place and so we
want the place object what we're gonna
do is we'll go through and add this LDAP
marker which is just adding a leaflet
marker we'll give it the information
that we want and we'll just add that
straight to the map and then we combine
the pop up to it these will clean it out
way and it's just HTML here and so we'll
make the name bolded and then we'll have
a separator and then we'll add the
vicinity which should give us the rough
address that we get back so we come back
you see we start to get these these
populated markers and I really do live
in a place where you don't want to cross
on this side of the railroad track so I
wouldn't recommend eating at these
places but this place is quite good you
can see now it's a Gabi's cafe and some
of my house is here pretty quick walk
over there for lunch right um so that's
the majority of it a little I wanted to
show off a little
Gloria activity as well and then we'll
do the Cordova part and then write this
thing know what questions so I was
hoping we could get into some event map
stuff but sadly they don't bubble the
events for leaflet through the Dom
correctly and so I couldn't attach to
those but if using something like it's
always fun like a bootstrap and the
modal window you can actually catch like
when someone closes the Dom the modal
Dom with the X button or something like
you can catch that hidden event that
fires hidden dot modal or whatever it's
called and and run appropriate code but
unfortunately leaflet was not that way
so what we need to do is we'll make our
own little event binding in here and
this is this is a little different I
will say then
how you would normally do some media
code let's see
oops why aren't you guys going in
alright so whenever we move the map
around it's going to fire this move end
event what we want to do we're going to
get an event here we want to fire the
event target I really want to fire get
founds on the event target so basically
it's just a map object again we're going
to call get balance we're going to get
back exactly what we wanted before for
the bottom left and top right and then
we're also going to want to get the
center latitude and longitude and we're
going to update our location should be
here and then we're going to call fetch
nearby locations again so basically I
just want it to auto populate based on
where I'm dragging the map around and
this is where you can kind of see the
reactivity come into play so we'll zoom
out a little bit I'll move the map over
here missed a guy somewhere I stand that
guy
this guy's extra
so come over here there we go now we're
getting some some places showing up on
the map come up here there's a ton of
places to eat right up here places the
grocery shop that kind of thing so you
can see like as we move around it's
fetching new places on Google and then
adding it the only thing I didn't have
time to work on last night or this week
was getting rid of the flashing they're
seeing so it's actually rear end during
the entire map give and then putting
putting that the map back in there when
that's happening alright so that was a
marathon bit of code there so we we
added a router and got it up-to-date
with the weight on with the pub/sub and
then we added the the data which is
returning the places and since we're
doing a search on the server side we
don't really need to do the search again
on the client side so I'm just calling
places don't find but yeah I you know I
mean basically if if I had two
subscriptions that were populating the
places namespace then it might be better
to to actually scope that query
correctly but I actually don't know if
the client side goes to the search I
should look into that it's just one
JavaScript we wrote they're markers
working
push that guy up so we just do a meteor
ad platform I have less it's gonna get
the appropriate stuff put in place for
us I already have it's worth noting I've
already installed Xcode that already are
all works so like big caveat like that's
the thing you need to do if you want to
get this working and then we can come
over here you can see it it's shut down
the platform it's shut down the meteor
we had running and I think we just say
meteor run iOS and what will happen
behind the scenes it's going to start
building our Cordova app and actually I
haven't tested this code since I added
the map moving around so hopefully it
still works but it's going to grab all
the necessary Cordova stuff and it's
going to fire up the simulator for us so
it's it's building the Cordova half
firing that in the iOS simulator and
then it fires the localhost version to
the web app and so if we refresh here we
still get the web app and then if we
come over here I've got an iOS simulator
and then asks if I would if I want to
allow city Forks to access my location
I'll say allow let's see this was
working at some point so Dubai before a
Swiss chard father no I don't get it I
gotta restart it um location
I can't give up my religion I guess I
could custom let's close that down again
so we can just rerun this family fire
the iOS
and so this is a custom Cordova loading
screen that meteor made but you can
replace this iOS simulator is not always
reliable
haha
yes so someone didn't note that the iOS
will only work on a Mac OS X Box so you
need to either build a hackintosh like
someone suggested or B on a Mac in order
to do the Xcode stuff but the Android
stuff should mostly work I think there's
some libraries you need to install ahead
of time but then you should just she'll
be able to just add the platform and run
and it should get going as well we'll
give it over try here iOS simulator me
now there we go look at that places to
eat around Apple right now click this
guy cafe max if we're in there there's
BJ's I've been to that one that I'm good
let's loosen up a little
there's a street cafe pretty awesome
oops interesting it's resetting our zoom
level yeah so I mean it'll take a little
bit more work to to get rid of that
flashing but you know once once we do it
it'll be I think it'll be pretty awesome
so I guess that's about it for the
presentation I'd love to take some
questions now and real quick before we
get to that part if you want to learn
some more stuff about meteor in
particular you can go to my blog Josh
Owen stop me or like I said you can go
sign up for meteor jazz club there's a
little thing there that'll get you on
the mailing list on the front page I've
been working a little email course that
will walk you through
some homework and documentation and
other people's codes and encourage you
like I'll give you snippets of code to
build and at the end you'll build kind
of a complete working app you can go to
crater you can listen to the meteor
podcast that's like all my stuff and
then another great blog is the discover
meteor blog they've got a great book as
well so just discover meteor calm is
great and then they've got a little
manual on the meteor website as well but
yeah so just definitely check out all
that stuff all right so like we've got
some questions here the search for the
places at the server side will it be
unique to each client yes so each time
the client connects it'll run that
search but the places that get inserted
in the database are not unique per
client so we're essentially building a
huge database of places that anyone
could pull from and so at some point
what you would more likely do is look to
see if you have places and then maybe
run that query if you're not returning
any places and then maybe you know in
the backend you could start tracking
those queries and synchronizing or
radius around them and all kinds of fun
stuff but probably again like outside of
the scope of the hour and 20 minutes we
got this build think about testing yes
testings great it's still pretty new and
meteor land I would say if you're
interested in it you can take a look at
velocity is the name of the framework
runner and then you know you've got
mocha web you've got jasmine there's now
a cucumber package I think there's a
Night Watch lynnium package I'm not sure
where that was that but I've been
playing with cucumber lately so yeah
it's definitely a thing you could do
again given the tight scope of the time
for
I definitely didn't didn't bring that in
here how does the app and Mongo part
work when making an iOS app also can an
iOS app talked to a remote Mongo server
so great question didn't really talk
about that too much but basically what's
happening with the court over there
maybe I can bring up the infographic
again be easier to explain that
basically the we're using the web a
mobile Cordova web view UI to achieve
what you're seeing we're able to hook
into the api's that we want to hook into
but we're you know we're we're just
using a web UI view which essentially
means that we're using WebSockets so
this this gray arrow down here that's
unlabeled this is the kind of the
WebSocket or I guess the purple arrow
that says EJ SONET DDP that actually
works for both the web and the mobile
just didn't think it would look very
clean to bring that arrow to both files
maybe worthiness so you know we're
actually like that Iowa's emulator
running the app is connecting back to
localhost 3000 and so when you're ready
you make you give it some environment
variables when you're going to build the
actual app you want to submit to Apple
you give it the environment variable of
the production site and it'll actually
be using that for its data so you can
actually like creates like a staging
version and compile that and hand it out
to everybody if you want to make all
kinds of interesting things you can do
there let me scroll down um another
question just policing or nod requested
your name right so if I didn't
placing the header tag somewhere in a
file for me to figure it out will that
affect the page load speed no it won't
necessarily affect the build
I mean amazed no I don't think it
affects the build speed too much it will
affect the page load speed though just
because you're adding more libraries for
the browser to load so therefore like
I've told it to load two more files but
the the build I think that all that gets
figured out at a little time so it's not
really not really going to slow you down
there all right any good resources for
web RTC meteor integration not familiar
with what web RTC is but I know that
there are a lot of people working on DDP
stuff I've I've definitely seen people I
know there's an objective DDP client so
if you want to make a native app you
totally can and I've known some people
that have done that I know someone
that's created in the lick sir DDP
back-end so you can subscribe to an
elixir remote rather than like a node
remote and there's I know there's a ruby
library as well so if you want to like
get your data and put it into my sequel
and front it with Ruby you can use the
the Ruby DDP library and you could start
feeding data to immediate out that way
as well so lots and lots of options
there I actually have known of a guy
that is working on a project with an
electron microscope and they just use
the DDP protocol and they were able to
communicate with it and they're able to
like control the electron microscope and
send the images back to the meteor so
kind of awesome um let's see could you
sell me on meteor versus other
frameworks why this versus other app
development environments
the benefits beyond others so I would I
would actually invite you to look at my
blog I've got a post and this is um it's
just what is a meteor je s now this is
Williams question I'm answering give
that a read and it'll sell you maybe a
little bit I don't want to sell you too
much like it's either interesting you'll
play with it or you're not I don't
definitely not a hard sell kind of guy
but I think you know it's kind of the
old bowls of total there this is how
much surely you'll have to eat to get
all your minerals you know here's all
the libraries that you're going to have
to glue together to kind of get the same
thing that you just saw going on behind
the scenes so definitely something to
think about real time client yeah I
don't know
so William updated and said real time
client is for a like audio and video
chat I haven't done anything with that
I'm not sure I know I think some people
have played with it but I I wouldn't
know where point you for that right now
so maybe maybe tweet at me and later
tonight I can dig into that question
about web RTC so Eiland asked I missed
the beginning did you add Cordova as a
package isn't it part of meteor already
I did not add Cordova as a package it is
part of it the only thing I added was
the geolocation package from Cordova and
then at the very end we just did a
meteor ad platform iOS to get the
necessary files installed to get iOS
working so yeah nothing specific to
getting Cordova installed just just a
geolocation stuff all right
like that's all the questions we had
all right Josh I'm not seeing any
additional ones either so with that
folks we're going to say a really big
thank you to you Josh for spending your
time with us today after presenting an
incredible webcast for today thank you
so much sure not pressure folks that
attended today's webcast we thank you
for attending and also a big thank you
to those of you that stayed up late or
got up early because we had so many
people from all over the world today we
really appreciate your time as well lots
of questions asking if we're going to
have a follow-up webcast this is the
folks I was Josh offline so stay tuned
we will let you all know and also a lot
of people asking if we recorded your
webcast today Josh and the answer is yes
we did folks we will have the recording
ready in about 48 hours we will send all
of you an email with access details as
soon as it's ready so that is definitely
in the works so with that yeah again
thank you Josh thank you everyone this
will conclude our webcast today goodbye
everybody
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>