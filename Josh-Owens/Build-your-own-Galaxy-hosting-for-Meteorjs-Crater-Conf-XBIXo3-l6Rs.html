<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Build your own Galaxy hosting for Meteor.js - Crater Conf | Coder Coacher - Coaching Coders</title><meta content="Build your own Galaxy hosting for Meteor.js - Crater Conf - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Josh-Owens/">Josh Owens</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Build your own Galaxy hosting for Meteor.js - Crater Conf</b></h2><h5 class="post__date">2016-03-10</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/XBIXo3-l6Rs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this is a video of a talk from crater
remote cough given to a live audience in
February 2016 this video was made
possible by sponsors like modulus I oh
ok grow calm and space dojo calm if you
would like to find out more information
about upcoming conferences be sure to go
to conf crater on Io and put your email
in the form that pops up in the lower
left corner enjoy the video alright
welcome back so if you didn't catch it
there was a slight scheduling conflict
so we're supposed to have Sam hatoum
speak next about delivering high quality
features faster but he he had another
meeting that he had to do that kind of
popped up the last minute so we're gonna
see if we can actually schedule that for
maybe next week and do kind of like an
impromptu extra little talk so bonus
talk and instead I saved myself as a
backup so I gotta talk ready today on
building your own galaxy hosting setup
so let me see vine share my screen share
here we go present you know what me exit
full screen it's over so I can kind of
keep an eye on it there we go alright
can everybody see my screen okay just
let me know in the comments so all right
looks like we're good building your own
hosting setup for meteor Jas this is
we're going to be talking about like the
implications of hosting meteor and the
different tools that you can use to make
it a little more performant this isn't
so much like some kind of like fancy you
I to auto scale your your setup or
anything like that so um but we're gonna
we're going to kind of dive into the
technical guts of how I have things set
up and case you don't know who I am
these are the different places you can
find me so I've been working on I still
haven't finished it yet but
transitioning from meteor club to space
dojo and obviously i renamed the meteor
podcast to the crater podcast because we
talked about news on craters so oh yeah
that's that and then we'll actually be
talking about how crater is set up for
hosting so i think you know this this
one cracks me up someone said this in
the in the slack chat room and I was
like oh that's that's perfect and I
found this and I was like you know what
it takes a real cast of characters to
host any app right and so like meteor is
just one small piece of that in my
opinion and you know there's other
pieces you have to use and so we'll get
into like cloud front and pre-render and
Mongo and a bunch of other things and so
I thought the picture was kind of
fitting so this is a this is how crater
is set up right now and this I'll be
putting all this on a blog post as well
so you'll be able to see hopefully a
higher res version of a lot of this
stuff as well but right now you know I
did a series i did an article where I
kind of compared modulus in Heroku and
digital ocean and kind of talked about
the differences between them all and in
doing that like I actually ran crater
for a little while on each one and so it
ended up on digital ocean and oddly
enough like it's just it's just stayed
there and galaxy sounded super
interesting to me but I didn't get an
invite for quite a while and then when I
finally did get an invite my concern was
that with the 512 megabyte containers
and being limited to five that wasn't
going to be enough to host crater in its
current state and so what I did instead
has just started to slowly expand the
set up a digital ocean and so you can
see when you know when you type it in at
the top there the laptop cratered I oh
it's going to hit an engine X load
balancer and then it's going to take a
look at a bunch of different things will
get into all those different things and
if you're you know a spider or some kind
of BOTS trying to get some information
will shoot you over to pre-render which
is going to grab and it's a hosted
version of pre-render it's not like the
paid version of pre-rendered I oh so
their app is open source and you can
install it yourself if you want and so I
wanted something that lived a little
closer might be a little more performant
and so that's a 2 gigabytes over there
in digital ocean or one gigabyte I guess
um and then if you're a regular user
you'll hit the meteor servers and you
know we've got the load balancer we'll
just kind of like evenly spread out the
connected users and it does a pretty
good job we'll see some codilla
stats in a little bit you can kind of
see but and we'll get into how that is
handled as well but then you know when
you request the meteor app so if you
haven't seen this before you can do view
page source on your meteor app and
you'll see you get like just a tiny bit
of HTML some there's some JSON at the
top and then some references to some
files javascript and CSS and those files
are the compiled like versions of your
meteor app and the CSS that goes with it
and so will get into it as well but I
use cloud front for that and it
references like there's a there's a
nifty little trick that you can use a
little reference cloud front and those
files will get out there for you and you
can serve those up quickly as well which
is pretty awesome and then i use compose
on the backend and I've got the oblongs
set up its I think it's super important
to use a blog when you're hosting a
meteor app and you care about production
performance I actually had a code review
last week where I actually took a look
at the code it was great it was very
clean looked amazing they did a great
job they needed to add some index thing
to their database but the real problem
was they didn't have a plug turned on
and like they were dying with like 10 to
12 people connected and so I blog super
important if you plan to have any kind
of bigger user base and we can probably
get into that the questions too if you
want to understand that more so does
meteor scale um I I would say you know I
wrote an article about this last week I
think I put it out I think that for most
of the people here like this talk will
seem interesting to you but likely won't
be relevant because
you're not really going to have the
problem with needing to scale a meteor
app so I'm going to tell you about all
this but in reality you know you're
probably better off not hosting your own
meteor app just use a platform as a
service it's going to be the TLDR of
this but yeah I don't know I think to me
the hardest part of getting any app up
to the point where you even care about
scaling it is is really like that's a
huge marketing effort so that that's
really something that takes a lot of
work and for me like it's it's been a
lifetime learning skill figuring out how
to like convince people they should take
a look at your application or something
and that was you know if i look back i
wrote a post a couple years back I was
doing a ruby a rail startup that worked
with Twitter and you know we we spent so
much time like engineering and making
sure cos scale and doing all this stuff
and at the end of the day like we shut
it down because like we got ten people
to pay us and it was such a like big
waste of time and I look back on it like
we spend so much time on using chef and
you know trying to trying to scale as
best we could and in reality we just we
didn't need to do any of that kind of
work so that's kind of what I'm getting
at here oops too far machine is a leggy
we go okay
too far again come on all right I don't
know what's up with my machine still too
far must be a big image or something so
um the the slide here there we go so
load balancing with engine X this was
interesting right so for me I I used to
do a podcast called web pulp TV and I
talked to people about how they would
scale their applications and I try to
get insight and how all that worked
that's my dogs go nuts now um and you
know we talked about all these really
interesting tools like varnish and it's
a proxy and all these interesting things
and so you know I was sort of familiar
with some of it working on projects like
words with friends but I actually hadn't
used engine decks to do the load
balancing and one of the reasons why I
had never done that is because H a proxy
has a thing called out-of-band health
checks and the idea is like if you set
up engine X and you just use the normal
kind of proxy setup you know flip
forward a slide here if you use the
normal proxy setup here right like
upstream and I tell it to use IP hash
and I give it to servers to kind of
rotate between what happens is your
clients going to connect and without the
out-of-band health check they're going
to do an in-band he'll check which means
that you have to wait for a failure to
happen to someone before a server is
taken out of rotation and then you also
have to configure that so by default it
will still keep sending people to that
same server and so there's there's some
config you can do to make that work a
little better but you have to set out
like a timeout and a number of failures
before it gets pulled out of the pool
so instead what you can do is this out
of band health check so we're not
relying on the client to check the
health of the server but instead you can
see here every three seconds this check
call this is a module that I install in
an engine X actually goes and does a
health check and then reports back and
if a server goes down it'll pull it out
of the rotation pool and there you know
we're not dealing with hopefully anyone
getting like a 50 to return to them when
they're pulling up a page and so out of
band health check you you can get it by
default in engine X plus which is pretty
expensive or you can install the module
that was on the previous screen and that
there you go and genetics upstream check
module and it's really easy to do I all
have all the kind of how to links in the
article but you just kind of compile it
and then you just add this one line
check and it does everything that it
needs to do and it's great and so the
rise and fall is just like how many
times it has to be down before it's
pulled out of the pool and then the rise
is like how many checks does it have to
be up for before it's put back in the
pool and so you know if you want to be
like super strict you could like ratchet
these numbers down and probably catch a
down server much faster but this seems
to work for for crater anyway all right
so the other thing when it comes to
setting up engine X or any kind of proxy
in front of meteor you have to have
sticky sessions and so you know I get I
hear a lot of people they're like what's
a sticky session and why does that
matter and so a sticky session if you
think about how meteor works in regards
to query data and returning that data to
someone through DDP it keeps track of
that data that it cares about
in memory on the server and so if you
connect let's say you connect to server
a and you get some data it's sent down
to you and then all of a sudden like
your connection something between you
and server eight drops and you make a
new DDP connection and ends up on server
be all of a sudden server be is going to
see requests for that data you've
already got the data but you just
requested it again so it's going to go
fetch it it's going to resend it to you
and now you've got two servers that
think that they care about that data and
at some point hopefully serveraid drops
you know figures out that you're not
connected anymore and stops carrying
that you have that data but we've just
put essentially double the load on the
system so we want to make sure if
someone drops their connection and they
reconnect they're going to come back to
the same server and so that's what
sticky sessions are and in h a proxy
land you can set a cookie and read that
cookie as they come back in through the
proxy and then send them to the same
server again with engine X you can do
things like IP hash so basically when
you're connecting look at the ipe run a
hash algorithm against it and it's going
to choose you know server a or server be
but sit your IP doesn't really change
you should still end up going back to
serve array if you had to reconnect for
some reason so that's why sticky
sessions are super super important and
we can kind of see like as we get to
some of the Khedira graphs the other
reason you can kind of see the effects
of like increase load from you know a
bunch of people connecting all right
that's up next come on machine
geez too far again all right here we go
so this is a my little rant so for those
that haven't heard a pre-render Carl
talked about a little bit in his his
talk you mentioned it slightly or spy
durable or why you'd want to use some
kind of some kind of service that's
basically going to take your JavaScript
turn it into HTML and then deliver it
back to a bot right and so Google they
made a change back in October maybe that
they're going to start consuming
JavaScript more and more and they're
doing they're trying to do a better job
at that but in reality like they still
will come through and consume and you
could see this is an actual output of
the like the you know the the process
tree on the one of the crater servers as
it was getting slurped up by Google and
so the thing is it would detect Google
coming in and you know deep in the guts
the way spy durable works is it uses
connect inside a meteor and so when you
when it didn't connect detects that
you're one of a certain type of agent it
will instead of rendering and serving
the normal page it will fire up a fan of
jas instance hit the server get the HTML
or get the JavaScript render out the
HTML and then return that to the bot but
the problem is it's like a super naive
code here you can see like Google set a
ton of bots to the system and basically
essentially d dost the site right is
distributed denial-of-service attack by
google and there's no good solution i
know that you could go and look and see
there's there's
if you pull requests for trying to fix
some of this stuff but none of it's been
really kind of maintained or taken care
of in regards to to meteor so instead
what's what's better right now is to use
pre-render which is kind of the same
thing you detect you know that a Bach
came in and someone pointed out in the
comments that your Facebook and Twitter
and slack and all those kinds of places
when you share a link they also send the
bot to try the scrape for information
and pre-render has a server that's
running that essentially does the same
thing as phantom but they put a lot more
process around it a lot more thought and
how it works and therefore you know
they've got if you use their paid
service they've got a bunch of servers
sitting there waiting to answer and like
pull down the information and then they
cash it you know in their system and and
we kind of do a similar thing with
crater so that's why you want to use
pre-render and i just used the the
darker version of peru renderer I didn't
have to do really anything special to it
I just I use dr. to like create a
machine and then deploy this docker
image straight to it the only thing that
I did is I did set up so I've got a one
gig server but I've got two docker
instances running pre-render and they're
both limited to about 400 megabytes so
like as they start to leak a little bit
of memory they just restart themselves
and with having two of them available
it's really not that big of a deal and
I've got engine X in front of that as
well to kind of handle detecting who's
up and who's down um yeah so caching and
dealing with a pre-render upstream so I
got some of this stuff from Michael
Shulman and he's uh he's a great
resource like I just want to say thank
you to him because you know I was
talking about my struggles in the space
dojo chat room and he he mentioned that
he was using pre-render and shared his
engine X config with me and like I've
just kept building off of that and so
right now I'm just using you can see
like we just set up the pre-render
server and then I also set up this cache
path which is just file caching and I'm
telling it you know you can you can you
can save up to a gig of data and keep it
for up to 120 minutes before it's
considered inactive and will replace it
and so the the engine X config here
starts to get a little more complicated
and this again this is the load balancer
so you can see like up top i set up the
ssl stuff which is also important and
then down below where the arrows are
excuse me you can see we're detecting
what's the user agent and i kid you not
this is like that user agent list is
probably double what's an inspired
rrible right now spider-wolves not not
super great and then we're also
detecting like if they have the escaped
fragment bit on there that will mark it
for pre renderer and then you can see
down in the pre-render we tell it we
don't want to skip the cash and then we
passed that that query straight on to
the pre-render server and so this allows
us to to kind of detect and pass to a
different different area yeah now we'll
talk about the other side when not to
pre-render and so basically we're going
to detect if the agent is pre-render we
don't want to send them to pre-render
that would be an infinite loop or if
they're asking for any particular files
and
p Cory mentions in the in the comments
that you know you want to use a CDN or
something I actually think this is maybe
the special sauce that you were having a
problem with here p you know you want to
detect these files and we don't want to
send those files on to pre-render we
want to serve those files up instead so
that that's kind of important as well
and then you know if we know that it's a
real meteor client instead of a
pre-rendered client then we'll skip the
caching part and we'll send them on to
the regular meteor servers and then
anything we didn't catch by default
you'll see down at the very bottom the
bottom arrow down here the proxy pass
they'll they'll head on the crater as
well you know what I didn't do here is
we should probably like we should set
the default skip cash to one as well to
make sure we don't cash any regular
client huh yeah interesting you should
fix that um yeah and so the the skip
cash part that I'm talking about here
this is the other kind of neat thing
right this is what works with that that
previous caching that we had set up and
we we said keep it for 120 minutes and
you can keep up to get data there so
what happens is we send a request off
right and if it's a pre-render request
we're gonna we're going to say yes we do
want to cash that don't bypass the cash
and what will happen is engine X keeps a
local copy of that and the next time
someone comes in so let's say we're
getting a lot of Facebook or slack
requests or something if it's popular
then we'll have that cash already in
there and it'll serve it up and you know
milliseconds instead of having to go
through the entire render cycle so
pre-render is important and I think
caching is also important all right
so CDN is also important right and so
that was that cloud that was sitting
there in the initial diagram I showed
you and I've got a blog post on this I
think it's it's important to use a CDN
for a number of reasons and I mentioned
it towards the end of the blog post but
basically when when a when a client
connects to your site there they're only
going to make two connections per domain
right and so when you connect crater if
you have more than two files that are
coming from crater I oh and this
includes things like web sockets and all
that kind of stuff you're only going to
make those two connections and it's not
going to fetch the next thing that it
needs from that domain until one of the
previous connections finishes and so if
you think about it like a lot of the
images for like user avatars come from
Twitter as well so if we've got ten
avatars and eight of them are from
Twitter we're only going to get two at a
time until we get through all eight so
that can slow down a little bit of the
rendering on the page and you know
honestly like in doing research for the
blog post that I've got I I couldn't
find any recent talk about how this had
changed and as far as I can tell most
browsers are still set at two some of
them have bumped up to four connections
per domain but there really is like this
limit and there's I don't know if
there's specific reason for it but you
know you need to be aware of that when
you're thinking about how you're going
to deliver it and so moving to a CDN
gives you an additional to kind of um
wow totally open notification
um so so turning that on is important
anyway yeah cloud front setting it up
like using it within the media
application is actually super easy under
documented but super easy turned out all
you need to do is set this bundle j/s
CSS prefix which I use a meteor setting
for and I just put this somewhere in my
server side code and when it's booting
up it's going to set that and so if you
go look if you do a view source you'll
see you know I get this weird cloud
front URL in front of the JavaScript and
CSS files and is cloud front similar to
a commie yeah yeah they're they're both
cdns that are both content delivery
networks so it's this idea that a file
is put into the network and then you
have you know maybe 40 servers spread
across the globe and they use there's
different techniques but you can use
like DNS so I can see your DNS servers
is maybe coming out of New York City and
therefore I'll serve the file to you
from the New York City server or if
you're from India then I can serve you
the file from a server closer to India
so that's kind of the idea behind a CDN
um and so you know with meteor like this
is all you have to do and it's going to
put that prefix in place for you and so
because we're we've set all these custom
origins up in the previous slide these
slides or maybe out of order you know
it's gonna we're going to reference a
file that's not there yet in cloud front
and they're going to know hey I should
go back to crater and grab that file
directly and so it's going to ask for
the crater version of the file and it's
going to get it and then it's going to
cash it in its content delivery network
and serve that going forward and so once
the file gets out there then we don't
have to worry about like serving that up
quickly to other people like they're
going to distribute
amongst their network and the great
thing is like meteor already has as part
of this you know there but they're
bundling process they already have a
cache busting system built in so if you
look at like your your JavaScript or
your CSS file name it's going to be this
weird hash of letters and numbers and in
reality they're just there they're
running similar they're just running an
algorithm like an md5 hash to look at
the file and determine like is it the
same if it's the same you know you
should get the same file name if it's
different right because we've deployed a
new version its codes changed it's going
to change that string and now we're
going to be requesting a different file
from cloud front and so that's how they
they kind of handle that cash busting
which is which is smart that's how you
know from my days and rails that's how
things work there to love that all right
so we kind of we talked about pre-render
we talked about cloud front now the
meteor servers and so for me like I just
use plain old mop you could use them up
x for some that aren't familiar with
that that's like the next generation
docker version i actually have some app
some up and some arm up x but basically
it was just deploy a doctor eyes version
for you and i think it uses engine X for
doing the the ssl stuff mup a crater was
already on my so I really haven't
bothered to migrate it and I'm not sure
that I would see any major reason to i
actually configure all my own ssl stuff
so I was fine with that but in reality
so when you're adding a second server to
mop all you have to do is pass you know
the server is key in in your mop JSON
just pass it an array of servers and
it's going to know to connect to those
and it's gonna do it you know one at a
time and go through and deploy and you
know I think
at first I was like ah it's not good i
don't know maybe i want it like
capistrano could actually deploy if
you're not familiar with that that's a
rails deploy tool could employ it like
multiple servers all at once but you
know the more I think about it the
better we are because we get this zero
downtime kind of deployment which I'll
show you screen of in a second but you
can see here like when i type deploy its
going to bundle up and deploy to the
first server and then it's going to
bundle up and deploy it to the second
server and it happens in succession so
you know the the first server as its
employing is going to go down get the
deployment done come back up and then
the second server is going to start
going through its cycle and so your
deploys maybe a little bit slower as a
developer but it's better in the end
because we get this zero downtime deploy
and you can kind of see here in the
total sessions right like we're humming
along you can see these these lines are
almost exactly the same for the two
probably like a couple people different
this is people connecting and
disconnecting but then I started a
deploy here I didn't actually have
anything to deploy but I wanted this
nice graph so you guys could see it you
can see like the first server goes down
and it's like you know our connected
sessions drop way down here and this one
spikes up all of a sudden and then this
one drops and then they start to even
out I guess this one the blue line
probably deployed first and then the and
then the maroon line and then they start
to even out again right and so that's
the sticky session that we were talking
about before and you can see this is the
piece I was talking about earlier the
pub sub response just drastically like
shoots way up like off-the-charts when I
first looked at this chart like this was
definitely a high point but then like
this stuff like was probably yeah you
can see it's up in the forty thousand
milliseconds and basically what's
happening is we're like we're dumping
off all the users from one server to
another and
that means that we're starting to do a
bunch of queries against the same table
so our collections so we're like we're
asking for all the user information and
trying to verify that they're logged in
and then we're looking at their
connected client version and trying to
figure that out and then any
publications that they have on top of
that are getting read and so we just
have this huge influx of people coming
in and there's just like a lot that it
has to get through and it has to do it
as a single server and so I think that's
why like it's if you think about how the
node event loop works it's only able to
you know respond like there's blocking
pieces of the process and so it's got to
finish a piece before it can respond to
another piece and an event loop can be
an efficient way to do that but when we
yeah I said tables when we when we do
that like when we have a bunch of people
connecting in all at once we just have a
flood of people hitting the server and
really hitting the database and trying
to get a bunch of data out of the same
table too so like everything just kind
of slows way way down so just
interesting and then I think the other
super important piece when you're
deploying like I mentioned this earlier
you really want to use that up log
support and so I use composed and as
galaxies also does not offer any kind of
database option I just you know I
actually found that when I wrote the
original article about the different
like Heroku and modulus and digital
ocean I moved all the data to compose
and turn on/off log and that actually
made it easier to move from one service
to the other I didn't have to move any
data I just supplied them with the same
connection string and it would pull the
side up so as long as I had the same
version of code deployed you can
actually run run it anywhere and connect
in the one thing that I had done
initially though and I redid this as
part of this effort
back in November the crater database was
hosted in AWS but the data or they like
the servers were deployed into digital
ocean New York City three actually they
were New York City one so compose I
don't know if they still do this I went
and looked and couldn't find the option
compose offered digitalocean deployments
and you could say New York City three
and so I went ahead and moved all my
servers over to New York City three and
then set up this this database in New
York City three as well and so now yeah
they say they do on their site but I you
know I went in and looked and like I
couldn't find like I tried to do a new
deployment and they offered a amazon
amazon zones and they offered soft later
so i don't i don't know maybe
something's up with digital ocean right
now um so yeah I i think it's it's super
important and so like moving that
database closer I think reduced some
latency and then you know turning on
that up log access is super super
important because you know if you don't
turn that on for every user that
connects you're going to be running
basically a loop every 10 seconds or so
and saying is this data updated and that
can become super expensive and it'll
spike your CPU up I know I think Devin's
in here watching he can probably attest
to this like they didn't have a blog
turned on in their application and they
were like drowning under 10 or 15
connected users and they turn on/off log
and cpu usage shot way down started
getting much better performance so this
is like the number-one low-hanging fruit
easiest thing you can do to scale meteor
is make sure you're using a manga with a
blog turned on
alright so let's do some question get
out full screen it's kind of hard to run
my own session here all right there we
go so Elijah asks is it easy to turn on
a blog of hosting on modulus no actually
right now it's not easy to turn on/off
log if your hosting on modulus I would
not actually recommend hosting your
database with modulus I actually think
that it's a pretty not so awesome option
they basically you're on a huge shared
database server which can be problematic
and then they also don't give you a
flock access so I think you can like get
a custom install but at that price you
know I think it's upwards of two hundred
dollars a month at that price you could
probably just as easily go get a better
performance set up over at compose or
mongolab or somewhere like that but both
mongolab and compose offer really good
options any of their paid plans
basically give you the log access so I
would HIGHLY highly recommend that
oh maybe I misunderstood the question so
I was reading the comments so really I
think if you're hosting the database of
modulus it's not easy to turn on a blog
but if you're hosting the media out
there and you have an oblong enabled
database all you have to do is give it a
meteor I'll flog URL and environment
variables and it'll start using it yeah
so maybe that hopefully that clarifies
it for some people so Elijah asked what
are some differences between modulus and
galaxy so modulus right now doesn't
really use docker and they're they're
hosting setup is different maybe a
little less standardized with today's
setup um so the thing there is they're
using docker to compile your app into a
slug and then they use that slug to like
deploy to their servers and that's a
little bit different that's probably
it's probably closer to Roku than it is
to galaxy um that's similar to how
Heroku works and so if you look at their
build packs it's it's very very similar
um they just don't really like I don't
think there's a way to tell modulus like
here's my custom-built Packer I could be
wrong maybe they've changed that but I
know that they were looking to maybe
move to a doctor set up at some point
but in reality galaxy that's a good
question Robert you should put it down
in the questions um galaxy is using
docker and I think that's a little more
like current state of the art thinking
it's deploying containers for you and
you can one of the advantage of
containers is that you can kind of
decide that container is going to be
this size right and so I talked about a
little bit in regards to pre-render i
can say like hey don't let these guys
get over 400 megabytes
actually just restart those for me you
know whenever it whenever it needs to so
dr. is kind of handling some of that
infrastructure and so I think that's
that's maybe the major difference and
galaxies may be prettier like Dom's done
a better job on the UI but i know i
think galaxies working on a new
dashboard are not galaxy but modulus is
working on the new new dashboard all
right uh so Isaac asked how hard is it
to set up let's encrypt with meteor
using my setup um probably slightly
harder than it should be because i'm
using engine X their engine X support is
experimental I actually looked at it the
other day because I was wanting to set
up a new ssl cert for one of the podcast
sites that i don't have gone yet and um
i just kind of after about 15 minutes of
reading just decided to pun on it for a
little while until i had more time to
investigate how would work with an
engine X app but the idea is like if
you've ever done ssl before the idea of
it let's encrypt is you don't have to do
all this weird like emailing back and
forth improving you own the domain and
all that kind of stuff instead they just
like they come in and like put a little
response on your web server and then
they're able to check that that's the
web server you say it is and you know
they're they're able to prove everything
that way and then issue an ssl cert so I
actually think that's it's a great way
to do it and when I figure out how to
get it working with engine X I i look
forward to using it more for sure
alrighty so Ryan asked any particular
reason for using digital ocean for your
media servers rather than ec2 on AWS so
for me yes there is a particular reason
one
uh digitalocean just generally like I a
while back I saw like scoring of AWS
versus digital ocean and they tend to
win performance wise they do a little
bit better um I don't know I like
underdogs maybe that's another reason i
also have i also have some credit there
so I i mentioned i wrote a blog post
about like eight ways to save money for
your startup and part of that was
hosting your own setup and you know I I
I got a lot of people that clicked on a
referral link from that post and I've
got like two thousand dollars in
potential credit there so as people are
flipping over you know I'm getting like
25 bucks a month here in there so it's
kind of hoping offset the cost of
hosting oh but I know I'm pretty sure
like if you look hard enough you can
find like a bunch of AWS credits as well
for startups so um yeah hopefully that
answers that you're deploying his root
user no I was logged in as root user to
take some of those screenshots but I
don't deploy as root user meteor up
actually creates like a meteor up user
that it runs all the code as so to
answer your question route will no I'm
not deploying his route excuse me
talking uh what are some of the ways to
stress-test a meteor site anyway for us
to find out how many concurrent users
can handle in a given setting so it's to
tweak further to make it more performant
um so the first thing I would say is
like get khedira installed you saw the
screenshot you can actually dive pretty
deep into what's going on in your meteor
app with Khedira so i'd highly recommend
getting that set up and then you know
there's a whole gamut of stress testing
that you can do
you can you can do something as easy as
Apache benchmark right so you can type a
B and hit a URL and just throw a lot of
traffic at a site that's maybe not the
best way that's that's pretty naive i
guess um there are some other tools i'm
pretty sure Aaron Oda has one I don't
have it right in front of me right now
but there's like a load testing tool
from khedira see yeah I don't see it
right now maybe someones got better
Google skills in me meteor down that's
it I found it all right yeah so I would
recommend taking a look at a meteor down
there was another one called meteor load
test which was actually using I think
maven and some java stuff to load test
but meteor down I think you can you can
start you can actually make subscription
calls and all kinds of interesting
things so you can test that side of
things and again like if you're using a
CDN you're gonna like your you're
delivering a little bit of HTML you can
deliver your CSS and JavaScript from the
CDN so the stuff you care about for
scaling purpose is going to be like the
DDP stuff so meteor down is a good
option there so the next question from
Gavin as well is if we were to use DDP
over normal media architecture for the
same application would it support a
greater number of concurrent connections
for the same hosting set up I'm not sure
I follow the question or to use TTP yeah
I don't
maybe you can clarify that for me Gavin
I'd be happy to answer it maybe react
that in a different way so Isaac asked
have you tried out the beta of totem if
so what did you think about it compared
to the other options out there um well
obviously like darker like to them right
they bought them um I think that it's an
interesting option and I think that will
hear a lot more about totem tomorrow
when Jeremy talks about using docker to
deploy like an auto scaling setup I
think that's gonna be a great talk and I
looked at it a little bit but I just
didn't want to get that heavy into it
you know I probably poured maybe 25
hours into this project so far and I was
just it was more of a I like this stuff
so I was playing with it on the side but
I didn't want to go full-on like DevOps
on everything huh hopefully that is
helpful um there's another question ah
yes so in the comments um yeah but at
the same time like Ralph just said so my
galaxy is 25 hours of MDGs like 25,000
true but the reason you go with modulus
or Heroku or galaxy is because you
deploying it is more like an hour tops
not you know 25 hours so uh well I find
that time valuable because I'm gonna
blog about it and hopefully it helps
other people with hosting um I'm not
sure that that's the best use of your
like business time I guess like if i if
i put on my business cat tie and stuff
like I'd probably tell myself not to do
that again
the other question Ryan had in the the
comments was what about auto scaling
your instances do you do it manually in
digital ocean I actually do and so the
easy way to do this like the the hackery
way to do this is to take an image of
one of your app servers and then just
deploy that image to a new server and so
then you know once deployed I just take
that internal digitalocean IP and pop it
into my load balancer and then you know
that's maybe it's a five minute process
to do by hand so not as great at auto
scaling is say something like galaxy or
Heroku but it's definitely not super
hard either pretty easy to get going
valdis ask can we scale media apps
easily on Heroku I would say yes
absolutely you get the they've got their
dino system very similar two servos over
on modulus or containers over on galaxy
basically they're just processes running
and they offer Schticky session support
now they added it maybe two years ago
year and a half ago which is the key
right that's that's the piece you need
in place there and so you can just tell
them like yes ratchet up to to dinos and
you know your configs should come along
with it and it'll start a second copy
and all of a sudden you load balancing
so yeah you could absolutely easily do
it on Heroku and I think I've talked to
Paul downman at okay grow they use
Heroku for a lot of their customers
because they they have a better model
for sharing permissions to applications
and I also the thing I miss is like
pushing a git repo so I'd love to to get
crater or set up so that I do like I get
pushed somewhere and then it like starts
the deploy process because it's not
always readily apparent
like I like having the control of like
checking in some code and then knowing
that's the code that's getting deployed
versus with like mop you're in your
local copy and it's going to tarball
your local copy and so if like I if I
have a config that's off and my local
copy like that's just I don't know
that's not good bad things happen all
right well let's take it a short short
break we've got about nine minutes left
and then we'll come back at four o'clock
and we will listen to Ian talk about how
you can use DDP to build api's thanks
guys
this video has been a space dojo
production you can click the learn more
button to find out more about us at
space dojo com or you can click the
subscribe button to get notified about
new videos we put out each week thanks
for watching
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>