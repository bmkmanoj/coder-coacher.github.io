<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Observable JavaScript playbook, asynchronous generators and hacking the Fun Fun Forum | Coder Coacher - Coaching Coders</title><meta content="Observable JavaScript playbook, asynchronous generators and hacking the Fun Fun Forum - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Fun-Fun-Function/">Fun Fun Function</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Observable JavaScript playbook, asynchronous generators and hacking the Fun Fun Forum</b></h2><h5 class="post__date">2018-03-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/MmRmxzrr4lk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">good Monday morning today we're going to
take a look at observable which is a
service that provides interactive
JavaScript playbooks with observable
dependencies it's a various show it to
you to be honest eyes and then PJs and
you are watching function
in case you are wondering why I am
wearing a hat it's because I live in
Sweden and right now in Sweden things
are insanely cold like so cold that you
get angry so cold I actually have a
heater like what's it called a space
heater in the in my little studio here
but I can't keep it running while I'm
recording so I like I'm covering myself
with textiles all right so what is
observable if you are familiar with
ipython playbooks then it's basically
that except that it's in JavaScript of
course and it's hosted software is a
service so you don't need to sit and
mess with setting it up and it's it also
has is aware of its dependencies and
will dynamically recalculate itself when
a dependency has changed which has huge
huge implications for for the entire
playbook system and makes it so much
more powerful than ipython playbook ever
since I tried ipython playbook many
years ago I have wanted this specific
product and I am so happy that it's
finally created and it's amazing and
it's going to be huge this is not a
sponsored video they have not even asked
me to make this this is just a product
that I am incredibly excited about all
right so this is a playbook if you are
not familiar with ipython playbook
it's probably just better to just show
you what it is it's kind of like
jsfiddle or code pen but it's instead
you write things in little cells that
depend on depend on each other play
books are almost exclusively used to
mine data and visualize data sets you
like okay we have this database of users
and we need to figure out daily active
users and we need
display a graph of that lalala that kind
of thing it's kind of like an excel on
super super super powers
blah-blah-blah-blah-blah let me show you
what it looks like this is observable
I've just created my notebook so you see
here that there's a markdown block here
so this evaluates to whatever I write
here in markdown hello observable and I
just hit shift enter and renders and I
can just keep typing here and it will
you know render it this nicely which is
kind of cool you can write like document
whatever it is that you you're working
with that at the moment make your play
book pretty for the future of your
future generations so these URLs after
you publish them are shareable
observable is a very early product I
know that they are working on private
privates privates play books and teams
but for now all the play books that you
publish are either public or private
there's nothing in between so you can
write JavaScript 5+5 it shift-enter
it's it's ten and you can also assign
variables so i can do i hate these kinds
of variable names but i'm gonna assign
foo and then i can refer to those
variables from other cells
yes created new cell here and i'm gonna
do food plus plus 25 that evaluates to
35 this so far is not very impressive
this is exactly what i python playbook
does but let me show you this let me
change this to 8 and hit shift enter
notice that this here updates let
me change that again see that this live
updates here and that is because that is
not because the entire playbook
rear Enders all the time no it's because
of the because this cell is aware of its
dependency on this there are some cool
implications with that but I'm going to
show you how to declare a function first
so let's say that I declare a function
and we call it hello and I'm going to do
let me just do a this color return
promise new promise and this from is how
do you do promises okay it takes a
function and it's a result function and
that resolve function is going to be
cold with hello let's just call this
greeting instead to be honest and I
don't want it to be called immediately I
want it to be cold after a second time
it's that time ouch and then it's going
to resolve and then it's going to or so
after saying oh let's see if that
evaluates nope unexpected token one
parents too much cool see that now
greeting is a function so if I just call
greeting you see that after a second
there in updates to a low so you see
that observable is very much aware of
the concept of promises and will kind of
just I'll figure this out so I can
actually assign this to a variable just
call it current greeting there BAM and
then I'm going to dictate it it urged
let me with reference count greeting
from here current greeting you see okay
that evaluates to hello 25 because
JavaScript doesn't make sense
let me delete this
sell here so that we don't get too
confused I would really like
drag-and-drop support here so that I
could drag reading down because they
order of these things don't make sense
perhaps Ursa can I move them somehow I
don't know how to
what's the hotkey for moving I don't
know there's probably some oh there
there cool now have a look at this when
I change hello here to buy and it
updates after a second notice how sleek
this is that the environment is aware of
promises and constantly re-evaluate them
all the time it's just so incredibly
sleek to work with let me refer this
thing to be a delay function delay
milliseconds and we're gonna call it
there and then it's gonna be now so
delay is now a function that returns a
promise that resolves after its certain
amount of milliseconds and as you see
here now these cells that depend on
having but the function greeting exists
they are now broken because you know
that make sense so there's this concept
in in in also a book called blocks I
think they're called blocks whatever and
I want to call this numbers and I'm
gonna create blocks so this is not an
object literal that I'm creating now
this is a this is a block so this can do
the churn so blocks are kind of you can
think of them as probably if ease like
it's just it's like a function that is
immediately evaluated so you can it's
kind of like an implicit and place it
like this this is kind of what it looks
like but but it also has it's kind of
like an implicit a sinc function as well
so I can just
if I do this delay 10 1000 and I just
say oh wait and then return tap all
right 17 and I'll play that see that oh
it waits a second and then it returns a
1017 and it's also an implicit generator
wait what I'm gonna let that sink in a
bit because I didn't even know that a
synchronous generators was a thing and
it's it's amazingly useful in the
context of data analysis let me show you
let me do a while true and we're going
to do let I equals 0 and we're going to
wait for 100 milliseconds and then we're
going to do I plus plus and then we're
going to yield I and can I run look at
that that is so cool and of course I can
depend on this so let me delete this
cell here and just say like I can do
hello plus numbers and see that this
dynamic leary evaluates it might be that
you are not familiar with generators or
a synchronous functions then this is
mind-bending to you you might want to
check out my episode on generators here
I also made a video on a sink await that
you will probably find very interesting
throws out if if this confuses you
because this is going to be way more
confusing later all right
besides just being cool is there
something that we can actually use this
for let me show you but so there's
there's an end point that I have for on
the Fun Fun forum which is the private
forum for for patrons where people can
in their profile
just insert arbitrary JSON and this is
exposed through an endpoint that all
other former members can use so you can
use this to kind of create dump services
without my involvement let me just show
you what it looks like so I'm just gonna
run that okay if I just fetch it it it
gives a it gives a response object which
is not very useful to us let me evaluate
you know we can actually do do a block
here and await this miss fetch put it
into a response and then we and do a
body do you know what we can do this
with bones dot JSON and we just return
that all right so we get some this is
what it looks like it's just a username
on the left side and then maybe JSON on
the right side so members are highly
encouraged to insert stuff that will
will break the applications of other
users let me close that for a bit let's
look at my Jason so I want to how let's
assign this to a variable we're gonna
call it old data worst variable name I'm
gonna create a new cell I'm going to do
all data
and check out my user which has mpj so
here's some Jason let's say this is just
a JSON string so let me do a json.parse
percent up okay
lookie lookie here's an object so this
is a pretty cool thing there is I can
show you actually let's go to fun fun
forum cow and their ears a blow show you
was and there's this pretty cool map
that valise has made which is moderator
on the front of inform it's currently
broken because I just rewrote this
endpoint but it basically shows you all
the locations of of members of the font
on forum that has put their stuff in
there in the hackable json endpoint so
here's my location in gothenburg and you
need to place it in the user map
location know that is what the app
expects you to do let's actually have a
have a have a look at at that this is my
my location let's let's do user location
lam there now it would be pretty cool if
this location was live updating when I
updated it on the forum what I mean by
that let's actually go to my user
profile and I just changed my caption
here to get nose lulu lululu oopps
and save changes and go
- observable and you know I just really
ate this cell here and you see that lulu
lululu it would be cool if i didn't have
to do that if there was some some way of
us to to listen to the changes and have
this thing update life turns out that
there is the first thing that i want to
do is we're gonna did assign this to a
variable I'm gonna call it left or user
map yeah user hash so that we don't
confuse ourselves and we need to await
that let me return user hash so that you
can see what we're thinking about yes it
still looks good now there's actually a
WebSocket endpoint the way you do a
WebSocket is new WebSocket let the duty
to and usual copy this is the endpoint
the right so it's WebSocket secure and
it's fun fun Automator Heroku app calm
hacker palliation basically the same
thing as this end point but just
WebSocket and we're gonna pull this
socket socket and then we're going to
look at the bits so get on message and
this gives us a function or and we gave
it a function and that take the function
accepts and event and no console.log
we can distribute the juji juji you know
what I'm going to do this in a separate
block so that we can think about one
thing at a time
oh there we go there we go we're gonna
console.log out event dot data no data
is data and run that or start running
that dump up the console here data is
ping ping all right yeah so it pings us
every seems like it's ends ping as data
every every five seconds or so let me
change my profile change it back to not
Lulu what is happening you know some
weird order complaining here which I
don't want it to do there oh my god what
what is happening like OSX is confused
about mine what this field is okay let's
have a look and you see era that if we
now get some new new the updated user
here so we want to want to update this
old data objects cache with that and
then feed that up to this year so how do
we do that
well if I look at the old data endpoint
we could start yielding things here
because it's an it's a generator but in
order to do that we need to be able to
kind of wait for for the stream or for
the port D for the data and there's no
way of us do that so
refactor this to be a kind of promise
we're going to call this function next
and and did it's going to return a new
promise that resolves to do boom boom
there we go and on the message we're
going to give event dot data it's not
the ping
we're don't care about the ping you just
want the user updates then we're going
to resolve it with event dot of data so
look at that let's call it let's call
its let's call this a function and let's
call it start streaming something like
that and M then let's jump to this one
and we do so let's create a block let's
assign next to the function that is
returned from start streaming see what
this looks like
and then we turn next what happens
nothing is happening
so what makes sense because there's no
user updates let's let's update and I
asked lululu and oh sorry about that
Save Changes see order get something oh
we did boom
so now this next function will return
the next thing in the stream so if I
actually just
J son dot parse and I need to await this
as well otherwise frustration dot parse
wants an actual value nor the promise
see what this looks like and I'm gonna
update my profile again Moodle and save
the changes and now you see here oh it's
in JSON object and close this because we
know it works
now I want to because this is just doing
this once I want to make sure that this
does it like shows it as as we as we
update so let's let's just call this me
and then me dot so the look we want the
we actually want to parse out the
hackable jason we're gonna call this
hackable I'm gonna do me don't hack
JSON new Jason parse it's jason within
the JSON it's all very confusing
packable dot user location and
lalalalala what do we have
I want the caption caption it's returned
on what happens and let me update it
again
substance of some stuff mandatory and it
was an unexpected end of Jason input why
is that that confuses me a bit perhaps
it isn't valid Jason let's actually
check it perhaps I've messed it up
me paste this into a new cell yeah I
think I deleted I accidentally deleted a
curly bracket thing at the end so
actually let me fix up their curly what
curly bracket all right so now instead
of having this stream just once I wanted
to be a generator so I just do
wild true and I'm gonna do its this
inside of the the wild true didn't do
there we go and now instead of returning
we're going to be yielding so yield just
it's kind of like a possible return it's
kinda like instead of terminating the
function just pauses all right just hey
I'll give you whatever is running me the
generator up some value and then I'm
going to continue running file out here
and going to change this string here two
moves back again and I'm going to hit
save take a look here and you see that
Boop it updates let me do that again
say that again and it updates and you
know we could call this label let's now
actually integrate this into the old
data thing so instead of returning user
hash here we're going to yield it and
then we are going to start
do next I'm gonna start streaming grab
this actually and go back to old data
while we're true we have this gonna grab
your update to use your hash and we're
gonna grab like me don't use your name
and sign that with the hacker Bob JSON
because that's how it's structured and
once we're done with that we are going
to the entire user hash and we know this
BAM
let's actually delete these observable
numbers as well because they have been
distracting us for long enough and here
let's just call this mpj and as we see
here now
this refers to like old like mpj in the
old day - so like if you remember this
is a hash of all the users and now we're
referring to an PJ and the user
application here so before this was now
like we have to refresh for this to
update however if all of this works now
I should be able to change this here and
Save Changes and this should live update
and it does see that I'm gonna save
again boom and it's I'm going to publish
this this notebook here so that you can
play around with it just find it in the
link in the episode description and I
think that this is very cool
observability make so much sense for a
playbook environment it's so easy to
work with
javascript is
also stupendously useful for stuff like
this it's really good at it
by the way something that I haven't even
showed you is that you can just pull in
NPM modules here like randa or you know
whatever you need you can also render
Google Maps and HTML right into here so
that you can visualize this map and like
do all kinds of shenanigans it's really
really nice you're probably going to see
me doing quite a bit of more observable
stuff over the coming months because
this is a product that I'm I'm very
excited about I hope you found that
useful if you're confused please post
questions down below or if you are a
patron you can post it on the dedicated
discussion topic on the Fun Fun forum by
clicking here or in the link in the
episode description if you are new well
come you have just watched an episode of
fun fun function a release is every
Monday morning Oh 800 GMT if you are
forgetful you can subscribe here so that
you don't miss it or just watch another
episode right now by clicking here I am
npj until next Monday morning stay
curious</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>