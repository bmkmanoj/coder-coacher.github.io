<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>C# App Start To Finish Lesson 24 - Refactoring | Coder Coacher - Coaching Coders</title><meta content="C# App Start To Finish Lesson 24 - Refactoring - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/IAmTimCorey/">IAmTimCorey</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>C# App Start To Finish Lesson 24 - Refactoring</b></h2><h5 class="post__date">2017-09-18</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/UPKphrPJZxE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome to lesson 24 in a c-sharp from
start to finish course my name is Tim
quarry and today we're going to refactor
our application just a bit refactoring
just means that we're going to rework
our code so it does the same job but in
a better way
we've got some junk I like it cleaned up
in there and now is the time to do it
along the way I want to improve a couple
of areas that aren't quite up a standard
yet so let's get started the first place
I want to start is this I did a
connection remember at the beginning we
started passing back the same model we
passed in the thought process was well
we update the model therefore it's
passed it back and that's just really
not necessary because we already have
the models address so here going to do
I'm going to start deleting things I'm
gonna delete the return type and say
void instead and I'll copy that and
paste over these other two now it's
gonna break both a sequel connector and
a text connector because a signature
line has changed remember that this
signature line has to match what we have
in each of our implementations so for
example the I did a connector will now
yell at us so let's change this to be
void and now we have a return model and
it says hey you can't do that no problem
we don't need to return it create prize
model let's set the devoid take away the
return model and take away this return
model and set it to void as well and
that should take care of our interface
let's go over to the IDE or a text
connector and do the exact same thing so
right
change this to be void and don't return
the model change this to avoid don't
return the model and then down here
create team as well and don't return the
model and now it should be that again I
did a connector is satisfied with our
new signatures if you had just said
control dot and implement the interface
it would have created three new methods
probably I'm not positive actually let's
do this let's change team model back hit
control Z twice and now let's see what
it does when I try to implement the
interface right down here void idea
connection dot create team and that's
now the new method so create a new
method for us and it created with a
weird name and that's because we have as
issue up here where we already have a
mock I'm sorry a method called create
team and we can't have two methods
called create team unless they have a
different signature line and the return
type is not enough of a difference in
Sanchar for this system to tell them
apart therefore you can't have two with
the same input type and different output
types so I just made one refactor the
refactor was I changed how these worked
and now I've changed my application now
let's just make sure if we build a
solution let's see if anything fails and
it does down here and they create team
form if we go to code there should be an
error in here somewhere and of course
there is we have
create person now it says cannot
implicitly convert type void to person
model why is that well because we're
actually trying to take the output of
create person and I sign it back to P we
don't need to do that now it's deep or
build again and now I've built succeeded
so with just those few changes we have
eliminated what's really a nagging issue
the idea we're returning something we
don't need to return so that's the first
thing that I wanted to get taken care of
the next thing only get taken care of is
in text connection we have all of these
string constants now remember that we
don't need these anymore let's close all
our documents we don't need is any more
because in our global config there they
are and now they're accessible across
our entire application therefore let's
get rid of these and now it's gonna yell
us and say hey I don't know what people
file this well we say global config dot
people file it will not work so he's
replaced we add global config dot on the
front of any file name that has broken
and we should be good to go now that
save prize
saved prizes file we probably don't need
to have access to this this file so
let's hit f12 here and note that it
takes in the file name but we don't
really need that because we have the
global config so therefore when come
back to that make a note of it we'll
come back to that and make sure you
don't ever pass in file names so we'll
come back to that later but for now
we'll continue on modifying our file and
again for now we'll pass
in those files but we will refactor that
as well this is a little bit of wasted
effort by one do this to make sure I
clear all my errors out because I I
really don't like changing multiple
things at once meaning we're changing
the global can over to global config for
the filenames that's fine it's one
essentially one change but we don't want
to wander off doing other changes as
well like those taking the file names
out of the method signatures so let's
just make a note of that we'll come back
to that once we're done all of this now
it says turret file is nice this lets
because get to have global config dr net
file takes care of that and now if we do
a build we should be good and the reason
why I'm really confident leisurely good
is because those were private constants
therefore they should never have gone
outside of this class so now we can go
over to the text connector processor and
start taking care of these issues right
here full file path we pass in the file
name we're going to have to do that
because that one is used for all the
different files so again not going to
change that one not gonna change this
one load the file whatever file it is
not gonna change that but this right
here string people file name don't need
it again that may throw an error and if
it does we can say people file global
config dot people file and that should
now solve that problem this one right
here
passes in three file names
we should take care of all three of
those and then just rename these so a
team file not team file name go looking
fig dots people file and this will be
prized file all right and that's yelling
ass right now because there is no prize
file so let's look at global config real
quick
yeah the prizes file it's it's plural
now convert to team models only takes in
oops when you take out bats sending the
file name and now that works all right
so now we we've modified this all this
code right here now saving the saving to
the prize file we can take out the file
name again global config dot prizes file
save people file we can take that out
and with the modified code in here
global config dot people file
just make sure your filenames correct
when you are renaming these because
these are all called filename which
means you have to know based upon a
method which file you need if you're not
sure definitely double-check so you
don't need those two file names we don't
need to pass in those file names and
we'll get them to match up it's down
here so we'll get there
these all look good match up file and
match up entry file we can get rid of
those we can get rid of match up entry
file in the call already isn't a global
config down here for the match up file
and we'll keep scrolling right now I'm
just looking at the signatures of the
methods to find where I have a file name
and use or I'm pulling a file name in
once I change that I look in here for
any errors that pop up or have to change
that name like here as our taken care of
there's a matchup entry filename so
not only didn't change and that looks
like the last one we need to change but
know that we have a whole bunch of red
squigglies over here so let's find out
why the first ones actually up here in
here we have an error I find the easiest
way to find that is to go right to a
double clicking it and here we're
passing in a file name we don't need to
we can pin this list it makes it a
little easier you don't need that we
don't need that this error list updates
in real time which is great because we
can see as you make changes if we
increase or decrease our errors in this
case we wind to see errors because we
call most files all over the calls
methods all over and pass those file
names in all over and so if we didn't
see errors that would mean we had done
something wrong so definitely don't
freak out if you see errors we'll take
care of all those errors and now it says
we have no errors don't trust it though
make sure you do a build and it
succeeded so now I've moved all of those
text connector those files whatever the
text connection file name was we moved
all those constants over to the global
config and made them public so everyone
has access to those same file names
therefore
we've done that that refactor so now
I've done two REE factors or two major
ones we have renamed all of our files
over to be the new global config files
and we've updated all the methods that
call those file names to now use the
global config and we've also modified
our our interface so that now it has the
proper signatures without passing back
those models that we didn't need to pass
back in the first place
any modified everywhere those are called
so that we don't have a problem with
with calling them so now we've done two
major factors which is great but now
I'll move on to one more that won't get
done and it's one that's been bugging me
for a little bit and if you've been
paying attention these videos you'll
probably know which one it is if we come
down here to our tournament viewer forum
and view code and let's close out global
config if you come down to this event
down here and you can tell which one it
is when you start scrolling that event
that's too much code for an event is
doing too much and really there's logic
in here I want to pull out into a method
because we'll call it more than once so
the action here is a score button on our
score click so whenever you score a
match up we do a whole bunch of stuff
now some of this is user interface stuff
you'll always have this in your user
interface so checking which value to
pull out which things to update based
upon where it is unless on the forum
those kind of things are all UI driven
so if this forum were entirely different
then I'd have to pull from different
locations for Team one score and team to
score that's fine and also the idea that
we update the model with the scores
that's fine
even tutoring the winner could be okay
but I really think even that logic neezy
pushed out of the user interface
remember the goal here is to create an
application that while it's complete as
it is how our customer has said that the
windows forum idea is great for now but
in the future we're gonna may want to
put put us in the web or maybe have a
WPF interface or something different and
so we don't want to have all the code in
the user interface it's not good anyways
but we want to push this into the
library as much as possible so the UI
just calls the library whatever it does
is calls the library then the library
takes care of everything else including
do I call sequel or they call the text
file where do I put the stuff how to get
back out how I transform it all that
stuff is taken care about a library so
that the UI can just say give me data
now here's data back and that's really
all it should do in the user interface
so from line 201 down to the bottom
except for this line right here the load
match up with a selected item so
everything else from 201 down to
actually down to here is this line all
of this needs to get extracted into our
class library because this is all logic
surrounding how to score the the
tournament matchup and how to promote
the winner to the next round and have
mark the items as plate and so we're
going to pass all this off to another
method and we're going to put that
method in the tournament logic
now let's collapse these two definitions
so we have create rounds create other
rounds create first round
number of bites find number of rounds
and randomized team order these are all
things that have to do with creating
rounds right now for a tournament logic
notice this was the only ones public
we're gonna add another public method in
here that has to do with scoring the
tournament
public static void let's call this
update tournament results it'll pass
in the tournament not logic turnip model
so a job of this method is going to be a
do everything here so let's copy this
code let's paste it in here come back
over and I will delete all the lines
except for the line in the kid and now
we'll say tournament logic dot update
tournament results and we'll pass in our
tournament model and our turn up model
is what let's scroll the very top and we
see that it's called tournament we're
passing the entire model in not just the
matchup we're working on and the reason
we're doing that is because we're
working on the entire object alright so
now we've got a little bit broken logic
here so let's take care of that and then
instead of tournament dot rounds it's
model dot rounds
and if you notice we still have some
broken logic event here because we're
dealing with the M which was our match
up which we didn't pass in now is the
specific match that we just worked on so
let's actually comment this section now
as well we don't need this line that's
for a UI in this line right here is
going to actually update our specific
matchup but we don't know what that is
yet so let's look at what this does
first and then we'll adjust this logic
to fit into a class environment instead
of working on one specific matchup so
the first thing that happens is we're
scoring if we have a score to give
meaning if we have two scores then we
need to mark one of the people as a
winner
therefore we can do the same thing but
against all of the matchups in our
entire model and here's the reason why
when we first create our model some
teams had a bye week well when you have
a bye week you automatically win that
game and now there is no game we got
around that so far by actually giving
the person with a bye week a score you
know one or whatever it is so we gave it
to him and we actually had score so now
they have a score of 1 to 0 when they
didn't do anything and that seems kind
of hacky and so one of the times that I
want to call this update term it results
is right after the tournament gets
created because at that point we'll know
if we have any byes if we have byes then
all of those should be scored right away
therefore we call this and say run
through the entire tournament and score
everybody so we're going to do that
to loop through our entire tournament
way to loop through all of our rounds
just we get down here and we'll actually
do this for each loop more than once so
for each round in rounds then we're
going to loop through each matchup in
the round and here's I want to do I want
to create a list of matchup model called
to score and this is going to be the
matchups where we need to score them so
if and this is where it can get a little
tricky so why don't you stick with me
here normally down here we did another
for each on every matchup entry in our
entries and we said okay hey if in this
case the parent matchup is not null then
do this but up here all we care about is
do we have a score so I'm gonna do a
little bit of link so if our MDOT
entries dot any x equals greater than X
dot score is greater than or less than
zero actually sorry that was sequel but
not equal zero much better if any of the
entries is not equal to zero or our MDOT
entries dot count equals one now am i
doing here
so the first thing I do is I check to
see if any of the entries have a score
that is not equal to zero
so if we have completed a match then
we've put the value for two scores in
we're not accepting ties for tournaments
therefore one team at least has to have
a score different than zero they can be
negative or can be positive it just
can't both be zero so if any as an
either if any entry matches this pattern
if any entry can say I'm that's true for
me then return it true if none of them
return this but there's our or but the
entries dot count is one meaning we have
a bye week remember bye weeks don't get
their own match up entry so if we have
by week or we have a score either way
we're going to add two scored add our M
so we'll put them on the list
got a bug here and saying hey I can't do
that
cannot convert to this other signature
doctors I said any not ad control J ad D
there we go so now I've added that match
up to my list that need to be scored
when this entire thing is complete I
will know which ones need to be scored
but there is one flaw here and that flaw
is that if we have a score we may have
already scored them where you said this
is the winner so I'm going to do is I'm
going to say if R M you little space
here r m dot winner is not equal to null
and I'll put this in parens
so if winners not
there is equal to null I'm sorry so if
winner is null I mean we have not yet
assigned a winner
and either one of their scores is not
equal to zero
or there's only one entry so if we have
already scored them we're gonna ignore
the rest of stuff so if the winner is
not equal a null if it's filled in then
the whole thing's gonna fail no matter
what we'll skip over and that just
prevents any kind of issues we have with
scoring the same winner over and over
again
so now you've done all this now down
here we have a list of matchup model
that we need to actually score now we
can actually score these by looping
through with our logic down here where
he's okay if this score that score how
do you mark the winner but I don't want
to die here instead I'm going to call a
private method and so I'm gonna call
that private method let's call it score
matchups will pass in a list of matchup
model will call those models I'm
actually create a signature language
that's not just do so I'll copy that for
later and I'll pass instead my to score
sometimes I think three steps ahead and
forget what I'm doing right there
alright so down here I'm gonna create
that private static and it's a void
probably static void score matchups and
now in here I am going to do essentially
this logic and I say essentially because
they some tweaks to it I wanna get done
and the first tweak I want to make is we
said that if one score is greater than
the other
that determined that the first score is
the winner so one's greater then but in
golf the lesser score wins the score is
lower and first you said well where's
gonna deal with greater than for now but
now I'd let you go back and actually add
that in since we're working on it right
now so I'm gonna do is actually go to my
app config and add a new key here we
already have one for our data so I'll
paste that in there and set a file path
it's going to be
winner determination and I will say that
the initial value is greater so this is
saying that a score that's greater is
the ones gonna be the winner if I said
lesser it would be the score that is the
lesser the lower one now you may be
saying yourself now wait a minute
that means their entire application can
only do one direction for scoring
greater or less than and that's true but
we are extracting the logic out into
here the next step would be to actually
modify our model and stores information
in the database then we could store it
in the tournament model setup we could
say greater than or less than or you
know high score wins low score wins and
pass it in that way and then we could
just change it from and pulling from the
app config to change it to pull from the
turnip model so that gets it's pretty
close I'm not gonna go into actually
adding it to the tournament model just
because we have to change a lot in
places we need to change our text files
our sequel data structure our store
procedures and some of our code so
that's a pretty big change to do and I
really don't want get into that and take
up too much of our time when we've seen
how to do it it's just a matter of doing
it so instead I'm just gonna put it here
that gets us all the new logic for
greater than or less than and then
wherever you pull it from is up to you
so in our app that config I have winner
determination the value is greater and
that's what's a key string so how do you
pull this winner determination we
already have the logic for that if we go
back over to our text connector this
full file path if we hit f12 there is
the code for pulling
that value it's actually right here so
you can take this code come back over
here and say string score Direction
equals but instead of the file path we
want to pull in the winner determination
and so they can't find configuration
manager I hit ctrl dot add the using
statement and now we're good to go and
so the values here should be greater or
lesser now using magic strings is always
a little bit concerning so there's a
couple I could do one instead of saying
greater or lesser we could say one or
negative one but that gets kind of
confusing boolean we could do a boolean
and say greater wins and then we have a
true or false value and what I would do
if that is I would say 1 or 0 since it
says this is a string and I kind of like
that a little better that way greater
wins is either 1 or a 0 it's either true
or false and so it will say is that if
it's not if it's 0 it's false otherwise
whatever it is it's true that way by
default it will be greater all right
so us a greater wins will call the same
name as our actual app setting number I
say is we're doing if statement here if
greater wins equals zero it can't be
zero it's got to be zero inside a string
there we go so zero means false or low
score wins
so we'll start a low score first because
that way we'll do an else statement down
here and now this is for 0 1 means true
or high score wins and so that just
flips the bit for us to say 1 or 0 the
key here is I said 0 equals 0 the only
way to say low score wins is to have as
B 0 any other value anything will set to
be high score wins and since that's what
the majority of games do then we're
going to go ahead and set that that way
we'll set the default to be the the one
that is most likely true and we're going
to do is take this logic now and put it
in each of these sections so if and
here's the problem now is we have a list
of match up not one particular match up
so before we go any further let's wrap
this entire thing to a surround with
four each so I'll say the for each is
match up model and the value let's call
this M in my tab don't work for some
reason this time it's okay for M in
models
all right so now we can say if it's
gonna loop through every time for every
matchup where we have to mark a winner
and the rest say if m dot if it
continued on those we'd say entries and
the first one and the score is greater
than M entries dot one dot score and
actually it should be less then because
the low score wins then in here follow
this logic down here we would say m dot
winner equals m dot entries 0 dot team
competing so if the first entry if it's
score is lower than the second entry
score the winner is the first entries
team now if you've seen the flaw in our
logic yet this will only work if we have
two entries well up by weeks well that's
where we need to have a separate case
for the by week now we could wrap as
entire thing in our if statement but
that gets kind of tedious going that
main layers deep into loops and ifs and
all the rest so instead I'm going to do
is say if m dot wrong m m dot entries
dot count is less than let's just say
equals to one there we're absolutely
sure we're doing if we have one entry
let's put a note up here I don't do a
ton of code comments but I do comment
when things are a little tricky or when
I want to give an example of what's
going on
so as case this is for bye week so in a
bye week what we'll do is say m dot
winner equals MD entries zero dot sorry
dot team competing all right so we take
the first entry since it's a bye week
therefore they're automatically scored
as the winner the problem is now I'm
still gonna go through and hit this next
if statement unless I do continue and
continues job is to continue this for
each at the next iteration think of it
kind of like a break
but it doesn't exit entirely so a break
in this situation would say okay the for
each is done
go on down here the continue says this
loop this particular iteration is done
go on to the next one so that works for
us
so now we check for by then down here we
check to see if we have if team number
zero was the winner and then we can
either check just say that the other
team is the winner it does we're going
to say or we could say that we don't do
ties now down here we do the LCF because
of ties and I think I like that logic
still I don't like the idea of allowing
tie through with one team advancing and
so in that case I go ahead and actually
do the same logic will this need to deal
with what to do if there is a problem so
else if
we'll continue on in the same logic well
as copy and paste this and change around
the numbers now they could change and
that's not - it's zero we could change
this symbol which be quicker but if
we're matching patterns then you'll see
that the pattern is the team in front is
the winner the team in front is the
winner just makes a little easier for
looking at things in my opinion and
that's up to you so now we have this
else statement and what do we do here
well we really shouldn't go any further
in saving this data I really think that
which we've done at this point and say
you know what no we're complete we can't
go any further until you handle your
business so we should do a throw new
exception a type of exception here's
what I do there's a number of different
exceptions that Microsoft provides and
the great thing is they're pretty
descriptive in their names so for
example unauthorized access exception
can you guess what that's for probably
for accessing something you don't have
access to and so what I do is I scroll
through here and say does anything
really match the issue I'm having then
I'm throwing error for and so I'll
scroll up here I'm not gonna waste a
whole lot of time in this because really
it is up to you you're the one capturing
it we could say the format exception if
we want we could even throw just an
exception if we find that there's not
really a value or exception type that
matches up exactly what you want array
type mismatch argument I have ranged
null argument exception
that's usually for methods application
exception a non fatal error well that's
kind of it but let's just do exception
notice we have three overloads here we
can pass in nothing a message or a
message and inter exception let's just
pass it a message and say we do not
allow ties in this application now you
could say yourself a wait a minute what
if we had two zeros well that would
never be matched as a completed entry
because at least one of those values has
to be a non zero in order to even get
into this list
so now you've handled the one type
that's all this the only for the lower
score wins so now we can do when the
high score wins we can copy the same
logic paste it down below and now we
change the signs and that way it's still
a same team that goes through but now
it's because this score is greater than
this score so that's the same logic
now we've marked the winner for every
single match up and let's instead score
match up let's call this mark winners in
match ups link up here and change that
call so we've marked the winners for the
matchups now we need to do is go through
and actually update the parents then for
the next round so you've won the first
round now you get moved into the second
round if there is one
so mu advance winners and leave it that
I'll pass that same list let's call it
right here
private static void advance winners list
of matchup model called models and now
in here we're going to do this logic so
we're a loop through every round in our
rounds and we're gonna say okay we gotta
find every matchup in every round inside
there every matchup entry and say if
your parent matchup is not null and it
matches this MDOT ID well that would be
the model one model in this list of
models so we'll need to put another loop
in the outside of this loops through
every model and does all this so it
should actually pretty simple because we
should say surround with for each and
we'll say
matchup model and we'll call it m in
models now I called M specifically
because I knew that down in here we had
called our matchup M therefore all this
code should work the only thing I'm a
problem with is this model dot rounds
and that's actually the tournament
itself we have to pass the tournament in
here so let's do that so I'll say
tournament model term it
instead of model here I'll say
tournament dot rounds and up here we
have to pass in our tournament model and
now we've again satisfy that signature
so now we've looped through every
matchup and said for every matchup look
through every round and every matchup in
every round and find every entry in
every matchup and if the parent I errant
matchup is not null check to see if it
matches the current model were on the
match up model if that ID matches that's
where the winner advances to now don't
forget this is a curated list of models
this is only the matchups the matchup
models that have been marked as we need
to score them therefore they have been
all all been given a winner therefore by
this point we know that every single one
of them knows who their winner is we can
put that winner into the team competing
of the next round and note down here
that we save the matchup itself and the
reason it saves the match up notices the
RM here which is a matchup model not
just a matchup entry is because this
save for matchup also saves the match of
entries inside of it it does both jobs
so that's all good and so really we're
done with this logic we were able to
port it over just by adding this for
each here but up here we still have as
one line and that one line is to update
the matchup remember M was the matchup
where we're scoring well down here we
did all scoring but we never actually
saved the match up and I think the
logical play
to do that is when he mark a matchup
winner because something is marked as
winner we should probably save it the
only question I have though is for these
throw new exceptions imagine a scenario
where somehow he passed in a tie of one
we shouldn't the friends shouldn't allow
it but say it did we get to this point
we score say three entries three
matchups and they all scorp fine the
fourth one
we get to it goes ah yeah tie throw no
exception well that means that we don't
do anything after that we crash the
application back to the UI and say hey
is a problem well in that case we will
have saved some winners to the database
and marked them as having a winner the
problem with that is we try and find the
matchups we need a score we look to make
sure the winner is null so we'll have
items marked with a winner of not null
and yet their parent or the their child
I'm sorry the child the second round
won't have the team competing because it
was never passed through because that
comes after we mark the winners
therefore I think what I could do is I
would like to instead update the matchup
for each of my list in the to score
after I advance the winners at that
point I know everything is set I can I
can mark these as having winners so
let's do that right here now I'm going
to do something a little bit different
just to show you can do it one way you
could do it would be a for each right
here do a for each on the score and say
for each item and the score run this
global config connection to update match
up but there's an easier or at least
shorter way of doing it we can
a to score dot for each let's say x
equals greater than global config dot
connection that update match up X in
that one line I've done this line for
every one of the items in the list of
match up model to score so how does that
work well it's just a for each it's real
it is and it's really just a function
this shortened down so instead of
declaring all that syntax for each item
in list do this code we have shortened
down to here's the variable name of the
for each here's the code to do that's it
so that line is functionally equivalent
to saying for each matchup model X in to
score global config dot connection dot
update Model X this one right here is
the same as this one right there this
one just takes out all this stuff that
it was need to have it knows it's doing
a for each therefore it says I can do a
var here I don't care about the type if
I can figure that out so I don't need
that and it says you've already told me
which want to search through so I don't
need that
that's right here it's an extension
method of that and you've already 24 eh
so I don't need that
I don't need the curly braces but I can
just do it in a one line that's cool
and so I says okay I don't need a
semicolon either there it's all I need
so I
into code done and now you can call this
method from anywhere at any time to
opt-out tournament results for example
in here we have a turret model being
created at the very end of this after
the first round is created with the byes
if there are any we can say update
tournament results model and now we
update that tournament to make sure that
any byes are moved into the next round
and then also behind our form we can
call that as well which is already done
so now let's start this again instead of
create or loading a tournament let's
create one and we'll call this testing
tourney entry fee of 10 team first-place
uncanny losers and SUSE team it sounds
great
we'll set no prizes for this one will
create the tournament notice nothing
happened that's because we actually
wireless button not to do anything yet
it creates a tournament but it doesn't
actually go anywhere from here we have
fixed that
so let's actually fix that before going
further so I'll close out everything
come down to our UI go out create
tournament form and the button we have
to do something now and this is where we
need to do the same thing that we do on
our dashboard we call let's just open up
so you can see it
turn it button we're going to do the
same code right here so actually copied
that and then I pasted it in now we
already have a tournament model you
don't need to load that so we create a
new tournament viewer form pass in TM
which is our tournament model show that
and then we'll also say this dot close
so now it should be that this form
closes after opens the tournament viewer
form let's try this out so notice we
have our testing tourney we'll try one
more though just to make sure we have
this pirate working entry fee of ten and
our team's this is called another test
its creator tournament notice it closed
and this window opened tournament
another test and now we have two teams
here let's mark let's check the ones
that are unplayed notice that even
though team first place was here and so
by if we check the unplayed only they go
away because he already marked as having
played that game and we come around to
will notice that this one is not marked
yet but his team first-place versus team
first place as a seam right so now we've
got to figure out why that is
let's first score this actually that's
not let's not change anything right yet
instead let's look at the data so we're
using sequel so let's first go look at
our team's let's just do a query window
here instead it makes a little easier
I wish the query windows would start
with a whole bunch of lines already in
them because I don't like the idea of
having to go down below and put more
lines especially since if you have no
lines and let's cut as
meant and I say select star from and I
want to highlight this I can't come down
below or go above it just it's messy and
so I like to paste in a whole bunch of
lines or put in a whole bunch of lines
so I'm gonna click down here and up here
and put stuff where I want them select
star from dbo dodge teams let's just see
what that has ins to hold for us we have
three teams that's great
now let's look at the tournaments so
there's our another test that's great
it's active now let's look at our
matchups for this tournament turn it
number four so matchups where tournament
ID not entries tournament ID equals four
and we have three entries we don't have
a winner marked in any of them which is
interesting because we have we do have a
bi-week in here so let's figure out what
what's going on there so let's look at
matchup entries
and matchup entries links based off a
matchup ID so let's look at those
matchup IDs again is 10 11 and 12
where matchup entry between 10 and 12
and that's Yeley Utley because it's not
the right column so it's matchup ID
matchup ID so the matchup ID is between
10 12 give me those values so if you
notice down here the parent matchup
gives it away this is the second round
so in this case the second round the
parent matchup is 10 and 11 and the team
competing is 1 for both of those that's
interesting that doesn't seem right it
seems like we should have that to be
null for team competing until we mark a
winner and don't forget let's run both
of these we don't have any winners
marked for any of them therefore how can
we say that one is the winner versus the
other so team competing in this first
matchup is number one and that's the one
getting passed through to the second
round for both matchups so where there
kind of trace this down in our
application but it seems like we're
writing bad data and some of our logic
we just did didn't quite work so let's
close this out and let's go over to our
lot tournament logic and actually start
right here when we're updating our
turnit results based upon the newly
created tournament so let's start this
again
let's say create tournament recall
there's the debug tourney
we'll say the entry fee is 13 we'll add
three teams will say create tournament
and here you our tournament model let's
zoom in on it and say ok what are the
values here we have three enter teams
that's good
SUSE team on Cain losers and team first
place no you can also pin this over here
kind of it's a little easier is that
it's always over here next let's inspect
these rounds so the first round has two
matchups in the second matchup and I go
down the bottom one first I can go up
and it's it works a little better the UI
here but the second matchup is team
first place versus uncanny losers
matchup round is one notice the matchup
ID is 0
we haven't actually saved this the
database yet that's thing kind of
interesting because we're dead down
below we're saving information to the
database and so that I think is me a
problem so we have oops round 0 the
first one we have two entries again
matchup ID or the ID is 0 so therefore
we got some problems that deal with
before we can even get to the team ID is
correct
before we can even get to anything else
we have to deal with the fact this isn't
saved yet so we called this at the wrong
spot
because that record isn't saved yet if
it's not saved yet then we can't update
it busily updating stuff that just
doesn't work so let's go back to where
we started from the create tournament
form double click on our button here go
all the way through until
we see the create tournament and this
should actually save our tournament note
that over here in the lot the turn at
logic that wasn't that's not what we're
calling here we're calling the global
config connection dot create tournament
that's where the actual update happens
it calls the tournament logic therefore
we can do is after we create the
tournament now we can update our
tournament results now it's gonna yell
at us and say no you can't do that and
that's because we haven't add the using
statements or you don't have access to
that value outside of the term it
logically that's a term it logic dot and
now we can pass in our tournament model
and I think that should work and I'm
pretty happy that but not totally
satisfied and the reason why is I
shouldn't have to say okay now that you
create a tournament now update it the UI
shouldn't leak air so I'm still not in
love with this and cut it back out and
go over to the create tournament which
is actually in two different spots over
here let's look for create tournament
now here's the call for saving the
tournament the prizes the entries and
the rounds now we can pass this in and
again model and here this way we are
saving everything than updating of those
by weeks so that that feels more natural
but don't forget over in text connector
we also have a create tournament
and once we stayed to the text file we
then paste it in and again it's called
model so we're good to go
so now let's test this one more time and
hopefully this time we'll have squash
those bugs so it's important to test
what you're doing this one's probably
broken another test because that's when
we had that issue in the code let's
create a new one anyway we'll call this
one logic fixed let's say $14 entry fee
we'll add our three teams will create a
tournament and now it pops up with our
tournament if we uncheck this we only
get the second game because the first
one is a buy in round two we've not yet
determined but team first place is in
the first slot because team first place
was the one that had the buy therefore
if we mark this one as uncanny losers
wins now there's no unplayed for round
one and round two it's team first place
versus uncanny losers excellent and now
not only do we refactor our code to put
it in the right spot take it out of the
UI and put it into our class library we
also made some tweaks to it so that it
did the job a little better and it
handled things a little more
intelligently and so that's part of the
refactoring part of refactoring is just
making your code run smoother or look
smoother in the way you lay it out but
part of it is also rewriting how you do
things to do them better or to handle
more edge cases or to fix problems that
would otherwise pop up so those are the
two parts of refactor we need to do in
this case we've done both of those
now there's probably a lot more I could
do in this application in order to
factor to be even better but those are
the big ones I want to tackle today I
want to tackle cleaning up some that
stuff that was just kind of left overs
the the mess we created we first started
and we changed our logic and I also
wanted to tackle that one area where by
weeks weren't being handled properly and
we had extra code in our front end that
really should have been in our back end
in the class library so next what we're
going to do is move right into error
handling and how do we deal with that so
stick around for that</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>