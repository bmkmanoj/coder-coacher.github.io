<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>C# App Start To Finish Lesson 26 - Emailing Users | Coder Coacher - Coaching Coders</title><meta content="C# App Start To Finish Lesson 26 - Emailing Users - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/IAmTimCorey/">IAmTimCorey</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>C# App Start To Finish Lesson 26 - Emailing Users</b></h2><h5 class="post__date">2017-10-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/dSXxLyNd2tw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome to lesson 26 in a c-sharp from
start to finish course my name is Tim
quarry and today we're gonna create code
to email our users remember that our
requirements we specify that only one
round could be played at a time meaning
you can't play a game from round two
when games from round one have not been
finished yet that means that when it
complete around we need to let the teams
know who you're playing next so with a
little bit of logic and a little bit of
code I think we'll be all set so let's
get started
the first question we have to answer
here is where do you put this code and
you want to put it somewhere that we
know it's going to be called the right
number of times we don't want to be
calling this all the time and having the
users get spammed so I think the best
place to put it is actually in term it
logic in the update tournament results
and here's why in here is where we
update our our matches we say ok this is
the winner that's you know checking the
windows right there and then it's
advancing the winners to the next round
and it's updating the values that in the
files or the database so it's at this
point that we're actually moving people
to the next round and it makes sense
that if we're moving people to the next
round
that we may have been come we have may
have completed around so here's what I
do at the very start of this before I do
anything else I want to find out what
round were in so I'm gonna say which
which round still has match as we played
yet which the lowest round and so say
we're in round one and then I go all the
way through here at the end I'm gonna
check again which round are we in and
those two values before and after are
the same round I don't do anything we
haven't changed rounds but if I start up
here in round one and when I come down
here after everything is done I
round two that means we've changed
rounds and I know I need to let everyone
in round two know they have a match up
so that's I'm going to determine when to
run this and let's get that set first
before we actually even write the code
for what to do
so I actually write a separate method
here private static void but no int
return number miss Li the current round
I'm gonna call this check current round
and pass in this an extension method so
I pass in tournament model not team
model there we go this tournament model
called model now I'm making an extension
method just make it a little bit simpler
for me to use now notice it's private
meaning it can only be an extension
method in here I don't feel I need to
count this anywhere else if I do a point
in the future eyes come back and change
this to public all right so first we
needed int output equals let's start it
at one and I'll show you why in a minute
now I'm gonna do a for each I'm gonna
say for each list of matchup model cut
round in model dot rounds so for each
round in my tournament model I'm gonna
do this if round dot all now this is
going to use some link here we've done
before it's just we haven't used all
before but I think it's pretty
self-explanatory what does what does is
says this returns a true or false
if all of the items match this criteria
we're gonna give it then return the true
otherwise if some don't
or all don't returns false so rounds
doll now previously we also use rounds
dot any meaning if any of these are true
have is is true this case is all so X
dot winner not equal to no so I'm doing
here is saying okay that's returns a
boolean I'm saying look in every single
match up inside of round say this is
round one at first and so we say does
every item have a not null winner
meaning every single match up has a
winner well if that's the case and the
round is complete we don't need to do
anything else we know that this round is
complete because everyone has a winner
so what we do in that case I say output
plus equals one so let's think through
this logic of why I'm doing that
if pretend we have a three round
tournament round one every single match
up is complete round two we still have
two outstanding matchups so round one
comes in here we say is every winner not
null yes that's in round one so round
one we know it's complete so therefore
we come down here and hit this and this
says add one of the output will output
started at one now it's two we come back
through here in the next round there are
some incomplete winners meaning there
null so this is false so it does not run
we go the next iteration the next
iteration also has incomplete rounds or
entries
because you can't have a completed round
after an uncompleted round so round 1
and round 3 can't be complete if round 2
isn't therefore we keep skipping over
our subsequent rounds we get to the very
end and return output and output equals
to the current round because he I
started at 1 and said if there's no
matches if ever nobody has a winner yet
or no round has no incomplete winners
meaning every round an easy plate so if
we do that we wouldn't hit this if ever
since we returned back one but if found
1 is complete we say well it's not round
1 let's go to the next round and try
that so that's that's the logic there so
last thing you do is return output and
actually all we need to do create that
extension method so now in the update
tournament results I'm going to create
an int starting round equals model dot
check current round and then at the very
end I'm going to say int ending round
equals model dot check current round let
me say if ending round is greater than
starting round that means that we have
advanced around then this is where we
alert users and that be where we email
them now this is where I'm going to
actually add a new class to our tracker
library it's been a bit since we did
we've done a new class and the reason
going to add a new class here I call
this email logic
is because thinking about how email
works and how useful it can be for
alerting users I'm thinking maybe we
want to alert users about more than just
their upcoming match and so I'm going to
extract this out so I can call it in
other areas of the application I mean
think about when you first have a
tournament where you have say a $10
entry fee we could when the turn it
first starts up we could send them an
email that says hey you've been entered
in XYZ tournaments please send us $10 by
X date or whatever and then we can also
send another email that says oh by the
way you're matched up with Sue's team we
could also potentially email every team
member after the tournament is complete
letting everyone know here's who won
here's what the payouts were whatever
and so I can see more than one place
where we might want to email somebody
and in fact when it comes right down to
it you'll probably find that you build
your own library of useful useful tools
I've got a library it's full of tools
and so what I do is I bring that library
in and then just call those tools so
instead of creating an email logic class
every time I want to email somebody I
just call my library and say give send
me an email
it's an email and so that way you don't
have to reinvent the wheel every time I
mean I have stuff for FTP I have stuff
for email I have stuff for connecting
different servers I have stuff for
saving and loading files and converting
CSVs and a whole bunch of other stuff
that I don't want to do more than once
and that's why a library is really
helpful for that and this would probably
be put into my personal library that I
then bring in instead of putting into
the application specific library like
tracker library
so abstract it to its own class allows
us to get one step closer to having into
our own library it makes it that much
easier to put it in our own library
because we didn't just change just where
it's calling and that's it it's a public
static class I don't need a story
anything long-term here so I'm gonna say
static logic 10z more on a static side
versus models like for our data that is
also are always instantiated you don't
have a model that's not why I should say
almost always we do have the global
config which has data in it and that's a
static class but that's a really special
case so let's create called public
static void send email now what parts do
we need to have in order send an email
well we need the string from address
who's sending it then we need a list of
string for the to address I'm gonna
leave it just those two and I do the CC
and BCC we could but for this version
it's not necessary we could make this an
overload later where we add those we
need a subject and we need a body I
think that's about it so now over here
we can say email logic dot send email
now the from the to the subject in the
body those are all question marks right
now so I'm going to do is comment that
out but that's what we're gonna put it
now we've got two places we need to do
some work over here we need to call this
for every team and actually every team
member in every team in every matchup in
the round this represented by ending
round which is also the current round we
also need to know who we're sending it
from and then the subject and body so
the subject reading price hard-code the
body we might actually want to fill some
information in so I'll probably create a
separate private method for that so
let's start with setting up this end of
it and then we can get into how do you
actually send an email because really we
can send all set all this up and have no
clue how to do this and be fine
we can get everything working and
instead of actually doing working here
hit is log yes I got from a to subject
and body and our application runs and it
does what it's supposed to the only
thing we're missing is the actual send
which we can research and figure out how
to do now we're going to see how to do
it in this lesson and I'll show you but
I just want to make sure that you know
that even if you're stumped on a part
that doesn't mean you stop entirely do
what you know in this case we know how
to create a subject line we know how to
figure the to address because that's in
the team members properties so we know
that information all we need to do is
create the the loop that goes through
and creates those emails then we can
come back and do the actual email itself
so the first thing that we need to do is
we need to figure out do we do the logic
in here or call a another method and I
think the answer here is we call another
method because this job right here
update terment results it's a
quarterback method
it mostly does the call somebody else
and make it do something and so we don't
want to add a whole bunch of logic in
here which makes this massive it's
already pretty big so instead you want
to create a method that does one thing
private static void send email let's
let's say alert alert users to new round
it will pass in this tournament model
model again it's an extension method now
the only will pass in so you don't they
call it again is the int current round
now we could instead of pass in the end
they could call the check current round
again and maybe that's okay maybe it's
not it's really up to us and you know
what as I'm thinking about it maybe we
want to call this without doing this
check and so we say you know what
doesn't matter if we've already lured
them
I want to lure them again now do we have
that logic in place anywhere no could we
at some point maybe so if we take this
requirement out and find out the current
round right in here then we make it a
little bit easier to be called and this
check current round isn't a big deal as
far as as time goes or processing power
is like that so yes we're wasting a
couple of cycles of CPU but just a
couple not may next clip extract out
list of matchup model distract out the
current round now I call this in current
rounds I can't do it for both of them
it's a current round number versus
current round now I could do a and I
have toyed around with this I don't like
going through it and looping over and
over again craze loops it just more pain
than anything else and link is pretty
powerful so let's see if we can rail
link statement that would do we need now
remember it's a list of a list of model
so that's where our problem is we're
kind of looping twice but for round we
could say is model dot rounds where x
equals greater than X dot first dot
match up round double equals current
round number
I put one too many closed parens there
and I also have to do two lists but a
fault returns an ienumerable I believe
as if cannot implicitly convert type
list to list and here the problem it's
not two lists its first and the reasons
first is because even though this is a
list of matchup model and I my first
assumption was oh we output a list but
we don't remember that our rounds is a
list of a list of matchup model
therefore one entry is all we need
because that that one entry is a list of
matchup model so what's this complicated
thing doing well we have our list of a
list of rounds we're saying we're so
we're a loop through each round here and
I said inside so as this would be a
round X does is so X is around we say
the first entry and X which would be
since X is a list of matchup model it
would be a matchup model so the first
entry in in X if that matchup round
equals our current round then grab that
entire X where X is a list of matchup
model so it
ABB's one round where the first matchup
in that round has a round number that
matches the current round number you get
that you might the draw on paper is
something and kind of write down okay
you know round one has four rounds and
or four matchups in it
round two has two matchups in round
three has one matchup in it and you know
put values against it and just kind of
visualize what this is doing if you want
to go as one-liner route which I
understand what you would do instead is
do a for each loop over the the rounds
for each round and rounds and then you
would do inside there if that round dot
first dot match up round equals current
round number if it is put the whole
value in current round so it is just a
4h as all it really is so now we have
the current round number which allows me
to get the current round which is a list
of match up model now any if for each
that's a match up model match up in
current round so these are all the
matchups where it's a new round so we
have to alert all the teams and all the
team members about the fact that this
new matchup is set so now I have a
matchup but inside each matchup I have
to loop through and let team members now
so now I'm gonna do if another for each
and say for each matchup entry model
I'll call it me in matchup dot entries
there's two matchup entries per matchup
so we have you know two teams facing off
so this M represents one team's entry so
now inside here for each team for each
whereas say in M
dots I'll skip over the first tooth mint
in the Emmy dot team competing dot team
members and what type is team members
it's a type list of person model
therefore each one would be a person
mole
so for each person in the teams
competing a team competing CCS works a
match up we have multiple matchups in
the round so for each matchup we have to
look at the two teams competing that's
this whatÃ­d that's what this is inside
of a specific team competing we have to
look at every team member and pull out
their information because it's only now
that I can see say P dots
email address but now I should have all
the information I need so let's create a
new method signature and will actually
create right here and then go actually
create it surest say alert person to new
ground so this is alert users to me
round that B in general this is alert a
specific person to a new round and we're
gonna pass in some information what we
need
well we need P dots
once it's passing P first because that
gets us our first name our last name in
our email address so we have all that
information bundled up
then we also need to know what team
they're on well that would be me
dots team competing dots team name and
that's all we needs a team name and then
we know who they are competing against
so that beam the matchup matchup they
say entries this is another link query
here where x equals greater than X dot
team competing is not equal to me dot
team competing and what does that do
what that does it says in the parent
matchup I know we have two teams
competing therefore get me the other
team that's competing and I'll say dots
first let's actually do a first or
default just in case this right here
this this two entry only has one team
think by week so alert person to new
round and we're gonna send this out and
say ok you know email user and say
you're competing you know you're on this
team compete against this team in this
round so let's create this new private
method we can do a control dot here and
say generate method and that's kind of
nice it puts it right here and it's
private static void which is exactly we
want person model P great just
ringg team name great matchup entry
model matchup entry model that's
excellent okay so it knows all the
information in fact look at this we said
pass in this property value which is the
property name is teammate it said well
I'm assuming what you want for a a
variable name or a parameter name would
be team name but that to you be
lowercase because is a parameter which
is exactly what since we're passing in
an actual full model here and we're
doing it via link query it couldn't be
quite as intelligent and so it said
since I don't know I'm going to call it
the same as the class name just with a
lowercase first letter because again
it's a parameter so we can be a little
clearer here competitor and remember
over here an email logic we have a send
email so we're gonna say let's create
this first up here email logic dot send
email and we need a from which don't
have yet we need a list of string for
our two we need a subject and when you
have body so I'm going to say string
from equals empty string for nouse
string to equals empty string for now
string subject equals empty string for
now and string body equals empty string
for now the only one that's that's
actually wrong here is this needs to be
a list of string because you can send to
more than one person and I could make
this method simpler by just saying only
except one
but this is how it's taken in the actual
send email so you'll leave it that way
so we have all of our parameters we just
need to start filling them in well a
soda is probably easiest one we could
say you have a new match up with and
I'll fill that in a mint you can say
dollar sign and I'll say competitor dot
team competing dot team name so it's
gonna say you have a new match up with
the Rolling Thunder
or maybe Tim's all start or something
whatever team name is you compete
against now the only problem here now
probably changes logic it a little bit
copy this and let's put it back to our
double quotes I'm gonna change this to
be down here if competitor is not equal
to null there we go because if there
null that means that you are competing
against the by week so I said if you
have a new match up you could say you
have a bye week this round so that's the
easy one now let's figure out the body
that should be a little bit longer but
not really hard and we're not going to
get into a super detailed body but let's
use a string builder for this
if you have any is a stringbuilder
before what its job is is to concatenate
strings meaning put two strings together
in a way that is efficient and the
reason why is because adding strings
together is very very inefficient
essentially what happens is the first
string in the second string you can add
together each of those gets allocated
memory space and then new memory space
has to be allocated to take each of
those values and put it in the new spot
and then the first two memory spaces are
d al-kidd and that's just for one
addition of two strings together think
about a string we are adding hundreds or
thousands of parts together if every
time you add a new string you have to
create a new memory space and move that
new that combined strength into the new
memory space it gets really really
memory intensive to the point where if
you're doing say a hundred thousand of
these concatenations which may seem like
a lot but think about going through a
loop especially reading from database so
you're doing you know ten concatenations
for a person's address you know the
first name their last name a new line
that's three their street address one
it's for the new lines five the city to
state the zip you know at six seven
eight plus a space that's nine ten and
now your ten concatenations for one
address now do you have ten thousand
addresses in your system if you do it's
a hundred thousand concatenations if you
can take each one of them at that point
you will see a noticeable slowdown in
your system to the point where you wait
for something to happen and that's just
not normal for applications you don't
sit there and wait for some of the
habits pretty much instantaneous so
that's where string builder comes in now
I'm not gonna go through all of what
Strangler does but just know that string
bill is very very efficient in how it
adds strings together
to the point where you can do millions
of concatenations without seeing any
slowdown so what I'm gonna say is SB
equals I'm sorry dot append it's a
little different you see job hand nestle
the first line of our body so I don't
say something like let's put h1 here
we're gonna do an email text here you
don't have to thought HTML emails are
pretty common and allows us to have a
little more of a flavor to the email a
little more pop and zip so we're gonna
say header first and we'll say you have
a new matchup and now be it for that
first line and I'll say SB depend and
actually law changes to be a Penn line
you can also insert a pen line you could
append a care to turn in here and that
would be look like this they'd just be
append and it would be environment dot
new line that we the same as doing a
Penn line if you appended this after
this so if you don't want to do a pen
lines you can do this if you want to
have lines and weird spots but don't
want to you know stop it you're doing
you do that is just an option in this
case I'm gonna do a Penn line and let's
do this let's do a I'm not gonna do a
paragraph tag I know my price should but
sue me I was gonna start off with strong
which bolts something in case you know
and oops I need to put in side quotes so
strong and I'm gonna say competitor
and then I'm going to actually do a pen
not pen line do I have control over the
fact that you're not doing another SB
append that this is the one that
actually gets the the new line at the
end of it so I do append and let's put
the and strong here too and sieve quotes
I'm going to put competitor dot team
competing team name now again if we're
not having a competition with someone
else we can't run this code and so will
actually create a separate will put an
if statement afterwards and create a
separate message for them it will make
them a little bit simpler because it's a
bye week so I don't want to do a pen
line yet
I wanted to append SB dot a pen line
this time and actually it's all do I
almost have the name I will go in
further and then I'm going to do s be a
pen line again going to add a blank line
SB dot a pen line have a great time put
an exclamation point there for add
emphasis and SB dots a pen line and
we'll put the squiggly line and say
tournament tracker sign up with our name
our applications name now it could go a
little more elaborate if you want you
can create a whole email in here that
would be you know we could have things
like what turn you're playing in and
maybe
was score the last time his team played
so you'd know what's happening so far or
just a status of what happened last
round and have a whole bunch of
information in there but we're gonna
keep it simple because the point is
dental is not to make an awesome email
the point of demo is to application
right now is it just alert them so let's
wrap all of this in if statement and
actually we already have the EFC been up
here so I said I cut this and I'll paste
it right here and for down here I'm just
gonna say SB dot a pen line enjoy your
week off or your round off it will
append that same signature line so it's
a really simple one but that way we
least have something there okay so we
have our subject and we have our body so
we're getting close and actually our
body we can take out the body here I can
even call this body instead if you want
let's do that I'll do a control dot to
rename SB to body but notice down here
it still yell cently because it's a
stringbuilder but we have a two string
and that converts a string builder over
to an actual string so two down two to
go
let's tackle the two next two is pretty
simple we say two dot add P dots email
address so we're adding the email
address of the person who were sending
to that makes sense that does raise one
question though what if they did not
give us a valid email address
we don't want to send email to a person
who doesn't have a valid email address
therefore at the very beginning here
before we even do any variable
declarations let's just say if P email
address length dot length equals zero
now there's much more comprehensive
checks for email addresses even as
simple as checking for an @ symbol and
checking for a dot because you have to
have both of those you know so Tim at I
am Tim quarry dot come any can get more
comprehensive if you want but email
addresses are actually really really
hard to check for and get right usually
what happens is we have a check that
gets us and 99.5 percent of the way for
example what about an email address that
has instead calm at the end if it has
dot blog well blog is four characters
not three but that's valid and so you
can also have dot Co which again is
valid but it's two characters this is
hard to check for a number of characters
at the end because we keep adding these
weird new domains where the extension
instead com is something else top photos
or dot business or dot biz or all the
rest and so checking for a valid one
though is is a little more difficult
without going to the internet and saying
is this a valid domain and then the idea
of how long it can be an email address
can be really long and that's still
valid it can also have some special
characters in it which also is still
valid so you can get into that if you
like and what you'll end up doing is
creating what's called a regular
expression or regex and a regex
allows you to pattern match on something
and say is does this match the pattern
or not and that's what you probably want
to do here just be careful because a
regex pattern
match is an expensive operation it takes
a lot of cycles and so if you do that on
a hundred thousand records you guys slow
down your application maybe not as much
as string appending I'm not sure I'm not
sure I had done the a comparison test
but it'll still be significant so be
careful how often you do that if you do
that going into the database maybe don't
do it when it's coming out in my case
I'm just going to verify that it has an
email address it's all I care about so
if the email address dot length equals
zero I mean there's nothing in there
then just return I don't want to alert
the user and he'll look at that because
if you didn't give us your email address
you don't get an email I don't
understand why that would be confusing
to anybody they shouldn't come to you
and say well I'm not getting me emails
did you give me your email address well
of course not that's why you didn't get
to email so we don't need to alert the
front end or anything else like that we
just return now remember that this is
for one person so it will go on to the
next person so if you have four members
in your team and three of them have
email addresses you'll send out three
emails to those three team members one
each of course so it just won't go out
to the fourth member so here we have a
check to make sure you have an email
address we're populating a subject the
body and the to field the only thing we
have left is this from field who are we
sending it from and I think at this
point we need to put this inside of the
app config that seems the best place
because we may change it Japan who runs
the application so let's go to app
config let's add a new key
key equals sender email value equals and
I'm gonna give it my email address for
now it doesn't really matter because
we're gonna actually set up a dummy mail
server so it's gonna capture all the
emails it will allow anything in but
just for this demo we'll put this my
email address in now we need to get this
information back out but I've been
thinking about that and if you look here
we have three values now coming out of
apt I config well why do we keep calling
the app config lookup which grant isn't
that hard but why do you keep calling
that every time I want something from
the app dot config let's put in global
config instead so first an example that
code which that's the heart inside Tex
connector the full file path f12 there's
where we look up the app settings
information I'm gonna copy this I'll
close those two out now go a global
config and somewhere in here let's put
the bottom public static string and
let's call this app key lookup and we'll
say pass in a string key and we get back
the value so we'll take this key and put
it here
and we'll return there's a value now
really I'm just wrapping somebody else's
method but I'm gonna do that I'm gonna
wrap it because first of all it's it's
simple for me to say all your global
stuff is in gold with that config or
global
Figg dot but - I can also add more logic
later to this that says if a key is not
available here's what you do
and also maybe even log every tank
called a key or a whole bunch of other
things you could possibly do one of
those could be the down the road we
don't store an app dot config but maybe
in a MongoDB database
why because Mongo and so all we do is we
would rewrite this method instead of
calling the app settings you'd call
MongoDB look up that value and return
that value we'd still pass in a string
we still get back a string so all our
callers don't care now we're allowed to
disconnect from the abduction fee if we
choose to go a different route in the
future or even have a fallback route
maybe we look up in the app ducking fig
if it's not there we look somewhere else
so it's a lot I could do here and since
is abstracted there's a lot we can do if
we just use this in order to change it
we have to change everywhere recall this
to be something else so that just seems
more logical to me therefore now we can
say from and notice it says at from
because from is a reserved keyword
that's why it's blue oops so instead of
from we're gonna say from address
yeah short words tend to step on toes
it's more often than not they're already
used so from equals global config dot
app key lookup and what's our key name
our key name is sender email now you put
that there and now we're calling the
email logic to send an email with all
the information we need so to recap we
are gathering and checking a see if we
need if we need to alert the users
because the round has changed if we do
we need to pass in our method alert
users to move around it will pass in the
tournament model which is called model
and what this does is it finds the
current round and then says give me all
the matchups in that current round then
loops through every matchup every
matchup entry in each matchup every
person in each matchup and alerts that
person with all the other information
that there in a new matchup so all that
code and we never actually wrote
anything to actually send the email no
worries oops not not that one I thought
I had that in a clipboard but let's
let's change that as well from address
I'll keep the same thing that way it's
just not confusing but that way we don't
step on toes again with a reserved name
so we haven't actually written our code
to send email yet and yet 95% of what we
need to do is already done now just need
to do the 5% that maybe is new to you so
but doing 5% it's a whole lot easier to
look up and research and do then to get
overwhelmed by all I have some
to do just right in abstraction you know
you need this information do the rest
your code then come back to it and
complete the abstraction so the first
thing we need to do is add a using
statement using system dotnet male guess
what it's built in isn't it awesome now
inside our send email we have to create
a mail address I call this from mail
address equals new mail address and
here's we can put in either a string for
address a string for address and a
display name
well we didn't we didn't bring that in
or address display name and encoding we
don't use it in code so the question is
do we want to modify the display name
and if so we need to pull that
information in and it's at this point
you should start thinking we'll wait a
minute why are we even passing the from
in if we're just pulling it from the app
dot config anyways and that is a great
question and so my answer to you is I
don't know so let's get rid of it
oops before we get rid of it let's copy
this line
and that will not pass in either so now
we're not even passing in the from
address because a new mail address and
the first parameter is the actual email
address and the second one is the name
I'm gonna put it right in the app tech
config MSA instead of sender email I'll
say sender display name I'll take that
value go to my app config oops I pinned
it accidentally and say add key equals
Center display name value equals Tim
Corey there's a little bit nicer so now
we have our mail add jar from mail
address and that just establishes who
this is from
and so it's obviously more than just a
string of the email address because you
also have the sender name and a question
you may raise is we'll wait a minute
could I specify any from address and the
answer is sort of depending on your mail
server provider and you'll have to
provide one
but even Gmail will allow you to send
through them so depending on your mail
server provider if you say you know if
my domain is I am Tim Corey calm and I
say you know instead of saying Tim for
my end of Tim Corey calm I wanna send
from Bill at gates net he would probably
say sent from Tim and I am Tim quick
calm on behalf of build bill at gate
calm or net so it's not gonna just spoof
it for you otherwise that would be a
dangerous dangerous system but it will
allow you to specify your send email
address now some mail servers will
checked the email if it's not coming
from the address of the account so you
just have to know that and test it out
and see what works for your provider but
this should work especially in our test
environment and now we're going to set
up a mail message I'll call this mail
equals new mail message it's an instance
of the mail message class they say mail
dot - and notice that it is a collection
so we can't say equals two because that
won't work we have to say dot add and
add each address now that means you can
loop through our from our - well here's
the next question do we really need a
list of string here and to support
multiple now in the future yeah probably
may you want to send one email to every
buddy on the same team
so you'll all get the same email so
that's possible but for now let's dumb
this down and say just one to address
and I can create overloads later that do
multiple in which case we have to come
back over here and changes back to a
string this
kind of tweaking your I do a little bit
that's okay so now I've changed it back
to a string so I'm just passing one in
which allows me to do this now let's add
that to like so next we'll have the mail
dot from and that equals from mail
address mail that subject equals subject
mail dot body equals body notice how its
simplest getting the last one I always
do is mail dot body is body HTML so
that's down here is body HTML and I say
true this is where you set whether or
not you're sending HTML enabled emails
and I like HTML enable emails there's a
little more fun so yes so that's all we
do to set the actual mail message and
now we say SMTP client will call it
client equals new SMTP client client dot
send mail and that's it so we create the
message and we say yeah go ahead and
send that now you can also send
asynchronous if you want to have an
asynchronous operation but I don't care
to do that right now and the other thing
is if we run this right now it will
crash and here's why
where have we told it what our mail
server is where it talked to it what the
credentials are what ports talk to we
have it now we could do that right here
and say client dot for example port
that's the port for our Meltzer but
where do you pull that from well you're
probably a low ball config dot app key
look up and have you know email port
well guess what we don't have to do that
because Microsoft built a system net
mail grouping and said yep emails pray a
big deal in applications so they also
create a spot in the app config to put
email configuration so under system
dotnet now acute an app dot configure
web config is just make sure that you're
not duplicating a system or setup that's
already there so I wouldn't create a
second connection strings down below I'd
put my entries inside the existing
connection strings so always check to
make sure you don't already have a
system net before you add one inside
here we're gonna say mail settings it's
all tidy designers for us
we're sa SMTP delivery method equals
network so you can pick up from is if
you wanted to or specify a pickup
directory essentially that would do is
it would create the message I believe
the dot e ml file and it would put it in
a folder and say ok your email address
email server can pick it up from that
folder we're not gonna do that
we're actually us in the email across
the network that's the most common thing
to do now in here we have a specify that
network so host this is your email host
it's where you talk to them usually a
web address for us or us and locally and
here's our key here make sure that you
test it locally first don't just blast
out emails to the greater World Wide Web
before you know for a certain that you
actually intend to send those emails as
production emails so let's be careful
that either gonna send yourself for at
first test it locally first and then
send it through your network so if you
had a username and password this where
you put that in I don't have using a
password so I'm gonna simulate one
notice is not my username and password
is a report and if you want to enable
SSL I'm gonna say false for now and the
reason I'm saying false for now is
because my SSA or my SMTP client the
things gonna capture my emails I don't
believe it likes SSL so I'm turn it off
for now when you actually send real
email you'll probably turn that back on
because your host provider I'll probably
say use SSL I believe for Gmail the port
is 465 and you turn SSL on and then you
get your username and password and I'm
not positive what the host is it's
something like smtp.gmail.com or
something like that or google.com to
find out your provider just Google SMTP
and your provider name and email and it
will it will give you usually a pretty
clear path to finding that information B
this is actually pretty common we're
doing the same thing as what any mail
client would do so it's not something
out of the realm of normal this is
normal for for email providers to do so
this I'll set up the one thing I'll show
you and I'll bring it over here this is
the tool that I use it's called paper
cut and paper cut is an amazing tool if
you notice right down here is paper cut
codeplex com
that's where you can get from it's free
and what it allows you to do is it
sure's emails that come in and they come
in he'll populate like it wouldn't in
Outlook and you can look at the actual
email the message even the headers the
body of the section the raw email itself
and all the other information that way
you can diagnose am i sending emails
properly or not so we're gonna use that
and once we start this I will I'll pull
it up alright so here is our our turret
dashboard let's create tournament just
we run through the entire process we'll
call us this tournament emailing entry
fee is $10 let's add let's add just
three teams from now that we can have a
bye week and we'll create the tournament
so now we have a tournament where we
have first round we have one unplayed
match so in this unplayed match let's
set team first place to be the winner
now look at that we now have four email
in our mail client let's look at the
first one the first one says sue is
storming out net you have a new matchup
with the uncanny losers let's look at
round two as we can see it sue is on
team first place so have a great time
next is bill at smithy calm you have a
new matchup with team first place so
bill is on on Cain losers next is 10 I
am Corey Tim Corey calm I have a matchup
with the uncanny losers he's on Team
first place and then sue is storming up
net she has a matchup with uncanny
losers so there's our four emails
and so because we have more than one
player per team therefore we have a
total of four players in this next round
and so each of them got a matchup alert
the one thing we didn't get you may have
noticed is we didn't get alert for the
first round only for the second round so
and by the way when I hit the X in the
corner of my mail client it didn't
actually close it just minimized which
is great
they ain't bring right back up I can
also delete these messages okay so this
all worked except for the fact that
we're not actually emailing people when
the first round happens so all we do is
we call this alert users - new round why
isn't it firing for the first round well
the first round
the rally always check first notice that
it starts off with one and if the first
round has a non winner then we don't do
anything else we say that we're on round
1 we never say we're on round zero
moving to round 1 so when we do a
comparison and that's up here we say
starting round and ending round the two
the same they said we've started around
1 we ended in round 1 but the reality is
we've started from nothing so we have to
do it at least once but we can take this
alert users to new round and we can
actually call it from another location
now here's the only problem right now we
actually call us backwards we don't need
to do this we actually say model dot
and we actually put the parens because
it's an extension method we need to pass
it in now the only problem here though
is this is private so let's change the
public and now we can take this alert
user to new round and we can go to our
code behind for our create tournament
form I just go the front of the code the
front of forum and double click here
that taste is right to this spot we need
to be so now after you create a
tournament we say TM dot
alert use it to new round and now
because we have a turnip model and it's
fully populated it will email on the
first round notice before we check to
see if the round had changed well we
know around has changed therefore we can
call it directly and that's me all there
is to it it really was much more work on
the logic side to see when to send an
email that it was to actually email
someone that's all the code for actually
emailing besides this one line of
settings are a few line settings in the
app config that's all there is is
sending an email so it's really not that
hard now I did create some abstraction
here because if you are a user that's
viewing us on I am Tim Cory comm if you
paid the defeat of view this course in
its entirety all up front then we're
going to add the ability to text users
as well instead of a text message saying
hey your new round with this team has
has started or you can put your next
matchup as this team so we'll text that
to users but that's that video is is
after the course kind of ends we're
gonna pen that on for the paying
customers to see how to do that as well
and that's just my thank you for hey
thanks for paying I really appreciate it
so so that
we'll be a pretty simple change because
I'll put it just in the alert so instead
of just emailing we'll also in here
cinema text all right so that's that's
coming up if you're a paying subscriber
if not you might want to consider paying
get that little bonus there's a whole
lot more bonuses besides that but for
now that wraps up emailing which means
that our next video will be the last in
a series and this video is all about
wrapping up the application we're not
quite done yet the application works and
its entirety except for one little thing
when we get to the last round and we hit
score for the last matchup we should do
something right he's right now nothing
really happens so we're going to do
things like marking the tournament as
inactive meaning it's no longer an
available tournament and we're going to
alert the users hey you know two one
enough stunning upset I don't know so
we'll alert them and we'll also deal
with the prize money we haven't dealt
prizes at all yet because we haven't
needed to now at the end we're gonna say
okay here's the income from a tournament
so if it's percentages we'll make sure
we take care of those and then we'll
send out probably an email blast saying
you know Tim won the tournament he got a
hundred thousand dollars every else got
nothing so we'll take care of that and
we'll be done so that's it for now make
sure you stick around for that next
video where we wrap things up and
congratulations on getting this far
can't wait to finish up with you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>