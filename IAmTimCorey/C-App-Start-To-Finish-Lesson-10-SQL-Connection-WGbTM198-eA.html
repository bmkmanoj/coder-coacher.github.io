<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>C# App Start To Finish Lesson 10 - SQL Connection | Coder Coacher - Coaching Coders</title><meta content="C# App Start To Finish Lesson 10 - SQL Connection - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/IAmTimCorey/">IAmTimCorey</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>C# App Start To Finish Lesson 10 - SQL Connection</b></h2><h5 class="post__date">2017-06-12</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/WGbTM198-eA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome to lesson 10 in a c-sharp from
start to finish course my name is Tim
quarry and today we're going to look at
connecting to our sequel database in the
last video we built the prize form we
only wired up to the class that
pretended to talk to sequel now we're
going to actually take out that sample
code and put real code in place to talk
to sequel so let's jump right in
before we get started this lesson I
wanted a quick man to help you out if
you're anything like me you probably
have a friend or relative who thinks
that because you do something with
computers you must know how to fix their
computer I don't know how many computers
I've fixed over the years so I excited
come up with a better solution so I
built a course that teaches anyone how
to properly maintain their own computer
I call it PC maintenance for the rest of
us and it cost us 29 dollars I show
people how to download free software to
protect their computer including an
anti-virus a malware scanner and online
file storage applications then I show
them how to use each one as well as how
to maintain a computer after its cleaned
up so how does it help you well what I
do now is I tell people they have to buy
this course watch it and do it says
before I'll work on computers that
solves most of their problems both now
and in the future and they can do the
same for you you will find a link for
this course on I am Tim quarry calm as
well as in the description below
do what I do and you will not only be
helping me out you'll be helping
yourself as well ok let's get back to
the lesson here we have our solution our
two projects in just the way I've review
down here in the tracker UI which is our
user interface in the program CS we made
a couple modifications the first thing
we did was we added this line right here
and what this does it wires up which
database or databases we're going to
talk to so this case we're connecting to
both sequel and the text file and then
next we change the application run from
the tournament dashboard form which is
going to be our
our final four in the actual real forum
we change it to our prize or create
prize form so we can kind of test things
out make sure things work so there's a
couple of the important changes we made
to the program dot C s which is where
our application will start since tracker
UI is the bolded of the two projects
which means it's the startup project so
Before we jump in today I want to make a
couple of modifications to our library
though the first modification is a lot
cleaned things up a bit so I'm going to
right click on my library and say add
new folder and I call this folder models
I'm going to drag anything it says
models at the end into this folder just
click and drag
there you go so there's a folder fill of
models and that just helps kind of keep
things clean because now I can do this
and all of a sudden instead of having
you know eight or ten CS files in this
one list all the same level we can now
kind of break these out by level now
that didn't change anything and how
those models work the folder structure
really doesn't matter except here's the
one exception if I were to add a new
item now so I right click and say add
new class let's just leave us as class
one since we're in delete it I want to
show you the one change that happens so
let's get team model for a minute team
model the namespace is tracker library
if we go to class one the namespace is
track your library dot models and that's
because by default what happens is that
when you're inside a folder and you add
something new it takes the path of the
namespace it takes from the project name
and then any path down to it so if I had
models then in here a folder called
people they would say tracker library
dot models dot people so that's just
something note
now when you drag a model or a class in
here when it was not created here it
will not add that into the namespace
because adding that namespace would
break our application because we are
playing to the root of this for all
these models if we were using them
mostly we aren't using yet but that
means you have a choice to make you can
either change the namespace and all of
these to match this tracker library dot
models or you can leave it off if you
leave it off then you'll have to
actually add new one just take it off as
well and that's really up to you it's
really you want to have that separate
out or not I kind of do
and the reason why is because that way
it differentiates this is a model versus
this is a class that does something okay
a model just essentially a model holds
data and so we call it a model just to
differentiate it from the stuff that
does work like global config Google
config does work it does hold
information which remember that's our
the use case is not normal to be a
static class and have static property
here but it does hold information but
really it's doing work that's his
primary job whereas the person model
it's only real job is to hold
information about one specific person so
in this case I'm going to take this
namespace right here and then actually
add it to all of my other models
he knows per minute that I had red
squigglies and that's because they were
referring to other models and the
namespace has changed now whatever
namespace you're currently in you don't
have to have a using statements for that
namespace so you name a namespace or
using statement for the namespace
Trekker library dot models because we're
currently in that namespace but if I
were in the namespace trekker library
then I would need to add that using
statement in order to bring in these
models without putting the the past
models dot team model if I put models
dot it's happy now because it knows what
the namespace is because again the
beginning is actually assumed the
beginning would be the tracker library
so
the full path but this is assumed
because we are in the trekker library
namespace so now we can take that off
and once you take that off as well and
we're now in the models library alright
we can delete that class one that was
just an example okay so there we go
we've got our models into the model
folder and now I'm going to do a little
more cleanup I'm going to do another
folder let me call this folder data
access and these names aren't
necessarily really important it's just
for me to know what this is for
and so that's case I'm going to move and
here's the debate global config to move
that into data access I say no because
it's not really about data access it's
about configuration and so going to
leave it alone
but I will move the I did it connection
the sequel de sequel connector and the
text connection and that also brings up
another issue which is this is named
differently than this we have single
connector and text connection so I'm
actually going to rename text connection
to text Connect or so let's rename this
to text
connector and sensei would you like to
also rename the project in all its
references to text connection so it does
it says over here
OOP it was named text connection let's
change it to text Connect door which is
why I renamed it over here in the file
name first because that renamed the
class name it does not go the other
direction so therefore if you need to do
a rename rename it over here and then it
will fix this if you say yes to that
dialog box now I've got a dialog yelling
at me saying hey your and I don't know
what prize model is that's because we
don't have a using statement for tracker
library dot models so if I do my control
dot using track your library models that
puts it right there and now life is good
again and now this idea connector or
connection is yelling at me because
saying I am not implementing properly
the create prize interface it's actually
not really true but what happens is to
come over here to our our interface it
says I own what prize model is but if I
say using tracker library dot models and
I say that I come back this should be
good now it is and sequel connector
we're going to do the same thing we're
going to do the control dot change the
add these in statement so you can change
this so it works you'll save that will
save all this little to save icons
together you to save all which means it
saves all of my files here which is nice
so now I can move these files the I did
a connection and dragged in a data
access a sequel connector
and the text connector and now we can
actually change that namespace if we
like which I do dot data access now how
I know that's the new namespace it
should be well that's because this is
the name of the folder and it is case
sensitive it's going to Yelp me for a
bit no worries we're going to change our
namespaces here that should solve that
problem then global config it's
referencing me the idea connections so I
need a change to add the using statement
for using tracker library access and
that solves the world's problems so now
I've kind of cleaned up my tracker
library it's a little more logical now I
have my data access folder I have my
models folder and then I have a global
config right in the root the last thing
I want to do is actually do a build a
build solution because I'm assuming to
clean other issues that I've missed
in fact right there guy red squiggly the
build failed it said it's got three
errors so if I come here and say view
code it says I did a connection prize
model I don't know those things are so
if I hit control dot add the using
statement and then down here again
control dot add the using pivot now see
there's two different using statements
because one is for dot data access one's
for dot models but with that being said
now if I build a solution
everything works if you've seen a lower
left-hand corner build succeeded so now
I can actually get to running that debt
data access code and that's that's a lot
of extra work before we actually got to
our quote-unquote real work but I want
this project to be as close to real
world as possible and this is real world
you know real-world easy come back to a
project man I was code late night and
made some mistakes like calling one
connect or in one connection is it a big
deal and not really by the same time
having that consistency of calling the
same thing the same way every time
really helps you when you're looking for
a new thing you know so if we were going
to look for a new data connector and it
said did a connection instead of data
connect door we'd be little confused is
that really the same thing or is that
something different and so by name it
connect door every time then I know that
yes this is the same thing because it
fit the same pattern so that's just
something to keep in mind and again
clean up that's not something you should
let wait until the end of the project
just like documentation isn't these are
things you should be doing as you go
because it's fresh in your mind now and
it's also much easier to change you saw
the number of tweaks I had to do to
change those namespaces and they were
just for one form I had those namespace
changes to do so if I had all of my
forms wired up even this small project
it would still be a much more
significant change I have to do a number
of changes and so the earlier you can do
these changes the better and just make
sure you come back to a project but you
look it over and make sure things are
clean the way you want them all right so
on to the actual work of today so let's
right click on this tab and say close
all documents I want to close everything
out I know the doctor while it's open
but it's just easier to clear clear
everything else out and start again
opening things up so in a single
connector we have this to do right here
or it could have gone to our task list
and look for that to do which is right
here
and don't click it it would take us to
it in fact let's close down
double-click this and there you go
just to show you that as it quickly I
navigate your project it's also a quick
way to remind yourself of what I need to
do yet in order to get this project to
work because notice there's actually
three there there's one for wiring up
the text files and then set up the
single connector properly so that one
right there says yep that's not right so
let's go back here and start planning
out how we're going to wire this up and
this is important to get right because
we're going to do this over and over and
over again for all the different forms
so let's think this through a minute and
start planning out how we're going to do
it now we're going to use dapper as our
connection o RM and an ORM edge is a
tool that helps you connect to a data
source like sequel in easier manner
it helps can't take away some of the the
complexities of connecting to a single
server so I love dapper because is
practically as fast as doing it with
just straight C sharp I used to do just
a do net which is a little more
complicated especially you start getting
into the data sets and data tables and
converting a data table to a list of
model and all that that went into it
whereas now adapt er it kind of just
does it for us and take us straight to
our list of model and yet it's almost as
fast as the way I was doing it which was
the fastest way you can do it we could
use other tools like entity framework
but entity framework can be quite a bit
slower to the point where it's ten times
slower than even dapper and so I don't
like to use any framework it's also much
more complex and you can find out all my
views about Andy for entity framework in
my youtube video on connecting to sequel
from c-sharp but to start with let's
and a reference managed to get packages
we're going to add a reference to dapper
so go to browse and just start typing
dapper to enter this person right here
will install a a stable version just
click install wait for it to be done all
right there we go so now it's installed
we can close out of this and so now we
can see the references we have Dabba
right here so now how would I use dapper
well the first thing you do is we need
to use dapper with a connection string
if you've watched my my youtube videos
mentioned the c-sharp sequel connection
we have to have in our app config a
connection string that's the best way to
do it that way we can change it even
while the applications running it's not
hard code in our code and it also allows
it to do some other things with as well
but in the app config notice the app
config is not in our library you seem to
make sense if in our library because
this is where we're going to actually do
all of our work with zapper the UI
doesn't know anything about damper it
just knows I call this method right here
I pass in a prize model I get back a
prize model that's all it cares about in
here is we're going to dapper but this
is just a dll the dll doesn't actually
have a user interface and it also does
not have a dot config file but as a web
config or an app config and so instead
it uses the config file from the user
interface which means that the
connection string actually goes in this
tracker UI app config file
and so here is where we'll put our
connection string to do that under
configuration we're going to do our less
than sign to open up a new section and
type connection strings close that out
and inside here going to add a new
connection string so we're going to say
add name equals mrs. a may want to give
it I typically give it the name of my
database
oops
they call us tournaments and then going
to say connection string equals inside
here I have to first give it my server
my case is dot slash sequel 2016
semicolon database tournaments trusted
underscore connection equals true what
that trusted connection is is saying use
my Windows credentials in order to
connect to the database and that's
usually the best way of doing things is
having that trusted connection because
then no one's come in here and read my
username and password to sequel now if
they have access to your application
they have access to sequel of that same
level so if they were quote-unquote
steal that username password if you had
one in here it shouldn't give them any
more access than they'd already have so
if you find yourself having an issue
where you have people connecting to
sequel server that you don't want to
keep many rights - you really need to
lock things down a sequel side and
there's ways of doing that I talked
about a little bit in my sequel course
on I am team kori calm but
really the best way of doing things that
I know of is to if you have to use a
using a password here to make sure that
using a password only has access to
execute stored procedures that's it they
don't have access to connect to the
database to read the table structure to
write to the tables or anything else
they just have access to stored
procedures that way the permissions they
have if they were take those credentials
are the exact same as if they were going
to use this application which is what
you want so so that's a connection
string if you go to again if you watch
my video I cover much more depth
connecting to sequel but if you go to
connection strings dot-com I believe
just Google connection strings they'll
see all the different connection strings
for sequel and all the rest that you can
connect to and finally provider name
equals system dot data dot sequel client
and I just say use a single connection
or a single client for connecting to
this database all right so that's a
connection string why is a connection
string important well this string right
here tells dapper how to get sequel
server and then how to get in so it says
here's the path a sequel server here's
the database you're going to start in
now you can go to any database with this
these credentials if you have permission
but this is the default one and what
that means is it's kind of like a
namespace where if you're in the
tournament's database you don't have to
specify I want something from a
tournament database so it just makes
life a little bit easier then finally
you know the trusted connection just
says these are the permissions I have so
location of the sequel server default
database and what permissions there are
so dapper needs that in order to talk to
sequel server and we can have as many as
you want as far as connection strings in
this list
so you just wouldn't add down below the
line and add another one also note that
this string right here can be
transformed with a config transform so
unbilled if I do a debug build I could
transform this to something else if I do
a release build I could transform to
something different
so for example my company we have
multiple transforms one for the
development server one for the staging
server one for the production server
enough a couple other miscellaneous ones
and we're going to get into transforms
today we're just going to leave it as it
is and call it good that will be for a
different video we don't want to make
this too long so back over here we now
have a connection string in place and we
call it tournaments so you can rely on
that but how to even get our connection
string well I think over the global
config file I'm just going to add a new
entry here a new public static void
let's just kind of we can't really
scroll up here yet what there we go
alright public static and it's not
avoiding a string plug static string and
we'll call this CNN value and the
connection value for connector string
that's called that and you'll pass in a
name of the connection so you want get
alright let's just call that name
alright so what that's going to do is
it's going to go to the app config and
get me the connection string by looking
up this name and it's going at this name
and then return for me the value inside
of this string so this right here
so I give it this it gives me this this
is pretty simple
the code is configuration manager dot
connection strings oops
square brackets name dot connection
string it will return all of that
now it's yummy because we don't have
access to this namespace and in fact if
you do the control dot there's not a add
using statement for that and that's
because we have to right-click on
references and say add reference come to
assemblies click in the search box here
and start to link configuration and
usually don't get past config you can
see here config configure and configure
a is as far they got and deliver
attempts so here we have system
configuration not the dot install
version the ones just system dot
configuration
check that box hit OK it's going to add
new reference here to system that
configuration and it's still yelling at
us but now if I do the control dot or do
this a little drop-down by the little
light bulb here we have the using system
configuration and now life is good now
whenever anyone calls global config dot
CNN string and passes in tournaments for
name they'll get back this string right
here so that's perfect
now back here again
so I've done a couple of setup things
now we need to actually put some kind of
code in here
it does something so let's get rid of
our sample code I'm going to add a using
statement using then the open parens I
DB connection and that's not in the
using statement list therefore to
control dot using system data and say
connection equals new system dot data
dot sequel client that sequel connection
and that can say global config dot CNN
string then quotes into the parens si
tournaments that's a lot for one line
but that's okay so now what this is is
I've said I wanna creates a new ID B
connection now notice the I in the front
which we've now realized means an
interface an interface means we can have
any hard code behind it meaning we can
have in our case we have our sequel
connector or we have our text connector
they both are an i data connection but
it's ID b connection is something that
microsoft set up and in this case we are
going to fill this connection with a
system data sequel client connection
we're going to put that in there so we
could put a my sequel connection in here
or a text connection in here or a number
of other different databases or anything
it fits the IDB connection interface we
could put into this connection in our
case we're connecting to sequel so
that's this code right here and again if
you watched my c-sharp - sequel database
video you'll become familiar this
and I say basically just keep a copy of
this basic structure on hand and it's
copy and paste it because you don't have
to memorize stuff in programming it's
probably not the best use of your
brainpower trying to memorize things
it's good to know the the basics good
know a good bit but the reality is you
can keep this in a file somewhere and
just keep using the same structure as
long as you know why you're doing it
it's not a problem
now the using statement here is
interesting because what it does is it
says I want to wrap this right here and
say that when you hit this curly brace
right here this connection get destroyed
and destroyed properly and so that way
this prevents against memory leaks so it
used to be that if your application you
know had an exception or did something
weird when you were trying to connect
with database you could accidentally
leave a connection open and if you do
this long enough then you have lots of
connections open and your sequel server
gets slower and slower and your
application gets slower and slower and
you're wondering what's going on my
computer is bogging down the application
memory usage going through the roof and
all this other stuff and it's because of
memory leaks because you had crash in
other unexpected circumstances that
prematurely got you out of code but
didn't close the connection to the
database properly this using statement
fixes that what it says is it doesn't
matter what happens when you hit the end
of this curly brace what is through
exception through anything else when you
hit the end we're closing it down and so
that's just a real safe way to connect
your database in such a way that you
don't leave connections open what that
does mean though is I am NOT going to
open a connection at this root level to
class and then reuse it over and over
for different methods
I'm going to open this connection every
single time so now we have our
connection to the database but what we
do with that connection we haven't
really decided how this data goes in the
database so let's go over their database
itself we have the prize table and we
could if you wanted to write a query it
said something like insert into DB ODOT
prizes and then put values and then
basically take that query and just paste
it into code here and call it but that's
not really what I'd like you to do
instead what we're going to do is create
a store procedure now we have already
created some stored procedures we have
the gets get by tournament get by
tournament for prizes for teaming all
the rest but instead we're going to
create a new store procedure let's
delete this now we could keep this here
but I'm just going to delete all of this
and start right from the create
procedure I would encourage you to put
the comments up above it says who
created when is created what it was for
that's really helpful down the road
that's especially helpful if you put a
changes section in there where every
time you change the stored procedure you
put a note as to what you did and win
because that we can see the the history
the store procedure as well so the name
of this create procedure is DB oh we
always start with dbo unless we have a
different name space essentially in
sequel
alright so DB ODOT going to start with
SP prizes because this is on the prizes
table let me have a convention of
starting with the name of the table
and now you know what parameters to pass
in and this is where you it's beneficial
to have two screens because you can put
your your prizes table on one screen and
your store procedure on a different
screen or something like that what I'm
going to do is actually expand out
prizes and go to columns so now I know
which columns I have in my prizes table
that's the column immediate pass in
going to get pass in for values the
first one is at place number now when
you pass in a value of variable you
start with an @ symbol okay so this is a
variable called place number and it's a
type int and then at place name and to
type n VAR char 50 and that's really
helpful you know right down here I can
see n VAR char 50 so I can match that up
here that way I know that I'm not
allowing more data to come in then can
be stored in this table at prize amount
and that's a typed money and at prize
percentage that's a type float I can
spell it right all right so let's get
rid of the comments here set no count on
what it does is it says let's not pass
back how many records you actually
modify that's fine so I'm going to say
insert into DB ODOT prizes and then I
give it the the four columns I want to
put values into place number place name
prize amount and prize percentage notice
I don't insert the ID because the ID is
going to be Auto incremented I can't
write in that field or I shouldn't write
in that field there is a way I write in
that field but it's unsafe unless you
know exactly what you're doing
so instead I'd say insert into the prize
a table here's the four columns now
write into and then for the values I'm
going to say add place number at place
name at prize amount and at rooks comma
at prize percentage so I call at the end
so there's my insert statement now the
one thing I'll go back my code real
quick and show you let's pop back there
is that we return a prize model it says
return the prize information including
the unique identifier so if I write if I
call this store procedure as it is right
now it would create a record in the
prizes table but I wouldn't know who is
you know what the ideas of the person
who was inserted in his prize dealer or
what the prize was so I would know the
idea the prize insert in that table to
fix that what I can do is I can say at
ID int output
and I can actually say int equals zero
and output and so what that's going to
do is I'm saying the ID you don't have
to pass a value in because if you don't
I'll just say the value of zero if I
really don't care the value is coming in
we're not going to use that to write to
the prizes table but I did say at the
end of it output what that means is this
value will be sent back to the person
calling this store procedure which is
how I'm going to take the ID and send it
back but how do I get that ID well I say
select at ID equals scope identity and
done so what this scope identities going
to do is say in the current scope which
means that in our case just this store
procedure call okay so there is an idea
of scope in store procedures or income
sorry and sequel where you can say I'm
gonna call these three store procedures
in the same scope and that'd be really
helpful for bank transactions where we
could say I want to take money out of a
checking account and then in another
call put it into a saving account we
wouldn't want those two actions to be
separated because if you took money out
of my checking account and then crashed
that might go away it'd be out of my
checking account but it wouldn't have
gone into my savings account and so you
can link those together what's called a
transaction so in that transaction that
would be the scope but in this case
we're not saying specifically do I want
transaction instead what happens is this
call becomes its own little transaction
so in this transaction I want to get
the identity what that is the last
identity written to a table into this
case we only did one identity insert and
that's in the prizes table so we said
insert a new record which would have
created a new ID for that record that ID
is the last identity create therefore
when I asked for it
the last identity created it's going to
put the value of whatever is here into
this variable and since this variable is
an output variable I can then capture
that on the other end so I'm going to
say execute which is not going to run
this store procedure but instead create
it now don't do eyes didn't have
something highlighted and say execute
because you can get this error right
here this error says in correct syntax
near create you say with that syntax
looks right well that's because I
highlighted just this section remember
that in sequel wherever you highlight
that's the code that gets run and that's
it so what I would do is either
highlight the whole thing or if this is
the only thing that's file then you can
just highlight nothing and execute I
love the idea of highlighting just what
you want because that way if you're in
that habit later when you have two
statements in the file the more likely
to protect yourself by highlighting just
the statement you want versus being used
to just hitting run on any blank file
I'll run this and it says command
completed successfully and I come down
here my store procedures and I right
click and say refresh we will now see
that I named this improperly I named it
espy prizes but nothing else
oops no worries we'll do this
SP prizes underscore insert we'll run it
again
and now if we refresh this we see we
have the prizes the wrong one
prizes get by turn ID and prizes insert
so how to get rid of SP prizes well I
could right-click and say delete that
works
I could also wipe this out instead say
something like drop procedure dbo dots
SP prizes it's not a list because
intellisense is not updated for this
window yet so if I hit ctrl shift are
and wait for a minute it will update and
then it will know that that's actually
the correct file if you run this it
completed successfully
and if I right click and say refresh on
store procedures the incorrect SP prizes
goes away and life is good again so the
issue with programming is not you don't
make mistakes we all make mistakes
the issue is knowing how to correct your
mistakes and then also working at
putting things in place to not repeat
your mistakes alright so we have a store
procedure the store procedures name is
SP prizes underscore insert and thank
let's call that UPS and modify that
notice the modification when I
right-click if they modify it brings it
back up but it has altered procedure
instead create procedure and that's it
syntax to modify a store procedure so
I'll keep that up but will refer to that
in a minute let's go back to our code
okay so we have our store procedure we
know how to least put the information in
if we were in sequel so how we do it in
code we're going to start off by saying
VAR p equals new dynamic
bring spell dynamic parameters I do
control dot on that and say using dapper
this is a dapper thing so dynamic
parameters and we're going to use VAR is
it's a little simpler with something
like this but in here we can say P dot
ad and this is where it's a little
trickier than the way we did it in our
our C sharp 2 sequel server our sequel
databases video but once you kind of see
it once I think you'll get the hang of
it so the first thing to do is add our
variables so at and what are the
variables we have let's do this I'm
going to copy these I just got shift tab
once and copy these and come up here
let's do up here paste them in and I
will then comment them out so that just
gives me my variables and what types
they are so I have them so at place
number is the variable name and then the
value is model dot place number and
that's it for that parameter so what
we're doing is we're creating a list of
these parameters we're adding them all
to P so P dot add and we'll say this one
is model dot place name and let's
actually copy this place name and paste
it here
P dot ad at prize amount and that's
model dot prize amount and then P dot ad
prize percentage model dot prize
percentage notice I try the copy pasting
a thing from up here it was just too
distracting when you're typing these out
over and over again try and do the same
way every time
sometimes it's more distracting to try
and copy something and paste it then is
to type it in and if you have to later
come back and copy and paste make sure
you got it right so P dot ad missed the
interesting one ID because this is the
one that goes the wrong direction it
comes out doesn't go in going to pass a
value in a zero now set a DB type Clips
DB type colon those is trying to do the
intellisense
was trying to say I think you mean DB
type the capital D the front and that's
not what I mean
instead what I'm doing is I'm saying we
have optional items here notice a DB
type question mark in the parameter
Direction question mark by saying DB
type colon that's saying yep this is
this parameter right here the whatever
it's up to the colon that's its value so
that we can actually mix up the order if
you wanted to or we have lots of these
optional items there's even more with
with this right here like with scale and
precision and size and all the rest we
have lots of these optional items you
can specify which ones you want to fill
in and leave the rest blank so DB type
colon and the type here is
DB types dot and here is the types we
have as case one into 32 and that's the
standard lower case int so that's when
we want so int 32 comma Direction :
and then notice when I hit space in the
immediately opens up intellisense and
goes right to parameter direction
because that's what's expecting a
parameter direction so if I hit tab now
I can't dot I can say this is an output
variable so this parameter Direction is
a Noom notice when you mouse over it it
says right there in oom so it enumerates
the options we have available to us in
this case we have a few we have a
standard input we have input output
which goes both directions we have
output and you have return value in my
case I'm using just an output but if I
wanted to it could also pass information
in on this ID value image because they'd
say input output to change that in
sequel there's no change to make as long
as it's an output variable I can use it
as either an output variable in c-sharp
or an input output variable and I get
said by default their input therefore we
don't need to specify because that's
what it assumes so output is so there's
all of our variables and their values
now I can say connection dot execute
this is going to actually run some kind
of store procedure and it's assuming
that nothing is going to come back as
far as a data set goes so what sue me is
that we're not going to say give me all
of the prizes
returned back a number of rows in a
table that would be a query instead of
and execute but execute it saying you're
just going to call something probably an
insert and update or delete and not
really pass information back so we want
do an execute and then we're going to
say in double quotes DB o dots espy
prize double check to make sure this is
right it's SP prizes underscore insert
so prize is honor score insert always
make sure you put that right because
otherwise the first time you run through
this it will error all right the next
parameter is our parameters in this case
P and then next the command type or it's
a command type right down here : notice
of skipping over a lot of these I'm
skipping over IDB transaction and the
command timeout to go right to command
type the command type is command type
dot store procedure again that's a anoon
so pop it up in the intellisense I just
hit tab I hit dot and it pulls up my
options here which are looks like three
store procedure table direct and text we
want the store procedure option alright
and that's all there is to it now this
code and that's all there is this code
is going to execute this store procedure
pass in all of this without information
and then it's going to get back
information but we haven't actually
captured where this comes into so let's
do that
so I'm going to say let's take the model
itself let's just modify this so model
dot ID equals P that's our dynamic
parameters P dot get we have to do a
less than greater than signs because
it's a get of T what that means is this
generic mean you can get any different
type you want using a specified type
inside of these angle brackets so in
this case the type is an int and then we
put in quotes inside parens @id and what
this will do is it will look at this
dynamic parameters list called P it's
going to find this particular parameter
by using this and it's going to say give
me the value of this and oh by the way
it's of type int therefore we can put it
directly into my ID because my ID is
also of type int quite a coincidence
right of course not we plant it that way
all right so finally I returned model
and now life is good or at least is
mostly good now there's one thing we
haven't really covered here yet and
we're not going to in this lesson but
that's the idea of what happens if
things go wrong and the developer you
need to think that through for example
what if this tournament didn't exist
this that appconfig
entry what if it's actually tournament
let it probably blow up in some way
how's it going to blow up we don't want
to crash the application wanted to
actually show a message possibly or
maybe we do want to crash the
application one of the things that
programmers they first start working
with error handling one things they tend
to do
is say well to wrap this entire thing in
one big try-catch and then if I do that
then things are safe because I can get a
message saying hey something didn't work
the problem with that is you can also
leave your application in an uncertain
state meaning maze is one of three tasks
that may be done and it actually broken
task number two of three well that means
that it got half done and then the other
half is I'm done
how's your application recover from that
if you haven't planned a waiter cover
from that it can actually be worse to
have your application continue to run
because your user will continue to do
more and more things to compound that
error and so sometimes the best thing to
do is actually crash your application
now we're not going to say okay the
solution that is just have no error
checking that's not the case but I'm
just saying that error checking is more
than just saying wrap everything in a
try-catch so we're actually have a
lesson entirely dedicated to tracking
and catching errors and so we'll do that
later on but for now we're going to
leave it as it is and assume that things
go well or everything will crash so
let's actually see if it works and
really I don't have to do anything else
to try it because we've already wired up
remember they prize the create prize
forms are you wired up to both a text
file a text connector and also a sequel
connector which would be this one right
here and it already calls this create
prize method we can see that in the code
behind where we have this loop and it's
write validate form oh here we go
it's too simple there's a loop so for
each I did it connector DB in global
config connections and we said both
sequel in text connector I want you to
call the create prize method and here is
the model which just happened to be
whatever you filled in here on our form
so it's already a gets called so let's
run this and see if it actually works
now before we do anything with it here's
the form before you do anything I'm
gonna go to my close it out and go to my
database doing new query and say select
star from DB ODOT prizes and I have no
prizes in my prize table you can see
that right down here so now let's fill
in information let's say the prize
number is for place numbers won first
place the prize amount is let's be
generous $100 and we're going to leave
the percentage alone because of them or
here let say create price and wait for
it wait for it cleared it out so
something happened to come over here to
sequel and say execute again check that
out first time the charm place number is
1 place name is first place prize amount
is 100 and prize percentage is zero now
let's test it again this time we're
going to say to second place we're going
to leave prize amount blank but instead
we'll do something like 50% create prize
because blank that's quicker that time
and if we execute this we now see that
we have a percentage of 50 so it's going
to test these things out both ways just
to make sure that things are working and
the other key thing here is to make sure
that things are going in the correct
fields I've had that happen before where
I'm putting stuff in the wrong fields
and so I try and you know you find a 2
over here and a 1 over here
if you find these are empty or null
isn't like that because I try to put
first place a string into a number field
and that doesn't work and you'll go
I swap those two around you go in the
code and fix it so it's just a matter of
making sure that all the data goes in
and it goes in the right spots and I
tested both the prize amount and the
prize percentage to make sure that I
indeed had both working the way I wanted
them to all right I'm going to zoom out
here I'm going to minimize this and
close this out the one thing and this is
one of those things where this
application is being built as if it were
real world and so I've left a couple of
things in here that we're frustrations
that I found during the design process
but I'm like you know what now I'm gonna
leave it in there and we're going to
work through it live essentially because
I don't want to hide from you all the
struggle to go on with a design process
now there's some things in here I'm not
trying to act like I know everything
okay there's some things in here they'll
pop up like I didn't even think about
that but in this case this issues one
that I came across the design process
what I would have to be different but
that's the idea of having both the
sequal connector and the text connector
writing together I mean they're both
working the issue with that is this ID
right here now if I write to sequel I
may get an ID of 25 so I write to my
text file my text file may have less
records in so may get an ID of 15 when I
go to use this value somewhere else I
can't have two different IDs to identify
this one record that's going to cause
some confusion now I could wire up my
sequel connector to be the primary one
and then it's going to fall back to or
have a copy written to the text file in
which case whatever ID sequel has will
then take that and write it to the text
file that kind of works but kind of
feeds
purpose of having that just drop in
whichever one you want to do kind of
database so I'm not going to do that
instead I'm going to say is instead of
having as many different connectors as
you want running at the same time we're
going to back it down to you can only
have one connector running at a time but
you can swap it out at any time very
easily by saying okay now want to work
with just text files versus tomorrow I'm
going to turn on the database instead
it'll be different data by the same time
you will have that stepping on toes with
the IDs so with that being said we have
to kind of rework some code and that's a
great time to rework code before we get
too far down the road and really in my
design process
it was Maz wiring up a sequel connector
that I went oops you know and so that
that caused that that thought process to
go on and the worst thing you can do as
a developer is freak out and say oh no I
messed everything up and destroy
everything and start or start changing
everything at once okay step back
breathe the world is not going to end
and it's not going to solve by you just
writing more code real quick that's not
the solution the solution instead is to
plan planning causes so much less hassle
in the long term if even though I plan
this application and I start to write
code and ran into an issue I didn't plan
for the my solution for that is to
actually plan for it even though I have
code written and that does mean a little
bit of rework here but not much so the
first place I'll rework is we have the
global config I want to change
a couple things first of all we're not
going to have a list of I did a
connection we're going to have a I data
connection that's it and so when we
initialize a connections we're going to
say if it's database then the connection
equals sequel and then here what we'll
do is we will say else if remember
before I said don't do L see if because
then you can only have one or the other
well now that's what you want
else if and we're going to say text file
so that solves at least this file except
the fact that this isn't clean so I'm
going to change this to say string
connection type and then I'll say if
connection type equals database proxy
more specific sequel else if connection
type equals text we can do that now we
can come back and even make this a
little bit cleaner you know what let's
make it cleaner again this is part of
that do you plan now or do you plan
later let's plan now and I'm going to
add a new here instead of a string
because this is getting a little bit
nervous do you type sequel or you type
you know capital SQL or you type text
file that's just a little squirrely so
instead I'm gonna create a noon and the
way I do in neumes is I right-click on
my project and say add class and I call
it a news
now you could create a class file for
every anoon and that's fine but what I
do is I find out use and neumes that
much and instead of saying oh that's
actually the neumes and you know where
is that I just create one file calling
neumes and then wipe out the class
inside of it and said say public anoon
let's call this database type and we're
going to say sequel and text file now I
have sequel in text file either so now I
can come back over here I can save that
come back over here and instead say I
want the database type now it's called
dB and so now I'll change it again
DB double equals database type dot
sequel or DB w equals database type dot
txt file now another way you could do
this instead of having your if else--if
else--if all the way down row you could
do a switch statement and enews are
wonderful with switch statements because
in oom it has to know what the types are
at least currently now when you go to
visual studio 2017 and the c sharp 7
features the switch has got a really big
upgrade where it doesn't have to have
that very limited number of items it
could be in the in the list it can be
pretty much anything it's pretty
powerful
but in c-sharp 6 and below in Visual
Studio 2015 below the switch statements
limited to things like numbers we're
very easy to say equals you know so that
value equals
so if I were to say let's type it right
here switch I tab twice switch on DB and
I hit enter it's created K students for
me already case sequel case text file
because that's an a new it has a limited
number of types it has in mid case just
two and so add a to case thing as we
could have and then also default case
and that's the essentially the same as
this if else if with no else you know
the default ability the ELSA p end but
i'm gonna leave my code as it is switch
statements at this point you know before
2017 are a little bit limited i like
this a little better so i'm going to
leave it as is the great thing about
programming is it really is up to you as
developer alright so I have this new way
of doing things now if I come over to
app config oops I'm sorry not app that
config program dot C S it now says ooh
you got a problem I'm not passing the
two boolean I'm passing in a database
type in this case sequel now if I didn't
want to have that tracker library dot I
can delete that and do my control dot
here and say using tracker library and
now I can use that I'm saying just
sequel which means that I've turned off
my text files for now I'm just using
just sequel now if I built this we
should have at least one more error I go
to that error and it says alright for
each do this for each I DB connection in
global config connections well we don't
have that anymore you only have the one
so therefore we can do is do this we can
say global config dot
and should be connections so let's
change those connections to be
connection I hit control dot now say
rename connections to connection go
through a name rename these two and so
now they are correct I could have just
renamed this renamed anything it broke
but that's a little bit easier it does
know about scope so it knows what is
really calling connections and what's
not but over here global config control
dot connection dot create price so we
now know let's just put that works go so
global config that connection dot create
prize model which connection is it's a
sequel text don't know don't care
just know we're doing it so again all is
right with the world if we run this we
can create new one let's create prize
number four fourth and the prize amount
is amazing five bucks create the prize
it wipes things out we go back over to
sequel and run this again we see that in
fact yes we have place number four
fourth and five dollars what that means
is all those changes they all worked ok
and we'll get into looking at testing a
little bit and writing tests to check
your application as well because that
can be helpful but for now we just ran a
test ourselves just to make sure things
worked so with all those changes that
happened we've refactored
our library be a little cleaner we have
redone how our code works a little bit
to make a little more sense with
something they thought through and we've
also you know it seemed like a minor
footnote now but we've also connected to
our sequel server and insert a value
into it every time you run this create
price
and oh by the way we learned about
output variables and how to get them
back using dapper
so whether all that being said that's it
for this lesson in the next lesson we're
going to wire up the text connector I
think that should be a little bit less a
little bit less complicated a little bit
less of a video because it should be a
little more simple to just write to a
text file that lays you'd think so
alright so stick around for the next
video before you go you'll see a link in
the left of BIOS course check out the
intro video in this playlist for more
informational you get if you pay also if
you are ever wondering what you could do
to help this channel out without paying
money I've listed six things that really
help I'd appreciate if you consider
doing one or more of these thanks again
and don't forget to keep practicing what
you learned</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>