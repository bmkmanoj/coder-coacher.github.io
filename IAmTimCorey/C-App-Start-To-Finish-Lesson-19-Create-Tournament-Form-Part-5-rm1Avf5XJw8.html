<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>C# App Start To Finish Lesson 19 - Create Tournament Form Part 5 | Coder Coacher - Coaching Coders</title><meta content="C# App Start To Finish Lesson 19 - Create Tournament Form Part 5 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/IAmTimCorey/">IAmTimCorey</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>C# App Start To Finish Lesson 19 - Create Tournament Form Part 5</b></h2><h5 class="post__date">2017-08-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/rm1Avf5XJw8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome to lesson 19 in a c-sharp from
start to finish course my name is Tim
quarry and today is finally the day
today we finish off the create
tournament form this one has been a big
one at a lot of moving parts which can
get overwhelming but so far we've broken
it down into manageable bits today is
going no difference we will take on the
last bits of logic needed to save this
data to the database or text file and
we're done so let's get this lesson
started by way of review we've been
doing all of our work underneath this
button or at least triggered by this
button so inside here we have validated
the data and now we have said create the
rounds that's what we did this last time
and what that did filled up our object
to have those rounds in there with who's
going to play in each round and now
today we're going to work on this create
tournament if you remember back to
lessons ago we created the create
tournament where we actually saved stuff
to the database but we didn't have the
round information to save yet so we're
going to do that now so let's actually
follow this right to the sequel location
so single connector we're looking for
the create term it create tournament
right here and if you notice we have
saved tournament remember that's the
first thing we do is you have to have a
term ID for the other saves we have
saved prizes and save entries so now all
we need to do is look at the rounds
themselves and create a save tournament
rounds
and we'll follow the same pattern
patterns are good now let's actually
come down here to our save tournament
entries we'll copy this text here so we
have that same value and we'll write
down below we'll say private voice paste
in that text ID be connection connection
and tournament model not logic model
called model all right so here is the
code relate to code section where we
need to save our round information now
this with me a little bit more complex
than with the entries up here because
this is just looping through a list of
teams that's all it's doing but down
here in the save rounds remember that we
have and look at over here in our
tournament model we have this so we have
to save a list of a list of matchup
model to make things a little more
complex inside matchup model we have a
list of matchup entry model called
entries so we have to save those as well
to make things a little more complex and
complexity at this point is okay don't
get overly concerned by complexity
because we haven't yet figured out how
to deal with this yet or even start to
worry about it we're just trying to get
a handle on what's going on so make
things a little more complex we have to
save as in order and the reason we do is
because we cannot say a matchup entry
model until you have the ID of its match
up and we can't save round 2 information
until round 1 is saved because in round
2 matchup entry models you'll see we
have the matchup model of the
parent well that's going to say in the
database as an ID
well how we store an ID of something we
don't know about yet
so therefore we have to make sure we
have those IDs the cool thing here that
is if we do save us an order and save
the first list of matchup model and get
the IDS and repopulate those models the
next round will already have the IDS it
needs because this matchup model parent
matchup refers to the previous round
model and again it's using that idea
that we're not copying values for
instances we are just pointing to the
same address so if we update the add up
to the information at an address
everybody else that has that same
address can still access it so we'll
have the ID by that point to save this
next round and then we go around three
if there is one we'll have the ID from
round two because again we've stored
those so we'll have all the information
we need the key is to make sure that we
have as information in order so we can't
do certain things out of words you have
to have that order in place but besides
that it's actually a pretty
straightforward process the only other
thing we need to do if you notice
matchup entry model does not have an ID
but match up model does so let's copy
this ID field and put it into match up
entry model because we're going to need
that maybe not right now but we'll
definitely need that so make sure we
have that on all of our models but right
now we're working with match up entry
model and I believe it's a last one does
not have an ID so make sure that's at
least on there okay so let's start
breaking down this logic into steps and
again don't try and tackle the whole
thing all at once we really are doing
the equivalent of aiding an elephant
here
if you've ever heard that that idea that
concept before but the concept is you
can eat an elephant it can take it one
bite at a time and that's we're going to
do here is this this form is preformed
double as far as an amount of logic it
has but when you break it all down is
just bits that we already know and put
them together we have all the tools we
need so let's list out the steps we need
to take and I think that you'll see that
every step is pretty simple on its own
and combined it's pretty powerful so the
first thing you need to do is we need to
loop through the rounds now that looks a
little interesting in that it's a list
of a list of matchup model so we loop
through it the resulting value the one
value will be a list not an individual
item and so we loop the rounds then
we're going to need to inside that we're
going to loop through the matchups and
that loop will give us each individual
matchup and inside those matchups we're
going to going to need to save the
matchup and then we're going to need to
loop through the entries and save them
so loop the rounds inside each iteration
loop the matchups inside each iteration
of that save the individual matchup and
then loop through the entries in that
matchup and save them as well and then
we should be done so let's let's make
sure that we have this logic right by
starting out and just trying
and see if we've missed any parts I
don't think we've missed any parts so
let's go do it for each we have a list
of matchup model and where I call this
round in model dot rounds so each
individual item is a list of matchup
model and that represents one round now
according to our schedule here that's
done we need to now loop through the
matchups so for each matchup model and
this is we're not using var can be
helpful especially at first because you
have a better picture of what actually
looping through especially since if you
get it wrong say I thought this is just
a match up model guess what it goes you
can't do that I can't translate each
individual round to a matchup model it's
a list of matchup model so typing out
make sure that you know what you're
doing if I had done stead var that would
work but I may have a misunderstanding
of what this round represents now if I
mouse over it says list of matchup model
but sometimes when you're first starting
out especially typing that out gives you
a better idea of what's going on
over time you may drift to that var
naming convention and that's fine I just
encourage you to make sure you still
think about the younger developers in
your shop if you have more than one
developer and make sure that you're
still writing your code in a way that's
understandable to them the best code is
code that's simplistic enough for even a
newer developer to understand and yet
powerful not to get the job done
a lot of higher-level developers
mid-range developers and even senior
developers think that the best code is
complex code code that's really
efficient or really tight and it's a lot
of one-liners and things like that and I
found that that really hasn't yet
achieved the best code the best code
actually becomes simpler not more
complex that's just my two cents
take it for what it is all right so now
we're going to do a you know back on
track here now going to do a loop on
each round and in this loop we're going
to pull out each individual matchup for
that round so now we've looped through
rounds we've looped through the matchups
now our next job right here is to save
the matchup and then inside of another
for loop we have to then save the
entries now this raises the issue of do
I just copy and paste the code from say
here what I would recommend is you just
copy this paste it down here and modify
it just make sure you modify every
single line even if you have to comment
the entire thing out like so and then
uncomment every line as you modify it so
it's just something you can do to make
things a little easier now I want you to
notice too you already have our
connection don't forget that way back up
here we start our using statement so
we're still covered inside that using
statement or using the same connection
for all of this
we're only opening one connection which
is great it's very very efficient
so we need to actually save a match up
to the database and I'm pretty sure we
don't have a store procedure yet so
let's go to a database and we have
matchups get but not a matchups insert
so let's first of all expand out our
matchups table so we have the columns we
have to insert it will create a new
procedure and should be getting used to
this process by now again if you're
still struggling with sequel I do have a
course on that that walks you through
all the way through understanding store
procedures and building databases that
might be helpful if you're still
struggling all right SP matchups
underscore insert again fall in that
pattern SP prizes on the score insert SP
teams underscore insert now SP matchups
underscore insert and we have the ads
tournament ID that's an int we have the
ad winner ID that's an int and we have
the ad matchup round as an int so we
have three answer passing in the term ID
the winner ID the match up round then
finally we want to have the ID in equals
zero outputs and that will give us the
ID back of the created record now this
wasn't a time to just keep our head down
just start typing away we have to think
about what we're doing here and the one
thing I want to look at is this at
winner ID do we know who the winner is
yet no we don't you could theoretically
say that we do know the winner of
the rounds where your matchups where you
have a buy but since they're so few and
we can deal us in other ways I really
don't want to deal with them as having
an immediate win I want to first insert
everything in a database and then go
back through and mark my winners because
I can use that same logic then to mark
them my winners again when people
actually have matched up in one person
wins over the other so I don't want to
include the idea of that by week be an
automatic win yet so we don't know the
winner ID we don't have to pass it in
that why passing a value that we'll
never know we are creating this record
so we create a matchup you'll never know
who the winner is so we're just going to
pass that in so we have tournament ID we
know that match up round that's the
round one round two round three we know
that and we get back the ID the match up
so a match is pretty simple there's not
a whole lot to match up and that's
that's okay so let's create this simple
insert insert into video dot matchups at
turn oops not at remit tournament ID and
match up round and we are going to pass
in nothing for the winner ID if you
notice over here this right here says
that it's a null by default it allows
mel's it will be a null by default
therefore to leave it alone and not put
an ID at all so writing a pass that in
or put it in the insert statement so
insert into DDO matchups just a
tournament ID in the match
round values at tournament ID at matchup
round and then our select at ID equals
scope identity and that's all there is
to our SP matchups insert I'll copy that
I'll execute the whole thing I come over
here and I will modify this to say SP
matchups insert the tournament ID is
correct but instead of team ID it's
match up round I'll copy that I will
paste that in including the app symbol
and so now I can uncomment all of these
and we have the model dot ID well that's
the tournament idea of great they need
to match up round and that's not right
so we say item let's make it something
size item
that's not let's call it match up so
match up dot the round number match up
round and the ID gets passed back out so
let's grab the ID in order to do that
have scroll up here to this method where
I know that I have gotten that ID back
out there's no reason to memorize code
just remember where it is now the
pattern to use and so now instead of
model dot ID we don't want to do that
because I had override our tournament
model ID that's not right instead that's
not in the right spot it's down here
there we go
instead of model dot ID we're going to
say match up dot ID so this is the ID
for the particular matchup so we've
looped through the rounds we've looped
through the matchups
we've saved each match up and if we left
it alone right now
we have the matchups at least saved in
the database but before we do the next
iteration of this for each loop we have
to do yet another nested loop for each
and this will be matchup entry model
entry in match up dot entries so that's
a loop through every entry we have and
now we have to save the entries so again
I will copy this and I'll paste it in
again I commented out for now
and the reason I commented out is I want
to make sure that I don't just use this
code and cause all kinds of problems
copying and pasting is a bad thing
typically but you can make it into a
good thing if you use only the pattern
and the way to do that is to comment the
whole thing out and then uncomment the
lines as you modify them so in this case
we're going to try and save a matchup
entry we don't have a match up entries
inserts so let's open up match up
entries look at our columns and create a
new stored procedure and what I
encourage you to do is we've been doing
this pattern for a while now pause the
video right here and follow along like
building your own query your own store
procedure and making sure make sure
that what you do matches up with what
I'm going to do because right now you
should pretty much know I'm going to do
we've done a number of times and if you
don't don't worry about it don't get all
you know flustered instead just watch
them doing do it along with me go back
and practice it again until it becomes
second nature the key being good
programmer or a good database developer
is not about how much you know
necessarily it's about how much you
practice that's really what separates a
decent developer from a great developer
practice once you've done it a hundred
times or a thousand times at ten
thousand times it becomes much easier to
concentrate on a logic you're trying to
do and not work with the syntax the
syntax kind of flows and even some the
patterns of logic flow as well so SP
match up entries underscore insert the
parameters and match up ID int and
that's the ID we just captured so we
know we have that at parent match up ID
int this is the one that in round one we
don't have a parent match up ID so in
this case it's going to be null or empty
for a first round after that we'll know
what it is that's okay we can pass in a
null at team competing ID in
that's the actual team and we know who
they are because remember whenever we
create a team they get an idea
immediately and then we put them into a
tournament so we have IDs for every team
in our tournament already so we know
this
and then at score
we don't need because the score is going
to be nothing to begin with we don't
know the score they haven't played yet
therefore there is no score we could set
it to zero but I like know better
because no is not the same thing as zero
there are two different things
null is the absence of a value zero is a
very real value for example if you are
playing soccer or football if you're in
any country outside the US when you're
playing that you may have a game that's
one two zero zero is the score of a
losing team it is a real value and so
zero holds significance in that context
so even just putting a zero here doesn't
really make sense doesn't make me feel
comfortable because that might be a
value it might not wear null is the
absence of value they may also say well
I could put a negative one there and
that would indicate no score yet but
that's not really true because what if
it's the golf tournament negative one is
pretty good has one under par and that's
actually a real valid value so I leave
us as null and don't touch it
finally ID int equals zero outputs in
this case I don't think we need to
capture the matchup ID the match of
entries ID but will at least have it in
case we need it
now we can do it inserts in it if at all
possible it's really helpful to match up
your parameters with the field they're
going into because then I'm your insert
statement can say this field lines up
with this value and they're identical so
makes sense just visually I can look at
that and say yep that looks right so
that's just something to keep in mind
all right so the scope identity will
execute this and actually this is the
more proper way of saying it we look at
our store procedures we will see that DB
OSP match up entries I scored in search
is still a name even though I didn't
specify it up here even though I didn't
specify and it still worked
specify it make sure you have it because
this just makes your database engine
work that little bit less so it's always
important to keep those included on any
call alright so I have the new name and
now I can start uncommenting somebody's
lines now VAR p equals new dynamic
parameter well I think yell maybe if you
already have a P created so I will just
delete the var first because we're
going to use the P from this outerscope
and that's okay we can override it
because we don't need it anymore up here
now we're using down here to create a
new set of dynamic parameters we can't
uncomment this line or this line yet we
can do this one and we can do this one
so now let's grab our parameters I don't
trust myself
Eli parameters correct every time I copy
those I'm going to paste them in
uprights paste them right here for now
I'll make the formatting look right and
then it will comment these out so these
are my parameters I'll put some space
here around them just so I can see them
better to say matchup ID uncomment this
the matchup ID is going to be the
matchup that ID and we just populated
that right up here so we know that's
populated so that's good next is the
parent matchup ID so let's say parent
matchup ID and that is the entry entry
dot parent matchup now if we have not
set that value it will be null which is
great that's what we want
last thing of the team competing so
let's just copy one is rose copy the
first one we'll change team competing
and rest say it's his entry dot team
competing dot ID so the ID of a team
competing
don't pass the entire record in because
we only need that identifier because the
database knows about all the teams so it
knows it can look up the team based upon
its identifier so those are three
parameters I can get rid of those
comments now and now we have our matchup
entries insert but wait before we
declare victory here and say we're done
which in the general logic we are done
we've looped the rounds loops the
matchups save the matchups and loop
through the entries and save them so
that's all done but before you go make
sure you check what you do with buys
because byes aren't going to say to the
database so let's look at our tournament
logic and look at create rounds that's
not it create other rounds that's not it
create first round okay so here's our
logic we're a loop through each team and
add an entry model to our matchup model
now if the buys is greater than zero
then do this add that match up to our
output and skip over doing another entry
therefore if you have a by you only have
one entry in your list of match up entry
models inside of match up model so you
follow that in the match up we have a
set of entries typically I quote unquote
normal match up you have two entries
team a and Team B but in the case of a
by we only have one entry will that
cause a problem well no we're
we have for each on the entries if you
have one it will loop this once if you
have two it will go through it twice
therefore we're all set
therefore in theory we have just saved
all the information to the database so
save turnarounds is now complete
which means that our logic for our form
should be done for the sequel branch so
let's test it to be sure so I come down
here to program dot C s make sure that I
select my sequel file and let's run our
application metal load up and first of
all it didn't crash that's excellent
you're always happy when your
application doesn't crash or say you
have a bug just by starting up now
before we go any further let's go to
sequel we can close out of these
procedures and I create a new query
window I grab two values here my select
star from DB o dot match ups and I'll do
a select star from DB o dot match up
entries hit f5 there's no entries and
either match up entries or the match ups
so we know that there's nothing there
yet which is a good thing let's create
our first tournament and see if it works
first tourney well that's the entry fee
of 15 I think making changes to all the
values if I can the first time through
just make sure that everything gets
populated in the right place
so we have just two teams first team
first place and uncanny losers
so let's add both of those to our teams
we can't do a turn it with just two
players and we could or two teams we
could but let's do it with three that we
can even test the by week so I create a
new team I'll call it Sue's team and
we're going to put I'm going to put sue
storm in and that's it for now and sue
is now on the list prizes let's just add
a 1 prize here we'll say first place
gets 100% of the income create prize we
call the first create tournament
cross your fingers here and it blows up
excellent that's okay that just means we
haven't completed everything we need to
do yet so it says an unhandled exception
of type system dot null rapids exception
occurred object reference not set to an
instance an object once you've dealt
with objects or class instances often
enough you're going to know this message
by heart you'll get a lot so essentially
what means is that we try to use in this
case a property of an instance that
hadn't been created yet you can't do
that so I'm going to close out a dialog
but I'm not going to hit stop yet don't
hit stop first look at all of your data
so I have matchup entries there's two
entries and that's good
so in this current iteration I have two
entries and I'm probably looping through
the first one but I don't know for sure
that's okay we can look at both of them
first so I have an ID of 0 for the entry
that's ok we don't know the idea
a score of 0 sure team competing is null
well that's not good parent matchup
matchup round is 1 ID is 2
did you catch that let's look at the
matchup ID match up round is 2 so we're
not in the first round any more work in
a second round that's the round where we
don't have any teams yet because no
matchups have been played therefore no
winners have advanced to the next round
therefore of course we don't have a team
competing it's no therefore if the team
competing is no you can't have the ID of
a null object therefore we can't pass in
a team competing now you may say oh no
panic don't panic - look you're a sequel
from it let's go look at match up
entries we're passing in let's go back
there from it we're passing into the
team competing ok
so team competing is this column right
here what do you notice about this
column it's nullable this one not no
this one and this one are both no
meaning you don't have to pass in a
value in fact we can't pass in a value
because they don't know it yet and this
is the one tweaking
ade before we started saving our data or
creating these rounds because we
couldn't pass in 18 competing ID via
here we're trying to now I'm going to
show you a trick what I'm going to do
now mouse over this yellow arrow right
here and when it's directly over the air
right click and drag up one line notice
now the yellow line is one line higher
now at the end of this line I'm going to
hit enter I'm going to say if I'm going
to say if entry dot team competing
equals no you know cut this line and
paste it in here instead pass in just
the team competing which is null in fact
I always pass in milk else pass in the
ID see if I did there I put a check in
place right away the costal paused but I
put a check in place and said hey if the
team competing is no then pass in null
for team competing ID but if the team
competing is not null then pass in that
ID and I come back over here to the
yellow line yellow indicator and drag it
down over the if statement this is one
of those nice things about debugging in
Visual Studio and it doesn't work in
every instance there's a few times it
doesn't work but the most probably how
it's called edit and continue the idea
that we can while the debuggers pause
make changes to our code and then keep
running in this case I move the yellow
line off of the line they had a prob
them so I can move it around but then I
move it back to what would be the next
line of code and now I can step in -
just to make sure it works
so let's mouse over P for a minute and
make sure that it has parameters just to
match up ID and parent match up ID it
does so now if we step over it should
have a third one which it does and that
third one is team competing ID so now we
can continue on our code is hit f5 and
it should continue on with our
application and it goes I don't think so
alright so it says the member parent
matchup ID cannot be used as a parameter
value
okay so member parent matchup ID of type
tracker library that models that match
up model cannot be used as a parameter
value so what is our parent matchup ID
well right up here parent matchup ID I
passed in the entire parent matchup
instead of dot ID oops now the way
resolve that is to move as cursor again
but before I do let's think this through
for minute so far I've been passing in
the parent ID as the entire model and it
works because remember word we are in
round number two therefore we've already
completed round number one so how'd that
work well for the first round the entry
dot parent matchup was no and that was
okay because parent matchup ID is a
mobile type
and we want to pass in null which is
kind like we're doing down here so we
actually the same logic is here only we
need it for our parent matchup
so if entry dot parent matchup is no the
parent matchup is no otherwise the
parent matchup is ID is passed in we can
take this row out now so the same logic
twice unskilled a space in our gift
statement just to have a separation
they're not blend them in but here's the
problem we've already tried to execute
this statement which means that P the
parameters is already populated with
four parameters what we do well we need
to do is actually move our dragged our
yellow indicator all the way to P equals
new dynamic parameters that will wipe
out P P now has zero parameters and now
I can step down to the code and make
sure you populate properly all the
values and if we look at P now we should
see that it has four parameters those
parameters are add expected because we
could dive even further into the values
and get that but that's good enough now
let's continue and now it brings it back
to reform so did it work well typically
our form should have some kind of
feedback system where you said you've
got a problem or it closes up a
tournament because just like the ad team
or create prize I'm sorry just like to
create new or create prize when we're
done we close the form out and take the
and do something with it in this case I
would assume that if I create a
tournament it should take me then to
that tournament so how we know if it
worked well let's go to our database and
run this code so did it work we've got
values let's see if the values look
right first matchups so we have term ID
of 1 is all the same tournament that's
good
no winners yet that's fine match up
rounds round 1 round 1 and round 2 we
had three teams so we had to add a by
that's four teams so we had two games
the first round and the winners of those
advanced to the next round round two and
they play each other and that's all we
have therefore two games in round one
one game and round two perfect now for a
matchup entries we have five matchup
entries now if you do the math and that
you think wait we have six we should
have correct well no let's see why we
have matchup ID of one team competing
idea is to notice the random order here
it's not one two three tactically
randomize that order if we do the same
thing over again it shouldn't be in the
same order but matchup idea of one only
has team competing of two there is not a
second matchup ID of one because one
team had to have a bye and it's always
the first team that gets the first bye
and so this team team ID number two got
a bye
for round one next we have two teams
team one team three which are in match
up ID number two then we have two teams
in match up ID number three the parents
idea of which is match up ID one and
match up ID 2 so this entry is the
winner of match up ID 1 which would be
just team 2 and this is the winner of
match up ID 2 which is either team 1 or
team 3 therefore we've got everything we
need
there's no parent for round 1 and we
don't know the teams competing for round
2 and Beyond we don't know a score for
anybody so it looks like all the data
for our tournament for sequel is going
into the database now I don't know about
you but having just two little errors
and that's it is huge with all that cody
rhodes we only had two errors that comes
from breaking things down into small
little pieces and following those same
patterns over and over again it also
really helps to have a really good plan
to work from and when we get to a place
with a plan doesn't cover we plan first
and then do it so this is working
the only thing we'll need to do is
figure out what to do after we create
this tournament where we got to send it
that's not for today that's a really
simple change just like with our create
prize we first create that form we
didn't go anywhere with it
and we had to the same thing here until
we know what wants this information or
what's going to happen next
close out of this and now one thing to
note that you may not catch but I just
stop my application I already have
modified code notice the yellow line
here and the asterisk up here normally
you don't ever have modified code after
you've run your application because what
happens when you hit start up here or
you say debug start debugging or if you
set hit f5 any of those tasks when you
do them the very first step it does is
save everything in your application so
how is it we can have unsaved lines of
code well these lines of code are the
ones that I modified in line while we
were debugging and so it save that
information which was amazing it's great
but now I have to make sure that I
actually save this data before going
further it's not a huge deal and it's
not something that will likely trip you
up because you'll probably run this
again before you close out and even if
you didn't when you go to close out it's
going to say do you want to save this
but I just want to point that out so you
don't say well why is where we have
unsaved code here all right let's close
out of everything else except for the
write up here text connector because now
we have to work on actually saving our
text information now it's a bit
different now all of our text is a
little bit different but let's look at I
could collapse everything but realize
need to come down here so I just
collapse those there is an option if you
right click and say inside here outline
collapse
conditions that will collapse everything
down like this that's very helpful for
just seeing the names you can also come
up here once you're inside your class
like you click inside a class can do
this drop down and find what you're
looking for and take you right to it so
there's a lot of ways to navigate here I
don't always do the fastest way
necessarily it all depends on you know
what I'm thinking of right then usually
it's not how to navigate the editor
usually it's about the logic of what I'm
trying to do so in here we have create
tournament and it goes through it loads
all the tournaments will cover the
convert to turnip file in a minute or
turrent models but then down here we add
our current model which is fine we the
model pass in has all the rounds
information already sort of and then we
saved a tournament file now I say sort
of up here because remember when we
worked on a sequel connector we had to
add all those IDs in by looping through
creating it and the ID and update the
models and so on and so forth all the
ways through to make sure that the later
rounds have the IDS of the previous
rounds and all the rest so therefore we
have we don't haven't done that yet here
so we say say deterrent file we've got a
little problem because when we do that
the information isn't here now let's go
to the actual save current file and look
at what it does now this one we actually
completed we have lines remember our
pattern here where rounds looks like
this so we've done our pattern we have
the ID deterrent name the entry fee the
team's converted to Alyssa stream prizes
convert Alyssa string and the rounds
converted to a list of string and we do
that because
we didn't need to worry about where is
coming from we just knew we had a model
and it had all the information and so
therefore we can convert it to this
pattern based upon what we already know
but that means that over here before we
add this model we have to populate all
those IDs with proper values so how we
do that well I think right here we need
to have a tournament dot save round save
rounds to file a pass in first our model
which is our tournament model and they
will pass in two values the first being
the matchup file and a second beaming
match of entry file now I have none of
this stuff I don't have this method I
don't have this file or this file let's
start by creating these files private
cons string matchup file equals matchup
models CSV and then private const string
matchup entries file equals matchup
entry entry models dot csv just make
sure the follow pattern here so now
if we match up entry not entries there
we go
and so now we have no red squigglies
there so those are at least right and
now we need to just create that save
rounds to file so what this method is
going to do it is going to simulate the
same kind of logic we had no sequel
connector where we loop through every
round and then every match up and saved
both the match up and the match up
entries and once we have all that
information we'll keep populating it
model and then it can pass all the
information back so that the model will
be populated with all the IDS then we
can save the information I'm going to
start by actually copying this entire
line a signature line and before I go
anywhere in there realize wait a minute
this tournaments that's my list
determines that's now I want I actually
want to take this out and say model dot
now remember up here with our tournament
you have a list of tournaments even
loaded from the database and we're doing
things on them based upon the fact that
we can add extension methods like this
one to our list a turn it model but in
this case we're not operating on our
list of turn models we're operating on
one specific model so we need to operate
on our model so model dot save rounds
the file we don't need to pass the model
in because we're already operating on it
create an extension method for
tournament model so I'll copy this
signature line and then I'll come over
to the text connector processor which is
where all of our extension methods are
and we come down here and I'm going to
underneath the save or one of these I'm
actually going to put my future let's
put it right here
public static void I'll paste in save
round the file and I will say is this
tournament model model string match up
file string match up file or match up
entry file so now I've created extension
method save rounds to file which is
going to operate on tournament model and
we're going to pass in the matchup file
in the match up entry file now you may
ask why did I pick this line
particularly paste this code in start
working here well I am going to do a
safe I wanted to have code around this
code they kind of went with save so I
could use the same patterns the only
problem is this one's a bit different
than all the rest now it doesn't mean we
abandon our patterns it just means that
this one will use patterns from more
than one location so in this case let's
write out our logic again so we need to
loop through each round inside round we
need to loop through each match up we
need to save the match up and get an ID
actually that's in reverse order get the
ID for the new match up and save the end
record the
in a loop through each entry get the ID
and save it so if you notice some of
this code like getting the ID for the
new match up and save the record to come
back over your text connector we load
all tournaments we get the ID and we put
the ID into the model and then we call
the save method so some of this code
right here will actually be in this
entry over here in our save rounds to
file so we have some logic from both
places so just keep that in mind but
let's start with the easy stuff for each
it's going to be a list of match up and
match up model I'll call it match ups
nope we'll call it round in model dot
rounds let's try and keep the same
consistent naming and we're going to do
a for each match up model match up in
round dot no dot so this round
so for each match up model match up in
round so now we have where we need to
save we first need to do it code come up
here load all of the matchups from file
get the top ID and add one store the ID
save the match up record and then we do
the same thing for our match up
entries so let's create a couple of
extension methods I'll call a first one
public static void save match up to file
this matchup I match up model called
match up and we'll pass in the string
matchup matchup file which really rename
these up here we lowercase as well these
are parameters and then we're going to
actually in here what we'll do is write
call this up here so we've got the match
up where I say oops one line too many
we're going to say match up dot save
match up to file and pass in our match
up file so let's just pretend from it
this is going to work when we call this
on this match up we're going to save
just the match up not to match up
entries just a match up to the file and
then in here we will call the actual
save to the text file and then we'll
have another one that will loop through
probably here we have the option so we
either loop through then the entries
here and say for each we can say match
up entry model entry in match up dots
entries and you can say entry dot save
entry to file and pass in a match up
entry file
so you do that here or we could do it
down here after we say the match up it
really is up to us I kind of like the
idea of saving doing this call inside
out of the matchup because part of the
matchup is who is competing in that
matchup those entries so it seems
incomplete not to save those as well
when you're saving the matchup entry for
the matchup not matchup entry so let's
let's actually cut this code here and
paste it down here and we'll say we're
going to do some save stuff here first
and then we will loop through each entry
and call that so before you go any
further let's talk about this method as
well so let's say public static void
save enter to file this matchup entry
model entry string and it's going to be
the entry file name so match up entry
file and that will work we just don't
have this file being passed in there for
let's say we need to pass it in and now
up here we have to say match up entry
file as well so now we're passing in
this is very simple we are looping
through each round in each matchup and
one by one saving that matchup and then
inside that save we're going to actually
do the save up here and then we're going
to loop through every entry and save
that entry inside they will actually the
save of the entry all on the way we'll
make sure we're updating IDs because
don't forget that
text file it's very important that
everything has an ID because that's the
only way we reference it is by that ID
so we have to do basically the pattern
from here and some pattern from up here
so let's kind of get all this in one
spot let's start with the save match up
to file the first thing to do is we need
to load our file now let's come up here
and look at the files we have access to
so here would be a load of file
so right here we say full file path load
file that loads the string and then
convert to our tournament model well
there's the same thing down here but we
have to have this method to call
so let's actually create that method I
didn't cover the entire thing by
accident so let's copy let's just cut a
prize it's fine and I'll paste it down
below because that's where I'm working
right now I can see it most easily here
so I'll paste it right here let's make
sure that we're saving the correct
information so it's not prize model this
is going to be matchup model so a list
of matchup model convert to matchup
models just spell it right always check
your spelling I'm going to pass in a
list of string that's great it will
return the output with a list of matchup
model and some
now this breaks all that and that's okay
we need to identify though what a
matchup model looks like well let's open
up matchup model real quick and we see
we have an ID that the column 0 we have
a list of entries now what are you going
to put here and this is where having
sequel can actually mess you up a bit
and here's a mean by that in sequel if
we look for the matchups table we have
no information at which matchup entries
we have none but in our model for the
matchup we have this list of matchup
entry and so therefore we do know about
the entries in this matchup model and if
we go to match up entry we don't know
about who called us who set us up where
we can match up we're in we do know
apparently came from but not the current
match up work in so it's kind of other
direction and might be a little bit
confusing but it's ok we just need to
know that it's a little bit different
now the one thing we're missing and this
is where we could have gotten tripped up
very easily is we don't have a
tournament ID in this matchup model we
don't know who our matchups are so you
need a question is that problem well
let's look at how this works if we
scroll up here we're going to see that
we're actually saving all this
information in relationship to this
model and we're updating the IDS at
furious pace every ID gets updated and
the reason why is because we
save this tournament record we save all
the information about the tournament
including all the information about the
rounds so they can see the rounds right
here this represents one match up one
match up one match up and so therefore
this ID will link that match up to this
tournament and then this ID for this
matchup will then link the term entries
to the tournament because inside the
matchup will be the IDs for the
tournament entries so therefore we're
good not storing the tournament ID as we
have to kind of trust the system trust
the system you built he is right now
definitely trust but verify make sure
that's what you're thinking is going to
do and take a step back and walk through
the process make sure you're not storing
data that you can't get back out I've
actually looked at this a couple times
where I'm like I'm thinking oh no I have
a bug in my coat I don't know how I dig
it's out and so I walk through it line
by line go okay I do know how it gets
out that's we're going to piece it back
together just make sure you know that
and it is different for text files than
it is for sequel sequel behaves
differently based upon fact that's a
relational database and the way to store
information is a bit different so that
being said let's open up our matchup
model and actually make a new vertical
tab group I'll understand now we can see
the information we need to store well
let's create our or layout of what's
going to look like ID equals zero that's
the first position next we're going to
have a entries equals one
and that will be pipe be limited because
we'll have more than one entry ID I'll
say by ID and then we're going to have a
winner
equals two and match up round equals
three so these are the entries we need
to grab so we have this new matchup
model you can actually change the sizing
here so here's the matchup model the
first call is ID that goes in the ID
field for a matchup model that's cool
next we have the entries let's worry
about that in a minute so you won't
worry about grabbing that yet next we're
going to have the winner and the winner
is according to this call to and that's
a team model and so I have to do
something with that first in order to
convert it from a an ID over to a team
model and next we have the matchup round
match up round equals in tarce
and it is column number three we don't
have the fourth foul number four which
is actually the fifth column so we have
two values we need to worry about
we have entries and we have winner
entries is a list of entries so we have
to load that from somewhere we're
starting to have some moving parts here
that kind of make our lives a little bit
bit more difficult and so I'm going to
do that creates a
private static let's return a list of
matchup model entry model it will call
this convert string to match up entry
models string input that's probably not
enough an awful long name that's okay I
don't like abbreviations so let's call
that you know pass in our string and
it's probably not enough and right now
we're going to do a throw new not
implemented exception which allows us to
not have an error here but at the same
time it will throw an error if we try to
call it so that way you can get on to
compiling let's make sure the rest
compiles while still not having tackle
that quite yet and yet you won't miss it
so that's fine for now so in theory what
happens is we pass in our string and get
back one or two probably matchup entry
models and that will look up from the
text file this next one's a bit easier
so I'll actually go ahead and implement
this is a private static team model
lookup team by ID int ID now we'll call
this let's just first put that not
implement exception in just for now
and we're going to call this right here
and so what this does is it passes in
let's convert that sew ins dot parse
just going to pass in the ID this is
when it returns it's going to store in
the text file an ID you want to
rehydrate that a full team model so it
converts the ID to an integer will pass
it into this method this methods job
will be to look up that team by ID and
return the actual team now you may say a
doesn't sound easy well we've already
got the kosis we just go find it so
let's come back over here and see how we
do a get all teams well we just do this
code right here team file so you know
the team file passed in the full file
path load the file convert to team model
passing in the people file therefore we
can do a same call over here we can say
list of team model teams equals call
that lookup and that should give us all
of our teams
now it's yelling as B's we don't have
the team file or the people file we need
to pass those in
so this down here doesn't know what the
team file or people file either and to
this point you should be saying this is
ridiculous we're passing all these file
names in all over the place and they're
constants and we're actually making them
not constant anymore what should we do
well we should go look at this global
config I should move this over here to
my right hand side in global config we
have configuration information that was
sealing a great place to put all of this
constant information so if I were to cut
it from here that'd be a problem because
I have to refactor everywhere to say
global config dot pry this file so I
copy that and paste it in and it's a
private I'll make each of these public
so now global config dot prizes file and
we can get the value so that being said
we can come back over here we can forget
about passing in the team file of people
file it's going to yell out again
because one more space here we can say
global config dot team file dot full
file path and all the rest and then
and global config dot people file now at
this point you're probably twitching and
you should because I now have over here
in my global config I have these
constants which are the file names for
all of my different files but then also
in text connector I had that very same
list I use different I use this for most
stuff and I use this for little stuff
that's not great but right now it works
and right now it doesn't step on each
other's toes the problem is that they
are in two different locations and their
copies of each other therefore if I
modify one I have to marry modify both
that's definitely not dry they do not
repeat yourself so eventually I need to
refactor that today is not that day
we've got enough stuff to do but
eventually I'll go through and refactor
and what I'll do is I'll rip out
everywhere as I use these and I'll point
them instead to use these instead so now
I have this team model look up at least
getting all of the teams now I can say a
returned teams dot where X equal greater
than X dot ID equals ID na is ID that
first and now we're returning we can get
really exception through now return the
first team where the ID matches the past
NID will this blow up if you don't have
a valid ID absolutely
you should never pass in and about
invalid ID if you do something's gone
for be wrong therefore we want to blow
up so
let's just keep that in mind so team
look up by ID that's complete so we're
done here now we need to do this convert
string to match up entry model in
essence it's the same pattern only we do
that split first and then get each ID so
we're going to say string array will
call this IDs equals input dot split on
the char and the chart here is pipe
remember that entries is pipe delimited
by ID so now in theory we have a list of
ID's where those are the match up
entries for this matchup so now we want
a list of match up entry model called
output create a new list for that and
then next we're going to do is we're
gonna say for each string ID in IDs and
we'll do the same thing we did right
down here so we'll say output add and we
need to have that list so I comment it
out for a minute first needle owed the
list of our instead teams our match up
entries so list of match up entry model
entries equals as we do global config
dot and this is the match up entry file
dot full file path that load file so far
so good we have all this stuff that
convert to match up entry
hols we don't have that one that's okay
because we're going to create it but
let's pretend for a minute we have it
now what we say is output add entries
where x equals greater than X dot ID
double equals in dot parse ID and we're
going to say at the end of that dot
first so to the first match on the ID
from our entries list so I look up
entries which is all the entries we have
we're going to find the one that has the
matching ID we're going to add that to
output we're loop through the next ID if
there is no ID the final thing is return
output so this method is done except for
we have to create this extension method
now let's create that extension method
it's going to be a public static list of
match up entry model there's a name this
list of string input and that's all we
need we can do a return let's do a throw
new not implement exception just for now
just make sure everything else will fix
on compile I don't see any other red
squigglies so now let's find the pattern
for this convert so it's fine another
convert in here
let's get a simpler one nice to convert
to person model sounds like it's a
reasonable one and I'm going to paste
the code in here and I'll use this as a
pattern so I comment it out for now
the important thing is just to see the
pattern how it works so I'll just start
up top and I'll say list of match up
entry model output equals new list of
match up entry model I'm going to do a
for each string line and lines and
whereas lines it's actually our input
okay so now we're going to say split
this up by columns split on the comma
into the simple lookup this is just
reading from our match up entry model so
let's pull our match up entry model up
we'll put it over on the right-hand side
and we're going to do a couple of things
here so you have ID first
so let's actually create our information
up here so we have our ID equals column
zero the team competing equals column
one the score equals column two and the
parent match-up equals column three
so now down here just follow the pattern
we have down here we're going to say
match up entry model call M equals new
match up entry model let's call it a
melee consistent and call it value for M
G dot ID equals int dot parse calls zero
that's our ID next we have M dots team
competing what's the team competing well
that's going to be calls one but
actually the ID of a team competing not
the actual full model how you get the
full model well it feels like we've done
it before
and in fact if we look down we'll see
that we've done this recently I just
forget where my code I did it believe
it's actually down here keep going down
and we'll find look up team by ID I'll
copy that whole entry now scroll back up
to where we're working and say team
competing equals lookup ID but not call
too
it's called one that's the column for
team competing so that was actually
pretty simple
me dot score and score is an integer
nope it's a double so therefore we say
double dot parse calls to and now
finally we have me dots parents
matchup equals and it can't do call
three we have to have something and
we'll just keep tugging on this thread
press a look up ref all same pattern
look up team by ID where I'll look up
match up by ID in dot parse this will be
an ID calls three so we're going to
pattern the lookup team by ID we're a
pattern that for looking up a match up
model so let's find look up team by ID
let's create one right below it called
private static this will be a match up
model look up match up by ID into ID and
then we're out of say first I'm going to
do is get a list of match up model
whereas a match ups equals global config
dot match up file that full file path
that load file dot convert to match up
models
and from there we're going to say return
matchups dot where X equal greater than
X dot ID double equals ID dot first
follow the exact same patterns up here
we're just going to call it convert to
match up models and from that we can get
all the match up models and from that we
can get the specific match up model we
need from the text file and get that ID
and rehydrate the entire item now you
may notice this is a little bit circular
because we are working up here let's
find it we're working up here in the
convert to match up entry models whereas
I get called if you mouse over you see
the one reference right here it's kind
of small this tells us how many places
this meth is called we can click on it
and it shows us well it's on line 238 of
well this file so it scroll down we see
line 238 that's where you call it
convert to match up entries file and so
you start going backwards you'll find
that we're calling each of these methods
back and forth a little bit and that's
okay because we're calling the match of
entry model and then we're calling a
matchup molecule and match up entry
model back and forth as long as it's not
totally circular where we have this
problem where one relies on the other
and the other relies and the first one
to the point where they're both trying
to get piece of the information account
locks up as long as that doesn't happen
we're fine but
looking up here is the parent well as
long as store things in the right order
we'll have saved the parent model by the
time we need to get it for a matchup
entry model because the first round has
no parents its own the second round and
beyond that has parent ID and so at that
point we'll leave the parent ID but
those will already stored in the
database so yeah can you a little bit
confusing especially I was looping back
and forth and sometimes it's hard to
visualize what all these different
methods do my encouragement to you is to
step through it manually by pretending
like you run a file through it and see
what happens so now we have this lookup
match up by ID and put that in the
parent matchup there's one problem with
that though so let's go down and look up
the match up by ID here we said just
grab the first where the ID matches well
what happens if the ID isn't there well
it blows up and normally you know for
example the team lookup team by ID we
have to have a team there but remember
that the parents may be no and so if the
parent is no that's the first round of
people they'll have a parent match up if
that's no then that would be an empty ID
therefore we couldn't parse it up here
we couldn't do an int that parse that
would blow up even if we guide to to
somehow pass the information through we
wouldn't find that team in the list so
that first would also blow up so this is
the kind of problem so what we do is we
fix this
by saying when you change how this is
processed let's do this if in dot parse
calls three have to try parse if int dot
tryparse calls three where I say out and
here's where we have to give it a value
so bear with me here I'll explain them
it int this would be the parent ID
equals zero and we'll pass that as the
output parameter if it's true then do
this else we're going to say me dot
parent match up equals no so let's say I
step back and look what's happening the
very first thing I do that create this
ID that will hold the parent ID that's
an actual integer next into an if
statement and I say if in tryparse well
tryparse tries to parse the value if it
succeeds it says yeah and returns true
if it failed this is aw and returns
false
so therefore if it succeeds it's a valid
ID therefore we don't have to do oh it's
this parse here we're going to say
parent ID if it succeeds then it will
send the value back out through the
parent ID we've done in dot tri-party
for so much I go over it over it but now
this parent ID will have a valid value
of an ID therefore we can do a lookup
but it was an invalid value or the
tryparse fails essentially we
an empty string will fail a tryparse if
it fails put a null in parent matchup
which is exactly we want so now that
should do the trick
so looking our pattern we've got the
create the output list we've done a for
each except for the output dot add so
the end of for each we say output dot
add me or Emmy which stands for match up
entry so add that to the output and then
after the for each we return output
that's right there
so we don't need our model anymore and
now this right here converts to match up
entry model so now that works for the
entries and now you can say grab the
entry where it matches so probably
that's point you've lost the thread of
where we're at so here's what I do I
minimize or shrink down the methods that
are done and it's right here appears he
done as well this converts a string to
match up entry model and that was what
was calling the convert to match up
entry models that I needed therefore I
can look on the reference here and see
where was that called line 270 I can
click on that or Dhokla and go right to
it which is right there and now I'm back
to where I need to be which is convert
to match up model so I'm looking to
convert to match up model I see that yep
that looks like it's right and that's
called right here look up match up by ID
that's called up here and so now in that
loop there and we'll make sure that I
get add that loop at least in the code
and so if I step back by again shrinking
these down and start do a little
investigation of where is the next step
I need to take in this process and right
here I see I have this save match up to
file and then save entry a file which is
also blank so I have a section right
here where I'm saving a match up and
then I need to save the entries
well I created the convert to match up
model so the first thing to do if I
follow a pattern which is over here I'll
just grab this pattern this one works I
can grab this pattern right here and
comment it out I can say list of match
up model call it match ups equals global
config dot match up file dot full file
path dot load file dot convert to match
up models we just finished all that so
now I just loaded all the match up
models and now I can do my check for
what the maximum ID is I come back over
here and grab this code because I know
that this code works
now let's paste it and I can get rid of
other code up here now just a pattern so
again I'm going to follow a pattern here
this case I'm going to just
override the values so current ID is one
if match up count is greater than zero
the current ID is now match up stop
order by descending by ID grab the first
one take its ID and add one and now we
can say the match that we passed in that
ID is the current ID and now we have
that ID populated for a matchup now we
need to save each entry in our list down
here so getting a follows pattern up
here so list of match up entry model
right call this entries equals global
config dot match up entry file got full
file path that load file
isn't it great calling methods that
we've called over and over and over
again just do their job and it just you
don't think about it that's one of the
great things like code reuse alright
anyways convert to match up entries
model now we can say same patterns up
here int current ID equals 1 if and this
is the entries dot count is greater than
zero current ID equals entries that
order by descending x equals greater
than X dot ID that first dot ID plus 1
and now I can say that the entries I'm
sorry the entry
dot ID equals the current ID now you may
have noticed we haven't actually saved
this match up back to the file and we
haven't saved this entry back to the
file yet and there's an ordering thing
we have to get around here and so what
we're going to do is we're going to save
the file here and then after we do the
for each then we're going to say the
match up file and the reason do it in
that order is because the match up is
the one that has the list of match up
entries and so we're going to do is
around pipe to limit that by their ID so
therefore we have to do it in this order
saving this one first so we have the ID
for each of them and then come back and
save the file up here so we have those
IDs for saving just like we'll need to
save the information with their rounds
before we save the tournament file so
let's figure out how to save this
information and it's again is where you
look for our patterns so you come up
here and look for let's look at this one
this looks good grab this pattern and
then we'll come down here to where we
need to save first our save entry to
file and we'll look at actually saving
our entry and so this is our pattern so
comment comment this out and we're going
to say okay we need a list of string and
we call this lines
equals new list a string that works and
now we're going to do a for each on our
matchup entry model entry in entries and
that won't work if you already have an
entry so I'll call this just e we also
the remember before we do this to say
entries dot add entry don't forget to
add the newest entry to our list it will
loop through every entry and we're going
to say lines add or use a dollar sign
syntax will complete our whole line
before we come back and put information
inside the double quotes and this is
where we have to follow our pattern so
what is our pattern well to come up here
we'll find our convert to match up entry
model and there's our pattern let's grab
that and then now down here we can
follow the same pattern in Reverse so
the very first item we put in here is
going to be e dot ID comma no space then
we have e dot team competing dot ID
don't forget it's just the ID not the
whole team comma no space e dot score
comma
oops no space e dot parent match up dot
ID
now what if parent match up is no and
we actually add some code before this
lines that add stress a string parent
equals empty string let's say if e dot
parent matchup is not equal to null then
parents equals B dot parent match ID and
it can't just put a int into a string to
say dot two string so now you can use
this parent in place of e dot parent
match up dot ID and it will either be an
empty string nothing there or it will be
that ID so that's perfect and that will
work for every loop through that's great
and that's our pattern zero is ID got it
one is team competing is ID got it and
teen competing should never be known and
two is score got it and three is that
parent match up ID or blank we've got
that as well so we followed our pattern
and now our pattern says outside the for
each we're going to say file dot write
all lines
we're going to pass in the file name dot
full path what's the file name Global
can see dot match up entry file dot full
file path count off lines so we follow a
pattern to the T and now we have stored
our entry model and since we're going to
call this either once or twice to pay a
match up we'll have stored either one or
two entries in each one being sure we
get the ID for it
and now we can actually save our matchup
so we'll follow the same patterns down
here so let's move so we can seed both
you know say list of string lines equals
new list of string now say for each
let's Li match up entry
I'm sorry match up model I'll call it m
in our our list is going to be match ups
any matchups there we go
I spell it right so for each matchup in
match ups we want to do this right here
so we'll ignore this for now we've got
to figure out if we actually need it
first let's find our pattern for the
matchup so we need to have the save to
match up file let's find that ok so we
can expand this out and here is our
pattern we have to follow so coming down
here let's go ahead and paste our
pattern in and now we're going to say
lines dot add dollar sign to do a quotes
finisher laugh that's going to : come
back and the first one is m dot ID comma
no space as m dot as the entries the
problem is that we have more than one
entry potentially and we have to convert
these to a pipe delimited list so how we
do that
we've done this before so let's find out
where we did in fact we can come down
here and see convert round list of
string convert match up list a string
convert prize list of string so let's
just grab one of these let's convert the
convert prize list and you know what
we'll actually just paste this and said
convert prize list whereas a convert and
this will be match up entry lists to
string call entries I'll rename price
entries which will rename all of these
so it's as if the count is zero return
nothing for each entry will call it e
into the P under the control dot there
as well to rename it and then we're I'll
loop through every match up entry model
in our entries grab the ID pipe to limit
it take a substring at the end to take
off the last pipe return the output so
it's tough you've already done it for a
number of times I'll come back up here
to where you're working and we have this
MD entries and that's not right we have
to pass in our list of match up entry
model and we should get back our list of
string pipe delimited so now we can move
on to no space M guys winner and here's
the problem we need the winner ID but
the winner is most likely going to be no
at first so we'll follow the same
pattern that we did before right down
here
copy this and I'll paste up here and
change all the information so winner if
m dot not parent matchup but winner get
rid of that if m dot winner is not equal
to null then winner equals m dot winner
not whiner winner dot ID dot two string
so it's the same pattern there we're
going to grab if it's null then we
revert back to our empty string but it's
not null we grab the ID so that's the
winner and then finally we have to pass
in the match up round no space here m
dot match up round and now we have our
line to save to the database or to the
file I'm sorry
and now after you have our line added we
just call this line right down here and
just change the file name so it's that
match up entry file we're going to say
it's the match up file if we're in the
save match up file so we will save that
match up file and now this is done we've
saved the match up file to the database
and so now we can look at the reference
for this go where it's called and see
that our goal here for save rounds the
file was the loop through each lap round
go through each match up get the ID
which we've done that we've done gone to
the round the match up grab the ID for
the match up and save
the record and then inside of here we
then loop through every entry got the ID
and faded so we've done all that so now
this is complete we can go where it's
been called from model dot save route
the file and so now all the rounds have
been saved and so now we do the
tournament's dot add the model and save
the turns file we can feel comfortable
knowing that's been actually saved to
the database properly and we'll save all
the information to the database now the
only thing left to do before we test
this is we have a to do that's still
outstanding capture round information we
go there we see that in the tax
connector processor we have this convert
to tournament models this is where
rehydrating from a text file
our current turnip models that are
available and they load everything
except the round information so now we
need to load the round information so
how do we do that well we've got most
the code already so it's not going to be
nearly as hard as you probably think it
would be so we've done is we first have
to capture all of the round information
which is actually the matchup
information we scroll down here and
sometimes if you want you know mark your
place somewhere just put a breakpoint
it's easy to find that break point in a
list and come back to it see a little
dot over there you can see that a dot
right there and if you mount cursor
somewhere else it's easier C to go there
I just move my eye bar up you'll
actually see it so that's we're going to
put information but let's go down and
find out where we're loading match up
information because remember that the
way to store the rounds are store
word by mashup model each of these IDs
represents one matchup model so this is
actually pretty simple because down here
we have a look up for matchup models
list of matchup model right here and it
grabs all the matchup models have been
saved in our text files so therefore we
can come up here to our lists and paste
that in so now we have all of our
matchups so now we can say string array
and we'll call this rounds equals calls
I believe calls 5 let's check to be sure
calls 5 is rounds correct
so calls 5 dots split now we're going to
split on the pipe character first and so
what that will do is it will give us
let's look at our example here it will
give us this chunk you know split on
this and they'll give us this chunk and
this chunk so that's our list of
matchups so therefore we need to do is
do a for each say string wrap round in
rounds go loop through every string here
we're going to do a string array where I
say match up match ups equals round dot
split and the character s split on is
the carrot
and it looks like we already have
matchups up here so you can't use
matchups let's just use ms/ms
networks for now so up here notice we
have everybody said this was one chunk
well if we split this chunk by that
carrot symbol then we'll have an array
of ID's so now we have the array of ID's
we can add to our tournament model t m
dot rounds and it's need a first round
so we'll actually have to create a list
for this so let's create a list of in
this case a list of match up entry into
our match up model and we're going to
call this let's call this M S which we
have a name conflict there so we'll say
that this is M s text alright so we have
here is let's get rid of this from it so
we have here is we've got our list of
match up model let's ignore for now
let's get back to that a minute first we
split on our pipe character that gives
us an array a string array of chunks of
data and those chunks are these chunks
right here and then for each one of
those we split on the carrot and so now
this array contains a series of IDs in
string format so we can then use to look
up our matchups so we do a
a for each here let's we'll come back to
why you need this matchup model where do
a for each and we're going to say string
and this is going to be the matchup
model model text ID just be very clear
what that is
and where I say in MS text so now we
have a series of IDs that are in string
format and so we're going to say we have
to add these once we do a conversion
notice it's right here we find the ID
where it matches Gretta first when we
and normally we just add it right to an
array or a list I'm sorry right off of
the tournament model we can't do that
yet because it's a list of a list of
match up model therefore we have to add
it to this matchup model right here so
we say MS dot add when I say that we
grab the match ups right up here match
ups where x equals greater than X dot ID
equals W equals inte r s' and this is
the match up model text ID and then
after that we're going to say dot first
and instantly call it the very end so
what that does that find the match up
model that matches the ID so if we've
grabbed now down to this level and to
find that one next we'll go to this one
and next we go to this one when we're
done these three that's one section
where they need to then take that list
of match up model and
push it two rounds so therefore once
we're done this for each then we're
going to say that TM which is a
tournament model that rounds dot ad
first ad m/s and that's our list so
actually I move this and have a
declaration down inside our for each
because that way it will go away we hit
this curly brace right here it will get
recreated once we start into this career
base up here for the next iteration and
then for every one will create that will
populate that list take a list add to
the rounds by the time we're done we
will return our will have populated all
of our rounds therefore our to do is now
add to done we can just take it to do
off and is now it says capture rounds
information and that's what should be
doing so we've got a lot of code in here
guys see if it's going to work so let's
go ahead and test it so come on a
solution explorer we can repin this come
down to program CS change the sequel
type I'm sorry database type to text
file and we should be able to run this
so let's hit f5 let's start this and
crash which again not good so let's call
this our text tourney
the entry fee is going 25 we have the
best team that's the only team so let's
add that team to the list and then
create a couple more we can do three so
the worst team and we'll put Bob Smith
in that team and just Bob and then we'll
create another one and we will call it
the ok team and we will put sue on that
will create that team and we'll create a
prize let's just do just one or I call
it place numbers one first place and the
prize amount is $100 now we will create
tournament before we do though let's
move this over so we have this list of
our files when we have three so far and
click create tournament it blows up and
that's okay again it says object
reference not set to an instance of an
object I told you that we come from
there to do so let's close out the
exception but not pause the code or not
change the code so we're still sitting
here at this line and it's asking for
parent parent ID parents one as cool a
score is zero that's cool he got team
competing is no so here again if we look
at where we are our entries we're going
to find that this matchup entry is ID
number 4 and so we've already gone
through notice the ID for the matchup
round for the parent is 1 and so we've
already gone through this one so now
we're in a second round and so there is
no team competing we forgot
to make that modification so let's do
that right now in line we'll say string
you can do a straighter this is a string
right here so string will call this team
competing equals empty string if e dot
team competing is not equal to null then
team competing equals e dot team
competing dot ID dot two string it's not
the same logic as a four and now we'll
just move our place up to this line
right here hit continue as I say we'll a
little nope can't do that because we
never change this line right here so
let's go back up to here and change this
to use just that string variable instead
of directly call in and now I can write
again and we get a different error input
string is not in the correct format okay
let's figure out why so calls we can
hopefully get rid of that error count up
there you go notice that calls for
position one is an empty string which is
okay look up team by ID for team
competing that's going to know so let's
step into let's move back up one whereas
step into the code we're going to go
into lookup team by ID and it goes nope
can't do that here's why we're doing in
top parse here so look up team by ID
that's not going to work
because we're not passing in a valid
integer
and so what we need to do is we need to
kind of bypass this line let's say if
int + 90 inch coals 1 dot length equals
0 what's called one coals length right
now 0 why do you know that
well coals it's either a number or it's
an empty string therefore the length
equals 0 then me dot team competing
equals no else and this is where you put
this code so I actually move my cursor
up right now or my process line whatever
you want to call that and then I will
move that line inside my else statement
and now if I run this we should see that
team competing becomes null and we can
continue on and we get another sequence
contain note elements error so that's a
little bit different before so let's
figure out why we're looking up match up
by ID
what's the ID 1 we have match ups right
now has 0 in it now this is an
interesting one because when I look up
the match up ID I see that this says
that the value is 1 but when I look up
and look up the value for the matchups I
see I have 0 match ups from my matchup
file if I actually open up the file
itself I will confirm that yes that's
true
so this is one of those things worth
memorizing before you have a circular
issue and it should be ok it looks like
if not so how we diagnose this well the
first thing I do they'll find out where
this was called
so I'm just going to move my line up one
so my yellow indicator of where I am and
then going to put in some code that well
let's return out of this method it is
really 'invalid okay return null so I'm
going to come back through in this text
connected processor line 279 and delete
that code so I've never to do that I
move my cursor down to that and I'm
going to say step in to go the next line
and see that I am in the convert to
match up entries model now remember that
we have to do this
convert to match up entries model when
we're saving to the file for the match
up entries so this is the loop part that
we've gotten issue on where I'm trying
to do a lookup and I'm saying give me
the match up ID of one but it's not
saved yet because if we look at the
ordering and that's that ordering is in
here somewhere and let's find that and
here I found that we have a save match
up to file we come through and we create
the match up and get the match up ID and
we say save entry a file down here for a
match up entry which actually saves the
file and then you come back up here and
save our match up to file because we
needed those IDs for the match up
entries so we've got an ID they passed
in here and said this is our ID for a
match up but we don't actually have it
saved to the file yet so that's a little
bit of a circular issue here where we
need the ID nor a continue and we need
to continue before you put the ID in
and so I'm actually going to stop right
now stop this code take out my my junk
code which is its return null and then
address this issue here so I need to
save this this match up to my file
before I save my matchup entries but
then I'll need to update that again once
I have my my matchup entries saved so
let's just do that let's save it twice
now this code can probably a refactor by
this point I'm trying to debug and make
sure it works working code is much much
better than refactored code that still
has a bug in so right now I have all
this code right to my my text file well
what if I did this I copy it and I
tasted it before I have my matchup
entries and Alice need to take away the
declaration for the lines right here so
if I do this the only issue that I see
right now is that when I loop through
and I try and add my entries that's
going to be an issue and so I have my ID
and I have convert match up entry list
to string well right now there is
nothing in that list
therefore I really could say empty
string and I could probably get away
with that I think I can't so if I can
get away with that then I'll be good
I'll save this entry will be in the file
and I'll come back through and add the
match of entries and then afterwards
I'll do the exact same save again
only this time I'm going to save it with
the correct IDs so that's one
theoretical way of saving that or fixing
that issue but you know looking at this
now to undo all of this let's just redo
that undo all this and look at it again
and just look at my pattern here and the
one thing I'm noticing my pattern is
that I have my matchups list which
converts all the current matchups over
into my matchup entry here but what I
don't have is anywhere that I'm adding
this matchup to my list of matchups and
that's kind of problem so let's do this
matchups dot add matchup now I add that
before I did my entry model but that's
okay because again the whole idea of
address each of them has an address the
same location so if I modify my entry
models not a big deal so with this fix I
know the other problem and what I'm
saying is I thought I had the loops
taken care of so let's see if the quick
the small fix that I know is a problem
fixes the issue or if I have a larger
fix as well so we've got idea for a
larger fix but let's start with a
smaller fix and see if this works so
let's call this term it's something
different in fact let's call it
something different that way we know
that it's different than the previous
one that may have been partially created
the best seen the worst to me okay team
so three teams will create a prize will
create the prize for first place and
we'll call it the only place and the
prize amount is let's say 150 this time
let's say create tournament and we get
this sequence contains no elements so we
still have a issue of matchups being
zero which means that this right here
didn't solve our problem so let's again
take this logic right here and we're
going to copy it we're going to paste it
up here and we'll again change this so
it's not being rida cleared but Rhian
Stan she ate and now we have two saves
one before and one after now you might
think wait a minute am I going to have
you know duplicate match up to something
like that the answer is no because we
only load the list of matches once and
we add the new match up and then we save
it over writing a file and then we save
it again over it in the same file so it
should be that we're good there
and we'll try this empty string here
notice even though the career aces are
here this empty string still works and
so that's just kind of benefit because I
can leave those curly braces there is
saying yes this is a entry and so 0 1 2
3 is easier to count than 0 oh that
string right there is one you noticed
that duplicate comma isn't a mistake
it's there's actually a column there so
that's just some quick and simple so
this is a kind of a hacky solution right
now but we can refactor this and get
better first let's see if it works we'll
call this tournament does it work and
that's the entry fee is only $5 and
we're going to add all three teams will
create a prize this prize for place
number 1
best for first place and the prize
amount is only $15 and will create
determine now nothing seemed to happen
yet alright we have a stack overflow
exception that's not usually good tech
overflow means you have a problem
loading something let's look at what
we're trying to load all right we're
trying to load the person models dot CSV
so let's look at our file person Myles
dot CSV
there we go it's one kilobyte that's not
a big deal
if we open this with notepad we'll see
we have Joe Smith Sue Storm and Bob
Smith that's fine so if we read all
lines of this what should be the problem
well I don't know and it seems to have
crashed so let's first of all look at
our files for matchup model again don't
panic
matchup model has one entry matchup
entry model has four entries so you have
something going on here and now let's
look we don't have a tournament model
yet we haven't gotten that far so let's
start again and just run it again see if
we can reproduce that bug buggy
entry fee is $5 we're add all three
teams will create a prize will do for
place number two bug place and the prize
amount is 10 and will say create term
again and see if we get that same error
and we do an unhandled exception of type
system dot stack overflow has occurred
make sure you do not have an infinite
loop or rapport infinite recursion so
that's interesting we've got and
possibly an infinite loop on the loading
of team models so that's the place we
need to debug now it's this point that
I've got two suggestions number one is
that when you get to this point where
you've written a lot of code and you get
these weird errors you can't quite
figure out why before you just start
hacking stuff together which we've
already started a little bit with that
that one hack which we thought would
work and I'm not sure why it's not but
instead of continuing to throw more code
at it stop pause take a break take a
walk take a shower go to sleep what that
will do is it will refresh your brain
and you'll be able to comment this
problem in a little different angle than
you would right now and the other thing
is you know especially for this video
we're getting kind of long and I don't
want to have this video be a you know a
series into itself and so what I'm going
to do is I'm going to dedicate a video
specifically to debugging we're going to
figure out how to debug these weird kind
of errors where it's kind of hard to
think out what's going on because if I
hit you know step into it maybe stops so
how do I know what the recursion is why
is Stack Overflow exception which seems
kind of like an infinite loop is a
private possibility but where is that
loop and so we're going to stop this
point we have a video dedicated just to
be buggin which would be really
instructional because it will walk you
through that process because here's the
deal this happens in every application
so far we have been incredibly fortunate
in that we have followed our plan our
plan has mostly worked and it has very
very few errors but as you can enter
these real long complex applications or
sections of your application we are
creating you know method after method
after method that can get kind of hard
to track back where you were and keep
track of all the different steps and
where you left off and we already saw
that we've already done that where you
know wasn't quite sure where to go back
to and I had to you know use the
references to go back to it and so it's
at that point that you can introduce
more bugs and so we're going to break
for now we're going to do a debug next
and show you how to identify where this
bug is is and how to really crush it all
right so definitely stay tuned for that
so we can get our application back up
and running and then once we're done
debugging we'll move on to create as our
two forms</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>