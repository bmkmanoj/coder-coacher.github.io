<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Getting Familiar with CouchDB and Futon | Coder Coacher - Coaching Coders</title><meta content="Getting Familiar with CouchDB and Futon - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Joshua-Morony/">Joshua Morony</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Getting Familiar with CouchDB and Futon</b></h2><h5 class="post__date">2017-03-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/JVWeb-xPRPs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in this tutorial I'm going to walk
around how to use couch there be a
little bit I've just got the interface
here the futon interface that you can
use to interact with a couch TV database
it's sort of a visual representation of
the database so it's a little bit easier
to see what's going on so if you've been
following my blog at all recently you
may have seen that I've done some
tutorials on how to use couchdb I'm
doing a series on using couchdb with
ionic but i still let just do this quick
little video to I guess give a little
more hands-on fuel to it and actually
have a look at playing around with a
little bit of data and seeing what that
looks like as opposed to the theory then
I have in the tutorials so if you
haven't read them I'd recommend giving
them a read I go into depth about some
of the ways that you do things and can't
she be it's very different especially if
you are used to a relational styled
database like MySQL something like that
the way in which you store the data and
you retrieve the data is very different
so it's going to do a really quick walk
through this interface here and we'll
play around with adding some data and
how you might go about querying that i'm
also using a new microphone for this
video is my portable travel microphone i
guess i don't have my usual one that I
use at home so I do is a bit weird I
apologize for that hopefully it sounds
alright so I've got the futon interface
up now as some once you have CouchDB
installed you'll be able to access futon
you can do that just by going to this
URL here I will see this icon up here
that I can open the admin console from
that's this but essentially this is just
a way to view your databases you have
installed and then interact with them if
you're not already familiar the primary
way in which you interact with the couch
TV databases through making HTTP
requests this allows you to
use it in a way you might use say like
PHP myadmin if you're used to that it's
just me interface where you can click
around and add data manually so these
are just some databases that I have set
up previously mostly just a bunch of
junk databases what I'm going to do is
going to create a new database and we're
just going to go through a sort of
example of what a a blog type database
might look like and it's gonna be a
really simple example but i just want to
show you some of the key concepts so you
can create a new database by clicking
create database up in the top left here
and we'll just cool this blog example so
click on create another crab the
database for us and now we are inside of
that database and so data in CouchDB
installed as documents which is
different to set up the tables you may
be used to in a relational style
database I keep using the example of
relational databases because it's very
common a lot of people sort of grew up
on that sort of stuff from maybe you
don't have any experience with database
databases at all miss Kay so it's
probably even better you don't have
these sort of concepts you need to
unlearn since this is so different but
essentially a document is just a JSON
string same as any kind of JSON object
you create in an all JavaScript and I
guess the concept with a document is
that the idea is that a document is
self-contained thing and like an invoice
or an email where it has all the data
that you need and other than is strictly
the case but I guess that's where the
name document comes from so what we
might do in this database if it's for a
blog we would want to add post and the
way in which you structured data
wouldn't with a no SQL document based
database like this it really depends on
the application there's no really rules
like there is with the relational style
databases these sort of best practice
ways to do things with no SQL it's kind
of more open to interpretation there's
different ways you can do things and it
really depends on specifically what your
architecture is like
but there are some sort of common themes
that I used and in a lot of ways they
are similar to what you do in a
relational style database so if we have
we have a blog we want to have posts
from that blog one thing you can do is
to store each blog post as its own
document so that's what we're going to
do right now so to do that we're going
to set new document and we have to
assign an ID to our documents this can
be assigned automatically by couchdb but
we can also just turn this into
something a little bit more useful as
well because IDs are primarily what you
use to retrieve data so if you want to
grab a document you grab it by its ID so
in the case of a blog post it's going to
make sense to have this as say a B two
slugs the URL for the for the blog post
so if the title was my blog post we
could have that as the ID and now we can
easily retrieve that based on the name
rather than having to supply this random
string of numbers and letters so we use
that for the ID and then there's going
to be some other fields that we're going
to want to use as well as obviously we
want something like a title we'll just
call it my blog post and perhaps we'll
have an author field as well so what you
might notice here with with these
document-based databases we don't have
any predefined schemer that we need to
make our data fit into again back to the
relational style database example before
you even add data you decide what
exactly you want to store in each table
with this word is kind of making it up
as we go along now so this doesn't mean
that no sort needs to be put into how
you store your data is just say it's
flexible and it doesn't have to be done
up front with this document I'm creating
here I don't have to adhere to any
strict format if I wanted to say add
some extra field like maybe a co-author
field I could add this to this document
but not add it to others but i'm
probably going off on a bit of a tangent
i don't want to get into anything too
complicated here i just want to focus on
the basics and just walk through
how this works in general so we just had
one more field we had content because
make sense of log to have some kind of
content to a post and what you say this
is my blog post and to save that
document is hit save in the top left and
once that document is saved you see it
adds this revs field and it's one dash
and then a bunch of random numbers and
letters and so with couchdb it keeps
track of revisions and this is important
to how it deals with conflicts and
concurrency and stuff like that where
multiple people are trying to edit the
same thing I'm not going to touch on
that in this video I'd recommend reading
the I think the first post i did that
explains that concept but essentially
what happens here is that every time we
make an update to this to this document
this revision will increase by one so
right now it's one dash but if I make an
update say if i change the author from
josh to joshua if i save this now you'll
see that the the revision their updated
to two so we can see how many times this
post is being modified okay so I'm happy
with that document for now I'm going to
jump back into the main page of the
database here and you can see we have my
blog post so now with its ID of my blog
post and you can see it's the revision
here as well so now I can do the same
thing again I could add another blog
post using that same format but I might
also want to store say comments for a
blog post and so the question then is or
where do we store the comments now one
thing you could do with this document
based no SQL structure you could add the
comments directly to the document itself
so i could add another field here call
it comments and then this could just be
an array of all the comments that have
been added to the post I which has its
benefits because what we have to do is
grab the document make one request to
retrieve that document from the database
and then we have the blog post with all
of its the title the author's at content
and we have all of its comments as well
so that's certainly saying you could do
any time a comment inside of you just
need to retrieve that document save the
comment add it to the comments array and
then save that document back but there
are problems with that in that if a lot
of people are updating this document all
the time there's going to be a lot of
clashes there so it's perhaps not the
best structure in this case so we're not
going to go with that for this example
I'll just delete that and so we use
another sort of popular structure and
that's to have each comment as its own
document so if I create a new document
now we can go through that same sort of
process again we need to supply an ID
for that comment because it's a document
every document needs an ID will just
accept the default ID here we could
change this to something more useful
perhaps like that the the commenters
username combined with the name of the
blog post or something like that so it's
going to be unique preferably and then
you can do fancy things with grabbing
that but we'll just leave the default ID
for now and then we'll of course perhaps
have the author of the comment I'm just
going to be the author for everything
here and then also obviously what they
said so have some content for that as
well and perhaps i would say hello so
the problem we have now is that we have
these multiple documents some our blog
posts and summer comments so we need a
way to tell them apart when we're
querying the data and that's going to
become apparent when I walk through that
in just a second so what is commonly
done is to also include a type field to
identify what type of document appears
so i'll add a type of comment to
identify that this is a comment and i'll
save that and that also means I'm gonna
have to go back into this post and we
also want to be able to identify that
this is a post another comment so I add
a fuel here to add the type field and
we'll add post if you like there you can
also
identify what type of document a
document is by inference I guess as well
you could say well if it has has a title
then it's obviously a blog post so you
can kind of infer that from your queries
but having a dedicated type field does
make that process of it easier okay so
what am I do now is I'll just go and add
a couple more so I should save that I'm
going to add a couple more examples I'd
said a couple more posts and comments
perhaps because next I want to show you
how to query this data how you go about
retrieving it and it's not going to be
that interesting which is too so I'll
quickly go ahead and add a couple things
now actually before I do that one
important thing that I've actually
missed here is um how do you then we
have a comment we have blog posts how do
we identify what blog posts a comment
belong stood and like we added a type
field to identify that it's a comment
also need to add a field that ties it
back to the document of belongs to so to
do that we could add a we could add a
field called post that identifies what
post that belongs to by using that post
ID which was yeah I forgotten I think
with my my simple blog I have no idea I
have to go back and check that will go
that for now and we'll check it my blog
post I just update that and you see as I
change that the revision will change
okay so now we have a way to tie this
comment to this post so as I mentioned
I'll go through now notice add in a few
more examples okay so i have a bit more
data here now not that much but i've got
three blog posts and 2 comments and both
of those comments actually belonged to
the my blog post post so what I want to
do now is run some queries to grab the
data so i may want to amount to do a
couple different things with this data i
may want to say get a list of all the
blog post if i want to display them in a
list on my blog I need to be able to
grab those i also want to grab below the
comments for a blog post so i'm going to
show you how you can use babess thing
called MapReduce and to grab that data
through using a view in couchdb so
viewing CouchDB is as defined in this
thing called a design document which i'm
not going to cover in this video so when
you're actually setting up your
application that's where you store these
MapReduce views that you're creating but
for now we're just going to use we're
going to use a thing called a temporary
view here which is just sort of a thing
to play around with to see what kind of
views we can create so if I go into that
interface here you can see the the map
and reduce options here so I would
recommend reading my tutorials that I've
written for a full explanation on what
Map Reduce is exactly but is the it is a
primary for the way you work with the
data and we're carrying the data and
couch TV so what the map function does
is it'll run this function on every
single document in the database and then
something will happen in this function
at you determine and then you omit what
documents you want to add to this list
of data and so that's what your your
view will be so it's going to be much
easier to see when I actually run a map
function in just a moment but
essentially it's just this list of rows
of data and then you can query for that
data you can retrieve that and use that
in some way and the reduce
function is sort of an optional I think
you can do after you map some data you
can sort of use that to run operations
over the data as a whole you could say
for example the map you might retrieve a
list of all the comments with a reduced
function you then might do a count of
all those comments and sort of reduce
that to a number like 10 to represent
how many comments there are we weren't
really relying on the reduce function
here we're just going to folks our focus
i'm using the map function so i gave two
examples just a second ago i said i may
want to retrieve all of the the blog
post for the blog and i may want to
retrieve comments for the specific blog
post so let's focus on the example of
retrieving or the blog post service so
we have this function here that's going
to run for every document in the
database and what I want to do since we
have a field of identifiers something a
document as a post all we have to do is
that a if type equals post then we want
to omit that post of that document and
so what Amit does is just to supply that
a plate with a key and a value and so
the key is what will be able to be used
to retrieve that specific row of data
from the view that's created and then
whatever is in here will be the value
that's associated with that key and so
what we'll do in this case is we'll just
use the post title that has the as the
key so we use dot dot title and then
we'll just supply the whole document as
the value in this case so if i run this
now it creates this view for us and so
this is what couchdb will create when
you create these MapReduce functions and
your design documents it creates these
views that you can then at query for
your data and so in this view here we
have a list of every one of the blog
post that we have and so if I wanted to
then retrieve one of these will have to
do is supply the key
which is the title of the blog post
Medicaid is actually which did intend to
use I don't know why use title it's
probably better to use the actual ID of
the document here so now we can just
apply the idea of that document another
blow of my blog posts the the slug that
is used for that blog post we could
supply that in a query and then we could
grab a specific one from this view and
in this case the the value is just the
entire document so we can grab that and
do whatever we want with it to update a
document in CouchDB you just need to
supply it ID and it's a revision so we
could then modify in that document and
then send it back to the database to
update this blog post if we wanted to so
let's try the other example I gave now
chores comments and so this example is
going to be pretty similar this time
we'll just check for the document type
of comment and then what we will omit is
we will instead of emitting the ID of
that document if we use the post that
it's related to as the key we can then
grab all of the comments for a specific
post key so again I'll just omit the
entire document as the belly now which
will be the document for the comment as
if I run that now we've got a new view
here so it would be a second view that
we create and you can see that we've got
the two comments here with key of my
blog post so if I want to retrieve all
of the comments from my blog post will
have to do is query this view and supply
the ID at a key I'm looking for and so
then we'd be able to grab both of these
and then display it wherever we wanted
so if I'd actually added comments to
other blog posts you'd also see those
pop up here under the ID for that blog
post and I might actually do that just
as an example so we'll just jump back
into the documents view here and we'll
create a new document will give us an
author of these josh again add a comment
oh hello and a type of comment to
identify this document is a comment and
then just the posters related to I think
yet another was one of the other ones so
we'll save that and let's jump back in
here make sure yeah that seems correct
so that comment should now be associated
with that blog post so if we go back to
our temporary view again and we still
have that max function now actually so
I'll just run that and now you can see
that yet another pops up there as well
so this view is a list of all comments
and what blog posts their associated
with and we can do this about anything
we want with this map function it's a
really powerful way to query data these
are just some really simple examples but
there is a lot you can do with it and
then with the addition of a reduced
function as well you can also perform
some pretty complicated calculations but
in this case maybe we'd want to just
work out things like the number of posts
or comments or maybe the amount of times
the users logged in in the last week
things like that it would all be pretty
straightforward to write in with this
sort of format it's a bit of a I guess a
paradigm shift if you are used to
writing using like structured query
language writing queries in the form of
select all from something where
something joining tables that sort of
thing it is it is a little bit weird to
do things this way but actually quite
enjoy working with this style of if data
querying and manipulation so this is
just a really obviously simple
introduction to using couchdb it's not
intended as not intended to be sort of
an all-encompassing introduction I just
more or less wanted to jump into this
futon interface and play around a bit
and show you what the data looks like
what a MapReduce function looks like
although we didn't actually write reduce
function in this case but I did write a
pretty detailed tutorials
which covered a lot of theory but not
much practicality I guess so just want
them to show people what I'm talking
about a little bit okay so i hope you
enjoyed this video and I'll see you in
the next on</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>