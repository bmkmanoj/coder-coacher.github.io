<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>130 k HTTP Sessions With -Xmx512m and Glassfish | Coder Coacher - Coaching Coders</title><meta content="130 k HTTP Sessions With -Xmx512m and Glassfish - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Adam-Bien/">Adam Bien</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>130 k HTTP Sessions With -Xmx512m and Glassfish</b></h2><h5 class="post__date">2012-12-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/V_b5KKZbdCQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi my name is Adam bean and today I will
try to break glass fish worth starting a
couple of sessions and the interesting
part is to find out how my how many
sessions we can actually start with with
stock glassfish so i will like to create
a very breaking breaking server with
state so i would like to create a very
simple java 6 application and with JSF a
session scope beam and probably one
stateful session bean with a couple of
attributes so let's start with JSF page
will be index then I would like to
create a index backing bean and this
will be calm broken server presentation
and this time this is going to be
session sculpt just to create more
memory pressure on there on the
application server I would like to
create as much state as only possible
implement sorry Ally several this is
required because of CDI and then I would
like to create a in the business layer
hello boundary
stateful boundary just for fun and this
is stateful session mean and it contains
some attributes let's say no idea name
string no idea and another one hello so
i would like to populate the fields in
the post construct method and do
something like create unique values
otherwise it could be cached by the JVM
and as I said we'll try to create as
much waste as only possible no idea so
plus and this hello equals plus
system.currenttimemillis perfect and i
would like just to get the message
string message written this name plus
there's no idea and plus this of course
this doesn't make any sense this is just
a proof of concept to test the
application server so and i would like
to inject the state full session been
here stay at inject with stateful
boundary
getmessage return s P dot message so and
then we could integrate that in the JSF
page so index dot message and just
create a nice title so let's try to
deploy that run it should start the
application server and the database and
deploy the application open the browser
and yeah now the application server
starts and let's see what happens so
okay looks good so it caches the IDS
because we created a session so we don't
get a unique results because it caches
the sessions yeah it means if we start
the Firefox and another browser and just
retry that you will see there are
different values so now we have two
sessions just so I will just try to
verify that so i will ranch light fish
light view so this is the night fish now
we just a light fishes of stress testing
application so you can easily track the
sessions so I will start monitoring so
every two seconds it captures the value
from glass fish and then I could launch
my night view
I to your app so and now we we should
see okay we have already four sessions I
guess because ya light which is running
on the application server as well as the
application so threatened memory so we
see now the glass which consumes about
150 mix memory we have about 90 threats
and peak threats count was 100 so I'm
running stock glassfish it runs with 500
12-6 a mix ram and yeah it should be
sufficient for our test so what I would
like to do is I would like to create to
start to create a very small stress
tests with jmeter so as Jamie tattoos X
will just turn jmeter and use the Ori so
I will I create a stress test so let's
start with that threats thread group I
would like to start threat with 10 users
forever it means until glassfish breaks
then listener sorry sampler we need a
HTTP request and this is Frank is not
light fish it has to be our
localhost what was the name of the
application breaking localhost breaking
with state this is the Ori so go here
breaking with state our just use the
local host IP address port number is 80
80 and yeah this efficient is a get
request it's okay and then I would like
to use a listener and summary report is
just sufficient so I'm just interested
whether it actually runs and I would
like to see the errors here so let's
recheck that 10 concurrent users no
think time running forever an HTTP
request going to the page and summary
you see just because of to get a sense
of whether that test is actually running
so I just start the test no and ok 0
errors so it seems to work so we have
throughput about 7 710 sections per
second so I just go over to to light
fish and so let's see what you see we
have already 15,000 sessions and we can
correlate that so and we have 30,000
comets and let's see cute cute
connections and means the Blessed which
is actually busy we have almost no
errors there was one error because I i
I've wrote it on Bronk error but busy
threats counts about four threads are
busy right now and yeah hip size we have
about 350 megs of ram consumption and
how many sessions do we have we have
about 100,000 sessions already
yeah active sessions 99,000 100k keep in
mind we are running on stock that glass
with less fish with 512 megs of ram go
back to performance so we have about the
transactions are decreasing and yeah hip
size we are about 400 mix so the glass
fish will break soon and about 512 megs
of ram it will break and probably what
what happens right now glass which tries
to passivate the old sessions just don't
get the out of memory error keep in mind
that everything is running on on on my
machine so it means they'll all
generated the screencasting software as
well as a light fish so it is a it is
unusual high load so web we have about
125 know about 1 110 120 thousand
sessions right now and I think about
130,000 session the glass fish will
break without of memory errors keep in
mind that we we have right now one
session scope to manage beam with one
state full session bean with three
attributes so and this is what I do
actually in my projects to estimate the
the the the scalability of the server
and this is one of our first proof of
concepts to get a sense whether the it
is viable to go with stateful or
stateless architectures so I think with
about 130 k the glass which would break
so I'm just curious so let's wait for
that
okay with 131,000 sessions the GlassFish
wasn't able anymore to create new
sessions so it broke with with our
sample application and we got a
wonderful out of memory error so we
could say okay with our trivia
application we were able to handle 130 k
sessions with a thing sing a glassfish
and 512 megs of ram and usually you will
get a lot more than 1 512 megabyte of
ram in production so you couldn't handle
500k sessions Perry glassfish instance
the problem with this approach is you
cannot just scale infinitely with Ram
because and one point of time it will
get trouble with garbage collector but
with optimization of garbage collect
optimization so thank you for watching
and yeah before you are deciding
stateless versus stateful just create a
very simple proof of concept more
realistic than this one and just measure
the performance and talk about numbers
and yeah thank you very much and I
describe some of the approaches also
email in my book real world patterns and
see you at upcoming conferences
workshops or a TX upcoming workshop at
Munich Airport said thank you very much
thanks for watching
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>