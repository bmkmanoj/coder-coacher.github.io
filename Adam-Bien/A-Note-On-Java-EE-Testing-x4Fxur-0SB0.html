<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>A Note On Java EE Testing | Coder Coacher - Coaching Coders</title><meta content="A Note On Java EE Testing - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Adam-Bien/">Adam Bien</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>A Note On Java EE Testing</b></h2><h5 class="post__date">2015-08-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/x4Fxur-0SB0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">the last time I was in Warsaw was nice
time in Bullock and lowlich after the
Java user group show it was lots of
interests
according to Java you get lots of
questions there's really nice session so
sorry for that and now start with the
content and hopefully it's going to work
right now so I prepared some slides and
let's go with the slides so um no dub on
Java II testing so um why this title
because I get lots of questions
regarding Java and testing and I thought
it could be interesting just to cover
you know the the most frequent questions
or how it actually looks like and I
would just concentrate or focus on the
on the basics around the essential stuff
and not go too deep because in possibly
one hour so I'm a Java developer just
working since 1995 and they really like
Java this is about me what's new new I
have a block it's a pretty old not very
new a little bit newer our workshops on
Munich Airport which actually lots of
participants from from Poland and what I
also maintain is a case of a meta list
it's called a hex news announcing stuff
like for instance the this this
conference session an effective Java is
somehow new what it actually is is our
it's an online workshop so on the first
Monday of the month you can ask me a
question that try to answer them and
this is a lots of workshops in in
December if you like just participate
and this is the online workshop which is
available since one week and I got
already viewers from 25th for countries
but let's go back to the topic and the
topic is about unit testing so what is
what our unit tests and I get a question
a lot and and then the main question is
always you know how to test each ABCD
IgM as JPA or whatever and and I think
this is a widely misunderstood topic so
I'm what I think if someone asked you
know how to unit s something what it
actually means is how to
a unit for for unit testing and I would
say we would we should start with the
definition first and in computer
programming unit testing so we have
according to Wikipedia is a software
testing method by which individual units
of source code and if you if you read
uses procedures operating procedures and
if we read a little bit further you
would see but it's more commonly an
individual function or procedure so what
it actually means usually what you are
testing in unit tests is the smallest
possible piece of business logic so and
what it actually would mean is that is
absolutely wrong to start an application
server in order to test on a small piece
of business logic and what you should do
instead is just you know write unit
tests and instantiate the POJO and the
the regardless whether it is an eg b c d
i GMS or whatever you can just still use
new or mock it out and it should it
should actually work so what i see
instead a lot people are using tools
like our Kilian and and in boots a whole
operating system with the application
server just to test some some
computation so and i would like to show
what i'm actually doing this is mine my
way of testing and i would just like to
create a small project it's a very small
one and it is a hex it's this one one
three looks nice and what's the name
let's say fat tax or fat is okay
and just finish it and what it should
create is a small maven project and this
maven project is going to contain of
course a pom which is the very thin so
what we will need is of course a unit
test so we will have to add the journey
test the dependency and probably Makita
which is actually polish invention but
before we do this I would like just to
write some code so what we got already
is
jax-ur s setup so this class was created
with the setup and I would like just to
expose this over rest although most of
the Java applications have come with
REST API and let's say it's called Texas
resources resource and because the class
name is Texas I would like to use the
path Texas and let's stay simply string
and let's say tanks or German tags catch
and we have here 19 percent
so hopefully drugs 90 percent so and I
would like to test it so how to do this
of course I could run it so I'm running
this and I would like use the payara
daily it's just a payara is like
grassfish a speech class fish actuary
which is usable in production and yeah
now the payara starts everything is
built you see the whole survey started
so nothing prepared here and what we
should use is resources and I think it
was taxes and as you can see 90 percent
so great but we actually lose a lot of
time so I have to go to the browser and
get this simple to test but post and put
and delete is are impossible in browsers
I will have to in to do to install
plugins or go to command line which is
also fine so I can go here and say curl
and I get it back
to do it over and over again so what I
would like to do is to save time and
what I always do in such cases I start
another project and I would like to
create just a java application and I
just call this project fat fat SD stands
for system test and what it actually is
is a dedicated module which is just
intended to test this this war and what
it usually contains is are the ERC
dependencies so I use the jerseys the
reference implementation for jax-rs and
what I did right now is I created
dependencies with a template and what I
can do actually I can create right now
already a test I would just look up what
was the name Texas resources so I would
I would name this to think the test here
I will call it new Java class Texas
resource IT and the package is I think a
hex Tech Society so I created this and
what I would do
always is completely drunk it should be
a test new JUnit tests just Texas IT and
package come yeah hex finish Texas
resource so init client so in the in the
method before in actually this project
will only comprise tests unit tests so I
can delete this actually doesn't matter
and there are no classes there are just
unit tests so there are of course
classes but there are in JUnit s classes
and I call it before and what I can do
client build new client and it returns a
client so I remember the client and the
client
to remember so forgot that remembering
and the client has a target and the
target was the link it was a link with a
second this one so and also remember the
target this target so we have both and
then I can say Texas just a unit test
test and then I could say this target
dot request get and I get a response and
the test would be assert that
response is sorry response get status is
properly 200 if not you will see in a
second and import this one and assert
that has to be imported as well perfect
let's test this so it's green seems to
work and I think we spent for this let's
say where's the about two minutes but
from now on we are saving time because
over and over again I'm executing this
and what I also do I ultimate the whole
process so I would write a small script
which executes which do which builds
this project deploys this to an
application server then builds this
projects and deploys that on the
application server launch the tests so
funny enough in the perform lots of code
reviews but none of the code visas are
system tests and if they are they are
embedded in maven so and and then they
of course need embedded application
server which of course doesn't reflect
the real application servants a lots of
mess and huge pumps and it makes
actually Java development unusable so
this is what we are doing in all
commercial projects and it just works
perfectly so what we did we create a
project with deploy two projects and we
are live testing we created a system
tests two tests to with jax-rs to test
the actual application server so let's
see whether you have some questions I
think you are now disconnected so seems
like no questions here I think and we
just restart this guy no question in
Twitter and properly lots of complaints
in textual
so
no questions so um this was for system
testings of course for for today of
course we could create post and delete
and whatever and but what because this
is a lot of boilerplate what I did
instead I created something called a
rule and I would like to include the
rule and this comes in their rules
library and I pushed it the new version
was pushed today to the repo let's see
what - the maven central let's see
whether it is available actually and
this is one one class library so what I
think is okay and you need adjust the
test dependency so let's see whether it
is actually in maven central ready
should be looks good so I'm instead of
doing this or you can do then you can
say public it has to be public strangely
jax-rs client provider provider equals
jax-rs provider built with Ori
and this is the Ori
and then we just use standard AJ unit
annotations called rule and we can omit
the whole setup and then I can say
provider provider target request get so
and it should work equally well so I
still green and instead of using this we
can now say response is successful
successful okay and what it actually
does it uses a custom matcher and it
checks whether the response is 201 to
200 or 204 so it is a because of right
it's a lot I just created the one class
library you can use it or not so it is
on github is I think Apache License and
I that is in Insogna type available in
Sona type as well so this is the rules
library this is this one and it comes
with entity manager support and Chuck's
res so what who'll actually is rule is
like more like dynamic proxy or aspect a
rule is executed before every test and
after every test this is why I can rely
on the instance here so any questions
how often do you execute a system test
and the first question is how often very
often so I usually whenever whenever
something changes I execute the system
tests I would say as often as as unit
tests but what I do what I do
I don't execute everything I say here
run focus test method so it's not like
we run everything everything is rerun on
the in the continuous integration if I
push it to continuous integration so
everything is it's rerun but in in my
case as developer I just run for
instance this method if I'm right now
implementing the get ok great question
do all developers have a test server
where they run the test before they
commit any code of course all the
developers have an application server
like here usually it's well integrated
with the IDE and you run it over and
over again
is there a shelter server after they are
testing after first committing the code
yes always and the the central or shared
test server is part of the continuous
integration and the test server is
created from from from configuration
fully automatically so by a script and
and the tests are executed against the
DES server and very importantly the same
script also creates the production
server so it's fully automated and in
all my recent Java EE projects run like
this is there something to transform the
XML JSON response in the test to my
object instance of course another great
question it works out of the box so
Jack's Bay Jack's be always worked and
adjacent works as well and if you it is
already prepared because if you looked
at
the dependencies i already included
jersey media jason processing assuming
that I will use the features of what it
does actually it and this one and this
Java X Jason both dependencies I only
needed as a lot needed now in the
session but needed in my projects
because what I do a lot I'm omitting
Jason M and receiving Jason so or to
show you this what you could do you can
for instance instead of doing this you
can say I would like to emit a JSON
object and then say Jason create object
builder and tax 19% built so um now
Jason is emitted and let's rerun the
test test still green but what it could
do instead we can now say response dot
wheat entity Jason object dot class and
this should be the tanks and then let's
show you this
and of course assert that or a said not
null of course not not text so try this
and the output and you should see here
adjacent output and Jax P verts equally
well but the only thing you have to have
of course the classes so either I will
have to have a reference to the word
project or copy D classes here so I hope
you saw it live so seeing is believing
no questions left perfect so let's go to
unit tests and for unit tests we will
need a bit of business logic so let's
say we have a class called tax
calculator calculator and the tax
calculator is the boundary so it has to
come with the state as a notation what
is this an EJB and it starts for us the
transactions cares about monitoring and
security so it's just simpler to use
distance Ã«dÃ­ with with own stereotypes
and whatever and what we would like to
have is the let's say or doesn't matter
int compute X and the input would be D D
D price let's say and let's say here
what we also will have to have is of
course something like country rate
provider so and this would be a control
this can be just a plain POJO and it
will work for injection because I
already have been six ml here with all
so I can inject pojos so the counter
rate provider which is a POJO it will
return us a rate for Germany for for a
counter e and here is the country or
it's just code and say F code equals
Germany I do it the other way around on
purpose return 19 else
forty-two return 42 so the tax
calculator and now I can inject the
country rate provider CRP and yes say
here CR P dot country and let's say we
testing for Germany and this returns the
rate rate and let's say the computation
is something like this just to keep it
simple and wrong but it actually does
not matter and I would like to do to
test the text calculator okay so now the
question how to do it and what is
already in project something that people
will attempt you know to to use embedded
application service to make the
injection work so what I would do
instead
first press alt ctrl + T so we get a
unit test and what you like to test is
just the class so what it actually means
is what I would like to do is in the
init method and I would like to have the
text calculator which is the class on
the test
and the class under test and of course
what we have to do we have to inject for
ourselves the country rate provider
let's leave it for me for a second that
way and then I would like to implement
here a method called calculate tax so
from my point of view the counter rate
provider should matter for the test so
what you would like to have we will have
to just to do to test this and this
should not matter because we are not
testing you know Germany or or some
or Poland or whatever what we were just
testing with testing this calculation so
um let's try here so we could say this
can't dot compute ax for two and now the
question now what is the assumption is
the assumption that we have German or
polish tags or whatever let's say assert
that computed tags computed tags is
let's say 84
so it even passed this was accident
but what if for instance the test let's
say the counter rate provider wouldn't
be even available because it uses a
back-end system as AP or it fetches the
data from a database so what I think
what is a better idea
using a great library called mojito
so let's include mojito here mockito
work mojito mojitos this I think is the
too much mojitos Ark it was Ark yes
mojito and the library was artifact ID
was Makita all and the scope is test
again dependency group artifact and more
importantly depression and now it's
diversion so what we can do now we can
say I would like to create a fake or a
mocked country right provider and I
could use the static import looks nicer
so now it will fail of course and
because this compute text doesn't return
anything so or what what I can do I can
say this cut R P dot CR P country and
let's say I would like I am NOT
interesting in the input so I can say
any any object and say when someone
invokes this
then then return and let's say - and
then we can rely on the tool and then
the computation should go for four run
focus test methods green so this was a
case of mocking I made a cast case but
very realistic because what we have is
we have the facet or boundary we have
injected counter rate provider and the
country it provider has the computation
and we are not interesting in testing of
this code of course it would be a unit
test for this button does not matter for
now and we are more interested in this
computation and this is very easy with
mocking and we still don't have you know
DDD the need to learn to launch
application server full-fledged
applications have adjust to compute you
know to test the stupid calculation so
um this is why I write unit tests always
look like this and I never use any
embedded service for unit tests because
they are too slow so you can execute
that thousands you see how quick they
are there were about 200 milliseconds
hundreds or thousands of such a tests in
in seconds or minutes and if you would
do the same with application service it
will take significantly longer so let's
see whether we have any tests any any
questions no questions no questions at
which are no questions here so um this
is actually very good so let's move on
so I'm at least in Germany Qi
departments are excited about code
coverage so what I see a lot you know
80% code coverage in my eyes actually it
does not matter so I would just cover so
what I have here is a plugin it should
be a thing in the build and this is the
old friend Joe cocoa plugin and this
should be in the plug-in sections
so we have built plugins and plugin and
the build should be outside the
dependencies of course and what the Jack
Okoye stands for Java code coverage and
this plugin measures the unit s
execution so if I what I can do right
now so we just clean it build it they'll
plug-in dependencies come first and I
have two builds so build and just move
this to here and kill that so it looks
better so we have the first dependency
section then build section and I just
had to build so let's see what it works
I will just re execute it and and just
build everything from scratch but what
the NetBeans did it recognized this and
offers me a code coverage view and I
will just read run this right now and
what I will see is the code coverage is
okay so the tax calculator taxes
resource is not tested of at all of
course it's numb we didn't execute the
system tests the tax calculator is fully
tested and the count rate provider is
not tested in the jax-rs configuration
cannot be tested so we have a test
coverage around 30% so I'm I hope it was
it would be more but still 30% is okay
it reflects actually this what a test
coverage of my projects and why in a
second and what what is actually covered
it means what was executed during the
test and which is not measured are the
asserts so in my eyes the assert
are far more important than the actual
coverage will it cover it just says is
what was executed during the test so I'm
I'm only using the code coverage as a
hack to identify that code but the
numbers do not say anything whether we
have code coverage 30 40 50 or 100
percent it does not matter because what
really matters is no the assert coverage
what was actually asserted this is this
is actually the the quality of the tests
not what was executed in during the
tests but still the coverage plugin is
very useful if you would like to see
what was actually executed during the
tests and then you can ask yourself a
question why the other parts were not
executed particularly in the system
tests and usually it's forgotten code so
this was also um interesting still no
questions no questions in Twitter then
go further so we have now covered pretty
well the unit tests and we were able to
to mock and inject instances of unit
tests yeah and what we didn't cover at
all were integration tests and what
integration test would be this we could
for instance test the bean validation of
the invalidate or or entity manager from
JPA whatever you would you like without
starting the application server so it is
you still do not have to start the
application server the only tests were
you need the application server is
system tests all other tests actually
you can execute the test without having
an application server what you only have
to have is the service provider
interface or the library like eclipse
Ling hibernate for for persistence tests
or a hibernate validator for for for for
for validator bean validation tests so
having that said I said it's probably so
already I'm using a lot of these assert
that and assert that is pretty
interesting because it comes of lots of
matches so as you can see we have core
matures and the core emerge just one is
is
but there are lots of interesting
matches and I just also interesting to
see it work I'm crest core matches if
you look at the dependency I just
included a unit for 12 and what it
actually means that the JUnit for 12
let's see the effect of dependency
already comes a unit formed for 12
already comes with heme crest core 1 3
so there is no need to include
explicitly heme crest it is a part of
the J unit distribution so we don't have
to UM to edit it is already part of the
of the J unit package
what heme crest is a set of very
interesting asserts so I'm to show you a
view so let's write a test let's write
just to save time
for instance string asserts what you can
do you can say string country Poland and
then could say assert that
country contains string P oh so just
right run focus method so green then we
could say assert that country I think
was both contains string
P oh and contains string land now we
just shortened this so I was interesting
so and in all the asserts come without
any additional dependency just part of
Jared so and what you can also do of
course I could also interesting if you
have a lists there is a there's a nice
has items has item series has items for
instance collection so you can search in
collections and search in lists in
iterables so everything comes out of the
box with a unit for twelve and prior to
for twelve you had to include hamcrest
and choose the mattress so sadly in most
projects what what developers are doing
because I guess they are forced by the
you know code coverage 100% rule and
there's no time for such anymore they do
something like assert not null so this
is I think the most use assert of all
times just to say uh sentinels not null
and
country and of course with this trick
you can achieve very high code coverage
but but without any additional benefit
except the numbers so still greedy so
any questions I prefer fast asserts were
through and style yeah what you could do
it is like BDD you can use a BDD style
for with mojito interestingly I prefer
this style so even it goes that far then
for angular I use the how it's called
I think chai library which uses similar
asserts to this one so in India in the
JavaScript world what developers usually
prepare prefer is the gherkin styles or
one then but I prefer this this is just
to know it's a fashion so I would say do
whatever you like but but write tests
for a complex code so and we have
actually not much time but what I
usually do we set up tool like sonar to
measure the code complexity and what we
do then is we measure only the code
which is complex and not a nut code
which is which is simple and there's one
rule called cyclomatic complexity where
we can take it as as a indicator whether
a test is needed or not I would say it
lists an if-else statement should be
available in a method to write a test
for it so this is what I what I set up a
few minutes ago is like my project are
not you know very well tested because or
do not have a very high code coverage
because we only write tests for a
complex code and when the code is simple
get a set us or whatever we don't write
any tests okay
embed it let's say I think we have
enough time for integration tests with
GPA so we can cover the whole package
the most important things and arquillian
to admit we use just arquillian for
specific things like testing of
sophisticated dependency injection which
usually does not take place in in
enterprise project so I would have all
my projects this year we created this
year are not tested with arquillian
because there are even not qualifiers is
a very straightforward business logic
with with straight dependency injection
so there is no need to launch the
application server to test to test
injection
okay so integration tests put to explain
you or show you integration tests what I
will have to do is to create an entity
and the entity is going to be let's say
tax calculation audit or something tax
calculation audit and this tax
calculation audit it's an entity and we
need a persistence unit and this
persistence unit I call it prod just use
the built-in data source of Pi era and
drop and create create so this was
actually interesting interesting error
we didn't have the time to post it to
NetBeans but it created e
the data source as expected so this is
the production data source and I wanted
to show you the test so we have the text
calculation audit here and it takes
calculation audit needs let's say what
we need is an ID this is ID generated
value
private long result or double does not
matter actually what it is and this
should be enough and probably a
constructor would be nice and default
constructor is required and now what
happens always to me is you know we have
some collisions in database the entity
is already available or my queries use
reserved words so I lose lots of time if
I would deploy the entity start over
right away to the database and you know
clicking the applications to see what
that works I think it is a lot easier
and faster to create an integration test
I will do it from scratch right now so
I'm integration test it means it ends
with IT so I will create the integration
test and you already learned about the
entity manager and sorry not the entity
manager the rule trailers rule so what I
would like to do right now is to use the
entity or first no magic so let's start
easy I hope we have still time in it be
for persistence create entity manager
Factory and I call it always IT for
integration tests and what I get back is
the inter entity manager Factory and the
EMF creates the entity manager and I
would like to remember the entity
manager and probably also interesting
would be get transaction and what I get
back is the transaction so both and then
I can say here for a crud and then
entity manager merch knew what was it
tax calculation out it
and the result is of course 42 and we
will have to start the transaction first
tics begin and then takes comet so and
what I actually testing here there's no
asserts but what is actually tested is
whether the named queries and the
mapping are syntactically correct and if
I would have complex named queries I
would write for each act query a method
to test the queries in isolated way to
save time this is actually the deal to
save time so I brought everything from
scratch right now for the but usually I
wouldn't do this from scratch I will I
would I have already the rule for this
but I wanted to show you how would like
without how it would see if if I would
write it without any additional prepared
class so we are in the so what I will
have to do is to create a persistent 6ml
just for the purpose of integration
tests and I think source tests resources
this should be the folder resources beta
and so source test resources media F and
because it is nested we need this so it
is other sources and let's build us and
of course what we need is also touch
source tests resources meter and
persistence XML so and what we need here
is per omen this is a pack I already
reported to NetBeans because it cannot
parse the XML to XML but
okay let's do this other way around
per preferences I will show you the
template what I need and the template is
something with peepers it's a think per
no template no template no problem
then I hack
new project and the project is java
application and call it as persistence
hack and the persistence heck what I
just need a other's persistence and it
causes from database and the database
there's one I just can see data base and
let's use the account so and why I did
it because it created for me or it
creates the persistence XML which I need
and this is a little bit different it
uses the resource local are just too
lazy to write it from scratch and uses
the resource local it lists the
persistence provider and all the classes
has to be listed as well and the users
are not necessary so it should looks
like this and I would just put copy this
and then say and put it here
so done how that has sources persistence
XML so does this year so we have JDBC
URL is JDBC Derby localhost 1527 sample
but we could do this so it will just
create a file and I think is create
blind true treant and this should be fed
to be so and the common hacks the class
is going to be tax calculation audit tax
calculation so this is actually reusable
persistence XML this is why I created
the template which can be expanded but
because it's beta or daily builds it's
just throws the exception in the regular
NetBeans 8-0 something you inter there's
not that back to back this in the in the
in the data bills so we have comma X
text calculation out it so it is already
in the right place
but if you run the test it will fail so
I will try to show you this so we just
build this build tax calculation hold it
and if Y would run the test it will fail
and there are multiple reasons for the
photo failure so no persistence provider
for no persistence prior for entity
manager named IT and the reason for this
is there is no eclipse link so what I
will have to do is I will have to
include the eclipse link so to it a clip
Eclipse link and there is orc
eclipse persistence and there is JPA
let's use this and we just need to test
dependency so we have the Eclipse
dependency so if I would try to run it
it starts attempt to start the the
eclipse link but the problem is there is
no client driver so what I will also
have to do is I will have to add the
derby dependency that the driver because
there be or Apache Derby let's use this
also scope and let's try this Derby I
think was client Derby client
so and what is that no suitable driver
found for Derby 30 B so the original
right Derby Fanta P create true I will
have to do it up so I would just
question to the organizer how much time
do we have left the question nope so we
are three minutes over the time but what
we can do I'll show you something so if
you go here and search for a X there is
a busy archetype and if you open this
archetype so again their search for BC
archetype and and I call it sample and
what this thing does it creates a simple
projects with sample in sample as t fu
goes to sample it comes with already
pre-configured persistence XML so it is
this what we this other test sources and
this one this is actually the Ori of the
of the source and you see the error I
use the wrong driver just completely
forgot about this
so this is not client drive the rather
than embedded driver and then it should
actually work so do it again
test and now the it uses eclipse link
and still not found an eclipse link
searches for the configured for the
configure driver and done and then it
should create the database online and
now it worked but we get another error
and this was the configuration so it the
table was not found so what we will have
to do is to configure the table and this
works with drop and create true so
there's a standardized property schema
generation and there is drop and create
drop and create drop or update there are
different different values and now it
should create a table with the database
and the database resides in here in our
our folder another option would be to
use in in-memory database like
hypersonic or the Derby database and
what it would mean is it will just
create the database in memory and
without the file here do a little bit
faster what's the benefit of using this
you could actually pre create some data
here but again what what I did actually
I created and configured from scratch
entity testing which is not another big
deal and how it looks like you will have
to create the entity manager factor with
IT the entity manager and the
transaction so this is the boilerplate
it happens over and over again and the
persistence XML comprises the embedded
driver this was my mistake I used a
client driver and it points to a folder
worthy database recites and they did the
base is created on demand and on each
deployments the whole database is
dropped and recreated you could of
course use Oracle whatever you like but
this you should be a little bit more
careful
with Oracle or such databases yeah
production databases because you could
drop accidentally production production
data so this was the the setup and
because it happens over over again so
what I also did I created a rule for for
the entity manager and let's see where
it actually is so we had here now we
haven't so uh let's do this I add the
dependency and rules and let's use this
one and I think t02 is the most recent
so we have two year old version and
scope is test so and what the rules does
it simplifies the setup so with the rule
we don't need this anymore
we are you we can use public method and
say rule entity manager provider
provider equals entity manager provider
and the persistence unit name is IT so
and now we can say this provider easy
would be to do this provide a
transaction get it transaction that's it
and then say here provider dot M and
merge so it's just exactly the same code
so this entity manager provider is just
one class so if Y we go here you see it
does exactly the same what we did
actually in our code so this is the
whole code it just simplifies the t
boilerplate and then I can run T tests
over over and over again
so um so now it's green so what is the
point again of having integration tests
for each entity and the reason for this
is the following our we have one
integration test which ends with IT of
the integration test it takes a little
bit longer because the database is
created the device have to be be created
but what we work but what we are testing
actually the mapping we are mapping
whether the the entity is mapable to the
entity to the database and actually
there is no reason to use the database
for this sorry the application server
why we should you know boot the
application server just to find out that
the mapping to database doesn't work so
we save a little bit of time and what I
didn't explain you why I use the IIT
ending and test ending and the reason is
convention over configuration if we have
maven I can use maven clean and install
if I you do this
only the unit tests are executed not
integration tests but maven failed safe
integration test execute just the
integration tests and now would expect
here as you can see now it launches the
integration tests which are
significantly slower order of magnitude
slower than the unit test as you can see
the whole database test was executed in
one second but the unit tests were
executed in two hundred milliseconds so
is significantly slower and on my in my
integration environment we would get you
would get two stages or two drops one
would be unit test job and the other one
would be integration test job and the
integration tests are running after the
unit tests because they are slower and
are executed less frequently so I hope
we covered this so any questions here
how to use the data created in one test
method another test method in the same
class I never had this problem the
problem I have over and over again is
between test classes not in the same
test class rather between test classes
but I think the answer is the same and
what I
and and I would say I have truly to say
I actually don't care anymore about bet
or good practices it you know it should
my thinking is if it works well for you
and the code is simple it is a bit best
practice regardless what the Guru's at
conferences or in the indie indie indie
magazines are saying so um what I would
do then let's say we create we are
saving the entity here but it is not as
easy we will have to create a graph of
entities here so what I would do I will
create a public setting method and
expose the method to other tests so I'm
I'm actually sharing logic between tests
I've no idea what it is better or best
or bad practice but it works
surprisingly well in my projects and no
one complains so far so um I hope I
answered this question just use static
static methods for this our database
tables recreated for each tests method
in your example yes they are so the the
the for each for each tests so all
database is recreated so if your it is
in memory database is no issue with with
the five database it could be a
performance issue but usually it is not
so why because I have one such a test
per entity and also one test per complex
query of one entity and there are
integration tests or even if they are X
you a little bit slower it's not an
issue because they are clearly separated
from the unit test by the ending so any
questions left so I got three last
questions so I'm in the example where I
show you I it also comes with an
arquillian example so I would like to
just to show you the killer features of
arquillian or embedded test and to
illustrate you this I will have to find
it so and I think this is the test the
logger exposure and what is actually
tested
so I have here's a very simple class so
it what it does it configures logger and
makes log injectable so this is their
code and the question is how to test the
code because if you would run regular
unit tests it would the regular unit
tests I will have to mock out the
injection point which is actually a
interface so it is harder to mock and
what you will actually have some you
will have something where you can inject
the logger and see whether the log has
actually properly configured so it means
it contains the name of the class this
would be the test here and what I did
here I use arquillian for the purpose so
and now an interesting part on point I'm
creating an archive a war which contains
the log exposure the injection support
and this is interesting so what
arquillian is able to do and this is the
absolute killer feature of Arcadian it
is able to deploy classes from from from
source test Java from the test folder
so the log injection support resides in
test packages Soulstice Java and I
created the class for the only purpose
is to verify the testing so this class
gets never deployed to the real
application server it is never in the
source main Java it will always remain
in the in the in the in D test folder
and never shipped with the real world
project so what I'm testing here I'm
injecting the logo and exposing the
logger and what in my integration tests
the log injection support is in is
injected here and in the method logger
properly configured I'm getting the log
in here and I see whether it is properly
configured and I would argue the log
injection support are sorry the logger
exposure so the actual class can be only
suitable tested with embedded containers
or with achillion with unit test
integration tests there is no way you
know to to to test it sanely with any
other way
having that set this is absolute
exception from the rule you know using
producers and qualifiers from from my
enterprise or commercial projects and in
Lygia we are do a lot of crazy stuff but
in my commercial projects are rather
simple and I would say I would prefer to
simplify the code because I I need you
know fancy techniques for for testing so
if you like again it is the BCE
archetype it comes with all the examples
for more more fancy testing the purpose
of this this session is only was to to
show you some ideas how to test Java
applications and it works exceptionally
well in my projects so I'm what we
covered today was unit testing
integration testing and system testing
what we didn't cover was torture testing
which is lots of fun but we had no time
it is like oh is jmeter just in node 2
to hammer on the rest interfaces and try
to break the server and then I monitor
the server at the same time using Java
Mission Control
AJ visual VM and see what happens it's
actually interesting topic for another
session so it would be it's really fun
and for unknown reasons torture torture
testing system testing are always or
most electing in my projects integration
tests and system and unit tests are
available but not separated what leads
to strange problems like you know the
night is too short to rerun all tests
which is crazy
so what I well I think a best practice
or best practice absolute best practice
would be to separate the unit tests from
the integral integration test very
strictly to save to save time and to
have shorter life eternal out cycles and
be more productive
ok this was the last light and I wanted
to say thank you and if you like see it
see me at the first Monday of the month
so if you have questions just ask the
questions so I'm maintaining a gist on
on github and this is where the
attendees ask the questions prior the
show so already lots of questions about
ten questions already this is the
September 14th is the next show if you
like ask the questions here or ask life
so via chat it works exactly the same
what we did here where the chat
and and thank you for the questions</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>