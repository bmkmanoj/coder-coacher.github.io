<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Load Balancing Java EE Microservices | Coder Coacher - Coaching Coders</title><meta content="Load Balancing Java EE Microservices - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Adam-Bien/">Adam Bien</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Load Balancing Java EE Microservices</b></h2><h5 class="post__date">2016-09-26</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/3Lw9YO5oU0U" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello my name is Adam beam and to do
like to show you how to load balanced
Java e microservices and in order to
load balancer micro-service we will
first have to create one and I would
like to use a minimalistic maven project
with a view lines of pom-pom examine and
I would like to call the project Duke
and it will be just a single resource
should be enough for demonstration
purposes Oh docker file is also nice but
I would like to have a single resource
and the resource is called Duke resource
and is going to be exposed as Duke and
as single method get get return aj Duke
with some time stamp to make the output
dynamic and what we have here we have a
docker file in the root which is nice
because then we can say I would like to
inherit from Eric's payara server so if
you prefer to use white if I put white
for itami here and we don't need any
command what we need is to copy the file
and the file is hopefully in the folder
target duplet war you can rely on it
because of Java conventions or maven
conventions and the deployment theorem
is the parameter okay looks nice so
let's try to build this so I would like
to change Duke and say maven install and
after this dock build - t air hacks Duke
dot and this will perform a fresh build
and create a document so now is done and
we can start the Duke and before we do
this
I would like to create a dacha Network
and dock network create and let's call
it h a year or just H a dacha Network
create or better
Alby so we have an afresh Network dock
network yes and we have the load
balanced Network so what we need right
now we need a load balancer itself and
what happened was I created the turret
the image is already available in
Docklands and it's called H a proxy so
if you go to Docklands and we look for H
a proxy there is a redeeming image
called age a proxy here and this is a
simplistic image it just installed as a
proxy so but more interesting to me
there's another image called
H a proxy pink and if we look at that
here
what it does it inherits from a hex H a
proxy and adds a configuration file so
let's copy this this could be nice you
could use it here and paste it here
paste so H a proxy and I would like to
rename it to H a proxy Dook Dook
okay so now looks good so we have from a
hex this looks nice to build I would
like to not name it H a proxy pink
rather than H a proxy Duke is the only
change and the configuration is
interesting so what you can see here
that the server pink uses pink one 8080
check and pink too so there is not a
pink service rather than Duke service so
what I would like to do is to change to
a Duke one
Duke - and they are going to be
container names and here I would use
also Duke one and Duke two so and both
are exposing the port 8080 are not
exposing this is the internal exposed
8080 port so what we have to do now is
to launch the two containers one with
the name Duke 1 and another one with the
name Duke - and of course built the
image so let's build the image first
eh a proxy Duke and just use the nice
one script so it's built and now what we
can do we can run - net - - net in load
balancer and I would like to run in
detach mode and without port mappings
and the name is going to be Duke 1 from
Eric's Duke so the first image is
started and the second image is started
and then I can run in the same net in
the judge mode named AJ proxy and now
I'd like to expose the internal port 80
80 80 80 and let's take a brief look
this taught spot is 8 8 9 8 9 so just
use the same 8 9 8 9 8 9 8 9 and the
image name was a thing AJ proxy Duke so
it looks good just start this so what
should happen right now if we go here to
curl HTTP localhost and we use the load
balancer pot
and say Duke we get a response the
document has moved which is a good sign
because it's redirected and what we get
here is a not fund because we also need
resources to occur so the load balancing
part already
drugs and now we get H a Duke and we get
another H a Duke but this should be
different service so let's see whether
it actually works so what I would like
to do is to open the browser and go to
localhost eight nine eight nine and I
think stunts so and what we can see here
we see the stats of both service so this
starts there is one request for Duke one
and one request of Duke too so and if I
will invoke it a couple of times you
will see there are Duke one do two and
there were a total requests there there
are evenly not not sessions requests and
what's interesting now what happens if I
kill a service so Dhaka kill Duke one
and as you can see Duke one is yellow so
it's no more available but this works
flawlessly and this is now red means is
disabled and I would just remove the
Duke one the Duke one and they run
the Duke won again and then is yellow
and green everything back to normal
so even get dynamic behavior so what we
could do with that we could introduce a
new versions in running system even if
you if you like and this works as
desired and if we go here to dock locks
locks Duke won you see the output from
the payara first one and this is the
second one so load-balancing of java ii
microservices works pretty well you
don't need any additional software or
manager's mode software just plain
docker and HR proxies enough and thank
you for watching if you're interesting
in java micro services check out the
java micro services course online and
munich and soon upcoming conferences
workshops projects or whatever java
related so thank you for watching and
bye</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>