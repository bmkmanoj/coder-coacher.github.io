<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>What Is Faster EJBs or CDI? | Coder Coacher - Coaching Coders</title><meta content="What Is Faster EJBs or CDI? - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Adam-Bien/">Adam Bien</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>What Is Faster EJBs or CDI?</b></h2><h5 class="post__date">2015-12-06</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/6Gm0u9gX56w" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello my name is Alan bean and today I
would like to compare the performance of
CDI versus ejbs implemented a small app
and measured the performance using a
benchmark jmh and this is actually an
outtake from the Java EE Testing online
course so let's see what happens
jmh is also well suited to benchmark
java applications I would like to
demonstrate you dis and one of the also
very frequent asked questions is not the
run time difference between CDI and EJB
so I would like to start with complete
new project and the project is going I
would call the project CDI and ejbs it's
going to be a maven project again and
this just just it would implement the
business logic first without the
benchmark and then the benchmark and we
have jax-rs configuration which is nice
and i would like to create a folder
called CDI and just put a CDI resource
into this folder i would write it
uppercase and the CDI is going to be
request scoped and the path is going to
be CDI so what I would like to do is to
implement parallel stacks of CDI and eg
B's and see how they perform whether
there is any runtime difference so
request cope CDI and I will just expose
a message with a cat and now what I
would do I would like to implement a CDI
boundary which would be request code
again so I will annotate all the classes
message and a CDI control
and the CDI control would be also
request coped and I would call it yeah
CDI control with a method string message
and this would return a and actually
let's implement to is even more
realistic CDI a control and then CDI be
control so if CDI a sed IP and the
boundary would like to have both so we
have we inject the CDI a control and we
inject see the IP control and this is
going to be a control this is going to
be P control
and in this new method method we will
just concatenate the messages control
message class P control dot message so
looks nice and of course the CDI
resource needs the boundary so somehow
realistic Java component with one
resource boundary and two controls CDI
boundary boundary and here we just
returned the message okay looks nice so
I would just to copy this and paste it
and I would rename that to a GB so I
would like just to rename all the
classes so starting with CDI resource
this is going to be each a B there would
be no request scoped instead of
stateless so that's the first DGP and
the name is going to be EJB resource and
of course this one the name would be EJB
boundary so we have e gb and the EJB
boundary would be stateless
but the CDIA control would be just
approaches I unusual to have eg Beezus
pojos so I would just make it CDA a
control it's going to be a JB control
all we could even make it an eg be this
wouldn't be realistic but let's keep it
this way to make it comparable and this
is going eh okay
does it UB control we have CDI be
control and this is going to be a jbp
control so a JP and this is also going
to be stateless
so now just for debug purposes I would
like to prepend here C for CDI and e4e
JB's so and now let it run so let's
compile clean and build looks good I
would like to run it
and it's a cold start so the service
starting right now
so let's double check this resources CDI
or CA looks good
and EJB EJB so now we have comparable
stacks and now implement a test so how
to do this I would like to implement the
to implement a project with a plain Java
project so the same story as before and
in and the name would be CDI and EJB
benchmark and again what I will need is
following now I would like to access
actuality the server so I would need the
jax-rs dependencies and jmh dependencies
so both are needed and now let's record
a test and the test is going to be a hex
benchmark benchmark and the test is
going to be CDI and ej peas ok so what
we said we need a benchmark mode
and I would like to use throughput again
this is actually more interesting and
what we also will need is the context
class and this is benchmark context and
what is the context this time so what we
need is web target and this is target on
a test and what we also need is in it
client which is set up with the default
is trial so double check that default
trial so he just one set up for the
whole benchmark and what we can do here
or I will need a client first client
build a new client new client
and the client is going to be executed
and this is worth our browsers I will
just borrow the early here from the
browser and put it here and instead of
ders I would like to introduce a
placeholder and I would like to call it
component so it is going to be a
template so what we can do right now we
can create a param and say this is a
param and the values of the parameter
are CDI and EJB so looks interesting so
we can do right now we just create the
benchmark class and this I will call it
execute request I will have to annotate
this with benchmark and now we can say
this now we have to inject the benchmark
context first
and you say context dot resolve template
and it's going to be component on and
the value is provided by the framework
so this is actually very similar to
parameterize test so it will provide
automatically test for Syria and Egypt
is so and this is going to be a
component so it looks nice like to save
it we have your resolve template and
what we get back is the path and I would
like to initiate a request and I would
like to realize that this rule has it in
a string so and if this won't work I get
an error request get this is actually
what I wanted to express so one thing is
lacking is our built extension with
shait jmh site and this uses the plugin
I will just use the plug-in with plugins
so looks nice so we have the gem H again
this is the executable and now let us
see di and AGP build the project and see
what happens
do I do this is a saved
so it looks nice and now let's see
whether it works jar target jmh Delta
charm so it is not built yet
oh it was wrong project so I would just
run this again I was not in the
benchmark CDI yeah just double-check
this resources GB ok it works and now I
have to go back to the benchmark CDI
exactly see the igb benchmark may even
clean install see where that works so
should be in state classes so what I
forgot
it's important this has to be marked
with state and I have also to specify
what's the scope and the scope should be
benchmark we can actually share the
client across the benchmark this is our
path threat this is more realistic
because an application server will also
one client per transaction so let's do
this and so see what that builds so
looks already nice now just like to
create Java manage our target jmh
so and what I got is 404 not found let's
just double-check that what's the
problem and this is the problem so I see
other nice feedback with exceptions so
now it looks significantly better so it
will take a while because it needs the
warm-up phases and for for the different
operations so for CDI and each episode
it would take a few minutes as you can
see it and it's established time is
about 13 minutes so let's see what
happens what you can of course do in a
benchmark so you could specify here
there are lots of annotations for
instance you can specify the output time
units operation per invocation so you
can you can adjust the number of
iterations I needed to perform the test
and if you don't do nothing it usually
takes 20 10 or 20 iterations with warm
warm-up phase in this particular case
you would need so many warm-ups because
the server is running in the background
anyway so this jmh acts as a proxy not
as the actual test what's interesting
here so we get a test which takes about
12 minutes and with a setup
it could also to take you know whole
night so jmh becomes really interesting
tool for stress tests actually because
we can just set up this way that it runs
the whole night and gathers the
operations per second and what do you
get at the end is this distribution of
the of the performance whether the
performance degraded or not and whether
they are any arrows and we can also do
you can redirect the output to a file
which is particular
useful and interesting for benchmarking
and now now let's let's wait for the
results so what is amazing
eg bees are far more chief far more
operations per seconds than cd-i which
which is caused by pooling so not all
not not on each request all the
resources has to be injected rather than
on demand and but what this benchmark
demonstrates is how to test Java EE
applications which checks RS or any
remote endpoint you could even invoke
JSF pages with a simple Ori or test
WebSockets applications at the same same
way so jmh is a really nice benchmark
tool well integrated with Java and maven
and could be also used or misused for
implementing of stress tests</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>