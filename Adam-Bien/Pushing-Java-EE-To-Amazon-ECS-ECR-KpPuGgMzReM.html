<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Pushing Java EE To Amazon ECS / ECR | Coder Coacher - Coaching Coders</title><meta content="Pushing Java EE To Amazon ECS / ECR - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Adam-Bien/">Adam Bien</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Pushing Java EE To Amazon ECS / ECR</b></h2><h5 class="post__date">2017-02-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/KpPuGgMzReM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello my name is Anna beam and to do
like to push a java application to the
cloud so I would like to push a full
stack java application with CentOS and
OpenJDK to the cloud so the largest
possible image to do this I would start
with maven so we need a at first so
let's start with the standard maven
archetype and I would like to call it
cloudy and I would also like to create a
jack storage resource application cloudy
no component just the boundary clouds
resource and let's we need here a clouds
and a very basic message message and
this is going to be a get message and to
something interesting and return a
message behind every cloud there is a
Sun so mess the message is almost longer
than the app so as it should be
with Java system current Amelie so we
have that so not even we don't even have
to build this what I will need to do is
to create a docker file so we start with
that know JSP docker file I would like
to create new other docker file and of
course I would not like to use Alpine
which is tiny I would like to use the
sandwich full stack so a hex hex payara
full and the fire is based on open JDK
and central 7s full spec tiara and you
will find the images in Docklands in my
github account copy copy from targets so
we have made them so we know that notice
and the name of the app is clouded at
war and I would like to do to push it to
deployment
so that's good and now I would like to
boot builders so I will go switch to
cloudy and say maven clean install so it
will fire up maybe but at the same time
I will just chain it to build the dock
image and the problem is I need a tech
name and it a tech name I need a
repository name the private Travis
registry name and I would like to use
the Amazon ec2 container registry and
say okay a hex flash cloudy this is my
repository next I have that and the name
so we have here this is the name of my
repository and this is the first push so
holy just the initial build so let's
build that so looks good so we have this
already built and now I would like to
push it
so doc I push and I will have to use
this this is the fully qualified name of
the registry plus the repository name so
the to that and this will take a long
time and the reason for this is so the
first layer was the extra the actual app
and I guess this layer is going to be
sent to us this layer is going to be the
open JDK and this is going to be D
payara
but the good news it takes only the
first time that long because it has to
transport to know everything to the
cloud and the subsequent builds are
going to be a lot faster why because
because if we look at the image story we
see that our image is actually 4k this
is the app this is the payara image this
is the JDK image and this is the
Centaurs image and of course this three
images they just change infrequently I
would say three times a year at most so
JDK is really
you know once in three years I would say
that of course patches every few weeks
and this changes frequently the
subsequent pushes to the cloud are going
to be lightning fast so arm let's wait
until it uploads then proceed with with
our code so our cloudy app is pushed the
repository it took a long time because
everything that need to need to be
pushed so this Centaurus jdk and the
full payara but because of the hard
separation between infrastructure and
business logic it happens only once so
now the service is already in the
repository so we have a hex Klaudia and
what we can do we can go to the task
definitions and say ok I would like to
create a new task definition and the
task is going to be cloudy and I would
like to add a container and the
container name is cloudy
not quite I will need two foolery so
what we need is this is the full name of
the service so I'll put it here then
have limits let's say we need 512 Meg's
of RAM and pod mappings
I would like to expose the port 8080 CP
unit units thousand 24 for which
basically means take the whole CPU and
yeah looks good and so we have the
container cloudy 512 looks good create
so our task was created successfully and
now we can go to the cluster to the X
and now we can create a service and we
create a service cloudy one plus the ax
service nom name let's say call it plus
cloudy service number of tasks let's say
we need at least one task in the cluster
and no load balancing so everything
looks nice and the the task was created
and we can see it will run cloudy and
status pending so it's about to be
started and the interesting part is I
took this the smallest possible machine
and it is the TT one a sinc micro it is
one CPU and one gig of ram and let's see
how well Java runs on it so we have this
let's say so is running looks good so we
have this task is running everything
looks good the ec2 instance I'll show
you the instance so it's also running
and this is the IP address or the DNS
name so I would just choose it and first
I would like to see whether it works
with 8080 you see the payara is running
in the cloud and it was a thing cloudy
resources / it was clouds I guess and
you see behind every cloud there is a
Sun so this was from scratch pushed the
app so now but what's interesting if I
go back here and say behind order there
are no clouds so we have a software
update so I will switch back here and
say I would just build it again and push
it again
so now it's done so it means if I'm so
now the the service was pushed to Amazon
and I would just have to update the
service and create new revision but I go
to task definitions and go to the cloudy
cloudy create new revision and it will
ask me the new container and the fourth
and I could update the application right
now but the push was extremely fast it
would it took just a few seconds
and the bigger would be the war and the
smaller the application server
the longer we will take or the shorter
would be the very first time push or
faster the push but the longer will take
also subsequent updates which are
actually the rule that you are updating
over and over again a service in
production or in development so thank
you for watching and enjoy Java EE full
spec and clouds</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>