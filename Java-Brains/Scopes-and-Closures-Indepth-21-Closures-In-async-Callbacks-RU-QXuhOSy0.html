<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Scopes and Closures In-depth 21 - Closures In async Callbacks | Coder Coacher - Coaching Coders</title><meta content="Scopes and Closures In-depth 21 - Closures In async Callbacks - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Java-Brains/">Java Brains</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Scopes and Closures In-depth 21 - Closures In async Callbacks</b></h2><h5 class="post__date">2016-05-07</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/RU-QXuhOSy0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">now that you have a fair and signing
hopefully of closures I'm going to talk
about one problem that can get really
puzzling unless you really know what's
going on with closures this was actually
a problem that I faced before I really
understood closures I was learning
JavaScript I was trying out something
and I encountered this problem and this
is what led to me understanding closures
trying to find out what was going on
here and that's how I started learning
closures and you know finally I figured
that out but this is something that
would make sense only if you really get
closures so let me demonstrate what I
mean by this
now let's say I have a bar I and then
far I equals zero I less than ten I plus
plus and basically creating a for loop
here which executes ten times and I'm
going to do console dot log off I now
what would happen if I were to execute
this this should basically print I ten
times right so it starts from zero goes
all the way to nine so it should print
zero to nine English there are ten
console that logs which print I zero to
nine so if I were to reload and run
there you see zero to nine gets printed
but now let's say I want to use the set
timeout feature I don't want to print
console that log of five directly I want
to wait for a second before I print the
value of all these things to zero to
nine so what I'm going to do is I'm
going to create a set I'm going to call
set timeout and it takes two parameters
right the first one is a function second
one is the millisecond so let me create
this as a separate function bar print
equals this function all right and I do
a send print I'm creating this function
over here and then passing it here so
here is I this implicit book and now I
have this print which is a function
which prints I and now here for I equals
0
- ten - nine really I say set time out
of print and one second so it's going to
wait for one second before it prints it
for each iteration now if I were to
execute this it should basically print
zero to nine as we've seen before
but it should print after one second
right let's see if I were to run this
you see what happens it's printing ten
ten times it's not printing zero to nine
it should have printed I did wait for a
second three so I didn't get this output
immediately related for a second and
then it printed ten ten times she's not
really what we wanted if I had not done
the set time up if I just called print
what would have happened let's say I
clear this out and I reload and run it
prints zero to nine works just like it
should but now what does the problem
with this doing set timeout it is not
printing zero to nine it's printing ten
all at once what's going on here so the
problem becomes obvious when you look at
where the variables that created and
what the closures are let me put this
back to calling print as before okay
this is the print that worked and we
were able to see zero to nine now let's
trace through what's happening here
there is a variable I then the the code
executes very first line creates a
variable called I there is one variable
called I and now there is a print
function which does console that log of
I so I is referring to this I here
because that's the scope it doesn't have
a variable called I inside the function
so it goes one level up and axis aside
locally now I am looping through 0 to 9
and I'm changing the value of Phi each
time and I'm printing it to the first
iteration I become 0 and it says print I
now it goes here X gets this line from 0
now the second iteration I becomes 1 it
calls print and it executes this lie is
not one it
times 1 and so on and goes all the way
to 9 and it printer but now what happens
if I move change it to this one which is
a set by mod let's trace through this
again now here when this executes let's
let me execute this and show that this
print is ten ten times right we see
prints ten ten times now clear this and
executed again it for a second and
prints ten ten times let's trace through
this flow line one executes there is a
variable called I there is one variable
called I think it's declared and now
there is print which has a function
console that lab of Phi and thanks to
closure there it remembers what this is
right this is referring to the global so
now here is the for loop I is assigned
the value 0 and now there is a function
called set timeout that is called with
two arguments print and thousand
milliseconds which is one second
so print here has a reference to this I
there is only one copy fi here right so
this print is referring to this copy of
Phi and now set timeout says okay I got
this print object and I've got thousand
milliseconds I'm going to hold on to
this object and execute this object
function object after one second now
it's going to execute the second
iteration of the loop I is now changed
to one okay now
you again call settimeout with the same
object and thousand milliseconds
I'll set timeout say okay I got it I've
got the same print object I need to
execute this function after one second
I'm going to do it I'm going to do this
thing twice so go again I equals to set
time one gets the same object so it's
basically you're basically calling set
timeout with the same object reference
this function it's the same object it
gets sent as a timeout with the value
one second right so what it does is it
it has this multiple cars registered set
timeout has multiple calls registered
now it goes it loops through it loops
all the way to nine I becomes ten when
the last I plus plus is called and it
checks this condition I is less than 10
no so it does not call set timeout
it exits the far loop at at this point
of time I contains the value of 10 and
now set timeout is holding onto those
ten calls it hasn't executed it yet
because one second has an elapsed if it
waits for a second and now it says okay
I need to get the Sprint object and
execute this now it gets that first call
print object or print object is this
function object and it is pointing to I
which is this final instance of I that
got created when this function executed
when line one executed now what is the
value of that's contained in the side
the value is stand because you remember
the for loop executed and the for loop
exited when I was holding the value of
ten so i contains the value of them so
when set timeout finally gets to print
executing this print i has the value of
ten so it prints then over here and it
gets to the next thing and it is still
ten at Princeton so it keeps doing this
it executes sprint ten times but when
the first print gets called and even all
of those prints get called the value of
I is ten so that's the reason why it
prints ten ten times okay
so set timeout basically queues up the
execution of print after a second but
then it's all pointing to the same value
of I and I at that point of time this is
going to contain the value of ten
because it could have exited this far
loop and that's the reason by ten gets
printed ten times this was a
particularly tricky one for me to
understand and once I understood
closures once I understood that this is
asynchronous the execution of this print
function is after a second one sends to
those two concepts it did make sense now
the question is how do you prevent this
from happening let's say I want to print
zero to nine but I wanted after a second
how do I get this to work we'll look at
that in the next video</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>