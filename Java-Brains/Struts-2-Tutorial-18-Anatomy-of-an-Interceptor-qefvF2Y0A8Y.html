<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Struts 2 Tutorial 18 - Anatomy of an Interceptor | Coder Coacher - Coaching Coders</title><meta content="Struts 2 Tutorial 18 - Anatomy of an Interceptor - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Java-Brains/">Java Brains</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Struts 2 Tutorial 18 - Anatomy of an Interceptor</b></h2><h5 class="post__date">2013-04-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/qefvF2Y0A8Y" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in this tutorial we're going to
understand the inner details of an
interceptor you're going to take an
interceptor pull it apart open it up see
what other in the workings of the
Interceptor and in the process we'll try
to understand how all the interceptors
work we know how to configure the
interceptors we've seen that in the
previous tutorial but we still don't
know what actually makes an interceptor
what does the actual code in the Java
class so I'll give you an example
scenario and I want you to think about
how you would implement such a
functionality how we would implement
such an interceptor so just to get your
thought process going what I'll do is
I'll give you a scenario where let's say
I have let's say I have this structure
application and I have one action class
that should do for now okay so this is
an action class and I have three
different interceptors
actually why don't I add a couple of
more action classes I think that will
come in handy so assume that we have
like three action classes okay so we
have this action one this is action -
and this is action three and this is
interceptor one interceptor two and
interceptor three so what do we know
about interceptors so when we make a
request depending on which action it
goes to there are some interceptors that
are run so let's say for for action a 1
I have the interceptors I 1 I 2 and I 3
config in this order so what's actually
happening none when a request comes
which a one has to address the
pre-processing step off the interceptor
I 1 runs right so there is a
pre-processing step and then the
pre-processing step of interceptor I 2
runs and then the pre-processing of
interceptor I 3 loads there's no
specific thing sb pre-processing there
is some logic which runs that's my whole
point
ok so there is logic in I wondered runs
there's logic in I 2 that runs and
there's logic in i3 that runs okay and
then we see the call going to a 1 and
now a 1 does its job it finishes
execution and then it returns now what
actually happens is there is a different
piece of logic that runs in i3 there's a
different piece of logic that runs in i2
there's a different piece of logic that
runs in i1 okay
so the whole idea of having some piece
of logic run in the beginning before
the action until some piece with logic
run in the end this is kind of common to
interceptors you might have some
preparation logic over here and you
might have some cleanup logic over here
one example that it can give you is the
timer interceptor so there is an
interceptor called the timer interceptor
the only purpose of the timer
interceptor is to calculate the amount
of time it takes for the rest of the
process so let's say this I 1 is the
time interceptor so what happens is in
the pre-processing part of the logic
right when the part of the code that
gets executed before it hands out to the
action class so this kind of makes a
note of the time when this is run right
and then all the other interceptors run
and then the action runs and then on the
way back this makes a note of the time
so basically you get to know the
difference in time from the start of the
execution to the end of the execution so
if you configure I 1 and the beginning
of the chain you get to know the time
difference from the start to including
all the Interceptor times and the time
required for the action to execute and
then the rest of the interceptors then
it comes back so if you configure I 1 at
the end right if the timer interceptor
is at the very end you get the time
taken by the action alone and not by the
interceptors so it's a high anything to
know you know you can measure how much
time your action are your action plus
interceptors stay so time my interceptor
is one of the interceptors so the way it
works is like I said so there is a
pre-processing set of code which
actually makes a note of the time and
then passes on the control and then when
the control comes back irrespective of
what happened before it so there is a
post processing step which makes a note
of the time and then gives you a you
know we can find out the difference in
the time so it's common to have
interceptors which have a pre set of
lenore lines of code and then a post the
set of lines of code all these
interceptors have such a functionality
so this is what's going to happen then
you have interceptors configured in this
order so i1 i2 i3 so a1
as the interceptors i1 i2 i3 configure
so this is the flow this is how the flow
of control goes now let us say a 2 has
i3 and I to configure okay in this order
so then a call comes in and a 2 has to
handle it then what happens is I three
runs first so this this piece of code
runs first okay and then this hands
control to this interceptor so this runs
second right and then this piece of code
hands control to the action so a 2 runs
after that and then after you to is run
this runs so this is this is what this
would be 3 and after that the on the
return
so i2 post-processing estarán so this
would be 4 and then I 3 post-processing
s turn on which is fine ok so this is
the flow for a 2
okay so I hope you understand that this
is very very flexible right irrespective
of what logic is there inside each of
these interceptors the flow of control
is entirely dependent on the V you've
configured it in the structure XML and
the same interceptors in the same
classes hand over control to different
other interceptors or action classes
depending on and their order in the XML
so this piece of code right the piece of
code in I 1 the pre-processing piece of
code and I one has no idea which
interceptor is going to come next and it
shouldn't because it could be I 2 it
could be I 3 it could be I 10 later dull
all it does is it does its piece work
then it hands it over to the next
interceptor which comes off if it's the
last interceptor hands it over to the
action so now I want you to take a
minute and think about how this could be
implemented let's say you are writing
this logic how would you do it we know
that every interceptor is a Java class
so i1 is a simple Java class I
as a Java class so there has to be a
method here right so there could be
there could be a method over here say i1
inside the island class let's say there
is a method let's call it three for now
okay assuming that we have two separate
methods let's go over this for now this
is not actually the way it's done but
let's think through how this could be
okay let's say we want to implement it
exactly like what we see over here every
interceptor class has a pre and a post
so the the logic inside the methods are
pretty straightforward let's say for
this one right you'll be just making a
lot of the time so it's pretty
straightforward now the tricky part is
how do you find out who to hand control
to right what is the next method to call
so the only way an interceptor can
actually know is by taking a look at
this fat sectional okay because that's
where it's configured so for a-1 it's
this for e2 is this for a different
action it's something else
oh you have to take a look at it right
there's no other way out because an
interceptor when it runs it needs to
know for which action it's running it
needs to know its place where am I in
the chain
you know then based on that it's going
to look up the next Interceptor and hand
it over to that guy or if it's the last
guy in the chainage gonna hand it over
to the action not the same thing for the
post right so it needs to know that it's
going to go next so this is actually the
part of the code where you need to hand
control over there has to be some piece
of code in pre in the post
this has to be there for every
interceptor it so this is actually
duplicate code so it's not a good idea
for the Interceptor itself to look at
the struts XML because it has to be
there in every interceptor and it's not
really the interceptors concern we are
kind of having extra logic here in the
whole idea of separation of concerns we
actually defeat the purpose okay so the
interceptors itself should not look up
what's next right the interceptors it's
l should have no idea of what's coming
up next so having said that how do we
solve this problem well there could be
several ways but I will talk about how
stretch two solves the problem at least
how struts to interceptors actually
solve this problem of achieving this
flexibility without having dependency on
the configuration okay so this kind of
this is supposed to be one of the
complicated topics in starch - so I hope
you're paying attention I'll try to be
as clear as possible so the way it
starts to solve this problem off you
know having finding out which
interceptor or which action to call next
is by introducing a separate entity over
here okay so there is a separate entity
called action invocation so this is a
separate object this is kind of like the
boss of the whole thing okay this object
is in charge of orchestrating everything
okay and this is the guy who's going to
look at this transaction all right so
the interceptors do not look at the
stretch XML okay they don't worry about
where they are in the whole flow they
don't worry about who's coming up next
all they worry about is doing their job
so this part is not that finding out who
comes up next is not that in any of the
code in fact there are no two methods
okay there's just one method called
invoke every interceptor has one method
called invoke this method is actually
run when as the name says when the
Interceptor doesn't work but what does
this method do it has lines of code to
execute as a pre logic right so let's
take the time intercepted the time
intercepted in its pre part is actually
making a lot of the time so all that
line of code is over there and then when
it's done with the pre
right it says there's a line of code
here which says it talks to this guy the
action invocation it takes hey boss man
I'm done with the pre part of it so you
do what it takes to get the next guy in
right you look at the start XML you look
at whatever you want to look at pass the
control to the next guy and so on okay
and when all of that is done when all
the subsequent interceptors and the
action everything is run and then on the
way back when everything else is run
then return back control to me so that
there's lines of code below that which
need to execute as a part of the post
okay I hope this is making sense let me
tell you this out and explain this so
let's say so let's say I have these
three interceptors I 1 I 2 and I 3 about
all of these so this this is the class
right
all these are classes I 1 is a class I
to Interceptor is a class and I 3 is the
class so all these interceptors have a
common format they have this method
intercept I think I made a mistake in
the I think I said in work it's actually
intercept forgive me it's the method the
single method inside all the
interceptors is called intercept so the
intercept method has pre logic right and
then it has the action invocation dot in
work and then it has the post logic so
this is a this is actually a call on
them object so I'll talk about how it
gets a handle to the action vacation
object so this is this this guy over
here the action in location object right
this is the boss guy okay so the I will
talk about how these interceptors get to
handle to the object itself but it's
actually calling a meth
ten of the action location object so
it's calling the invoke method of that
object so the same thing over here you
have an intercept method and again it
does its thing so the pre and post logic
of these interceptors actually depend on
the Interceptor itself
so if say i1 is a timer interceptor so
this logic contains code to make a lot
of the time before and after okay
so if I say I do is a logging
interceptor this logic contains code to
you know make a log of something before
and after or something like that so the
logic itself depends on the Interceptor
what it's trying to do but all these
interceptors will have a common line of
code here action vacation routine work
and this has the post as well and then
close intercept and same thing for I
three it has an intercept method in it
and then it does the pre international
vacation Jardine woke and it does the
post okay so these are the three
interceptors let's say we are thinking
of they are trying to trace action a1
and a1 has been configured with these
interceptors i1 i2 i3 okay so let's look
at the flow of what happens right so
heat this guy the action vocation is the
main guy okay he's in charge of
orchestrating the whole thing so the
action location in work so this in work
is run the framework grants the in work
okay so this is the this is the main
method of the action invocation
so the in work what it does is it takes
a look at the starts XML alright so
start checks and others it's reference
this is looking at the start section all
the time okay so it takes a look at the
stretch XML it knows that the call the
request that's coming in is for the
action a1 and it knows that the action
a1 has these three interceptors
configure I 1 I 2 and I 3 so what it
does is it pulls up the first intercept
which is a one and calls the intercept
method off that interceptor so now the
Interceptor I won the intercept method
of i1 runs then it does the pre-work and
then once it's done with the pre-work it
says hey action invocation guy am done
with the pre I'm going to calling the in
work okay so you do what's what's coming
up next and once you're done with all
the other stuff come back so that I can
do the post okay so that's that's all
that the eye one does so calls the
action location didn't work
now this invoke takes a look at the
struts XML again and says okay I won is
done now I - so it's actually recursive
so the same method gets called every
time so it's action recursion but it
knows which type of the recursion it
does right so it knows what's what to do
next
so it looks at I - okay this is the next
interceptor it's going to call intercept
of I - okay so again I - it doesn't
really care where it's coming from it
doesn't really care with it's the first
or the last of the middle it just runs
the pre right it runs this logic and it
says hey action location guy I am done
with my pre so you take over you do
what's next so it calls invoke again
now the invoke again looks at where it
is right now okay it says if I - has run
it's going to take a look at I 3 it's
going to do with it's the same story
again the pre runs and then I 3 says hey
I'm done with my pre so you take over
now the action location guy it takes a
look it says ok there are no more
interceptors so it calls the action ok
so the action runs when the action
returns now it's going to do it's going
to return this one right so this
invocation returns now the post off
height 3 runs okay so this control this
handed over back so then the post runs
and now this returns which means this
returns the same method returns and now
this post execute and this returns which
means this method returns in this post
exits in this return so this is pretty
much how the stack of interceptors
execute so the post so the pre and then
the pre then the
three than the action then the post then
the post then the post okay so this is
how interceptors are you know this is
how the flow of interceptors go okay and
this is achieved using recursion if it's
too confusing for you now just don't
worry too much about it at least I think
you have got the overall picture of how
these things work so every interceptor
has an intercept method okay and each
intercept method does whatever it does
but then it has one line you should have
at least one line it says hey action
invocation in hook right or else the
control does not go further so the one
final thing which you have to know is
how it gets a handle to the action
location right every interceptor has a
handle to the action location how does
it get it it gets it because the
intercept method itself takes in a
parameter while actually invocation so
it takes in one parameter every
interceptor every intercept method takes
one parameter called the action
invocation so that's where the action
invocation passes itself then it calls
the intercept right so all these
intercepts are actually being called by
this guy the pass guy so when it calls
the intercept it actually passes a
reference to itself so that it knows
each interceptor has an object to call
the invoke on okay so whatever is passed
to this interceptor it just calls the
invoke of that object so that's how this
whole chain of interceptors is achieved
and stretch too I hope you have kind of
at least the basic idea of how this is
happening
you can probably tree watch this video
if you know if you still have some
confusion of any of these concepts in
the next tutorial I'm going to take a
look at one of the interceptors and
actually we'll take a look at the code
take a look at how the how this flow is
achieved and hopefully it'll be a much
more clearer picture then</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>