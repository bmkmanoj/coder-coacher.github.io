<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Spring Tutorial 31 - After Advice Types | Coder Coacher - Coaching Coders</title><meta content="Spring Tutorial 31 - After Advice Types - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Java-Brains/">Java Brains</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Spring Tutorial 31 - After Advice Types</b></h2><h5 class="post__date">2011-10-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/tU6eQh9Hmqk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello and welcome to this tutorial
before we start a quick recap of what we
have so far we have a class with the
main method that is calling setter on a
circle object and it's setting a name
value now the circle object has a setter
method and we have written an aspect
which has an advice method that will run
before that setter method runs the way I
have configured it is I have used a
before add before annotation and the the
pointed expression that I've used is all
methods that taken an argument as a
string the string being defined by the
name over here and the name tied to a
string value over here so what's going
to happen is then the center of the
circle is called this advice is going to
run before that so let's run this class
here you can see the setter has actually
triggered this advice well we don't know
you know we cannot see if it's run
before because you know the setter is
not doing anything that's visible so let
me print out a simple statement over
here I'll just say circles set at a
speed called now if I run this here you
can see that the advice method runs and
then after that the setter method has
been called so the advice gets executed
before the setter a couple of things to
note here you can see that the setter is
actually called twice there is one me no
output over here and then there's one
over here
the reason it's executed twice the first
time the setter is called is actually
the spring container doing its initial
ization if you open the spring excel
here you can see that the circle bean
has been defined and a property name has
been in chili
so this is actually calling the setter
once and this is happening during the
initialization of the beam and then
after that this is the second coil to
the sitter okay so the second thing to
note here is the advice gets executed
only for the call that we make in the
program it does not get executed for the
call that the spring container makes in
order to initialize it's maybe November
we represent dependencies so this is an
important point to note so having said
these now let's have a look at this so
this advice is executing before the
target method is being executed and
that's because I have a add before
annotation configured over here now what
if I want an advice method to get
executed after the target method runs
well it's very simple
just like we have before we also have a
act after annotation and annotating and
I advise method without after we'll make
this method run after the target method
so a before is actually one of the
different advice types that's provided
in spring AOP so we're going to look at
a few more advice types after being one
of them so let's first change this to
add after now this add after is again
have actually imported this earlier so
here you can see add after is again from
a spec G Lang annotation package and
this is all that we need to do in order
to make this advice run after this
setter so let's test this out well here
you can see this is the first
initialization by the spring containers
this is our call to the sitter and then
after that the advice method is executed
and as far as the usage is concerned the
ad after is very similar to the ad
before so all the things that we've
learned earlier beat a declaration of
point get expressions in using the names
or writing an inline point that
expression
everything is valid even for and at
after annotation now the thing about the
ad after is it executes after the method
has run no matter whether the method
completed successfully or not
so this ad after is executing after the
setter so if the setter completes
successfully are there is some problem
in the execution of the setter and then
there is an exception thrown no matter
what happens this ad after is going to
trigger the execution after that setter
now let's say you want a little bit more
control over here let's say you want and
it works to run only when the method
completes successfully without throwing
any exceptions or anything like that so
there is a separate annotation for that
what we can do is we can say our ad
after returning so an ad after returning
is again another type of it lies in
spring AOP and I import this from the
same package now what happens is this
annotation will mark this advise to run
only if the target method executes
successfully and red dots if there is
any exception in the you know during the
execution of this method the advice will
not get executed so now if I run this
you won't notice anything different
because you know the sitter is called
the Saturn return successfully and then
after that the advice is executed
because right now the setter is
returning so and after returning
executes it's fine now in order to test
out what happens in the case of an
exception I will now write throw
statement that throws a that's a runtime
exception
okay so now this setter will throw an
exception it's not going to return so
since I have thrown an exception in the
sitter what I will now do is I will
remove the centralization I don't want
spring to get an exception when it is
trying to initialize the beans okay so
this exception is now going to get
thrown only when I make a call to the
setter so this will mean this is going
to be only one call to the sitter and
that call is going to return an
exception so now since I've thrown an
exception here this should not get
executed since this has been marked as
an after returning it should run only
when the method returns should not run
when an exception is thrown now let's
run this the sitter has been coiled and
since I do not have any catch that's
actually printing out the stack trace
over here says it's a runtime exception
and the advice is not executed so now
what if I want an advice method to get
executed on an exception very simple
let's go to the aspect so here what I
lose and write a new advise method call
this the add after throwing so add after
throwing is another advise type in
spring AOP which makes the advice to get
executed if an exception is thrown in
the target method so I will use the same
point at expression over here this is
for arcs of name and I'll write a new
advise method over here public void call
this exception advice
an exception has been thrown now after
throwing again an import from the same
package and we are all set so now if I
execute this the setter is going to
throw an exception and then because of
this exception this advice will not run
but this advice should run so let's run
so you see the factories again but then
here you can see that the advice has
executed so those are the three after
advices we have the after returning if
they after throwing and then we have an
after which gets executed whether the
method returns or it throws an exception
show the ad after is commonly called as
the after finally because it acts like a
finally block off your try catch so no
matter whether the execution completes
successfully are there is an exception
that gets executed no matter what so
these are the three after advice types
that are very handy so one other thing
we need to learn here is you know just
like we can capture the input arguments
in add method so here we caught the
input string argument that is being
passed to our target method and we were
able to use that inside our advice
method the same way we might like to use
the return object of the target method
in the after returning and the exception
object of the target method in the after
throwing because and after returning is
going to get executed when the method
returns now what if you want the object
that is getting returned by the target
method not to actually modify it we
cannot take that return object and
return something else to the actual
caller but we can actually examine it
and you can do things using the value
using the handle that is provided for
an object so let's let's look at the
written object now so here I have an
after returning so this on returning is
going to get you know it's going to
trigger the advice now this does not
return anything so let's change this and
let's create a new method that actually
return the string so I'm going to call a
new method over here set name and return
it's going to return the string itself
it's not going to throw an exception
here instead it's going to return the
value that it has actually got it's kind
of a country of example here but just
you know the reason I'm doing this is so
that I can have a method that returns
some object and I can get a handle to
that returned object in my advice so
this is just a method that takes in a
string and then kind kind of returns the
same string so this is a method that
I've defined in the circle class so now
this after returning is going to apply
to that method as well because it takes
an argument as a string so it executes
even when this method returns or if this
method returns but now we're going to
execute this method to get a return
object so this is set name in return
which is what we will execute here so on
execution of this since it's returning
an object you know this should get
executed it's not throwing an exception
so this advice should get executed let's
test this out once well here you see
that method is called and then the
advice get execute and get gets executed
after that so now what if I need a high
to the actual object the actual string
that is getting returned now way to do
that is to change the parameters to this
after returning so what I do here is I
write wine cut equals okay so earlier we
had just given the point get expression
so now what I'm doing is I'm putting the
property here in point get equals the
point get expression this is same as
what we had earlier no change here but
the reason why I am doing this is so
that I can add one more property here
called returning you can call it
whatever I want the only condition is
whatever value I give here should be one
of the arguments to my advice so I will
have a string argument which has the
same name as what I've given over here
so again just like the the input
document what I'm doing here is I'm
giving a clue to spring that I am
interested in the return object of the
target method so I have given it a name
and have given it a type so what this
does is it'll spring that this advice is
to be executed for methods that have an
input as a string given as this name
here and the string here and it has an
output type also as a string which is
configured by this value here and then
this value tied to a string here so
again we are doing two things here one
is we are telling spring what the input
type and the output diapers and we are
also having these values as
arguments for our advice so that we can
use those values in our advice method if
required so let's do just that we can
say that the method the digs earnest
string argument has been called values
this and the output value is return
string so now what should happen is
spring is going to automatically
substitute the return value over here
this return value will get substituted
over here and it's going to call this
advice by passing these as arguments to
this advice so let's run and see that in
action but here you can see the address
has been called and both the values have
been passed on to the advice so I can
use both the input arguments as well as
the output value in my advice and of
course you don't have to do both you can
do either so you do not want the you
know the input handler of course since
you've defined it over here you need to
have a method argument to your advice
but say you have a different point at
expression something like this and
you're not really worried about the
input argument that's passed you just
have to you know enter the point at
expression over here and then just
specify the returning property over here
and then you mention this property in
your advice argument then you can use
this now of course here I've used a
string so I'm telling spring that only
if the return type is a string you have
to execute this after returning and of
course capture the value now if I want
this advise to run for all you know all
the return types all I need to do is I
need to give this as an object now like
if this is an object this is this guy
if catches all return types so no matter
what the return diapers see I have you
know another method that returns let's
say a list or anything else so that will
trigger the execution here since I'm
catching an object here and then that
value is going to get passed as an
object like I will of course have to
cast it to use this inside my advice so
just like we are using this just like
we're using a returning to catch the
return type we can also catch the
exception over here so again all I need
to do is I need to go to the after
throwing annotation and of course an
exception can be quite only in advice
that is annotated with an after throwing
so all I need to do is again change this
to a point cut property and then I add a
new property here called throwing let's
say e^x as the exception and then of
course I will have to use that exception
as a member as I'm sorry as a argument
of the advice so I'll this runtime
exception X and now I can actually print
out the exception here this print out
the to string of this exception so again
I'm telling spring two things here one
I'm telling I want this after throwing
to catch all methods that match this
pointer expression and then they're
throwing a runtime exception how am i
doing that I'm doing that by mentioning
this exo value over here and then this
e^x has been defined as a runtime
exception so it catches only runtime
exceptions and then this runtime
exception value is actually passed as an
argument to my advice so let's run this
well of course I will have to change
this here
I'll have to call the method that
actually triggers the exception which is
the set name okay so an exception is
thrown and then here you can see the
advice is run and it has a handle to
Turrentine exception over here so again
I can configure what exceptions are
caught here now let's say I define this
as an exception then no matter what the
exception is thrown in any of the target
methods this advice is going to get run
and then exception the object is handed
over to this advice and of course I can
have multiple methods that are annotated
with after throwing and they are having
the same point at expression so this
this particular method over here can
have multiple advise methods that are
annotated well after throwing for this
for this method and then depending on
the exception that is thrown I can have
different after throwing methods that
get executed depending on this exception
value over here</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>