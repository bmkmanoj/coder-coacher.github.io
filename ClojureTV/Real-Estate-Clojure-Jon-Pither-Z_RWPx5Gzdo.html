<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Real Estate Clojure - Jon Pither | Coder Coacher - Coaching Coders</title><meta content="Real Estate Clojure - Jon Pither - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/ClojureTV/">ClojureTV</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Real Estate Clojure - Jon Pither</b></h2><h5 class="post__date">2015-07-07</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Z_RWPx5Gzdo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay everyone um hi I'm John I work for
jocks turn this is real estate closure I
want to start by saying that I kind of
fundamentally believe that software is a
people problem you need the right
business you need the right you need the
organization the right people on the
ground but I do believe that closure
really helps and hopefully as part of
this talk I will sort of shed some light
on that I want to start by giving a
brief issue of myself it sort of does
play into the whole talk so I went to
uni in 98 when I was there I built this
website for landlords and to be able to
go on and upload some properties through
some forms and advertise their
properties to people like students etc
and then over time this website sort of
evolved to be a bit nationwide the code
was horrible I built the whole thing in
a big java servlet in one big method and
a big if statement so probably the worst
code have ever written but it exposed me
to this domain in 2001 I went to work
for porn occasion calm and this is what
this website is so this is a property
portal as you can see you can come on
here and you can look for properties to
buy to rent you can find out how much
your house sold for three or four years
ago on the same street to be the sole
prices and you can set up alerts so you
can monitor and the properties around
you so if any property comes onto your
street you can get an instant alert or
you can roll them up into sort of three
day things or weekly that kind of thing
so these websites allow the general
public to come on hunt for properties
and to monitor the properties that they
might be interested in and there's you
know new homes and overseas and there's
lots of stuff here for those that are
interested in sort of antiquated tech
back in the day in 2001 this thing was
written in coldfusion some sort of funky
design along the way so in 2004 I then
went to work for right move
and this is right leaf so in the UK
right knee was really sort of the the
king of the property portals but
hopefully it was but um it's up there
and it's in the top ten UK websites and
when I was there you know it's kind of
struck me the size of the operation they
had a team that looked after the Oracle
stored procedures that ran the whole
thing this was back in 2004 and these
stored procedures are really you know
finely tuned and they did a great job on
them and had a very sort a dedicated
team they had a huge ops team as well
that managed all of that in and the
different data centers that they
deployed to and and I was on the Java
team and again for those that are
interested in old tech this thing in
2004 was written inside Apache turbine
which is an MVC framework which predates
struts and spring so it's quite old
stuff but I've you know it's a lot
better now and it's a big operation they
had a team for sales they had a team for
marketing and even inside the technical
team they sort of split a mentor sub
teams for the various functional areas
when I was dad's about 30 developers but
I've heard now it's a multiple so it's a
big bigger thing so Oh in 2005-2006
right we've built this new thing called
home information packs it was a new
company and a long story short and the
government didn't introduce the law that
they were supposed to and a bunch of was
sort of you know went on to pastures new
the whole thing was closed down and and
that's that that's where my sort of
personal history with the property
portal domain temporarily stops but
meanwhile all this this industry
continues to evolve so Z plur came onto
the scene and they bought communication
calm which is what we just thought about
and this graph on the bottom you've got
right move which is like you know far at
the top in terms a few visits these
portals but the next three are owned by
zoopla so what we have is a classic
duopoly in place and this poses some
challenges for estate agents so estate
agents are the ones that
basically pay these portals to advertise
and the properties on the comp on the
vendors and the first challenges is cost
right so when these two portals started
up they were very much in a partnership
with the estate agents let's work
together let's be friends let's work out
the functionality we're here to help you
but then they both floated on the stock
exchange and they have to start to
consider you know the share price and
the long-term profit forecast etc so
estate agents are you nervous that the
their costs are perpetually going up and
they have to pay to go on to these
portals so they don't really have you
know a safety there but the other big
consideration is estate agents don't
really have a philosophical stake in
this marketplace this impacts the users
because what the users want is just a
very clean simple elegant experience
when they go on to a property website
but if you can imagine these companies
they have to find some of the revenues
they have to put some things on the side
so the websites get a bit cluttered and
what the estate agents really want is
you know as a voice is the ability to
basically you know say we want the
website to look like this you know we
want to say and how it runs so this led
to the estate agents coming together and
they introduced agents mutual and they
put some money on the table and
basically they're saying let's build our
own portal let's let's do it let's you
know we can keep the cost low we can
have this thing compete against the
other two and we can have a say in how
this marketplace operates again and the
timeline for this new portal starts to
look a bit like this right so the
funding is in place in January and and
then the technology needs to happen we
need to be deaf complete by about
October time code freeze in December and
then we launched in January and at the
same time we have TV ads coming in I
don't want to stress that this operation
is it's not just the tech there's a
there's a marketing team that are coming
up with a TV advertisements that it
they're going to fly some on the copter
thing I with some village in Cornwall to
create a nice video and that's going to
happen and there's the branding as well
and there's a sales team trying to get
some more stage
to come into the collective so you got
all these different arms of operation
it's a bit like a moon landing the
technology just cannot fail if it failed
it'd be a disaster so no pressure so
this is a fairly chunky slide and just
come away with the idea there's lots of
scope but I quickly go through it right
so we've got the consumer portal on the
top left and this is this is the website
it has to be fast has to be beautiful
has to be performant it has to have all
of the functionality and that the other
ones do sale rentals contact agent
property alerts the rest of it on the
top right hand side we have to build a
hefty data processing pipeline there's
thousands of estate agents out there and
they they all send their data and it's
not going to be sensible right they're
going to give us like full snapshots as
well as Delta and they'll mix it up and
they go through different data providers
so this pipeline has to be fast has to
be robust it can't go down if an estate
agent puts any property on then you know
it has to show up immediately because
they want to get there ahead of their
competitor trigger the property alerts
etc we're not building one website we're
building two so the estate agents want
their own portal they want to be able to
log on and has to be fast and beautiful
again they have to manage their
portfolio of properties and this domains
complex right you would think it's just
the state agents but they have
departments they have regional heads and
regional setups and then they have
countrywide sort of nationwide and big
corporates etc and the people at the top
want to log on and they want their
dashboards and the reports all rolled up
and they want to sort of configure you
can see what in the levels below and we
have to have this because the state
agents are paying for it we have to have
the feature parity so there's a lot of a
lot to do there you know we track things
like the user views on the website when
people phone up the telephone number
that's next to the property then that
gets logged there's a there's a heck of
a lot to report on do we have to give
them this last one is the internal tools
this is like the sort of child in the
family that doesn't get the attention
that the child deserves kind of like a
we we have a team full of humans in the
office that help the estate agents to
get their prop
he's onto the website and they need a
whole manner of tolling they they need
like spreadsheet importers they need ad
hoc reports and it said you know we need
to give them what they need to sort of
make the business flow so as you can see
there's quite a lot of scope so at this
point how does how does closure fit into
this whole thing so the technical
director at agents mutual I used to work
for him at fornication com so there's a
connection there and I had a chat with
him and it kind of went along the lines
of we have this huge project to build
its you know and the deadline is
non-negotiable and there's there's a
fixed amount of skype and you know we're
going to look at Java to build it
because it's a conservative choice and
dies you know thought about this but I I
put closure as an option for the
following reasons so the first one is
data transformation there's lots of data
coming in to this system and you know
closures are general-purpose programming
language but if there was a sweet spot
if you were forced at gunpoint to say
what does it really excel at you
probably say well managing data right
the hold of closure core can really work
with data and this is a data
transformation project right so it's no
it's a great fit especially for the back
end it would seem but I the larger point
is I think closures are more
conservative choice but you know we we
know that the code bases that you
produce with closure a simpler Lena
there's a lot less line of code in there
and can trust that to the risk inherent
and doing this in Java where we always
make the same mistakes in Java we always
do it we always get the levels of
abstraction wrong we build a huge object
graph and then it's like we have to work
with it we have to manage it if we've
got an abstract class and a child and
you've accidentally sort of dis child
these more than what's in the parent we
do a split and it's our then it's like
the interface hierarchy goes crazy and
we just you know is constantly turning
this object model it always happens and
then once you've got an object model how
do you work with it its dependency
sharing it's a nightmare maybe
microservices to maybe help split up
that kind of thing but its own so I
think
All Things Considered closure is
actually a conservative choice with that
deadline in mind the needful eNOS the
need for development speed and the
client went away and they looked at the
state of the closure community they did
some research they looked at the videos
and they came back and made this
observation which is in the closure
community everyone seems pretty much on
the same page they seem very happy with
language they seem happy with the
libraries and everyone's just thrilled
to be a part of it and really excited
about where it's going it's a great feel
can trust that something like scholar
you know you go on the mailing lists and
people are still raging is the language
too big to academic is it pragmatic
enough what needs to change and there's
quite a stark difference there so just
by looking around the community and
what's on offer they began to get very
excited by it so coming back to this
timeline around februari the client was
right yeah you know closure is something
that we want to use the biggest concern
they had at this point was staffing so
that's where the company that I work for
jocks came in we had a kind of
preassemble team that was there for this
kind of project so we were able to staff
it five or six people straight away and
the client was able to successfully
higher amazing closure Ian's from the
community so they had this concern and
it's a concern I've seen at other places
which is can you hire people and the
answer is yes you notice people all over
London all over Europe that just really
want to come and code some closure in a
really good environment so the client
really benefited from just getting some
excellent people on board so with that
in mind you know we were sort of we
rocked up into this building they were
cardboard boxes everywhere we need to
unpack that the white boards were lovely
and white we need to get the pens to
work on them etc so we're ready to go we
everything was set us let's build this
thing so I'm gonna talk a bit now about
the baseline architecture so we went
with elastic search for the front 10
store es is a fantastic tool for
shipping you documents it's extremely
fast it's got a huge and memory store of
documents it's like a huge Redis in a
way but the search capability of elastic
is fantastic you can give it a Geo shape
of polygons and then it will sort of
ratify where the documents are within
those polygons and give you them back
and there's tons of functionality inside
of elastic that's very well matured that
is great for this kind of website so
it's a bit of a no-brainer the speed is
great the consumer portal we use ring
composure friend Vidya Liberator and
this is a kind of vanilla stack now
we've we've seen this played out in
quite a few places and the performance
of is great and their security you get
it's fantastic as well it's been well
ossified it's been well tested and
battle-hardened so we knew that this was
a pretty good stack to go with and it
and it served as well on the back end we
had but an ftp server that took some
data through onto s3 and then it raised
a persistent message and with the amazon
SQS and then we processed it and with
our pipeline which I talked about in a
minute and then we post we persisted it
into postgres and postgrads became very
much how primary golden store of data I
just want to take a moment just to say
you know postcodes is a it's still a
good choice right it's got fantastic
Jason support for Jason documents and at
one point in sort of 12 o'clock in the
morning when we had to replay loads of
data because the logic changed just
knowing how to manipulate some sequel
indexes and sort of work with that
familiar tech really pay some dividends
so yeah this justice served us very well
so the data pipeline itself we made use
of corey sync here so we we sort of
looked at our options and there's a few
off-the-shelf packages for you know like
things like storm at session and some
others that will take some inbound data
and we'll spread it over a cluster of
nodes like the tasks will be farmed out
and you might have a zookeeper or
something to synchronize it all up and
some sort of micro service the approach
and and we explored that but then we we
just came to the realization that a
single piece of data coming in if it's a
csv file with some properties in or some
images we can just process it in in a
single process we don't need to spread
it out and inside that process of course
we can have lots of threads that take on
the load and call racing when you know
really was the backbone of the pipeline
so we just built an extremely clean
clothes your code base where you got
your business functions and each one is
just given a inbound and I'm corazon
channel and then its services it it does
its thing you know it could be some
geocoding coming some validation and
then it puts it on to downstream
channels which again would have just
their business function servicing it so
you just end up with a code base it's
very decoupled you've got these nice
functions they do what they do that easy
to understand and then we've just got
one name space where we put the core a
sink plumbing and my takeaway would be
you can go a long way with that approach
to some homegrown core racing we had our
error handling in there the retries in
there they're capturing of metrics in
there and it really worked and what we
did we just built adjacent endpoint that
showed you the state of the core async
buffers and channels and you know it's
not rocket science we just looked at the
data going through and we saw where the
bottlenecks were and we just tweaked how
many threads and were given to this
particular function that serviced it's a
channel which was just a metadata on the
function and that's how we made this
thing go extremely fast so very simple
but I data pipeline was still quite big
it was it was still quite a
comprehensive and what it did there's
lots of tasks that go into it and when
you have a pipeline with lots of work
going on it can be quite tricky to sort
of fathom the shape of the data as it
goes through this pipeline and this is
where we leaned on prismatic schema a
lot which is a which is a fantastic
library I think so I data pipeline looks
a bit like this we've got these
prismatic schema sort of lines in the
stand
in the sand and the contracts that the
data must meet these certain points so
when the data comes into the system we
validated against the schema and then we
use coercion as well to to help us make
it meet that schema when we persist our
data into the golden store and when we
read it back make sure it matches the
schema and likewise when we persist it
to the front turn store and this gives
you part of what we occasionally miss
from 0 0 which is that declarative
schema definition the ability to open up
a file and see what the shape of the
data is and it helps you to sort of
rationalize about what's going on and
and you can make assumptions about what
the data looks like because of these
contracts so it's great we started to
use schema a bit more for the web end
points as well so when we had a restful
service we use a schema to declare the
shape of the data that the service
accepts and what it gives back and here
we made use of swagger and the Towson's
fantastic composure API library and I
can't praise this enough I think this is
this is amazing I think it's beautiful
and we we had a situation where we had a
third party building the mobile apps for
us and they were saying what's your end
point what does it look like what's that
HTTP verb I have to call what's the
shape of the JSON data that I need to
send it and what data do I get back and
in the old days you might crank out mop
and you we got the email clients and
you'd write back saying this is the
jason here's an example and that right
back and it's kind of hellish but in
this world if you've got your web routes
defined using composure or something and
you've got some prismatic schemas
defining the data then with a couple of
lines of code you get this beautiful
website for free and it defines the
endpoints and when you dig in it gives
you examples of the schemas the
endpoints accepts and what it gives back
so if you're dealing with a third party
you can just say look here's a swagger
you are everything you need to know is
in there and as an aside it just we've
had a couple of projects recently where
the deadlines are very tight again and
they're MVPs and the client says like I
just want the website where i can click
buttons put some data in and maybe get
some CS feedback or might want to upload
a file and you have to ask do you need
to build your client a rich website with
lots of forms and can you just give them
a swagger and website so it's it's
pretty cool so at this point we're
pretty happy we we've got David here
he's given it some and the builds are
our green we've got um we bought some
Diagnostics that test the whole thing in
production that put some data packets in
and then make sure that they show up on
the front end web site and that runs in
all a different environment so we've got
that security that what we're building
or the various parts actually work so
really good shape it's around mate I'm
the happy path is we called it the
skellington is built and then in July
the business wanted a milestone they
wanted all the big areas de-risked like
the property alerts and the sold prices
and we pretty much hit that as well I
don't want to claim that this was that
you know the tech was sleeper awesome
and the people around us was so great
that this was a very relaxing project
you know it was we signed up knowing
it's going to be lots of work in the
work the work was definitely put in but
then we still had lots of challenges we
hadn't really processed all of the dates
yet and that big torrent that big fire
hose of data was about to be thrown at
us and we still need to build all of
those internal tools that maybe weren't
spect out in the same beautiful way that
the other bits were and the agents
wanted more more in terms of the
dashboard and reports it started to get
a bit scary and this is when look let's
just let's just make that launched the
other milestones it would be nice but
hey in the marketing team they're
they're like doing stuff right so the
domain name and with on the market com
has been formalized it's been held and
reserved and we've got all these
brochures the estate agents really
excited they're plastering it up all
over their windows and the TV
advertisements been made we've seen it
it's very impressive so you know we're
like we really really need to to
complete this a platform and we did have
some challenges
so I am I don't want to sort of give a
completely even vangelis Tik Tok I want
to sort of you know point out some of
the challenges when you have a big green
fields closure project in a very excited
senior team so the first challenge i
would suggest would happen on this kind
of projects and I've seen it is we need
to keep it simple and we're all guilty
of this does the closure ecosystem is
it's just so rich it's so beautiful when
when you get lots of senior people into
the same room they've all used their
favorite libraries and different
libraries and it's a challenge to keep
it simple do we really need to use
instapass for the CSV or can we just use
a reg ex in this boring but hey and
Corey sink is I mean we use that a lot
on this project but do we have to use
every single bit of kind of funkiness
that it offers so so this was a real
effort it was a collective effort to
keep it simple and you know what it
boils down to is agile boring safety
nets you have to have the retrospectives
you have to have the showcases you have
to have the sort of chats after the
stand-ups and you just have to have
honesty amongst the team for somebody to
be able to say I'm flagging this risk
because i think the complexity is too
great here and we need to do something
about it otherwise we won't made the
deadline the other one is maintaining a
shared ownership so closure in a way is
it's kind of a blessing and a curse of
some ways it's a blessing in that code
bases will always be lean and simple to
a degree so you look you know you should
always be able to grok a code base it
should never grow too big like you know
we've seen some different approaches but
at the same time people get so excited
and they they get all the power of the
rec hall in there they're really like
flying high and they just like zoom off
and and rightfully so you know we've got
this business deadline there's lots of
kind of scope to build so we want to
empower that and to happen but the same
time trying to keep everybody lock step
in uniform trying to keep abreast of the
entire code base and all the decisions
have a democratic process that's a
challenge and again it's a standard
stuff retrospectives and you know the
agile safety nets
it's just something that I would flag
the last big issue that we had was data
versus closure so we had lots of duct
tape of the data was finally turned and
we just got masses of data flying in and
this is where closure was just a you
know it kicked but it was a it was a big
win here the business you know that this
team of people that helped the estate
agents with their data coming in and
they were eventually you know they're
impressed because they would they would
see this problem in the data like you
know company X that the field is it
quite right you know they've got the
semantic understanding of the spec
rongeur I've never seen so many date
formats crazy different date formats
that people attempt to send even though
there's ISO specs and etc but this is
where the what you get with closure
really helped we just had a single name
space where we just put all of the dirty
lunges in and each one was given you
know a big comment 0 ID and then a test
case and we just got into a factory
process and you know and the team that
helped us with that they were impressed
and we were really impressed by them as
well they were heroes just getting all
these examples and really just churning
through these problems software is a
people problem so yeah so around August
time we built the UI never underestimate
what a when you work with like bootstrap
e stuff you know compared to when you
work with a beautiful you I it makes a
huge difference and around October time
we will feature complete on the front
end around data time we've pretty much
mastered that data problem with all the
different data formats coming in and in
the end around the 26th of January this
year we we got it out we built it and
this is what it looks like now so the
feedback we've got so far is that it's
it's very simple and it's very beautiful
and the UI people the designers and the
brown people did a fantastic job with it
it's very clean and it's blisteringly
fast as well that combination of clothes
your elastic sir
and then some I'm cashing with some
cloud front stuff that Amazon gives us
and you I people keeping that Dom flat
so not much has to happen when the
website has loaded into the browser it's
incredibly quick and again and the
feedback has been positive for how easy
it is to using the simplicity of it so I
want to share with you a moment where
somebody two in the morning after we did
our first bug fix its kind of giving it
some and it it felt like this rose you
know it's a the website is still there
and it's it's all kind of working no
it's all you know it is working so yeah
so yeah it's doing well and there's over
5,000 branches that are sending their
data in there's lots of people visiting
it the TV advertisement did go out in
the end so that on the copter thing with
lots of buildings it went out and the
estate agents got to sort of plaster
more stuff on their windows here you can
see the logos everywhere so come to the
end and I want to say a big thanks to
closure and closure was never really an
issue at all on this project I've been
on other projects where closures like a
an exciting thing it's a new thing and
you know is you treat it with the
reverence and that's the kind of
differentiating factor of the project
but on this project closure was just
there it everyone was used to dealing
with what it can do and their simplicity
and the leanest that you get with it and
it it really excelled yeah and what was
also apparent was just the just the
libraries that are out there as well I
think the libraries that we used there's
a certain level of Polish that's out
there now in the closure community you
know there's the libraries that lots and
lots of people use and you know the big
ones and they're maintained extremely
well on github so the whole closure
ecosystem the libraries the core
language and the community and it's
fantastic the closure community wanted
this project to succeed we
able to hire from the community so that
was a big win and software is a people
problem but on this project closure
definitely helped I don't think we have
been able to do it if we had gone a
typical mainstream approach so I want to
finish by saying agents Mitchell are
hiring and the the adventure is still
going on there's there's lots more
functionality to build they you know
that domain of the three portals now is
it's still up for grabs it's still
combative so there's lots of its citing
work that needs to happen so if you want
to join that adventure come and speak
some of the agents meet your team and
that's that's me done questions</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>