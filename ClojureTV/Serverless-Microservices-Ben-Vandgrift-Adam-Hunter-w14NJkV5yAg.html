<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Serverless Microservices - Ben Vandgrift &amp; Adam Hunter | Coder Coacher - Coaching Coders</title><meta content="Serverless Microservices - Ben Vandgrift &amp; Adam Hunter - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/ClojureTV/">ClojureTV</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Serverless Microservices - Ben Vandgrift &amp; Adam Hunter</b></h2><h5 class="post__date">2015-11-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/w14NJkV5yAg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">we're going to be talking about services
web services in particular but we're
going to be talking about services
without servers so the gentleman to my
right is adam hunter hello i'm adam i
generally described my programming
career in terms of when I met Ben I met
him about seven years ago now and he
taught me to program and has brought me
up we've been on and off working gigs
together and I am here today thanks to
him well I appreciate that right and
this be Ben Ben grift feel free to reach
out on Twitter or email if you have
follow-up questions or feedback or need
to dispose of rotten fruit and I think
because I promised in the talks
description of my cat a rescue Panther
that is monster he is a 20-pound all
lean muscle cat and likes to destroy my
clothes so as adam said we work the
other for a little while off and on
sometimes like in the same job sometimes
just helping each other out you know on
the weekends and until april of this
year I worked for a work for cognate
echt and he persuaded me to to come work
with him in his company which is more
local to Charlotte and my but that
worked out well
it's a it's a pretty common problem
though that this committee had in that
they didn't realize they were a software
company everything that they did was
dependent on their technology all of
their speed all of all of the services
that they delivered were delivered to
this could the custom software that
they'd built but despite all the pushing
that we try to do against the corporate
culture they refuse to think of the
software development team is it any
other than the IT department but that
gave us a lot of free time because you
know when your stakeholders aren't
invested and when you can't get your
feedback loop is on the order of weeks
and you don't have any strategic
direction you start kind of fiddling
around with the things that you're
interested in and not the things that
are currently on fire and that has led
to this talk but one of the other things
has led to is Adam and I along with one
fantastically talented user experience
architect named Melinda Jackson found
her to company called aerostat not going
to give a pitch for aerostat but if you
like the logo and want to hear more feel
free to hit me up later so we're gonna
be talking about change and change the
technology and the particular service
architecture that is becoming possible
but this is this means this is
meaningful to me because I've had a ton
of jobs I've basically been working
since I was old enough to walk by in a
tractor and regardless of the job
regardless of the the the product the
product can be as good as you want but
it is the elements around the product
the things in the margins that are often
the best candidates for improvement so
whether you're delivering pizza the
pizza delivery method is the best place
to get improvement better cars better
traffic better tracking 20 minutes or
less or your money back
and while working through you know
finding new languages and working in
different consultancies I ended up at
cognate X and this brought me to the
hold of closure and I'm a very fond of
closure I did write a book about it with
our esteemed MC Alex but lately it's not
been a particular language it's the
whole thing right we have an idea we
move through the idea we start to write
code we design and architecture we
deploy the code we create systems around
commits hopefully that generate
continuous integration and continuous
deployment requests but not everybody's
comfortable with that and then you have
to put it somewhere right so where do
you put it and over the past few years I
guess a common architectural pattern
that we've been seeing in the industry
is that of the service-oriented
architecture I mean microservices yes I
mean microservices it's not a new idea
and everything that everything that's
old is new again the term
service-oriented architecture I think
fell out of fashion about the same time
that ivory tower architects became a
thing that people sort of started
sniffing at but the beginnings of a
service were in architecture started
before there was
infrastructure-as-a-service it started
before you could have the degree
virtualization that we that we have
easily available now servers on demand
wasn't a thing and so now microservices
have kind of come into their own as
something that's possible and relatively
easy to do so most you probably know
what Mike reservist azhar but in case
you're not familiar I'm going to have a
little run down here they tend to be
simple they tend to be decoupled from
the applications that they serve they
tend to be restful which is good and bad
deliver or HTTP chatty protocol you know
we can
have that debate at some other time but
they give you the ability to be scalable
because the scalability of your micro
services can scale a different rate of
of the apps consuming them and you can
distribute the load of your entire
application process over however many
pieces you really want to play with so
they're handy they give us the ability
to compose our apps out of distributed
components that we access via via
connections what martin fowler called
dumb pipes and smart endpoints and i
think that's pretty accurate and if
you've built a micro service if you say
you know put one together to do a data
retrieval or anything like that it
explained about about like this
generally if you've got 20 minutes and
I'ma graffle you might put together
something looks like this you've got a
nap and inside of the app you've got
some kind of framework that's supporting
the app you know whether its pedestal or
rails or sometimes light-weighted
sinatra you've got this routing piece
that opens up your endpoint urls on the
on the internet got a persistence piece
in the back there that stores and
retrieves your data and a bunch of
boilerplate code that you have to do
because you have to do and in the middle
you have these service functions you
can't see where I'm pointing with my
mouse the you have the service functions
there in purple these are the meat and
potatoes of the of the micro service so
you put these together you put your app
out there and you send it somewhere and
you have a client so you've got a single
page application written in reagent and
you're talking to this application
server and this is pretty
straightforward right server client haha
we've been doing this for a long time
you might discover that you want to
authenticate on some level so you spin
up an authentication microservice and
then when you make your queries to the
app the app validates your token by
calling the same micra service and maybe
you want to add an auditing piece that's
the tail
down there I probably should have
labeled does and then you build another
app so it needs another set of micro
services so you start getting more and
more services then you end up with
layers of services services that compose
other services and before long you run
into something that's hard to categorize
and hard to explain and hard to
visualize and hard to manage it's not
each of those little dots is very very
micro it just turned into a huge thing
it turns into in fact turn to that so
we're looking at the you know we're
looking at system like this and there's
a bunch of complication that you can
start to try to collect so maybe instead
of running a you know a teaching micro
instance for every single service you
spin up a doctor host and you build
these things as containers and you you
throw them in a in a docker container in
a doctor host or maybe you're using the
elastic container service there's a you
know doing things like this costs a lot
in terms of building your infrastructure
in a particular way when you consider
that a micro service is supposed to be
fairly stupid and the network is
supposed to be i mean i should say the
micro service supposed to be simple and
the network is supposed to be stupid it
doesn't matter what's at the other end
of it so you could be dealing with java
or closure you could be dealing with
Ruby or it really could be anything and
then when you start to distribute this
across a number of teams and your
company's large then it starts to get a
little bit hard to manage the other
problem of course is money and when you
are deploying a bunch of servers
willy-nilly I they can turn into lots of
money your network is fronted by
cloudflare or something else to protect
you from DDoS
tax and you have multiple layers of
servers and like subnets full of RDS
instances and it's 10,000 20,000 30,000
dollars a month and it goes way way up
and every ten thousands of course
another developer that you could have
working on this problem so it's costing
you an operational expense in terms of
the amount of money that you're actually
spending on the services and it's
costing you in opportunity because the
developers themselves are either not
employed by you because you're spending
that money elsewhere or they're busy
configuring and managing these systems
so when you get to a system of the size
you end up spending a lot of these and
my dad had a turn for this he called it
in mega bucks you're spending mega bucks
but you don't really need servers right
servers are just this thing that you
know we don't need it all we've gotten
into a mindset and it's been true for a
really long time and it's an easy easy
thing to make because the words are so
similar server services that there's
some correlation between these two
things and we want to take a service
that we built and we wanted to pull it
on a server right it's got to go
somewhere right it did somewhere but we
paint ourselves into a corner we have
all of this stuff and remember every
line of code is a liability right all of
this is customized configure changed
around your your routing inside of there
your the tasks that you have to deploy
it the project management in line but we
really care about these and that's
basically it so why should we ever build
anything other than these
so richens do are big on rationale and
I'd like to provide one so there are a
couple of reasons why this is important
to me not just curiosity but I really
believe it's a direction that this
industry can can go if we can abstract
away all the detritus of the server its
configuration networking the framework
be the other nonsense that we deal with
from day to day and just get to our
service functions we'd find a way to do
that then we can really focus on this
one thing and not worry about the rest
of it and that's going to give us more
time to make better more robust more
scalable more beautiful and more
functional service functions it's also
going to save us a bunch of money and
time because we're only paying for the
sections of code that's currently
executing if you're not running cycles
on the CPU why should you be built for
it and finally a nice where this is the
only plea to your mother that I will
make these things costs a lot in terms
of power so if you want to be a good
person and use less power you should
consider an alternative architecture
that's it I'm done
I promise because services it requires a
different way of thinking as services or
just functions and functions do one
thing and where have we heard that
before right they're not applications
they're not servers they're just
functions and as we were building an
application it was a single page app we
said why do we need servers so we
started trying to find a way around it
and we didn't so before we go any
further I'd like to say a couple of
things the biggest one is we do not work
for Amazon although we're recommending a
bunch through services right now they do
not give us a dime and if Amazon if
you're listening if you'd like to change
that please just start sending me checks
we do end up using a lot of their
services and I've been doing so for for
kind of a while the next thing is this
is not necessarily something that's at
present fully baked I want to get out in
front of it and get it in your mind's
you can start to be thinking this way
I'm starting to try to use it a little
bit in my practice in our practice and
we've turned some clients on to it but
pieces of this architecture our brand
spankin new right like a couple of
months old and they haven't been worked
on a lot and their documentation when it
isn't wrong it's thin and sometimes
terrible the deployment story isn't
necessarily as well as we like these
things to be and I don't know what its
upper or lower boundaries are because I
haven't had an opportunity to test it at
scale so with those things out of the
way I think the idea has legs so I'm
just going to plow through like it's
something that's true all right this is
the anatomy of a micro service call in
its barest form we get our widgets 32 we
want format PNG back and that
constitutes a request right that request
pulled in by our app server or you know
whatever we're wrapping the stuff in
then we have this off piece which says
oh you have access to that or you don't
and then we have this little retrieve
function that goes to our data store
looks up whatever it is packages it in a
response and sends that back this would
be running on a server somewhere in the
cloud or in a closet in the case of our
old employer lock it did have a lot we
could accomplish all these things with
API gateway lambda DynamoDB incognito I
how familiar are you guys with these
technologies sleep really familiar
somewhat familiar okay so all right I'm
going to go through a little more detail
down just to just to make sure so API
gateway is brand spanking new it allows
you to create endpoints wire them up to
things and then transform the result
that's coming that's coming out the back
you configure them and then they're up
and you just go you can do that across
multiple different environments univ
staging environment production
environment you can deploy them using
swagger ish ish sort of um soon it's
gonna it's going to be better soon I
hope and it runs about 350 per million
calls I'm not terrible then there's
lambda which I think most of AWS
reinvent this year was spent talking
about to various degrees there is a
lambda function that is the service
function I was talking about earlier you
execute this and then you return the
result you can you can push to it it can
it can pull and you can have scheduled
events and this is billed by the hundred
milliseconds of execution time
limit of 60 seconds if you go over 60
seconds so like something's broke you're
done but as long as you can finish your
service function within 60 seconds it'll
just run and you can keep throwing
things at it and it won't bother it at
all piece number three is dynamodb easy
persistence for data with light
relational needs yeah I'm just reading
from the slide but that's the best
phrase I could think of to talk about
dynamodb and it's something that's
bite-sized and consumable it's really
scalable it's no sequel ish but you can
do a lot of the things you can do with
sequel in terms of what you can query in
all the ways that you query most
frequently but the more relational ish
you need it to be the more your kind of
swimming against the current so it works
for quite a lot of use cases and the
pricing is extremely complicated it's
not extremely complicated certainly more
complicated I want to get to in a slide
pretty inexpensive though they can't be
incognito which I didn't know anything
about until recently cognita was
designed for mobile apps to allow you to
sync mobile app data to to the cloud so
it's build on the basis of sinks so 15
cents for 10,000 sinks but we don't care
about that actually what we do care
about is that it does a great job of
providing identity and access management
for insecure environments like say an
app running in a browser that somebody
can just save the JavaScript and pilfer
through you know cognito takes care of
that and in this in the scenario you of
course got your usual storage and
network costs that you're going to get
hit with by amazon regardless so here's
our our backbone and now we're going to
plug into pieces that are relevant to
removing service entirely so we can
configure api gateway with a get request
to widgets with an ID and a format ship
that off to a lambda invocation which
will contact
mito to do our authentication retrieves
the widget from DynamoDB returns the
result api gateway which formats it to
json or xml or you know whatever we
specify and kicks it back out the door
and we've done all this without actually
booting up a single server ourselves
there's just nothing there so I know you
guys want some examples examples
examples okay so we're going to switch
over to github and the browser to give
you guys a couple of pieces to walk
through first let me apologize for my
voice I've had a cold for about a week
not quite sure why I assume it's Ben's
fault we have a reagent application that
is very sparsely styled so please feel
free to heckle it as you like that
excuse me the application is going to
contact mostly API gateway to be able to
run whatever types of code that you need
to run on the server and then get the
results back process them and you can
have a lot of your view logic and I'll
even talk about putting some of your
business logic in the browser so we have
put this up on github obviously we have
four if you will services that are
living in here each one of these is
their own application the actual
application itself lives on s3 so
normally I would be sitting up here
behind the microphone thinking man I'm
getting billed every single second while
my demos up and running on ec2 but in
this particular case because i only get
billed when people use it I don't care
so I can take up all your time and not
be charged any money so I'm going to do
a little bit of demonstrating I'm gonna
hop into the Amazon console how familiar
with the Amazon console are you guys
pretty pretty familiar okay so I don't
spend a chunk of a huge chunk of time in
there if I need to bump up the font
sizes please let me know what I'm going
to go ahead and all right
so let's run better bring this up a
little bit i'm going to refresh this guy
i literally just ran see ljs build once
and then brand is 3 to upload so it's
not optimized for production so on and
so forth and it complains about fig will
not being attached but this is the
reagent app that's going to talk to the
different microservices we did have a
much more beautiful application to demo
and then i left the company that owned
the apps this has been put together
reasonably last minute moose once bit my
sister hastily so the first thing we're
going to talk about is the
unauthenticated portion so we can solve
maybe ten percent of the business use
cases in the world but this piece is
pretty straightforward I'm literally
just I wanted to grab the ec2 prices but
you would not believe how some expletive
that amazon has around actually fetching
those prices the lambda prices are very
easy to get and i just scrape them off
their web page so I grab them transform
them into a basic java javascript object
in here you can see I've got these two
fancy execute API us east amazon AWS
staging pricing AC 2 and lambda calls in
here and the first thing i want to talk
about with api gateways gives you a lot
of flexibility in what you're trying to
do so the premises yes there are
technically speaking from our point of
view no servers but amazon is obviously
running servers in the computing
paradigm that we're all familiar with
pretty much lives on they have as far as
i can tell a api gateway set of clusters
that runs engine X and a bunch of
different transformation rules it goes
in in four steps and each step can be
customized for how you want to handle it
so it can transform the received
requests before it actually hands it off
to what it's going to do with that and
then it has the ability to actually send
that to someplace else and then
transform that request so you have the
ability to customize it all four stages
in this particular example I'm going to
hop over into our API gateway and you
can see we have I make this little
bigger maybe you can't see we have our
user session pricing and
the pricing has ec2 and lambda
underneath it now in one of the things
that's very very very half-baked from
amazon is the ability to automatically
deploy or automate your deployments to
api gateway as far as i know i may be
the only person on the planet who has
gone through the trouble of using their
amazon labs swagger java-jar importer
tool utility and their pet store example
to figure it out so we did I do have a
pretty solid working example for you
guys on there which I'll show you in a
second the premise here so like I said
lambda was pretty easy to get so I need
to be able to get the pricing by
fetching the actual page from amazon
that has the prices on it and doing some
Dom manipulation to get some numbers out
of it that is entirely written in a
closure script function actually let me
pause here for a second how many of you
guys do more closure script than closure
okay so not a ton of you guys how many
you guys are doing closure script
running on node awesome okay so a lot of
this stuff is going to be right up your
alley and everyone who's not you should
start the big reason that I'm using
mostly closure script on lambda instead
of closures because the JVM boot up time
is very very high so the example that we
had was originally a PDF generation
service that we wrote in Java we don't
really care if it took you know three
seconds or six seconds or whatever
because it was doing a lot of work
generating PNG's and all that kind of
fanciness and Java interrupt fandom the
heck so as a slight aside if you're
doing very infrequent in vacations then
no it has a better start up time if
you're keeping the thing busy quite a
lot then the JVM comes up to speed and
stays up to speed you get very good
performance either jbm we are we did
some back on napkin calculations by
causing am dead lambda lambda to write
things in to s3 so I could see how many
different endpoint or clusters they were
coming from and I got about four in the
u.s. region everything inside of amazon
also as an aside actually talks to
itself using cognito which is the also
the most horribly and error-prone
documented piece of software I've
probably ever seen so if you get
anything out of
this it's a functioning example with
cutting you on the browser anyway so the
difference between lambda and ec2 is
that lambda runs a lambda function to
get the lambda prices I apologize for
using the same words for everything but
I do it all the time and the ec21 works
a little bit differently this is some
super excellent style sheets they've got
going on here there we go so let me hop
into here so in this particular case the
integration request you generally have
three options when it comes to API
gateway you can either have it be a mock
request which means that it can just
serve you up some random static data
that you've already uploaded to API
gateway via its transform mechanisms and
I'll show you guys that insect you can
have invoked pretty much any amazon
service you want to so you can say
amazon service x that i have control
over i would like to wire you up to an
HTTP endpoint that i can just call and
have a do stuff in this case lambda is a
excellent candidate for that so now i
have a nice fancy URL that i can run and
get the response of my lambda function
that solves most of my how do i not use
the server use case the getting the
actual ec2 pricing though that's
actually in a javascript file with a
JSON p callback that has like 15,000
levels of nesting so I scrap that entire
thing once i finally got to download it
but what you can see here is it does
type HTTP and the reason is how many you
guys are using Korres some some of you
guys it's generally pretty horrible as
far as developing with it and often
makes me cry sometimes been will
console' me sometimes he tells me not to
use course so what I needed to do is I
could normally just fetch this file with
JavaScript or on the server side or
whatever but I need to be able to fetch
this arbitrary JavaScript file via
reagent on some other domain it doesn't
have coors headers so I'm pretty much
boned in this case I was able to put an
HTTP at pass through an API gateway so
it will do the fetch for me on the quote
unquote server side add the course
headers I need and give me back what I
have problem solved so that's phase one
fetching data we have lambda function
defection data HTTP proxy if you will
via API gateway to festive data and we
have some fancy-looking endpoints but
like I said this may be
ten percent of business use cases
without being authenticated so what we
really wanted to do is give you guys a
working example of how to wire together
reagent with lambda API gateway and
cognito and DynamoDB so that you guys
can have a user system the first thing
I'll point out is you don't have to use
DynamoDB we're just using it because
it's way easier and there's a JavaScript
client for it there's not really a great
way to work with RDS unless you're I
have never ever tried to do that node
but and it's my closure codes pretty
weak so but you could very very easily
boot up a lambda function that's running
closure or close your script and have a
talk to your RDS instances if you've
configured your security groups properly
so we're using DynamoDB because it's
easy in this demo its hasty but don't
think RDS is out of the question so when
I have my sign up here I can just put in
some random information and that's
supposed to be constitute 99 so I have
no idea how many times I've done this
before testing and it's a little bit
slow because it's running through my
phone's internet create an entry and
dynamo DB which we can go see very
quickly this look yeah there we go 99
something like that so this is what we
just inserted into DynamoDB I sent a
request via the CL JSA Jack's to API
gateway who invoked a lambda function on
my behalf that lambda function in
contacts cognito to get an identity and
then inserts that into the database this
password is I ran it through be Crips
because that's what I'm told you're
supposed to do and i figured i would at
least be able to look you in the face
and say I pretended to make it secure
but one of the caveat so I ran into and
this an aside that you all may run into
is when you are in use if you're using
node for instance because you need the
lower latency boot times on your lambda
functions you can't have any node
libraries that have to be compiled i'm
certainly not aware of a way to get them
compiled on to whatever machines are
actually running on so my first bcrypt
wrote out a couple of object files and i
deploy that and the error message I got
back was bad elf and I assume that
something to do with Christmas but I
really had no idea
so I switch to a JavaScript only
implementation got it up and running
worked fine so I'm going to hop over to
sign in which I've got over here all
kinds of crazy fun stuff in here and
clear that out so we're the first part
that makes sense it's an authenticated
screen I'm just capturing some data I'm
running some code there's a couple of
pitfalls you may run into but now i'm
going to go ahead and sign in where it
really gets kind of useful this will
take a second again too because it's
going through here you can see it ran
through api gateway and i have this
giant token sitting up here which is my
open ID to token so i have has anyone
here use cognito know maybe you want one
guy for javascript or mobile apps
nothing okay mobile ads that's what I
figured so most of the stack if you
looks like looks like you're making a
mobile app dude what are you doing here
talking about web pages and that's
mostly because it is shaped almost
exactly like a mobile app and you're
downloading it and then just trying you
don't want servers right so you everyone
using your program probably has a
computer at home and you don't have to
pay for them to use their computer so
that puts us in the position where we
want to try and offload as much of our
logic into the actual application as we
can and Amazon's JavaScript API client
is actually really fantastic I've got a
couple of examples up here to show you
so when I create a new Adam amazon
DynamoDB object I can call get item I'm
gonna get an error when I do this
because a it's an arbitrary table
there's two things about the error i
want to point out to you guys so i get
bad request awesome hey the table
doesn't exist but if we look down here i
have my Cognito serverless author oh
blah blah blah is not perform it's not
able to perform this action so what I've
done is I've insert a record into
DynamoDB I sink that record with cognita
which gives me a fancy cognito ID then I
can make a call to lambda which has the
longest function name I've ever seen
which is get developer token for open ID
2 and a bunch of other words and that
gives me this token over here and that
token I can use in the JavaScript app
itself to begin to request
so I can I don't have to have the server
at all I can talk right to dynamo DB or
in my hand movement right to dynamo DB
right in javascript i mean i'm literally
doing it in the console on some random
s3 bucket and if i had great the proper
i am rolls cognito has what i like to
call super powers in I am so you get
this fancy Arne if you will and you can
do all kinds of fun wild cards and
splats inside of your I am policy so you
can say I am users sorry cognito users
may be able to write to this dynamo DB
table but when they do that they're only
allowed to access keys that start with
their user role or their user ID that
comes in through here and the only way
they can get that user ID is by logging
in through the Amazons credentials and
running that lambda function to get you
the token first but that lets you build
all kinds of applications without ever
ever ever touching a server and you have
all of the authentication you need you
can do the same thing for s3 where you
can prefix buckets or keys inside of
buckets to access them access them
entirely in JavaScript I can tell you
it's kind of a pain in the neck to pull
down PDFs via Ajax and that type of
thing but it's not the end of the world
you can also do let's say that you have
a closure function for instance that a
takes a long time to run and be it only
does things for users who are
authenticated you can say only cognito
authenticated users can run this lambda
function you don't even have to hook it
up to API gateway hey there's a closure
script library which is great for
invoking lambda functions and be there
we can just run a via the amazon client
if we so chose without having to touch
any sort of servers whatsoever you
promised me you wouldn't be talking this
past yes that's true I lied though i was
tricking him so i'm gonna hop in at
cognito for a second just to kind of
show you guys what is happening in the
system as I walk through so I can see
I've created ten identities this month
this guy my identity browser I can see
all of the people i'm using now they're
not keeping the password for me they're
not keeping my users email or anything
like that that's all stored right over
in here and DynamoDB i just use this I
private ID that they assigned to me
in order to link up these two systems so
that I can begin to use my roles to be
able to allow I by cognito I am people
to do whatever they need to without even
touching a server now you can see I've
got a couple of these guys in here you
can it's very very well fleshed out
kagney know if you're using mobile
phones and documentation is excellent
the JavaScript documentation is so bad
that I was telling Ben I was thankful
that the first time I ran into a problem
that I remembered the stack overflow
google search I did to actually find the
right documentation that or go to our
repo unfortunately it's well not
unfortunately and fortunately for you
guys so on close your script so it
should be pretty easy to parse through
and I'd rather see than that that's
certainly then raw JavaScript so last
piece I'm going to happen to lambda and
talk a little bit about that so one of
the two things about both lambda an API
gateway if you're pretty familiar with
the Amazon console when you go to do an
ec2 instance there's like maybe six
buttons you can click launch the thing
and then get out use SSH do whatever you
need to do it's not a whole lot of
tuning or tweaking or any kind of
interaction and that's pretty much the
same for a lot of amazon services if you
need any kind of Advanced Mode toggling
you have to use their CLI clients or
whatever to or their API to be able to
do what you want in lambda and API
gateway they have what are essentially
woodsy wigs for getting you started
because their API exists but their
clients suck in fact there is no client
published by amazon for api gay way yet
which seems almost psychotic for them
seeing as what they're trying to do
however i was able to find on the deep
dark corners of the interwebs on amazon
labs github profile a prototype client
that will allow me to do some work the
saga bus is why we don't work for him so
yeah right I'm sure they would not let
me tell you that so let's pop over into
some code I want to show you some
deployment stuff and then I'm going to
hand this back off the bend we can take
questions so in my API repo here my API
folder I have in here I don't really
have much in here but bin and this is
the AWS import so they have both a jar
file that acts as the client in a jar
file that acts as the importer how many
you guys have you swagger so okay
excellent so everyone's pretty familiar
ish with swagger I had no idea what
swagger was until I had heard of it but
I mean I just assume people were talking
about me and then I found their swagger
import and I was like well what swagger
let me figure this out is if there's one
thing that been taught me by repeatedly
bashing me over the head was automate
everything so my deploy scripts are
pretty straightforward I just have a
bunch of batch scripts I can run bin
deploy and it'll automatically sync up
this pretty heinous looking llamo file
and create everything I need inside of
API gateway but if you look at this
there are a couple of nice things about
it one if you're handing let's say that
you're building your services you have
sort of a dev team who's working on your
actual lambda functions or code or
whatever you're actually having them do
that's important and hard to do and then
you have a front end team that's going
to consume them if you're linking them
via API gateway you can run this the
swagger editor and say go look at the
documentation yourself I don't have to
tell you how this works and the
documentation that comes out of it's
actually really fantastic Ben will be
the first person to tell you I won't
write docs unless I have a tool to write
them for me so swinging down here a
little bit I was trying to find this
section here so you can see this is the
fancy x amazon api gateway integration
that is extended onto swagger in this
case the type of integrations AWS this
is the very very very long arn for
invoking functions via API invoking
lambda functions via API gateway it's
one of the downsides to this file you
can see here is also smattered with
korres headers everywhere match at the
moment the nature of the beast but it
does allow me to actually write all of
my API gateway in lambda or sorry in a
text file and then deploy it which means
I can automate that process I can have
check-ins and tests and so on and so
forth around that process without
clicking all of the buttons in API
gateways interface this really fancy
thing up here essentially is entirely
there just to add options checks because
you know pre flights the best and
they're in the actual interface there's
literally a button that you click it's
like you want to turn on course
for this we're gonna make all these
changes for you so again I don't not
quite sure why they've moved away from
the ability to automate things into more
of a fans I mean it's just a fancy
angular app which doesn't even always
work on Chrome FYI sometimes you have to
use safari and this is it so I've got
bass grip that goes through parses this
whole file uploads it and that goes from
there hopping into the other couple of
things talking about deployment I have
never shipped a production closure
script app so first thing I should tell
you when you look at how I'm shipping
the reagent application is be
embarrassed for me so pretty much I just
compile I run see I'll just build once
and then I just use the s3 command to
ship a bunch of things into an s3 bucket
and make sure everyone can read them
it's pretty straightforward and it works
ok I have found a lot of success though
writing my deployment scripts in bash I
may be writing them in something like
Ruby or closure in library form but it
ultimately gets invoked in bash and I
every system that I've tried to
integrate with for the most part runs
bash so hopping back out of this talking
about deployments we also have this
fancy pricing thing so when I first
started making closure script on know to
run lambda I had no idea that there's a
really really awesome clj s lambda line
again plugin so I didn't use it and I
did this team hard way and you can see
I've got even more bash scripts because
i'm doing a team hard way and this guy
is insane and actually using this to
deploy multiple functions spirals out of
control very very very quickly i'll show
you guys the code real quick just you
guys can get an idea of how simple it is
though this closure crypto is probably
pretty terrible but i'm using requesting
cheerio because trying to run requests
in node using the HTTP always makes me
sad but the general gist of it is grab
the document grab the stuff out of it
send it off to this handler the
documentation around lambda and
integrating with it's pretty pretty good
compared to api gateway or cognito well
caminos pretty crap but this gets much
much easier if we let somebody do most
of the work for us so when I hop into
SSO which is the thing handling our
registration and token generation you
can see I've got a project
clj I have clearly forgotten to push on
here for some reason or didn't work or
something I have a bunch coat in here
which connects to DynamoDB grabs my
Cognito identity so on and so forth so
this is a little bit more heavy-handed
right now I've been using the main
function and running node to test these
things you can see very very sexy very
very robust testing solution down here
but the nice part about this is a it
handles the node module creation for you
automatically by using export and it has
a bunch of very handy wrapper so I have
wrapped lambda function which I can use
so i can send my everything when you're
running enclosure script to note is
asynchronous so it does a very good job
of trying to make sure you're not 45
callbacks in before your response needs
to happen the other nice thing about it
is one of the I think the key driver
behind landa from Amazon's point of view
is a synchronicity so like just
fire-and-forget and something will
happen later or you'll generate an s3
item which can kick off another lambda
function and notify you through web
sockets or however you want to architect
it but i'm lazy and i'm used to the
normal computing paradigm so i just made
these things return for me immediately
especially because it's way harder to
show you guys a demo otherwise so
usually what you would want to when
we're talking about this obviously when
my end user is clicking sign in I need I
need that function to return so I've
structured it in a way that to do that
however what I should probably do next
is call this send email lambda function
which can return immediately and then
have it connected SES and send me an
email and do all that kind of fun stuff
and the same thing for every s letter
something that amazon has you can wire
them all in here or you can wire them
into api gateway i mean the
possibilities are literally almost
endless so if you want to build an
application where send you the email in
the browser by connecting to api gateway
which triggers an SES email you can
although if i download it i'm going to
write a Chrome extension to stop it from
sending me an email I think that pretty
much wraps us up through here I would go
into the prez no region app but you guys
are welcome to do that in private have a
good laugh at this point I'm going to
hand it back over to bed
now i'm confused
here we are
as a
alright so how many slides do I need to
skip now to get us out soon okay I'm
going to sort of skip to the end go
ahead our original target for this was
single page region application hosted
entirely in s3 but once we once we get
into things there are a number of other
obvious targets for this type of this
type of architecture in frequently
called micro services seem pretty
obvious something only gets hit two
times a minute why are you paying for
the rest of the minute services with
limited usage patterns a lot of our
clients were eight to five and that's it
off loadable CPU intensive computation
so currently the CPU is scaled by the
amount of memory that you give to lambda
function but I'm told that that will
change you'll be able to scale the
memory and CPU independently so you're
still limited at 60 seconds yes but you
know that could be useful because you
can run it as many times as you need
scalability is not really an option not
really something you have to mess with
except for each individual lambda
function has its own constraints and
then for unpredictable loads of also be
would also be a fairly good solution so
the advantages of this beginning back to
the sort of architectural side are going
to seem really familiar each function is
simple because you don't really worry
about this scalability and distributed
nature of it you have a lot of power at
your disposal and the power grows as you
need it to without really you
interfering at all and one of the things
as far as lambda goes is there's no auto
scaling or anything like that Amazon
handles enough this thing's on the
Amazon handles pretty much all of that
for you right so you don't worry about
auto scaling you don't worry about load
balancers if you have 15 million lambda
requests you're going to end up paying
you know 15 times three dollars or fifty
cents and that's it he'll just work it
that's one of those things we haven't
tested the upper limit on but that's
what the interesting documentation says
we've never had a problem with it it's
never like even flinched and the ability
to abstract away all these things into
lambda functions gives us a certain
amount of focus simplicity power and
focus should sound really familiar to
you and as these are some of the like
values that are near enclosure itself so
not fully baked you've been warned and
your mileage may vary but this is a new
Lance a new landscape it's sort of an
initial flag down in what I expect to be
sort of a broader trends like not too
many years ago we didn't have on demand
servers and virtualization and
infrastructure as a service now we do
serverless microservices weren't
possible a year ago you easily possible
a year ago but but they are now so the
landscape is changing and it just kind
of requires us to to adapt to it so
hopefully at the end of it will be able
to focus more on the service functions
itself and that gives us more useful
resource usage and less resource waste
so if you have questions I can take a
few if you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>