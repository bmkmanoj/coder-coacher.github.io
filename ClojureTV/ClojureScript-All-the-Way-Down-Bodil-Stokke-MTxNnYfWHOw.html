<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>ClojureScript All the Way Down - Bodil Stokke | Coder Coacher - Coaching Coders</title><meta content="ClojureScript All the Way Down - Bodil Stokke - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/ClojureTV/">ClojureTV</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>ClojureScript All the Way Down - Bodil Stokke</b></h2><h5 class="post__date">2013-01-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/MTxNnYfWHOw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right so a student already much
my name is Borneo this is my twitter
handle and now wants to do and my talk
was supposed to be called closure screen
on the way down but somebody earlier
complaining about overuse of memes at
this conference I understand interns
they're calling clojurescript all the
things right and the concept here is I'm
going to basically be writing an
application enclosure scraped a web
application with a server and a client
side with enclosure script and this is
all going to happen live on stage and
the rules of life kerning is that you
are going to help me guess I'm probably
going to run into typos and stupid
mistakes and I'm assuming the people in
this room are the most qualified people
in the one to help me out so if I find
that is the or Fania right okay let's
get started I'm going to give it a quick
overview I have some files preparing up
already
I'm not going to write everything like
the CSS you don't want if you don't want
to watch me do that and here's the
project file
yeah and I'm Freeman asked me if it's
called computer's night all the way
along because that's when it says on
that on the program but it's not and I'm
basically using a version of Heka there
are some Oheka ports to closure script
but we're all in produce Dumfries and i
need it on the server side when they're
snowed on
so I was lucky to find one port or
hiccup to clojurescript which actually
produces strings and that's what I'm
gonna be using it's gone hiccups because
you know znj is the NGI so the OJS
hiccup hiccups make sense and of course
I notice it's Connor boskie's talk
today's ago and decided to rewrite the
code to use his one framework or least a
little bit of it for on this is note
this is running on though Jas
so I used some node technologies to
power the backend Express the
traditional no in one framework I'm a
manga lady drama I'm going to be using
manga for the database and suckers I
over to the communication between client
and server so um lets us go on to the
server code I'm just going to enlarge
here so first of all closure script data
types are not compatible with the
JavaScript data types and while there is
a js2 cnj function in the closures group
core library there's the conspicuous
absence on the opposite so I'm as most
people have had to reemployment this so
I'm including hiccups and I written a
very lightweight Mongo wrapper Pablos to
script so let's just get started let's
let's just get a server going first of
all we start by requiring some Jade some
node stuff like the HTTP package and
Express and
and so can I have right now
nodes in Croatia script requires this
strange invocation to define the entry
points so we have a function main which
takes arcs which we just ignore and
let's just connect to the database right
away yeah so the application I'm I'm
going to be writing is to do list I
didn't know Rachel was gonna be doing
the same thing and basically I'm going
to make a checklist of programming
language theory concepts that I want to
learn so we're collecting to the
database PMT and it takes a callback
we're already and callback countess this
is basically JavaScript Interop so this
should connect to the database and then
call a function called server bring the
database right so I am going to use what
I like to call mock statement at just an
atom to to maintain my connection to the
database so let's put the connection
so this list basically starts a
reference to a table in the manga
database concepts and then let's create
the actual website and do that by
calling Express and we are going to wrap
the Express app in an HTTP server and it
let's see where we are yeah
a threatening micro we need to configure
this app to display our static files and
because static is the reserved keyword
in JavaScript and the closure compiler
refuses to let us have closure script
symbol is called static we're going to
do some trickery sorry we're going to
fetch the static property using a string
how to express and then call it with our
static file folder to define why we keep
our files and then we just define main
page and now the function get mean takes
the requests and the response should
just basically write something back on
the response so stand on hello and first
of all this should almost be running now
we need to tell me to start listening so
listen in 37 though sounds about right
so closure script oh great
what am I doing wrong when does that
even mean
now what's wrong with that
oh sorry sorry sorry it's a function
call
see I told you to watch out for this
enclosure script has to compile of
course and this brings me back to the
housing day so C++ I must say there we
go so let's just I'm going to run
because my editor hasn't properly
integrated we're actually running node
applications so I'm just gonna use our
transcript for that that's just gonna
watch my main the J's file not the
closures critical points too and so we
should be able to actually see something
happening yeah right oh but let's get
fancy page template let's just make a
function of actually render some HTML
and combat so first of all let's just
check that that's working by wrapping
hello saying that into a Honda tank
compiling compiling the second is
especially slow compiling because I need
to concatenate it's I'm using simple
optimizations wow I haven't met I mean
of course we need so cause cool hiccup
HTML and then just
let's get that recompile yeah I'm just
gonna carry on wrong wait for them so
here we go
that's extra man but um let's get one
fully involved
I made some monthly boiler plates I'm
just gonna come an hour so get IR until
I mean it and recombine that and then
get over to the client side now what way
you should be getting here soon is yeah
we're see it's it's changed corner so
the CSS must be working and it should be
loading and running a closure script so
just quick check to see that it works
this one should component of faster yeah
and it works alright so let's get
started on this so let's just get web
fully up and running we define Adam
which is an awesome which starts out
being it we define some state which is
another atom which is just gonna be
enhancer list I'm going to put my my
documents in here as we go
my dearest and grace and we call deft on
to make one fully aware on what don't
want them to me and
we make a function to update the dump
and a function to run down like that
just roughing everything in a Dukas I
didn't seem to work on ways and then
right now I'm only using a very small
part of one foo so this I have to
automate the process myself to get us
started so I didn't mention the use
statements on top here I'm reusing UCM
jjs because you knew that everywhere I
written a very very lightweight dumb
library which phone thing has a dumb
rayleigh function which takes a callback
which is cool when the dom has loon it
and there's web Bui
so when we have already done we should
just call update them this should
hopefully give us a hand I ran them all
up by my food we're guessing that just
something isn't quite right let's just
add something that
yeah Alex better okay so now let us just
add some states for now go to you and we
are going to hammer for a pretty cool
done which is a boolean let's just try
and render that let's make a function
which takes a document of the kind that
we have on top and returns span list
item give it a class if it's done then
it should be done otherwise it should be
open
see wait that and a span close tech with
a data ID item ID this is added by
MongoDB later we're just going to use it
to refer back to this and the content if
done done then we have a nice I'm sorry
a nice little UTF glyph for the check
box and here's the glyph for the box
without the check and finally a span
which contains the actual text like that
because nothing happens cuz I didn't
have to you actually
have an ru and then quite simply we just
remember my state Adam we won't we go
there we are we're just basically mapped
the contents of the state Adam over the
concept item function imagine give us a
pre-populated list when they go to yeah
right so nothing fancy so far but that's
let's get the database in bulbs and
let's hook up so could I oh and see if
we can get something interesting going
first of all I'm just gonna add an input
field type text and then we need to
connect this up cats deaf sockets
this doesn't need to be an Adam this is
just JavaScript connects jeaious / io
back to you the Surma
on localhost yeah show me again so far
back to the server site you notice it
won't blank now that's because it's
trying to you suck at i/o at the top of
the script and it's not learning so here
we go
but it's still not gonna work us we need
to actually initialize so clear so just
escape from screen from it let's just
finish nice that we turn sake tired to
install on our HTTP server object and
int that I get to use my duck - notation
uh-huh notice is correct in fact
yeah yes we are going to fetch
I had a socket this would interest it
will worry I heard a socket start on
saying this is right so accordingly on
methods on the connection amendment
so every time a WebSocket connects to
the server now this function is going to
be called when the socket objects and
what we want to do is we are going to
send the contents of the database to a
socket when he connects so let's make a
send Doc's function that does that seem
to be coming that one that with the
Phil hang Hager box disease so the main
isn't coughing uh well why we ascend ox
takes a socket and we're going to call
Mongo I'm gonna find all the the Print
Screen key is right next to my my Alt
key on the keyboard it's so stupid so it
takes the collection we want to run the
query on it takes a query object and
it's just gonna be an empty map because
we want everything and then it takes the
callback which shouldn't just be it
takes
there is stumped and we just call a meet
on the socket which which sends an event
of it to the client it's going to the
corn ducks and we need to convert that
object to JavaScript before we try
sending it I'm not sure mate that should
send this event to the client with all
the data we need to surrender so back to
the client and that's doing that do that
so we have a circuits object or an D
here
so we should be able to just analyst now
ducks and a callback on all new ducks
and we are going to create a function
for that looks come with them back
before JavaScript Interop not to bother
at all and then put the new state in our
state Adam and turn web hurry to
re-render itself and I should admit this
shouldn't unless I'm very much mistaken
it should now render of the contents of
the database yeah
notice I'll go to just vanish yes let's
run that again let's pay attention to
the go to that there for a split second
so what happens is that it first renders
the contents on the state Adam as
initialization time and then it gets an
event from the server which contains
nothing so this is why I can just fine
let's just take that out so um we want
to stop populating the database so let
us get back to that input field now
another function I have in my little Dom
library is a function called watch which
listens to the moments and it takes the
event name it takes a CSS selector I've
had to hack this a bit occurs at at
initialization time the dome is empty
web who has yet to render it and it runs
it asynchronously apparently so I can't
just attach events to to amendments that
already exists so I'm attaching them to
the document and then using CSS related
to filter method like jQuery this
I'll just get back to you what we're
doing is so no sorry I'm new on submit
it's a good name frame so I wants a
function called on submit to be called
when the form is submitted
it takes an event and since this is a
form submit they want to make sure that
it doesn't just drain out the page so
this is just standard dump and then we
need to find the input elements Q is
another dumb function which just as you
probably can guess finds a Dom element
using like time now the value of that
input field should be stoned the nash's
intentional once again right and I want
this to work in such a way that when I
enter something in the input field press
return there's something when foo
doesn't support by the way I hope that's
coming which is the reason by the way
why I'm not using or willfully so when I
press return I want I want the field to
be cleared and the previous contents to
be sent to the server so so we set the
value to m2 strength and we're missing
an event like that with a previous value
so the server doesn't implement this yet
but I'm just gonna test that and looks
right
yeah bruh Santa Anna vanishes and
presumably they went to string it but
nothing on the server response to it yet
let's do that so whenever a WebSocket is
instantiated on the server we want to
listen to events as well it works the
same way as on clients we have a new
human wasn't that like on it yeah that
is quite correct
so um new doc socket sorry it started
sorry um I need to include the socket
object in the call and it's also going
to be call with the data that is being
sent from the event so what this does is
call a function on you doc just take the
sockets and some data this is just gonna
be the string that we sent the value
string from the client let's just put
that right into the database take the
collection once again and it takes a
document so let's construct that
document its name as you recall that
should be the data and Donna should
default to false and it takes a callback
which is just gonna meet to call send
Docs on the socket which basically
performs same operation on the database
and there's a query on the new contents
of the database and since they're back
so the client will automatically update
itself once the change is done save that
at this point once that decides to
compile there we go
we should be able to start adding things
to our checklist so monads everybody
needs to remind ass right I actually
learned that yesterday ammonal is like a
strain metaphor and come on ants you
know like jQuery right now cuz there's a
huge debate jQuery people wonder
wondering if jQuery counts as a man
happen it does not but there's this
theory that it might be a good minute
there is not an excuse is not using
jQuery though okay and moving on Saigo
mr. more thick pre-pro more yes Wow but
then ads when in that
there's an error message I wonder if I
should problem that's trying out just
gonna cop it that you think alright
okay well it's an interesting subject
should be done twice right so um that is
a real thing in a scam that is actually
asked of comedy don't worry if you don't
get it who gets it later when they don't
warn you evaluates it and one final
thing we're going to be really ambitious
here and go beyond the final frontier
whatever Oleg was talking about mr.
Angley I want to understand of that
right so we're not populated our
database now I want to be able to click
the checkbox to indicate that I learned
because I do look I do know monads only
slightly so that's an a click handler on
span dot check curse the checkbox is in
a span with a close to check so every
checkbox now should have this handler
uncheck gets an event and we want to get
the ID oh wait a minute I have a
function for target which gets the
targets elements of an event and a
function called data which takes these
parentheses and a balance right there
yeah and yeah and the data function
takes an element and a data attribute
name and returns the content of that
remember earlier I put a data ID
attribute on the check span
so I'm going to know by looking at this
what kind of elements will kind of list
item I clicked right and that should be
fairly simple since we already know the
idea we just omit an event on this
account check and the ID back to the
sama we need to listen for that payment
check ain't that time I want blank so on
check let's check all that on check and
that will take the socket and the ID
that we sent over so let's call Mongo
again once again with the collection and
this just takes an ID as a second
argument to indicate we want to update a
single document and it takes a function
a kind of mutator function where she
gets the the doc in question and should
just return the modified document sir
athos doc done and the inverse of dumb
property so that should just just flip
it between two informs and it also takes
a callback which is once again and
sockets that should in fact be it
Wow
unbalanced parentheses that's quite
correct ah this one's right and now a
sham again these parentheses when we so
much read it but wonder if if they were
they were kind of races so Java people
keep telling me at least right let's
save that wax let's try and check out
the moment oh wow that was painless come
and it totals excellent let's just leave
them unchecked I also know jQuery so
good one more thing I mean for one thing
I want to say remember duplicate here so
let's create a delete function in our
lasts a couple of minutes that should be
fairly straightforward I'm just gonna
copy this ban give it a class delete
keep the day so I did for clicking and
this doesn't need oh my god I'm just
gonna make that an accent like that
so span deletes on delete and this is
very straight for one I just copy this
undelete sensor delete and does exactly
the same thing it fetches the base irony
and and emits in event with the ID so
Emma site listen
and we need a function that goes to the
database soccer's ID and this one is
called delete ID would you imagine take
the same parameters and les doesn't in a
mutator function obviously so just a
call back by shall impact it huh
cuz I knew thank you still compiled
Stowe I'm really gonna fix this okay
reload
now let's string it Rinna want one of
the pre promote business and it's by the
way quite simply if you're wondering
what that means it's just a pre-prom
office and that's also that's both Saiga
more you can hear some offing at the
same time crazy the problem there right
so in that elites and I mean there's
ambition and then that's just hubris
so first admit when how are we going to
understand our neck so Matt was in fact
it that's that's a pure closures group
application um back story by the way
catnip the editor that I'm in using its
acronym closure editor with a server
side closure component and a clone site
that runs in the browser and as
strangely if David Nolan ask me that's
written in closure script of but right
and I had to I mean if I felt like
kicking a puppy I had so I mean it's
actually recently CoffeeScript
to atone I decided that I mean this this
talk has been done before as a service I
closure thing so I decided to atone by
doing everything everything in closures
group for a change
so that's closures group running on
nodes on the server communication using
socket IO I want to be is great except
it's not imported to Croatia screaming
yet and let's see
yeah the MongoDB driver and that's also
node so there's a lots of intro as you
noticed and if I have I have two wishes
I'm going to play the the Chris Granger
game here and I have two wishes for
foreclosure scripts for one thing why
you know in core CL j2j seriously and
even better of course would be if if
there was transparent intro so that when
when you call out to JavaScript maps and
arrays and things like that might
perhaps be just come at it for you that
would have been nice also can the
closure compiler police run faster right
that's it for me
looks like we have plenty of time for
questions if there should be any there
usually aren't
in manipulating the Dom that is the
problem because you notice I'm going to
show you my Dom lime ring every closure
script project usually has something
like this it might just include JQ or
domina or one of the money what's what's
the entire version on foreclosures
record I'm focused right so so people
people have been writing Dom libraries
the foreclosures frame but they all know
of course involve calling out to the Dom
or calling the Dom through Google
closure which is usually safer and the
dome is gonna be mutable anyway the guy
who's sitting in front of you and that's
done a nice job working around that for
you know make making making this nice
that foreclosure screen when the memory
now I just assumed that Yemen in
implementing the features you needed for
your talk so I'm assuming it's gonna
come and I was too stressed out the day
before yesterday to implement in my son
for sorry right
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>