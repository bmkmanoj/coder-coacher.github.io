<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Audyx.com 40k locs to build the first web-based sonogram - Asher Coren | Coder Coacher - Coaching Coders</title><meta content="Audyx.com 40k locs to build the first web-based sonogram - Asher Coren - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/ClojureTV/">ClojureTV</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Audyx.com 40k locs to build the first web-based sonogram - Asher Coren</b></h2><h5 class="post__date">2016-12-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/K6ZoF3CHsa0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">my name is Asha Cohen I working for
audax small start-up company in as well
I'm going to talk today about how we not
excused clojurescript to develop the
first web-based audiometer i sent my
slides on the slack of closure and you
can also scan the QR code if you want to
follow along so about myself yes so I
was born to english-speaking British
speaking parents I grew up in Hebrew
environment in Israel and I spent 38 in
Philadelphia so I can't even pronounce
my name correctly in English but I try
as much as well as i can to speak slowly
and clearly i hope it works so audax as
i said is a small start-up in Israel was
founded on the winter of 2014 I joined a
few months later I was a third developed
on the team and that was already after
the previous vpr and he had decided that
closure will be sorry audax would be
built using clojurescript it was a big
surprise for me everything I knew about
web development was JavaScript I took me
a long time to agree with that that now
I love clojurescript and I hope that by
the end of this presentation you as well
will agree that the next web app you
ever build shall be enclosure script and
audio matters so what is an audio matter
basically it's a piece of hardware you
connect different kinds of change juices
to it and produce sounds in order to
measure the hearing of people this is
what they usually look like we are
Arctic's decided that it's about time
that audiology moves into the 21st
century so using a simple Chrome browser
and a regular PC this is what our ideal
media looks like let's show is short
example of this to show what we're
talking about so this is audax as you
can see we have over here a sonogram
over here which is a visualization of
sound so you can see now I'm talking so
different frequencies you can see on the
left
frequencies and the different colors are
the different volumes sound level if
I'll be quiet for a moment so now you
can only see the background noise it in
this room in audax we can do some
hearing tests for example other than a
what we call pure tone hearing tests
although it's not really actually pure
tone you'll hear in a minute oh maybe
you won't hear any minute maybe the
volume is too low that's right okay see
we play sounds we indicate whether or
not we had it the volume goes up and
down we can show if you want we'll be
complicated i could join the sonogram
what the sounds look like that's a very
good way of showing the patient who
comes what's he support is supposed to
hear the latest addition to our app is
what we call an ambience studio it's
very nice that you go to a hearing
specialist and he says okay I'll play
some sound let's see if you hear them do
you say no my problem isn't with the
sound is that when I go to a concert and
my baby starts crying I can't hear him
so he said okay I'll give you a demo of
what it is i'll take you to a concert
and after 5 seconds of the concert the
baby will start crying let me know if
you hear him start crying
okay if you say yes so you're probably
doing better if not you should probably
go to a hearing specialist okay none of
the introduction so the title of the
speak with talk was forty thousand lines
of code I owe you an apology I didn't
write the title we actually only have
thirty three thousand lines of code is
still a bit less than 40,000 and not all
of them are closer script as you see we
have some closure see and some closure
closure see is not closure over see it's
what we call we the conditionals if you
click on the link you will see it's a
way of writing closure code which could
be used in both closer and closer script
projects so if some of the code is not
attached to JavaScript you can write an
enclosure see and use it in all project
we have the closure code we have is
mostly hooks and plugins that work when
we compile our code with nine in game
and we want to do something before our
code actually gets compiled for example
audax is a multi-language app so we have
all of our strings in a CSV file but
closure can only read ed n objects so
before we compare our code we have a
hook that takes our CSV file and convert
it into an idiot object okay
so here are some of the challenges that
we faced when building audax and how
they became into advantages I don't
think I'll manage to touch all four but
we'll see fail compilation JavaScript
objects frameworks and dev tools but
before that the obvious advantage that
we have is that we're not using
javascript we don't have the butter
semicolon we don't have promises on
callbox now which doesn't equal to
undefined which doubles as an equal to
false telling the PNR code and there's
no this object if you've ever developed
with JavaScript you will know why we
want to avoid do you think you know what
advantages of closure and close your
script is closure so anything you have
enclosure you can use enclosure script
in your app so the first thing we had to
deal with the compilation before running
our code in the browser it has to be
compiled since browsers do not speak
closure squid the only script speak
JavaScript a few and the reason we want
to map out our code that web apps have a
very big drawback because the code that
we write gets downloaded to the users pc
to his browser so he can
reverse-engineer our code which which
sits on his browser see we would want to
compile it there will be less obvious to
him another thing is too many fine our
javascript code is 24 megabytes after
minified it becomes 3.1 it's much faster
to go to the users pc this way a code
optimization in general web apps do not
perform very well they're not supposed
to be the old time but in some cases
like the son of gummy store you want
things to be as light as possible see
one our code runs faster this is
actually done very well enclosures pit
since clojure is using google closure
which allows us better and faster
compilation so what's the biggest
problem
yes when compiling a thirty-two thousand
lines of code it takes almost four
minutes that's a long time to compile
our code so the first solution is
optimization not when using line engine
or seal just built the shield is built
to compile a closure script code we can
tell it not to do any optimization now
this of course loses all the benefits we
spoke about beforehand our code will not
be minified will be very easy to
understand which is why it's used for
development only that it's much faster
the initial compilation takes less than
two minutes every change we make in a
file will only call that file to be
compelled we also gain something called
figure which is an excellent library for
developing closure script I should pause
funny
so figure what field wheel gives us is
the following thing live code be loading
right so we're developing enclosure
script finding our code we made a change
in our code and we want the change to be
seen in our browser so typically will
have to leave a shower browser and if
it's a heavy application that will take
us quite a long time with fig wheel the
changes are up our code get injected
directly into the browser no need to
refresh the browser heads-up display so
I made a change in my code I save the
file and now I have to wait for it to
become tired so what figure gives you
once compilation is finished we'll show
you in the browser a nice round green
indicator telling you the compilation
was complete what's even better is that
if you made a mistake in your coat and
your compilation has evos or warnings
that will show up in your browser as
well you can even click that warning and
it will open your text editor in the
file or in the line of code that had the
issue another thing in another thing
Vicky I'll give those is a built-in
closer script weapon in which you can
interact with your code with your object
your valuables very easily ok to that
was problem number one the long time it
takes to compile second issue that
compilation is known as an ugly fire it
takes our meaningful code and turns it
into meaningless code we are not excuse
to code honey badger to detect
exceptions in our life app this is an
example to what an exception look like
ok line 2179 column 235 in our minified
code that will adjust anything about
what the problem is solution is macros
I'm sure you've all use macros enclosure
since some of the most used functions or
actually macros when we're not
which the sea for a second so when is
actually a macro hope you see on the top
so is when not the threading macro it's
also a macro if let the malco these are
all copied from the closure source code
code so many things we use enclosure
macros one famous macro is the dbg Matt
well what it does you put anywhere in
your code you give it an expression it
evaluates the expression prints it to
the console and returns it see if you
have a long line of code with just
multiple things and somewhere in the
middle something made a gig one we go
wrong you put a dbg and then you can see
what the what is evaluated in the middle
of the code okay and this is where we
get to our advanced compilation program
problem we had Alex wrote a macro code
they've try the idea is that when the
macro gets evaluated the functions still
have the original name so we save that
name surrounded function with a try
catch clause and in case of an exception
in the catch clause we have the original
name and we can do that whatever you
want here's a simple implementation so
we get a function named arguments
anybody and we what we return is regular
def n the function name and arguments
who have the body surrounded with a sure
i catch clause in the catch clause we
have s and name which is a valuable
containing our original name of function
in this case when we open our app has an
exception it was sent to honey badger
the original name of our function and
this net this way we can know exactly
where the ever occurred some more fun we
had at addicts with macros is log on
time for filing so in this def try
function we added an option if you are
in debugging mode
so every deaf drive function when it
finishes evaluating will print to the
browser console exactly how long it took
it to one this way if we see the
function that appears many too many
times or takes too long to man we can we
know what what to fix okay topic number
to JavaScript api's since we are working
with the web there are multiple api's
and objects that we would like to work
with problem is that if javascript so we
has promises it has that notation and if
the the new AP ice like we use an audix
they could have many changes along the
way solution is what we call javascript
wrappers we take the promises we turn
them into channels co a cig channels dot
notation returning to closure functions
api changes will now only need to be six
in one place and this may happen that we
built another thing that we use is
called variance there was a talk given
here in 2014 you can click on the link
and see what it was about let's see an
example over here so since we deal with
audio in the web we use the audio
context object which is part of the ATM
html5 web web audio interface so in
order to build and you are your context
we have to call this contract construct
which has a dot notation which you don't
like so I'll surround this with a
function and so now what if I want to
build an audio context object I just
call this audio convex function the
audit conduct has the function that
creates a buffer source once again again
the notation so as the value of a
function
that we seized the audio context and we
turned a buffer sauce from that function
setters and getters are even more
annoying especially when they are nested
so audit context has a gay node which
Privett which decides or which you can
use in order to determine how loud the
volume will be the gay node has a
parameter called gain which has another
parameter code value which tells us what
the value of the getting out is so you
want to get this we're surrounded with a
function let's just call it game
and here we have a simple function that
gets that gives us the value similar
thing we have the set instead of calling
a set on the value of the game of gay
node I'll define a function
okay and now it's talking about channels
so another thing the audio context has
if you have a source node which is used
to play audio you can give it a callback
function for the unending that gets
cooled once that audio finishes playing
but I didn't I don't really like
callback functions so I'll surround it
with a faction and then that receive the
source node what it does is defined a CO
icing channel and what it does then on
end it is very simple it will put on
this channel ended oh yes
call this one over here and okay so not
I want to assign any function to the
unending function I don't even have to
send my function over because I'll just
cool the one ended get the channel in my
code and do whatever I want in this case
now one very annoying function we have
is how we receive from the welder the
list of all connected audio devices okay
so we have a navigator which has a media
devices parameter which has an
enumerator devices function which has a
promise with a success and an error
function okay this is totally not the
closure way of doing things and I never
remember how to do it so I have it ready
over here so anyway the devices either a
function that we will write what did
that once again it creates a co a sink
channel it called the navigate and media
devices a new mobile devices and then in
case of a successful promise it will
divide on our channel okay and this data
which is the data returned from the new
movie devices in the case of an error it
will write on the same channel error and
this is where we go back to the variance
I took spoke about so we we all receive
in this channel a vector of to the first
one indicates the status okay however
the second one will be the data so i can
use the very well used match library in
order to see if i got an okay or an
error and deal of it appropriately okay
no I didn't mean to click the link so
another thing that we get with these
Rapids decoupling d kappa leg i don't
think you need the Wikipedia definition
but I put it anyway okay basically the
way I see it every part of the code is
responsible for what it's supposed to do
and nothing else so the audio context or
the web body that we do so before now
it's only how to deal with audio and I
think else our code and the Arctic side
no to do other things it doesn't know to
do anything with audio it just knows how
to cool the web or your namespace so if
we have our Web Audio clj guess that we
just saw before then addicts will have
some addicts audio namespace which isn't
in charge of calling web audio functions
and then in audits we can have multiple
through one foot two and four three
innings faces who are in charge of
calling the audix audio which knows how
to interact with Web Audio this way the
Web Audio itself is the only one who
knows what Howard your works if you
would ever want to change it go ahead
and change it if you want to write unit
tests to any of your code it doesn't
depend on anything from beforehand at
our dicks I'll show you this larger we
didn't do a very good job with the
coupling this image is the graph of our
dependencies build using a library code
here can't see any names let's see all
these dark lines you see our
dependencies between different name
species I can't even find any okay so
for example over here oh okay we have a
graph group and all kind of other groups
okay you can see way too many lines
going into both directions ideally
you'll have a few nodes at the edges and
the graph from the middle pointing out
towards there we're definitely not there
maybe one day in the future we could be
proud on our work okay topic number
three
frameworks so developing with web
building a large web app as mostly
developers developers know the two main
lab movies you can use one is a google
angularjs second one is the facebook
react j/s so when we started working on
Arctic's we were quite new to these
things so we said let's use what
everybody else is you else uses which is
angularjs we even found some interesting
libraries that are built for closure
script and angular but we the were few
issues on the way for example angularjs
expects everything to be as JavaScript
objects we enclosure script want
everything to be enclosure so what had
to call co je s to jes to see what
yesterday s over and over again which
was very annoying another thing was that
the angularjs when doing loop which
causes a change in the variables to be
rendered on the in the browser didn't
know how to handle the cool and sync go
loop so forever in our code we had the
go function which made any changes to
their variables on HTML we had to
manually call scope apply in order for
those changes to be seen on the ground
another thing is what I call service
reading angular is very rich library it
has almost everything from HTTP to
translations only thing is that you have
to catch these services in the beginning
of your code controlling the HTML if you
have a function 15 levels in he will
have to wear this service or the way to
fill that not really he's a closure way
where you just call a namespace function
whatever you want so we gave up angular
and moved on to react react actually has
two very very good framework for closure
script the one of them is Regent I've
never used it so I can't tell you how
good it is the second one is um okay
what on that it allows users to
represent the UI's simply as EDM because
closure skip data is immutable data um
can always rapidly be when the DUI from
that route ok so it's EDM so there's no
need for see the jes to jus to c 0 GS
again and it always napoli be vendors so
there's no need for scope apply you make
a change in your data and you see it in
the UI ok the good parts of a good part
first of all it was written by the one
and only David Nolan mr. clojurescript
as you say the UI represented as EDM
which makes the code much cleaner it's
immutable so when the link is very very
fast and once again goes back to the big
deal i believe is so beforehand since if
your code is will correctly how was it
a'n't and you're using fig wheel so if
you make a small change in your code you
will see it right away in the UI with
the changes okay there are some problems
with arm first of all since its we act
and not angular so it only web to the UI
anything else you want to use if H HTTP
or translations you have to use
different libraries some may say it's a
good thing because angular is very
dependent is very opinionated you have
to use everything it gives you whereas
in reacting an arm you can build your
own stuff use whichever you want arm is
very opinionated and the way that the
data is saved it expects you to have one
at Tom divided into multiple key values
and those have to be used as
representatives representatives of the
data in the UI if you make a bomb change
you will get a knock as I said whatever
okay another thing is the curses okay
they could become a real curse if you've
used your own beforehand you know they
have to be very careful who the way that
you manipulate your data
once you get used to it it's simple
enough but it does take some time and
the last thing is that I'm next the next
level of em which is supposed to fix
most of the problems with em cannot be
integrated with regular um so I'll in
addicts we have a hybrid of angular and
um well next to probably not be part of
this system
okay the fourth and last topic dev tools
so this is mostly web development not
only connected to closure script with
the development in general so a browser
gives the developer many good tools that
he can use when developing one of them
is a JavaScript console if you go to
your browser I'm sure you all know this
click in my case it's f12 it will open
up the developer tools and here we have
a console in which we can write stuff
yep yeah yeah yeah oh this is the one I
like no equals first which double equals
and it is true of us what yeah it's true
okay anyway so this is the user when you
develop JavaScript what happens when you
develop with closure sleep could you
still access your code the answer is yes
and I'll give you a short quick example
let's see which one is it here okay this
tool is called clips clips and online
closure script wepa written by my
previous VP oh and the unit and shelve
it what do you see here on the top left
is your closure script code on the top
right it's the compiled JavaScript code
the bottom left is the evaluated result
of your code another body might if you
print anything through the browser you
will see it in the bottom right so why
did I show you this because if I now
open the console you see here on the top
right that my a became CEO jsu lay that
means that if I go here to the console i
click co je s you hey here's my five
okay what if i take in more complex
object for example let's make a nest
map okay I'll run of this way to get
long yeah yeah oh yeah it's wrong much
better okay now i still have my a and if
i go here and my browser in the console
and print out the a so I have my iover
here but it's not really readable
because this is a persistent re map so
what I do to get I know I go to co je s
core clj to JavaScript and I'll give him
my hey Oh much better okay so have a
JavaScript object which has a which is
with the value 1 and B with the value
object we has the key see with the value
3 okay this may be fun with the total
waste of time since you can simply use
figlio for the youngest stuff no need to
convert from javascript code youtube fig
we all connect to your code so any
valuables in your code you can use ok
what does do the other them to do we
have debugging ok and an audix we use a
library called co je s dev tools and
what it allows you to debug your code
directly in the browser so i'll show you
an example i'll open audax again this
won't work because it's compiled yeah
let's see fav it over here
okay the basic idea is that you can put
big points anyway in your code and even
though its closure script code the
browser will still know to stop where
you put the break point so I have over
here my coder script code in the browser
and I'll open a file let's say
control that's one so when I want it
okay this is my closer script code and I
can find anywhere in the code and put a
breakpoint i want sum of i know i'll get
to it's called out here and assuming
everything all words i'm not sure sure
no okay but if it would work well so the
grounder would notice stop where I put
the breakpoint so even though i'm
developing enclosure script and the
browser only speaks javascript so using
the devtools library on using the no
optimization compilation the browser
will know to stop in my coder script
code and even show me the values of my
variables as closure script okay so
debugging source code breakpoints and
you can watch the valuables see what the
value of what the values are local
storage okay another thing that the
browser gives us is local storage which
is a small very small storage in the
welder that you can use for persistent
data do you want to save okay you can
open the browser and go over here to
application and on the left you have
your local storage and you can see
different variables that you save so in
art excuse it for a few things for
example we may have a user and audax
user who has different audiometric
centers in different places when he
loves in to the computer based in that
place we want the computer or audax to
remember what center he's in so we
simply saved the ID of that Center in
the local storage and whenever he opens
the app whenever he opens Alex it will
take him to the correct center another
nice thing is that it's instant you
change the value and it changes ok I'll
see you a cute example of this if we go
back to my pure tone test as you
remember I told you it's not really p or
tone but the truth is that in order to
produce such a sound with the
Audio API there's a function that gets
received two variables and those two
variables or what define if our sound
will be pure or not let's see if I find
them over here in our local storage okay
now if you either become an audix user
don't play around these things okay they
may make your code not run correctly but
since we're here in a demo and it's all
in client side you will never harm the
server side you doing this so I'll allow
myself to show you this sense this game
that's audio tour no no test test I
can't believe it where is it gone to
okay the meantime you can think of
questions equipment i'll be finished
this i'll be done so let's see would be
so fun I do
here it is okay so i have two variables
here one is the peak deviation
percentage which means how far away from
the pure tone do i go so far changes 520
we should hear a pure tone p good let's
take it back or even high up to 10 the
second one is a frequency how often does
it go away from the center to fight for
this one high up okay we get a laser gun
okay so this is what we can do with the
local storage of the browser as I said
it's not connected corrected for only
two closer clip in any web app you can
do this I've anything interesting left
let's see no I think that's it okay so
any questions clojurescript web
development audiology yes
yeah well so it's not just good when you
debug your own code but we were talking
about when our live app reduces errors
now this could be maybe not the newest
code that the users running if we are
have advanced and he's for somehow some
reason with using later code what are
the source maps themselves I don't know
how easy it is to find yourself I've
never tried truth is I've never tried it
it's specific like style that shows the
maps sanction the function
okay okay i think i showed f2i you more
fun maybe that's the main reason with
that macros is not fun at the beginning
when you start working with them their
syntax is very complicated once you get
around we did some awesome stuff of
macros anything else okay thank you very
much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>