<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Lighting Talk -  A few tips for writing macros - Jeff Terrell | Coder Coacher - Coaching Coders</title><meta content="Lighting Talk -  A few tips for writing macros - Jeff Terrell - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/ClojureTV/">ClojureTV</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Lighting Talk -  A few tips for writing macros - Jeff Terrell</b></h2><h5 class="post__date">2017-10-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/VJEHtFNKSu8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right thanks Alex where's in
suspense the whole time like am i next
to my next I don't know all right here
we are after riding a wave of adrenaline
okay
name's Jeff Terrell I am an ass after
craftsman at role model software in
Holly Springs North Carolina very near
cognate act headquarters and I'm going
to be talking about writing macros and
how to do that safely macros are
powerful tools but you can kind of hurt
yourself if you're not careful so here
are a few tips for how to do them safely
you do have to know what a macro is
before you get anything out of this talk
sorry alright tip number one don't use a
macro unless you have two functions are
much simpler if you can use a function
use a function don't try to use
something fancy just stick with what's
what works and what's simple note that
functions are values macros are not so
for example you cannot return a macro
from a function you cannot pass a macro
to a function but there are some
legitimate use cases for macros and they
involve manipulating the evaluation to
some extent so here are some some common
use cases for macros conditional
evaluations such as what when or if does
multiple evaluation such as what for
does binding like let notice that the
names in the binding statements are not
evaluated normally accessing parameter
expressions before they are evaluated
such as what the threading macro does
and DSL since you control evaluation you
can also access the collars context but
don't do that maybe in some cases but
don't do that alright tip to include an
example expansion after the macro
because they're often easier to read
than the code themselves the code itself
users of your macro will thank you later
and include yourself you'll be glad you
did so for example if you have a numeric
if macro not caring so much about what
the body that macro is right now have a
comment afterwards it says this call
expense to this code it makes it a lot
easier to understand what's going on as
a bonus tip writing the expansion like
this in a comment first before you write
your macro makes it a lot easier to
right your macro tip 3 append expression
to each parameter of a macro the real
key distinction to keep in mind about
macros as opposed to functions is that
functions get parameter values after
they've been evaluated but macros get
them before evaluation in other words
macros get the expressions so having
that visible in the name of the
parameters of your macro really aids
clarity as you're writing the macro tip
for capture your assumptions this really
helps collars if they violate an
assumption to get a clear error message
note that you can assert about the input
expressions which means you'd have your
assert outside of the returned expansion
or you can sir assert about the values
after they've been evaluated in which
case the assert statement would be
inside the expansion and also tool spec
is great for this so good tool tip 5 use
the backtick operator this is called a
syntax quote operator and it's like
quote except that you can unquote inside
of it so it's really tailor-made for
this this kind of a use case where
you're generating some expression that
depends on some input value it's a
really convenient way to build an
expression tip 6 I mentioned earlier
that you can know your collars context
inside of a macro because your macro is
actually expanding into code and that
calling context and so it's important
because you're in that context that you
don't conflict with anything that the
caller is doing and of course anything
that the caller is doing is completely
outside of your control when you're
inside the macro so don't use a name
willy-nilly use a gen stemmed name which
is very unlikely to conflict with
anything that the that the caller is
using and note that if you're inside a
syntax quote context it's very
convenient to use the auto jinsim suffix
which is just a hash mark so that's a
good good way to do that
tip 7 avoid evaluating an argument
multiple times this is usually a source
of surprise to the caller now if you're
intentionally doing that and that's the
intended use case of your macro
obviously that would be an exception but
it's especially surprising if the one of
the input expressions contains a side
effect and that side effect happens
multiple times that might be a source of
great surprise to the caller so a good
rule of thumb is that each parameter
expression should appear in the
expansion exactly one time obviously
that can be violated but know what
you're doing tip eight macro expand 1 is
a great way to debug a macro because it
returns the expansion that you get back
I like to pass that to P print to see
what it's printing and lastly tip 9
build the expansion with helper
functions now if it's a really simple
macro you don't need to do this but if
your macro is doing any sophisticated
transformation of the input expressions
remember that those expressions are just
closure data structures it's just a list
usually with some embedded other data
structures in it perhaps so how do we
deal with data enclosure we use
functions right so you can totally do
that you can have separate you can have
multiple helper functions that you're
calling to build up your expression
maybe make multiple passes on the input
expressions it's really a lot easier to
decompose the the work that way note
that functions two can use the syntax
quote operator it's not restricted to
being inside of a macro context so
that's all I got in conclusion macros
are great tools but don't cut yourself
check out my employer we do custom
software for forward-thinking companies
or find me on Twitter and thank you for
your six minutes
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>