<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Simple AND Secure? - Joy Clark | Coder Coacher - Coaching Coders</title><meta content="Simple AND Secure? - Joy Clark - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/ClojureTV/">ClojureTV</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Simple AND Secure? - Joy Clark</b></h2><h5 class="post__date">2017-08-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/lRHPZXKQVLk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi everyone absolutely thrilled to be
here today I get to talk with you all
about two of my favorite topics
simplicity and security and just like a
cautionary there is code on some of my
slides one of the reasons is because
closure code is absolutely beautiful and
any other reason is because I wanted to
kind of show a concrete implementation
of how you implement these concepts and
I'm going to talk about in rings but if
you're hungry and you don't want to read
code then just ignore it
just kind of focus on the concepts
that's the main point I want to get
across when we talk about closure
applications often we talk about
simplicity and what I love about closure
the most is that the whole language was
designed with this concept of simplicity
that means that the bet is composed of
small little pieces which I can put
together and and then they make
something that is still simple that I
still can understand I can follow in
each step in the program exactly what
happens and I think a great example of
this is ring which is is the example I'm
going to use during this talk and ring
is an HTTP server abstraction which say
it which looks at HTTP and says HTTP is
a stateless protocol and it takes a
request and return some kind of response
that looks kind of like a function so
let's model it as a function so that's
what ring does ring is a as I said as a
server abstraction so we can define
requests as data as a map and we can
refine we can define responses as data
as a map and we just create a function
that follows the contract that has the
fields that we need for our application
and then as long as
we follow this contract we can plug it
into the adapter level the layer which
which performed like it does the
translation between the the contracts
and the server instance which is
underneath it and it will work um and
and we when we do this we notice that
there are a lot of patterns that repeat
themselves maybe every time we get a
response we want to or we want to set a
security header maybe every time we get
a request we want to add session
information and for this reason for this
pattern we can use middleware middleware
is just a function that takes another
function this handler that we've already
defined and executes and returns a new
new handler and new that it will take a
request and execute the request in in
the handler that we gave our middleware
but the trick by it is that I'm we can
modify our request before sending it to
our web application where you can modify
the response on the way out and
sometimes one of the main use of cases
for this is if we say if I get a request
front with that's a get request at the
slash resource then I want to go to this
handler if it's at another resource I
want to go to another handler and
because that is so necessary in a web
application there are libraries building
on top of this this kind of middleware
that provide us with routing through the
application where I just get what a good
some requests and I can route it to the
handler that I want it to be handled by
and then route the response back and
then once I have all these pieces they
all follow exactly the same contract and
so I can just put them all together and
engine and I really love this example
because it really is simple if we look
at this picture we can see every step in
my program where is my response going
what is what is happening with it each
of these components has exactly one job
and and if I need a component that does
five jobs I just compose the other five
together into one component using
functional composition and it retains
the simplicity and there's one question
where's the security
security as we know is not the same as
magical framework there are a lot of
magical frameworks in in the world you
know they do something crazy maybe
they're helping us secure application
maybe not and and in framework enclosure
I have the feeling it's kind of like a
bad word so we know we don't want a
magical framework we already know that
but if we look at this this example
we've put this application together and
the point I want to make here is that no
security is not the same as as magic
framework but it is also not the same as
no framework at all and because we have
this power to create the web
applications in exactly the web
specification that we want them to have
and we also have the responsibility to
add that last piece to our application
we need to understand what we're talking
about and we need to have this security
aspect to our application because we
have that we have to fit the application
a little bit together we have the
responsibility to take care of the
security aspect security is teamwork and
review we had to work together it helps
if we have we work in a team we do
reviews we see have to more than one
pair of eyes looking at a piece of
source code and there's some principles
about how to maintain to keep a secure
web application first of all we need to
maintain our application we need to make
sure we have the most up-to-date
dependencies make sure that there's that
we don't have any bugs in our
application if we get a bug or a bug
report we need to fix it we need to stay
informed about the different
vulnerabilities that exist and we can
register for security advisories we can
keep it simple which is one of the
things that I think is very enclosure we
do want to keep it simple that's one of
the points and so the nice thing about
it is is if we'd program web
applications it really is simple and we
really can see in our in our source code
what happens in which point
our application but then we also need to
to look and edit particularly from the
security aspect to make sure that
everything is there that needs to be
there that comes back to the point that
we need to know what we're doing we
can't just ship some secure framework
and say oh I have no idea about security
but someone told me that this framework
is secure so that's okay we are
responsible for our web application so
we need to understand the main security
vulnerabilities that are that are there
and what we can do to fix them and we
also need to monitor our application in
real time and see what's actually
happening with our application so that
we can if there is any vulnerabilities
then we can maybe recognize them faster
when it comes back to knowing what we
can do I always use the OWASP top 10
list and the 2017 version just came out
which really was exciting for me and
when it comes to security there's a lot
of vulnerabilities that we aren't not
necessarily we might if we're running on
it AWS and AWS has a security
vulnerability then there's not that much
I can do about it but as a developer all
of these things on this top 10 list are
things that I can hand that manage if I
can look at my application and think am
i vulnerable for injection in text am i
vulnerable for cross-site scripting
attacks just even if we think our
application is great everything is ok we
can just go back over the list and and
do a review of our code with these
aspects in mind so I just have a
friendly reminder for you to use SSL if
we aren't using SSL we're sending any
cookies authentication information in
clear-text through the internet and
you're basically just opening a door
wide for people to come and hack into
your application you can enable it in
your closure application itself or you
can run your application for time
and a reverse proxy the main point is
that use SSL that's what it's there for
with the let's encrypt it's easier than
ever to get a certificate and so we can
just turn it on the next vulnerability I
want to talk with you about is
cross-site scripting cross-site
scripting is a vulnerability that pops
up in the wild all the time this is an
example it's from McDonald's in January
6th of this year they discovered an XSS
vulnerability in the McDonald's site
which basically allowed you to read all
the passwords of users so what is
cross-site scripting cross-site
scripting is when we take user input and
we render it in our HTML page and if our
user was nice and never did anything
evil there wouldn't be a problem
the problem is that users are inherently
not nice or we shouldn't believe that
they're nice and we should believe that
they are going to try their best to
break into to do whatever they want to
do in our application so basically if
you take some user input from the user
and then render into your page you have
a Java Script tag in your page that
executes JavaScript and that allows an
attacker to do whatever they want this
is a this is a problem if we want to be
nice and when someone logs in and their
username and they give it their username
we want to say hi please log in again
and so we render their username in the
page but that makes us vulnerable for
cross-site scripting or it's also often
a problem in web forums where you make a
comment and if you're vulnerable for it
for cross-site scripting that comment
will be rendered on the forum page
whenever you open the website and then
they can so whoever visits the website
then descript will be running in the
background so as far as cross-site
scripting what can we do against it
first of all we can validate input
that's kind of the rule of thumb is
validate input and escape output so we
can validate input using closure spec or
bouncer and basically this is just a
rule that if I know what I want the user
to give me I can just make sure that
that's what he actually gives me
but sometimes like when when we're
dealing with user names we don't want to
create a really hardcore spec and say
you're only allowed to use ASCII
characters I mean we could do that but
everyone nowadays is using utf-8 they
can't spell their name maybe so and then
we have to think really hard about what
characters we want to allow them to use
in their username and so what we can do
in that case is that we say okay it's
just some string that is that will give
me for the username um but when I render
in my page I translate all of the evil
characters into the HTML equivalent so I
say instead of like the less-than and
greater-than signs I'm going to use the
ampersand LT semicolon and then it will
render in the browser it will look like
HTML but it will not be a script that is
executable um that's what we want to do
but we shouldn't do this ourselves and
we should use a library that that
doesn't skipping for us because there's
a lot of like edge cases that we don't
think about in the first the first time
there's like it's not just less-than and
greater-than signs there's other things
you need to consider so one of the
points I want to make is that we should
use an HTML template which has escaping
by default this is a case where in live
this is a case for Selmer hoplon is a
JavaScript library that I just just I
was just googling and good time to see
what templating libraries are actually
used in in closure the closure universe
if there's any ones that's missing from
this list please message me and I'll
look it up because it interests me one
of the points I want to make on this
slide is that hiccup only supports
escaping by default from 2.0 0 alpha 1
which was released this year in January
and so if you're using hiccups use the
alpha versions even though it's alpha
and the problem is is if you're you if
it's not escaping my default hiccup does
have an escape HTML function but if I
make my app and I say ok I've made sure
that every place in my application where
I'm rendering user input uses the
scape HTML function I won't be
vulnerable for cross-site scripting but
what happens when in three months and I
decide I need to add a new view will I
remember and that's kind of the thing is
if you use an HTML template alive we
that has escaping by default it's not up
to you anymore to remember to have to
use the escaping function every time you
create a web application the next
vulnerability I want to talk about is
cross-site request forgery see Cerf for
short a basically cross-site request
site request forgery is when I because I
am an evil person somehow get a user to
go to website and perform an action on
the website without them being aware
that that's what they're doing and
without them wanting to do it and the
typical example of this is if I have a
web application and and I have a form
and then I send a post request to my
server with my cookies and the services
okay that sounds good
the trick here is is that and we trick
the browser the browser we always send
cookies with with a post request to a
website and so an evil application can
do exactly the same thing they can forge
this request and get me to go to their
site click on the button and then this
post request will be sent to the web
server and it looks exactly the same and
the web server says ok I'll do it and we
didn't want that to happen
that's what cross-site request request
forgery is so what can we do to protect
against see Cerf one is the number one
rule is don't use get requests to change
state according to the HTTP
specification you shouldn't do this
anyway get requests should only be for
reading state it should not be for
changing state so don't do it that you
can think about it maybe and then don't
do it and the reason is is that that
it's really easy to forge a get request
you basically just have to put an image
tag on your page and then every time
they go to that page that the source
which is some HD like URL
we'll send a get request to the server
every time it's really easy to forge and
it's really difficult to protect against
so number one rule don't use get request
to change state please and another thing
that we can do is that it's a new newer
feature is the same sight script strict
cookie attribute which I can when I set
my cookies in my application I can set
them to be strict which means that this
cookie will only be sent to my web
application when when the request
actually comes from my web application
it doesn't protect me if I have an XSS
vulnerability in my site and the user
can come to my site and forward request
as much they want then you pretty much
lost that game but it will protect you
it will provide some Caesar protection
it's only currently supported in Chrome
and opera it's not supported in Safari
it's not supported in Firefox the idea
is that maybe in ten years
we won't have to worry about Caesar
attacks anymore maybe that'll be nice
when that happens but what can we do in
the meantime for this there's the ring
anti forgery library and this is this
the basic idea of what we can do to
protect against these serve attacks is
that when the user comes to my site I
know this user wants to retrieve this
web page so when I generate a form on my
page and I add a secret to the form
which is unique to my user and unique to
my user session and then when my user
clicks in the form I send the secret
with my user the server says oh okay and
then it performs the action but in the
case that someone's trying to forge this
request they can't do it because they
don't know the secret and so that is to
add an extra element to my my request is
an add a secret and then this request is
only valid if you have your cookies if
you have your secret and if the request
is correct and other that otherwise it
will return of 403 forbidden and then it
will protect you against Caesar protects
so ring like if you're using a ring
application ring
anteye forgery does exactly this it is a
middleware component in your which you
can add to your application and it binds
when when the middleware comes in it
binds an anti Faudree token a secret to
your session and then you can render it
in the form in your web application and
then the middleware will check when you
submit a form if the secret is there if
the secret is the secret at once and
otherwise it will not allow the request
to be executed and if you are behind a
load balancer and you can also use a
cookie session a cookie store for your
session and then it will work with
behind a load balancer as well the next
vulnerability I want to talk about is
actually the number one on the OWASP
2017
still it was on the 2013 as well that's
injection attacks basically the
principle is the same as with cross-site
scripting and just the people were
attacking as the database and not the
browser the principle is the same that I
get some user input from the user and
then I use string concatenation to
render a query with this input from the
user and then the user if they can
manipulate your queries they can do a
lot of evil things with their database
the xkcd comic about this is little
Bobbie tables and and it's semi
well-known I'm pretty well known I think
but injection attacks still persist it's
not only sequel it's also any language
where you're querying anything basically
if you get user input always escape it
there's libraries to do that in sequel a
sequel there's a lot of libraries and
closure for instance one libraries yes
cool and that just does exactly what you
think it is if it gets user input it
escapes all of the evil characters out
of it so the user can't do anything evil
in our database the next point I want to
cover is authentication and
authorization how can I
plug this into my application
authentication is the question how do I
know if the user is who he says he is an
authorization is how do I know if a user
is allowed to access a resource and so
one way to implement entick ation
enclosure is to use buddy
so library it has four different
libraries actually there's the core
library and then buddy AHS buddy hashers
and buddy sign are built on top of core
and if you are saving your own passwords
if you're saving user information and
passwords remember you can use buddy
hashers to hash your passwords and so
you don't don't save passwords in
clear-text in your database rule number
one hash your password beforehand and
then when the user inputs their password
you take the hash of that password and
then compare the hash in the database
and also save like Jesus salt which
means that you add and some secret that
the user doesn't know to your password
before you hash it and that makes it
more secure against rainbow tables where
like rainbow tables is when you generate
all of the password possible
combinations for passwords like up to
ten characters or something with this
hashing function and then you basically
you can generate a huge database and
just look when you have a hash of a
password you can just look it up in the
database so if you are do if you are
saving passwords always remember to hash
your password so I salt your password
first and then hash it and then you can
use like you can create an
authentication function so buddy off is
a ring middleware integration it is
unopp Enya nated in that when I am in
some implementing authentication for my
application I just have to implement a
function that takes a username and
password verifies my username and
password and returns some authentication
token that I say that will be saved in
the identity and in my request map in
the identity under the identity key and
so then at any point in my application I
can just look in my application
if the identity key is there that means
that they're authenticated and if I need
to do authorization or something I can
look into and see what what education
token is there what claims are there and
then do auto is a Chanel to do
authorization based on on that and
there's different basset backends which
are delivered with buddy Oz there's a
she basic session token and sign jot and
encrypted jot and it's also possible to
implement it's pretty easy to implement
custom authentication backends of your
own if you if you want some other kind
of authentication in your application
this is just a simple authentication
example about like how you would create
a function like when I'm talking about
we need to create an authentication
function just it just define a function
that takes your request and your
authentication information extracts the
username and password from the
authentication information does
authentication and then it returns
something that's logically true and if
you it returns a logically true that
means you're authenticated and that
token that you returned then becomes
your your authentication token in your
application and then you can just create
the middleware that performs this
application with using the backend like
buddy oz back-end slash basic for
instance one of the backends where we
plug in the realm and the authentication
function we want to use on that at that
point if we wanted to create our own
backends we would like I was wanting to
create a custom back-end we would define
it we could define it on that point as
well so how does authorization work with
buddy basically you can define a map
listing the access rules for your
application an access rule looks like
you can have a list like just one URI or
maybe multiple you are eyes then the
handler which checks to see based on
this URI and the authentication
information that I have is the user
allowed to access this resource or not
and and you can also add a request
method so it's a so the rules are
executed one after another if one of the
rules is successful then your
authenticated or unser your authorized
if
then it goes on to the next one so you
can have multiple URIs for instance like
if you want in this case the request
method get' we're actually if you access
users username with the request method
get' you have the handler says if you as
long as you're authenticated you can do
that and but if you access the same URI
with a post like any other request
method basically because I don't specify
request method then you have to actually
be the user in question and then I can
define my own Handler and like in this
case it is user and where I checked I
drew extract the identity of my user
from the request and then I look in the
request match the name of the user and
make sure it's the same person and then
in the same way like I was talking about
middleware earlier we can just plug
these middlewares that we generate based
on our rules based on our authentication
function we can plug them into our
handler and then we can then it works we
just plug the middleware in and then
that will perform the authentication and
authorization for us we can also define
a custom like on error for authorization
like the default is to throw an
exception which will be mapped to a 403
response but we can also define an extra
function if we want to do something else
for instance in this case it is
redirecting the user to a login page if
they're unauthorized this is a point I
want to leave up there for like two
seconds just to let it sink in if you're
using an API use authentication for your
API like protect your api's the because
of the rise of single page applications
and the this has become more and more of
a problem the the one change to the top
ten this year are the OS top ten and
that wasn't there in 2013 is that now
this is on the OWASP top 10 that more
more there are unprotected api's
available in the internet is not
sufficient to do authorization and
authentication in the front end you have
to do I like some kind of authentication
or authorization in the backend because
it's you can I mean you can't ensure
that the only way someone's going to
access your API is through your front
end that's the point is that if you have
some API in the internet anybody who has
postman curl whatever can access your
API so protect your API and then just
kind of wrap up I want to talk a little
bit about the security headers which are
available this map is the the is a map
of middleware settings you can get a
subset of these this is for ring the
ring defaults and get a subset of these
in Apia for default site default secure
site people and but I wanted to go
through and kind of talk about what they
are this is worth looking up and just
seeing what does this actually mean for
instance like the cookie attributes HTTP
only means that if I set this for my
cookie the Java JavaScript is not
allowed to access my cookies and secure
means that my cookies will only be sent
over HTTP and Saints ID strict is what I
talked about earlier this is not set by
you neither of the sites outside default
or secure site defaults it's not set in
either of them and so if you want to
enable that the same side strict cookie
because you're using Chrome you can do
that and then anti forgery turns on your
Caesar protection for your application
XSS protection and turns on like if a
browser performs some kind of XSS
protection you can enable it and then
you can put it to mode block which means
that it will block the application and
there's frame options that you ensure
that you can't do click tracking notice
they embed your application in another
iframe or something that it has to be
from the same website I'm
content-type options means that they
can't sniff and try to figure out what
content you're sending and ssl redirect
means that if someone accesses HTTP dua
Clark torgue it will be redirected to
HTTPS do it Clark said org so that they
can't go to the the unsecured version
they will always be redirected to the
secure version and if you want that to
be the default you want once the browser
goes to this website you can set the
HSPs header which will tell your browser
from now on don't ever try to send this
user to the HD like HTTP setting always
send them to the HTTPS so the browser
will only send users to the HSPs that's
right HTTP resource after at that point
and so in summary use HTTPS and validate
user input and escape user output and
templating libraries please use them
with automatic HTML escaping unless
you're super hero and then use them with
automatic HTML escaping anyway and you
can look at the site defaults the Ring
defaults for ring applications see what
what's what default middleware can is
just kind of the compose middleware for
you that you can just plug into your
application and it's good to understand
roughly what those different headers
mean what they're doing it's not that
complicated to understand you can we can
read up on them on ooofff it's very
informative and it's good to know why
you're setting HSTs for your web
application and then if you want to use
authentication or authorization you can
look into using buddy for your
application as an example I wrote a
little Twitter clone for ducks because
they like ducking if they like quacking
you know so if you're at a little
application that uses the secure site
defaults and and buddy off the cat
zatia and authentication kind of as just
a work-in-progress Twitter clone for
ducks so you can look at that if you're
interested if you're if you have any
comments or concerns or whatever I'm you
can just write me at my email joy Clark
at noq comm or on Twitter I am joy Clark
so thank you so much for your time</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>