<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Making Leiningen Work for You - Phil Hagelberg | Coder Coacher - Coaching Coders</title><meta content="Making Leiningen Work for You - Phil Hagelberg - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/ClojureTV/">ClojureTV</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Making Leiningen Work for You - Phil Hagelberg</b></h2><h5 class="post__date">2012-12-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/IgNocVDtMIQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">let's get started so I'm sure many of
you have heard bout Lonnegan covering
this line again is a build tool with
signal aspirations we haven't had any
documented cases of hair game set on
fire so I think it's been a very
successful matter guard so far the
project started about a year ago how to
release a couple weeks almost couple
weeks later so it's it's very active
over 15 triggers and twenty thousand
downloads since January moving there to
get have were they where they kept the
downloads so around july when I measured
it was used by about seventy percent of
the open source closure projects and
data so yeah and I know most of you are
probably pretty familiar with this but
I'm just going to go through the basics
of bread and butter of line again how it
works
so the line new commands just spits out
any project for you to work with a
skeleton fill in the blanks
so there you go it's got project ACLJ
files where you configure your project
with just all kinds of settings in there
we'll cover that and then the source and
the test files at their great kind of
standard layout so you can do blow up a
rebel faction this is going to notice
that there aren't any free this notices
that no this is a fresh project it
doesn't have anything in the lib
directory which is where on the
defensive defenseman gonna touch that 48
launch rebel the rebels got a socket
server running so you can background
that and use telnet exact to it from you
know various shells nice to just keep
that in the background
etc now words from the test the new test
the dead skeleton wasn't a failing tests
so a little incentive to fill that in
there so for the demo let's just say
this is what project that clj looks like
you see you get the name of the version
and dependencies are in there there's
two kinds of dependencies there's the
regular dependencies so projects that
depend on your project will pull in
those dependencies the des dependencies
are just meant for you to use while they
are working on the project itself so non
transitive and then so those
dependencies landing it's going to look
on maven central which is where you
plant a lot of your Java libraries it's
going to look on the closure build
server so you can pull them like the
latest snapshot that was just go half an
hour ago and today with on Chlo jars
which is a community closure repository
so i'll talk more about that later but a
lot of projects you're going to want to
add your own repositories can slap that
in there for your your secret password
protected code so close ours is like I
said the community repository from Sky
step closer as launched around the same
time like it did and there's kind of a
synergy going on there where you know
lighting is a lot more useful because of
closures because you can if you've got
your library and push it up out there
other people
they just copy paste a little snippet it
gives you in there to their project ACLJ
animal planet so using Miami with
blowjobs is pretty easy you you call the
jar task and a palm task palm spits out
a poetic smells like the maid and speak
for describing your project and then
once you have an account include ours
any of you have your ssh funky of their
SCP can can put it up there as soon as
that's done it's available for other
people to defend line so super handy and
very low or add no you know no
administrative getting across recruit or
anything so I think that's really
important this this date of closure is
it's just a lot for unexploded of
libraries to get out there be useful
next I'll be covering some of the more
advanced features things not maybe not
everyone knows about and I don't think
most people know about this because it's
new in 1 by 4 which is unreleased it's
like the next version should be should
be out in maybe couple weeks I hope so
the idea here is when you write your def
tests you can you can touch metadata and
in this example it's assumes that we've
got some def test with integration
metadata integrations that's a true
limited it so this has selectors there's
a map of keywords to credits so the
predikant it can be any kind of function
keyword or you know o FN literal or
whatever so the idea here is you use the
metadata to kind of tag your functions
and then you can say I want to run this
subset of functions not necessarily just
everything in this namespace but across
all the namespaces which which functions
have
than a data set screw so we use that at
work a lot for integration tests well
this was written to intent to support
that functionality because we needed a
better way of segregating a protest so
this these kind of tests are really slow
we all run all the time but they're
still being important to run them like
the continuous integration server so
this gives you an ad hoc way of just
classifying your tests varies also
recently although this is in 1 by 3 we
have added the support for user plugins
so you noticed in a sample project clj
there's defense against mine closure so
everyone uses Emacs once that in there
because it makes a lot more useful but
not everyone on the project uses he
makes so why should they have to pull in
is this dependency that they have been
used so now if you just simulate that
jar into your home line plugins drinking
that's available across all your
projects so very useful and this the
main I'll send like things kind of hunky
that's going to go away and one before
it will be handled automatically so now
the cool thing check out dependencies so
this is great for when you're hacking
two projects apparently you've got maybe
you've got a project that depends on
ringing anyone add a feature during so
normally you would have to go in and say
like okay i have i've added this
function into ringing i'm going to rings
project and do a line install go back to
my project i'm gonna do lined apps i
restart my swag server and then many
functions going to be there oh I gotta
collect slightly wrong and have to go
back
and in the next so we can do with line
again now you can just create a
checkouts directory in your project and
similarly iranian to there and then when
lining in calculates your projects class
back that's going to include rings
source directory and resources directory
on there so changes gonna convince them
so that helps quite a bit for that two
projects and carol in all situations so
this is kind of like multi-module
buildings I'm just totally out of
Hawking often so you don't have to just
declare up front like this is the
structure of my project this depends on
one sitting maybe multimodel bilitis
it's quite hierarchical top-down this is
ad hoc opt-in some of the people on your
teen are going to be using ring and
hacking on its own the people are so why
should they that complexity be added
onto them question yes go turn it off in
project on CL J or is it this like a
head of project on CL today settings to
bring you the same library this is so
the question was how does this interact
with declare the dependency of magic
that subject you still want to depend to
declare your dependency in project clj
if you're doing this because it's opt-in
like if you you know if you have this in
your check out of your project you know
your co-workers not going to have it so
if the dependencies not about you got
steel day they're going to miss out very
tired so this is a kind of overlaid on
top of that good question so another
thing this is this is a little more
experimental so if you've worked in
closer and how to unix background you
will notice that I guess it's not just
closure but JVM languages in general are
not terribly enix friendly
terms of just command line interaction
in general like the Java command line
option command line launchers kind of
feels like someone wrote it in 07 and
there are 97 totally hasn't done
since uh to put it generously so this is
an attempt to well so part of that is we
can't do anything about Java is slow to
start up the jig name is slow to start
up and that's just we're going to have
to wait for it groans from the hospital
gohan spotting love you guys but some of
its cultural and I think we can work
around some of that so now line again
will allow projects to specify that they
come with shell routers which means when
you install them they'll place the place
of shell script in home that line such
bin and so you put that in your half and
then suddenly you've got so I closure
available as a command line as a command
line xq bowl and you don't have to
construct your java dash CPD mouthful
every time so that's customizable you
can say in your project that's tilted
you can say she'll rapper true and we'll
just give you the default shell rapper
but if you want to add some more
functionality to that maybe supports
more environment variables or something
that you can you can specify a bin that
you want to do be the shell wrapper and
you can specify your only main in there
as well so it uses formats just
internally that
so I don't know how this is going to be
used it might just be that that isn't
going where but I think there's room for
improvement with command line interpose
command line interaction and closure and
I hope this can accommodate so tasks
take arguments perform side effects
return values so naturally they
represented assumption so this is kind
of just a a general pattern you see
enclosure to ask yourself okay how
should sue be represented an answer you
know ninety percent of the time is some
variant of literally I fun functional
language function function function
everything Walter so being functions you
can leverage memorization composability
everyone in some functions work they're
great and we'll talk a little more about
that another thing to note so projects
some projects run in the context start
some tasks for another context or a
project most tasks but there's some that
run anywhere like the new project the
new task obviously their camera and
inside a project help can run anywhere
so line you get them actually look at
art lists of your deafened and say oh
this guy's expecting and arguing named
project so he must be this must expect
to be run in psychometrics or project
and it'll it'll freak out if you try to
do anywhere else so that's just a little
taste of like you know the way you can
leverage is everything in function
this is probably the trickiest thing
about writing Lanigan plugins our tasks
is that it's really important to
separate out in a to force across the
separation between your code and line
against code start between your projects
code in my veins code so line against
using closure 1.3 right now and
obviously most projects are not goofy
jumping on that right away so it's
really important that they have a
separate process space for that our
class class loaders days for that so I
need implements that with a valid
project which is a lot of like eval
accept it takes a project RT at first
and then launches a subprocess to force
it off and performs the eval inside
there and park your night at work psych
eval it's going to take it's going to
take a form you can use back quote and
and you know unquote calendar so you
have to build up a Harlem so little
tricky to room to remember anytime
something runs in the context of your
project it's gotta guys are here but it
does provide serious Memphis it's
important
so tasks can be extended using this
library called Robert Hooke Robert Hooke
yeah I renamo many projects after
literary characters and Rob took while
he was that you know historical
character is also a character in the
baroque cycle 19 students so I pledged a
little bit there so let me just step
through this here Robert look is a
general mechanism for extending function
so thank I what's going on here is we're
creating two defens called spacing and
indigent and they take a function as the
first argument and in X a string is our
second argument and so you got this new
function and you're going to add that
Miss hooks onto crinoline so that is
done under the covers with some ultra
part of magic it prepares the large to
be hooked and conscious on these these
rapper functions there and composes them
so when you actually called penguin what
it's doing is it's calling a chain
that's composed of spacing and biggin
and the original print line so this is
the kind of steal some of the spectrum
if you're familiar with closure access
fixtures my business is very similar to
that but you see that you call Finland
the output you get is so that the string
fubar is ax and it gets passed through
and spacing it gets the space is
interposed and then begin against
uppercase and their band comes out is
boohbah so you do all kinds of things
with robert um a common thing to do is
to set up your own bindings test like
they're implementing this way so it
refines internal closure not testing
which is picky by thumb used to great
effect with
the flexibility and test lenders you can
just decide not to continue you can just
never call F conditionally based on the
arguments or environment variable
remember you can modify the arguments as
they go in you can add your own side
effects you can return a different value
all kinds of stuff so with rubber duck
you're taking control of the function
and do your own thing so when you're
using this of Langan normally you apply
those two tasks although it's also
common to apply XD dollar project is
what else you need to kind of insert
your own set up around everything that's
going to be valid instead the project so
as an example the Java Sea task for
compiling Java code in a next next
project it used to be implemented as a
plug-in it's now part of lining it but
when there's a plug-in you can write a
hook to ensure that before you compile
you know you did aot compilation
enclosure code the Java Sea compilation
area first so that's kind of a standard
usage of the basic bad side effects the
fourth point there but if you had any
function this is really general it's not
part of lining it's it's own dependency
so you can you can pull it in without
without all this just flying and stuff
thong right things can get pretty crazy
if you do this much so anytime you have
a motion that you control you should not
look it you should make the function
more flexible or I'll have to do what
you want it to do so this is for taking
control of functions that you that you
wouldn't otherwise be able to do
anything this so it's very important
also to accept the same ranges of
arguments
original this is actually something that
the example I showed he was really
terrible at if you go here you're
applying a rapper to print line but hey
genius crinoline doesn't take just a
single arm and doesn't even require that
its argument is a string so these are
these are awful examples you know in
terms of the terms of what's decent to
do it's more of an example of what's
possible so generally you wanted want to
be sure to take varargs and you want to
apply F to your barks rather than just
calling it like this just for
flexibility in case the function your
cooking changes are at ease in the
future or you know I mean what adds an
additional something and final copy at
cooking multi methods wraps the Deaf
multi in a function so if you try to do
a deaf method on top of that later it's
going to be like that's not even a
multi-method what you're trying to do so
don't do that I'll do it if you're never
gonna did you know aggressive but anyway
impose ability issues that and this
doesn't work this macros related well it
might be able to do me to look at my
voice but I don't really like that it
yet so probably a good idea so that's
extending tasks and so one of the things
I try to do is make it very very clear
that you know there's no distinction
between tasks inside line again and ask
us online again and if you want to add
your own task its its first class
there's it's basically indistinguishable
so if you if that's if you still need to
touch built in women
robert hooke lighting in is the most
contributed to closure project over 15
tribute errs here's a little emo of
awesome commits coming in so I'd like to
talk a little bit about how that works
why I think that's happened maybe some
general principles there are you using
your own projects what can you do to
make your project easy to contribute to
that's the I think that's it's a really
important goal to having right so with
lying again the biggest thing that we
just started doing this one right now is
every time your release comes out we try
to have these low hanging fruit threads
up an analyst so if you know if they're
lurkers on the mailing list people who
are wondering you know how does this
project work yeah maybe I could like a
call down low it just kind of you you
threw out a few bug fixes you know
things that anyone could just dive in
and understand without you know you want
if you want to have a road map with the
big the big features but you really want
to make it explicit that oh these these
little things here are great for a great
place to seven so low hanging fruit is a
big a big thing then documentation so
it's important to have you know user
level documentation that that's you know
if you don't have any users you're never
going to have people who get to the
point being tribute but you want to go
beyond that this is actually something
that I'm if not very good right now why
you can only recently got more than 100
lines of code sorry thousand lines good
long so I put off this for a lot
maintaining the hacking back as I might
want a lot of good tripped up by Eve
Alan project and just the general flow
of the project you know lying again how
you resolve tasks kind of arrogance that
things like that so that's that's really
important for people wanting to dive in
and you really want to accept patches
probably your attitude you take towards
patches really reflects how people think
you care about contributors to your
project so this is something that I'm
actually not very good in some of my
other projects but I try because like I
really care about lying again I try to
be really prompted with the flying maybe
some of the other ones my closure sorry
guys I I love you but as on the ball
there but people really your idea I
entreat contributors really really comes
crosses and closely related to that is
idea trusting people so the Rivini asst
project is a experimental small effect
style virtual machine for Ruby and they
have a policy that if you get a patch
applied are accepted if you submitted
passionate it's accepted then you can
ask for commit rights and I'll just get
into so that's kind of so we would call
me crazy but I talked about in the
maintainer and you said you know I've
not problems with this I've had to come
in I've had to revert less than 10
commits in a whole three or four here
life of this project so the lesson there
is if you trust people and you know
people in like responsible adults don't
act like it in general and sometimes
people don't want commit rings and
that's by doing that's just people being
straightforward about you know
don't don't trust me but people people
tend to respect that if you if you show
that website so that's a big deal oh one
other things that makes people want to
continue to run stickers if you have
contributed delight again come talk to
me I'm sigra 40 if you bring the plugin
I think that counts too if you'd like a
sticker and we can talk about not
hanging free loves me some stickers so X
I couldn't talk about the community
without talking about plugins so um I
talked about writing tasks and extending
tasks plugins are either tasks or hooks
that are several projects that you can
depend on this this is dependencies
bringing life and stuff so here's just a
little smattering of some of my
favorites my multi is really cool after
the close thing about it is I just kind
of asked at that on the mailing list
next hey what if your greatest explain
existed and then someone came along even
like a week later was like oh there you
go oh so what it does is it so you can
project that field day you may have your
list of dependencies line multi lets you
define parallel sets of dependencies so
say you want to make sure your project
works with clover 1.11 fix you and 1.3
yeah that'd be kind of a pain in the
neck but this this lets you say okay I
have this set of dependencies so say
your project depends on another project
that has different versions like they
have a backwards compatibility version
for cultural one point wine and you know
a stable version for closure with me too
and the stamps are in foreclosure 1.3
and this line multiplet lets you bundle
all those together
this is like my way 37 for my to spend
one but one set and you just say ol TV
test and they will run the tests over
all of us at once so very handy
especially now that again we're getting
to the fun where there's more of our
pleasure group in the wild it's pretty
nice line if test is also quite handy so
the idea is you've got your clutter that
tests tests that maybe you're doing that
is equal on a seat and it's got ten
things in it and one you're expecting 10
things and you got 11 years like you're
looking through there to try to figure
out which part is different so this
actually puts the output in like a diff
much easier to read so it's hard to
explain so i'll just show you there you
can see the plus/minus there what's
different in them in the actual versus
expected very nice to have like a bad
against is something that we hooked up
at the scandal closure meaning seat or
what ride against does it is that you
give it a name space to instrument and
it goes through and doesn't alter parted
magic on it to kind of flip a bit when
it's called and then so the instruments
the namespaces you want to zoom in there
runs the tests and it's able to tell you
oh these functions didn't get calls
during the test runs so that's great for
test coverage it's also good for kind of
shaking out so you've got a new space
where you accumulate and crafts you're
not sure if all the functions are still
needed anymore you can you can
instrument and just go bam so handy
hasn't seen a lot of uses it's pretty
primitive but it's amazing way to do in
25 lines with ultra borrowed and some
metadata kind of really
on the value metadata letting in Ward is
doing web apps when I deploy had that
war file it's great for just bumbling
that up and you can easy to plug it to
the choppa web servers and there's one
week to the grauman's there I do
conjurer all kinds of stuff a little bit
about what's next for line again I
talked about the 1.4 release that's
coming up big thing there's test
selectors and plenty of consolidation so
there's been quite a few because of
plugins task for plugins or first class
I'm able to just tell people if you've
got this idea let's let it evolve in a
plug-in first and let it mature and then
and then scoop it up once once it's
stabilized so we're doing there with the
Java Sea task search apps run task
there's another one in there so I'll be
great just an expanding the core yes
okay so maven just has at least a main
three and lineman's based on maven and
kind of a roundabout way it uses there's
a library culminating in tasks that kind
of exposes the minimal epi needed for
useful dependency interaction might even
uses that it's a little hairy to go
through all these layers so we made them
three days fun out there passport in
line and students at library so maybe
the good parts there another thing we're
going to be thinking a lot more about it
is an explicit public API and this is
something you really want to think about
before you think you need it because by
the time you
it's too late we've had a few issues
with plugins breaking because there's
just been kind of dozen been a really
clear delineation between a public API
and what's okay what's an internal
implementation details so that's
something we could do better about so I
use smite closure obviously and I you
know run all my tests in there I realize
not everyone does this so thinking about
supporting nail gun for quick test runs
for those 19 x users using jars straight
out of them to directory rather than
copying them into lib would be a little
cleaner the way it's done right now is
kind of fergus powerful reasons that
don't write anymore last one is pretty
cool so Hudson is a continuous
integration server very nice to have use
it at work so there's going to be called
5 e's is starting to offer hudson as a
service where you get your bill done for
like one cent a minute just on the band
and they're talking about them about
installing lighting in on their servers
so lot of people ask me like oh what do
i do for dependencies that i can't put
on clothes ours because they're private
so this you know getting yourself set up
with one with an account here and you
know pushing it out to a private s3
location will make that a lot easier
just real low overhead everything's
things handled for you so expect an
announcement on the mailing list soon
yeah that's about it so I've got the
Wi-Fi has been little spotty so I've got
lighting and being served on the local
land connection so you don't have to try
to reach out there so yeah if you're
interested just just pull it up the
canonical Roma Flanagan's on github
they're taking me about us is my blog
and then my slides are are there as well
so
the big questions in space
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>