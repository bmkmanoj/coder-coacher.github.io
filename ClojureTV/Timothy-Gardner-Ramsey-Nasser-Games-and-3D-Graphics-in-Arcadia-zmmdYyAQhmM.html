<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Timothy Gardner, Ramsey Nasser - Games and 3D Graphics in Arcadia | Coder Coacher - Coaching Coders</title><meta content="Timothy Gardner, Ramsey Nasser - Games and 3D Graphics in Arcadia - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/ClojureTV/">ClojureTV</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Timothy Gardner, Ramsey Nasser - Games and 3D Graphics in Arcadia</b></h2><h5 class="post__date">2015-04-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/zmmdYyAQhmM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">thank you for coming out to see us give
our talk about Arcadia a closure West
I'm Ramsay Nasser and deep in code
beneath me is collaborator Tim's
gardener and we've been working for a
while to build this framework that
enables developing serious high-level
videogames in closure and what we've
done the sort of elevator pitch of
Arcadia is it's the integration of the
closure programming language into the
Unity game engine so a quick show of
hands who here is familiar with unity oh
wow great that's gonna it's a whole part
of my talk just skipped and if you're
not familiar with closure then the last
two days must have been really confusing
so this is the part I'll shoot through
unity is a you know production industry
standard video game engine it's used
with everything from high school
students which I teach high school knows
how to make games in unity all the way
up to a triple a very serious studios
are actually making games and other
interactive you know software artifacts
really is the most general thing that it
that you can use to describe it what it
gives you is a very solid graphics
pipeline physics engine networking to do
multiplayer stuff a really well reasoned
entity component system which we'll get
into and Tim's will talk a lot about and
a full visual authoring environment what
we're really excited about in addition
to that is that it exports to an
incredible array of platforms desktop
iOS Android consoles PlayStation 4 Xbox
and this is the real thing
currently Arcadia exports cleanly to
desktop and we're patching the compiler
to support exporting to other targets
we we get a lot of questions about how
was done and it's really kind of fun to
hear people's theories about how he did
it
a lot of people think it's some kind of
closure script hack that like transpires
to unities JavaScript and it's not that
it's it's like better and worse actually
than that
who's familiar with the CLR version of
closure less than unity which is
interesting at a closer conference so
there is a version of closure that
targets the common language runtime
which is Microsoft's runtime that our C
sharp and is heroically developed and
maintained by this man David Miller who
we've never met but we in order to make
Arcadia work we've had to fork the
compiler and the conversations that
we've had with with David Miller have
been really enlightening and have made
Arcadia and closure CLR even even better
just by it by working together a sort of
run-through of Arcadia itself before I
dive into code the framework is meant to
be low-level it's it's sort of not you
we have a lot of ideas about really cool
ways to make games but this is not
that's all what Arcadia is Arcadia is
meant to just sort of wrangle unity get
all of its weird stateful sometimes
insane API out of the way there Perlin
noise implementation always returns a
constant number unless you add 0.5 to
one of your parameters it's like stuff
like that that it's it's our job to sort
of pave over that but other than that
we're really not imposing any additional
semantics or workflow so it's very very
open and any anything else we sort of
want to be made available as libraries
that sort of vision for Arcadia is at
the core be the small little thing and
then this is the ecosystem of libraries
that you can use so a summary of what
the process has been like this is the
closest to a logo that we have so far it
works you know you just you just kind of
just keep going at it and it gets in
there eventually
I won't get into the internals but
before I dive into my own stuff I want
to share some things that members of the
Arcadia community have been making which
is is crazy we the first commit was
April 17 2014
so Arcadia like just turned a year old
excited about that and end of the year
since there is a small a small very
brave community of people that are
willing to use this tool here a couple
of the games that we've that have come
out of that world so this is a it's been
called a feminist shoot him up where
your your your this like badass
scientist flying through the sky
and and these like evil aliens show up
and you'd like zap them with your eyes I
it's great like we don't ask questions
this wonderful this is a buy this is an
a really interesting sort of non gamey
game piece which community gets used for
a lot this is a piece that reads I
believe they reads books from Project
Gutenberg and then creates actual 3d
books that just drop onto the table in
front of you and you can like pick them
up and and read them so this is using
it's great right it's great the great
thing about virtual reality's we can
recreate this reality but it's awesome
when you see an animated like the book
pops up and it opens and it's it's just
it's super cool this is some of our
favorite work is is by man named Joseph
Parker who I mean I'm not even gonna I'm
just gonna play it so this is Joseph
Parker recently live-streamed a 48-hour
Game Jam over the last weekend of him
making an evening an evening of modern
dance I believe was the name of the game
and it's this completely bizarre
completely wacky just surreal dancing
game where I I think of the instructions
it says if the physics freak out then
you need to practice dancing more this
is this is some more
there was a lobster at one point so and
this is very much his aesthetic he's
very into like Wiggly weird things and
it's and it's great this is more of the
lobster he tweeted the closure code that
did that I think it's parrot parent Bank
lobster child arm or something and it's
just right and this is another thing he
made that he's been live steel i've
streamed this shooter where you have to
sort of pick up you have to plant your
own bullets i think was what he wanted
and so you're like planting turnips and
throwing them at and this is a this is a
whale a sperm whale game that he worked
on a little while ago so this is really
exciting for us because people very much
because of the sort of stability and
robustness of closure itself
people are already picking up arcadia
braving through the sometimes
nonsensical compiler errors and in
making stuff in it and and making stuff
that you really couldn't make or
couldn't make with this kind of ease and
fluidity in another framework and that
brings me do my own work this is a game
that i recently made for those show that
indicate it's called wizard
it's called wizards hands we
unfortunately full name was Wizards
hands don't touch because there's like
this whole story but then like people
weren't touching the game like oh god
why no
do I never call your game don't touch
people won't touch me but so this is the
biggest Arcadia project that I've worked
on in my collaborator caja Labe built
this custom glove controller which you
wear and it lights up to indicate how
much mana you have there's a leap motion
embedded in the palm reading your other
hand so you're like casting spells at
ghosts as they're attacking you and what
closure and Arcadia are doing is they're
talking to this to the hardware using a
binary protocol over serial we're doing
gesture detection enclosure it's all
happening in the agent on a separate
thread so we don't slow down the game
it's just the full real thing and it was
such a blast to write and and really
easy to debug when things went wrong and
this is where we run out of slides and
we dive into code which is why that
emoji is up there so the demo we have
two demos for you guys today I want to
demo the sort of functional game
development process that I arrived at in
my most recent game that I've been
developing we have one demo my operating
system just died so we have one yeah so
we have we have one demo and
further when you patch compilers you
know shooting from the hips
stuff happens and so I'm going to share
with you my my workflow because of how
low-level Arkadia is a lot of people use
it in a lot of different ways which I
think we think is its strengths and I'll
take you through how to make a simple
game in Arcadia so who here has made a
game before worked on a game alright so
we've said this before in other talks
making game a game is like the hardest
thing in the world to make Brandon Blum
who spoke a little earlier says that
making a game is like solving every
difficult problem in computer science 60
times a second and that's completely
true
so the its plays a little bit
constrained but I think we can make do
ok let me get rid of all the nice code
that I prepared and start blank so for
those of you who aren't familiar this is
this is unity unity is a full game
authoring environment you have a sort of
scene view this is where you could move
things around and sort of set up your
world you have the game view which is
what your actual game will look like to
your players your hierarchy is a list of
all the objects in your game unity
implements what's known as the entity
component system which is this approach
to game development where every object
in your game is just a container for
components and components actually
implement State and behavior and that
makes it very amenable to persistent
data serialization and Timmons has built
an incredible library for that we can
convert between unity C and graph
objects and and closure persistent data
pretty seamlessly and getting more and
more seamless as as we develop it below
is the project this is the list of all
the files in your project this is where
you manage textures and and scripts and
stuff Arcadia is just a folder that you
add one demo that we we considered doing
was this neat thing you could do where
you could drop Arcadia into an existing
game use the rep
use whatever sort of Lisp power you need
to fix the stateful shark mess and then
pull it out and no one knows and you
know no one is none the wiser
so it's Arcadia is not an all-or-nothing
proposition it's designed to interact
with unities existing practices and
c-sharp very very seamlessly and on the
right is the inspector which is you know
information about the currently selected
object so I'm gonna try and make a game
in front of you guys using sort of the
little bits of snippets that little bits
of code that I prepared a little earlier
it's gonna be a 2-d game so I'm gonna
switch into 2d view okay everybody see
what I'm doing okay yeah great so in my
2d game it's gonna be a game about it's
gonna be a ship so just create a ship so
again all objects are kind of the same
so the only thing that makes this thing
look like a ship is at attaching the
sprite renderer and the ship sprite and
now you see this guy down here so here's
my ship and I'm going to add an asteroid
so you'll move you'll end up moving a
lot between writing code and doing this
kind of visual stuff we're making a game
sighs it looks nice unity 5 has this
like really fancy like horizon by
default it's like guys it's fine it's
cool I just gave me black oh so these
are my so these are my initial assets
I'm just my initial game objects will
ship in my last word so the next thing I
will add I'll do the later so to start
building this game out can't wait to
read my code on the right is that
legible in the back
good so as closure programmers we know
that the best thing the world is data
right it should just be data and when
this data you could reason about it so
to talk about the player let's create
some data so the players ship is
initially let's say its position is a
vector to 0 so jump in this new space
over here and so this is sublime text I
haven't made the jump to Emacs probably
never will
there's none chase me out of clothes
requests so what is a ship in a kind of
asteroid style game do does a bunch of
things one of which is it can move so to
move we will take an object and update
its position with vector to addition of
some offset
so now I can move the ship by 3 + x + 1
+ y and you see that down here the
position at the end of it is 3 + 1 so
what you'll see a lot of in this talk is
the arrow macro which I fell in love
with when it came to closure because I'm
really into a stack and concatenative
languages and it's like oh this is a you
can use mini a little concatenated DSL
you just string together but this is
sort of the backbone of a lot of my work
because what I want to get to is Arcadia
is this is a point that I want to make
well showing the slides are Arcadia is
to us more than the sort of technical
athleticism of getting a sort of fringe
programming language or not mainstream
programming language running in a game
engine that it wasn't designed for it it
solves very real problems of game
development and the real problem the
main one being that you can it's very
easy to paint yourself into corners of a
ball making a game you sort of design if
you be prototyping things you'll be
changing things trying things out and
then you'll get to a point where you
actually want to go back on a bunch of
stuff that you did but if everything is
stateful and tangled together it becomes
very hard to add new features down the
line so this demo was sort of heading
towards being able to fluidly add and
iterate on features of your game so this
is our movement now to get it to show up
in unity you need what's called a
component like I said really quickly the
entity component system means all
objects in immunity are sort of the same
they're just containers for these
components and Arcadia lets you write
components in pure closure so our shaped
component has a state and it starts by
setting its state to the ship's initial
State
so if I save that and I jump into unity
it compiles in order for unity to really
see any of our stuff we have to Ã¤Ã´t so
Arcadius constantly rotating your stuff
so that unity can can see it and the
balance between compiled and stuff that
you just sort of have floating around in
memory is an interesting one in arcadia
so I'm just gonna hit play which is how
a lot of people actually use our Cadia
they just leave it playing i'll give it
a sec single-threaded okay so so this is
my ship object and I'm going to add V
I'm going to no you guys get to see the
wonderful state of our compiler
some people ask us if we do this for a
living we don't
let's see alright
so it's now compiling all of Arcadia and
all of closure and hopefully that will
have slip swept the dust away
okay well yep
there we go play so a lot of the
complexity comes from the fact that
unity is actually not written in c-sharp
it's written in C++ and just uses mono
as a scripting layer and is more than
willing to violate any kind of
assumptions that you can make about your
VM this is sort of like it's kind of
like if you were working on the JVM
there's a demon below those will just
sort of poke holes and do something so a
lot of our work has been finding where
those are and just patching them up and
you just you just saw a demon finger
come through Arcadia that's what that
was
but so this is a pretty recent feature
so we have player ship this is def
Capone is basically a deaf type just
made to play nice with unity and you'll
see that states the persistent data
actually shows up in the unity inspector
and you could like modify it and play
with it if you want to it's basically
set banging every time you you update it
and this becomes a really nice way to
visualize persistent data as it's moving
through your game so I know the player
ship is not doing anything and you'll
see that changing the position doesn't
actually move the player because what
moves the player in unity is this
component the transform component is
what determines where an object is drawn
so the way unity expects to be used is
to be to have components talk to each
other so we need our player ship
component to reach over to the transform
component and tell it to move and the
way I like to do this is this so I'm
going to do
updates player oh yeah and we put this
in a little pipe and we say so we're
gonna pass this in we're gonna pass the
player state in and we can move the
player before we moved it by a fixed
amount but actually to make it
interactive input get axis horizontal so
get access these are unity API functions
the horizontal axis is basically
negative one when I'm pressing left and
one one I'm pressing right the vertical
axis is one when I'm pressing up at
negative one when they're pressing down
and unity smooth between the two it's
quite nice so that now if we add an
update set bang state update player
update player gotta call that player
let's call this ship ship state so this
is the sort of this is what I arrived at
and was really excited about and worked
very very effectively you can sort of
start to build these chains of non side
affecting functions that build up and
modify persistent data and then in one
place update the actual data for a
player one place during a frame and then
after that you'd like update graphics
and do whatever it is that you need to
do but you have this very clear
separation of your the abstract notion
of what you're doing in a frame and then
telling unity how to reflect it visually
so let's save that
compiling
yeah I'm gonna did ya know see you early
and now does everybody see the y-value
going up a bit so I'm pressing the up
key on my keyboard you can't see that
because I take my word for it so that's
the bridge that's the unities input
system coming in in our not pure but non
side affecting function updating the map
and the map itself is being sort of
swapped out with the map that we have
set as the state of the player ship so
the object is still not moving because
all we're doing is just updating data to
actually reflect the change
so you update the position to the
position in your state right that should
do it
so the compiled except at your own Oh
your position is two-dimensional so
that's actually do this so I actually
got to put I'm going to D structure so
it actually needs to be a
three-dimensional position because unity
is three-dimensional
why and then the Z is and Z is zero that
should do okay
let's pop back in
is the to the sort of wait and compile
and beachball is the the normal live
coding experience in unity and we the
repple tends to beat that and let's see
if we can actually say that'll ship
there we go videogames so no so I
actually want to walk through that
manually in front of you guys because
that that's the this is Arcadia out of
the box so for the game that I built I
actually ended up building a bunch of
macros and functions that would start to
just fold in patterns that kept coming
up in the development and the the end
result was was was super super easy to
sort of tweak I want to show you a more
sort of complete version of what that
looks like and then I could walk you
through the code so you don't yeah so
this is the full sort of game I'll to
get rid of the stuff that I wrote here
and I'll bring in this ship and I'll
bring in the asteroid logic
let's weigh myself
so this should be okay
unless I have my order that's not
there
okay so I will walk you through this
code because it's being a little buggy
and maybe clean it up a little well
Tim's talks but basically the the
exciting thing is that we are able to
this is the logic for the asteroid you
see that you could start to build these
pipelines right and and when doing game
development you what this code started
off as originally kind of look like that
the asteroid starts at an initial
position but then you can give it a
random speed initially right or maybe
take out the random speed you can give
it a random special movement and the
special movement again is just data
stored in this special map and the the
way the specials get done is they get
folded back into the this asteroid
update function so this is a lot like
what I had for the ship except because
it's a pipeline you can just start
adding other things as you want and this
just works you just end up writing
functions that pike maps and operate on
maps and the last step you sort of
update the unity component and all unity
knows is it just got handed this data
and told to move things around on the
screen and it leaves the the sort of
flexibility of modeling your game logic
in this state like non side affecting
world but you're still able to
performance leeteuk to unity and have it
update the scene graph as as you need so
those are the sort of bits and pieces
working and otherwise of the of my demo
and Tim's has some stuff doing plug
an oculist deputy cycling which is
something that acts the Macintosh GPU
unity 5 and the latest release of
Arcadia
you've got the bed state so this is
going to be a little bit more
descriptive and demonstrative but so I'm
going to talk some about upcoming
features in Arcadia and thanks for
working on it especially with a focus on
the hydrate library which is intended to
throw as much of the logic in putting
game together into persistent data
structures as possible and by extension
all of the functions we usually use to
manipulate closure data can be used to
mitigate this is a movie for my neck job
I did for the group called sonic
platforms in New York it just goes
together quickly over weekends but and
this is new scam to me during a party
people using a scanner on an iPad the
background here is generated using the
hydrating space in their community and I
can show you the code that made and this
keeps going on forever in the background
so please
these procedurally generated you know
box rectangles ever keep them I mean the
interesting thing about that is and so
this is a map that we're going to do
here's the children it's you know a
large function was made in anger but
you know point to look at is that this
is in fact the entire coat required to
make this which i think is probably
Turks feed this map structure directly
into the unity scene graph and that just
comes out and for me the most exciting
part of this is that the code to
generate the original structures that
you're saying here that these this
original mess of rectangles can then be
used to after you meet these things we
put them in the scene graph you can use
those same match and the same parkinson
generate those maps to repopulate the
existing objects in the scene graph so
you don't have to pay for instantiate
America so paying for objects and
situations other accessories and that
means that you can just cycling them
infinitely though there's just a finite
number of these rectangles that are
actually existing but they just keep
coming
and again all that's contained in this
screen using yeah so if you saw like the
transform component inspector that
transform key in the map on 24th that
map's directly to that component and
then the local rotation position Keys
they not directed to those fields so
quickly and like three minutes of time
you see that the for the next release we
have several things planned obviously
more stable arcadia and much better
document has been what we've had so far
have actually tied up we want web export
which is something that unity 5 makes
much more feasible for us we want to
work another an export target and that's
why this works to html5 so you can just
play without kinda done with anything
for hydrate the system that I have mine
is one using my babies where and blooms
dispatch map library but it's a
localized multi-method system so you can
extend the polymorphism of some function
without mutating and local state and
this means that different people can
both define functions on a third-party
class without clicking each other it
seems like the correct way to do
something like high grade the entire
point of which is that you can convert
arbitrary classes arbitrary objects of
any sort into their culture data we're
going to set that up make the D
optimizing macro which generates all the
hydration grammar much more accessible
and and then Susan yeah yeah questions
or any minute
I have played overbooking TK which is a
c-sharp adiabatic wrapper over open jail
and using this sort of work
yeah question was do we have any advice
for people who would like to write
libraries for Arcadia Priscilla yeah I
mean we show city manager so but we want
to have our our work isn't doing
anything
yeah and we're sort of an R&amp;amp;D branch of
closure CLR is quite so we're push a few
guys for using it maybe more intensively
than a lot of people certainly with more
intensive performance I mean yeah I mean
because there's some things that the CLR
for to which the team doesn't like they
have support for true generics which
means that potentially could get rid of
all of the boxing and unboxing stuff we
have and it just things like that they
extensible value types of supporters in
there
the question is do this with the open
sourcing of the CLR affect our
development expert depends on unity so
unity has a proprietary Ranger month and
the well though the direct I mean so one
way it could is if more people start
using literacy a lot that'd be great but
but it's a de monitor we can directly</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>