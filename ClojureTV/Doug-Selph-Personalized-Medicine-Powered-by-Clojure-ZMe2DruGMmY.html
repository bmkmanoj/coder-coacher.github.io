<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Doug Selph - Personalized Medicine, Powered by Clojure | Coder Coacher - Coaching Coders</title><meta content="Doug Selph - Personalized Medicine, Powered by Clojure - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/ClojureTV/">ClojureTV</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Doug Selph - Personalized Medicine, Powered by Clojure</b></h2><h5 class="post__date">2014-01-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ZMe2DruGMmY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">thanks Alex yes I am Doug self and again
Vanderbilt University Medical Center
computational genomics core and here to
tell you about a person as medicine
project I've been engaged in there when
you hear personalized medicine your mind
may go to things like this this is a
Swedish doctor who with approval for
patients who had really no other options
existing has taken their own stem cells
and grown new tracheas for them in the
lab using bioengineered scaffolding that
may be what you think of when you your
personalized medicine and that that does
come under that umbrella for sure but
that's not the kind of thing that I want
tell you bout today that's that's
exciting technology I think during a lot
of your lifetimes maybe all of ours
it'll be pretty common but it kind of an
aside related to organs and growing
organs such cons last year been around
this year you may want to keep track of
guys who are doing works like work like
this they're growing new livers and some
of you may be in the market for those so
but back to our story it's a different
kind of personalized medicine I started
a Vanderbilt a little over 12 years ago
now and one of the first projects I was
involved in was part of what they call
the pharmacogenomics research network
and this was a multi-site consortium
included places like northwestern
Stanford Harvard st. Jude's in Memphis
and they were all looking at
pharmacogenomic impact which
pharmacogenomics is the study of drug
gene interactions so how does someone's
particular genetic make-up effect how
they're going to metabolize and respond
to a drug now the Vanderbilt side was
looking in particular at drugs being
used for cardiac arrhythmia therapy so
one of the drugs being studied was
warfarin the brand name that you'll most
commonly see for warfarin I can make it
move is coumadin warfarin is an
anticoagulant and it was developed in
the 1940s and had a very interesting
original purpose does anyone in here
know you got it rat poison that brings
up a question right I'm not an expert on
the subject but as I understand it there
was a US Army soldier who attempted
suicide using warfarin a known antidote
saved his life and somehow observations
of his condition in his response led to
interest in warfarin as a drug and I'll
leave a little gap there for you between
that and how they wanted to prescribing
it but that's that's how I understand it
so what does warfarin do well if as I
said it's an anticoagulant which means
it thins your blood common use is to
treat atrial fibrillation which is the
most common cardio
arrhythmia seen in clinical settings now
when you're prescribing warfarin has a
provider you need to watch someone's
what's called INR it's the international
normalized range and it's a measure of
the Bloods resistance to clotting so the
physician has to watch this and they use
a titration process when they're
prescribing warfarin to a new patient so
if you're starting warfarin you're
probably going to go in at the beginning
go in every day and have blood drawn and
they're going to see okay what what's
their INR after using this dosage so
they're going to move your dosage up and
down until they get you where they want
you which is the therapeutic range so a
common therapeutic range this very some
depending on a particular patient their
condition maybe if they've got valve
replacements different things that it
might move but a common value that they
would want once you between would be two
and three now if your INR is below to
you're at a greater risk of clotting
clotting bad blood clot goes to the
lungs goes to the brain bad things
happen if it's above three well now
you're at a greater risk of bleeding so
you bleed out internally so obviously
it's something they have to watch
carefully so what were they studying at
Vanderbilt in in 2001-2002 well their
hypothesis hypothesis about warfarin was
that they could find a correlation
between genetic variations in people and
what their therapeutic warfarin dose was
so they go into the warfarin clinic they
capture DNA from those patients and then
keep a history also of how that patients
eye on our moves on the dosage they
prescribe and then go back and analyze
that data looking for correlations well
over time because consortium of
researchers from you know many
institutions compare notes and they they
come to a consensus these specific
genetic
variations affect how patient responds
to warfarin and we think we can improve
the prescription process so fast forward
a decade and now they've established
these links recommendations have been
published hey patients with this
genotype you can change their dosage in
this way there's just one little problem
and that is your doctor doesn't
typically have your genotypes when he's
prescribing warfarin to you and they're
enters predict predict is the
pharmacogenomic resource for enhanced
decisions in care and treatment your
standard SL a seven letter acronym so it
was a clinical program to introduce
genotyping for patients as something of
a routine practice first of its kind in
the country as I understand it and this
was actually launched in 2010 in the
clinic so it's designed to improve
patient outcomes by in helping
physicians better choose doses in some
cases choose different medications in a
way that was very very personalized to
that patient and it would give them
information on their genotypes and also
give the physician in information on the
implications of those genotypes for the
particular drug that they're prescribing
at the point of care so it's something
of a novel program well in addition to
warfarin what other drugs are they doing
this with well one was cool pitta grohl
this is actually the first drug that was
launched in and predict this is a
another blood thinner but it's used most
commonly in patients that have had
cardiac catheterization and a stamp
placement they're almost always sent
home and plavix but patients with
certain genotypes don't respond as well
to plavix so they need a different dose
and then there others who simply won't
metabolize it at all and they need a
different drug well if you need plavix
but your genotype doesn't want a lot of
them to
taba lies it you've got a problem right
if you're out if you're only getting
plavix so that was a great thing they
you know they estimate a number of lives
have been saved by patients that they
were able to contact them and say hey we
need to change your drug cuz you're not
getting the benefit you need here also
simvastatin stimulus that's a hard word
right now simvastatin this is a
cholesterol treatment and also hear some
genotypes need an alternate drug or
different dose tacrolimus is an aunty
rejection drug it's used commonly in
kidney transplant patients and can also
help guide the dosage that they need bio
purines these are used to treat several
kinds of patients autoimmune disorders
like Crohn's disease sometimes Annie
we're going to transplant recipients and
also a ll which is acute lymphoblastic
leukemia and it's another one where
dosages are are moved by genotypes I
also want to mention this is a separate
program Evander bill but something
similar in the cancer space there's a
different program that's it's got
different sponsors and oversight but
it's it's performed in the same
laboratory using a different genotyping
platform up for necessary reasons they
need they need different data than
predict us but they're actually
genotyping biopsy of the lignin tissue
and then that enables them to then
select better chemotherapy agents with
the tumors genotypes in mind these often
times a cancer patient they'll go on
chemotherapy they try one agent oh that
didn't work we're gonna try this one now
and that Annette ravages your body when
you're it may not be killing the tumor
but it's killing you right so this lets
them really improve the care of cancer
patients by giving them the most
effective drug they can so that's a
separate program but also exciting a
couple of things that are important to
note all these drugs that are used in
predicts there's scientific consensus
around how particular genotypes
act a patient's response to that drug
there are additional candidate drugs
there's a team at Vanderbilt that's
continually reviewing scientific
research publishing and looking for new
drugs that they can bring online in the
program looking to to do this with more
things lastly and most importantly I'm a
software guy don't make any medical
decisions based on anything I've said hi
I'm not a doctor so okay so the little
overview of the predict program how it
works it all begins with an order entry
in systems for the patient i listed a
couple up here there's actually more in
you sip vanderbilt these are
applications that by which an order may
come in there depends on whether you're
an inpatient and outpatient you're in
the clinic you're in a remote clinic all
different ways this can happen but the
practitioner creates an order for
predict and which triggers blood
specimens blood specimen collection so
the phlebotomist is their patients in
front of them they got they need all
this test so predict okay i need a
purple top tube of blood for that
they're going to draw that blood and the
order and the tube arrive in the the mdl
lab as we call it and they'll do
there'll be a paper order actually with
the tube in a little plastic sleeve and
they can start their work so they're
going to do DNA interaction on that
blood prepare for genotyping to put on
the instrument and they're going to do
their QC on the the results from there
it goes to clinical informatics where
they have a rules processing engine that
will look at the patient's particular
genotypes and determine what known DG is
fall out of that so DGI is a drug gene
interaction and all those DG is that are
calculated using those rules will go
into the patient's medical record so
they'll be there a is just data
so a physician could go and look for
those things but beyond that the most
important thing is this the CD s or
clinical decision support so if when a
physician goes to prescribe warfarin or
plavix or something else that this
patient has these d g oz in the record
it will go get a pop-up listed on the
screen that says hey this patient is
known to have this genotype which causes
this result in their response to this
drug you know consider adjusting their
dose this way consider this other
medication so that decision support is
there the physicians free to use that
ignore it you know that's that's left up
to the to the provider but that's the
critical piece of this now all these
clinical informatics pieces in blue
that's kind of over the wall for me if
you will that's not the part of the
system that i work on that's that's done
in the clinical informatics group
they're a big enterprise java team large
team they've written this homegrown EMR
system electronic medical record that is
a very large and complex piece of
software when you think that one system
supports your basic medical clinic users
all your inpatient and outpatient
situations that's a complex piece of
software but that's all over the wall
from what we're looking at today so
the order entry in green the blood
specimen and read those are data and
physical inputs respectively into the
lab and then the lab this is where
really the application that I've been
working on last three years is used so
it's August of 2010 and it's time to
code but there's not much time to code
because as I said it's August and we had
by the time all the discussions that
involved us began like eight months part
of this by the time all the requirements
kind of crystallizing we knew this is
what we have to build there's a four to
five weeks I've kind of tried to forget
this period but it was it was not much
time so we went with our bread and
butter at the time and it's a precious
stone and it was Ruby on Rails to three
so that's what they went into production
and it kind of laid out like this so
there's three really external interface
points here the two on the far left and
then down in the bottom in gray is the
clinical informatics systems so at the
top the orders file drop would have been
great to get those in real time but as
explained to us the query was too
expensive to do that at the time so
three times a day we got a drop of new
orders for predict now what that led to
is cases where the lab gets a tube of
blood they scan the barcode on it oh we
don't know anything about this yet so we
would have to just capture okay we have
a tube with this number on it and some
time later they'll tell us who this
belongs to you right it's that create an
image created an interesting situation
the next interphase point is the
genotype file drop which that's when
data comes off the instrument that
actually does the genotyping and the lab
tech says yes the results on the
instrument for the run
whole look good let's process these
results and we pull those out to assign
them to the two patients and then as I
said the also at the bottom and Gary the
clinical informatics piece was the third
interface point so in january two
thousand eleven we knew there's got to
be a better way to get orders and indeed
there is an hl7 at the top left there is
a specialized flavor of EDI many of you
probably had the pleasure working with
that in your careers so what we
initially did was put a little Erlang
listener up there was a nice library
that did what we needed in Erlang so
that's a little Damon thats it's a
listing on a port on the network order
comes in parses it and what we'd
actually do initially was parse it and
then past the data ended the same Ruby
script but that presented a problem
because the team that runs the hl7
messaging infrastructure really didn't
care for the startup time on the Ruby
script every time a message came in
because that it was a synchronous call
so that created one of our challenges
which led us to here and the first
appearance of closure in this
infrastructure so this is April 2012 the
hl7 listener gets modified so that it
just Cuse the data that is parsed into a
rabbit in queue queue and we have a new
closure piece that consumes that queue
and updates our database that went well
and by this time I've decided this
closure thing is the way to go so why
would we leave rails well first I'd seen
the functional light no that's not a
great reason to sell right so we had to
took more work to make this happen but
at bottom there was a project in
compatibility for us with rails had to
do with the short life cycle of rails
versions if you've used rails for any
length of time you're going to get seems
like 22 and a few years out of a given
version of of its support lifetime
beyond that there's the rails core team
has a pretty liberal policy where
deprecation is concerned you may have
seen and that folds out into extensive
application changes to just say with the
current rails release and that works for
some people for sure and insane this I
don't be critical of the rails core team
because they they need to guide the
project like they see fit but hey you
know I think in a lot of their use cases
they're using rails to build a product
that it it is what they're selling
basecamp whatever that is so every two
or three years they're fine with
rewriting that system just to stay
current in our environment though
applications have to run a lot longer
than that five ten years is common also
we have front-loaded budgets for
development most of what we do is grant
funded so the first two years we'll have
a lot of money for software development
and then after that just you know tiny
sliver of funds for maintenance and
finally closure was also a better fit
into the enterprise Java environment
which probably is where this application
will land one day for its its long-term
support the idea of enterprise
something's enterprise gets thrown
around a lot but in this case I think
with rails it was just a problem for us
that you know we couldn't afford to make
major changes to the system every two or
three years just to just to keep
security patches in
basically so the decision was to rewrite
but not yet got buy-in from the project
owners to do a rewrite and it was clear
now that it was time to do something
when I didn't tell you this when I first
walked into this lab in the summer of
2010 and asked them where do you track
what you've done with a given sample oh
and they turned around and there was
literally a green accounting ledger book
so they've got okay we have this sample
this is the patients name the doctor
that order did I mean air their
handwriting in this ledger book
everything about that sample to track
its progress through the lab that worked
prior to predict because this lab was
pretty low volume but when predict
launched we pushed about 12,000 samples
through there in the first three years
so that just wasn't one to be workable
for them so it was time for us to get
that workflow tracking into a system now
it was just something we wanted to do
that couldn't do with the initial launch
because of the short timeline so we
couldn't do the rewrite immediately
because we needed to do this workflow
tracking get rid of the green ledger
book so one more time closure came to
the rescue we put in place a log book
service that is a had a web service
interface so I didn't want to invest
more in the rails code so I didn't want
it we had to make scheme to changes in
order to accomplish this didn't want to
make those changes to the rails models
so we used a web service that would
provide you all the you know if if they
need to see okay what samples are
awaiting DNA extraction what needs to be
plated what needs to be reviewed for QC
all those all those views came from the
web service also any events like when
they released results from a plate of
genotypes all those changes to be
tracked on the the samples history went
into a rabbit queue again
and got handled by that log book service
so at this stage we had four distinct
applications running as part of the
system three languages if you don't
include JavaScript and that led us to
where you're heading now no confession
time when i submitted this talk abstract
there was a forward-looking statement it
used a current or past tense phrase to
describe this this is actually going to
be deployed next month or early January
depending on which maintenance window we
can hit but this is that now the what
will be the long-term predict
application so we still have the little
piece of airline because it has
performed very well it's been very
stable just just no reason to to monkey
with it it's also a much simpler library
situation in Erlang that would be to go
to one of the Java libraries for hl7
they're a lot more robust but also a lot
more complex so that's where the system
will land I want to say something about
a piece here this container that it's
running on top of if you're running on a
closure server application and you you
can articulate well why you're not
running it on this I would just urge you
to take a look and look at the mutant
you may be working a lot harder than you
need to and this week Jim crosses here
Toby Crawley's your Toby's talking on
front on Saturday I think a couple of
great guys you won't find nicer people
supporting software more helpful to help
you understand it beyond that there are
sea channel for a mutant I can recommend
just for the comedy
so have a look at a mutant if you
haven't already so predict is kind of
it's become a case for me of what I call
round trip research I think this is
fairly unusual in people in a position
like mine kind of back to the warfarin
story I've worked on a number of
research projects in my time in near the
last 12 years most of them kind of fall
into what would could be kind of
considered basic science and
investigators asking a very narrow
question they find the answer they
publish it and it kind of just sent you
downstream to that sometime later
another investigator somewhere else most
likely will be asking a question they'll
find that conclusion and they'll build
on top of it but it's an agonizingly
slow process to see something that's
done in the lab or an assistant that you
wrote actually make a difference for
someone in the health care setting so in
this case for warfarin it made the trip
all the way from it's a research
question to now we're using the results
of those research and it's it's
improving patients care today so that's
been a really exciting and gratifying
thing to be a part of and I had a
minuscule role in that research thing at
the beginning but it's still an exciting
thing to to see that there's actual
fruits of what we do so you know again
that's not a unique case those those
advancements happen all the time but
people like me don't get the chance to
be a part of them that frequently so
what are the challenges to predict going
forward well the first is a challenge
that many many many projects have
obviously funding the first two plus
years of this system the institution
actually underwrote the effort this was
a novel thing when we began doing it so
there wasn't really precedent for
insurance and others to to pay for worse
the institution said this is an
important thing that needs to happen we
want to prove it so more than 10,000
patients I don't know the exact number
more than 10,000 the institution just
aight the cost of you know the lab
supplies the people the software
development all those things now in the
current environment in health care and
also in researches it's a challenging
period because you've got you know
Affordable Care Act coming online so
there's a lot of question about what
what's going to be reimbursed in at what
rate you've got sequestration so all of
these nih-funded research efforts that
are going on that that's a challenging
environment now as well so funding is a
real and vital question at this point
beyond that it's a moving target and
you're talking about drug gene
interactions new drugs come out all the
time right there they're brought to
market and so all this investment in say
warfarin warfarin has these risks that
we talked about you know you've got a
closely monitor the putting someone on
warfarin well if there's a drug that
comes out that has a similar effect
without some of those risks you're going
to move to that so you know the work on
predict for a particular drug could lose
its clinical relevance so that's also a
challenge finally patient awareness and
awareness and acceptance some patients
are really scared of genotyping they
want no part of anyone having their
genotypes having that in their medical
record you know they're concerned about
privacy they just don't understand it
others others were really excited about
it right hey that's really cool let's do
that but for both of those groups then
the question comes at the end are they
willing to pay for it when when they're
being billed for this service you know
yes it's improving their health care but
are they willing to to bear that costs
directly so those are the challenges
that we're facing and this one a lot
faster than it did in practice
so we have time for questions
he any questions yes for which part the
first part the first part was and we
just go back so the first part was a
sickness hl7 consumer that actually was
built about a week and a half I think at
that point I had a little bit of
experience with with Erlang so that the
functional paradigm wasn't new certainly
was no expert enclosure at the time
still not that it went very quickly
that's one thing I really appreciated
about closure is I've worked with it it
took longer to get that loot dinner
production because there were other
hurdles but the the coding was very
quick somebody down here let's see a
hand yeah
the most powerful thing that attracted
me closure one of my favorite things is
when I look at the the Ruby code base
and compare that to the closure code
base that's doing the same task and just
how much less code there is that's one
of my favorite things I like the fact
that you know in picking us a stack here
for this you know this this is a
web-based system or browser based system
yet when you select a stack and closer
you you have to have a pretty good
awareness of what those pieces are and
how they work as opposed to rails where
you get a pretty it's not a monolith
piece of code but it's a monolithic
framework you kind of you know generally
people take it all and so that's been
helpful just knowing how the internals
work a lot more the clothing enclosure
has been a great fit for this to this
point yes
at the time we decided we were going to
do work with closure we we had five
developers on the team really one other
one really took it and ran with it
another did some work enclosure we we
still have could consider legacy systems
and rails that we're going to be
supporting for a long meal as long as
our teams around probably in some cases
so not everybody picked it up and ran
with it some decided they would prefer
to keep working on other technologies
but settings for your question okay if
you found a single point of failure who
said well I think actually it compared
to having it in Ruby I think it brings
it a little closer to the the clinical
informatics teams wheelhouse if you will
there they're all java i'm sure that
there's some closure enthusiasts over
there if not practitioners so but it
would have taken a really long time to
move to to Java for us so yes
with JRuby be a viable choice but it
doesn't address the challenges that
rails brought in as far as its lifecycle
of releases and things you'd still be
dependent on that so yes no yeah yes the
the question wasn't really raised
honestly by you anyone facing the
question I what I've seen in the closure
ecosystem is is kind of the opposite of
that frankly again you know it's a much
more modular case for us if we needed to
you know upgrade just one library for
you know for security reasons or
whatever that was something we could do
without near as much of a reach into our
code base as the rail setting yes
the learning curve and buying it the
learning curve i think for so much of it
comes down i think to the temperament of
the developer developers who are just
thirsty too to learn and you know like
the challenge of taking on a new tool
are going to have an easier time
obviously in someone who's just just
doing a job everybody I've seen
personally who's taking the time to
really get familiar with closure and
understanding the functional paradigm I
haven't seen anyone say yeah stuff for
me so but there is a learning curve and
my my personal experience I've tried to
to learn Scala also and found that to be
a much much larger language to try to
grasp and you I love some of the ideas
there as well but closure is a much
simpler challenge for me personally to
pick up okay yeah
yes
ah
we can do that kind of thing in general
but what we also have periods in the
Medical Center where they essentially
implement code freezes across the
systems because of you know different
events going on in the environment so it
may be that I think in September I think
there was a two-week freeze for instance
when they were bringing in a new staff
of residents for the year so they don't
want anything to change in the
environment while they're trying to do
that let's go so we do have some
restrictions like that because it's a
clinical system but in general you know
we can make small you know patches and
fixes and things as needed but this this
is a pretty big change it will be
putting in here obviously yes the
benefits of a mutant one would would
certainly be for me the the lannington
plugin for mutant it makes deployment
much simpler than some other things
obviously the pieces that it provides
the abstraction that that's there if
you're running on a mutant in its
current version and sounds like from
talking to Tobi this may change
wholesale in the next year or two but
you're running on top of jboss but you
don't know you're on jboss for the most
part because they've they've really put
wrappers around everything so you've got
Hornet q there for instance that you can
use for message queuing you've got you
know your your web server pieces there
so we're not directly running ring now
we're using a mutant web server there in
this particular environment we're using
rabbit in queue and that will continue
to use it some but that's because of the
airline client for Donald know that
there's an ER line client for hornetq I
think we'd have to go HTTP to do that
but
it's just been a simpler proposition
than been trying to run multiple
applications which is you know the
current system we're actually running
multiple applications on the server
close your applications so I'm looking
forward to getting that all into one
contiguous deployment with a mutant okay
thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>