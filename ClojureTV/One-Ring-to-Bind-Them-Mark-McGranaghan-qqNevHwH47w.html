<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>One Ring to Bind Them - Mark McGranaghan | Coder Coacher - Coaching Coders</title><meta content="One Ring to Bind Them - Mark McGranaghan - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/ClojureTV/">ClojureTV</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>One Ring to Bind Them - Mark McGranaghan</b></h2><h5 class="post__date">2012-12-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/qqNevHwH47w" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">rain fundamentally is a toolkit for
writing HTTP services enclosure or
perhaps a bit less abstractly for
writing web apps enclosure now ring was
born out of a very specific need of a
while ago and that need was I wanted to
explore web apps enclosure and I wanted
to run them on existing the great
existing Java web server infrastructure
but I did not want to run my web apps in
terms of the truly painful java servlets
api which you see an example with here
nor did I want to deploy it via the
xml-based configuration that is that
kind of dominates that scene what I
wanted was a closure web development
story that reflected the power and
simplicity and elegance of closure the
language and what we came up with was
something like this and this indeed was
what the original ring looked like an
assistant and it hasn't changed much
originally was conceived so that is
that's the hello world and ring which is
just a very beginning I mean Spring has
turned out to be quite a bit more than
that and it's grown substantially and so
what I'd like to do instead of enumerate
the things that ring has become is to
describe how we got here the whole point
of ring is abstraction it turns out that
a lot of nice things fall out of that in
particular we choose the right
abstractions and we get enormous power
find closure and that power then in turn
leads to better apps so this better apps
pit is actually the third thing down the
list and that turns out to be quite
important so what I'd like to do is is
walk through the story then so we start
at the very beginning this is your hello
world HTTP request this is what comes
down the socket which we need to have a
generator response and what we'd like to
do is take this request and apply our
closure or application logic magic and
generate some sort of HTTP response this
one which seems easy enough right that's
just HTTP to
buzzer and back again the problem is
that if you try to implement this
directly talking raw HTTP to closure or
even working this through some HTTP
specific API equal it would be very sad
you're going to be sad because the HTTP
the protocol is not the essence of your
application the essence of your
application is more likely to be
something like this right this is kind
of the core of the business logic that
you're really concerned about and in
fact that that the request looks like
this coming in or the response looks
like that going out aren't details that
you want to be concerned with at all at
the application level so we know we need
abstraction to the office the immediate
question is what is that abstraction
well we said this was the essence of our
app right and that should look
suspiciously like a function to you
that's better and this is this is
getting towards what ring is is all
about where applications are functions
and they're requesting responses are
closure data but of course / welcome is
in all that we get in the HTTP request
there's a lot more that comes in
basically there are a series of name
values we have the protocol HTTP that
you are on flash welcome the request
method that comes along get and so on
the host now these key value pairs
suggest a very natural representation
the closure program which is the amount
and indeed in ring the syntax formatting
is truly unfortunate here and bring the
requests are represented as vanilla
closure maps and likewise responses
again are abstractly key value sets of
key value pairs so we represent those as
maps as well in this case we have a
nested map for the HTTP headers that are
going out so then we have the requests
and responses data the application is
functions so this is then basically
bring in one slide this is the s
praying in terms of what the core of the
protocol is all about you have an
application which is a function it takes
a request represented as a map and
generates a response representatives a
map now this is so simple that it's
almost obvious but it's really important
it's the basis for all of the web
development goodness that grows out and
around a ring and the key is that we've
taken HTTP the protocol and moved it
into the space of the pervasive
interfaces of closure which are
functions and maps and so on and by
doing that we get to leverage all the
power that's inherent with those
abstractions so just kind of simplest
example would be pulling data out of
request there's no HCP specific API here
or HTTP object or get you are I or
whatever it's just a name value in a map
if we look up with a keyword like we do
anything else enclosure and that request
data is of course a persistent closure
data structure so all of our HTTP
manipulations are in terms of these
these persistent data structures so we
get a function functional programming by
default in our web applications and also
we get the whole closure library for
data structure manipulation so we get to
define our web apps in terms of closures
powerful closure core so we talked a
little bit about how the data
representation is useful we can look at
the functions now again the app is just
a function of the request that returns a
response but typically will want to
build our app and layers right and we do
that with so-called middleware
middleware is a layer of functionality
that you add around your app that
basically generates a new app by a
higher order functions so middleware is
a higher-order function of your original
app that returns this augmented
application to then implement some new
functionality which again is applied in
the exactly the same way he did your
original app which is function
application
so just to give an example of a kind of
power that representation buys you this
is a basic skeletal middleware for a
ring application so this middleware
takes the original app here as its
argument and generates a new app as its
return value and that new applicant is a
function of the request in this case it
checks if the request is authorized if
it is pass it back to the original app
otherwise it generates this for three
access denied response which is sent to
the client we also in addition to the
function definition goodness that we get
from closure we also get the function
composition all for free so for example
this is the comedy emmanouil see with
closure web apps should have some core
application which defines your business
logic and you wrap a series of
middlewares around it just using the
regular threading operator so there's no
special syntax or library or constructs
for for defining your complex web app
it's all in terms of closures native
functional programming infrastructure
and this is a nice little bonus that's
actually underappreciated I think in the
web development community because our
web applications are now just functions
that take and return data they can be
tested like any other function so this
is a test for the hell out road app that
we had earlier weird asserting that the
app when given the URI / welcome returns
hell are all on the body and now this is
completely orthogonal to whatever
testing framework you have it's just a
function that you're testing as normal
so I think we're starting to see how
choosing the right abstraction namely
closures functions and maps is is
lending by web developers power again
via closures closer to our core and it's
a structures but I promised you this
which is a strictly stronger statement
and we get that through some leverage
and that leverage comes in the form of
the ring spec and the ring library
ecosystem so the spec is the foundation
for this just the document that that
defines how this is how this core
interaction works in particular it says
what has to be in that request map and
what has to be in that response map and
how that function needs to behave and
how participants and the application are
allowed to modify the requests and
responses they flow through the
application and again how middleware is
allowed to augment and redefine act and
the ring spec itself is very simple most
of it's just super obvious stuff that
you would expect by default but it's
really important because it facilitates
this ecosystem of framework agnostic
ring libraries and these libraries again
they all communicate over this protocol
that's based on closures core
abstractions and that's defined in the
ring spec so everyone everyone including
ring itself works through this protocol
so nothing special about the so-called
ring libraries other that they happen to
be included in the rain source tree
which is really just a matter of
convenience of distribution but they're
here because they're the sort of battery
included web development things that you
would you would probably use in a lot of
your projects so for example when you're
doing local development you often have
different needs that you want to invoke
specifically for your development
purposes so here for example this is
something I do a lot I have a core app
and I create a special development
application that is the core app plus
some mill aware that will print my staff
traces on my HTML page when the
application air is out and reload all my
relevant namespaces whatever request
comes in this is stuff that you get for
free with ring and then you can apply to
any framework or whatever you happen to
be using this is another bit of
functionality that's provided by ring
itself it's a it's a mechanism for
generating responses in a functional
style in case you don't want to omit
Maps directly which is reasonable I
think
this is an interesting example it's
another thing that the rink or libraries
do which is facilitate interrupt when we
need additional interfaces between
participants so in the case of sessions
people are going to have all kinds of
random ways they want to store and
retrieve their session it might be
memory or the database or a react
cluster or whatever but it'd be great if
all the participants in the ring
ecosystem could write their session
using code against some common air face
and that's exactly what the ring session
library provides so as an application or
library developer i can write session
code like this and then at runtime the
person who's deploying their app can
configure the session to use whatever
back end they want and sessions are also
an interesting example because they show
rings insistence on being pervasively
functional so even sessions which are
kind of fundamentally stateful we insist
that they're represented a functional
way as a functional modification of the
response so that we ensure that ringing
has really good composability and safety
and like I said the ring libraries are
just one piece of the big and growing
ecosystem because of the spec and the
protocol that everyone shares the entire
community can participate in ring apps
is first-class citizens so this is just
a shot of our github wiki we're keeping
track of some of the things that people
are developing for ring and these are
all sort these will do various different
things but what's great is that they
could be composed orthogonal II so
anyone can take whatever pieces of this
they find compelling and stick it right
into their app and I'd like to highlight
a few of the pieces that I think are
particularly interesting so the the
first and the one that you would expect
immediately is what people often call
frameworks I think is that unfortunate
word because it has a bad history but
what we really mean is application
composition libraries and I think the
best example of this is composure
composure is a nice little library for
letting you define HTML routes and time
closure code and threading parameters
that are emitted with those routes into
your code this is just a simple example
that is a composure app but again
composure just is a tool for defining
these these ring functions and you can
take the result of composure or any
other library and stick it on to any
ring adapter that you want so here we're
running our composure app and jetty and
because we have defined this clean
interface this piece here is totally
separable so we can choose whatever
adapter and whatever framework we are
interested in another deep fact about
composure it is it's probably the most
common answer to the question how do I
write a web app enclosure but the
library itself is less than 200 lines of
closure code I think this trip really
yeah I think it's a really neat
testament to how well James has done
with embracing the notion of frameworks
as libraries instead of monolithic
things and how rain helps facilitate
that so I mentioned this idea of
adapters adapters are just the piece
that actually runs your application in
terms of the HTTP protocol so typically
they're just simple glue code around
existing java web servers so the first
one that i wrote the thing that
originally but i originally wrote that
it eventually became ring is ring
adapter jetty which is a wrapper around
the embedded web jetty web server which
is nice because this performance yet
it's really easy to embed but you can
just as well take whatever app you have
and throw in a different adapter it's
just a matter of changing a few lines of
your code because again they all
communicate via the standard praying
interface and there are there's a
variety of adapters now they're sprung
up and we're only one function away from
your favorite adapter there and lastly
this middle winner so like I said middle
where is this tool for adding layers of
functionality to your application in a
clean way and we see a lot of
interesting middleware popping up what's
neat is that in order to participate in
the rain ecosystem here you just need to
write one higher
function and you're in so like rain JSON
Rams it has one function rap JSON params
and you write that you throw it in your
aquifer and now you have JSON parsing
and your keyword params fit in your
request so you get a lot of a lot of
basic HTTP stuff via build aware that
isn't framework or a specific but what
you want to share across the ecosystem
now individually these aren't really
compelling like basic basic HTTP
authentication that's pretty vanilla
right but what's really interesting is
when you have the whole ecosystem coming
together around this common interface so
this is something that I copy I copy and
pasted almost directly from my most
recent ring out and it shows how you
have your core handler that's the
handler that defines like my main
business logic and then you layer on a
variety of middle where's that come from
all over the place and that were written
by different people at different times
some of these are from Marine Corps some
of these are public github projects
others are things that were written
specifically for the application and so
on but it's all homogeneous here
everyone's participating as a first
class citizen equally and it's also
really clear to see exactly what's going
on there's absolutely no magic here this
is just straight up closure a functional
composition so I hope we're starting to
see how choosing the right abstraction
and using that abstraction to leverage
closures power is leading potentially to
better web apps We certainly have ways
to go with that but I think we're out a
great start what I like to do now is
generalize this a little bit and that
generalization takes us back to where we
started with ring the key to ring was
taking the HTTP protocol and moving it
into the space of closures pervasive
abstractions which in this case are
functions and maps and what we did that
we got this great functional programming
and composability all for free and in
particular we we define fraying
way that it was cleanly composable and
furthermore composable across kind of
developer is in time and libraries and
frameworks on a clean way and in a way
that was totally a total natural fit
with closures functional programming
infrastructure and I have a very
specific name for this I call it
composable abstraction whenever I meet a
programmer I try to sell them on this
idea and for me personally this is the
essence of closure this closure has a
whole a whole bullet point list of
features things like persistent data
structures and the data structure
library and the notion of value
statement entity and same change over
time to me those are knowledge aslam
what is the closure is master theorem
which is composed of wasps fractioning
and I think that brain does a good job
of demonstrating the potential of this
so I'm interested in ring not just as
something end of itself for this talk
but also as a potential archetype for
other closure libraries so let's think
about what is a particular example where
we could use this style of library
design well I could give you a whole
list and I'm happy to talk to you about
it offline but we actually don't need to
go any farther than HTTP to see another
great example this was the raw protocol
that we're dealing with before as the
server right we had some requests and we
wanted to generate a response in the
clean closure friendly way so we came up
with this bit here we have an app which
is a function that takes a request map
as an argument and returns a response
back as a result well we can apply the
exact same trick for HTTP clients boom
this is exactly how clj HTTP defines
clients it uses almost exactly the same
protocol on the client side with a
request map representing the request
that it wants to send to the server it
uses some underlying adapter to send
that request over the wire it gets it
back and parses it into
response man and again when we do this
we get all kinds of great things for
free immediately this is just an example
of how you can implement a always
authenticated HTTP client immediately in
terms of closures existing functional
programming tools and data structures so
the net look the net lesson there is
that when you choose the right
abstraction especially one that moves us
into the space of closures pervasive
abstractions then we get for free
transitively all of closures awesome
functional programming goodness and that
in turn leads to better apps so I think
that the most important lesson here is
not about web development it's about how
to think about library design and that
is that if you want steps two and three
here you have to be sure to do step one
right thanks everyone
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>