<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Proto REPL, a New Clojure Development and Visualization Tool - Jason Gilman | Coder Coacher - Coaching Coders</title><meta content="Proto REPL, a New Clojure Development and Visualization Tool - Jason Gilman - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/ClojureTV/">ClojureTV</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Proto REPL, a New Clojure Development and Visualization Tool - Jason Gilman</b></h2><h5 class="post__date">2016-12-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/buPPGxOnBnk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">and today I'm going to talk to you about
proto Apple which is a closure
development and visualization tool that
I built so about five years ago I saw
two talks that were really influential
to me
they were simple made easy by rich
Hickey and inventing on principle by
Brett Victor so I'm pretty sure that
yeah is this better
okay I'll just try and speak up too and
let me know if you can hear me so I'm
pretty sure that a lot of people here
know simple made easy
you know you've probably seen it if you
haven't you should definitely go do that
and I even rewatched it again for this
talk and it still holds up it's a great
talk
but in it Richards talking about the
difference between simple and easy he
talks about complexity being kind of
this employment tangled together and
simplicity being one braid or no
braiding and this example here with with
a knitted castle out of yarn is kind of
being an example of that complexity
versus something built out of Legos an
easy means something that's close near
at hand and he said as software
developers a lot of times we are
choosing the easy thing which means
something that's familiar to us
something that's we know like you know
an object-oriented programming language
instead of choosing something that might
be harder at first but would really
reduce the complexity that we have to
deal with you might remember the
inventing on principle talk from kind of
the amazing demos that Brett Victor had
if you haven't seen this one this is
another one you should definitely see
but Brett's principle was creators need
an immediate connection to the thing
that they're creating so if you think
about a painter and you have a
paintbrush as soon as you paint onto the
canvas you see the reaction of that
action there and so there is no delay
but a software developers a lot of times
we're working blindly in a text editor
you know making changes and then we
compile and then we run it and then we
see the result but it's hard to see you
know the the impact of any particular
action
that shows up there unlike with a with a
paintbrush you see the immediate
reaction you know which stroke made
which you know change appear and so he
showed different ways of achieving
something that would give us more
connectivity more understanding of what
we're actually doing so in my mind you
know because I saw these talks so close
together and they both kind of blew me
away they were they were entwined and
there's a lot of similarities between
them they were talking about shared
frustrations rich was talking about
frustrations with the language that were
using the building blocks and the the
choices that we continue to make as
software developers Brett was talking
about the frustrations with our tools
letting us down and they were kind of
caused by state being the problem so
rich was talking about additional
complexity added that wasn't necessarily
that didn't have to be there but that
was the problem that we're always
dealing with is managing state and
Brett's point was a lot of times the
state is invisible to us and so you have
to juggle all this in your head and so
one of the metaphors rich used was
juggler and so like the best jugglers in
the world can juggle something like nine
balls and but that doesn't seem that's
not much more than three and if you
think about juggling all this state in
your mind we are not getting better at
doing this you cannot slowly over time
once you get to the age of sixty be able
to you know understand five times as
much as you could at the age of twenty
so in order to get better we have to do
something else we have to reduce the
amount of state the complexity and we
have to make sure that the state that is
there is visible to us so other people
saw this and they had similar ideas so
Chris Granger started a Kickstarter back
then to build a new editor called light
table and when I saw all of these things
happening I thought the future is here
this is amazing
this is awesome and I was impatient for
it I wanted it now but but how how do it
how do I get there you know with the
technologies that we have so one of the
things that I think wasn't emphasized
enough was data visualization but
I think this is part of the solution to
understanding what's happening so state
is at the core of our applications state
is data and data visualization is the
existing solution out there that's
well-known that we should reach to it is
the fastest way to get information into
your brain and it uses the existing
abilities and pattern matching and and
all this things that you have that
you've evolved to keep you alive
you know spotting dangers and things
like that that's this is the best way so
I started looking to come up with
solutions how can I start doing this
myself and so I started building little
visualizations that would run in the web
browser
so I was dealing with spatial algorithms
at the time and instead of just looking
at numbers for latitude and longitude I
would throw them up in the web browser
in a map and show metadata and things
like that and this was really helpful
like when there's a problem I could see
I could see what the problem was and it
made it it made me faster as a developer
and it made me spot problems that I
wouldn't have otherwise have seen and so
I thought this was part of the way
forward having a web browser show a
visualization that represented the state
of the system seemed like a solution and
you would just run it along side of your
coding environment use something like
WebSockets to ship the data over as it
changed and I talked about this at
Strange Loop in 2013 and I created a
little library that handled like the
data transfer and I call this
visualization driven development this
didn't catch on you know but I think
there was some problems with this one is
I think that this separation gives you
limited capabilities like putting
something side-by-side in this other
window means you can't do as much like
actually in your editor you want to see
like the state you can only show one
thing in your browser and you can't tell
like if you're going to show multiple
things which lines of code do they tie
to or which parts of your application
you end up juggling windows and that it
just makes that difficult and I think
that one of the biggest problems was
that I didn't provide visualizations for
people I thought you should use your own
visual Izzie
Asians you have different kinds of state
so figure that out yourself and that's a
hard pill for people to swallow when
it's when I'm telling you should do this
thing and but it's going to require a
lot of work not many people want to do
that because it wasn't easy for them it
wasn't near at hand and so this wasn't a
complete solution so what I realized
that what we need is an integrated
solution
I want you to consider the repple for a
minute so rebels are great they're like
these portholes into our applications
that we can see what's going on and many
languages have them so you can be in in
Ruby Python JavaScript you have a rebel
rebel but one thing that I noticed about
the way we develop things with closure
that is really awesome is we use a
integrated editor and rebel together and
the integration there is really makes
this shine here way better than just the
repple on its own you can write a small
amount of code you can execute it see
what the result is
you can modify that code see it again
and so you do have this connectivity so
we're actually already with the way
closure was done way back then and
forever handling some of the problems
that Brett Victor was talking about the
important part here is the integration
lets you do more and that's why I think
we need to bring visualization data
visualization into that as well we
combine them together we'll be able to
get farther with that and so now I want
to do oh wait wrong slides okay fast
word of 2014 so 2014 the atom text
editor comes out so this is a text
editor from github the company and makes
it and when I saw this I thought this
was the right solution the right place
to bring all these things together so
why atom one is that this is a
general-purpose text editor backed by a
real company so I want to bring you know
I want a real solution to exist anything
that I don't have to build myself that
somebody else provides is a good thing
and this is a full-time set of full-time
engineers I assume full-time anyway that
are being paid money to handle all the
problems of building a text editor which
is great that I don't have to worry
about that and they handle the problems
of how do you display CSS and Ruby and
whether you know all these other things
that you would have to do because it's
not an easy thing to build it's also
open source it's pretty popular and it's
extensible which means other people are
building extensions to it so things like
per edit and parent fur all exist for
Adam and I think Adam was I think was
the first place that parent fur was
appeared you know as a place you could
actually use it I'm not sure if that's
true or not but it was very early okay
great
so because it's open source I can look
at the code if I want to extend it
myself it's great to be able to see how
am I going to integrate with this and
because it's not closed source I can
actually understand the the
underpinnings of Adam how it works and
maybe the most important thing is that
it's built on web technologies and tools
so Adam is built on the chromium base
which is that which is a base for the
Chrome web browser and nodejs
and so chromium itself is open source
and I think chrome it's not but that
means that Adam is basically just this
glorified web browser kind of dedicated
to editing text and so I can bring up
chrome dev tools in Adam and select an
element as part of the GUI and see the
Dom node that's associated with that the
CSS styles that are applied to that you
get a lot of benefits and one of them is
that the chrome dev tools thing is there
which means that I can debug proto repo
using chrome dev tools which are really
good it's also extensible via CSS and
JavaScript so we're not inventing new
things here these are existing
technologies that are well-known and
that means things like closure script we
can transpile and run in Adam and parts
of proto Apple are written in closure
script itself and other packages as well
also the Dom so this is really important
if you think about we built a new GUI
and we build it in Java and swing if I
wanted to just attach you know a
visualization onto some arbitrary
element I might not be able to do that
as a plug-in but because adam has you
know has this Dom that's always
available
I can reference any particular element
in there and highlight code or do other
things that might not be possible and
existing web visualizations like d3 will
just work right inside of atom so if you
go online and you search for web
visualization tools you will find a
bunch of different websites that compile
them and then they'll show like your are
the best of the best and there are just
tons and tons out there the web has been
great for data visualization and there's
so many things out there where people
have already built great tools and
people have found the good ones and
they've been you know fixing them for
many many years and so we can just take
all these this is another thing that we
don't have to build ourselves we already
know how to visualize data there's
already tools that we can use okay now
I'm going to show some demos of proto
Ruppel itself okay so this is this is
proto repple so over here on the left
side I've got a closure file and this is
the repple on the right side and it
works like you'd expect it to so I can
execute some code I can get some result
I could put my cursor inside of a
closure block and I can say send that
block to the repple and I get a result
back and so this is all pretty standard
you'll notice I get inline result here
so I don't even need the repple to be
front and center so I'm just going to
move that to the back and I can say
evaluate this other block which is a
vector and so vectors evaluate to
themselves so I get this vector back
when proto repple gets a value back it
looks at it and if it's a simple value
it just displays it but if it's another
nested structure like a vector or map or
sequence it displays it using an inline
expandable view so we can expand this
and you know navigate down deeply nested
trees the inline displays and the
styling and the styling of the repple
itself is provided by another atom
package called atom Inc which is pretty
cool and so this is just another way
that we can leverage other people
leverage the work that other people are
doing I'm going to show you some more
examples here so I'm going to define
this var
card so this is a sequence of tuples so
we've got a number and the suit in each
there and so I'm going to take the cards
shuffle them take the top ten and group
them by their suit so as I start to type
in code you can see I have completion
with documentation in place and so now
as you type in code
I can see does does it work and start
running it and shuffle is working so now
you can continue on take the top ten
group by the suit and the suits the
second item in each tuple so I'm going
to do second I'm going to execute the
whole block and I get back a map and now
I can navigate down to a part that I
care about like I want to see what
diamonds do I have in my hand or hearts
I mean I've got the Queen the ACE the
eighth and the Jack we deal with large
nested data structures enclosure all the
time and it's nice when you get
something back like this that I can go
and just search through it and look at
just the parts that I care about while
I'm ignoring the other parts this is
very handy okay and I mentioned
completion before so we have completion
of namespaces completions of functions
in those namespaces I can bring up
inline documentation and I can also jump
to definitions so closure string join
that's inside of a jar file in my local
maven repo and when I say open here it's
going to find that jar file it's going
to unzip it find the right space in the
file and go to that and parent fur here
is detecting that closure namespace has
some initation problems so I would say I
don't want to fix that right now but I
jump right there so this is great I
won't understand how this function works
I can jump right to it and I can even do
that with macros so I can see how does
loop work it can jump to that so here's
loop and I can jump to your def macro
can keep doing this down and down until
it gets to the java code in closure and
then it doesn't work anymore okay so
what about debugging code one of the
things that I wanted to make easy to do
is understand what are the values
flowing through your system how do you
you know how do you be able to
manipulate them and use them at the
repple like we're used to being able to
do so there's a save macro in proto
Apple that will allow this to work so I
have a some code here and it doesn't
work there's a bug in it so I've got
this set of tuples here it's fruit and a
count and this might represent some
sales throughout the day at my fruit
stand so I sold some apples and then I
oranges and I sold apples again and then
cherries I want to get like accumulated
total and if I run this right now you'll
see that I have the bug I get a
nullpointerexception
so what I can do is insert some save
calls in here to say what are the values
flowing through it and save takes a
identifier to kind of uniquely identify
which save it is save recognizes local
binding values and whenever it's called
it saves those so that I can take a look
at them later so it's going to save all
of them and if I call the function again
it failed again and I can say display it
and so what pops up is an inline
expandable table that shows all the
values that save saw at that point so
this call saw em you know empty map
quantity to fruit apples and this one
you know got the same things but also
current quantity was in scope they're
there this was only called once which is
why there's only one row and here each
row is expandable so I can look down and
if there was a nested value here that
was more complex in an empty map I could
go down into that as well so this is a
pretty simple bug to fix and I could
certainly guess any one of you could fix
it without needing some of these
advanced you know display views but if
it was a more complicated one a lot of
times like when you're working at the
repple you want to be able to just type
in some code run it and see what it
works so I want to type in a solution
here and see if it works I don't have
example values when you're you know
you're down here in some nested closure
code but what save does since its
captured these values it can make them
available for you to execute them at the
repple there's a def button next to each
one of these and if I hit this death
button what it does is it takes the
local binding values and it makes them
temporary local VARs for this namespace
so now that I did that it knows what n
is and it knows what fruit is and
current quantity is new and so I can
just execute this inner block here to
reproduce the problem I get the nil and
now I'm going to write some code to try
and fix it so now I can see does it
actually fix it here at that same point
with that same data and I can see yes it
does and I can run the larger one so if
I run this again I get the right result
and I can display it and this shows that
yeah we capture all of the values with a
traditional debugger you get one point
in time right now that's where you're
just stopping the world and I'm not
dissing to traditional debuggers they
are really useful this is just another
way of debugging because I can see all
of the values and I can grab one you
know out I can say I want this third
iteration
give me those values and now I can start
working with those to do things and try
out see what those do okay so let's talk
about visualizations so proto apple
itself does not come with any built-in
visualizations other than like this
inline display which is a visualization
of a sort it's like a tree view the way
that proto apple is built is it expects
that other packages and Adam will
provide the visualization capabilities
and so I've built one called proto
repple charts that provides that and
purple charts is divided into two parts
so one is a closure library that you
include and the other part is an atom
package that you install so it provides
functions like line shard here and so
this is the name of the data that we're
going to display and this is a map just
some a simple closure data and I can run
this now and so now I have a graph that
shows up here what the closure part does
is it just takes the data and reformats
it and it makes it so that when proto
repple sees the value come back at the
repple it knows this is data that should
be displayed proto apple charts in atom
has registered itself with proto repple
and it gets sent the data and then
displays that graph
so now that I have this graph here it's
got some features like you can hover and
see the values at any point I can hover
over the legend and see individual
values and I can hide things if I want
to focus on some specific values and
we've got bar charts so here's gross
domestic product per year I'm not an
economist so I think that's what that
stands for
and same kind of features the shape of
the data for all of these is the same so
that makes it easy to use as you go from
one function to the next and they both
take options like labels here to label
the the bottom and we can also do
scatter charts here I'm going to define
a thread-local random and I'm gonna do
Gaussian 200 of those and uniform
distribution display this so now I've
got trimmed of those and so I can hover
above and see individual values and now
you can see it makes it easy to see the
difference so this is like a visual
distinction between the difference
between Gaussian and uniform uniform
being between 0 and 1 Gaussian not so we
this is just displaying canned data when
we're inside you know closure or we want
to take advantage of like some of the
capabilities that closure has and
manipulating data and we've got data
flowing through our systems we want to
grab those out and display them so I'm
going to show you some examples of that
so I've downloaded a CSV file of all the
baby names used between 1880 and 2014
and counts and I've already pulled that
out onto maps and I'll just show you
what that data looks like here so here
you get like Mary the Year 1880 count
7000 gender so proto repple charts the
what I've done when I've selected the
visualizations to use is I've gone out
and not these aren't visualizations that
I built myself I found one for this this
is called c3 that does the visualization
here and it has what I would call like a
data centric API basically everything
about what it displays is handed to it
as JSON data which is great you know
coming from closure that's the way that
I like to work and I don't hide any of
the capabilities of c3 itself you can go
online and get the
communication force III and you can take
that and calling the proto Apple charts
function custom chart you can pass any
options that c3 allows so one thing that
I don't provide is a time series
capability but c3 has that so you can
usually easily access that and I've
wrapped it in a time series function
here and so now I can do something like
show me the usage of the name Jason over
that time period and compare it to
another name so I'm just going to take
the records I filter out the ones that
are Jason and get the counts and do that
from Michael as well and I can call this
time series function that is just
defined so now I've got it and one of
the great things about visualizing data
is that patterns pop out problems pop
out as well and this I don't know if you
notice it that this does not look right
if I remove one of these makes it easier
to see it looks like on the even years
the name Jason is not popular and then
on the odd years Jason gets more popular
but the same thing happens with Michael
and so I don't think this is actually
true so we can go look at the data and
see if we can find the problem so if I
comment out this one here and then show
let's look at the last couple so now
when we look at it you can kind of see
that why this is the problems I didn't
realize at the beginning that the data
is separated by gender that there's
female uses of the of the name Michael
and male uses which are no more popular
because it's a more popular male name
and so that meant that my function I was
just gathering the data incorrectly
what's that
and so now I've written a function to
pull out that data correctly now so I'm
going to filter by name group them by
year and now I can add up all the uses
by you know by gender and they get the
same thing out so now I can graph Jason
and Michael and see the popularity
difference over time so you can see
right around here when I was born that
was about the peak of popularity of
Jason and then it's gone downhill ever
since then
okay so as software developers you know
it's nice to have line charts and bar
charts and scatter charts but that's not
the majority of the data that we work
with we work with things like trees and
so there is a another capability in
proto Apple charts for displaying graphs
or also known as networks and so this
defines a set of you know a name for the
data set of nodes and edges and if I
display this now I've got this instead
of nodes and edges here that pops up and
this so this is I can zoom in and out on
this data move around and it's live and
you know it's got a force-directed
layout and so I can add some more data
here so this is weird but it's a
connected to e so we deal with this
shape of data all the time you know
there is abstract syntax trees we have
graphs of dependencies we've got
different components that are using each
other network layout topologies and all
sorts of things like that even like call
graphs so if you call a function that
calls to functions and those call to
functions that's a big tree as well and
so being able to easily take that data
and just display it is really handy so
I'm going to call this function down
here I've written ahead of time and this
uses closure tools namespace and it
which keeps track of all the namespaces
used in your system so that you can
reload your development environment at
runtime and so it just has this data
that's sitting there what namespace
requires which namespace and what
namespace requires another namespace so
this is a the current project that I'm
using and you can see it there so if i
zoom down this is this is the core of my
system here the yellow ones and so I can
see going to track what are they using
so like composure here it was hard to
see one that I like to look at is insta
parse which is pretty complicated
this is great like being able to see
things and because I can just grab these
nodes and drag them around it makes it
easy to see like which ones come along
with it and those are the ones that are
connected but having this ability to
look at your system is really useful now
I can see you know that I'm using
composure and it's using one little
thing here it might be dragging in a big
ball of stuff that I might not want or
maybe I do want it some some libraries
you know realize that it's good to
visualize and so they will use something
like graph this and so that's that's a
really great tool and you get a PNG out
of that but it's nice to be able to have
something integrated into your editor
that you can zoom in and out on that's
that's live if I make a change in my
system I can immediately see the result
of it so this is a static analysis of
our of our program
what about like live real-time so I have
a I've got a composure application
there's another tool that somebody's
going to talk about bill peel as I think
his name later today called Sayid I just
found out about that last week
so what Sayid does is it can start
tracing calls on different namespaces so
if I require this here and I make this
call what's I eat is going to do is
start tracing the calls on these two
namespaces and onto functions it's going
to like in particular do kind of a kind
of a deeper more throw tracing and then
when I make a request to my web
application I'm going to say create an
account for Jane Smith with five hundred
so I eat is capture this data and so
Sayid is really cool and I won't go into
too much detail you should see his talk
later for that but it's also got just
this data out there this graph of data
and so we can take that same data and
send that to purple charts to display in
a similar manner proto Apple charts uses
this Jas for this and it's another data
centric JavaScript API and so I can tell
it I want to use a hierarchical layout
for this and I can specify groups and
things like that to use as different
colors so you can see here's where
create account was called the
integration here makes us more powerful
because now I can make this
interactive so if I double-click on this
I simply told it when you double-click
on it I want you to ask Sayid what is
the idea of this node where was this
captured and it can jump to that and
display:inline at that point in time
what arguments did that function call
get so I can see here are the parameters
passed to that I can see what did it
return and I can jump around to
different parts here and see what did
they get
so find this really useful and to be
able to do this and this stuff right now
this site thing because I you know I
only put this together last week it's
not part of protocol now but it shows
the power when you take all these
different things that are data centric
and you bring them closer together and
so you can start to leverage a lot more
that way so I want to leave you with
like a thought like don't wait for the
future that impatience can be a virtue
oh there are things out there that we
can accomplish like you know if you need
a new tool like we are the tool builders
and we can make it so thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>