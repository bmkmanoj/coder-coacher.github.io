<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Charting the English Language...in pure Clojure - Alexander Mann | Coder Coacher - Coaching Coders</title><meta content="Charting the English Language...in pure Clojure - Alexander Mann - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/ClojureTV/">ClojureTV</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Charting the English Language...in pure Clojure - Alexander Mann</b></h2><h5 class="post__date">2016-12-01</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/qRXhjElFJJE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">my name is Alex man I am a programmer at
Circle C i i've been using closure now
for about three years recovering lisp
addict so just kick that off so when i
first set out to talk at cons because of
course i was going to talk at cons not
actually make something cool than talk
at cons i was thinking of possibly
talking about a production outage that
we had at rj metrics where a closure
cord arrived like the actual closure
core function stopped working in
production mystically due to possibly
some update in Hadoop or the JVM or a
bun two or something ultimately never
figured that out and just hacked around
it I was thinking oh I could talk about
the differences between docker and
vagrant and the circle environment and
the Hadoop JVM and the regular JVM and
then I was thinking oh I could talk
about why the repple actually really
sucks which would of course have been
blasphemy but I thought that I would try
and do something fun instead of this is
production woes that we've encountered
and this is why you should use closure
and all this other stuff so I decided
Matt address talk last year about
closure core typing I know that I wasn't
the only one who walked into that talk
and felt a little bit confused when it
was about keyboards so I ended up
walking out of that and had learned all
about how you can print circuit boards
using an inkjet printer you can or how
Smith and Wesson is actually tied to vim
and emacs and how that we view the
keyboard and qwerty today so it was
really really interesting to go to that
talk and I thought oh well I'd like to
do something like that you know
something kind of light and easy so this
image that you're viewing on one of
these two two screens here is an image
that was written by or developed by a
gentleman by the name of Joseph Torian
it is built on top of the Wikipedia
corpus from 2007 on top of or the Sena
model that was developed by Colbert and
Weston in a roughly 2011 so what you're
looking at is the English language
charted in two dimensions this is 2500
of the most popular English word
birds and their relationships there in
this is first presented to me at the
University of Toronto from Geoffrey
Hinton and it involves buzzwords all
over the place just big data machine
learning and matrices linear algebra
blah blah blah and I thought you know I
would really like to do a talk all about
yak shaving and sort of a deep dive into
closure deep dive into the jvm learning
about the state of machine learning
enclosure and finally and most
importantly making some some really cool
images that I can use his art in my flat
what I hope that you're going to get out
of this is a history on this entire
process a checklist for how to proceed
in actually charting the English
language enclosure because spoiler alert
I didn't succeed highlighting some cool
features and things I learned in the
code that I I writ writ well read and
wrote then talking about the state of
machine learning enclosure and most
interestingly actually highlighting some
of these images which are really really
cool so to kick it all off how it's
built the machine learning addition so
how do you get from bits and bytes to
this image well you've got to start by
collecting and tokenizing your corpus
you've got to train a model on top of
that generate a bunch of feature vectors
reduce the dimensionality of those
feature vectors and then present some
data viz or simplified feature vectors
for data humans to understand which is
all really simple everybody got that
right more simply you need a collective
data set make a machine-readable let a
deep neural net gain an understanding of
that data set use the underlying weight
matrix that is more or less the machines
brain as feature vectors you will have a
bunch of information after that which is
presented to you in the form of very
precise doubles so you need to actually
make that fit for human consumption and
make pretty pictures the technology that
is used at each step is the week vici
wikipedia corpus sent a model or
architecture the embedded weights from
that then a algorithm called TS any
which reduces this data set down to
something that humans can grasp with and
finally I used SVG to render everything
so you can zoom in on any given section
and it'll will remain will maintain it
precision so when I talk about Senna
this is a technology that was developed
by Colbert in Weston in roughly 2011 and
it is a deep neural net approach to
doing natural language processing so
what that means is that they gave it
Wikipedia and the machine just sort of
ended up understanding relationships
between words that we wouldn't have and
it does this by using a multi-layered
semantic tagging parts of speech
approach to sort of grappling with hey
what the hell do any of these things
actually mean TS any is t distributed
stochastic neighbor embedding and what
this is is a way to reduce these very
large data sets 130,000 rose by 50
columns down to maybe two dimensions two
columns and it does this in such a way
that preserves a metric space between
words so if you think of if you think of
a parking lot and you see a big car in a
little car it's probably that the little
car is actually just further away your
brain totally understands Oh little cars
are further back from me then big cars
are if you were to think of a machine
trying to take car as data inputs it
says hey here's the XYZ coordinate of
this car the XYZ of this mess and this
and this and tell it hey I want you to
render this as a 2d image a totally not
unreasonable thing for it to do is just
cut depth out right and it just says
boom here you go everything's in a 2d
grid be happy well if you have a group
of cars here toward the beginning of the
lot and a group of cars toward the end
also when you cut out depth you lose all
that information about where those
groups are you just see this giant blob
of car and you're in your picture so
what TS Andy is allowed to do is it's
actually allowed to say hey I see that
there's a cluster of cars back here and
a cluster up here these things seem very
tightly related I'm going to present
this as two blobs in separate places on
your your final image which is kind of
cool so it's actually able to preserve
groups versus just presenting things so
where I ended up getting in all this was
just these last two boxes I got tripped
up on various thing
and in my bout of yak shaving I did not
actually get to the last three steps
which are potentially arguably more
interesting but I didn't just sit around
for a couple months and do nothing while
I prepped for cons I built something and
begs a question of what went wrong what
what did i do that you shouldn't do if
you're trying to do this well my
introduction into all of this was
through this Torian picture and if you
type in korean TS any into google you're
going to get a github repo which has a
bunch of python code in it which for me
was perfect I said oh I just got to
translate all this Python into closure
and boom or set well I also thought you
know I don't want to just take a hundred
and thirty thousand rows of data and try
and see that so you just punch that into
a program and hope that it spits out the
right thing all right tests and this is
going to be great so what ended up
accidentally doing was hitching my codes
correctness to a Python implementation
which ended up being buggy so I'll get
into this more later but I had a
generative testing suite which will take
a bunch of closure objects and then run
it in a Python implementation of TS any
and I Python them by a closure
implementation of TS any and then
compare the results well this meant that
when failures would happen it took me a
while to assess whether it was my fault
or another bug so for those of you who
attended us to Holloway's talk last year
about debugging you'll remember that
there's the your code driver Code
operating system and then physics
something like that and that yeah sure
occasionally physics is going to be to
blame for your bug but more often than
not it's going to be your fault so I
completely assumed that all the code
that I was looking at that was wrong was
my fault yeah so then there were the
natural open source third-party hitches
that I ran into and unsurprisingly
machine learning from scratch is not the
simplest thing in the world so when I
talk about buggy code implementations I
probably should have started by using
linear algebra to start and two days or
so before I started touring my might ah
I found the white paper by or by van der
matin and Hinton about how to actually
build TS any and I read it and was a
little scared by the fact that I
actually understood a lot of it and went
well you know I've already already wrote
all this code from Python I'm set well
it was academic Python which isn't
production Python written by actual
programmers so I was dealing with
variable names like x + y + r XX or d n
DN md underscore m and really funnily i
started saying well this data set should
just work this is the example data set
why doesn't it just work oh well it just
works if you have the Python
implementation shell out to the C++
program so there was then these multiple
layers of abstraction from actually the
code that I wanted to be evaluating
against for those in the crowd who
understand Python you might be looking
at this snippet of code and realize
immediately the bug that I ran into
which is beta men and betamax here get
assigned a ref from beta I which means
that when beta at I gets updated min and
Max totally get updated too and for this
code it is trying to do a binary search
of sorts which means its accuracy bottom
doubt after two iterations when beta min
and Max were set to the same thing which
was really really great so immutability
unsurprisingly is kind of a nice thing
when it wasn't buggy code it was obtuse
code I took probably about an hour to
understand what that line of code means
there I ended up using the Python shell
quite a bit apparently I i only
understand Python a little bit when I am
interviewing but that line of code what
it's supposed to do is drop a number out
of a list and I'm probably just a
parenthesis elit and at this point can
only view things that they're between
brackets but this this was another thing
that took me a long time so I get my
head around so when it wasn't that the
code that I was integrating with was
buggy it was that I was running into
problems with third-party software so I
naturally
I started said I'm gonna use closure
core matrix because it's pretty great
and it honestly is really really great
but I said I'm gonna need bigdecimal
precision because this is machine
learning and precision is important for
machine learning it turns out that isn't
actually the case doubles are pretty
great and the fact that close record
matrix turns everything into doubles is
not a problem for doing machine learning
but I naturally cycled through all the
various drivers that close rapport
matrix has and when I popped in the
Apache Commons matrix it wouldn't even
load in modern closure because it ran
into this issue where throw was
expecting a different argument format or
I think it was given eight two arguments
expected one something like that which
was a really fun fun bug to come across
I ran into a problem with the SPG
renderer that i was using dolly a very
common very common def multi def method
thing that i think everybody here is
used to is you define your def multi up
here you have all of your
implementations in various namespaces
and then you have wherever you're trying
to do where you reference the multi and
then reference each name space you need
that defines the Deaf method you need
and I think for open-source libraries or
libraries in general that I've used I
personally prefer and this is completely
my preference this is not something that
I'm advocating but that you have a
single namespace that says hey here's
the multi and all of the implementations
of method across the code base so that
you just have to require that single
namespace instead of all of these
various def methods everywhere this was
something that tripped me up for a
better part of an hour trying to figure
out why the example from dolly wouldn't
actually work and then finally clj 1142
was something that I thought was kind of
funny so this is a jira ticket that has
been open enclosure for a while and i
think that this is the sort of stuff
that trips up newer people to closure I
found it really interesting because I
was able to keep stepping into the code
and understanding more and more why this
is a bug and why it's still a bug but
what's going on is if you divide beta
times some DP here over some P talking
about bad variable names you're going to
get a divided by zero exception but you
you cast either of those two double then
you totally get not a number which is
what you sort of expect again this was
something I found interesting not
necessarily something that'll trip up a
person who's more used to closure but
somebody who's newer I think these
little things add up so where did I
actually end up what consequences what
were the consequences of wrong and what
did I end up doing well I took a Python
implementation and turned it into
closure it was successful at that I made
a generative testing suite which
compares closure to python because of
this I had to have a fuzzy equals
implementation which allows objects to
be compared in a bunch of different
modes and then finally I have a whole
slew of parsers which take various kind
of interesting data sets off the world
wide web and turn them into closure data
so this generative Python testing in the
repo I wrote if you give it a map where
it will point to the Python repo you're
after the module inside of there that
you're looking for and then the function
name inside of that you can pass it the
closure object and it will use that as
the arguments for that function and it
will run it and it'll spit back the data
that you're looking for so this is a
Python interop sort of and what this was
really cool for or when i first started
on this I i wrote a serializer
foreclosure data to shell for python
such the python would understand it and
then i said okay great you know I've got
Python running this is really sweet all
I have to do now is get the data back
from Python which means i need to write
a parser for the output from python this
will be really simple it only take me a
couple hours remembered Python or JSON
is totally a thing so you don't write
your own encoders I can't say that
enough don't reg your own encoders and
decoders but when you're doing this
numpy is something you're going to want
to include and you have to be able to
handle the various numpy types you're
also going to be needing to use chess
higher over closure core JSON because or
closure data JSON whatever it is because
Python
allows you to use I think not a number
infinity and none but those are totally
things that closure core JSON does not
understand but she sure does so little
things so when you evaluate this the
Python interop stuff will give you back
the exit code the actual output the
error whether it was a success or not so
exit code was zero and there was no
exception thrown before it have ali
waited the code or after the actual data
and then the bash function that it ran
so for the Greybeards in the audience
you may be noticing that that Python
bash is getting kind of long i did not
know but apparently you can only pass to
the shell certain like it can only get
so wide before it freaks out and vomits
on you which for something like
generative testing you end up hitting
that limit pretty quickly so i ended up
having to pull the Arg max which tells
you how many characters wide and
argument can be to the shell pulled that
out and then threaded that through to a
command called spat which is of course a
terrible name but what are you going to
do and spit is what you're trying to do
so you pass the command in here and it
will say hey this command is too large
to just run I'm going to put it into a
file and then execute that file which
doesn't always quite work but sometimes
works so yeah and then all the
generators that I had you've got matrix
generator vector square generators and I
was I was really debating about whether
or not to include these slides simply
because there are so many examples of
generators online already but I think
that generative testing is really really
awesome and we should get way more used
to the syntax that's used for it so yeah
the generative matrix generator that i
wrote takes two generators which is a
tuple gently generator that generates a
tuple which says hey here's the rows and
the columns that i want you to have and
then the other one is the values that it
expects to turn back this is the
generator that i use for testing my
exponentiation and log functions on
matrices so
I thought perfectly natural thing I
should be able to exponentiate a number
and then log it and get the same number
back or roughly the same number back but
if you exponentiate a number and it
becomes zero or becomes log or becomes
infinity sorry log of that is totally
going to be different than the original
number that you were looking at so this
says hey the men in the max can only be
as big as when numbers start to go out
of bounds so the fuzzy equals stuff that
I had the fuzzy equals for those who
don't know is this idea of if you have
the number one that's always going to be
equal to 1 but maybe you want to have
1,000 be equal to 1,000 point zero zero
zero one so you can do it by threshold
or the relative distance between new two
numbers if the absolute value of a minus
B is below 10 then it's good if 1
million minus or 1 million minus 1
million one over 1million one is less
than some threshold the relative
distance then that's okay common type
mapping so list can be equal to vector
possibly a string can be equal to a list
if it's one two three four and the
string is one two three four maybe those
are equal because I was dealing with
numpy and Python internals to JSON to
JSON decoding to closure I decided that
infinity should be equal to not a number
should be equal to nil and this is all
pretty normal trivial stuff for fuzzy
equals the implementation I did that I
thought was kind of novel was bracketing
by ULP so in the JVM you would have
because it's binary you can't always
represent perfectly a number right 1
over 3 has to bottom out at some point
it can only be 0.3 3333 to some degree
so what the JVM does is it says hey
here's that perfect number in in your
mind right I'm going to give you a
number back that is within a plus or
minus range on either side of that
number which is the bracketing by ULP so
the units of least precision says yeah 1
over 3 is right here i'm going to give
you back a value that's just off of it
right here so what I
ended up doing was saying if I get two
numbers a and B back I'm going to then
bracket there you LPS such that i have a
range of numbers and if those two ranges
overlap then i'm just going to say that
the values are equal and for the
generative testing this ended up being a
really great way to sweep very minor
errors of precision and I like error
propagation under the rug so my take on
the state of closure for ml I think as a
language closure is actually really well
positioned to do machine learning having
to opt out of immutability is a very
subtle but a very huge win if I gave you
the number one and I said add one to it
you totally wouldn't expect one now
becomes too so the human brain doesn't
really work with saying hey a is one now
a is too because you added one to it and
I think that closure you can totally get
to mutability which is on on the next
slide but having to say that you don't
run into these issues of oh I forgot to
cast this as a float to copy the value
over is pretty nice I also think that s
forms and lists are another subtle
difference but very natural for doing
this sort of stuff it think it's how you
view doing the sum of a bunch of numbers
and this sort of thing while closure is
not scheme I do think the culture around
naming and what the language allows are
really really positive so I used shudder
hungarian notation for all of my
matrices so whenever I saw that I matric
a variable was post-fixed with
underscore some value underscore another
value I knew that that was rose by
columns for that and therefore i could
see hey this matrix multiplied by this
matrix isn't going to work because they
have different dimensions or subtract
different dimensions transpose that sort
of thing and of course using the repple
is really nice opting into mutability is
really nice when you have shallow code
it means that you have all of these
helper functions right and inside those
helper functions you can see oh I've
only got three operations here i can
probably replace this threading macro
with do too
and now I am letting the JVM just run
all this stuff and mutate this object
and that ended up being a nice way to
speed up kind of slower chunks of the
code so it was this mystic power of
throwing bang on something and all of a
sudden everything just sort of speeds up
the biggest drawback speed I was
comparing this to C++ and doing a lot of
matrix multiplications in the JVM is not
like doing a lot of matrix
multiplications in C++ this is my cpu on
every every spike there is a single
iteration of the loop 40s na yeah so the
actually interesting part of this talk
the dative is portion so when you're
looking at this image what is it that
you're actually seeing well each of
these darker clusters in here represents
a group of words that are closely
related according to the machine so this
is what the machine thinks words are
that are very close together so for
instance this blob here are titles that
you'd give a person so you see that
Queen Lord and Earl and even Pope and
Emperor Duke are very close together
whereas member partner and coach are
close together but on the opposite side
of this little blob this is North
America versus countries this blob here
you see that vowels are closer together
and that all the months are very close
together my first attempt at rendering
this resulted in this my my text was a
little bit too big so when I rear ended
it with smaller text I got this kind of
chilling image here and I decided to
instead of do 2,500 words I was going to
do 40 6502 because that was going to be
a great idea and the rendering for that
took about two hours so what you're
looking at here roughly is all of the
places got separated out onto the top
here and all of the English words got
separated to the bottom so this is all
ASCII characters 3,000 most popular
English words and then a whole slew of
cities states
countries that I pulled from a repo
online what's really neat inside of that
upper blob is you have a section that's
more or less North America a section
which is kind of North American cities
and then in the bottom there's like
loosely adjectives which are grouped
together and you can see like smart ugly
elderly or all close together capable
confident worried we're all close
together it's kind of a neat neat thing
to see the English language like this if
you remove all the places and just have
the three thousand english words this is
the picture you get back this is the M
missed data set this is handwritten
digits that the deep neural net was
allowed to walk over and this does handy
things like decode zip codes so when you
write a letter to your mother who would
really love to hear from you it decodes
the zip code using something like this
in the bottom right-hand corner here are
all of the each number color-coordinated
so you can see what the different groups
above are my rendering of this you get
to see that zero is still off on its own
pretty solidly four and nine are still
close together between the original
image and the image I ran five and three
are still pretty much intertwined which
is similar to the last one the cool
thing about TS any is that because it
has a random seed to start you can run
it a number of times and see what
similarities bubble up each time versus
what similarities were just a fluke one
time when you were running it so lastly
this last set of slides I have is the
sift data set so this is a bunch of
different images which were run through
the sift algorithm and then put into a
2d picture like this using TS any and i
personally think it's really cool that
we live in a world where a machine can
just say oh well those are all planes
and planes are different from boob
planes and watches are very close to
bald guys
so this is this is all stuff that's up
online this is at laurens van der
maidens github site these these pictures
are really really cool to just like go
through in an afternoon so that's that's
the talk I want to give special thanks
to circle CI for letting me do this talk
and not expecting too much work for me
over the last couple months stitch and
argent metrics for hosting me for meetup
to present this and run through I
developed the entire thing in cursive
I'm not actually getting paid I just
really like cursive that much and then
finally the people who really did the
hard work for this Geoffrey Hinton
laurens van der matin Joe so turian
Colbert and weston it wasn't for them
actually doing the hard work I wouldn't
have been able to do any of this finally
Matt bill you and Peter to sound tell
sanus really huge help in this they had
great libraries and or help me run
through the talk and close record matrix
you should totally check it out
everybody has contributed to that huge
thanks and that's it I think we have
time for questions</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>