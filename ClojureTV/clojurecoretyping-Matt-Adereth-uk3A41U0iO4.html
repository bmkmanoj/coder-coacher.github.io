<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>clojure.core/typing - Matt Adereth | Coder Coacher - Coaching Coders</title><meta content="clojure.core/typing - Matt Adereth - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/ClojureTV/">ClojureTV</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>clojure.core/typing - Matt Adereth</b></h2><h5 class="post__date">2015-11-17</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/uk3A41U0iO4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">and today I'm gonna be talking about
making keyboards with closure I
apologize if anybody was misled by the
title hopefully everybody read the
abstract and knew that this was gonna be
about keyboards and not about type
theory I promise you'll get your fill of
type theory in the next talk but you're
here so enjoy it alright so this is a
true story this is a bit of a cautionary
tale
I'm a little concerned about presenting
it to the closure community and I know
there are some of the luminaries of the
closure community out here I'm afraid
that if you see this you'll start making
your own keyboards and I will have done
some permanent damage to the closure
ecosystem so please don't consider me
the one who jumped on the productivity
grenade and saved you all from this fate
and very brave of me all right so we're
going to talk about keyboards and the
way that I'm going to structure this
talk is first like good closure wrists
we're going to talk about the history of
keyboards and typewriters and other
things then I'm going to talk a little
bit about 3d modeling with closure and
then finish up by talking about using
those 3d modeling tools to actually make
a keyboard and we're gonna run through
that really quickly here all right so an
abbreviated history of funky typewriters
and keyboards so I tried to figure out
what would be appropriate to where to
start when talking about keyboards
obviously they're influenced by the
typewriters that preceded them but
typewriters were heavily influenced by
the printing press and by the Telegraph
and pretty much any machine that
required text input had to think about
this problem in some way and the first
typewriter was from 1575 and had been
invented many times by quite a lots of
different different individuals but
where I'm going to start the story is in
the mid-1800s 1868 when the first thing
that was called a typewriter was
invented this is a picture from
patent from 1868 the Xolos livin in
seoul typewriter and it's it's kind of
interesting to just look at this picture
the first thing that jumps out at me is
that it looks like a piano and that
makes a lot of sense when you think
about what a piano is that it's this
machine where humans are inputting
sequences of symbols rapidly and the
piano hasn't been around forever it was
had been around for 150 years at this
point and already like humans had
demonstrated that they are awesome at
using this thing it's a great form
factor so it's natural thing for them to
copy they tried to get people to use it
to some success but there were other
people who are also trying to invent
something that would solve this problem
and what looked very promising was the
Hansen writing ball this came out in
1870 and it looks it looks nuts it's
beautiful this was actually the first
commercially produced typewriter and
there were about 10,000 of them made and
people loved it I consider this to be
like the Lisp of typewriters hopefully
it's not too much of a stretch but you
can even like see the parens everywhere
so it had not only did it have a lot of
fans but people were very fast with it
they had typing competitions where they
tried out different machines and people
just rocked with this thing and you can
you can see it has this contoured layout
and what looks kind of alien to us as
far as how the letters are arranged but
it was arranged very logically based off
of English and you got the vowels there
on the left it looks nice it's just it
makes sense the biggest fan of this or
the most famous fan is Nietzsche who
used it when his vision started to fail
he composed over 80 documents on it
including a poem about the Hanson
writing ball written on the Hanson
writing ball I would include it here but
it's actually a little dirty so look it
up afterwards yeah it's more of a
limerick so they made a lot of these and
even though there were about 10,000 made
it's ridiculous collector's item now
they go for auction like several hundred
thousand dollars if you find one in your
attic know what you've got but it ended
up losing to a Sholes and Glidden design
so shows includin two kept working on
their design and they they found
something that worked pretty well but
they struggled a lot with manufacturing
it they made about 15 of them before
they sold their patent and the design to
Remington and Sons now this is Remington
the the gun manufacturer who had a lot
of expertise in manufacturing precision
mechanical things at scale they also had
a huge distribution channel and sales
force and they dominated the market
because of all of those things not
because of superior design people were
slower with it and this thing just took
off so this was the Remington number one
the remington number two introduced the
shift-key
uppercase and lowercase letters it was a
big innovation the remington number nine
just as a little factoid I had a
beautiful typeface
the font that I use throughout this
presentation is a replica of the
Remington number nine spawn and we live
with this typewriter today basically so
it had if you were to sit in front of
this it would be very comfortable for
you as a matter of speaking because it
has the four these four rows it had the
QWERTY layout and it looks just like
what you have in front of you and
there's a lot of legacy that we live
with today because of this thing so the
way that it would work is each of these
keys were attached to a bar that would
go back and was attached to this arm
that would swing and strike an ink
ribbon and make an imprint on the paper
and those bars had to not collide with
each other there were just some physical
restrictions on the design of this thing
so that's why the columns are not
perfectly aligned and because those bars
would hit each other so we live with
that today anybody who's working on
their computer right now writing
important closure code I'm sure can look
at their keyboard and see that none of
the keys align in perfect columns even
though our fingers move just in these
linear arcs another classic fact is that
these arms would swing up and if two of
them were too close to each other and
used in succession they would catch each
other here we have a picture of a sad
broken typewriter where it's jammed
because somebody pressed two letters and
one of the innovations of Scholes was
the QWERTY layout which was designed not
to slow us down and some people might
say but to avoid the use of adjacent
letters in when typing to avoid this
problem as much as possible so the
QWERTY layout we no longer have that
respect that problem of these arms
hitting but we still use it
so more legacy and things really didn't
change much for a long time even the IBM
Selectric which was one of the most
innovative one of the biggest
innovations in typewriters came out like
60 plus years later or even more and had
all
supercool design so many great things
about this that made it much more
reliable people were able to type faster
but the actual human part didn't change
like the thing that you sit that you
actually put your fingers on and type on
was still this QWERTY layout the IBM
Selectric is there's a reason that I
call it out which is that it was
converted for use with the IBM
system/360 and this was actually used as
a terminal on some mainframe machines
the IBM 2741 a few years later was a
terminal that people would use and you
could see that it's got this little ball
here that was one of the innovations
that had this thing called the tight
ball that you could replace and it would
have different fonts this one didn't
have uppercase and lowercase letters it
just had uppercase and APL symbols it's
a little hard to see here but but each
of those keys has a like a mathematical
symbol above it and people used this for
writing APL we kind of laugh it even
though when I just said APL people left
right like good APL is funny because
it's got these crazy symbols but when
you look at it in the context of the
interface that people were using it
actually made a lot of sense and I think
that's kind of an interesting thing to
look at is how the the interface the
physical interface that we use has
influenced the programs and languages
that we use and we can see more examples
of that 1974 the ADM 3a there's a very
important machine because of its
keyboard so here's here's a look at the
keyboard can anybody guess what famous
software was written based on this based
off of the keys yeah yeah so VI was was
written on this on this computer using
this keyboard the the biggest clue is
the hjkl
that had arrows on it so that was an
obvious design decision but there are
other things hidden here that are really
interesting to look at the control key
is right there where most of us had caps
lock the escape key which VI folks are
using all the time from what Andrew
and is right there and a couple more
neat things there's a colon right there
not on the shifted layer and pressing
colon all the time and the last little
bit is the tilde key over here that's
also on the HOME key and this is why our
home directories are referred to using
tilde's so there's like so much history
wrapped up in this this one keyboard in
the interest of fairness for the editor
wars we will also look at the Symbolics
space-cadet keyboard Symbolics
manufactured list machines and this
keyboard is another ridiculous
collector's item
probably to go for like $15,000 now
can't get one this had a lot of
influence on the design of Emacs the
bottom row here we've got hyper super
meta and control modifiers
all of a sudden Emacs makes sense in
physical keys for each of them each of
the keys also in addition to doing
uppercase and lowercase letters has math
symbols and Greek letters the Greek
letters are on the front and there are
modifiers for getting to the top symbol
or to the Greek symbol and then for
getting uppercase in lowercase so this
is influential on the the list world and
the design of Emacs and all of these are
really interesting keyboards but none of
them are changing where you put your
hands and how you interface with it
they're all QWERTY they're they're all
pretty much the same typewriter from
100-plus years ago we start to see
something interesting happen is 1977
this woman
Lillian malt who ran a secretarial
training school for over 20 years and
taught lots of people to type designed
this keyboard the malt Ron keyboard and
this was very forward-thinking
a lot of the design decisions that she
made here are the standards for
ergonomic keyboards today a few worth
pointing out the biggest one in my mind
is the thumb cluster actually making use
of our strongest digits and this will I
promise will save you from Emacs pinkie
like you should consider something like
this but also the keys where all the
letters are in these split key wells
allowing you to keep your arms straight
out at shoulder width they're angled
ulnar is a thing that you want to avoid
and then the actual keys are in an arc
along the columns and along the rows and
they're also at different heights to
match the different resting heights of
your fingers if you look at them you'll
see that they're not flat I mean maybe
they will look flat because you've been
conditioned to that from being
in front of a computer your whole life
but it shouldn't be that way you're
hurting yourself this thing was awesome
one other thing that's not captured by
this picture is that she invented a new
layout they had the e key under the
thumb I mean it was radically different
but optimized for typing English and it
never really caught on just kind of sad
they eventually released a QWERTY layout
they compromised compromise their ideals
one one bit that I want to call that
about mall Tron but I think is really
noteworthy is that they only have five
models of their keyboard and three of
them are for people with Linda's or
limited mobility so they have a left
hand right hand and no hand version
which is really awesome if you don't
really think about accessibility for
hardware that often and they were
thinking they've been thinking about it
for a long time and actually delivering
on that it's very expensive to buy these
probably because it's being paid for by
insurance but if they're there you can
get them on eBay these were really
difficult to manufacture and never
really caught on they're super expensive
until the Kinesis company came out with
their keyboard it 15 years later where
they copied a lot of the design of the
mall Tron they had a bunch of
innovations but the biggest being that
they figured out how to make it cheaply
for like half the price and at greater
quantities I use one of these it saved
my hands I recommend checking it out and
not a doctor don't sue me but you should
you should look at this especially if
you have you max pinky and there been
other things that I'm not going to get
into but today there are there's this
confluence of factors that have caused
this explosion of keyboards so there's
this thing called the teensy for $15 you
can get a controller for a keyboard and
it's really it's relatively simple to
make your own keyboard now there are
these communities geek hack and
authority where obsessed people get
together and talk about making keyboards
and also
- keyboard trivia and details there's
the hole maker movement there you can
get your own router in your garage or a
3d printer and that allows you to make
things and a lot of the components that
become much much much cheaper people
then all these things come together to
this one very important project the ergo
docks any ergo docks users here a few
hands three hands which is this
open-source keyboard split hand it's got
a lot of the great properties but it's
not contoured which is a problem for me
and this is not available for purchase
you can only buy a kit so this company
mass drop has sold thousands of these
kits and thousands of people have
actually gone through the full process
of making their own keyboards and when
you do that you learn it's actually not
that hard to make your own keyboard this
is like a realistic thing if you're if
you're obsessed and there have been a
couple great examples of this that have
come there's like this Cambrian
explosion from the earlier docks all
these people making new keyboards some
of you may have heard of the atreya it's
made by the closure community's own Phil
hey Goldberg also known as techno man
see the developer of line engine I don't
know if I'm saying that right
and it's this portable organ on a
keyboard it's really cool and there's
the keyboard EO which is this beautiful
thing that takes design and ergonomics
to another level that puts the ergo
docks to shame I made an Ergo docks and
I decided that I wanted to make my own
keyboard for some reason and I knew that
I wanted to be contoured and have that
that those those curved key wells so I
figured I'd have to learn how to 3d
model so I got blender I watched like
four hours of videos and decided it
wasn't for me like you have to dedicate
your life to it and I've already
dedicated my life to closure so that's
why I did what I did the first thing
that I tried though is using open s CAD
which is this awesome open-source
totally free 3d modeling language they
build themselves as
the programmers solid 3d CAD modeler and
it's cool let's look at it for a second
first thing just to give you like a big
what so a equals zero echo a prints five
echo three a equals three echo any
prints five equals five they justify
this in some text by saying that this is
how functional programming works and
they have a link to the wikipedia page
about functional programming this is
this is not good
propaganda for functional programming it
in my opinion will address that let's
look at some actual open s CAD code and
I didn't want to like cherry pick the
the worst example so I just went here
examples that ship with it example one
they've got this sphere it's got three
cylinders cut out of it and let's let's
look at the code so they have functions
and modules which are both functions
functions just return the value modules
don't and here's one that does a rotate
of a cylinder you can see that it just
says rotate open paren some paramananda
next line there's a cylinder so that
line affects the next line mm-hmm there
are some other smelly things here's one
sphere R equals some function of size
you don't see size to find anywhere here
size is defined afterwards because
functional functional programming
and and there are there some other warts
which I will call out here the biggest
to me though was that shapes aren't
actual first class things in this
language all the shape functions like
cylinder and sphere and whatnot are
drawing directives that have the result
of creating that shape on the canvas but
you don't get anything back and you
can't refer to a shape you can refer to
a function that makes a shape but
because it's not really a functional
programming language you can't like pass
a function to something else so there
are like higher-order things you can't
do in this language because it's not
functional and shapes aren't first-class
there are no data structures other than
what they call vectors and you can only
put strings and numbers in them it's not
functional as I've covered no namespaces
so big projects become kind of unwieldly
I looked there was a there's a github
issue saying that they wanted somebody
wanted to introduce namespaces and there
was a whole discussion about how this
should work and the last comment was
this requires a lot of thought this is
hard
closed so so there's no namespaces and
we already saw some of the unintuitive
scoping rules so closure to the rescue
get some some lexical healing applied to
open s CAD one of my co-workers who is
sitting next to me at the time that I
started on this had just done this
little side project which was like a a
weekend or two called s CAD clj by Matt
Farrell who I work with at 2 Sigma I
forgot to say that I work at 2 Sigma
this has nothing to do with my work we
do use closure at that uh-huh so he made
this wrapper for s CAD for open s CAD
that lets you use it from closure and
let's take a look at that now so I've
already got the everything imported here
and we're just gonna look at it from the
ripple everybody can see that hope the
fonts big enough so we've got a lot of
the same same
functions that we use from s CAD and
let's just make a cube that's that
creates this data structure that can
then be used to generate open s CAD code
so all of this is a closure language for
3d modeling that outputs open s CAD code
without you having to deal with any of
open s cads issues so when you have one
of those data structures you can pass it
to this thing called write s CAD and it
generates s CAD code so all that we need
to do in order to actually use that from
s CAD is is just use closure spit so I'm
going to spit it and I've got it open
down here made a cube and what's really
neat is that open s CAD will watch that
file and I can just be doing things from
Emacs and not have to touch that other
program ever again just have it open for
review and they were so considerate that
they even give you this option to hide
the editor and now we're just treating
it as a view into to this 3d world and
that's all that it is and it's really
cool
this pattern of calling write s CAD and
then spitting it is so common that's
that is the workflow that I have this
other
just this little Emacs function that
I've bound to hyper super meta three
just control C three that will take
whatever expression I have and wrap it
in right s CAD wrap that and spit to
repple dot s CAD and I don't have to be
writing that over and over again and
it's really neat because I can just come
in here and put my cursor at the end of
an expression and get it spit out so
let's just look at some things we're
able to use the thread last macro to
have things be written in a reasonable
order so we start with the shape and
then we start applying transformations
instead of having to read it backwards
it's one of the best things in closure
so I'm just making a cube I'm gonna
rotate it and shift it over and notice
that I'm using
Java's pi here because it we're in we're
on the GBM we have all of the java math
libraries we can do all sorts of cool
things we have the whole Java ecosystem
available to us which isn't available
within open s CAD and you can figure out
what your drawing should look like using
all sorts of neat stuff and we also have
functional programming so I'm gonna here
we have all these different functions
that can be applied to a set of shapes
so there's Union of shapes intersection
of shapes difference of shapes and the
convex hull I'm going to just map over
that list using map indexed and use the
index to to shift things over and let's
see we can just put the cursor there and
see what that cube looks like put the
cursor here and see what that sphere
looks like and then we can see the union
the intersection the difference and the
hole in this tweet size code
which is the most important metric we're
also able to do some higher order things
because we actually can have data
structures containing shapes so we can
have a list of shapes like that's great
we can write this like a function
here called pair hulls which takes a
list of shapes and for every a Jason
pairs of shapes creates the hole between
them so evaluate that and I'm gonna make
a list of shapes just take this cylinder
just show you that cylinder rotate it by
some fraction of Pi shifted out by a
radius and then rotate it by some other
life or some fraction of 2 pi and what
that does is it gives me the this
falling stone head and this is actually
something that could be used to make a
mobius strip so it was just apply pair
holes to that and we get a mobius strip
which you do not want to write in s CAD
I don't let's make it a little a little
nicer and then we can go 3d print this
and put it in our desk
um all right so all those things that I
just showed you that's the full set of
tools that I need to actually model a
keyboard so let's just look really
quickly at actually building a keyboard
I hear clapping in the other room so
hurry up so we're gonna first make a
little hole for the keys to go in and
we'll do that by making one wall that's
gonna be the top wall another wall ooh
that's gonna be the left wall and then a
little side nub that is going to be
where that kind of catches the switch
that gets put into it and we can put
those three things together to get this
and then we can take that and union it
with itself mirror it a few times and
get this and we have this nice hole and
if you print this out you can snap a key
in there switch in there and it's very
satisfying and then need to make the
actual shape of the keyboard and this
was where it got a little tricky and I
tried doing it a few different ways with
lots of trigonometry and it was it it
got out of hand that wasn't it but then
eventually I figured out the the right
way to do this was to make a function
that takes a column in a row and figures
out where to put in a shape and figures
out where to put that shape and it does
something pretty simple it just takes
the shape translates it down by some
radius rotates it and then translated up
by the same radius so that just gets you
the ability to place shapes in a curve
so we do that in along the X and along
the Y with some little offset for
getting the different finger heights and
we have this awesome key place function
and then we can just apply that using a
for loop to make some key holes
and starting to look like a keyboard and
just to make it easy to test we've got
this other thing for making some fake
key caps maybe just Union those and that
lets us visually inspect it and make
sure that they're not hitting each other
and we need to figure out how to connect
all of these together and this was a
little tricky and what I eventually
realized was that I could just put this
little web post a little a little post
at each corner and do the hole between
the corners of adjacent keyholes so I
make a tranquil triangle holes it's the
same thing that we saw the pairwise
holes only at this time we're
partitioning three instead of two and
then we get this connectors which take a
sec to render because holes are a little
expensive and we could put those all
together and get a the part where the
main part where most of the letters are
going to be so one thing that was a
pleasant surprise to me was that how
this is parameterised so when I look at
open s CAD code and parameterised models
a lot of what you see is just numbers
being the things that you can change
like I want this to be a look like use a
quarter inch screw hole instead of 1/8
Amanda hold and have it automatically
generate the rest of the things generate
the rest of the model and have it be
right but what we've parameterize by
here is by a déplacement function and
you can think about that placement
function as a separate thing outside of
the keyboard that placement function is
just a deformation of a plane so it
takes an XY coordinate and gives you a
new XYZ coordinate and you can just
apply that to a bunch of points to see
how the plane has been deformed and it's
only specified in one place so you can
come up with weird shapes and generate a
keyboard that has that weird shape you
can have a sinusoidal keyboard if you
like and this model just works you just
replace it in one spot which was a
pleasant surprise to me made me very
happy to see that so we've got this one
function for defining where the the main
keys go got a separate one that does
this similar thing for the thumbs we
just use holes to connect up posts to
stitch them together and it gets big I'm
not going to show the whole thing but
here and render it it's gonna take a
second and we've got enough that we
could print this out and start typing on
it which is pretty awesome so to
actually make this thing need to 3d
print it I at first was using the
MakerBot replicator this is an old model
I was using a rescued one it worked for
a while these things it's very
aspirational but it's called the
replicator when in reality it becomes
very you have to wrestle with the
Machine a lot fortunately there's this
company called Shapeways which is a
professional 3d printer you can just
send them the file that that gets
generated by open s CAD and they will
send you back the thing that you wanted
here are a couple of my early prints one
awesome thing about them is that they
have a wide variety of materials
including steel they will 3d print steel
using magic as as far as I know this is
the first time that closure code has
been reified and steel I've brought that
if anybody wants to see it
and I've been making this keyboard I
needed to wire it all up so when people
make their own keyboards they usually
just use a ton of wires and have
everything to be connected up because
you can't make your own circuit board
very easily and this is especially hard
because it needs to be flexible to adapt
to the curves that was one of the things
that Multan struggled with so I've been
making flexible PCBs in my garage
turns out you can do this with just
vinegar and and hydrogen peroxide that
will dissolve copper and the laser
printer and then you're good to go and
you can start manufacturing these
circuit boards so I've got this got it
all wired up and here's the latest
version printed from shapeways with a
bunch of components in it I brought it
with me if anybody wants to sing here's
the glamour shot and it feels good I've
been actually using it I have a wired up
one at home and development of this
keyboard is now fully bootstrapped all
future development of the keyboard is
done on the keyboard itself
and yeah so that's the keyboard some
concluding thoughts closure is awesome
we all know this but what was really
amazing was that this library this was
written in like a couple days when you
look through it you can see that it's
just really simple and we're able to get
all of the power of closure on top of
this other language that is lacking in
many ways very easily making things is
really awesome it's very satisfying to
make physical things it's not something
that I really spent much time doing I
recommend you try try it out and making
physical things enclosure is super
awesome it's great to be able to do this
from Emacs no offense there or VI if
that's your thing
alright so if you'd like to know more I
tweet about this regularly I've got a
repo up on github with an older version
I'm going to be posting a new version
shortly so that you can print yourself
and I've also put the model up for sale
at cost on Shapeways if anybody is brave
enough and wants to try it out I will
help you get some some of these circuit
boards and you can you can stop being
productive
alright thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>