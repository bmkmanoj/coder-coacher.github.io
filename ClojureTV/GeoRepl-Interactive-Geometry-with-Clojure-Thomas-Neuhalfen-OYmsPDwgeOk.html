<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>GeoRepl - Interactive Geometry with Clojure - Thomas Neuhalfen | Coder Coacher - Coaching Coders</title><meta content="GeoRepl - Interactive Geometry with Clojure - Thomas Neuhalfen - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/ClojureTV/">ClojureTV</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>GeoRepl - Interactive Geometry with Clojure - Thomas Neuhalfen</b></h2><h5 class="post__date">2016-11-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/OYmsPDwgeOk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay then that's not right now have you
ever wondered about some what the guy
who first invented the wheeler really
was up to because um I didn't think that
he just woke up and said okay looked at
hit woke up in the morning he looked at
his watch and said I its sensor thousand
years BC it's high time to invent the
wheel I don't think the story goes like
this I would like to think that he was
intending to invent the plate he was
just fed up by um always burning his
hand when he put something nice and hot
to eat onto his palm so he said I this
can't be healthy so um I'm gonna make a
plate and he built a very nice prototype
he made it thick and solid gave it a
nice circular shape for symmetry reasons
and polished it so it was really really
flat and this was a very beautiful
prototype it's a must have been one of
the most beautiful prototypes of
prehistoric times so but the system test
was a disaster it worked fine as long as
they put bread on to the thing and it
worked perfect with boiled potatoes no
burnt hands anymore but as soon as I
started to pour the soup um everything
spilled on the floor so I'd like to
think that there was a friend of his who
came to his head in this situation and
he said oh why don't turn the thing
upright and invent a wheel then okay our
hands and the invention of the plate can
wait for some more millennia but at
least we don't have to carry all the
loads on our backs maybe the story went
like this I come back to this to the
wheel a little bit lighter well I
studied mathematics and physics in the
early 1980s and we had the opportunity
then to do a Fortran 77
on the university mainframe and so it
was in the summer of 1982 that I hiked
my first lines of code or to punch cards
um
I soon get away from the punch cards but
I remained in the rearm of imperative
style languages for another thirty years
and it was two years ago almost now and
the autumn of 2014 that I had the
opportunity to take some time out and to
invest it into learning new things or
then I was really after this and amongst
these was finding out what was so
amazing about functional languages and
my very first encounter with a
functional language with Lisp and with
closure and it was amazingly hard to do
for me I didn't expect this but soon as
I recovered from the loop record disease
because in the beginning I started and a
used loop recur in any function that was
and soon as I with the help of the for
closure cones by the way as soon as I
could manage to write halfway idiomatic
closure code and the next question arose
and this was what would it be like to
write bigger programs not just functions
what does design or architecture fear
because
program he felt very much different to a
programming say an C++ or C before so
when coding it was different and the
question for me was is there also a
difference in the architecture so um do
they still think in objects or do they
use composing of things like they do
when they write their their functions
and so the best thing to find out was in
my opinion to start an own project so my
very personal fun project so with me if
I'm talking about fun
very often geometry and mathematics come
into play so it should be something
geometrical this was clear and I wanted
to build my personal
interpretation of what can be seen as
the ancient mathematicians all-purpose
to them and this was just something to
write on and something to write
something to draw on and something to
draw with this is still in use and it
was in use in the days of Pythagoras and
you played so nowadays we can do this on
a computer and the computer can we can
make the computer to understand what we
are doing so we can not just only draw
shapes but also make the computer to to
interpret this and to give us the
algebraic representation of what we are
drawing somewhere I learned that this
idea was not entirely new there are some
products out there like geometer
sketchpad for instance or the more
academic geogebra which also gives you
an algebraic representations of your
geometric shapes but i think i had a
look at it but i thought well these are
these things you can't access them right
from the outside you have to you have to
think about sophisticated more more or
less sophisticated interfaces to get
access to these structures and I want
you to have something with closure style
of course because I wanted to write a
closure program and I thought just
having recently learned what a ripper
was I said okay I want to have the
canvas on one side where I can draw my
shapes and have a repair on the other
side and I want to have those two try to
interact with each others I thought this
was clean this was closure refilling and
I started this and so that's a that's
the reason why why I named this thing do
you repair go4 geometry and repair for
Reta um I'm going to show you now what
I've made out of it I had some other
weird ideas as well because I want you
to have something if it came to the
drawing side of the thing I could quite
intuitively
with so I wanted I didn't want to have
menus and these things where I had to
click through and find my path due to
the until I get at the to the point that
I could come in okay what I was up to
because I tend to forget what I was up
to if I have to search for this in the
menus for too long so I want you to have
an intuitive access to the to the thing
I wanted to have this I want you to
start just drawing and the thing should
know what I was up to um okay and I try
to implement this and it's by no means
ready it's still a work in progress but
I think it's mature enough by now that I
can show you the main ideas here what
I'm trying to do is risk you thank you
it's a bit risky because this is a life
thing and I have no video are so
prepared um so we'll see what comes out
of it I start just I start my my jar
just with this little startup script and
what I get here is what I call the
gallery there's still some bugs in the
thing and one of these is here you see
this is really nonsensical it's the
caption is called applet um this maybe
has to do with the framework I'm using
maybe it's the mistake is on my side
probably but I haven't yet found the
time to really get rid of this but
anyway I'll show you and I try to be
honest and show you where the bugs are
into thing if we encounter them so this
is my little gallery I have three in my
workbench in my local workbench I have
already three drawings and I could
access them here they appear in this
little gallery I can eyes and with a
frame around it so I can as select them
and in this selection there's always a
first element which is which is there by
default which is the empty drawing and
this is the one we are which is right
now
no I don't want to have it fullscreen
again it's called applet I would love to
get rid of this and have a full blank
canvas which is the original idea but
maybe I don't manage this and a little
while we'll see now I took you I have no
menus here so I can start drawing I just
do this by clicking with a mouse
and what I get by default is the option
to draw a polygon as long as I don't fix
the second point this is still free and
it moves with the mouse and when I click
to some point then the drawing of the
first line is finished I have set the
second point of it and I get the next
the next line to fix so there is no
polygon in the world which is so nice
that it should go on infinitely so we
have to stop this action right and to
stop it I want you to use something
where the model who was disabled because
it should say something our sub dead you
make this movement right and in on this
canva it would be something I would call
it dashing to do this right now
Diouf and if it goes so dashing is just
like drawing only with a certain
velocity make another line here and
again - so this is one thing I use this
dashing for this is to stop an action
that I was doing now I have no I'm
performing no action right now when I
dash through something now it clips and
it cuts and it Clips if it Clips okay so
you see we're in the we're in the land
of fuzziness here because somehow I have
to distinguish the case I'm drawing
something and I'm dashing so there must
be something some things like thresholds
and so and of course I have a
configuration somewhere where these
thresholds
are defined this is a nice thing for the
time being I would think if you if I did
I developed this further um the first
step will be to individualize this so
this can be the customer dependent what
is meant by high velocity or low
velocity um and in this this
configuration could include things like
oh this is the users left-handed or he
is preferring this of that mouse device
then the next point would be to have G
Oracle itself to recognize the user say
by signature you use at login not just
real name or so but any drawing you make
to identify it and then say okay this is
this and that user so we try to we try
to load his configuration and we try to
see what the user is up to and how
successful in here he or she is when
drawing things how often things are done
undone or so and from this it could set
these parameters these configurations by
itself but this would be future future
okay I told and I told you about undo
where this is the third option I have
went dashing so when when I'm in an
action and - this means finish the
action when I - through an element this
means cut or clip if I - into thin air
just brings back the old States be
alright the next thing we can do is we
don't always want to draw polygons but
this is nice better than it's boring we
want to have other shapes as well as so
for instance circle so how do I
communicate that I want to have a circle
it just by drawing one by this and I get
this circle this is freehand symbol
recognition and I see I get this center
point here this follows my mouse and if
I fix the center
point I can set a radius and we are fine
the same holds true for arcs where arcs
are a bit similar to circles you know
and the land of fuzziness looks like I
can't reduce arcs anymore no an arc is a
circle with a defined start and end
point right I can set this here set the
end point and set the radius we're fine
oh this is these are some things we can
do but okay it's not so nice just
drawing polygons and circus they'd get
let's go for something which at least
looks a bit more sophisticated more like
math first thing I'd like to do is
drawing something which looks like you
coordinate system because many
mathematical drawings start with the
coordinate system thing is we like to
have these lines parallel to the frame
so we have menus here yes but context
menus so just by by clicking on the
right mouse button I get a context menu
here it knows that I'm about to draw a
line and so the two options I have here
is normal polygon mode which is default
or orthogonal mode which produces
something like this and so I can draw my
parallel lines and I stop the action by
dashing as before so something else we
can do
I'd like to have like to have a triangle
now or something three lines that work
as a triangle where a triangle is a
closed curve so then the end point of
the last line should be the same as the
start point of the first line we might
draw it here somewhere and just to guess
where it's where it would be right but
since this oil will have a method
to representation later on we might get
into all sorts of trouble by this so we
really have to match this point one
opportunity we had by what I've already
shown you would be just to let them
intersect here and they chopped away
those two parts this this v-shape part I
think but this is somehow an elegant so
I use something else which I called
snapping booth
snapping means I just click on a point
and stay within a defined radius defined
again configuration or a defined number
of milliseconds which is I think one one
second is is my snap time I'm using here
so nice I've got a triangle here so next
thing I'd like to do is draw a circle
which goes through all of the three MH
points of the of the triangle so again
I'm going to draw a circle yes but this
will leave me nowhere I can snap this
point but this move it's not a four
great head because there's no way so get
this
this circle go through all the three end
points of the year of the triangle so
again I use the context menu and I see
that I have two strategies to to define
a circle one is the thing I've shown you
before which is Deford this is just
defining the center point and then the
radius the second is the 3-point
definition of a circle for circumcircle
I select this and you see and this shape
here has has changed a bit so um it
expects me now to set a point on the
circle I can snap this one as well and
snap that one as well
be there so
try another arc now after the disaster
before that okay I can draw a little
nice arc fill it out with that so you
see these little spots here here and
here and I think you can't read them so
very well because of the resolution and
I couldn't change this to fit but I
could have done but I didn't want to
change this it's no important
information for you it's just when I
make a new shape NGO record it's given a
unique name internally automatically
it's assigned a name and the name is
composed of a suffer suffix a prefix
sorry so on my English um it's a prefix
which is dependent on the shapes so four
lines the prefixes ln4 so causes cir and
so on they will be needed a little bit
later okay
i can make nice drawings on the under
canvas this looks a bit more like
geometry but still this has nothing to
do with mathematics because we don't
have access to the algebraic
representation and I promised you to use
the wrapper for this um I used the
lining ripple we have here and we can
have it to connect to the zero wrapper
which works as a server here and which
listens by the four of seven try for
eight do if it goes okay make a pond you
can get a little cold soy so I started
this repair I think most of you have
have seen this probably um and I change
it to the namespace where I have my year
my API my geo Ripper your API at hand
so this is G wrapper Dutch user this is
the place where my API lives what can we
do here well we have a couple built-in
functions my API which let lets me
define new sh
for instance can do this by defining a
line gif start coordinates - YZ is my
job here I do something really
predictable and recognizable from me
I just make a bit of a diagonal so what
do we see here but on the ripple side of
the thing we see the internal closure
representation of a line shape just as I
have defined it a line has a p1 key a p2
key which is a start and the end point
some internal nonsense and this P R F
which is the reference point and the
name which is ln6 here these are these
little marks you see you can tree
probably but talked about this this is
the automatically assigned name we will
need this in the - to access this in the
API here F is something interesting that
this is the reference point we're seeing
a little why what why this is necessary
um first I'll show you some other
functions of the API like move it's
obvious what this does
they fifty and a hundred and fifty now
let it move I forgot to say to mention
something you see that this thing is in
green um if I or I'm working with a
currently selected element and this this
has two functions
at first it shows in green on the canvas
so we always know which is the element
we're just dealing with and by default
every creation function leaves this
newly created shape as the selected one
in this moment and if we say move we
don't have to give the shape the move
refers to it's just the currently
selected element so that's why this
worked okay
we can shrink it a bit is always nice
our legs ranking um it's the scale
function and we just we we asked Ellie
to 70 percent of it sorry
70 percent of its original length this
done and you see this is where the
reference point comes into into play
because um we have some what we call the
transformations of the plane this is
moving translating and it's rotation and
it's scaling we're moving is obvious we
can move anything by a certain vector
this is no problem but if we scale
something it's not so easy to say which
which part or which point of the
original drawing should remain in its
place or which is the what they call the
fixed point so this reference point is
nothing it's but a fixed point so by
default this is for four lines this is
set to the to the p1 to the start point
um so this always remains in place and
the same is for drawing right but we can
change this obviously there's no name
and no need to no use to do a search in
this context because this would produce
a new state out of the old one but we
don't with in this case we don't see the
side effect of the thing on the canvas
because if you look at it we're working
in the wrapper and this is the
functional part of the thing so we
produced fade out of a previous state
this is the side effect side so we can
correspond to this but I'd like to think
of this as really being side effects of
what I'm doing in the wrapper
they just to show you the rotation as
well rotate by PI over four about ish
like this so we can't say
but we have an API function here and
this is called change and is this I
think this is the the thing where I have
to do most life hacking for to produce
this at the moment they sorry we say
change it's obvious that we change the
currently selected element which is my
little line of still the same line as we
had before so but what am I going to
change this is like a search I give the
key P ref in this kid breath this case
and then I want to have the I want to
have p2 to demonstrate this I want to
change this reference point from the
start point to the end point I need to
access this okay I have an access
function which doesn't change the
selected element so in this case I'm
using the selected elements to to get
the second the second point but it might
be any other point on the canvas and
this is called show and I have to give
it this name it has so in this case it
was ln6
if i have our sorry and something else I
have to do of course I have to say that
I wanted to have this it's p2e
of this element the men are so missing
breakin what so you see here that's the
PRF which is done there changed to p2
and we see this effect just by rotating
again and now we rotate by a p2 instead
of one this is the thing we can do here
okay um I've drawn a I've drawn a
triangle here but it's not true I've
drawn three lines and to give it this
additional meaning of being a triangle
we have to do something about it and I
thought about this and said okay I need
a shape which I cover I called compound
which consists of a furnace or which
contains a list of already existing
shapes then no new shapes are drawn so
this is a compound where nothing new
happens here but I can access these
three lines as one unity I do this for
the for this triangle I've drawn here
say compound and then it's a line three
and then four and Ln five you see this
is the reason why I needed these names
these unique names because this is a way
to access this stuff here
I don't well you see this this this API
functions came well it was a bit it was
a bit unsophisticated a project which
say I just wrote me the API as I needed
it um it's not the last word on this one
might discuss things and I'm quite open
for criticism at this point um but it's
a way I've done it for the time being
and it works for me and it works for
those things I've tried to do with it
but maybe later on there appear some
other problems and some other ideas that
let me change this so I'm always open
for a refactoring which is a nice thing
if you're doing a closure I found
there's no language in the world I have
ever seen before
okay I have seen only couple of
languages but a refactoring always was
really really painful and with closure
refactoring even large refactoring is
where yes it can be painful but it's
just let's say half a day instead of two
weeks of pain so the pain is shorter
it's less okay what we see now I've
created this compound and as before we
have the automatic selection of the
newly created shape which is this
compound and this is the triangle
and now we can do to the triangle what
we have done to the line before we can
say move again
for instance they for fifty-fifty easy
for me can let it shrink by say to half
of its original size they scare um about
five and so on when I implemented the
these compounds I had this in mind and
here we come back to the to the wheel I
was thinking of compounds being some
some objects some new objects like
triangles that I wanted to treat as as
one entity and it was just a little
container or already existing shapes but
when I was thinking about this
definition I said well the current
drawing the whole current drawing see on
the canvas there it's to this definition
as well so what if we treat the whole
drawing or the whole state of the
drawing as it is in the in a moment why
don't we treat this as a compound and
then we can do the following if we
create or if it change anything create
something believes something move
something um we don't just manipulate
parts of the thing we do it the
functional way we create a new state
this sends a new component out of the
other component with the change we have
and we don't chop it away as we normally
do this but we keep it on a second
though when I'm drawing here I have a
growing stick starting with the empty
drawing in our case here and then every
state we have is pilot on top of the
others the current the currents are
drawing is always the top of stack
element and this is the way we can do
undo because then just we pop away there
top of stack element we get
the next below and this is a new type of
stick so this is how I implemented undo
so I was up to making something for
triangles and things like that
and found a way to do undo and with a
little modification redo that's how I
treated my drawing stake and this is
something which never happened to me in
my whole career before that I
implemented something and it's with some
little adjustment it did more than I had
expected I always had the experience
that it did that it did less than I had
expected and we had to work out on it so
I don't know that I'm just why this is
so if I'm just lucky or if it's just
because I'm Clojure and forces a more
abstract approach to things and finding
more abstract solution means that they
might be good for something else then
the thing you had originally had in mind
though this is a bit what I wanted to
express by this weird thing I wanted to
invent it play a plate and what I got
was a wheel and the plate and do that
before you put a rim out around it so
yeah this is the thing okay now I'm what
I can do as well is I can do or I can
build recursive compounds so I can make
a new compound pay it like this and you
see here this was my old compound I had
and this went by the name CN CMP and e1
I want to have this component in the new
compound plus say this arc we have here
it went by the name of our kwon do so
you see the newly the current and the
new currently selected element is this
shape we have there this compound and
again if we now do something like say
scale and make it a bit bigger 1.2 then
it's enlarged the whole thing is
enlarged so this is this thing about
about composing these things there's one
last thing I would like to tell you um
this whole project uses only closure
just the libraries that go with us but
or just the standard libraries where
there is no other software except for
quill um it was mentioned in the in the
tour in this earlier talk um so does
everybody know quill a few so well if
you doesn't know what quill is I have
never seen it some okay um there's a
library out there or I'd say it's a
framework and a library called
processing and there is a nice closure
wrap around it so it can be easily
accessed from from closure programs and
the framework part of it gives you the
typical Mouse events like Mouse released
mouse moved mouse mouse drag our mouse
mouse click and gives you some update
function so it loops around um this is a
framework part of it and there's the
library part of it which gives the
opportunity to draw shapes like ellipses
and circles and lines in all this I
wanted to avoid to have a Crillon
application meaning I like well it's
great software but I didn't want to have
a stew too strong dependency on this so
I defined a minimal set of functions I
want
to have from a renderer dozen or so or
less um and then the implementation with
quill is just one implementation of this
interface and I have another interface
which is just a dummy interface for
testing purposes for my test cases
because then I don't want to have to mix
up with the with a framework it's easier
to have a dummy for these purposes so
and that's the reason maybe if you watch
closely you may have seen that when I
rotated things it went in the wrong way
because normally we have what we call a
mathematical orientation this is counter
clockwise so saying rotate by by PI over
4 would mean a half turn to the left
from you so it's that way but this went
clockwise and moving was a bit weird as
well if you've seen this because I used
the positive number for the for the y
coordinate
but it went down the reason for this is
that where for quill it has that this
the same thing as with very many renders
I think this has more technical reasons
that come out of a graphical processing
um the coordinate system we are
expecting normally as the the
right-handed Cartesian 2 dimensional
coordinate system which is x axis here
and y axis there but this thing is
turned upside down so the y axis goes
from the upper left corner down and this
is a reason why the orientation of of
the circus is reversed I was thinking
about some doing something about this
and to implementing this end shortly
before I was about finding the places
where I had to fix this I thought no I
don't want this because I wanted to a
1-0 rapper to have access to the
coordinate systems as well because in
mathematics or is
in theoretical physics you're very often
play with the coordinate systems and yes
transformations between coordinate
systems and why not having coordinate
systems not as part of the canvas this
should be blank nothing in it but part
of the drawing and that's the reason why
I left this and I defined it to be no
bug which I first thought was okay this
gives me the opportunity to shortly say
something about what's next okay while
presenting this talk I found some more
or less ugly bugs and I will have to fix
them and there are some things that can
be shaped and all this but this is the
bread and butter business and not very
interesting and I think I will get over
and done with this in the next couple of
weeks but there are some design issues I
consider to be a very interesting first
of all it's about the compounds I think
the compound concepts concept is much
more powerful than what I'm using now
I'm using it for triangles and for
drawings and the interesting part is of
drawing but it could be used to
implement things like coordinate systems
another thing I would like to try and to
think about I have no plan yet
um as to have something like vector
fields which would be compounds of other
compounds the compounds would be the
vectors in the thing and I could make up
the fields of these things
I could very well imagine having I don't
dynamic compound something which can
change its shape from one position from
the start position to an end position
and most of all I would like to think
about having complex numbers as
compounds complex numbers have have a
nice feature because they have two faces
one faces complex numbers are very much
similar to two real numbers you can
compute with them just like with real
numbers but they have
they also have a geometric
interpretation and this has to do with
two-dimensional geometry on the plane so
this could be a nice thing to visualize
complex numbers and what you can do with
them okay so this is where the journey
begins and where I'm up to at the moment
and I'm thinking about one last thing
occurred to me when I was playing with
it I think was two days ago or so this
is really fresh I thought well I used I
always had this in mind to have a canvas
here and a wrapper there but why to
restrict myself on the wrapper
it's no use to say just that we only can
play with a river any old program could
do which is capable of connecting to a
server and which can which can work with
the API
so here reppin as I think could very
well be integrated in other programs and
still this and these features of
interaction between these two things
would be maintained so if I started this
as a fun project and it wasn't really
meant seriously but if there's anyone
who can imagine that this might be
useful for him or for her um is talk to
me maybe we can do something about this
and yeah feel free to to talk to me I'll
be around here tonight and tomorrow at
the conference
um and okay thank you very much for your
attention</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>