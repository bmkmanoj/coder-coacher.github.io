<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Clojure on Android - Alexander Yakushev | Coder Coacher - Coaching Coders</title><meta content="Clojure on Android - Alexander Yakushev - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/ClojureTV/">ClojureTV</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Clojure on Android - Alexander Yakushev</b></h2><h5 class="post__date">2015-07-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/mVXTcAEKgF8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so my name is Alexia Kershaw and other
Alex I know he's getting old and I'm
gonna tell you about closure on Android
so this is my first talk ever so I have
to introduce myself
bear with me I've been participating in
google Summer of Code for four years now
in other words I was squandering
Google's money for four years
I worked on closure Android during years
one and two then I during years three I
worked on projects commit which I can't
tell about later and now I'm kind of
busy doing the enabling the test-driven
development and also continuous
integration for closure Android projects
in fact I should be doing that as well
now I'm also incidentally an author of
complement library which is their
completion library that is used by cider
so if completion is ever broken in cider
I'm the person to blame and I just
graduated a week ago so yeah now I have
to figure what what I'm doing with my
life doing well so far I'm on your
closure so this is like the general plan
I'm gonna start with some general
information first
what is closure Android it's an umbrella
term for a set of projects that
basically allow you to develop Android
projects in closure that was unexpected
right so that set of projects includes
our to own closure Forks a build tool
and idiomatic wrapper library and some
different development tooling as well
and it all started it all dates back to
a year 2011 when Daniel Solano Gomez for
the first time released his own Fork of
closure which enabled dynamic
development on Android so that's when it
all began
why closure instead of Java well
obviously because we can take closure
can compile into Java bytecode
and Android runs Java bytecode so they
are basically created one for each other
and yeah because because we can is the
perfect reasonable explanation for me or
for you but maybe not not so much for
your bosses so I had to come up with
some more excuses of like first of all
you get all the advantages of closure
the language all the concurrency
facilities and macros working with any
source of data is suddenly a breeze Java
tries really hard nowadays to catch up
with all the hip languages to get the
nice features like lambdas but there's
still not quite yet there and also
Android only supports Java 1.7 so it
will take them a while until they adopt
the features from the Java age also the
Rebbe rebel driven development I don't
think I have to explain that one to you
like if you ever tried doing dynamic
development at least once you already
know how much superior that is to the
like usual change in rebuild cycle and
also logic data and UI are all in single
language logic and data part is pretty
clear and the UI parts so by default in
Android you declare your user interface
use an XML so and it's declarative so
that's certainly a step forward compared
to let's say swing but it's still a
different language so you have your code
in Java and you have your user interface
in XML and you don't have any excess
from the former to the letter you can
modify it you can transform it just only
render it that's create that creates
obstacles so you may you may ask me like
Alex why I study on the stage presenting
some boring four-year-old technology
while react native is all the rage now
and you know you're right I should I'm
just kidding so there are certainly
arguments pro and con troubles
approaches in case of closure Android we
can all agree that it's closer to native
platform so there are less layers where
something can go wrong if you take
closure Android it's just Android
other political oh sure and on top of
that is your application if we talk
react native its Android on top of that
some JavaScript virtual machine
on top of that is build react native
then we wrap it with closure script
which it then wrapped with almond ATO
whatever that would be called and only
they are your application so more layers
more probability for failure so it's
certainly easier to learn closure
Android for Android developers closure
has arguably better tooling support I
might be wrong with this one correct me
please if that's the case but because in
closure the compiler and the runtime are
not separated certain things like I
don't know wrap all and cider features
are easier to do in closure enclosure
script you have piggyback and all those
different or Apple implementations for
each platform it's quite hard to do also
in closure you have simple simpler
interoffice with Java I'm not sure about
this one yet because I'm yet to see how
exactly like react native closures great
applications will look like and how will
they be able to call Java but I think it
in any case that would be more contrived
than the plain Java closure interrupt to
dead culture provides and it's a great
point
I mean in closure Android we don't have
enough people resources to keep up with
Google to wrap all the new features to
support them but at any point of time
you can just use interrupt to you use
those so yeah and finally it the
language used better for multi-threaded
environment if you compare closure to
JavaScript right so Android is not a
browser it has multiple threads and you
want to utilize those and I feel like
closure
she's better for that maybe closure
script can sort of fix those problems of
JavaScript if we talk Android
development but we're yet to see again
okay and there are certainly arguments
for closure scrip it's faster startup
time at least that's what I was told and
it's very important point it is probably
easier to dive into developing
applications and culture script for we
have developers and there is a potential
to write cross-platform applications so
it's it's not really cross-platform if
that's react native because Facebook
explicitly said that you wouldn't be
able to run a single single written app
on all the platforms it's just the
principle that is common for all the
platforms the apps have to be different
still but anyway the potential is there
is great the would be access to Java
with JavaScript libraries I don't know
how many of those will work and still be
useful but it is there and the final
argument for is like if if David Nolan
is on your side then you know you're
doing something right
so yeah in terms of in terms of number
of David Nolan's on both projects
clojurescript wins one to zero so this
brings us to goals of closure Android
there are two dos it's Latin droid
developers right good absent closure and
let closure developers write good
Android apps and it may seem that I'm
repeating myself but in fact these are
two distinct goals and the first one has
the priority over the second one
basically it means that we try as much
not to lose the initial Android concepts
in our strive to make it more familiar
for closure developers so that's that's
what I feel the difference between
closure Android and closure Script
Android it's gonna be so the first one
is more oriented on Android developers
who want to choose a better language and
the second one is going to be more for
closure developers who want to try
themselves in Android they don't want to
learn the API just yet
and they want to simply try it out and
it's great it's ready to have both
approaches I think so you have to decide
which one suits you best and what you're
gonna do about it okay enough of the
fluff let's get straight to tools Seoul
Android Android is the plugin we develop
for line again and in fact even though
it's just a plugin it's a fully fledged
build system
it handles compilation and packaging and
minification of the code and deployment
on the device so basically everything
you you need to get your closure Android
application running on the actual device
like I've said line droid is really
complex it has around 2000 different
subtasks you can see all of them by
executing lion droid help but absolute
most of the time you will not need those
you only need to follow into commands a
line droid new to create in your app
yeah like in your project and to do
everything else you just do line draw at
all and do all gets you all the way from
a clean project with just sources and
resources to an application the trance
on the actual device with the rapid
enables so you can just connect in and
start hacking would droid is coming soon
it's still under construction but we
already have a logo so that's a step
forward the motive behind building
another built system so to say for
closure Android it becomes apparent if
you ever tried to make a complex multi
target project in line again it is
possible but it's more complicated that
I would like to so yeah
the next on the list is NECO and
basically Necco if the libraries that
you include in your closure Android
projects to make a life easier
it wraps different parts of Android API
and also it takes care of dynamic
compilation it starts rappelled it
enables cider so those development to
lean it handles that as well I'll just
show you some some most interesting
parts of Nico how it helps developing in
closure and Android and for first
facilities Nico UI before I show that
let's take a look how user interface is
defined on Android like on vanilla
Android so it uses XML I told you that
we see here there is a pretty simple
user interface declaration there is a
linear layout which is just a container
and inside of that there is an edit edit
box and there is a button and all those
have some properties and that's how it
looks like in NECO dot u i the first
thing you'll see it's much more concise
but that's not surprising because
everything looks less verbose compared
to XML that's a cheap shot also you can
see well probably you can't see any more
but the number there names of attributes
are very very similar to the ones in the
XML version so it is easy very easy to
port existing UI declarations to an echo
that UI and also it is easy to pick up
for exists Android developers so you
don't have to learn anything new you
just use the same attributes and yeah
that's that's how the result in user
interface looks like yet another thing
is that we can define the callback right
in the DUI declaration you can't really
do that in XML so you have to
to split in your user interface
declaration into two parts you have the
XML part and you have the Java part and
it's not very good in case of closure
you're just right in one place and it
stayed there it is important to
understand that
NACO use a user interface declarations
are just closure data so if you're ever
used to hiccup it's very similar in fact
it looks exactly like hiccup and that
allows you to operate on the on the user
interface declarations using just
regular closure functions like in this
example we create linear layout and then
just stuff it with buttons so we create
ten buttons and we named them
differently and give them different
callbacks but yeah the fact that it's
just closure data structures until they
are rendered it allows us to do that or
even some more crazy stuff so in this
example we first figure out whether the
device is like the orientation of the
device is landscape or portrait this
line and then we just return our user
interface declaration again relatively
relatively out another container and
there is edit box and there is a button
but this time depending on on this flag
whether it's landscape or not it's gonna
end up in to the right of the Edit box
or below the Edit box so the example may
look a little bit complex complicated
but in order to do the same thing in XML
you'd have to define two different
layouts in two different files and then
probably extract some common stuff into
the search file so in actual projects
you end up with a lot of those XML
declarations in different files and it's
hard to keep track of down this in fact
is much more similar simpler sorry
you can also extract individual elements
from from the whole tree it works kind
of the same as CSS selectors it's much
less powerful because you can only
select by the ID attribute but it's very
performant so yeah with optimized
performance here we just just get the
actual object for the ID name is
returned and the last client we modify
the property called enabled that which
was enabled for already X rendered
really ready real so to say UI object
okay another useful facility it's called
data SQLite so by default working with
SQLite on Android is really terrible
you have to write SQL to create your
tables you have to write SQL to select
the data from your tables and the thing
that returns to you is also very very
awkward to operate on this example you
can see that so you first get the cursor
by executing a query
emploice is the name of the table you're
extracting data from and you specify the
columns name salary
active whatever and then the where
clause so it returns your curse cursor
and you move to the next row and then
you have to extract each field one by
one and also you have to remember the
type of each field which is quite
terrible yeah so data SQLite allows you
to define a schema for your SQLite
database here we define a simple schema
with two tables employees and bosses and
both tables have some columns and
columns have data types so nothing's
nothing really fancy here and that's
just implementation details so you have
to create a helper and in order to be
able to get the database so never mind
those but basically the schema allows
you later to to work with that
SQLite database very easily so here we
insert a new row into the employees
table and we basically just pass the
closure close your map closure data
structure into it and this code snippet
we do an update this syntax is like you
specify the name of the table then this
map is things you want to change so it's
basically a set statement of the SQL and
the final final map is the where clause
so you say that you want to operate on
employees with IDs 1 5 or 7 and also
querying the database becomes really
simple so you say you want to extract
data from employees table although the
employees from out on vacation and what
you get is again just closure data
structures already maps that you can use
in your program you don't have to do
anything else about that things that
data SQLite also supports but I just
don't show them here query in multiple
tables it can do that it can query it an
individual scale or values like count or
max and it also supports some batch
sensitive transactions
it's really not that interesting if you
are ready d'etat make or use korma or
any other rapper but it's very this
necro data SQLite is very lightweight so
it's just a namespace with I don't know
a dozen functions and you don't have to
bring any other dependency to a project
to be able to do to use that and when
you do closure Android applications you
really care about the dependencies you
know another example wrapper around
shirt references for those who don't
know what it is it's an Android a
facility that allows you to store some
simple data like primitives and strings
it's yeah it's basically qlu store for
primitives and it's really useful for
things like configurations and things
you want to preserve between the
restarts of the application and we at
neckl provide a macro called def
preferences so you say the preferences
the name of the atom that's going to be
created and the name of the Preferences
file and what that does it's create an
atom but that atom is bound to the
Preferences file so whenever the atom
has changed the Preferences file is
written accordingly so here we just can
swap some-some - we can assume more day
until the my profs atom and that
application might be restarted but the
state of that and will be preserved and
just another example of simplifying the
original android api so creating
dialects is quite ugly in android and
here you can use similar approach to an
echo UI so you just specify their
attributes in a map you just find a
message and then that there are going to
be there gonna be two buttons and
provide the callbacks that balance and
that's how it looks like
so neckl has a lot of stuff I'm not
gonna bore you with that just gonna say
that it also simplifies work with
activities menus resources data adapters
if that doesn't make any sense for you
it's fine when you start like Tim Curry
Nova Scotia Android it suddenly will
okay a little bit about projects coming
this is a fork of closure that I was
working on the last year and basically
it's optimizing closure compiler so
actually it has to be pronounced skooma
I think buddy lists you know they're
okay sure Bruce so and in the region it
means skimmed or fat-free and that
basically what's coming does it skims
all the redundant parts of closure while
keeping its essence the idea is that you
develop in regular closure you use your
Apple life is good but then you have to
develop to deploy or production version
or application or just program scum it
is not limited to Android by the way and
you just substitute the compiler you're
using and it's a sudden speed boost it's
like pressing a charitable button does
anyone remember those computers with
turbo buttons yeah it's like going from
SodaStream a Hertz to 66 a wild thing
and by the way looking at that picture
it reminds me that we're looking for
talented designers and by talented I
mean someone who has Photoshop installed
unlike me so before I explain how come
it works let's take a look how the
original closure compiles worse Oh
so this is a piece of code from core
underscored score in it class
it's a decompiled the compiled class and
the lines here related to the function
just arbitrary function PR STR in this
case so how that works the first line
the PR STR bar is looked up and it's
saved into some constant some field the
class and then the metadata map for that
war is also created initialized a lot of
stuff is being put there then sometime
later that metadata map is set into the
world and then finally the root of the
war is bound so all that interaction
allows us to redefine things in rebel so
it's really nice to have that and then
later the code that would use the PR STR
function it has to do the following and
let's suppose it's in the different
namespace so first it has to look up
devar calling RTO to Aragon then
sometime later in order to actually call
it it has to dereference it first by
calling get root then it finally can
invoke it yeah so it doesn't seem like
much right so it's just four lines but
when you have hundred of ours it adds up
and closure core alone has over 700 Wars
I suppose so Nicolas Karenia me I hope I
pronounced his name right he did
research on what actually constitutes
loading time of closure applications and
he finally found out that most the
biggest part that loading time comes
from initializing worse you can read
that in detail on his blog post and
that's how scum and that things
so the first line yeah again okay you're
gonna keep it like that it comes from
this not from there underscore
underscore in it class its from PR STR
class which is the class from the cadet
compiled function and the line just
ensured us introduces the static
instance of that class is that simple so
it's kind of like single time and then
later the code that wants to use that
function it can just reference it
directly like a static instance of a
class which it is this is quite simple
change right but in fact it brings a lot
of benefits a lot less time is spent
during for initializing VARs they're
compiled underscore underscore in it
classes much smaller because they mostly
consist of those who are initializations
the reference in VARs also becomes much
faster because there is no dereferencing
the memory footprint of the application
is smaller because you don't have to to
have all those VARs and their metadata
in your memory you don't have to keep
that and the last but certainly not
least important it functions they aren't
anymore tied to the namespaces they come
from so originally the wake of closure
compiler things all those underscore
underscore init classes they know of all
functions from their namespaces and
because of that you can't really delete
the unused functions because it's gonna
break the whole program but the way is
come at compile things you can suddenly
use tools like ProGuard which is the
java tree shaker of sorts and you can
actually remove the unused functions
from your program so imagine like taking
those 700 words from closure core and
leave only 200 of them
there are some other things that scum it
also does they're not as important as
lien compilation of wars but still so
scum it doesn't emit macros because
after you you're done with the
compilation macros are pretty much
useless so your runtime code doesn't
call them scum it doesn't emit refer
statements they're also unnecessary
Wow really okay I'm gonna I'll have to
speed up on this so a lot of others
other things commanders I did some
benchmarks flow chime came four times
smaller which is quite cool the package
size don't when droid application more
than two times smaller the heap usage
also reduced by off and again Nicholas
did some rigorous and more benchmarks so
you can look at that up okay if you up
close your Android applications that
exist actually all of those they're
quite a few them for closure app it's an
client for foreclosure calm you can
solve closure problems both online and
offline and you can later synchronize
your solutions with foreclosure calm
account it's on the Play market you can
download it just right now and start
hacking also I try to keep the cold in
the repositories repository very fresh
so if you're looking for the recent
their most up-to-date close Android
practices this is a place to look
clarity keyboard developed by Adam
Clemens and his team in SwiftKey it's a
very intelligent on screen mobile
keyboard that uses natural language
processing to autocorrect whole phrases
they use line droid core async scum it
they have a lot of dependencies so sky
might really help them out and there is
a nice blog post about the architecture
they use to also vulnerable mention and
I trap by Z coax for the first serious
closure Android application ever it's a
peer to peer
mobile social network it runs over i2b
unfortunately it's discontinued and the
code there is quite outdated but still I
had to mention it how to get started you
can use basically any editor that
supports under apple cider is
particularly nice closure android
supports almost all of cider features
the back end doesn't work yet but we
will get there a lot of things like
completion exceptions data inspector all
those work yeah like I said any other
than replicas and also night code it has
some embedded to support for closure
Android the entry point for all closure
Android documentation is closure Android
dot info you can find there all the
important links to the docs and all the
stuff the primary sources of actual
knowledge are they github wikis for all
Android and NECO marginalia Dark Souls
are quite helpful you can find me during
wake up waking hours in Europe on
closure Android RC channel and we also
have my link group yeah a lot of stuff I
have to do in future I don't have any
time for that yeah we need people we
need people to to write code to write
apps to discover new use cases to write
code and contribute it and to report
bugs so together we can prove the
closure Android is first-class language
how about that okay it's time for live
demo I think I still have some time left
oh yeah so I had to do it on the actual
device but the tech fails me today so I
have to do it on emulator so I already
installed bare-bones application here
yeah you can enjoy the splash screen
because it takes a while
but it's it's a development version so
it has all the namespaces äôt compiled
and a lot of extra dependencies that you
don't need in production so this is an
application and here we do can you see
that perhaps again maybe like this
better so I just decide her a localhost
and it completes the port for me
in real life so I can some stuff I can
evaluate some stuff and it opens it all
happens on the emulator right now so I
can do let's see I just over here I can
do ghost
yep hello your closure
well more like hello exception okay
there it is we made a toast okay
so I'm gonna be really quick about this
we have a list here and you can see I
have an atom here it's just a plain atom
with some strings and basically that
atom is rendered into the ListView using
this textview things you can see them
here so I can do this swap data conch
Epsilon
that's right and there it is
so where's your react now I can do also
like range time yeah okay so let's
boring
I have already function here to get
stuff from github so it's basically just
slurps some get requests and parts of
the JSON and struggling to memorize so
that it's like formats cache so we can
do the following
reset data github get it
I think it's works closure repos let's
try that okay
it certainly returns something yeah
right you see that here so what we just
did is just stuffed I released item with
the response of a github request we can
use data inspector to see what exactly
return okay so that's a list of all wrap
revos and closure organization so I
already have some code written to make
it nice
so I hate that and there we go back so
we get a nice list of repositories with
descriptions and number of stars star
wars and we can also click on the
repository and it gets us again the name
of the browser tree and the number of
contributors
that's another activity that just
launched I already written that one too
this here so what we do here it's just
we pass the name of the repository to
this activity we read it here and then
we again request github for the
contributors for that project and here
just put their account we can also
actually output the list of the
contributors I'm gonna do some data
structure magic here so I could also use
the list view but just for the sake of
example I'm going to create a bunch of
text view to to shove those
no okay
probably not gonna show this now anyway
so I'm gonna just remove that necessary
stuff okay and now I want to show you
how fast rate becomes with commit so i'm
michele lewane with profile lien it's
just some profile defined in my projects
LJ and I do that and now we wait and
pray so it's gonna take a little while
to first it compiles so all the Java
classes and close your code it's gonna
get quite wearable now yep there we go
so that was commit come on Percy oh so
now it runs ProGuard to remove the
unused functions in our code also takes
a while
it creates the decks and Dex is
basically it's the packaged Java class
files optimized for Android just to say
okay yeah it still takes long because
it's an emulator so on the device it's
about a second I'll show it again yeah
it had to be the wow effect here like I
launched it and it it loads in one
second but just let just imagine that
happened okay so yeah I have some folks
to think so yeah I think all those
people I don't have time to do that
properly and that's so that's all I have
thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>