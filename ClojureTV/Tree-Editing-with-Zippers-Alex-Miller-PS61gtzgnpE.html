<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Tree Editing with Zippers - Alex Miller | Coder Coacher - Coaching Coders</title><meta content="Tree Editing with Zippers - Alex Miller - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/ClojureTV/">ClojureTV</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Tree Editing with Zippers - Alex Miller</b></h2><h5 class="post__date">2012-12-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/PS61gtzgnpE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">thank you so this is kind of based on I
wrote these up last night based on the
top Luke's great talk yesterday about
zippers and also it touches a little bit
on protocols and it's something that
we're doing at robotics to do tree
mutation with zippers so I thought it
was interesting first I want to talk a
little bit about doing zippers over
records trio of Records so I'm going to
start actually with this which doesn't
have anything to do with rapport with
records but might be useful so I've
actually created a protocol so the
zipper function which you'll see down at
the bottom takes three functions that
you need to define on a route and I've
actually used a protocol to define what
those are so that we can sort of swap in
an implementation for each of our record
types so we have branch is this thing
possible that children no children and
make note makes a new child a new node
when you're sitting at a particular
point in the in the zipper over a
location and then I've also extended it
with a default a default one and so here
I'm going to create some records and
these records are really some kind of
doing some arithmetic type stuff so a
scalar function something like plus or
minus or can cat or whatever it's some
function it has some expressions that go
with it I've got a comparison which is
something like left equals right or left
greater than right this is just an
example so i can build up a little tree
out of these I'm then going to extend
the protocol that I created in the last
slide tree node into into the two types
scalar function in comparison so I'm
just simple any of those things and
there's kind of a difference in style
here between these two the first one is
taking actually a sikh of records so the
children are contained in a sikh of
records in the record the other one is
that i have a set of fields each of
which is a single record if we want to
add support for records in the zip
library directly I think the crux of the
only interesting questions that need to
be answered are around how we make this
work generically and i'm not sure what
the answer is so i think that'd be a
good thing for all of you to think about
but you'll see the difference in what
that means in the implementation down
there so here I've got actually three
different representations of a tree the
code is their f1 and f2 our functions
that say two plus three and six minus
one and a comparison that says those
through things equal to each other which
is sort of the string representation and
a tree representation over on the right
so that's my tree of records and I'm
then going to use tree zip which is they
the zipper implantation that uses the
protocol I'm just going to wrap that
around the around the root node and that
so treezy is then a zipper on this tree
of Records and then I can I can use all
of the zipper functions here the alias
the namespace and dizzy so I can go down
down right and I get to and then return
the node at that location it will return
three so moving beyond that something
that we've found really useful is that
what we need to do a lot is take these
trees of heterogeneous records I want to
search for patterns inside that tree and
then mutate the tree in some way that
changes to a new tree and I want to do
this over and over again so we wrote
this function that's going to take a
zipper a match or function in an editor
function and it's going to i'm doing a
loop recur here it's basically on top of
zipper next until it hits the end so I'm
just skimming through and duffer's order
through all the locations in the tree at
every location i'm going to apply the
matcher function i'm going to get the
match a result and what we found is that
times the matchers building up state
that I don't want to redo that work in
the editor so I should return the result
of the masher function into the editor
if it matches so that was a nice
performance improvement so the edit
function is then modifying the note so
if we matched at that point in the
zipper note if we've matched we apply
the zipper edit function with our editor
function and if the if there was a
change then we bail out and otherwise we
keep recurring so this will apply
exactly one treat mutation and there's
more stuff that we wrap around this to
sort of apply multiple rules but as an
example here I've got a rule that says
the match function is is it a scalar
function and if it is the editor
function takes the result of match which
in this case I don't care about that's
the underscore and then it takes the
node under that I'm act and it will then
apply that either plus or minus or
they'll say oh noes if it's fight
something it doesn't understand and then
so we will apply that and we'll get the
second one that is it so you'll get
you'll be able to apply to two plus
three and get five so you can apply the
little x that's it
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>