<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>PythonとOracle Database: 技術Tips、小技、そして最高の新機能 | Coder Coacher - Coaching Coders</title><meta content="PythonとOracle Database: 技術Tips、小技、そして最高の新機能 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>PythonとOracle Database: 技術Tips、小技、そして最高の新機能</b></h2><h5 class="post__date">2017-08-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/K9tbe6COvlU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello welcome everyone okay thank you
very much for coming along to this talk
late in the afternoon I'm impressed that
there are so many people here thank you
very much again mr. Akira mentioned
Python this morning in his talk and I
saw some books on Python in the stalls
in the booth I think you'll understand
that it is a very popular language and
has many applications with a very big
environment you might have seen this
slide before I am speaking about
open-source software software which is
very flexible fast release cycles we
don't have commitments about things so
please don't buy anything based on
anything that I say so my name is
Christopher Jones I am a product manager
for the Oracle database specializing in
scripting languages programming
languages such as PHP node.js Python I
worked very heavily with PHP and have
recently been focusing on nodejs
and on the Python languages you can see
their email my Twitter handle
gh Rd and the blog site and I have some
cards up here business cards if you want
to come and get something afterwards
because I would love to hear your
questions your problems your suggestions
so the group that I am in looks after a
lot of these database access languages
looking at the driver API level
accessing between programming language
and the database so we have some
proprietary languages there in red at
the top some of the open-source drivers
that we contribute to in the blue and
some of the others which are important
to us but we liaise with we don't
directly contribute Perl and Ruby and
you know that Ruby is very popular here
in Japan
Kubo and yes you o do a great job with
Ruby and with the Ruby on
adapter and there's also go which I
haven't fitted on the slide here the mac
n driver for the go language is also
developed by Japanese engineer so we
focus here on these driver levels why
was it going to be speaking about Python
today I also have some responsibility
for the sequel net layer which is a
layer between these languages and the
database and some of the other C API
responsibilities I have a kind of
rubber-stamp responsibility people think
I'm responsible but I actually spend
most of my time on the open-source
drivers so we'll try and get through
everything today there's a lot of
material here I hope that you will take
some notes about the topics and then
come to our website to look for the
examples and again ask questions to us
let's go a little bit into the
background here and I know it's a little
dark but who is using Python already can
you put your hands up if you're using
Python fantastic is anybody using Python
with the Oracle database using this CX
Oracle database driver anybody Sugoi
fantastic thank you thank you very much
for using that it's certainly the most
popular of our database access drivers
out there it's for the c python which is
a reference implementation of Python
I'll just use the word play fun from now
on it was started by third party
external open source project Anthony - a
ninja who is still the current
maintainer of that of the project so the
CX stands with a company that he worked
at at the time a company called complete
Ronix so the rough architecture you
probably have this in your head is that
we always start with these languages
with an Oracle client library stack
there at the very bottom so this is a
proprietary Stax and binary code which
we give you some libraries CX Oracle
driver talks that protocol Python
communicates with CX Oracle and you as a
user your programs on the left there you
can see just treat
my phone is a single block and then on
the right you can see the arrows that
the sequel met later I spoke about
before connecting into the database and
you can use the Oracle cloud you know at
a conference like this I I'm almost
obligated to mention Oracle cloud but
you can use Oracle cloud or your own
on-premise database so first get so you
can use the Oracle instant client so
that's a free set of libraries widely
tested supported gives a lot of the high
availability connection management
features statement cache features very
easy to install and don't forget across
that what we call the client to the
server from your Python to the database
you can use different versions of those
Oracle client libraries so you don't
have to have 12.2 client and 12.2
database you can be slightly different
than your version numbers they're
instant client 12.2 latest and greatest
is available if you haven't heard that
and we also have docker images that the
docker technology we have docket images
of instant client available now let's
move on I'm going to talk a little bit
about CX Oracle 5.2 this is the most
common version that we see out there it
was released a couple of years ago and
that's why it's installed in many places
the 5.2.1 release added support for
python version 3.5 and it had many
features it was a big release here in
the 5.2 i'm going to talk about the top
two in some detail and it will go into
into those so you can get an
understanding with technology so another
tip of course is that when we're talking
about this client and the database
Python on the database you want to
reduce the network traffic with network
traffic will impact scalability
performance and scalability of the
database itself so you want to be using
a function like the
execute many function and one thing with
it that wasn't possible until version
5.2 was understanding how many objects
that actually operated on this is useful
for identifying what actually happens in
what we call the DML BML data
manipulation language really means
inserts and update statements so here's
an example this is just some rough
sequel code if you get the examples from
us you'll see these in detail all you
need to know here is in red is that we
have table with a primary key and a
foreign key so add some data a 1011
third of that already and then back in
Python we can set this option array DML
row counts and execute the statement if
you have one statement but we have an
array of values so we're doing this
execute many reducing the network
traffic and then at the end of the
statement there on line 9 we can get the
array DML row counts and so with most
sample data that I have inserted we had
for a particular ID parent ID we deleted
three rows so you can use this for
tracing and understanding what actually
happens with your data batch areas is
very similar another five point two
feature you often do want to throw a
bunch of data at the database you're not
sure office or going to work you may be
sending a identifier across some other
process may have already deleted that
identified by the time you send yours so
you might get an error from that but you
want the others to work if you're doing
it into it you want to insert as many as
possible so this feature lets you commit
what does work and get errors back about
what doesn't work again using this
execute menu function and note at the
bottom that this is available with
version 12.1 of the database obviously
we're trying to encourage you to move
forward but there are reasons this is a
feature which is only available
in that belief so here's the example
code again assuming the ten might have
some data inserted line three has
duplicate values as to to what we called
tuples in in in Python and that's going
to give an error if I train and set
because it's supposed to be unique and
then the particular data set that I have
there on line five the parent ID six
does not exist so I get an error from
that so line 10 said the spatulas line
11 and check what errors that happened
and I will get two errors back from
those two clashes mistakes but the other
data will actually have been inserted so
very useful in your dynamic web kind of
environments the key take-home point
here of course is to use execute many
and reduce your round trips those are
the top two features you know whatever a
very short talk here today so I just
want to get you thinking about some of
these things take some notes go back and
implement best features but I should say
that the Python driver actually has
perhaps one of the most complete
implementations of data access of the
drivers other the very popular JDBC and
dotnet of the open source drivers Python
has a very big implementation with lots
of functionality so it's the most
flexible so Oracle had contributed code
to to Python 5.2 we actually hired
Anthony last year and he's been doing a
lot of great work for us he is the
maintainer and I don't know if you're
familiar in the open source world what a
maintainer does they are the the mothers
they they nurture the code they accept
contributions from people they tell you
where you should be going but they don't
have any management control they try and
influence you
they provide things for you so they're
kind of like a manager without any
responsibilities and they they do a very
good job so along the way
Python is long 1672 partner this excuse
me along the way with the CX Oracle's
long
history it's moved locations from the
SourceForge site to the bitbucket site
we've now centralized on github for the
source and on this pipe I packaged index
site for the binaries and source so the
bunch of features there I'm not going to
talk about all of these I'll talk about
the top view so let me on this slide
talk about the others just briefly
addition based redefinition I don't have
examples for here that is a way of being
able to have multiple copies of your PL
sequel your Arkell package procedural
logic in your database and a runtime
decide which version you're going to use
great for upgrading because you have the
old in the new version at runtime you
can decide when to cut over between old
and new and you can test before you go
production transaction guard I'm not
going to talk about that's a great way
for understanding whether the data which
you sent to the database was committed
if you send data the database the
database sends back the message yes it
was committed and the network drops and
you never receive that message so you
don't know was a committed or not
database knows it was you don't know
some transaction guard lets us identify
that and for those are advanced features
I'm sorry I won't have time to get into
those today let's look at binding named
objects this is fantastic for
particularly these spatial data objects
so anybody doing location work mapping
work and anybody else using any
arbitrary objects we now have the
ability to bind them so we saw in that
execute many we had a statement the
insert and we have the data binding is a
sort of process of merging those two
together with objects now we can send a
statement they we can pass the Python
object into that statement one to one
gets it converted to an Oracle object in
the database but yet our pool was able
to fetch objects in all the versions but
now you can actually find them fit
insert
to have a couple of new methods there to
get type and this new objection of this
go through briefly so the background the
sequel is that we have a table no
surprises and we have this s geospatial
data objects geometry which is an
article pre supplied type and here we
can now use this new get type online one
which will go across the database of
query and get information about that
sto geometry and then in Python this is
or Python land we can get the subtypes
there on two and three create a Python
object on line four and manipulate that
and in the subsequent lines extend that
objects just using straight Python
assignments if we have a Python object
obj the object and the key here very
last line is that the bind statement
with binding that Python objects with a
Python object and we're binding it into
your sequel statement there the insert
statement so those not quite a bit over
colon binds in taxes is the bind
variable locator and of course you
should be using binding because it gives
you separation of data at statements so
you don't have sequel injection security
issues where people manipulate your data
and it changes the sequel statement no
possibility of that and it gives you
some scalability in a database because
the database cache can reuse information
like that statement a lot better let's
move on got a lot of slides so binding
collections and records also was
enhanced in version 12.1 of the database
and that lower-level client layer and
python is able to make use of that as
well example here this is the basic what
happens in the backend in the sequel in
the database we have a type there on
line three at the table of index and in
the index by table we sometimes call it
and there you have a procedure which is
going to on line eight which is going to
manipulate and actually assigned some
values into that collection collection
is
the Oracles term for an array okay so
given this data we can call that
procedure there on line three
so the calling straight into the PL
sequel end clamp going to the server
we're getting back an object there's an
out bind with getting stuff out from the
database and then we have these new
methods first get element next and as
list we can manipulate that object to do
and similarly with records maybe I
should skip over this a little bit
similar sort of thing we have two PL
sequel we create this record type we can
assign some values you know just another
variant of the Oracle database types and
how you can map them into the Python
types so the latest versions of the CX
Oracle driver latest version to the
database you pretty much don't need to
worry about this because it's all done
for you you have access to do the
binding directly it's again we can pull
this get type go to the database gets an
information about it line two we create
a Python object you can manipulate it so
just manipulate the Python object my
name bind it Python object but up the
driver see X alpha driver knows what to
do with that Python object knows how to
map it into the Oracle database object
calls the procedure does whatever wants
to do and prints out data so implicit
results now this is interesting I don't
know if you use something like Sybase PL
sequel the stored procedure language now
has a way to pass multiple values back
multiple query results back without
having to make them part of the formal
parameters so new methods we create some
plc call we've got this new magic PL
sequel keywords the return return result
return underscore result they're on
eight and twelve and then in Python line
fourteen we just say get me the results
of that query there's no sort of
creating passing bind variables or
anything like that so it's a very easy
way to get query results back from the
data
and because I've done two queries in the
one block I reduced the round trips for
the database I haven't had to do an
execute of a one select execute of a
second select I just done executed the
PL sequel block so think about using PL
sequel the stored procedure language for
combining operations together to make
scalability major applications efficient
give everybody the the real-time
functionality that they want nowadays
scrollable cursors now this had a lot of
interest when we talked about it at our
big Oracle OpenWorld conference at the
end of last year you know what a cursor
is cursor is effectually the pointer to
the set of rows you get back when you do
a query you get Row 1 Row 2 Row 3
cursors kind of like the pointer to that
and generally you've had to go through
one by one by one now you can actually
jump backwards that's great for some
reason because programmers often forget
what they had or they have a separate
section of code which needs to know some
previous data so you can jump back in
the result set and get that data without
having to cache it locally so the driver
does the work for you of course we have
to do the caching so the database has to
actually allocate that memory so don't
use this if you're not going to actually
need to go backwards here's the example
very simple when you create your cursor
in the Python steps a local driver you
just say scrollable equals true and then
from then on and all of the other
examples you can see I have there is
modes cursor dot scroll on line three
and I can do modes or Flast and first an
absolute position and I can do relative
positions like minus four to dump
backwards so we're kind of trying to do
the keishon for you which your
application may have had to do
previously there for your application
code is simpler advanced queuing is
another really cool feature we have a
queuing facility in Oracle database
which is very advanced
that's why it's called advanced you can
have multiple queues multiple listeners
you can define what sort of type of
message you want to be put into that
queue and then who's going to pull it
off
multiple databases interacting but this
is a great way for these new micro
service architectures that you see
coming up because you just put messages
and say here's my data or do this task
so you can put it into the queue
something be registered listener and can
be pulling off out of the queue what's
supposed to happen next and it can
either delete it from the queue or leave
it in the queue a lot of options going
on there
Python now has native methods to this
you don't have to use workarounds to get
to get this so this is the sequel code I
create an object this is a message that
I'm going to send the payload that I'm
going to put into this queue and then I
have some grants and other access things
which I haven't shown you but once you
have those set up then I can just create
a queue table to store the messages you
know in the Oracle world everything is a
table or review so we actually use a
table underneath and then I create a
queue and actually start that queue make
it available for people to use some
Python on queue options I mentioned some
of the options before like the number of
attempts you can try to put things in
the queue if there's an issue delay that
you want to wait before it gets put in
the queue it's your ID identifiers that
you want expirations if nobody's
accessed it for a while and you're just
the keyword negative leads it in this
example online - I haven't put any
particular options and some message
properties that I can add as well
similarly lines 5 to 10 just sticking
some data into that Python object and
then I'm sending in line 14 just in
queueing it's sending across that object
into the into the database queue and I
don't care because I'm a micro service
and I just said go and do something
somebody else's problem your call it so
DQ something actually has to listen and
you can don't have to use Python to DQ
you can use any other kind of article
language you want and you have DQ
options that similar to sort of specify
the kind of levels of control that you
want on the message deleted not delete
it from the queue and I can use this new
dvq on line 7 to actually get them
data back out of that queue obviously
just looping here and a loop pulling
everything out non-stop I think that's
really great in that micro-services
world other features I did want to throw
this in you've know a bit at a time I'm
not going to talk about these
particularly much one possible thing no
guesses with driver name change at the
very bottom and that as we're spending a
lot more time with all of these
languages with PHP drivers knows Python
etc we're really trying to standardize
information and consistency and make
them all available I'll speak about that
a little later and whenever you use the
Python CX Oracle program something gets
stored in the database which you can
query in a view and the database table
to tell you that pythons deck circle had
connected and which version it was and
so you in this new DBA gave ops role
developer operations role you can go and
monitor and see that all of your users
out there do they have the latest
version or not so you get more control
over what's going on makes it easier
when you do need to upgrade because you
can test your new program with your
version and then make sure everybody's
using with your version so let's go into
CX Oracle 6 beta so this is hot off the
press yeah we're just into May and this
came out last month and I know Anthony's
been hassling me troubling me he really
wants to get the next releases out there
particularly because he's going on
vacation in June and he wants to get
stuff out so I told him he can't release
a production version and then go on
vacation he has to release it when he's
back in can answer questions and help
people with their any issues but anyway
we're going to go production very soon
with this next week before they have a
release candidate or a beta in my
quarter beta 2 version so we've got a
couple things here I will talk about I'm
going to talk about the top one in
particular
Python wheels and the others leave you
two to come and ask us questions about
so one thing we did with this mountain
has been working very very hard on this
over the last year or so is we have a
new open-source project out there it's
on like github repository and it's
called this o DPI which actually turns
out to be the least worst acronym that
we could get Oracle's very big on
history everybody has a full letter name
and all the good ones were taken but we
we've got this one got the acronym and
then we traded the name afterwards the
key thing for you is that your programs
shouldn't notice a difference the API
that you use that your Python program is
rising is unchanged but we've just
changed the bottom if you look at the
picture at the bottom we've stuck in
this little ODP I see layer underneath
CX in Oracle so CX are four actually
it's got smaller a no DPI it's a little
bit bigger so Anthony's reduce the size
of CX article by about five thousand
lines of code so the plan here and let
me didn't get into that on the next
slide but there's less code in this GL
the global interpreter lock which is
always a problem in Python and that
means that there's less contention so if
you're using multiple trades you're
going to get better scalability with
this version Anthony likes to think
there's better performance but as we all
know performance depends on so much the
time and for your sequel statements what
whether you've done binding with kinds
of functionality that you've used so
yeah although he's very promising and
very pleased and optimistic you know
please go and test and let us know so
this is like a sidebar you know in a
newspaper you have a little column this
is a sidebar on to this
ODP I see so the seed library source and
I kind of mention it because some of you
may be C programmers you can go and use
this if you want you can just take the
code change it incorporate it and during
projects you can build it as a library
or just stick the source code as if it
was your own source code it kind of
aimed at data based drivers like nodejs
pipe PHP and the Python so which hoping
to reuse it and very soon will have a
version of our know driver out which
does use this so we're going to get a
consistent layer underneath
standard tested solid layer reducing the
size of the drivers and making sure
there's a lot of available functionality
one of the features is that it compiles
without needing any Oracle code around
and this is by the magic of of runtime
loading there with that deal open
functional the load library function on
Windows
so hopefully install is going to be a
little easier for you and the drivers of
the very billion I guess you could call
it a zone driver the access layer the
API does a lot of extra things resource
validation has a kind of simpler memory
management and deals with native C types
so again if you're using C programs or
you're writing drivers this might be
very useful so that's a little sidebar
about what it actually is the main thing
there is that look at the compilation
should be a little easier for you going
forward and that's directly reflected
into CX Oracle wheels so previously
there were eggs eg GS Python eggs and
because we had a type dependency on the
client version of Oracle and there's
eggs because they're a binary code used
to have to have many more eggs and you
just have to know which one you wanted
to install now with wheels there's no
build time dependency on the Oracle
version it's all done at runtime and we
can just give you one one binary and I'm
just giving you a topless pair of a
screenshot of what's happening on the pi
pi website python package index website
um if you want to go and test that kind
of pre-release so in the top there in
the color box use this minus pre options
of the pre-release option so you can go
and install that and would encourage you
to do that please report issues there at
the URL at the bottom so particularly if
you're thinking about grading you know
what it's like tests now get problems
fixed before you need to migrate across
one little quote there is almost a kind
of little bit of a backward
compatibility rate for one specific use
case on Linux is that you will need to
set your LD library path or there's
something there
called the LD config on Linux which you
could set there was a special case with
earlier versions where you didn't need
to do that but now you need to do that
in all cases and that's due to this
runtime linking so let's get into some
advanced tips and tricks I've actually
got a fair amount of time but this is
kind of complex so I will see whether
we're just going to run a little shorter
then you can ask me questions or whether
we drive into details so this slide
actually is worth talking about in some
detail
I mentioned reducing round trips across
that sequel net layer between Python and
the database another way to reduce round
trips is to set what we call the array
size this was like a bash instead of
getting one row back when you do a query
you can get multiple rows back and
Oracle does all of the upper management
application looks exactly the same
doesn't need to know if there's one or
more rows articles articles doing the
management of that data transfer for you
the application may say give me one row
and I'll just get one row underneath
Oracle may have got ten rows your
application doesn't need to know about
that but we've reduced the round trips
because we can fill in the packets much
more efficiently so when you're writing
your application to make sure you're
binding that's always the first thing in
Oracle land I mentioned that a couple of
times and then obviously when you're
fetching data as I'm talking about here
you want to make sure you're setting the
array size appropriately for your you
know data data sizes that you've got you
need to do some testing there to work
out what's most efficient and you can
change that for each individual query I
did actually go into the bind variables
a little bit more earlier so I've kind
of covered this before these are very
very important so literal value means
you're hard-coded value or doing string
concatenation you take a sequel query
and user data and you build up a sequel
string do not do that
especially with data which comes from
the web because you don't know what
users nasty little things users have put
into their sequels into their data
strings you don't want them to be
changing your sequel they just send into
the database that's why you keep these
two things separate the data and the
statement and you bind them together and
the database handles all of this spoke
about the pausing reduction so there's a
reduction in the actual statement
pausing because a statement has that
little colon line verbal syntax every
single statement you stand has the same
syntax so that doesn't need to be parsed
we can reuse a security context on the
database side obviously reuse block
buffers if it is actually the same
statement and same data going across and
on the client side we can also sometimes
they even have to send the statement
across because if we know that it's the
same statement that your program is
executing a thousand times because you
have a thousand million customers we can
just say I'll execute statement number
one effectively using your cursor number
one is what we would really call it so
it's that cursor number which just has
to go across the wire instead of the
whole text of the statement so we can
again improve scalability by reducing
the network traffic per session pooling
and database resident connection pooling
session pooling is something you do in
Python database connection pooling or
something you do on the database side
session falling is a way of having
connections to the database so
connections connection establishment is
slow in Oracle sorry about that it has
to do a lot of work it has to start up a
process so you say I want to connect
user Chris wants to connect to the
database how to start up a process which
is going to read the table buffers and
speak to all of the background processes
that takes time I can initialize memory
of a set of contacts and then I've got
to shut it down at the end when the
connection finishes that's kind of slow
so we can set up a pool of connections a
Python knows about these you have
one-to-one correspondence to the pool on
the database and you do what we call
check out from that pool and check back
to get me a connection release
connection
so you want to be using session cooling
where possible in your applications
obviously if they're doing lots of
repetitive things and running for a long
time now in the modern world what
happens we programs is you don't just
have one program speaking to one
database you have lots of programs
speaking to the database you have lots
of docker containers or lots of virtual
machines and those sessions can't be
shared between the processes there's the
client side that Python side sessions
platforms like connections so that's
where this database resident connection
pooling comes in it's a pool of those
server processes that I spoke about the
ones that you have to start up and
destroy instead of context and they
exist all the time on the database and
it doesn't have to be a one-to-one
correspondence between what's happening
in a Python world and the database world
because we're managing the connections
for you your application may think it's
connected but if it's not actually doing
anything you're not really connected
that pool process is being used by
something else so weird managing this
intelligent intelligently and it works
on the premise that your applications
actually do have what we call think time
some idle time where your web user sends
across the request you send them back a
page and they go yeah maybe I should buy
by that book today you know click the
buy but think time where they're
thinking about it they're not actually
using a connection and so the DRC P is
able to reuse that connection for
somebody else who is actually getting
their commit button or browse button at
that time so those are the two popular
things and you probably want to get up
to the 5.3 version of Python to be using
that you can use it in with session you
can let me step back if you want to use
dscp you can use it with 5.2 version but
it was enhanced in the 5.3 version for
some other cases as well if you're not
going to an amazing session pooling so
you can use it with or without they're
kind of independent and if you want your
session pulling GRC P version 5.2 is
okay or if you want to use it without
session pooling probably want to get to
5.3
okay so now it's an advanced tip so
we're kind of done from the easy basic
things binding arrays things like that
this is sub classing so very kind of
familiar concept to you the object
orientated world you have a parent class
which is something we provide accuracy
and a connection these are objects of
methods and attributes and you can
extend those so you can hook any
functionality you want in when one of
those connection or cursor operations
actually occurs very useful things like
logging or you might even change the
parameters or always force some of the
parameters now this is an example of
always forcing the parameter so line one
we're creating a new class the new
Python class and if you kind of look at
line five we're returning to super you
know returning the parent class
connection but we're actually changing
one of the parameters we're changing
this DSM which is the connect streamlet
language database I want to connect to
always forcing connect string to go to a
certain database and line forum and kind
of log in what's going on down the line
ten but a cursor also extending that and
we're doing I've arrived sort of an
execute so that I knew execute people
familiar with CX Oracle know there's an
execute method in the default cursor and
you can see down there in line 17 we're
doing it again the super you know
calling the parent class execute they're
actually passing a new statement through
so this aligns 12 to 17 I really just
printed some some logging information
they're not changing anything we're just
doing a straight pass through of the
statement and the arguments and so I
don't have haven't given you the full
context but pretend bypass the Select
Colin one from jewels a bind variable
just happen to give it at numbers as
it's sort of name and I haven't passed
one two three four is my bind variable
arguments and so this execution of the
script would print out that I had done a
connect obviously had to connect to
database to do something and then did
the execute and got some results back
which I'm not training
doing very much but I can put any kind
of logic in here that I'd actually like
so ro factory functions so normally get
a couple back you know that list that
array back from when you do a query and
now we can get back things like objects
we can map names give a custom play on
object if you want to do that
effectively hide all of that logics and
the application and just do think that
it is executing something simply a hook
will lunge it so much meaning change it
and then get back whatever had been
changed so here's a kind of example I've
done a select I have two columns parent
ID and description and with this row
factory on line four actually said hum I
don't like those two column names and
you know an ARCA world everything is
going to come back at uppercase because
Oracle thinks everything is ASCII single
single bytes stuff used to of course not
doesn't anymore but I want to change
those names and I want to be case
sensitive so I just give my standard
curse of sexual on line five yeah and
just as your existing programs would but
now I'm getting back on line seven I'm
actually getting back objects and you
can see absolute row I've done worry dot
new parent ID and that is the case
sensitivity so I could have done
anything there I liked in that
collection on row factory online form
there's an equivalent outputs there so
this is very similar to just printing
names if I did a for loop there and gave
it some some column aliases object
aliases I could have just printed so I
am computer my languages I think you get
the point on line ten I'm just
associating those Python variables
parent ID to description too we see
tuples which are coming back and I could
just print out those variables or I
could have just used the old array
syntax there on line fourteen you know
the zero and the one the offsets but
zeros and ones don't mean a lot
error-prone if something changes so row
factory is kind of good way to prevent
is happening so some of the users here
for output type handlers too
particularly around decimal objects we
see this a little bit in scripting
language world in people accessing
numeric data from the database is that
oracle numbers i have a decimal
representations stored in the database
and then typically in programming
languages they have a binary
representation and they may be different
bit widths as well which doesn't help so
people often say in the programming
language I didn't get the data right
it was corrupted it's like well as in
corrupted that's you know that's the
mapping from decimal to binary that's
expected and they are they hate that so
here we can kind of override some of
this functionalities if it's not doing
what you want and I would as a sidebar
often recommend that you do numeric
financial calculations in the database
using the oracle data types because
you're going to get much more accurate
more consistent more portable across all
of your applications results same result
same it's going to run in the database
for all the applications connecting to
the database so here we have a output
handler by actually let me start at the
top is that if we didn't have the output
handler when I execute this statement
I'm going to get the parent ID back as a
number one you can see the one on the
two there in the box at the top right
I just numeric values but maybe I don't
like that for whatever reason obviously
an example I have a new method I created
returning numbers of strings and down
there on line six using the magic of
this cursor bar and then give me a nine
character string back I want it to be
main character string if on line five if
it is a number give me a string back I
register this output type handler line
eight and then when I do the same query
as I did earlier and print the rows I
actually get back strings you can see
the quotes around the numbers there so
I'm getting strings back so people have
often used this to get the string
representation numbers back and then
with that string representation they
pass that to some third party
americana Ling routine and do what they
like with it had a big long argument
discussion ongoing with some of our
real-world performance team members the
other day about why you should never
represent numbers and strings that's
their kind of conceptual understanding
that they think that's bad and you lose
this and don't do that but in the real
world actually a lot of people seem to
do this it does vary a little bit with
language python is very advanced and you
can see here that actually python has
this decimal decimal function on line 6
the python actually does have a decimal
representation so if you're using Python
I recommend then you'll not have this
kind of issue
but we need to actually tell the CX
alpha driver to return return those
numbers of the decimal format so I have
on line four I have this message which
again says if it's a CX Oracle number
type then return this cursor bar call up
converter this time and actually map
that number into this decimal that
decimal representation you can say you
can see on the bottom left so the fourth
type without without what I'm showing
you you know the kind of top of the
screen is every kind of get this
representation which is wrong I mean
there's no such thing as wrong with
floating-point numbers because you can
never accurately represent almost no
numbers from the accurately represented
to floating-point numbers we output type
an but you can map to what you often
think is right that's the bottom right
there
so they got a couple of minutes left
input type handlers very sort of similar
thing that when you're passing data into
the database I can change how it gets
bound and there's a little bit of magic
here going on don't want to get into too
many details about the objects and he's
created what can I can't really fit it
all on to the slide here but if you look
at line 12 again I'm registering this
kind of method which I've created this
building in conversion I've created
Python method and so it's registers an
in converter and then when I actually do
the bind there on line 16 and
take the Python object building the
Python object it's going to get
automatically passed to this method you
see at the top on line one and mapped
into the Oracle data type so final slide
56 seconds to go according to my
countdown clock
CX our people have had a very long
history 16 or 17 years very very popular
the most popular of our open-source
drivers out there python has a huge
ecosystem which you can take advantage
of we are now maintaining directly
maintaining the CX article driver it is
still an open source project you can
contribute to it you can hit us when
there are issues but we don't offer the
paid telephone support for that model
has worked very well for many people
because they have direct access to
developers instead of having to go
through our core support which sometimes
can be a little slow
you can connect on-premise and cloud
databases go cloud and we have this new
version of the driver coming out very
soon which will use this new abstraction
layer I think you'll you'll like and we
can start adding some more features in
there in future using that abstraction
layer although Python CX Oracle is
already very thought featured I would be
able to bring you those those features
very very rapidly in future and we'll be
able to make it more consistent with
what we do with a no driver in future
and the PHP driver and therefore you
have your language of choice and will be
able to access a lot of the
functionality which we show here and a
lot of functionality which I haven't had
time to show you so I'll just leave you
with this as I mentioned I have some
business cards up here and left a bunch
upstairs in the hotel room please feel
free to come and get one if you would
like to talk to me send the email ask
questions about futures it is open
source encouraged dialogues and we need
to hear what problems you have and where
you want to go so we know what to do
so thank you very much and thank you to
the translators I hope you've enjoyed
the session arigato
remember Sugoi Python
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>