<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Seeing Through the Clouds | Coder Coacher - Coaching Coders</title><meta content="Seeing Through the Clouds - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Seeing Through the Clouds</b></h2><h5 class="post__date">2015-06-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/w-A81hp8yto" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so I am Kevin Nelson and it slides a
little plane because I used to have a
logo up there for just me which is just
a startup that I used to work for and a
lot of this talk is about what I did it
just me it's sort of starting out you
know with the startup and being on
amazon AWS you know easy to doing all
that and trying to have being able to
see into the cloud understand not only
you know your individual endpoints and
how all your API is are performing and
how your servers are doing and then be
able to compare one server to another
and being able to look at this
holistically or you know group all that
together to get either customer metrics
or performance metrics be able to look
at things individually per service or
poor server or being able to aggregate
it all and be able to look at it is one
thing and really it's it's sort of that
it's sort of a pragmatic talk taking you
from zero to 60 or I don't know if I
made it to 60 but 0 30 and the choices I
made and and and just slowly trying to
with minimal investment get a little bit
better get a little bit better get a
little bit better and I thought maybe
that might be useful for some of you and
and other folks out there so a little
bit about me java champion three-time
java one rock star so give me lots of
good votes so the pressures on right i
did 12 years ago and then to last year
and i'm only given one talk so i won't
get three this year but maybe it I don't
know what how that cycles co-authored a
book web 20 fundamentals and I run three
of the the largest user group so I run
the Silicon Valley Java user group the
javascript meetup and the google
developer group and taught some college
classes which was kind of funny because
most of the folks that i taught College
of San Mateo is like just up the hill
from Oracle and so I taught like mini
year this is several years ago but I
taught a lot of oracle DBA s who wanted
to learn Java they have this whole J SQL
whatever
the soul fuzion stuff and they were all
unhappy to see me or whatever it was so
so here's what we're going to do talk
about the cloud talk a little bit about
just me just what it is and then looking
at AWS some of the things that Amazon
provides you lots of you know just
looking at there is one example looking
at Yammer metrics graphite nagios cubism
New Relic google analytics and jmeter
not even sure if i talk about google
analytics maybe I do but anyway i'll be
sure to if I if I don't so how many
folks are familiar with some of these
yeah all of them I hopefully I am so I
am kind of curious to know who's you
know where folks are at are you guys
just moving into the cloud or lots of
people doing lots of how many folks are
just like kind of new to cloud stuff
yeah wow that's a lot so this is perfect
then how many of you are kind of doing a
little bit little experience and then
how many experts we go on back there for
sure lift looks like sleep already all
right here we go so just meets a mobile
social startup so this is where I did a
lot of work in AWS as a VP of
engineering so I did a lot of the early
kind of server implementations I wrote
about half of the android client did
lots of different things funded by
google in Google Ventures khosla
ventures found her son Don dodge Mike
Harrington lots of different people and
our stack is AWS DynamoDB RDS tenant
which is the the Amazons my sequel
DynamoDB is Amazon's no sequel solution
originally we were on HBase but that was
a bit of a administrative nightmare so
we said let's let's try DynamoDB it it
kind of came out and we were kind of
bleeding edge adopters there neo4j a
little bit of graph database not too
much but a little bit stuff we did there
and we use a web solar with the Apache
Solr
for doing some secondary indexes because
at the time when things were written
dynamodb did not support secondary
indexes so we had this cold kind of
polyglot persistence kind of you know
thing going on there spring-mvc was the
the main framework and then for metrics
and things will talk a lot about here
analytics and metrics graphite nagios
cloud watch New Relic and I guess we use
Nagas some more because I haven't listed
it twice and then on the on the mobile
side we use flurry google analytics and
and Mixpanel mixed panels really really
nice I know maybe I'll talk about that
if we have extra time but I doubt we
will so what I what I kind of said is
this is if you look kind of in the back
this is from my desk kind of looking
over looking up and I guess all the
engineers are sleeping in or something
this is right before I was leaving for
China but there's two TV monitors in the
back and it's basically what this talk
is kind of about is how do you get from
nothing to eventually to where you have
operational monitoring right in your
office you can see all your services and
you can see problems not when they occur
but hopefully before they occur or if
they occur why do they occur drill into
that look at that get that information
right at your fingertips and here you
can see me kind of just kind of browsing
up and there I can see all the different
dashboards and things like that and
every single service so cool so being in
the cloud so we'll just do a quick
introduction so it's really great kind
of lowers a barrier to entry do a lot
more with less you know you if you're
doing something especially with a small
team you really don't want to deal with
all that and and you know you don't want
to pay for things ahead of time so you
know if you do get this massive growth
spike it will auto scale if you get an
article in TechCrunch or whatever it is
indefinitely the stuff that just me you
know our CEO is co-founder TechCrunch
he's you know very well connected 100
articles written when we were
we launch we're right now I think we're
possibly the number one app and for ipad
and social we were the 12th app in the
Play Store for a while that's it so I
was very concerned about that and so the
cloud was like something I absolutely
had to do and just really had to be
ready for that scaling and did a lot of
simulations with jmeter and things like
that and for making that happen and
that's why monitoring and and this was
very very important to me and so that's
something that that why I jumped into
that quite a bit but there's a lot of
disadvantages is you know what's my
performance you can't kind of look in
one place you've got to look in a lot of
places you got to aggregate that in some
way a lot of times it's hard to know
even how many servers are running what
is this going to cost me what you know
or server is going up and down every
hour are they staying up are some
servers performing better than others so
this is something that's actually real
and a lot of people experience it where
you're using this commodity Hardware out
in the cloud and a new instance fires up
the next thing you know you have poor
performance and knowing which one's bad
which one's good how can you look at
them together and make those decisions
if do you want to just kill something
off and you know personally I talked to
the Pinterest folks and they talked a
lot about this you know Netflix is very
open about this when they when they talk
about it but but I've talked to a lot of
people who've especially on AWS have had
a lot of concerns here so hopefully you
know this talk will show you a little
bit about that and one of the other big
things that you know the cloud is how do
I answer you know the what-if questions
and things like that so so the first
place I started was you know looking at
Amazon looking at AWS and what are the
things that they provided what are their
dashboards and you know I look at me oh
maybe that's enough for me right so it's
a really great place to get started a
few clicks around the console and this
is what you get so here whoo I won't
touch that again so here you can see I
set up
a notification here that says when my
cpu is greater than seventy percent for
20 minutes right and what i want to do
if you look at the arrows i want to add
one instance and then i want to email
this AWS alarm at just me so you guys
all should not send emails to that
because people would not be happy but
this is kind of what their stuff looks
like you get notifications you can do
send them out through SQS you can do a
lot of different things very very
straightforward right so does anyone
know what this is this spike any guesses
know anybody so I redeployed so I
redeployed my war and then like things
shot up and if you're doing like you
know something in spring or something
you know you can see here this is like
eight hours so that's like a fairly long
period of time so one of the things I
found when I first started you know I
said off if the CPU is greater than
whatever percent fifty percent seventy
percent whatever it is for a minute then
why don't we scale up another instance
and what I found was when I redeploy
then another one to come out then
another one to come out and I get in
this recursive thing and next thing you
know I owe lots of money so so so 20
minutes is like I don't know I guess the
customers are just screwed but that's
that's what I usually did so so what
what is AWS give you so with cloud watch
you can look at the CPU you can look at
the disk looking at bytes in and out so
I actually found some some problems with
the the bottom one the network in and
out so we had an async job that was
supposed to run every 10 minutes but
somehow we screwed something or with
asleep or something I can't one of the
exact details but somehow we we screwed
it up with an annotation that caused the
thing to run as fast as humanly possible
and so these these metrics are really
nice but what you don't see is you know
your endpoints you don't see any of your
api's you don't see how is your appt
performing all you know is the cpu the
disk things like that so it's very basic
but a big problem is just how's my code
working not how does how does the
infrastructure working so next I jumped
into a tool called Yammer metrics does
anybody use Yammer anybody yeah what do
you guys think pretty cool and where do
you send your yeah more metrics to I
guess Oh jmx very nice so Yammer mexi
she's really cool because it takes your
metrics and it exposes them lots of
different ways so ganglia is probably
the most popular I thought maybe
somebody would say that I don't think
it's in my slides graphite which is what
i use which is really really cool i'll
show you some examples of that you can
expose things via jmx and with kind of a
one-line you get all this information
about how many 404 is that I get how
many 500s how many 200s how many 20 ones
you all this great information with it
with a simple servlet filter that you
can add there it's really really nice
kind of generically but they have
annotations for supporting all kinds of
things that I have listed here gauges
counters meters histograms and timers so
mostly I work with timers and what
timers are is how frequently was this
code called and then finally what's the
distribution of its duration right so
we'll look at kind of an example so this
is their their log it's like a log of
pinder where you can send it out to the
to the to the console right and so here
my index page was hit 1500 times it was
called four times a minute so since the
server started this is probably some
test server or something like that over
the last minute it was called three
times a minute five minutes you can see
over 15 minutes so you can look that in
the past it was being called more than
it is right now right and then what's
the fastest it ever happened and what's
the slowest and then what's more
interesting down here and I think they
actually expose a lot more
but I kind of filter some of them out
but you can look at 99.999% so that you
eliminate just a very small outlier so
the more frequently your services is
being hit you can probably take a higher
and higher number but do you care so you
can see here that seventy-five percent
of the calls were two milliseconds but
ninety-nine percent was ten ten
milliseconds almost so you can really
look at that distribution and try to
determine like you know it's tough when
you when you look at this stuff for
performance and how much do you care
about does anybody know what they is any
what what number they folks typically
used i used the like 99.9 or something
like that for the stuff that I was doing
because you know you want a chart and
graph all this and you can't chart and
graph 75 and the 95 and it's kind of not
not that relevant so problems like I
kind of said what are the trends right
so I know how its performing today so if
it tells me I have a service is taking
five seconds to respond that may be
amazing or that may be really really bad
you just you know you really have to
look at comparing last week last night
in the morning you need to compare
before you did a major release after you
did a major release and you really need
all that at your fingertips and you
never know when you're going to be
asking those questions right so so
that's one of the big problems being
able to visualize it being able to see
things in a dashboard being able to
drill in get more detail and and being
able to see that after a server is
terminated so kind of out of the box I
set this up to log to the console once
every you know right out to the log once
every 10 minutes so it takes all your
services all your endpoints you know all
that you you choose to so web that index
and kind of a dot notation that you can
go through you know user or whatever
whatever it is and I would write those
all to a log every 10 minutes and the
reason I did that was if I crashed the
jvm
I would still have those logs so I would
expose them via a servlet they have a
servlet you can go to you can see shows
you all this they've got a really nice
servlet that shows you every single
thread what it's doing you can do like
it's equivalent to a kill minus 3 so
that you get a thread dump in your jvm
you can see where everything's at I
found that to be very very useful so get
a lot of great tools i highly recommend
it it kind of reach out there and you
guys should check it out so anybody else
have anything to add about Yammer we had
lots of folks use it so anybody no no
dude did you you were using jmx were you
doing anything they're just looking at
it on demand like whenever you were
curious got it got it very good so we
talked about some problems of how do you
graph this thing how do you you know how
do you see the trends and so there's
something called graphite which is kind
of like the rrd stuff that you see in
other tools I forget what they call it
but basically they can store a whole lot
of data right so I would set it up where
for the last day I have metrics
segmented by 30 seconds for the last
week I would do five minutes for the
last month I would do some bigger you
know 15 minute increments and for the
last year one hour increments and so
what that allows you to do is to store a
whole lot of metrics and be able to look
at a lot of historical data but it's
it's kind of the older the data gets the
more details you lose because you know
the more detailed increments so the
graphs will get more flat things like
that as time goes on but it enables you
to store a whole lot more data and so I
never really worried about how many
metrics I was sending its you know with
with their plug-in for graphite it's all
done in UDP so
fire-and-forget and I just sent a
tremendous amount of information so i
could break things down by what server
am I on what service what's the response
code looking at query string parameters
and really kind of have all this data
and then be able to query it with
graphite to where I could pull all those
together you know so we did a lot of
like video and image sharing stuff at
just me and I can look at you know the
API calls specifically for images or I
can look at images videos and audio all
together in one so just really kind of
gave you that that power to do that so
they provide a very basic dashboard
mechanism when I started I was really
excited I could take you know and
configure all the different things that
I wanted so here my elb my load balancer
is it healthy so it's a 10 kind of all
you know true false 0 0 0 up what's my
cpu in RDS which is like a my sequel so
there you can see it's around what is
that thirty five percent throughout the
day and next to that i would put
DynamoDB and this is how many read units
i consume so you when you pay for things
in DynamoDB you pay for them by read
unit but you know you kind of like
prepay that like I want it most run this
many queries and although you're in the
cloud if you use more than that then
they just don't return they don't auto
scale for you they don't so that's where
the nagas you want to get alarms you
want to get it's very very important so
their service is kind of set up so that
it's not very cloud 'ish it's kind of
weird but but it helps further for their
financial model I think for them so so
you kind of pre-provision like and
you're paying for like five times more
than you think you'd ever need so at
least that's what we did so the
dashboards were really great but they
had a lot of problems for me how do I
support multiple environments so I would
go out to our test environment I'd get
all this set up exactly how I wanted and
then I say okay I want to do this
for my stage environment I want to do
this for production right and so I
looked at their api's and I used fire
bug and the chrome dev tools and it kind
of looked and I saw all they're making
these calls and I started seeing this
Jason packet go back and forth and I and
I did some some trickery with Firebug
and I was able to export their Jason and
grab it and I did a little script that
would find a replace and it would kind
of make it work for all my environments
and that wasn't quite good enough you
know obviously that was horrible did a
lot of work with like text wrangler and
things like that and mate and then i
wrote something that kind of a
javascript config and you generate and
it outputs these horrible Jason configs
for their dashboard and and I don't know
they started actually exposing
documentation about how to do what I was
doing but I really wasn't happy because
I couldn't do things like zoom in and
the biggest problem they had is I was
sent a chart like this up and i would
say refresh every minute so every minute
it reloads and whatever the hell they
were doing I would have a black box here
in a black box here in a black box there
but to paint those I don't know if you
guys had a problem are you guys nobody
used nobody use graphite in here before
did they well anyway it was some of the
advanced things I was doing it was
taking like 20 seconds to render a chart
and so I have this great dashboard that
i'm going to show who ever you know
investors come in or whatever myself
trying to analyze a problem and it's
one-third black and it's just really
really hard and right when you think you
figured out then it goes black again and
i just couldn't deal with it it was just
too much so you know zooming in was
another problem like what exactly is the
number there which one because a lot of
times I'd have multiple lines on top of
each other and so what did I do I got
out some jQuery UI did a little took
their api's with graphite and was able
to build if you look across the top I
have a summary dashboard and then when
it will look more detail
that server statistics I built something
called a watchdog so what the watchdog
is if you look at you know JVM the way
that it works or web apps you have a
single thread pool for all of your
request so one of the things you know a
previous life i worked at e trade
financial we did a lot of work we're in
a single JVM I'd have a trading system
but I'd also have news and alerts and so
if I went and said some service was
hanging in the news feed and therefore
no one was able to trade because the
news feed ate up the connect you know
the thread pool and we're not able to
serve any requests right so I can't say
something like that so I often build
something like a watchdog where I can in
segment various api's into groups and
say at most this money of threads can be
active and so here you can see how many
threads are concurrently running which
API so I'm sure there's some open source
thing or some you know there's options
to do that other ways but I I did it
very quickly and easily so does anyone
have any experience with that sort of
stuff no so I've had some really ugly
discussions with CTOs and things it at
etrade saying why is news taking down
our site we just lost however many zeros
because of that happening so I
definitely it's something you guys
should should look at and I'm if you
send me an email and welcome to try to
find some code that somebody paid me to
write and share it with you yeah please
share nope no
ah
sure sure ah so you kinda have to deal
with that
I like that that's die die die yeah yeah
so their dashboards actually pretty nice
you can go into all kinds of I'll show
some API examples here in a minute on
the next slide or two but anyway I built
this you can see across all kinds of
tabs and I can make them tall and short
so I can show them on TV monitors I pass
in a query string how often to refresh I
can drag and drop to say how much do you
know so that the hours just right away
it was very useful because once you it's
kind of this dashboard is like what's
the most important things to me what do
I want to see at a glance right so that
i can predict oh my god let me start
calling people get them back from lunch
whatever reboot some things whatever it
is because we're about to have a problem
call the family and tell them I'm not
coming home or we have a problem and I
need to drill into further details you
know and get that get that story about
what happens so so graphite kind of runs
as a standalone service that you send
your data to originally I ran up myself
it was difficult to install on centos
you know he's the amazon linux that was
very very hard eventually i switched
over to a boon tune is like two seconds
and i had it up and running so whatever
their installer there's a lot easier but
eventually I found the hosted graphite
folks and switched over and started
using that and the biggest challenge I
have with those guys was the way that
their pricing model is is it's / sort of
per metric and so I prefixed all my
metrics by the name of the host it was
on and so every time I'd spin up a new
thing we'd lose a thousand like I had
about a thousand things I tracked and so
each time we spin up a new instance we
would have a thousand more that I kind
of had to pay for and so finally I just
said well this is what I'm going to pay
you and take it or leave it you'll be on
my slide deck and we'll talk about you
guys but but they were actually really
good
so so here's the zoom in so I could do
like you click that it pops up I can see
more details very very nice so one of
the big problems I had was you know
looking at all these servers you know
we're in the cloud or an Amazon we may
have to we may have five we may have a
hundred different servers up how do I
see it all together in one and so here's
kind of a really cool thing that I did
so on the on the left is like the raw
data and this is a report I want to get
right so whatever this is this is a
devices that were registered right in
some period of looks like one day we
have 7000 devices installed right so
people install our app it just me in
however many hours this is and I had two
servers on the backend running right and
it looks like i rebooted my servers and
then you know because your counter goes
from when the server starts and then I
reboot the server the counter restarts
and then it looks like for whatever
reason I decided to reboot this server a
second time so probably something didn't
start up as as I wished or maybe there
was an accident who knows sometimes too
many shells I don't know what happened i
don't remember but basically i can't go
to my biz dev guys and say hey here's
how many installs we had and what the
hell is this we got like a sawtooth
thing here and this is what i really
want right so how do you do that so if
you look at the first chart you can see
this is the instance ID in ec2 and then
it's my watchdog and how many devices
register and it's the count of those
right so all you have to do is put a
star anywhere that you want kind of a
reg ex you can do and then it'll pull
all those together but then you still
have the same problem of this drop so
even with the star so how did I solve it
does anybody have any ideas how to solve
this with any like math folks that are
way smarter than me in here anybody how
do you do Oh a derivative what else
anybody else know yeah so this is what I
did so I did the non negative derivative
because I don't want to take the drop
and then the integral of that the sum of
the series which is basically adding the
two lines together to make that possible
and then I alias it at the very end to
call it my new devices right so how many
people think I wrote that no I didn't
the good folks at hosted graphite I told
him what I wanted to do and I sent him
either this screenshot back here or
something very similar and and I said
this is what I want to produce they sent
me something back and they said guys
come on that's not even close and then
they said let's try it again they
offshored it to india and this came back
so i was very happy it was a happy
customer so because I never would have
figured that out but maybe I should
hired you so you probably you were only
halfway there though right you said the
derivative the integral of the
derivative of the sum and you got to do
the non- so anyway so problem what if
I'm not watching the metrics all right
it's great i got all these dashboards
but everything crashes and dies and
burns right and I'd kind of like to know
when that sort of thing happens right so
nagios so that's probably a lot more
popular tool so how many of you've got
experience yeah a handful of folks if
anybody used anything else I mean
there's a lot of great tools out there
what is it not much anybody else the
other thing yeah well these guys are
really good the configuration is a bit
more than challenging I didn't put it on
a slide because it's like wow really I
thought I would just confuse you guys
and you'd hate it and want to run away
but actually if you look at the samples
it's it's not that bad once you kind of
do it but it's definitely not natural i
don't i don't even remember what format
it's in but it's it's it's quite unusual
but here you can see I've got lots of
different things so I poll i can define
services so these are all the different
services so is the home page loading and
that's any instance the first one the
second one doesn't really matter and
then I look at two different instances
because I always have a minimum of two
and I just look at those are they
running I look at their home page I have
a ping API so my my load balancer
actually hits a ping API and what the
ping API is therefore is like it's like
is this server working so I do a lot of
things in that you know no customer ever
hits that but what it does it runs a
query it opens a file on the file system
there's a few other things and then it
says yes I'm healthy right so please
include me so definitely check that that
one's very very important and a few
other things I look at our big public
feed so think something like twitter
with the the tenets Twitter stream we
had something like that and I would hit
that as well so all these things go you
can see how long it took things like
that how long did it run when's it going
to run again if you know there's an
outage you can click into them and you
can say disabled for a while and you can
add comments and say well this was
really because our database crashed and
you can do all kinds of things to
communicate with your team about why it
happened but you know we were small
start-up we didn't use any of those
features really but the one nice feature
that i did use was to go in and
reschedule so i could specifically
schedule something so i could turn this
back green after I thought i fixed the
problem but not juice was really nice so
so problem so I've got this whole
graphite system and you know a lot of
not really talking about this but a lot
of when i first started or when you
first started think about this problem a
lot of what you want to do what you'll
think about is having all your instances
kind of the the reporting server knows
about all your instances right so you
have this reporting server and it's got
this configuration here's where I go out
and get all my instances and so that
your instances don't know anything about
reporting
right because usually that's kind of
logical to me like I'm just running a
website I shouldn't know about these
metrics happening right or where my
server is but what I found was it was
really really challenging to do that
especially you know with nagios and
things like that where any time I wanted
to make those changes I'd have to
restart in reboot and it couldn't there
was no real api's to make any of that
possible and so I kind of changed that
that direction where all my servers note
about knew about a fixed reporting
server so any instance that was up that
I cared about its metrics or whether it
was running it knew about the reporting
server a new about the host name of the
reporting server and so it was able to
get into that and that that really like
simplified everything right so I
definitely would recommend you know
making that kind of Direction change
right away when you do things so so here
I am I have nagios and not just doesn't
know about any of my instances and
that's kind of where I'm going but all
my instances are sending data to
graphite graphite doesn't know about any
of my instances what's going up what's
going down how old that's configured so
what I really wanted to do was to take
my instances sending metrics to graphite
and nagios able to look at graphite to
make decisions about sending pages
sending notifications and email calling
people all the various things that it
does and so I found this this tool a
little github repo that made that
possible it was fairly simple too
straightforward as this check graphite
and that's the check graphite data and
then you could pass it run this query
and these are the the warning threshold
and the alarm threshold so that you can
do that it was fairly straightforward to
set up so the next problem I had was I
had all these charts and and if we if we
go back to this slide here where I had
things if I go into something like the
the server details I would set up three
column
for each each endpoint so for each
endpoint I'd say how many times was it
called today what's the average amount
of time that it took was the the last
one in the performance no I already said
that but three columns across for each
for each service right going down and
what I found was is I could at most get
like three different api's on the screen
at a time and I really couldn't see
everything and really what I wanted when
I had problems when I thought I was
going to have problems I really wanted
to just be able to see everything and
you say man all this data tracking a
thousand different endpoints and metrics
and things like that how can I see it
all at once and so back here to where we
were so the company squares anybody know
square no crazy Bob and square they do a
lot of great things we use their Picasso
thing for loading images and Android
bobbly did juice so he's he's a lot of
fun really good guy but he did the the
fastest jsr through the JCP ever in
history so he's kind of well connect
knows how to not work with the system
but work around the system and
everything else oh great guy but anyway
they did cubism which is based on d3
anybody know d 3 yeah really cool stuff
who's going to tell us about d3 excited
no clue but anybody want to say anything
about d3 it's beautiful right if you
look at it's like a javascript library
for making like animated and flexible
slinkies and all kinds of things so they
have something that's a map of the US
with little strings between each state
and you can grab a state and start
shaking and the whole thing and then you
can review and it's just a lot of fun so
I recommend if you have kids like me
that you put them on that and it'll be
like a car ride for an hour so back to
where I was at so I want to see all my
API is at once I want to see them on one
screen I want to see whatever
is right so here we'll look at this guy
for example or look at some of these so
this is this is cubism I can see all my
metrics at once it's really really great
and so we had a crash right and so in
here is where we restarted things right
and like then things didn't recover
whatever it was we had major major
problems but I look back and what's the
problem right so it's not about what's
dark what's light whatever I look down
here at my CPUs they all look fine
they're all fine how many calls per
minute nothing really changes about
calls per minute so this change that
call per minute here is just because I
restarted and when i restarted i had one
server instead of however many i had and
so it jumps as they're rebooting but so
so there's no like our our iphone or
android is doing something crazy and
recursively calling we know that's not a
problem anywhere right and these are
grouped right so these all drill down
into much more finer grained but i can
look at things looking up activity
streams like what are things you did
looking up messages registration user
information so i look at someone and i
see you know so I group them all
together just to see that but then if we
look up here at time so this is where we
kind of like rebooted things but if we
look back it's really clear to say we've
got a problem with looking up messages
right I can look at that very very
clearly and say you know things were
light green and then all of a sudden we
had a problem there whatever time that
is and that's probably what caused the
problem here right it wasn't something
else so that was really really nice for
me and so if we go back to like the very
beginning and I have kind of the the TV
screens up on the board up in the wall
in the back of the office one of them is
this and the other is the at a glance
dashboard
that I had built and this was really
really great right I don't have it shown
here but I can zoom to week month day
all that kind of stuff it's a little bit
weird with cubism because it has at
least I think it has to be like a
multiple of 1024 in some way shape or
form so you have to take the time and
the pixel width and you have to like
kind of otherwise things don't do what
you want them to do and these numbers if
you mouse over and I move my mouse to
hear the numbers move along with it and
change as you go so it's built on d3
it's really cool you can see all those
metrics is you're going across what was
the performance or what were the counts
really really nice so problem so we look
at this we found ok this was slow we've
got it down to an individual service or
an end point but I still don't know that
much right I'd like to know a bit more
about what was a problem so new relic so
how many folks have used new relic only
one even with the free helicopter
nobody's used new relic Wow huh you know
it's probably not too late so if you
deploy new relic on a server they send
you a free helicopter but I've already
got a helicopter so I didn't fill it out
but but I should have I don't know I
thought if I went and talked to him like
just said here's my address please send
me a free helicopter it might work I
don't need to work for you but it might
work for me I don't know but New Relic
is really really great so we'll look at
some of the stuff there so here so
they're an agent so when you start up
the jvm you pass in some agent stuff and
it basically profiles real-time your
application really really great they
just got way too much money from the VCS
and they're doing lots of great things
so I definitely highly recommend them
they've got a free tier that's decent
gives you a bit of data at least for
trying it out and then a more complex
that lets you do more more detailed
stuff so here you can see where is my
time spent so we had some performance
problems they weren't horrible that's
probably why I cut the response time off
so you couldn't see it but but basically
I know it wasn't in external stuff it
probably wasn't in the database or that
was half of it so half a time was in my
database and half the time was on my JVM
right and I definitely know that my
solar index which I can't even see
because it's it's actually right there
so at least eliminates that please don't
go and try to optimize my solar index
because you're completely wasting time
right so that's kind of the kind of a
nice place to get started with them
looking at database operations what's my
slowest query where's all my time being
spent we had a lot of problems with
notifications it was actually because we
were missing an index and it was really
obvious once we we plugged in New Relic
and they said hey you know here's this
there's another screen where they
actually suggested like add this index
so these are you know our account
selects but why in the world would
notifications be like that much bigger
and that's really really bad because
when api's are being made like we look
at what notifications need to be to be
given so here it kind of shows you know
as far as time and it gets a little bit
more detailed about you know various you
know s3 here's our solar index twilio
making kind of phone calls or sending
sms to folks this is the live data I
don't know if it's a test server
production server I don't know where I
got the screenshot from but you can see
and then if you monitor the mobile
endpoints you can look at android vs
iphone vs web and really see where is a
traffic going and things like that so
here is one of the events that we had
occur where we had an outage so we had
an outage things went down
and I got an email from New Relic
telling me that hey there's a dns
problem so anybody remember the big like
GoDaddy disastrous whatever right so how
many people like panicked and restarting
servers and doing all kinds of crazy
 to try to figure that out well New
Relic somehow magically said hey there's
a dns error for this and so maybe that's
why you're having problems which I was
like wow that's pretty cool so I thought
that was really nice anyway just some of
the insights there I do have a slide
button it so one of the things that I
found I had a service it was that was
particularly slow and as I was
evaluating whether or not it made sense
to pay for for you know commercial New
Relic license let me look at this and I
and I try to drill into it to get you
can go into the thread and go in and go
in and then it just sort of stops and I
and I could see that like ninety percent
of my time was in this and then it
didn't really go beyond that and so you
have to add an annotation does anyone
know what it is I actually don't
remember but you say like at monitored
or at detailed or something like that so
yeah at a single annotation and then
that tells them in their profiler like
to keep looking deeper and deeper so I
was actually quite disappointed like
even though I said lots of good things
about New Relic but it was quite
disappointed that I had to do another
release with you know I had to change my
code had to redeploy had to put
something else out there before I could
actually evaluate why in the world is
this slow today but eventually they it
helped in in a bit save the day Google
Analytics another piece I did just sort
of looking at it you know not just the
server side but being able to break down
easier web iphone android be able to
look at how are my older androids versus
my newer androids but one of the things
i did is i just added in my rest client
a simple layer there where I could
distinguish between you know I can take
every API call and log it autumn
matically right and so here you can see
200 responses on whatever request this
is were were whatever ninety-nine
percent right 50,000 of them where the
others were were much much smaller so it
looks like we had some 40 fours which
kind of means somebody was looking for
an ID of a user or whatever it was that
did no longer existed right so that was
kind of telling I had some 503 boops and
then no peer certificate that's like an
SSL problem on that on the client so so
problems kind of what if you want to
answer these what if questions in the
cloud did a whole lot of work with
Apache jmeter does anybody who's jmeter
so it's it's pretty good tool right so
is anybody done any of the the more kind
of cloud jmeter stuff a little bit yeah
it didn't really work for me because I
had custom plugins that I was running in
jmeter and you couldn't really run them
there so it didn't work for me I forget
what they're called but every time I go
to like do Google I get advertisements
for them asking me it's not for me but
anyway so i use jmeter did a lot of
stuff and then because the way i could
break down the graphite in putting the
environment in a prefix then i can see
kind of how things are performing in do
simulations was really nice is once we
launched in production I could do
simulations and tweak my jmeter so that
I was able to get the data that looked
like production so so then we could you
know as we did releases put them out run
some automation and see things how how
things go and then basically you're not
blind in the cloud you know you kind of
know ahead of time how things are
performing you got the same metrics in
all environments is very helpful that's
it for me any questions feel free hope
you guys enjoyed the show so very good</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>