<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Live Coding No Ceremony Microservices | Coder Coacher - Coaching Coders</title><meta content="Live Coding No Ceremony Microservices - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Live Coding No Ceremony Microservices</b></h2><h5 class="post__date">2016-09-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/uMboscfH9tw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so welcome to my session so uh can we
start very good so uh live coding
awesome rowan who attended the session
last year or similar session by me so
what I promise you I will code something
that there was no time for coding at all
but I answered about another 50 50
questions and I was really sad like this
was never went so wrong the last year so
this time I try to avoid questions and
code more and answer some or show you
some things we are doing in in real
world block workshops and if you have
questions you can ask next week XD V
yeah just go there you don't have to
register it's live streaming of question
and answers for two years I think
already some virtual Munich if and some
online workshops and this is the only
slide with content i have what i would
like to talk about is dhaka and Java EE
and why does the perfect synergy so and
sometimes like I'm the only one who sees
that because it is really perfect and
the reason why it's perfect is because
Java EE per accident is the only
technology which separates the
infrastructure from the business logic
and doctor does the same so what you can
do with java ee but not with the others
what you mentioned fetch technologies is
with Daka for instance on my machine I
have white fly pyara whatever once on my
hard disk ones regardless how big it is
and then for each thin war there is one
doc a layer which doesn't consume any
disk space nothing if you would have a
fetch are you would get one fed image
for each deployment which takes time in
space so per accident java ee became the
most lightweight microservice technology
on earth right now or you find something
else which which has deployment model so
therefore a little bit involved in the
micro profile discussions that you have
to be careful to support still the old
model whose deployment not only fed jars
or fed wars because then we r us know as
slow and bloated as the other
technologies yeah so i would about
design someone asked me so very quickly
how to find microservices in my current
project
so we started with one war and and to
react app and this is actually up for
mobile and I looked at the menu I'm
sorry we you are crazies like the first
menu of the app was like no 1010 menu
items like who will click on the menu
items on your mobile device instead of
10 menu items we create an app and from
the beginning we deliver 10 Wars
completely independent from each other
and each war had an own html5 client
react client and there is one particular
war like like a portal if you will so
you could the user could go in and from
there navigate directly the apps and
because no it is really hard to use
menus on mobile devices so a one reason
could be you know user experience and
now what we can do we can ship the apps
independently we can hire no different
how it's called design agency whatever
to skin the apps independently and this
is the benefit and from the beginning we
are truly independent from each other's
there is no coupling between the micro
services and we are two developers and
we have 10 micro services so it's like
crazy but the but the idea is clear
there's 10 apps which are independent of
the other but it started with one okay
so whatever if you if you look at the UI
and you see tabs links whatever this
could be an first idea for micro service
another idea is non-functional
requirements one app we are problems
with memory and we isolated the
messaging part from the business logic
part and we find okay now we can scale
the messaging without affecting so for
debugging non-functional requirements
and if you have multiple teams you get
multiple Mike microservices so what it
means if you have one team no additional
requirements you get one micro servers
or how ever recorded one service and
that's all so don't have you know to
invent something to have to agreed you
have to no questions allowed right so so
timeouts very briefly i will show you
how to implement timeouts there from the
beginning if you if you have nothing the
only thing you can do you should do is
to define transaction timeout this at
least what you can do in java ee and it
should be as low as possible the default
is five minutes five minutes is crazy in
micro servers world no one waits five
min
that is something happens so ten seconds
five seconds two seconds one second they
should what you should do back pressure
was always there on application server
no one cares about this now we have
microservices now it becomes popular
again so what it actually means is what
happens if the pool becomes full JMS
pool connection pool then the clans have
to wait and this is called back pressure
so it was an initial part of application
server forever it was widely ignored by
all developers and never tested right
now everyone is excited about the
features if I show the features and
bulkheads I will implement them what
Burkett's mean for each communication
channel with the back end you will
implement an own thread pool because if
one server blocks it won't take down the
whole application server this device it
basic idea and this is the idea of
bulkheads as well very easy to implement
with Java 7 is actually built in so what
I see people are in putting history to
Java EE and downloading 50 mix of war to
have one one one thread pool you get it
for free with Java 7 if you like you can
still download history expunged you
don't have to deploy it so circuit
breaker so on the circuit breaker
already built in you know what it is
interceptor is one class this is the
most asked question with a single
interceptor you get the best possible
circuit breaker actually implemented 1
i'll show you the source code like three
lines of code and it would be part of
java e9 even better so we can delete 11
class or two already on my github i show
you no kidding are two classes is this
the extended version in my project we
usually implement one single class and
server less i watch the keynote today
morning and and i think we are even
several us if you if you like so this is
just a bad official we should you should
be able to do so um what i'm using i'm
using a new set up this is why this
particular interesting so i'm using the
naked don't native docker on MEK it this
means this is the standard dhaka set up
you can download from dhaka before this
i use docking on vagran so i had to use
different IP address now i can use
localhost on linux works better but in
windows similar to make so
okay dhaka PS nothing nothing grunts
which is how it should be for now so um
what I what I will do today this is what
I did really not do I won't start any
local application server I will just use
plain maven and docker without noho
deployment nothing so it's the worst
possible case you will see today without
any scripts of nothing so you have to
help me at least you right so you
promised yeah you will listen and watch
for syntax errors so um so I'm using my
own archetype so it doesn't matter for
now but I would like to use a producer
which produces a string and consumer
which consumes a string and and they
should communicate with each other this
is the basic idea so I'm basic maven
project okay and then I would start with
a Java class prod produ protease orse I
will try to keep the the names simple in
order to remember them because in
microservices you get lots of you know
links and stuff string approach get
return 42 plus system nah no time just
current time fit also work so this is
the simplest possible microservice and
now what i am doing i will create here
from the beginning a docker file so from
scratch nothing prepares oh and i just
say what i prepared is a hex my own
images and what I hacked in the airplane
is pyara monitored and i will show you
and this if you get this you will get
also the idea where this energy between
Java EE and docker is so great so I will
try to explain you why it works and the
deployment is deployed target and the
name of the project is convention over
configuration that war
to deploy mandir and what it is and this
is actually how all my commercial
project least start so I go to terminal
and prot and what I will do is full
deployment and full build maven install
and dhaka built- t is the tech named
javaone prot current folder and what do
you see right now it was full maven
build plus full docket build of the full
doc image and if you go to dr. images
you see here this image 10 seconds ago
is 7 750 mex big I got a question you
are crazy you cannot deploy our 75 7700
max of micro servers the truth is a
virtual image size so what happens is
all the images shared the same
application server this is what you have
to know so what happens behind the
scenes is similar what get does is
called miracle tree or content
addressable storage I think it's a term
so it means the payara is resides only
once on my disk and this image is
actually just I don't know a view
kilobyte BIC because my war is like 5k
and by the way it built everything in
what was it one second it is impossible
to build 700 megs in one second even not
on make right by the way mechs are a lot
slower than everything which comes
winter because there's no is a outdated
CPUs or your experience should be a lot
better okay question and no question so
forget about us so um so this was um and
then i would like to show you something
else so um how to how to connect
services with it with oh what a second i
was mmm no I build another service and I
call it consumer
consumer and this is the same maven
projects which the name is going to be
contd work and the consumer will
communicate to the production service so
on what I will go to ax consumer and con
resource and this is path so now doesn't
matter and what I'd like to do is to
communicate with the other service and
this is where the questions start to be
more interesting and what I what I would
like to do is to use the jersey and this
this client and then so and the early
should be localhost but there is no
local host so if I would ship it to
docker the there is no local host so it
would never work and don't know the IP
address and this is where I get the
question though do we need service
registry API Gators whatever there are
the answers know what we do usually I
just assume the name is going to be
proud because just I have no bad idea so
just name it prod and just assume the
pod number is yes 8181 would work prot
what was it resources prod right so you
yeah if it doesn't work as your fault
where at so return this client sorry
this target know this I have to forgot
something and this is the props target
and this
prod target request this is the old
staff no tricks get string a little bit
ugly because if there's something ever
happens I gets strange errors but should
be now if there will be no problems it
should work out of the box so now I'm
and what we would like to do here it's
the same new dhaka file it's just txt
file usually a copy this this time as
like okay I would like to create it from
scratch from and this is the reason why
i'm using this monitor ties so and i
will copy this target this is nice maven
convention of the configuration konwar
to deployment or so so I go to con and
say it is the same install actually
package would be sufficient dhaka dog
build- t javaone i think with java one
con dodge so darker images now we have
two images but both rely on the same
pyara monitored so they don't consume an
additional disk space so this is most
asked question no you're crazy you
cannot create microservice to do seven
and result is not how doc it works so
without dhaka you would have a problem
but now now everyone uses dhaka more or
less i mean there's everywhere it's not
like okay so now it's time to chain them
together and what dhaka is able to do is
to do this so um i can create a network
dhaka network create travel one token
network LS java one is created it's a
default local network it could be it
could be distributed but on my machine
is enough to have a local network so now
what I would like to do I would like to
say da car
run in background or D th mode minus P
and the product was 81 81 I think and I
expose the internal port 8080 okay so
8080 standard pyara glassfish port
exposed as 81 81 and the name of the
image was j1 producer and I would like
to name it name approach and now the
cool story is I also would like to say
net j1 so lunch the container in Java
one network cool it even works docker PS
so see it started dhaka network inspect
javaone you see the first container plot
is in the network so it's ok cool so do
the same a little bit different port 80
to 82 let's call it a consumer and this
is consumer usually you use an ass worn
on a scripting to do ft convention so
it's not like if you feeling like this
we had a small script and yeah and also
started darker and network inspect j1 so
we have produced in consumer and now the
cool part happens what dhaka does for me
it result that container name it becomes
the container name becomes becomes the
host name so now i can swap in real time
the implementations and I don't need any
any additional registry or whatever and
if you would like to have like load
balancing or whatever what we use we use
H a proxy you will also see in the
Dawkins repository so you can register
it a proxy which load balances between
two other containers so and this was
more than enough in all my enterprise
projects of course for facebook twitter
this is not the solution but I'm not
building Facebook's now for now right
probably next year but for now my
projects are not that exciting everyone
agreed
should I repeat something so repeat is
okay so everyone crystal clear so user
defined network so what it is just like
isolation whatever you're put to the
network they see each other and this is
actually a great idea for for security
what is sometimes do we have back back
back bone network and front a network
and there is one container which which
which is known by both networks like a
gateway for security reason is also nice
idea okay should be related yeah ask
question and I will try to hack so low
cloud no consumer resource no it cannot
con resources
you
wait a second docket PS what are the
ports eight to eighty one this is the
con should rewrite this as d let's see
the darker locks just the dockerfile
what it can do darker locks con this is
what we're asking and we see here the
arrow and the arrow is and the arrow is
unexpected end of file so let's see what
what happens is prot 8282 right Oh prod
resources prodigious looks actually get
prod 8181 processes part but it cannot
talk to the other service so dark
airlocks pattern just look at this so we
have gone 8181 and prot 80 no no wait
this again 8282 81 81 so corn is 82 a
281 should work is exposed in such cases
you can do in this current prot so and
now everything is gone and I can just
say run and now watch this watch me con
j1 con is 82 82 right does the con and
the other
and 8181 was prot so it looks everything
reasonable right so the only thing could
be the network here so 8282
where's my network I don't think so yeah
of course but what I would like to do is
to disable this first this was a
sometimes an issue
okay we can start with 83 and the name
should be different just see whether it
works localhost 83 83 no I cannot access
them at all
don't worry it always worked may have an
install so it should be that I hope
everything is saved this would be a
terrible so everything is saved so we
have the con which is resource its path
this looks nice this looks nice and now
now I would put the letter again ministy
and j1 con dot dokie build this is
nothing to do with communication between
microservers I cannot access the docker
right now and I guess this is something
to do with the network because it worked
as always darker run minus D minus P
what was it 84 84 let's say 8080 is the
default port and the name call it the
con tu and this was J 1.com so and now
it should be visible 84-84 so it works
the problem was the network so it's like
the wireless LAN just screw on my
network and local always was not
available so um ok now we are sorry for
that so doc I kill everything so what we
have con con tu and what we wanted to do
we would like to launch to run the
approach this was what was it 8181 port
number 80 80 this is the first one f to
use different part because since I have
just one machine and this is the port
mapping minus P and the network was
minus minus net javaone so it binds to
the Java one network the name is khan
and the image is calm so this is where
it was built so minus ones named con
Jeff one panel what the part is 81 81
from from RT 80 to 82 right so
dhokha remove con so again 8282 so now
it works let's see what I can at least
you know access the server 8282 know
trimming this
now it should be accessible from this
from rock rose and should Burke yeah I
just maybe something is running what I
don't know no we can try it so three
h 284 no it's it's not a problem it's
like or it is very slow okay
so this is up right now so let's see
what we have too many microservices
right now we have the last time and then
I will take a few seconds until
everything is up to dokur kill
everything so it's gone ok kill con con
one and country and I can remove con con
one and country so and now if the images
build so I can start again and Java one
is the crucial part it always work and
so it has to work in the Java one net
jawan javaone detach mode and minnows p
what we start first is 81 81 8080 the
name was proud the name was prot and the
j1 prod toca remove prod calm and Wonder
okay now this one's and this one was
kaun kaun and let's assume 8282 doesn't
work and this should be enough so Java
one network name con j1 con okay 84 84
okay dhaka logs corn for so seems to
work I just have is extremely slow so no
so it obviously it waits for the network
or something because it takes forever
until the server starts so in order to
show you something more until it starts
everything is like the server are too
too too slow because they're waiting for
the connection with at the start so what
I would like to do is I would like to to
show you how to configure from source
code and applications over from the
outside and to do this just assume you
would like to use here prefix and the
prefix is going to be injected and this
is like a message and say message here
and this could be any configuration like
and what you can do you can say okay I
would like to create I show it a lot
configurator but this time the
configurator is going to access a
different resource so expose injection
point IP produces so and IP is the name
of the num member so this is nothing new
what's new is what we do with that and
return system and now get-get end and
say get or default and this is the name
of the Prophet property and the default
is not set so why this and the
interesting part is if I start a dacha
just do it again run if I start it again
with a higher part
and what I could do I could set with
minus e the key value pair and this is
message and set it to four I don't know
Duke and what happens behind the scenes
it becomes the environment entry of the
docker container and you can specify
even a file with key value pairs of full
file and with that you can eject all the
values directly to the configuration of
the application server so we actually
never change the application server
configuration we always change the or we
do it from outside from the doctor with
the environment entries of the container
so I think we have already gone for so i
will have to use 15 so and now dhaka
exec conf I've know and you see message
Duke the cool story is you don't have to
rebuild it so this is the crucial part
this is one of the questions for staging
in stage environment we just launched
the same binary image with different
external configuration that this is very
very nice for Jenkins for instance with
Jenkins you can inject the the
configuration from outside and this is
more than enough for for whatever like
right for configuration of whatever
resources you like so a next critical
question was how to deal with not dr.
eyes databases so you have in your
environment databases main friends
whatever and then they cannot
participate in the network is not that
easy and there is another hack you can
start the dhaka and add with minus minus
at host and you can just prove provide
key value pair so what we use you can
use for instance a name like Oracle
database or elastic search database for
instant my current project we have just
elastic and with- matters at host
depending on the stage we provide a
different IP address which resolves to
different stages so without changing or
recompiling or rebuilding the image we
can inject or we can swap the name
exactly as it was with docker container
with the
with the network we can do the same we
can do the same with with it hosts which
is a nice note heck it's a workaround if
you have resources outside Dhaka like
database is usually SI p main friends
whatever and you need this for staging
okay con for though wow this is it was
just so both was deployed so let's see I
just docker PS and we have part what we
have con con con too many cons but each
con should be able to access the prod
and this was con five let's say we have
81 85 85 I think let's see 85 85 con
resources con this is an ok but I can
access this and now is there now it is
see is they don't see each other because
the name is wrong I relied on con but I
use confer work on five or whatever but
I can at least exit the first one so the
problem is now is not very robust
because here i encoded prot I started
with prod for whatever so this does not
match so I'm how the how the containers
communicate wish it with each other
exactly the same without any registry so
we use a hard-coded port which is which
is the internal part not the exposed
port which is actually a tiara so there
should be an 80 80 regardless how I
expose the port so this is done by the
container that's what this is the error
so let's rebuild it so I'm so we have to
go to the you know we are in the
producer and then we have to say install
this is full rebuilt by the way ask
question whether i use it for
development no for development i use
always local service with hot deployment
this is just what i wanted to show you
what you can do with with full we start
the full deployment so I'm darker kill
what was it con it's not there and
remove I wasn't oh very good so toca run
and we have okay this is the message
Duke which is good and 85 85 was also
good and we call it con and launch it it
doesn't matter to run somewhere 86 86
and now is the problem 86 86 now it
works dhaka locks con and you can see
now now it learned that back then it
waited for the network it took forever
until until it deploys and we have this
is the newest one 70 seconds ago it was
deport 86 86 86 86
so this is the communication between the
services at the beginning I was just too
fast and I network was too slow because
if class which starts it tries to pink
the domain and it was not possible so I
got time out for two or three minutes so
this is why it took so long but this is
the communication between both of these
services using Dhaka network what's
essential here i'm using the hard-coded
container name this is the container
name and this is the internal part not
the exposed port so regardless on which
part I'm starting the containers they
can still communicate to each other
because it looks inside so what it
actually means the containers inside the
network communicate directly they don't
go through the external network though
some questions about this so from the
from the browser to the container I have
to use the port but between containers
they use the internal port so no one can
access the port 8080 just the containers
in the network ok so i did missed i had
a mistake here i use the external port
the map port ok questions so far very
good then so what we had Oh to explain
you server less and what happens behind
the scenes is how it works is I have a
Java image here and this is exactly this
and this Java image is actually the base
of all images of all application servers
and this is the largest image in
comprises the centralized image plus
java and what it means it is about I
don't know 500 max because of the
Centaurs with jdk openjdk fool and one
of the most asked questions why i'm not
using alpine i was called Alpine linux
and the answer is it doesn't matter it
only sits once on my hard disk so
whether it is 100 megs large or not no
one cares about this and most of my
clients you send to us or Susie or
whatever so I use whatever my client
uses but Neville pine know of my client
users alpine and and so this is actually
the reason and i'm just using stock java
as you can see so and this is build once
i use not zone for this and this is the
docket built Eric Java so why I chosen
here the pie
because it is the most real-world
example I have in my github repository
pyara inherits from Java so what it
means in case pyara changes I don't have
to rebuild the Java image again so it
always sits on the hard disk it only has
to be rebuilt in case I get new patches
for sent to us or for java the payara is
rebuilt it happens I don't know on each
new release and then from pyara
configured image inherited so the
crucial is to understand why so this
image comprises some settings which are
project specific so this is just such as
a placeholder for any project specific
settings like connection pool settings
je m'excuse or whatever and this usually
happens in project specific Jenkins
pipeline so we have Jenkins pipelines
and whenever we find out we have to we
need more heap or whatever it is build
once and push to a registry or to
repository so and this monitor to what I
used here it inherits from the first
image from the configured image and it
provides even more monitoring stuff so
what it actually means is I chosen in my
project to use a monitoring so I
inherited from the monitoring pyara
monitored ok so but I could use
configure the plain one so if I would
say yeah x and I would like to use let's
use the con one is easier to see so why
try and rebuild the image
let's do
something like this now did it is okay
dr. Ron minus t minus P another port 87
87 88 e and don't forget the Java one
network minus minus net travel one and
the name is too wild con and i think i
still use the old one
as you can see now it runs on white line
and it also stops here the issue with
the network so it should be a lot faster
it should be a no to the first line and
what is basic basically means is we are
almost in the server less what I had in
there in the keynote because we can
decide with one liner which server to
choose and what's the magic here the
only magic I did this is really basic is
in the each docker image here exposes
the deployment ER and and this
deployment ER here is equal to all
images so I can rely on the existence of
deployment ER so what happens during the
images build once happens out to deploy
behind the scenes so you don't have to
rely on auto deploy you could use even
the curl all application servers have a
restful restful deployment and you can
use rest or HTTP to deploy the wars but
how to deploy is good enough because if
the image is done is done so you get the
binary images can be started and it
always works because the docker yeah
this is this is actually the reason why
I have this exactly here so each data
source will do one line more here here
yes Edmund so if you express it
for instance here here are some AAS
admin to set up jdbc connections i would
have to copy both lines here and i will
get data source JMS queue whatever and
this is the reason why this configured
this is the ending configured works runs
in the project specific Jenkins
automatically if something changes it
changes not frequently I would once a
month and the first two layers works are
running usually by operations if you
know there is new patch for the
operating system and we get new release
of the application server runs and
centrally and there is push to registry
okay there was another question so it
will relate it so who from here
somewhere no questions so um what was it
86 86 I think right 8 68 67 consumer
resources consumer it's not set because
it's not injected so I could but this
runs on actually on on white lie so we
have a white try communicating we built
two images one is glassfish the other
and his white friend to communicate I've
also Tommy web project everything so it
doesn't matter actually anymore if you
have docker and the nice story is you
see how fast it is so I built a thing
during the session because of the
timeout issue 10 times everything you
know actually I build the whole
operating system plus the application
server plus the war but because of dr.
layering would actually happen just the
war was replaced so this is actually the
nice story and with fetch ours I would
have to build you know 30 40 50 max each
time so it will take a little bit longer
I'd say but not in 100 milliseconds okay
so what we what we got here is
communication between the containers and
what I could do just take a look at d
so this the 87 87 somewhere 87 87 and
this was the name is white corn so Dokic
kill white corn and docker remove white
corn and run 87 87 and now minus e
message Duke and now it should be
injected
equals and another problem here is j1
and this has to be removed
so let's see
yeah it works so as you can see a white
fur doesn't check check the network is
faster right now order oh sorry yeah
still works now it works everywhere you
know regardless which part I put as many
micro services in WoW is work this is a
resiliency so but back to what i use
what i use a lot is this there are two
proprietary settings which i hope they
will be standardized in 211 is called
connection timeout andrey time out and
this setting is available for all for
all application servers this is a jersey
example but there's another one for rest
easy way i can remember and what i
usually do to support them is so i
specify a jersey dependency but the
dependency is only provided so what it
means it is not deployed to the server
so and now i can compile it so and what
it basically means is so there is a
connection timeout if can't resolve the
other server so there's one error and
the REE time out if is too slow and the
REE time out is particularly important
because if you have some performance
problems is the verse you can happen to
you is the other application is too slow
if you cannot connect it all it's a
better than it's just too slow see a
milliseconds so i just wanted to provoke
some so 10 milliseconds would be too so
what we have timeout is building so this
is just in and you have to do this by
manually so i could justice this a
string you can just add to know the
string and you also broke without any
external dependency so it's really up to
you so this was the timeouts I don't
like to show you that it actually
we'd would work if this is too slow
another thing you could get right now is
a little bit of reactivity and I would
like to show you how to implement this
and to do this I would implement a
method called Gant content and put this
method here so message get content and
so and i could rewrite it right now and
say this is suspended async response and
what happens then I can say response
thought to resume so and what it means
is this almost asynchronous it doesn't
make any sense but there's a little bit
more asynchronous and to make it nicer
what I could i could rewrite it and say
okay there is a or just because of time
so we have one thing which which except
strings on objects and another thing
produces drinks an object and the basic
idea is to chain them together and the
save time I just show you the end result
without explaining because I explained
it multiple times but what I would like
to show you the effect on this completed
future the new start from Java 8 I could
say say supply a sink and the supplier
is the method get content and if this
happens then say then accept and
response resume
so and what this means is so it is
executed fully a synchronous so the
first this is called and if this is done
it is passed here and this one block the
only problem is if you go to d to the
source code you will find out there's a
fork join pool which is a bad idea
because it is depending on number of
course and therefore what i use usually
is I say resource managed execute or
service mes and this is the standard
executive service has to be available by
all java 7 standard application servers
and now the manager executor service
just an executor service from jdk so
there's nothing special and and what i
can do i can pass it here and now
magically we have a bulkhead because i
could configure as many thread pulls i
like and what you usually do one thread
pool / communication channel we have one
communication channel between the
consumer and the producer for each such
communication i would create a thread
pool it would be nice to have it the
monitor able threadpool to see what
happens and to to to to make it
configurable and i actually wrote a very
simple library called porcupine why
porcupine but because there's another
name for history and what it what it
actually does is it creates managed
threats and you can inject it with
australia with ed inject dedicated
executive service and i will like to
show you in action what it actually does
so to make it work i have i will add the
library it is really optional the manage
executive service is good enough you
will have to configure the application
server what a porcupine does you can
configure it by yourself that's the only
difference but the technology underlying
technologies the same each of the
libraries uses the managed service
manage threats from the application
server ok so we get the porcupine
and I use this pie version for reason
and this is kamya X so ND and the only
changes instead of doing this I would
like to inject the executor service just
and no resource just say inject with the
qualifier dedicated and let's call it a
broad channel to make a nice as a pro
channel so now it should work with that
and I have of course rebuilt right this
and actually to make it more automated I
could say dhoka kill con right and
darker remove con now nothing can happen
almost Jenkins right in one line so now
everything so eight seven and seven our
white corn okay forgot the white cone
but we have the Conn so
I forgot the white can you see this is a
darker remove kill wild corn dog no I
sorry for this so just consumer of
course my name is my last name implies
the land o French but I don't what I
what I wanted to do is to run it you
just made me nervous ok dr. run- the
minus P what was 87 87 should be free
8080 name kha Khan and what was a j1
khan and the network yeah minus minus
net travel one and the prefix doesn't
matter so I can live it I hope it's
already new stock aqeel khan and ok
remove Khan
okay seems to work 87 87 go yet
ok
now what you can see you get injected
statistics into the header so you see
the production channels pipeline name
production channel rejected execution
handler and the nice story is this is
the rejected execution handler from jdk
and what you get with that is back
pressure of course so in in the
executors execution handlers from jdk
this talk execution endless you can
specify whether what happens on when the
executors service is overloaded should
it forget the new tasks should it block
a throw exception so you can do the same
with this executor services exactly the
definition of back pressure and you can
see what you can do this is the standard
in case the stretcher becomes overloaded
it can throw CDI events so you can
register for this event and expose them
via web socket or whatever monitoring
service and you see the maximum
full-size largest thread pussies and
current thread pull sites there are all
configurations from the stock execution
executed service so what porcupine does
it just uses the managed threats from
the application server and and makes red
stem as the executor service and make
some configurable with a simple builder
so with that with three classes and
about 5k of code we get bulkheads fully
implemented in Java EE okay so you can
see really all the patterns are built in
so I add a conversation with latin d
today and they say okay what I'm
actually doing the project and removing
stuff is not like going in you know in
selling you 1,000 patents it's like we
remove whatever is necessary and and the
funny story is that Java is a perfectly
suitable platform for for micro services
and all help all errors happen right now
wouldn't happen with a simple script
because then you have convention with
sport or whatever and what I do usually
I increase all the parts with in a
scheme with convention it's not like no
white assigning parts we have a certain
scheme questions so I think we are
pretty far I'll show you how to
configure with long one liner system
what I didn't show you is a circuit
breaker right the wheel so it could
break it is i would like to show you the
implementation and the full
implementation zone ah I don't have the
network right now
but so usually you wouldn't code
something like this in real projects you
are not allowed to put any business
logic into a resource because we really
hard to test so what do usually do you
have a resource just with the HTTP stuff
and you have deficit just with the
business logic stuff and the cool
stories differ Said's get an interceptor
a standard stock interceptor and what
interceptor can do is to a catch all
exceptions and it can also measure the
performance and with that you have your
secret breaker because you don't have to
invoke the methods you can count the
arrows you can open closed or whatever
like and this was the breaker and I was
in several micro service project and all
the question though what is about
breaker we have to build the breaker and
they dedicated already I don't know one
month to evaluate external libraries and
therefore I created to github projects
you know to to just to show this already
soft and I would like to show you the
the implementation from without the
network which is breaker
and this is just two classes so
so this is a stock stock interceptor
what here happens is adjust I'm reading
some annotations is that because it's
configurable but the whole
implementation 75 lines of code and what
it does is it catches exceptions on
exception it delegates that exception
happens to our to a class to a delegate
the class is called circuit and what it
also does it measures the performance
and it is too slow here it says it's
time out and the circuit class is here
so the circuit class just gather the
information and decides whether it is
open or not why does delegator this
class because you can override a class
in your project you can say specializes
my circuit and you can decide what to do
when to close when to close the circuit
again when to open it and whether you
would like to retry or not so what we
find in projects it is really hard to
find a general rule or algorithm how to
deal with exceptions in an enterprise
project you cannot say no we try after
five minutes once if there is some you
know money transfer going on it's like
the the other system has to be
idempotent first and then we can we try
so it is really hard to invent an
algorithm and therefore my observation
was in the most in the enterprise
projects the history and algorithms were
not used at often because it's really
hard to tell what will happen what we
usually do if an external server breaks
we open the circuit and this class knows
about this we send a CDI event and there
is something like dashboard you know
critical exception happened would like
to close it or not but it's really hard
you know to decide by a machine okay we
should we try right now or later
whatever in one project the developer
had retried to know lack in algorithmic
scale logarithmic scale like now in in
five seconds five minutes and five hours
it was never used because and I'm in
enterprise environment if it doesn't
work now it's unlikely that will work
you know in two minutes okay and
therefore is two classes and general
implementation of sukkot blaka is one
class if you know what you are doing
each has one interceptor and this is so
easy
there is no need to be depending on
external library like this one is just
to show that that it works actually with
the all the time out prob problems we
managed to discuss everything so i
injected the external configuration with
via environment entries i didn't show
you the add host because i would have to
have no external the database which in
dhaka rised I explain you the user
defined network with daca and it
actually always works so and and what it
means you can rely on container names
what it also means Oh what I didn't show
you right now dhaka inspect J 1 and J 1
and the command is called network so you
can see connect all these micro services
are participating in the network but
let's pick this one what I can say is a
darker network disconnect network j1
disconnect this one
Janice play something dhoka dhoka
network jeju and open network probably
with a second disconnect j1 so and now
it was here and I will and now this
appeared so what it means what you
usually can do you can start a lot of
lot of micro services without specifying
the network and just assigning to an
advil dynamically so you can swap the
micro services do you have almost like
API and in direction here because you
can in Europe equal to replace and
running system pyara with white fly
without restarting the services they
don't have to be started with the
manage- net you can just assign them
dynamically to the network so it can be
extremely dynamic and what does not a
part of the presentation but is very
easy to do I have an H a proxy as a
docker container with another in
direction which could dynamically no
load balance across multiple
microservices this would actually do in
production for failover reasons so this
is just the DHA prox is already in the
Docklands project so now any questions I
class a cluster what I'm user and now is
a user different user defined network
which is breached but there are
different types of networks they can be
remote and Dhaka swarm will be clustered
but what do you mean by cluster if I get
a chair proxies across the one machine
if you would like to have multiple
machines then then you use them if you
don't care network j 10 you see this is
a bridge networks and just different
types of networks so you can define i
think attached there is another type of
network which is remote so then you can
spread the containers across machines
fast
use such of the file system for logging
I've seen that you saw the GlassFish
logging it's long I guess in the file
system or two standard output yes like a
Cabana or yeah depends on the depends on
the requirements from operations even no
one looks at kiba non don't look yeah we
do nothing unless we have specific
requirements because if you just tell
developers lock they will look just like
I was here and I was during this is
worthless anyway so whether you have you
know how they define rules this this is
great or yeah but manually usual is
highly automated issuances jenkins curl
or whatever but it's not like a knot in
project with hundreds of microservices
even in large projects we will get
properly 20 and with load balances we
get at most 40 50 and across multiple
machines and this is still manageable hm
proxies are kind of orchestrator no one
project uses venture but i forgot the
record have specific requirements or
others we don't have such orchestrate or
now yeah but don't forget and we are
moving from enterprise space to docker
it's not like we never had something
like an Orchestrator before it's not
like you know we are moving from Twitter
to yeah this is different part of
requirement other questions so sorry for
the timeouts but we still managed to to
show you all the contents and I hope you
see how great it actually is from the
bill time we built maven full built with
docker image in two seconds without any
hot deployment this was diverse possible
experience you can get forget the
timeout so this thesis was just out of
control but yeah so if not no questions
you can ask me after the show and
we have to go go out</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>