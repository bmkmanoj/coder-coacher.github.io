<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Spinnaker, Kubernetes, and Oracle Cloud Infrastructure | Coder Coacher - Coaching Coders</title><meta content="Spinnaker, Kubernetes, and Oracle Cloud Infrastructure - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Spinnaker, Kubernetes, and Oracle Cloud Infrastructure</b></h2><h5 class="post__date">2017-10-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/aAPrFbtoqsU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello hi everyone welcome to this talk
on spinnaker kubernetes and Oracle cloud
infrastructure I realized there's a lot
in that title so hopefully we can
explain it pretty well my name is Owen
Lewis and I'm a principal software
engineer from Oracle I'm lucky enough to
work full-time on spinnaker and
kubernetes so I get to work on open
source projects and with me today we've
got a very special guest we've got Andy
Glover from Netflix cool so we're here
today to talk to you about spinnaker and
an in particular has particular can be
used to deploy software into the cloud
and how it can be used to deploy safely
and reliably onto kubernetes so we're
going to show you how you can use the
same software the netflix use internally
to deploy their platform and we're going
to show you how you can use that to
deploy into kubernetes running on oracle
cloud infrastructure so i'm gonna give
you a quick overview of spinnaker give
you a high-level view of what it does
and then we're gonna hand over to Andy
he's going to talk to us about how
Spinnaker's use it netflix and then at
the end we're going to tie it all
together we're going to give you a demo
showing you how you can take an
application and use spinnaker to deploy
it onto kubernetes and a QB Nettie's
cluster that's running on an Oracle
cloud infrastructure so before we go on
to talk about spinnaker and kubernetes
it's probably worth taking a second to
talk about a problem that we all have so
we're going to talk about complexity and
this is the problem that every company
has including Oracle so delivering same
software safely and reliable is hard so
in the last few years we've moved from
application complexity where we had
large applications the complexity was in
the codebase and in recent years we've
moved to we've seen a trend moving to
micro services where we're decomposing
our applications into smaller parts and
so there are many companies in the UK
for example where they'll deploy
hundreds of micro services and they'll
be deploying these services hundreds of
times per day so how do we deal with
this complexity the other thing to think
about is the move to lambda functions
and things like that so as we decompose
our applications into smaller parts the
complexity around delivering software
it's getting more and more demanding so
with all this change and complexity
around delivering software we need to
rely heavily on automation tooling and
best practices to deliver our software
in the way in which we deliver our
applications has also changed over the
years so I'm sure many of you have heard
about docker
kubernetes in particular but that leaves
an obvious question of how we actually
deploy to keeping at ease so some of the
some of the methods for deploying to
communities tend to be fairly primitive
right now and this is where spinnaker
can come in and help us so spinnaker is
an open source continuous delivery
platform that has support for multiple
cloud providers so you can deploy onto
Google's cloud you can fly onto AWS it
supports other container based
deployments so kubernetes is supported
out-of-the-box
and now you can also use it to the ploy
to Oracle's cloud so spinnaker was
designed from the ground up to be
extensible and that means that using
multiple cloud providers was always a
design goal of spinnaker so there's not
an either/or decision you can actually
use spinnaker to deploy to multiple
clouds at the same time so that's a
pattern which has been more and more
common over the last few years where
people are supporting a multi cloud
strategy we see at Oracle all the time
where people are using more than one
cloud provider and if you've ever been
involved with a cloud provider you'll
probably know how different the API is
across different cloud providers can be
so if you were to want to deploy to
multiple clouds without a tool like
spinnaker it would be incredibly
difficult
so using spinnaker you can basically
easily shift your applications between
multiple cloud providers so this is the
spinnaker UI as you can see it's a
pretty nice-looking UI so the first
thing to note about spinnaker is it's
not just a tool to deploy your
applications it's actually a tool to
manage your applications once they're
deployed so you can see here in the UI
what you're seeing here is the the
physical infrastructure which underlies
your deployment so you can here this is
a clusters page it's actually showing
you the number of physical server
instances running for this deployment
and this is a pretty powerful technique
Oracle one of the challenges we have is
kind of communicating the end to end to
appointment of our applications and
understanding what's running a
production what's the health of our
applications once they're running in
production so using spinnaker you can
actually manipulate your infrastructure
as well as your deployments so you can
click on one of these green icons here
and you can actually drill down so if
one of these servers was unhealthy it
would show up as a red icon here and you
could actually click on it and remove it
from the load balancer you can do lots
of other stuff around manipulating
infrastructure so you can actually roll
back your server group if it fails you
could resize your clusters so in the
case of cuba Nettie's each green icon
would actually represent a pod in your
kubernetes deployment so the key thing
to note is actually having a high-level
view of your deployments is a really
powerful tool okay so the first
principle in spinnaker is this idea of
immutable infrastructure some companies
still don't use this this idea has been
around a long time the idea is that you
build your application once in
development you'll bake some kind of a
mutable image in your development
pipeline and you'll push this this
immutable image all the way through into
production and the key thing here is
that nothing changes as you move from
your development environment into your
production environments nothing changes
and you can kind of be you can be sure
that what you actually deployed into
development is what gets into production
so the counter to this is some kind of
server provisioning so if you were to
provision your environments on demand
that could be slow and obviously if you
need to scale elastically in the cloud
the only thing that really makes sense
is using some kind of a mutable image so
the key thing about immutable images is
there can be spun up instantly so
another part about spinnaker that's
really interesting is it focuses on safe
deployment so there are lots and lots of
tools for deploying applications into
the cloud but none of them as far as I'm
aware focused so heavily as spinnaker
does on making your deployments safe and
reliable so there's a whole host of
features built into spinnaker to make
sure that your deployments are rolled
out safely so we're not just taking an
application and pushing it into
production we're actually doing a lot
behind the scenes inside spinnaker to
make sure that your applications are
deployed in a correct manner so taking
one of these as an example spinnaker has
this notion of traffic
where you can say that if someone tries
to delete the last server group in your
cluster you can just get spinnaker to
refuse to do it so it's been a couple
encourage to you to do the right thing
if you delete the last server group in
your cluster obviously that would cause
an outage and there's lots of other
features here which I guess Andy will
probably talk about in more detail so
the other thing that's baked into
spinnaker which you don't get in many
other tools is this notion of a
deployment strategy so we get all of
this for free when we use spinnaker we
get intelligent deployment strategies
some of you may have heard of the notion
of a Bluegreen deployment a spinnaker
calls it a red-black deployment and the
idea here again it's all about safety so
we deploy both our current application
on our previous application side by side
and we can use the the load balancer to
quickly revert in the event of some kind
of problem so if you roll out our
application into production and
something goes wrong we can actually
just use the load balancer to switch it
back and immediately roll back so again
this is just another way this mirakuru
encourages safe deployment there's a
couple of other things here rolling red
black and Canary but I guess I'll skip
over those Andy might touch on those a
little bit so as you can see behind the
scenes there's actually a huge amount
going on with these deployments
spinnaker does an awful lot for you so
in the case of a red-black deployment
what happens under the scenes is quite
involved you can see here that we have
to do things like deploying your lated
the latest version of your application
and we also have to add and remove
things from a load balancer we have to
do all of this complex orchestration
behind the scenes so if you were to go
and implement any of this yourself in
some kind of other deployment tool if
you're using Jenkins as an example to
deploy your application it would be a
huge amount of work and a huge amount of
effort to get this level of maturity in
your deployments and again this works
across all cloud providers so whether
you're deploying onto Oracle's cloud
whether you deploying onto Kuban at ease
you get all of this for free so this is
my favorite feature of spinnaker their
pipeline UI is really really powerful so
as you can see most deployment pipelines
are far more involved and just taking an
application and deploying it into
production there's an awful lot of
things that need to go on with your
deployment so a good example is running
some kind of automated tests
one of the things you'll see about this
spinnaker pipeline is you can actually
run multiple stages in parallel so
that's a really powerful thing so you
could run three or four sets of
automated tests in parallel there's a
whole host of other features inside
spinnaker so you can do things like
running arbitrary jobs you can run a
Jenkins job you can trigger other
pipelines the the pipeline execution
engine is really really powerful so yeah
this is my favorite favorite feature of
spinnaker you can see here there's an
interesting stuff built in around wait
times so this is another thing where
spinnaker gives you a fairly mature
deployment you can roll your application
out wait 30 minutes to just make sure
you verify that your application is
healthy and then after that time you can
execute some other steps maybe you want
to clean up your infrastructure or
something similar okay so this is where
the Oracle cloud infrastructure comes
into place Oracle will have what we
refer to as a second-generation cloud we
hired a bunch of really smart folk from
various vendors and we got them to
reimagine what what the cloud would look
like if we were to build it again
so Oracle's cloud gives you some really
interesting features that you don't find
anywhere else so some of those are
around the network security so you get
full network isolation you get a host of
interesting security features and you
also get the ability to spin up
bare-metal servers on demand which is a
really really powerful thing so the
hardware underneath the Oracle
bare-metal cloud just is truly
impressive bare metal so you can spin up
both bare metal servers and virtual
machines and the idea here is that a lot
of enterprises when they come into cloud
there's there's certain restrictions
that they have and a lot of them are
bringing on-premise deployments into the
cloud and with bare metal you can
literally lift and shift your your
applications straight into the cloud so
if performance or security network
isolation predictable network traffic is
important to you then Oracle bare-metal
is it's a really really compelling
choice so recently we added support to
spinnaker to deploy onto Oracle's
bare-metal cloud so you can use
spinnaker to actually deploy into a
bare-metal machine if you want to
yes there's a pretty cool feature so I
guess you may be wondering why Oracle is
investing a spinnaker it makes a lot of
sense for us Oracle is a huge company
and we deal with all the same problems
at a company like Netflix we deal with
we have a complex team where we're
deploying applications and those
deployments involve multiple teams
coordinating a lot of things so at all
like spinnaker where you get a full
end-to-end view of your deployments and
you get all of this powerful all this
powerful features for free is really
really important to us another thing to
say is that Oracle have become more and
more invested in open source software so
over the next few years you'll see a lot
more interesting stuff coming out of
Oracle so we'll be becoming more and
more engaged in the open source
community a good example of that is
whether we recently joined the cloud
native computing foundation and you'll
see lots of interesting stuff around
kubernetes and obviously we'll be
continuing our investment in spinnaker
over the next few years so it's been a
awesome experience working with the
spinnaker community it's been fun and
I'm going to hand over to Andy he's
going to tell you a little bit about how
Netflix used spinnaker
Thank You Ellen for for having me it's
great to be here so my name is Andy
Glover I run deliver engineering for
Netflix any Netflix members in the room
three okay a few
all right so roughly two years ago
Netflix became a global company and now
we we we effectively streamed to every
country in the world except China North
Korea and I think Syria and in order to
facilitate that rapid growth we are all
in the cloud we leveraged AWS we are
kind of the poster child for being a you
know born in the cloud type company and
as such we believe strongly in the value
of continuous delivery continuous
delivery has a number of benefits I
think any company regardless if you're
Oracle's you know Netflix every
Enterprise here probably wants to be
able to move fast right react to market
conditions be able to you know move on a
dime and that's what continuous delivery
ultimately is facilitating for Netflix
but it's more than just being able to
move fast and you know take over a
market or enter a new market before
anyone else does because continuous
delivery also allows you to move fast
with respect to what your your customers
or your members your subscribers or
whatever you call your users it allows
you to build the right product for them
so at Netflix we're constantly
understanding what you are doing on our
platform whether or not you're watching
certain content whether you're using
certain features and we can rapidly
figure out if you're not using those
features and remove them via platforms
like spinnaker or if we figure out via
a/b test that most of you like this new
feature we can quickly roll it out to
our membership at a global scale and
then obviously continuous delivery
lowers our overall let's say development
costs from the standpoint of we're on a
paved path that then increases our our
ability to deliver rapidly but overall
you know our our developer efficiency is
increased so continuous delivery allows
you to move fast allows you to do what
you want to do for your customers
actually
it allows you to respond to your
customers because in this day and age if
your customers think that you're not
moving fast enough for them they'll just
go elsewhere right and then finally it
definitely as a overall concept has
reduced our development costs and
increased our efficiencies and so we
created this platform called spinnaker
and as Ellen's already done a great job
of introducing it it's a it's an open
source platform that we that we built
from the ground up but we leveraged a
ton of lessons learned so Netflix has
been doing you know let's say continuous
delivery to the cloud for many many
years and we've had a number of products
and so spinnaker is the culmination of
all those products it's roughly four
products that we learn from and we
decided let's start over and build
something from the ground up leveraging
the lessons learned from all these
different products and one of the first
things that we embarked on was ensuring
that we had a vibrant open-source
community around spinnaker so as you've
probably already figured out from from
Owen we you know we're partnered with
Oracle we partnered with Microsoft
Google Target Veritas a number of
companies out there I've invested in the
spinnaker platform and created different
cloud providers like Oracle bare-metal
cloud as your Google cloud platform
kubernetes at Netflix we've obviously
made it work with AWS and our own
internal container cloud called Titus
but then there's also a number of large
companies also leveraging spinnaker so
that could be Capital One I think I
already mentioned target AOL the list
goes on so it there's a vibrant open
source community and we we set out from
beginning to ensure that this this
platform was applicable to companies
outside of Netflix because as as Owen
said delivering software reliably and
safely is a hard problem it's hard for
Netflix it's hard for Oracle I imagine
it's hard for many of you in this room
and we wanted to ensure that we solved
that problem together as a community and
so to do that first and foremost we made
this platform very pluggable and as if
you're already figuring out it must be
pluggable if you know that the good
folks Oracle made it work with bare
metal cloud but the key thing is that
the plug ability is on both ends of the
Spectrum's if you can think of
continuous delivery is kind of like a
continuum where you have inputs that go
in and then outputs the inputs in the in
this vinegar platform are completely
pluggable so you can have a Mis which
are virtual machines in the AWS world
you can have docker containers you can
have files you can have images it
doesn't matter whatever you it whatever
you want to deliver you can put as an
input so to speak and then the output is
ultimately where that deliverable is
delivered or deployed so you know the
output could be a bare metal cloud it
could be two kubernetes it could be two
AWS could just be the data centers so
you know the list goes on in terms of
the various cloud providers that
spinnaker supports one I didn't mention
its ports DCOs and in fact this quarter
my team and Netflix will be making it
work on some bare metal servers that we
ultimately deliver videos to to you all
when you press play so it's a very
flexible platform also and I'll show you
a couple of screenshots but as Owen
already showed them as well because
spinnaker is a continuous delivery
platform there's this notion of a
pipeline and the pipeline is made up of
stages and those stages themselves are
also pluggable so you can create your
own stages at Netflix we have a series
of custom stages that aren't open
sourced and there are other companies
that have the the same pattern where
they've they've created custom stages
that do something unique within their
enterprise I think something important
too
to delineate about spinnaker and
another's at least one asgard user in
the room and Asgard's one of those
previous systems that we open sourced
that was successful only built on and
the key thing about these about as
gardens and spinnaker is that we created
a model on top of the cloud so most
cloud providers kind of stop at like
let's say the server group level so I
can speak to AWS since that's my
expertise and the top level let's say
domain thing in AWS is a is an auto
scaling group and so what we did in
Netflix is we created a model on top of
that with clusters so clusters think of
those as a series of server groups so a
server group is usually regardless of
what cloud you're and is is a data
center and so a cluster then spans the
globe and then a cluster the next level
up is an application so thinking it from
a global standpoint you can have
applications that
are made up of clusters and those
clusters are made up of server groups
and that's where your then native cloud
kind of implementation takes over and at
Netflix because we have this powerful
platform it's become kind of this paved
path or paved road for teams to to
leverage to ultimately deliver software
and what I mean by that is think of this
is like a superhighway where you jump on
and you have fast reliable consistent
delivery into the cloud but the beauty
is is that other people can plug in on
ramps and off ramps so to speak and
those are those stages so at Netflix we
have custom stages that do unique things
that affect delivery at Netflix like
automated canary analysis or squeeze
testing or our chaos application testing
platform and so those ultimately get in
manifested as custom stages that then
teams can leverage as a part of their
delivery into AWS there's a great book
by a guy named jazz humble it's called
continuous delivery and he's got a quote
in there that I love and he says
continuous delivery is about making
deployments boring that is like they
just happen all the time there's not
this all-hands-on-deck it's Friday
evening we're going to deploy so
everyone get some pizza and some coke
because we're gonna make sure this thing
doesn't like catch on fire right and so
I got to tell you at Netflix delivery
deployment it's super boring it's so
boring that we and we do it over 4,000
times a day
in fact this number is no longer even
relevant for us because we're now
delivering software assets to more than
just AWS but we deliver it to CDN and as
I already said this quarter we're
working on delivering software to actual
boxes that you know reside in data
centers all over the world including the
UK and so this this number just captures
how often we're deploying to AWS and
that's a hundred percent growth you know
year over year in terms of when we went
from Asgard and then started with
spinnaker so let me just show you a few
screenshots of what I mean by by you
know continuous delivery to the cloud at
Netflix with spinnaker they should look
familiar because own already showed you
a couple but here's he
a pipeline that is doing a number of
things in this case it starts with a
with a bake and that's ultimately just
delivery that's creating an immutable
asset and then the next step is I want
to show you that there's three parallel
stages going on so I know and already
articulated that that you can do as many
things as you want in parallel and you
can do kind of like a fork joint in this
case they're all joined with the
deployed canary and the other thing I
want to point out is that it also
supports stages like just manual
judgments so in many cases humans are
still required and so in this case
there's a there's a stage where you can
have a human come in and say yay or nay
and there's the buttons on the bottom
right where they can say hey let's let's
keep going or let's stop the line
increasingly at netflix this particular
stage isn't used but you can imagine
it's a you know it's an evolution of
software delivery at various companies
and teams in terms of the level of
automation they're comfortable with and
as you can see here there's a number of
different stages that you can choose
from when you fashion your own delivery
pipeline and these stages again just to
to reiterate as much as I can these are
very pluggable and so at Netflix we have
a number that aren't open sourced and
there are other companies that are doing
the same thing and again as Owen already
pointed out spinnaker we define it as a
continuous delivery and infrastructure
management platform so it's it spans the
entire continuum of software delivery so
not only can you fashion a pipeline that
ultimately delivers let's say some asset
to Oracle bare-metal cloud but then
afterwards you can then manage that
asset and so in this case what you have
here is a cluster remember clusters made
up of server groups in this case this
cluster is has two server groups one in
US east and one in US west two which are
these are AWS regions and then those
little Chiclets are the actual nodes
colors indicating whether or not they're
healthy or not there's multiple colors
in this case you can see three or four
represented green means it's healthy red
means it's not healthy and then the kind
of different shades of blue showing that
these instances are coming up they're
being registered so what what you can
ascertain from the
the bottom ASG is that it's scaling up
that's why you have a bunch of blue ones
we also support as a part of delivery is
this kind of discontinuity of
traceability and so in this case what
you can see is that you have two
versioned
server groups version 175 and version
335 but you can trace them back to an
individual build in this case at Netflix
we use Jenkins and so Jenkins serves as
our continuous integration platform that
ultimately then kicks off spinnaker
pipelines which obviously then serves as
our continuous delivery and as a part of
that infrastructure management you can
do a number of things once you've
delivered this software so in this case
you have an ASG or not a scaling group
excuse me an auto scaling group or a
server group that you can you can you
can roll it back you can destroy it you
can resize it you can create a new one
these are all manual actions you may
have to take and I would say that the
one I'm most interested in showing you
here is this notion of you know you can
roll back in the event of a problem and
as Owen pointed out there's different
deployment strategies and so in this
case this is a red black and many of you
call it a blue green we call it a red
black because that was the old icon
colors at Netflix know it's a red and
white but it used to be red and black so
red black delivery or deployment is in
this case you have two aSG's v3 1 4 and
then the 3 4 0 and the 3 3 4 0 has been
grayed out because that's the old one
and so red black deployments allows you
to easily flip back to the old version
in the event of an error right and so
really what it is is the orchestration
of you have an existing server group you
stand up a new server group once it's
fully healthy then all traffic is routed
to the new one but the old one is then
disabled and left around because
invariably
you know software errors hopefully you
like to catch them before you do a
deployment but in complex you know micro
service environments sometimes you know
things happen afterwards and so many
teams will have
you know the old ASG or server group
they'll hang around for it for a couple
hours and just make sure things are okay
but in the event if they spot an error
and the new one they can quickly
re-enable the old one disable the new
one and route traffic to it and so
that's the benefit of a red-black
deployment or a Bluegreen deployment and
in the event of a rollback of course you
can effect a rollback automatically
through pipelines but sometimes you know
an error will happen after the pipeline
is completed and you might have to
effect a manual rollback and so in this
case when you hit rollback you see here
that the the left arrow is pointing out
that there are two server groups and the
old server group is in a disabled State
in fact it's at size zero that's why you
don't see any Chiclets but when you do a
rollback it'll orchestrate the spinning
up of the old server group it'll spin it
up to the correct size of the currently
enabled server group and then route all
traffic to the old one again there's a
whole lot of steps as one of own slide
showed out this this is a massive
orchestration and this is one of the
benefits of a platform like Spinnaker's
that does it all for you so one of the
many features that we take advantage of
Netflix that was also pointed out as
this idea of deployment windows and so
netflix has traditionally very cyclic
traffic for example it's 11:30 here on
the on the west coast most of us are
hanging out here in neo Moscone and not
watching Netflix
however in Europe people are watching
Netflix right now with like a nine
o'clock or something whatever so
everyone's watching you know Netflix in
Europe so you can imagine from a
regional standpoint our traffic is
cyclic right it's it's spiking in Europe
and it's pretty low right here in the
west coast and so deployment windows
allow you to time those let's say
troughs and so that's what we used to do
is say hey look let's not do
let's not affect you know production in
Europe right now with maybe something
high-risk we'll do it you know later on
in the day when everyone in Europe is
asleep the other benefit of deployment
windows is once you go fully automated
like moat you know like we like like we
are at Netflix you'll end up doing
deployments all the time and so a
deployment window allows you to also say
hey let's all
deploy between nine and five when people
are in the office because again things
go wrong you know software delivery is
hard and challenging and things break in
Netflix frequently and so we tend to
like those things to break when most of
us are in the office so we can fix them
quickly so deployment windows allow you
to do you know both those things and
probably more use cases that haven't
thought of and so in this case what you
see here is we've integrated with our
telemetry system so you can see where
the troughs are and you can time your
deployments to say hey look I want to
deploy this when the trough is at its
lowest or when when there is a trough
and because spinnaker is a very very
extensible system we've we've integrated
with you know is that paved road I was
telling you about it's very easy to
integrate this platform with external
systems so at Netflix we have a
sophisticated automated canary analysis
system so you can think of a ACA or
automated canary analysis is kind of
like our final gate so with ACA we can
we can affect or we can we can put a
small deployment out in production and
route a small amount of traffic to it
and validate that it's okay and
obviously if it's not okay the blast
radius is pretty small but if it is okay
then we can we can say hey this is a
great you know it's a great version of
this particular service let's spin it up
to you know whatever a thousand
instances and so you can do that quite
easily through Spinnaker's pipelines and
in this case you can also integrate with
disparate systems so in this case this
ACA the resolutions not really good but
what you have here is four different
steps going on at the same time or four
different stages simultaneously and one
of them the ACA has scored a 93 and so
it Netflix our ACA system is pretty
simple it scores it from zero to 100
hundred being perfect zero being the
worst you can set a threshold you can
say I want this deployment to go forward
if my ACA score is better than a
nineteen so in this case it was a 93 and
so they they just kept rolling forward
but you could imagine if it was an 89 it
would fail the deployment it would
actually fail the pipeline rollback the
deployment you'd be good to go again
this is fully automated we also support
tight integration with various
notification systems so I mentioned that
we'd like to do the deployments during
you know the hours of 9:00 to 5:00 when
people are around the whole idea being
is that if there is a problem you want
to fix it as soon as possible so it
spinnaker you can you can notify people
via email SMS HipChat slack it's
probably something else I'm missing we
tend to use slack at Netflix the idea
being here is that when a pipeline
starts or stops or fails you can notify
people but you can also do it at the
granule of granular level of a stage so
in this case what I'm pointing out is
that you know there's various support
channels so every team at Netflix owns
their own destiny
they fashion their own pipelines and
they deliver their software at their own
speed and then they have their own
support teams and so in this case if a
pipeline fails they want to be notified
immediately so they can obviously fix it
and so in the case of slack this is my
team's
slack channel we get notified anytime
there's a deployment of space or
spinnaker deploy submit occur at Netflix
and so we're aware of when anything's
going into production or any environment
and it's it's it's right there and this
provides amazing context from a support
standpoint because not only do we
develop spinnaker but we also we also
run it for Netflix yes
and so sorry the the resolution on this
one - you got to look back to see what
the slide is because it's a paved road
and we integrate tightly with you know
other services and Netflix one thing
that comes out of the box of spinnaker
is this notion of chaos and one of our
most famous open-source projects as
chaos monkey and you can think of chaos
monkey affectionately as a service that
runs in your environment and randomly
just turns servers off and that that
kind of notion of chaos goes to the
ethos at the Netflix culture about
reliability and so with spinnaker when
you create an application you get chaos
monkey for free and the idea here is
that by randomly turning off or shooting
servers servers actually will just we'll
leave it at turning off servers will
avoid the violence example so chaos
monkey will turn off your servers and
ideally if you've written a very you
know a resilient service it shouldn't
affect
your service right because most services
need to run more than one instance and
you can do without those instances if
they're stateless and whatnot so chaos
monkey comes right out of the box with
spinnaker again it's that paved road and
this is the same in the open source
world and in fact it should work on or
hold bare metal cloud and so pipelines
themselves what I wanted to show here is
they can be triggered by any number of
different ways so at netflix you can the
way the patterns we've established are
you know if a Jenkins job runs it can
kick off a pipeline but you can also run
pipelines on a cron schedule you can
kick off pipelines from a git commit
pipelines can call other pipelines so
it's extremely flexible and you know in
the case of a cron you can imagine that
we a lot of processes that are
automatically deploying things into
production or you know there's there's
pipelines that will run tests you know
periodically and whatnot and then
there's this whole notion of
preconditions and no one pointed that
out in one of his previous slides and
this is a really powerful construct
because right the cloud is a dynamic
place pipelines can take you know any
length of time to execute if you run a
series of tests they may run for a long
time and so this precondition stage is
quite powerful in that before you do
something to in the cloud you can set a
precondition to effect hey let's make
sure that you know that our assumptions
about what the cloud looks like before
we do a deployment actually are true and
then as I mentioned one of the biggest
things we want to do at Netflix is if
there is a problem we're gonna fix it as
soon as possible
and so spinnaker tightly integrates with
pager duty anyone here familiar with
Pedro duty yeah so a couple people so
Pedro duty as its name implies pages you
very quickly and so this comes out of
the box the spinner here you can set up
a page or duty relationship and in the
event of an app going bad you can get
paged immediately and in fact at Netflix
we make it a required setting so that in
the event of your service going bad it
you'll get paged quickly and there's
also a button in fact you can kind of
see it in the top right there a little
Batphone that people can press and they
can also page you and then I did want to
point out
that you know you can really affect or
create some really interesting delivery
patterns and so in this case you have a
pretty large pipeline that's doing a
number of things concurrently if you've
ever watched Netflix on your computer
via your browser this is that product so
cadmium is the browser plugin for
Netflix and that's its delivery pattern
you can see that if you study that for a
while you'll notice there's some some
specific things that will make it look
that way but nevertheless with spinnaker
you can do as many parallel stages as
you want you can join them you can and
you can fork whenever you want it's a
very very powerful delivery system and
in fact cadmium doesn't even deploy to
AWS they deploy to a CDN and we didn't
when we set out to build spinnaker
didn't even know that they would want to
use it but because we built that
flexibility in there they began using
spinnaker so it's a success story at
Netflix and that even our initial vision
we didn't realize that we kind of you
know get teams like this to leverage
spinnaker and I just wanted to share
that you know where we're going with
spinnaker is this idea of declarative
delivery and that's ultimately making
spinnaker more intelligent and so we've
been running now spinnaker for three
years at Netflix we've learned myriad
lessons we've learned a lot from you
know folks like you know Owen from
Oracle and and other partners and what
we've realized is that a lot of the
bells and whistles or knobs and and and
dials in spinnaker we can infer based on
some things upfront and so if
declarative delivery what we're moving
towards is some people will call this
let's say configuration is code but it's
much more powerful than that the idea
being is that when you spin up or near
about to set off and create a service if
you can tell us some things upfront like
well I'm a tier one service I have these
policies and maybe I have these
expectations around my memory management
or how much memory I need how much space
I need spinnaker can ultimately then
build your delivery pipelines for you so
you don't need to create them and in
fact manage pipeline templates is the
first stage in this kind of grand vision
of declarative delivery managed pipeline
templates are already out there for you
to use
declarative delivery is in fact there's
two things we're working on this quarter
that are really important that's one of
them and the other one was the you know
deployment to the ROC a servers which I
mentioned earlier and with that I will
turn it back to you own and just how
long did we take here oh I went over
thanks Andy
that's awesome okay so I guess the other
part of this talk which we mentioned was
kubernetes so we're gonna take a little
bit of an overview of cuba Nettie's and
what it is I know that someone here
before this talk mentioned talking about
docker many of you will have heard of
docker as a way to containerize your
applications and push into production
but as you use docker you'll really
quickly realize that it's not a
particularly powerful tool in isolation
so just deploying a single docker image
isn't a particularly useful way to
deploy software so you need some other
layer underneath it all to orchestrate
your deployments and to scale things and
to also heal your containers when they
never certainly die so kubernetes is
that layer and you can think of it as a
layer that sits over your infrastructure
and it almost abstracts away some of the
complexity of servers is I like to think
of it as an abstraction whether you're
running kubernetes on Oracle's bare
metal cloud or some other cloud provider
essentially you just see the same thing
you're just deploying to kubernetes it's
this nice layer and it's a good
abstraction so one of the obvious things
which you mentioned before who was
actually deploying to Cuba Nettie's it's
this new platform people are talking
about it all the time actually how do
you deploy your software to kubernetes
in a reliable way
other than just simply having a
developer SSH into a machine or run some
commands in the terminal which is kind
of the typical deployment scenarios you
see for kubernetes so what we're going
to do is going to give you a quick demo
which will tie all of these things
together and of hopefully it'll all make
sense once we do a real example so we're
gonna do a demo of a deployment pipeline
this is a fairly simple pipeline but
we're going to make use of lots of the
features which we've already mentioned
so we're going to take an application
which is essentially a docker container
we're going to deploy it to a kubernetes
cluster in a development environment
we're going to do some kind of
validation to make sure that deployments
healthy and then we're going to push
that deployment all the way out into
production and we're going to make use
of some spin
his features as we do that okay
hopefully this will start so here we go
okay so in this demo what we're gonna
start by making some change to some code
we've got so we've got a really small go
application really really trivial hello
world app just for demo purposes so what
we're gonna do is we're gonna make a
change so this application says hello
world and we can make a change it just
says hello open world and we're going to
commit that change and then once we're
good we're going to basically build the
docker image and we're going to push
that up to some kind of docker registry
so this could be any any any registry
but we're going to see can each docker
hub for this example there we go so
we're pushed so if we go and have a look
at docker registry we should see that a
new version of our application has been
pushed up and we you here we're using
the short git commit sha just to
identify the image and as we mentioned
before these docker images are basically
immutable so once you've built your
docker image there's no further change
to that image we're going to roll it all
the way through a pipeline so this is
our application that's currently running
a production we've got our development
environment here so this is just saying
hello world and on the right the other
tab is our production environment and
again it's saying hello world so what
we're trying to do here is essentially
get our application all the way through
into production so this is the Oracle UI
this is the Oracle cloud infrastructure
or previously known as bare-metal and
you can see we've got a spinnaker
running on a bare-metal instance down
the bottom and then we've got kubernetes
cluster running on some virtual machines
and what we have here we're going to
have a quick look at the UI you can see
this is the existing application that's
currently running we've got our
development environment where there's
five instances of our application
running and then in production this is a
fairly contrived example we've got
twenty instances running which refer to
20 pods in the kubernetes world so all
of the concepts in spinnaker are kind of
applicable to any cloud provider but
they tie quite nicely into community so
a load balancer in spinnaker inside the
kubernetes world is actually a community
service it's just a way to expose
traffic to your app
ocation yes a spinnaker here is running
on Oracle's bare-metal cloud but you
could run spinnaker anywhere it's not
actually running inside no we don't
currently you can see here this is the
this is the actual pipeline so as Andy
was mentioning you can actually
orchestrate multiple pipelines what
we've done here is we've broken our
delivery pipeline into three separate
pipelines we've got a development
pipeline so this is the pipeline which
will deploy your application to
development it's really simple
we've got a trigger there's multiple
ways to get your application inside
spinnaker but one of the obvious ones
for the kubernetes world is we're going
to watch the docker registry whenever
you push a new image up to that docker
registry we're going to take that image
and we're just going to basically deploy
that into production so if you look at
our deployment stage you can see here
that we're using a strategy called
Highlander which is basically because
we're in a development environment we
don't care we're just going to leet the
old version we're gonna keep one running
and there's only five instances running
you can open up this this page we can
see our deployment here so we're using
the development load balancer you can
see here there's various bits of
metadata about our application we're
running in development and as you can
see here there's the development load
balancer they're hooked up you could
scale this to any number of instances
you like and that's another benefit of
kubernetes scaling up your application
is easy you could if you want 4,000
instances of your application you just
type in four thousands into that box
it's great so you can see here that
we've actually picked up our change to
our image the development pipeline has
been kicked off you'll notice that the
deployments are fairly gradual in
spinnaker it's not instantly deployed
into that your production environment
that's because there's quite a lot
happening behind the scenes so you can
see here that there's actually multiple
stages and there's multiple things going
on inside the spinnaker system so before
we deploy our application into
production and we need to do some kind
of verification step this is a typical
thing in Oracle we'd often have some
kind of like release manager or QA
person who would sign off the release
before it gets shipped into production
obviously there's many different things
you could do here and you'll notice that
we've actually configured a notification
so whenever someone needs to manually
approve this we send them an email and
basically say you need to come into the
system approve this release and then
once it's been approved we're going to
roll it into production so actually you
can see here that our deployment into
development is completed and the
verification step is waiting for
approval so as we hover over this
there's a yes or no should we deploy
this in production or should we just say
no and just leave it typically you do
some kind of metrics or testing you can
see here that so this is our development
environment it looks all good so we're
happy for that to go into production and
we'll click yes and that will eventually
trigger the next pipeline so this is the
kubernetes dashboard one of my favorite
features of kubernetes it gives you a
good high-level overview of everything
that's running you can see here this is
our development environment you can
click down and drill down into the pods
this is really easy setup for Kuban at
ease you can click around and have a
look at what's running you can see here
this is our load balancer it's referred
to as a service in kubernetes we've got
a development and we've got our
production and as you can see we're
actually firing up some of our
production instances here so yeah
typically if you're deploying into
communities and before you manually
approve you probably want to do some
kind of testing so here's an example of
what you probably end up doing him in
real life you'd probably look at your
metrics after you've deployed a
development and you just want to make
sure that everything is working
everything's healthy again in kubernetes
there's kind of monitoring a super easy
to setup so you can see here we've
actually triggered our production
pipeline so Andy mentioned that
pipelines can trigger other pipelines so
let's have a we'll have a quick look at
this pipeline and see how it's
configured so this is a slightly more
involved pipeline there's quite a few
things going on here so the
configuration for this pipeline is
triggered off another pipeline so when
someone approves you can see that it's
set to be successful so when someone has
successfully executed the previous
pipeline which is our manual judgment
stage once someone's approved it it'll
trigger this pipeline and in order to
deploy our docker or yeah
into a kubernetes cluster we actually
need to find that image so everything
it's spinnaker is done on context
so we basically say here that we want to
find the last image that was supplied
into our development development
environment and we want to basically
take that image and we want to roll it
into production so you'll see here that
we're actually using the red/black
strategy to deploy into production we
want to be slightly more intelligent
about a deployment into production
versus our development environment you
can also see that the tag for our docker
image is dynamically populated by
spinnaker there's a whole host of
deployment strategies you can choose
from here this is kind of what we're
touching on earlier you can choose how
you want to roll this into production
we're using our production load balancer
but other than that this configuration
kind of looks similar to our development
yeah and so one of the things that is
interesting about spinnaker actually is
this kind of notion of waiting a while
so this is a really really powerful
feature once you've deployed your
application in production maybe you want
to wait 60 minutes maybe you want to
wait two days and just make sure that
your application is healthy and then
once your application is healthy and
it's running a production you can
destroy your old infrastructure
so I think the question there was what
happens if there's an issue with your
deployment and something goes wrong so
you get to choose so that's really
really interesting thing about spinnaker
you can say that if a deployment
pipeline fails I can trigger a separate
deployment pipeline which will clean up
my resources maybe it will delete
something maybe it will send a
notification to someone to warn them
that something's gone wrong you've got
the freedom to basically choose how you
want to react to a failure yeah it can
roll back as well so you can automate
roll back and assume that Netflix you
probably do this where if you deploy if
you deploy an application and it's
automated if something goes wrong you
can automatically roll that application
back to the previous version and you can
do that without any human involvement at
all if you want to
yeah you'd grow back everything if that
was the question so if something goes
wrong you literally just revert
everything typically you dilute use the
load balancer to revert to your old
instance your old cluster instantly so
this is kind of tying it all together so
you can see we safely deployed our
application and that's running in
production and that's a good example of
an end-to-end deployment pipeline with
spinnaker so I guess I'll wrap it up by
saying that if you want to learn more
about spinnaker if you want to learn
more about kubernetes or if you want to
learn more about Oracle's bare-metal
cloud feel free to get in touch with me
or get in touch with Andy I'm sure Andy
would love to talk to you about
spinnaker if you want to get involved
it's actually really easy to install
spinnaker a lot of work has been done
recently to make it super easy to get it
up and running it didn't used to be the
case but now it's very very very easy to
get there running so it's all open
source so you can go to github you can
have a look at the source code and
that's it</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>