<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>The Curious Case of JavaScript on the JVM | Coder Coacher - Coaching Coders</title><meta content="The Curious Case of JavaScript on the JVM - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>The Curious Case of JavaScript on the JVM</b></h2><h5 class="post__date">2015-06-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Z-ZtHodKwTc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this presentation is about well
generally using javascript on the JVM
with the emphasis on on on the Java
specific features in in a swamp my name
is Attila Sega d I'm a principal member
of technical staff with oracle if you
were here for the marcus presentation
two hours ago or Jim Lasky's last days
presentation then we are all team
members on the national project so
everything anything that goes wrong with
that blame us the my my take on the this
presentation is somewhat different than
jims and Marcus was Jim did actually
hint that that some of the things that I
will be talking about but- mine is more
drilling down into the into the JVM
integration so with that in mind yes of
course standard disclaimer don't make
any decisions based on anything I tell
you here okay I want to cover several
things as you can see i have 1 2 3 4 5 6
7 8 topics that i want to get through so
we should get cracking because I
actually want to show you some working
code as well not just talk all the time
I also want to tell you what will I not
talk about in this talk I will not be
talking about JavaScript as such I will
not be talking about generic java extra
script package usage because this is
again something that's been around for
ages and I suppose that you either know
about it or you can figure it out I will
talk about the the meeting points of
massholes javascript and the underlying
JVM basically you are the target
audience of this talk if you want to
take nass horn and use it as a language
to write something that is nevertheless
JDM specific either you're writing some
small script or you are trying to write
a large application based on avatar and
you need to reach
down to two existing Java libraries then
this talk is for you everything I will
tell you about is actually available at
the JDK 8 documentation Xin the
scripting section I will repeat this URL
at the end so you don't need to remember
it and actually if you go to the JDK 8
docs then it's fairly easy to find
anyway so with that in mind first thing
that we want to cover is basic interrupt
with java objects so i have a small awt
demo I'm I be using Java for very long
time so gym yesterday was showing you a
hello world with a button written in
Java effects I admit I don't know how to
write that i'm still using the abstract
windowing toolkits so this code is seen
here and this is actually a very crude
translation of the of the Java code that
you would be using for this purpose let
me just run it it doesn't do anything
nearly cathartic right it's just a very
rice yes it is ooh okay demo gods I knew
that I should be modifying things at the
last moment yes okay here you are
missing grace and there's this little
hello gel one I press it hello jello one
how are you doing great now the thing is
that we can do better right so here's
the soul declaration of new
java.awt.event actionlistener thing is
and then you need to define of so this
is basically implementation of a Java
interface in JavaScript the thing is if
this function if this interface actually
only has a single method then you don't
have to be passing the full object that
defines the function you can just take
your action listener construct
you can just pass it a function so
becomes a little bit simpler right and
hopefully all the braces are in the
place now or not mm-hmm okay there you
and you know works identically however
we are not using the argument so you can
omit it you don't have to specify
arguments that you won't be using or for
that matter if this method is expecting
an interface with exactly one type you
don't even need to specify you can just
give this to nass form and it will
figure out that since you are just
passing a function then then this
function you passing a function it
expects an interface well you are
probably trying to pass an
implementation for the interface right
so still works and we are chopping off
code property getters and setters right
these are actually in a mass one you can
you can replace this so get text is
basically equivalent to text and then
set text is basically equivalent to two
text equals something so we eliminated
some more code alright still works
excellent can we eliminate even more
code yes we totally can eliminate more
code how about this right I basically
just use plus equals on a javabean
property well
it still works the thing is the sort of
a little bit for an unintended
consequence but down below it really the
plus equals the way it's compiled it
will be a getter followed by the
operator followed by the sector and
since they think thats underlying is
actually a being it just works if you
have a numeric property you can say
something dot numeric property x equal
to and then you basically just did a
multiple multiplication of a property by
two so this all works ok so what we see
here is what we want to do is simple
things need to be easy but you can
create Java objects with new you can
invoke methods on them and pass
parameters without having to think about
explicit type conversions which overload
you might be invoking among the many
overloads it's all taken care of for you
it knows it it will always knows we box
the values from primitives to box
numbers if they need to be anonymous
functions are converted to this lambda
parameter syntax as you could see so for
the action listener just pass a function
and getters and setters work that
property syntax we are really trying
very hard to to give you on a
programming environment where you are
manipulating Java objects and talking
basically with your underlying platform
in a very ergonomic very fluid very very
natural manner again going forward with
this team iterating over Java arrays and
lists of course it works why wouldn't it
so if you have an ArrayList you can just
either iterate over its indices typical
thing that you can get hung up on Java
is for in is actually iterating over in
this is not over elements so for VAR
indexing colors will return 0 1 2 it
once returned red purple purple pink and
we also support this little extension
for each with actually iterates over the
over the actual elements so not
surprisingly I do
so here there is the same code then with
some additional prints for clarity and
if I run this we will get as you can see
the first four loop was iterating over
the indices second one was iterating
over the elements so for in index
iteration for each is element iteration
naturally yes for over indices supports
lists and maps for over elements
supports any iterable okay the question
was what interfaces does do these for
extension sexually support you can
iterate over java maps here you have a
list of three countries which i have
lived in for a while i actually miss us
from here i lived there for two years as
well but and you put put them in a map
same story for iterates over the keys of
a map for each operates over elements we
did actually do with cheat a little bit
because in javascript the four in is
supposed to always return strings as
indices even when you're iterating over
a native java array because that's how
javascript is okay I mean myself when I
was coding this I naturally assume that
you know the elements are integers and
then and then a specification compliance
test actually failed and then I was
looked staring at in disbelief for a
while because turns out that in Java
arrays when you are iterating over
indexes you're not getting back values 0
1 2 as numbers you are getting back the
string 0 the string 1 the string 2 and
so on it's one of those well as
JavaScript right so here we are cheating
here when you're iterating over Java
maps over their keys we will not convert
them to string because that would be
stupid we are obviously keeping them in
their own type so that when you apart
sing it to the square bracket operator
they are they are preserved oh by the
way square bracket operator right so
works on lists works on maps as you
would expect it does you know what I'm
scripting oh one thing you can get a
little bit tripped over is maps have
this duality right they have elements
but they also have methods so do they
can take conflict in JavaScript of
course they can conflict in javascript
javascript does not have a concept of
separate namespaces four elements of a
container and four properties and
methods of an object so when you say
object dot size anything goes it can be
it I mean javascript object don't have
the concept of of functions as such they
are just properties that returns
something that's callable that way when
you invoke it then it will get past the
object as it's this but other than that
they don't have a concept of other
methods of an object as such so you say
map square bracket size equals to what
you did here is you put an element name
sighs into the map so what happens when
you try to retrieve this if you retreat
again with the square bracket operators
little print too because it's smart
enough to retrieve the element even if
you use the dot property for maps
specifically we will actually yeah we
will we will retrieve the the property
as well but we are trying to be smart
about it so if we notice that you are
actually invoking the thing that you
were requesting from it then we will
favor methods / / elements so the last
to work as you would expect them to this
did take a quite a lot of thinking to
get right but yes
no since iteration over ha stopped so
the question was if he was doing that
type of when you were iterating over a
journalist will it convert it to strings
no it won't let's make a little uh I way
to actually have something for xjs yeah
these were my k bar fools okay so this
is a native java race so when you are
doing for bar yeah it's in separate
directory it's okay for I n X print well
we'll see you can okay so if you do this
then yes you will have string string for
native arrays if you do this on a on a
java list though so I don't mind me all
right list don't mind the man behind the
curtain
so if you do this you will get number
number we are allowed to do this because
the specification doesn't tell you
anything about the types that you need
to return if you are iterating over non
native JavaScript objects so
java.util.arraylist Maps there are host
objects as far as the environment is
considered so we are free to do whatever
we want to yes yeah it will be the
actual map element so not the no not the
property I mean if you are doing the
property get then you are getting the
value of the property right you can
actually retrieve methods if you want to
you can do much with them but you can
retrieve them can you do object ought to
get prototype on one prototype saucer
nope ojos poachers don't support
prototyping so there are two different
concepts of classes we we opted for not
providing prototypes on the on the pojos
because that's just the huge kind of
worms and without a clearly defined
benefit so we decided to not go there
all right so these are the these are the
basic things simple things are easy
interrupt security when you are running
under the security manager will prevent
you from accessing things that are
dangerous class class loader anything in
reflect package anything from java.lang
invoke packages you can however in both
color sensitive methods and they work as
you would expect them to which is pretty
big deal if you don't know what it is
about it doesn't matter and obvious you
can only vote public methods because the
script don't have a concept of living in
a package so you or or being sub classes
or something else so you cannot
reasonably define what did what would it
mean to invoke a protected or a package
private method on a on on any java
object so you are restricted to invoke
in public API subjects
okay how do you extend Java class from
script because of course you can so
typical mask from code right a runnable
you can do mu on a type and pass it an
object we're done with with definitions
of the functions but as I told you oh
yeah spot the difference between these
two right it's the location of the
opening curly brace we actually do
support this as this format as a simplex
extension for foreign ass home so they
look more like initializer for inner
classes in Java and of course you can do
it in a much easier waved it only takes
one function then you to the code to the
interface constructor because you're
actually invoking a constructor or an
interface type you can just pass a
function and it still does what you
would expect to do lambda stars with
inferred types the thing that I showed
you in D in the first awt demo again you
don't even spell out the type it's
inferred from the type of the parameter
expected by the method you can implement
multiple types except it's some simplex
sugar comes into play you will see that
i will be using capital j java quite a
lot in this presentation that's our
entry point into the Java API s we opted
to not pollute the namespace with a lot
of all kinds of Java specific objects we
are trying to restrict it so mostly you
are expected to interface with the with
the Java capital j Java top-level object
Java type is a function that given a
fully qualified name gives you back an
object that represents that type I'm not
saying it gives you back the class
because it's not giving back the class I
will get to that so you can say var
runnable iterable equals Java extend
iterable runnable and you get back a
class that actually implements both of
these interfaces and when you invoke it
as a constructor like this then you can
actually specify the functions for both
for the runnable and for the iterable
the runnable has a run-in turrible has
an iterator keen-eyed readers will
notice that we also do a return new
iterator there
our iterator is actually our iterable is
actually using javascript to define its
iterator as well and also notice that
iterator has three methods right it has
next has next and remove remove is
seldom used and you are not required
really to specify it if you are not
specifying an an implementation for any
matter then you try to invoke it you
will get the unsupported operation
exception and that's it so we we allow a
partial implementation of types here and
you know and then you can create one
instance of this object and you can pass
it to a thread as a run-a-ball and you
can you can pass it to a for each as an
iterable and it will work as you would
expect it to so I do actually have this
here what I said right define the types
define the class so it's always you
define this this actually creates your
Java class that is sort of a proxy write
JavaScript proxy that when you pass it a
JavaScript object then it will know how
to delegate methods to the likewise
named methods in the in the object
literal that you passed it to then you
can use it as a runnable in which case
your print running and you can use it as
an iterable in which case it will print
you hopefully 42 43 44 if I got it right
now look at that works
usually in the Java home you have so
jeal home bin jjs is the is the jaw is
the java javascript really it's the
white that jjs and i'm using dr. JJ yes
because I'm for purposes of this demo
I'm just you know doing things like
using our L wrap actually running on the
security manager I shouldn't be doing
that whether I can move that or not
present it did work so on but normally
you just use Java home slash bin slash
jjs from command line yes you cannot say
it a constructors prototype as I said
these these are all java classes and we
do not support prototype some Java
classes well it's a pro big North I mean
setters and approaches for non-existent
properties basically end up being mostly
the way you do it with host objects at
the very end up being no ops they are
ignored to be honest I don't know and we
can we can try it but let's let this go
because we have a lot of ground to cover
so am I appreciate the questions but I
don't want to run out of time all right
ok so how do you get to the jaw oh yeah
so the question is I usually formulated
what the hell is this I mean seriously
in your adapter what's the value of the
of this keyword so what we do is the
value of the disk keyword is as you
would expect the actual value of that
object literal that you passed to the
constructor you don't even have to pass
an object literal to the constructors
you can pass an external object to the
constructors so and this will actually
print 42 because the print this dot why
actually goes to the actually goes to
the 2d to the object that defined the
behavior and not the not the proxy
itself I don't
sorry yes I think that's correct let me
just I don't actually have a code
snippet for this so let's put it here
sjs yes exactly Prince 42 as you would
expect it to and as I said you don't
even need to have an object literal here
you can do things you can say var
runnable behavior let's be British and
you can do this right and then you can
say you can do this right so your object
can come from anywhere that defines the
behavior for that particular proxy
instance and it will still work
identically so so that's why normally
the expectation is that when you invoke
functions so now your JavaScript object
and this is the the obviously JavaScript
this so okay and so what do you do if
you actually need to for any reason get
to your proxy to your Java proxy because
our is actually an Java object that
implements runnable and delegates to the
JavaScript functions so what do you need
when you need to access it well I mean
it's there right it's in the variable
are so you can you can still access it
you need it for any reason
notwithstanding the remark that I am
hard pressed to figure out any reason
why you would need that object right
except for some weird identity compare
is something on the other hand if you
are doing this passing the function
instead of an object literal than the
the implicit this will always be now
which sounds weird if your Java
programmer in JavaScript it's completely
legal for this to return now case in
point if you invoke a global function in
a strict mode it will always have null
as it as it's this so that's what we
went for
yeah the question is you can do you
strict yes we support the you strict
directive it is required by the
specification so yes and you can also in
the command line you can also specify
whether implicitly you always want to
run in a strict mode so yes of course
atmosphere 5.1 mandates that you so that
you cannot be compliant if you don't
support super strict mode alright how do
you make calls to the superclass
implementation because every once in a
while you might need to do this as well
what we do is so say you want to
subclass the filter writer to to
capitalize any text that it was given so
this scheme the canonical scheme that we
went for is we introduced the java dot
super method for which if you pass a
proxy you get back another object that
exposes the same methods but when you
invoke on them it actually goes to the
superior to the superclass of the
particular class so this is how you
would write a filter writer that's
that's that's capitalizing supposing
that you have a capitalized function
somewhere 10k to actually have a writer
jas yes of course the actual working
code is slightly larger than what I can
fit on the slide it also does things
like oh look at that if offset is
undefined then I am actually using s off
and land here i'm using the three
argument right why is that well it is
because in javascript you don't have
overloaded functions you can bind the
name right to a function but in that
case you are actually overriding all
over brighting all sorry over now you're
overriding all over loads of that
particular function in the zoo in the in
the superclass so you will need to have
your own simplify the dispatch by arity
or dispatch by type we cannot really
help you with that so um and this is how
how you use it afterwards so this is the
super is a java super for your writer
and then the guy is actually using it
here
and if i write it you can see that i
didn't write it if you run it you can
see that it does the or let's write on
top of the screen because we're getting
low so you see that i have the hello
world in ll world because the second
invocation here was from the offset one
so this is the invocation with the
single argument this is the invocation
with three arguments and you can see how
it's actually supposedly going to the
super class and doing the right one
thing we did early on was we thought
that I it's ugly to have this global
variable so how about we actually
squirrel it away here in a property
turns out you can do that because when
this is evaluated this is not yet
defined right even though it's lexically
below it it is actually executed as
initialize it's executed below before
this line so unfortunately a fortune
this would be nicer but it doesn't work
well yes of course but I don't want to
dwell really long on it this object
literal right is evaluated before you
assign to the variable CW so actually
within the object literal invoking
something and trying to pass it CW by
the time we invoke it it's not
initialized yet so that's why I'm
fortunate you can do it it would be
really nice I mean lexically bound
whatever doesn't work well then however
we are actually supporting an
alternative syntax which is supporting
an alternative syntax we don't have to
define anything but you can just do you
can just prefix any of your methods with
super dollar this is a rhino compatible
thing use whichever you like the thing
is we will keep will support both of
these super dollar is maybe more
convenient I typically don't like it
because it is certificate case of names
metal namespace pollution with synthetic
identifiers feel
kludgy a little bit but if it's more
convenient for you can use this as well
towards just as well all right so yeah
exactly i told you this was better but
it doesn't work alternative syntax
adapters and security you can only
extend implement public class interfaces
obviously you can override public and
protective methods this is not a
security hole because even in Java you
can subclass them and you can sub class
a class and you can override the
protected method so that you make it
public right all right type conversion
that's one is fun and it's really fun
because you know obviously that
expression there obviously evaluates to
string 10 right I mean it does and then
it comes to the question of how do you
get your type conversions to the to the
jaw to Java we mostly encounter type
conversions on the Java Java Marie when
we're invoking Java methods and we have
to match parameters to their signatures
stuff is usually trivial oh one nice
thing about Java type is that you can
also use it to to describe array type so
you can say Java type boolean square
bracket and gives you back an array type
and then you can use it as a constructor
and pass it to length and so this first
line is is actually the way that you can
fairly easily instantiate a boolean
array of one element Java boolean array
of one element and then I've wrote a
little test method where it it sets the
element to the boolean and then prints
what was the effective converted value
in most cases you know zero converts to
false fine one coerced through fine
empty object converse the true and what
yes it does in JavaScript all objects
that are object references that are not
now convert to true empty array
conversed through yes it does empty
string converts the falls and the string
with the word false converts to true
again javascript not my design alright
and JavaScript empty string converts to
force any other stream converts to
through it let's have it's all right
let's more
now yeah so now lend false will convert
to force okay sounds okay so let's
change it now now I'm not allocating the
primitive boolean but I'm allocating a
uppercase boolean array so they can be
references everything almost looks the
same except that now now an undefined
can actually be converted to a null so
because you know effectively the capital
B boolean class instances have three
effective values through false now right
so when we can when we are converting
the box types we preserve nulls I told
you about the same types for some reason
i am repeating this i've probably should
have rehearsed my slides a little bit
better but here it is again sam types
collection sort RL and you pass it a
function taking two parameters it will
figure out it's a hey this guy's
probably trying to pass a comparator so
let's treat it as a comparator and then
so these functions can take any numbers
of parameters right Oh commercial
privatization this is also a funny one
consider this little example you create
a thread you pass it a function that
prints hello and we would expect that
with our so not now already well known
function to interface conversion magic
is we create a runnable and then create
a thread with the runnable that when you
run it prints hello except that when i
first was writing the implementation for
this code it actually told me that well
it cannot decide so i got an exception
saying well i don't know are you trying
to pass a runnable or i'm trying to pass
a string because in javascript there
exists an implicit conversion from any
object to string so if you pass a
function maybe you want create a thread
that is just named after whatever is the
string representation of the function
this is one of those times when I hold
my laptop and I yell at it what is wrong
with you so I had to teach it though so
we taught math on that in these kinds of
ambiguity situations favor interfaces
over strings please by definition you
have
to write conversion prioritization
because if your language allows more
conversions than the Java language
specification does then obviously only
using Java language specification rules
is the longer sufficient it will leave
you with ambiguities so we had to do
some other conversions I actually
decided to not tell you anything more
about them because they just work if
they don't you know where to find me
tweet at me strings numbers and bully
ins in Java in Nass horn primitive
JavaScript types string boolean and
number because they're supposedly
primitive types in Java Script are
normally represented by doubles lungs in
strings and numbers however you can but
since we also treat them as poachers
you're actually allow to invoke Java
methods on them as well so if you take
the full string literal which is
actually a JavaScript primitive value
you can do a dot hash code on it
javascript objects don't have a hashcode
method but java objects do so this will
actually linked to the underlying pojos
hash code so you can you can do all the
four for instance string library has the
replace replace replace or some other
functions that the built-in java string
functions lack the prototype flag so we
actually provided so you are free to
invoke the the java.lang.string things
on our own a string primitives and then
come we come to the arrays JavaScript
arrays oh well they are particularly
nasty they can grow and shrink they can
hold values of multiple types at once
they can be sparse none of this is true
this is true for Java arrays so let's
suppose we give you an automatic
conversion from a java script to rate or
java ray how should that look like right
i mean we are converting from
fundamentally different types even
though both of them are named array so
we did a made a decision we are not
providing an automatic conversion nope
this won't work so you call
java.util.arrays to string you pass it a
native JavaScript string it bombs
java.util read arrays to string one two
three nope says well it's a little bit
verbose but it says well I can take a
longer a shorter way a biter a floater a
double or a boolean array object array
in a car array and what you passed is
none of those so so this is the one the
only place where you need to do an
implicit conversion and for that we have
the Java to method and that will
actually take a JavaScript array and
convert it to a Java array we decided to
do this for multiple reasons one is I
said no way in hell I am making a
copying operation with linear time and
potentially unbounded memory no way I'm
making that implicit for anyone because
that will that will come back to bite
you and then if you are using this Java
to then you will also come as a
programmer you come to understand that
this is a copy that there are no two-way
updates you cannot update an element in
the java ray and have it magically
reflected on the JavaScript side nope
doesn't work because maybe in the
meantime you have resized your
JavaScript array by the time you update
your Java rayon d on the other side so
they are divorced values there it's
always a copy java to actually can take
a second argument which is the class
into which you want to convert by
default this is an object array but you
can convert to an inter a as well
there's no reason why it wouldn't be
able to so so for instance if you say if
you are converting one two three you can
say Java type int and it will be an
inter a or you know why not you can
let's put something else here a string
and another string and convert it to a
double array so this this gets funny
right so as you can see now get one dot
0
25 dot Oh a string that convert to a
number and of course any string in Java
Script can be converted to a number
string foo specifically becomes not a
number which well technically it's not a
number but still it's a number it's a
double its a double but it's not a
number oh right you can actually oh and
you can also convert to a list and to a
DQ wait lists so an interesting tidbit
is all of our native script objects
actually implemented java.util.map
interface makes sense because the java
script objects are really just maps of
string keys to arbitrary values so you
could ask why don't our native arrays
immediately implement the list interface
right why not they should oh well the
problem is the canned native arrays
extend native objects in JavaScript
array is a special case of object so
implicitly they already implement map
and turns out you cannot implement both
list and map in a single class in Java
because for one thing you have
incompatible return values from the
remove and for other thing the contract
of list hashcode the map hash code is
actually incompatible so you know it's
some battles you can just can't win
that's why you need to explicit
conversion from JavaScript array to a
list as well statics classes versus
statics I told you we'll get back to
this as a Java programmer you do
understand the difference between the
expression java.io.file and java.io.file
both class right so because one is a
compile-time identifier that provides
access to constructors and static
members and the other is the reef I'd
class object that this is runtime
representation of the objects class so
these are separate concepts they should
not be mixed so in another language is
either we don't there are languages that
mix them up we do working very hard to
not do that so if you do what file
equals java.io.file or java type in you
pass the name you actually get back an
object that is not the java.lang.class
it's something that we that we refer to
as as the static object and you use it
for the exactly same purposes for which
you use use the compile time identifier
in Java as a constructor of the type and
as a namespace for the static members
that's the only two things you do with
it so you can do file dot create temp
file that's how you exact the statics
you can do new file you are using it as
a constructor it also works for a nice
one also makes sure that it works with
instance of checks as you would expect
so f instance of file in that case we're
eternally true the but the file object
when I say file instance of
java.lang.class it returns false no the
file object the static object is not a
runtime class which brings us to inner
classes as well how do you get inner
classes so let's take this small example
you have a farm every farm needs a dog
as it's commonly known so and this is a
non-static inner class so how do you
create these right so let's let's do
something so let's say let's farm be
Java type lass whole demo farm farm ok
and then let's create a farm
alright if we print it just evaluate it
it's a McDonald's farm because the
actual source code I will write to
string so we need to create a dog so in
Java what you would do here is if it's a
non-static inner class so McDonald's dog
would be new McDonald's farm dot dog
right now this unfortunate doesn't work
in JavaScript this is not the way we
chose to do it but what we do is that we
treat these classes as actual classes
that take their owning in stouter
instance as their first parameter
because as a matter of fact this is how
it works in the JVM it's the Java the
language that is hiding this from you so
I mean guess what Dorothy or not in
Kansas anymore this is not java this is
javascript so there's a few differences
that you need to get used to it is a
little confusing I know not necessarily
so but maybe it's just that because I've
been working with working with the JVM
level for for too long so and dog
actually has an so
right so it says true and you can also
get to the doctype made several
expressions you can say java so you can
you can either say farm dog so static
objects have inner classes both static
and on static as their properties or you
can say you can just say Java type mass
horn demo farm dog which is actually a
slight syntax sugar for for this rights
on the JVM level inner classes use the
dollar right and all these type a
dressings work so either far no dog food
qualify type with a dot or with the
dollar sign it will all work yep and we
come to some really fun stuff json vs
java objects who will win okay so what's
a POJO like in Jason right good question
so if I took a bit set and told
json.stringify it what would I get well
it's a sad story really so this is the
exact same code right so string defy it
what do we get undefined okay something
must be wrong here so let's let's let's
let's serialize with j json.stringify on
an object and just sneak the bit set in
there it must appear right let's see
well we definitely got the a but it
totally ignored our bit set so what are
we doing wrong turns out you're not
doing anything wrong we just conform to
the equus crib specification it says
only native objects erase doing number
and boolean are allowed everything else
must be undefined oh it also says it's
not permitted for conforming
implementation to extend the JSON
grammars so there you go fortunately
there's a way around this json.stringify
also can take replace their function
as a second argument so you can write up
your own function that will provide
replacements well not string replacement
that's wrong replacement object
replacement for pojos and then when you
are parsing back these strings then the
json.parse can take a dual of this
function a Reviver that can identify
such serialized objects and and and and
replace them again we can't give you one
out of the box function that we work on
every pojo because there is no way for
us to bright one because we can't tell
what is the actual serializable internal
representation of every object well we
could if we cheated and maybe to be
java.io.serializable see realized it
base 64 encoded and so on but believe me
you don't want us to do this so I do
have an example replacer for java
youtube it set when which looks like
this it's unfortunate a little bit
involved but but it is how this thing
actually can work we don't have one
maybe I have to oh I don't have to what
do I have I'll replace jas right so i
can say now json.stringify and i placed
set the bit set and I pass it this
function replace bit set and this is the
function which if you pass it a value
and it's a bit set then it will do
something and it will return a new
object that has a double underscore kind
property name bit set and then the
actual set bits so if you now run this
guy
then as you can see you actually do have
a new object that this a is kind bit set
and set bits are three and a five so the
question well just a sec row right and
then then we also have the Reviver which
is the which now additionally has a
revived bit set with which actually when
is given a value it checks whether it
has a property with this name and if it
does then it will create a bit set and
it will set its bits from the array and
if I run this thing and I parse back
what I what I what I serialized I can
check whether it's a bit set I can print
it and I can print whether it was equal
to the original one that I serialized
and run this you can see that true there
says yes it is a bit set that 35 is its
printed format just basically bit set to
string and that true is the true for the
the one that we got back is equal
semantically to the one that we sent in
right you had a question yes
square bracket means 0 square bracket
means optional parameter so you can say
stringify value or you can say coma
replacer or you can even say commas
space for for another custom value of
spacing that you want for pretty
printing that's that's what it means so
putting the bits together yep so got
this oh yeah the package illusion we are
using Java type and the way the reason
we are using it that is that we want to
get people off of the notion that
packages exist packages don't exist I
repeat packages don't exist jvm there is
no object in the JVM that represents a
package I mean granted you have a java
dot lying dog package but that actually
just contains some metadata that's
loaded from a jar file but it can't
verify the existence of a package and
this is because nothing in the running
JVM can verify the existence of a
package because at run time you try to
load the class with a fully qualified
name and then some low class loader will
either find it or it won't but this
means that that particular class doesn't
exist it doesn't mean that maybe some
other class in that package doesn't
exist so there is a packages only exist
in Java language level they exist at
compile time because the compiler
actually has access to the set of class
files and a set of source file so it can
check but at the runtime you can have a
class law that the generating classes
dynamically in some new packages right
all the time there is just no way to
figure out whether they exist the
package so yet dynamic languages would
like you to be able to write things like
varley's to equal new
java.util.arraylist and typical solution
for this is providing what I call the
stepping stone pattern where you provide
the top-level Java object and something
somebody references the appropriate Eon
it's a Java dot util you create a new
object that represents the java.util
package whether it exists or not we know
that this one exists but it could be
something else and then when you
retrieve another property from its
saying list then it will check oh do I
have a class named java.util.list if I
have then I return the class
but what if I don't have the class can I
throw a class not the no-claws the found
error or classnotfoundexception at this
point no I can because I still must
assume that the class name with a typo
in it might still be a package I don't
know so i have to conservative we assume
it so if you write an array list on a
talk like a pirate day and you add
another are at the a in the middle of it
then you can then try to instantiate
this thing and you won't notice until
you try to instantiate it because you
just cannot cannot figure it out earlier
than that the not an asshole or any
runtime they'll have to assume that you
might have a package name
java.util.arraylist somewhere in your
system who knows might have that is why
we introduced the Java type because with
Java type you pass the fully qualified
name of a class you never pass in a
package and it either exists at that
point or it does not and if it does
exist then you get the class back if it
doesn't exist you get an error right
away and it's not even slower because
you don't have to create and work
intermediate objects with this guy with
java.util.arraylist you are doing three
JavaScript getters one for Java one for
you til one for a list with this guy
you're doing well too and a call java
then Java type and then an invocation
with a string it is actually faster you
can even invoke new directly on these
values that you get back as you see in
the last line of the slide it gets a
little bit awkward because of the
precedence of the new operator with
regard to invocation so you need to like
bracket everything but it also supports
Java arrays so you can save our inter a
equals Java type in square bracket you
can you can go while then you can just
keep tacking on square brackets at the
end if you want multi-dimensional arrays
this and once you've retrieved it as a
type you can just use a constructor with
the length to create new arrays back in
the Rhino days the only way you could
actually get to an array was you had to
go and use a reflection you had to use
and the size I mean and now you can just
use new into a 5 after you retrieve the
type okay and we circle back to security
for a moment because so far the story
was that we only allowed access to
public mag members of Java classes Jack
how are we fighting for time good you if
you are running in a security manager
you won't be able to access classes and
restricted packages so Sun misc JDK
internal whatever it's off-limits it's
actually stricter than job at the
conscious decision so far all these
restrictions are only in place if you're
running with the security manager though
if you are not running with the security
manager then you know your script can go
wild can do anything you can invoke
java.lang system.exit if you want to
write if you're running on the security
manager it won't be able to invoke
java.lang system.exit unless you
specifically permitted we are not
inventing a new security model phone ass
horn we are going with the Java security
model because every nice horns ova
script file gets compiled to a byte code
which is a java class we preserve its
source URL so whatever JS file it came
from if it came from JS file and if
you're using gel with the security
manager you can just normally declare
Java security policy with additional
permissions that you might need for your
script otherwise if you're running a
security manager then this thing is is a
sandbox it is heavily sandbox because we
just don't want mass want to be the VA
be a vector for any security exploit we
have very conscious about that to wit
all of our tests are always run under a
security manager so all of the nice one
test suite is all the time ran with the
security manager and we all of course
also have security tests that are
expected to that that have a negative
outcome right so nASA has some
additional security features you can't
access class class loader anything in
Java language for package invoke
packages
except if you give your your code the
NASA on the Java reflect permission
that's a new permission that we
introduced if you give this to your
script file in a Java security policy
then you will be able to use reflection
there is no permission though to access
classes and restricted packages but you
can get around that if you give you the
reflective permission then you can use
Java type to reflect or manipulate these
objects but we are making it's really
hard to do that I mean it's allowed if
you gave it that permission by just you
know be very conscious if you script run
under a security manager absolutely need
to use reflection then there is a
permission that you can give them on the
other hand if you're not running on the
security manager or you are but you are
not don't need to do any potentially
self-harming maneuvers with your code
then just don't worry about it yes I
believe that's also all right this was
the agenda so how do you interrupt the
java objects how to extend java classes
but fun with type conversion
specifically arrays we touched upon the
how do you handle statics how do you
create a handle inner classes why Java
type is a better idea than just using
the stepping-stone approach to reaching
classes and they talked about security
now everything that i said is available
at that URL so jdk docs technotes guide
scripting index.html and if you go to
the openjdk java net projects nass horn
you will get a root project page it
doesn't contain a lot but it gives you
pointers to the mailing lists and blogs
and you can normally if you subscribe to
the mailing list you can reach us there
so if you have any further questions
then that's say that that's the right
way to ask all right so that's all I had
thank you for your attention and feel
free to ask
all right questions well all right sorry
the question is what have I built with
this so far I haven't built anything
with this so far because i'm busy
building it well for instance avatar ojs
is completely built on nasa the question
is the what was built so far on mass
word well avatar avatar Jas is is a
fully built on mass horn it uses an ass
phone as its as its runtime and you know
it's just the it's just the full just a
full server side the environment that's
basically API compatible with the other
framework we are not allowed to name and
that's the that's actually working
pretty well and that actually uses a
well at least used to use a well still
uses a lot of lot of platform
integration so as you can imagine it
does use the Java JavaScript bhandary
quite heavily to reach down to our
platform services although these days it
actually tries to work with tries to
integrate native Libby UV libraries that
all unmentionable framework
implementations use so but yeah I think
avatar Jas is actually the biggest thing
every now and then we get to get emails
and things from enthusiasts who are
writing us about about using that phone
to build things but I guess I mean this
is yet unreleased product right I would
not really expect people to MMM already
create a product level so production
level software built on a sworn I make
sure slightly threading this because
it's one of those how my baby is going
into the wild I hope it will hold up i
mean i know it will hold up but still
goes we hang xiety rushes from time to
time so yeah all right so avatar jess is
really the biggest thing that i can
point you to all right yes
yes you can download it from yeah that's
right it is included in openjdk it
separately forest within the openjdk yes
yes it is so if you just download the
standard edition snapshot so be 108
whichever is the the the most recent
then asshole is in it it's a dejar is in
JRE lib ex-directory and jjs comment
line launcher is also there yeah it's
been in since be 94 I think since March
or so yes all right do we have intention
to the client-side things with this well
once this is released and you might be
running java 8 in your browser then you
can write an an applet that's using this
on the client side you can use it in you
can use it in a desktop application i am
really looking forward to the day that
somebody builds a mode where you can
when you can script minecraft with mass
horn so as for if you're asking about
like a browser engine we don't expect
that I mean somebody is free to build it
I mean you can you can actually I there
were I know about attempts to too I mean
there's WebKit right thing that runs on
is a firing chrome it has a pluggable
pluggable architecture for runtimes I
don't see a technological obstacle to
actually integrate nass horn with WebKit
and then you know have a browser that's
using this phone to run JavaScript I am
NOT saying that I see a lot of point in
it but it's definitely possible but we
don't but Oracle as such don't at this
moment I am not aware of plans for that
Oh a headless browser yeah well you have
these things like HTTP unit j you need
that were used for that were built on
rye now there's I think those projects
will actually find that it's very easy
to swap out Rhino for for NASA own in
that environment so having this head
think
well no I mean applets an asshole are
orthogonal technologies really you can
use Nass horn in an applet but in order
for JavaScript to replace applets you
need to have the browser running your
JavaScript so and and as I said we don't
have plans I don't know whether we have
and don't know about us having plans to
to have a browser that's running nass
hornets but you know if an enthusiast
comes up with it more power to them okay
no it's thank you right any more
questions well I mean really that's your
documentation with the scripting guide
which contains most of the things I told
you which is specifically there's not
really a pis we are using the Java X
Script API that's our public API there's
no other public API you're just supposed
to go to Java x script we require
request a script engine factory for NASA
horn and then create script engine
instances for it that's that's your API
there's no separate API phone ass one
okay all right thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>