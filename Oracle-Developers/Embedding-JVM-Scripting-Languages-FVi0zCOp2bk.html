<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Embedding JVM Scripting Languages | Coder Coacher - Coaching Coders</title><meta content="Embedding JVM Scripting Languages - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Embedding JVM Scripting Languages</b></h2><h5 class="post__date">2015-06-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/FVi0zCOp2bk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so welcome to the session about them
bearing the scripting languages into
your java apps I wonder why you came
here maybe maybe you want to learn
something about embedding or maybe about
something something about scripting
languages or maybe about JVM so whatever
it is I hope I will not disappoint you
my name is anton i work 40 turn around i
blog I spamalot into Twitter so if you
want to follow me just do that and you
get your portion spam here is one
sponsored slide i worked with zero to
none like I already said and project I'm
of all involved with is terrible it's a
development tool for java developers to
skip redeploys in development
environment and actually you might be
wondering why why am I talking about
scripting languages while I'm working
actually on a tool for developers and as
it turns out that the subject or the
stories that I have with scripting
languages actually predate and kind of
really related to durable by by the
nature of of the use so in no particular
order we have some stories to listen and
we have some some technical details to
take a look at and let's proceed so i
will first tell you a couple of stories
that really date back to maybe 2006-2007
so before my work I'm durable I I hadn't
had some small projects and one of them
was writing Eclipse plugins and at that
time my computer wasn't really good to
to be able to start one eclipse but as
you know when you're developing plugins
you have to start two instances of the
same ID and it was quite slow when they
had to work with the why I had to make
changes every time I had to restart the
the workbench it was quite kind of
annoying and so I thought maybe I could
use freak scripting languages too
we re-evaluate the logic and you know
refresh the workbench without without
restarting it turned out that at that
time I was eligible for google Summer of
Code program so i took part of it and my
project was like my my the intention of
the project was to create kind of
ability to write Eclipse plugins in
scripting languages I kind of succeeded
because I created the plugin but I kind
of failed because it didn't really serve
the purpose for my initial problem so I
ended up with a proxy plugin that could
execute plugins for eclipse written in
groovy and Jay Ruby and it's still up
there somewhere in the oil in
sourceforge if you are interested you
can take a look at but it's a very small
project another story I have our
afterwards in a few years I was working
in a finite financial company and we had
very very standard enterprises system
which takes some data from one place and
puts it to another place and it had to
apply some kind of rules like if X in
one system is one and if X in second
system is to take X from the third
system and put it to the fourth system
right kind of integration of engine and
so we we actually started by
implementing those rules in business
rule manner we implemented business rule
management system and it kind of worked
but it was very domain specific
application so the management system had
its own UI which wasn't really clear for
our business users so we ended up
rewriting the UI and the the data store
for the rules was was proprietary
basically not not not in the format that
our system administrators would like to
have so we ended up porting the
store as well so at the end we just had
a roux engine which basically executed
the rules which were stored in our
datastore and those were outlawed
already also with with our UI so it was
too messy and we just replaced that with
groovy script of course it was actually
a failure because we didn't realize that
we don't need rules we need the ability
to change logic without releasing the
system right so if you have a release
cycle of six months and you need to
change the way you handle the rules
tomorrow then this is a good very good
way to you know to change the script and
change the logic of your application of
course you need some governance for that
but that's a different story so why
would you embed script actually scripts
are everywhere if you take a look at the
software that you you're using not only
Java software but other stuff as well
all kind of different scripts are used
there and depending on the domain of
application there might be different
languages for instance in electronic the
main electronic design application tools
or automation tools the the standard de
facto standard mystical and for
historical reasons Titan is there in
weblogic and websphere where you can
automate the tasks with the script and
obviously you run the overrun javascript
in browser so there might be different
reasons why you do that maybe just you
want to do that you because i can write
because i canít attitude is probably
the most popular one but actually you
can provide the users with the ability
to customize your system maybe to
integrate with your system and if you
have disability then you obviously give
them the ability to
to automate 13 tasks between the systems
and the use case i already mentioned the
life updates when you just change the
script and boom the new logic is there
in your application this is a very good
reason to have it so we will start with
the standard thingy which is building in
java since Java 6 the scripting API and
we will proceed to some other use cases
which it doesn't cover so how many of
you actually know about Jace are two to
three it has been mentioned like almost
in every session this year ok one third
of you so this is the standard API
built-in in Java you don't have to
download anything you just improve the
package you have the entry point for
scripting engine manager and from there
you get an engine by the name or by the
file extension or how may be in other
ways and then you can just pass other
scripts or strings which represent
scripts I into the engine and it will
evaluate it so this is the very simple
piece of code here or and then you have
a kind of api's for passing in the
scripts either file or through the
reader and you can good actually pass
the variables in through the building so
it's a standard thing how to how you
pass variables or how you get them back
from the script so it's basically a map
you put some name of the variable and
the value and pass it into the scripting
engine scripting engine evaluates your
script Vince the variables performs the
calculations executions and so on the
same could be written a little bit more
concise way so here's the script for the
previous Java code snippet so I could
just print out the
variables from from nowhere but they
were injected into the script by a
building so I have them right there or I
could assign any variable inside the
script and bystander it should be placed
into building nap so if I if I if I
create any variables in NJ sr22 three
compatible language it will be put into
the context one interesting thing here
is that how would you return the result
from the script is that you have the
implicit return statement at the end of
the script so if you just have a
statement which just states the variable
there it will be the result of the
script so I could just you know execute
the script and and as a result I will
have this last last statement my script
we go further so far we had all the
descriptors that were like you know
statements in the file but now we could
create objects actually and assign
functions to the object so this is the
JavaScript example I create variable
objects and I assign two functions and
then in in my java code I could use the
in vocal interface to actually access
those methods within the script so I'm
actually mapping or not mapping but I
get the result object from the script
and then I could execute the methods
that were created during the evaluation
in the same way basically I could map to
a real Java interface so if I have a
function which has a name run I could
obviously map it to the runnable clause
because the signature matches and the
API allows me to to actually map to the
interface and another interesting script
is compatible the problem with invoke
about and compiler
is that every scripting language has the
Liberty to implement or not to implement
those two interfaces so you may use a
subscription engine which doesn't
provide those interfaces and then you're
screwed then you have to use some kind
of language specific indications but
most of the language mode of the popular
language is actually provide those
interfaces compatible interface gives
you the ability to evaluate this script
once and then without evaluation just no
reuse it so you the performance hit will
not be that big one one question usually
the users usually ask or how do you
restrict something being executed within
the script for instance if you provide
users the option to write scripts for
your system without your control how do
you ensure that they don't write any
vicious code like system exit or runtime
halt and this is actually a quite a
tricky question because by default you
will not find any option for that in the
original JavaScript engine right now
developed by Mozilla they have this
option as a class shutter basically this
API allows you to customize what kind of
implications you have seen you we want
to allow or not but if you go to Jace
are two to three then you don't have the
access to shut applause however the
built-in engine actually makes use of
this shuttle class and it matches the
security manager to the shutter so
actually you you restrict your users
from writing malicious code with the
security manager and in here this is
just another option to declare the
scripting engine manager you could pass
in the class loader and the class loader
will be used to load the scripting
engine and obviously run the scripts
another
is the load the classes that you use in
the scripts so with your custom security
manager you could customize the class
loader and restrict the users from
writing something bad so the API is not
big it has been around for four long
time already it's pretty well known and
but but but it lacks some capabilities
or maybe some advanced capabilities and
if you are not really switching between
different engines at runtime between
different languages I would I would go
for just embedding the language directly
without this abstraction so you have two
options you can use either the standard
interface or you import directly any
language like either groovy or JRuby or
maybe you just embed JavaScript directly
without this Jace are two to three
interfaces let's talk about Drew II who
likes Rui make some noise fine ok
basically groovy could be embedded in
three ways you could use the same chase
are 22 free to embed it and it's pretty
simple doesn't differ from from
javascript in any way another option is
to use direct embedding and there are
two options we either use groovy shell
and the API is very similar to to the
standard one to the standard interfaces
you also have buildings you also have
like like a map inside the scripting
engine and the second option is to use
groovy class loader directly which is a
little bit more low-level API and say so
all together you have like high-level
api's like the one from the interfaces
from normal jsr two to three and then
groovy shell and both of them makes make
use of groovy class loader
so let's let's have an example of a
little example of life reloading
actually so suppose we have this simple
interface here and we map it to the
groovy script on the right which
basically has two methods that will just
print something in the output if you
like you can go to the block the link up
down there and read the full blog post i
have blogged about it about several
months ago the link is too too too too
long so you probably just to find my
slides afterwards so one option is to
map this script to the interface via
dynamic proxy it has its own good parts
and it has its own bad parts the good
parts is that actually you actually have
a fine-grained control how you actually
map the interface to the script and the
bad part obviously the code is ugly so
you get the ovulation result from the
script you map it to the interface with
the proxy and then you have an option to
delegate the calls from inside the proxy
maybe you want to check some security
options maybe you want some logic for
your own dispatch and so on and then you
could you know just call the methods on
the interface since you since it's
already compiled in German but then
there is an option to not to use proxy
if you if your last statement will be
this as engine that that's a groovy
construct and basically you don't have
to use proxy the code will be kind of
smaller and you will not really have a
dynamic proxy you'll have a groovy proxy
as the result
and but it has its own problem as well
so considering life reloading for
instance if we if you use that example
when we have an engine interface and the
engine script and we evaluate it first
and then imagine it's a live system at
some point of time you decide to change
change the script logic somehow and you
want to reevaluate just for simplicity
we think that we change the file and if
the time stamp changes we reload it then
the problem there is that if you use
this statement at the end it just
crashes you have no option to choose
this one so you have to go back to the
proxy or there is an option to use
compiler configuration which you can use
which is the API to customize processing
of scripts of groovy script so the
compiler configuration is actually
applied to script object so you have to
have this script interface or a script
script plus two to apply this
configuration and then you basically
pass it to if you set it and you pass it
to the groovy shell after evaluation of
the script you don't have to cast it
inside the script and then you don't
have to have proxy as well since the
relation result will be can will not
have it like classcastexception so it
will be the same type but you can
actually go further with compiler
customization and let's say you want to
define some imports by default so there
is an API called import customizer which
you can use to add some imports by
default for instance you could import by
default some class class list or or you
could add the full package or you could
invert old
static methods and then you just
configure or pass it into the compiler
configuration and the the rules will be
applied when you ever let the script so
if you go back to the problem of system
exit right if you write some code which
you don't or your users might write the
code which you don't like to execute
then there is also an option to use
secure HD HD customizer and this
actually shows the real power of groovy
HD transformations where you basically
can match all kind of constructs in the
script and decide whether you want to
execute them or not so or there is
another option to like to use the
expression checker so you just check if
the class name is system and if the
method is exit and then you either
execute it or not right so all kind of
options you have to customize your
execution was it too scary maybe it was
but you know if you provide users with
the ability to write plugins for your
system without checking then well your
system might go down you probably waited
for me to to start comparing the
languages it wasn't my intention
actually so comparing the language which
one to choose ah you basically can pick
any of them to implement this kind of
functionality and dynamics in your
application obviously the first choice
would be like whether you like the
syntax or not but there are actually
some other options that you might be
considering first of all inter
interoperability if your language
actually works well with Java there is
easy to call java from your script or
the script from Java where you have
you can customize the execution
conveniently and so on another option if
you actually need to write or or does
the language provide capabilities for
writing concise rules or statements and
so on so groovy is very good in that
ruby is very good in that and if I was
considering this argument probably those
two languages would be like at the top
of my list security again as as you saw
we have sometimes we have to restrict
the users from writing 13 parts of the
code so this is a big thing to consider
in groovy rules in that and math if you
have financial calculations you
obviously want to calculate decimals you
don't want to lose the precision and if
you take a look at different languages
at this at this stage only groove is the
one where you write zero dot one and get
the correct answer so the takeaways
scripting is cool it's easy to use live
updates is probably the biggest argument
that you want to consider when using
scripts and yay groovy I'm taking ready
to take your questions I didn't waste
that much time this time so any
questions
yeah yes yes yes yes well as far as I
know if you have attended a mean-ass
horn sessions this time those guys
saying that you use you have to use
security manager right and what I was so
talking about is rather if you could use
13 construct in your scripts so language
constructs and an API are different
things so you don't want the users to
call system detects it that's one thing
that you restricted security manager if
you want to restrict your users from
writing spaghetti code that's another
story right does it answer your question
no
okay not that I know of
that's okay I probably should go back a
little bit and show the life sample as
well the most interesting one probably
was the life life reloading and here is
the script and you see the two methods
there it passes back the itself
basically to the evaluation and here I
have just a simple simple example that
you reading the script you apply the
compiler configuration as I showed just
to avoid some mess in the code maybe you
want to restrict it lay there later and
using the groovy shell I will be
reloading the script once once the type
x sub changes so if I modify the file
and it sees that time some changes if
you'll reload the script again and if we
start make it run
so it now prints in the loop to be
printing some statements and if you go
back and change something say hello to
our one yeah so we see they just picked
up the change and everything's good yep
the question
if there are any recommendations for you
I to embed the scripts what kind of you
are you you think of is it web UI or is
it web UI well if if we go back to the
to the story of business or management
system the rules are actually written in
scripting language but then you'll have
all the UI on top of that because they
generate a model and then generate this
script language which is a rule language
and then they just execute it this is
one option another option basically what
we did is just a text box right syntax
highlighting if you if you have read any
blogs on programming you have seen that
people are actually highlighting their
snippets right so that's the only thing
I have seen so far then this will be
pretty much the same well the validation
will probably be performed on the server
side not on the client side let's
comment
maps google app engine application that
runs groovy and table is it has very
place interface
yeah so JavaScript pager with highlight
otherwise
alright you have any more questions yeah
yes
there is the various one right right if
so the question is whether I could think
of any other options or any other use
cases so in flight updates it has its
own problems and as you said if you
implement right and if you use if you
are using just check out the language no
libraries maybe you will be able to do
that but if you are using other
libraries like clock for J hibernate
spring whatever then I'm pretty sure you
have ninety-nine percent of failure with
life updates okay you have an option of
release right you can organize release
without downtime for the users but this
is not this is this is the problem i had
to organize the release i could do it
twice a year alright this is very
expensive and for a quicker operation
let's say you have a new campaign for
marketing you start giving the mortgages
for two persons who are over 21 and and
tomorrow it should be over 22 very
simple thing of course you can customize
this kind of rules maybe just in the
database but it's not always possible
only declare the numbers you probably
need some logic in checks as well the
question there
do that
up
so if I understand your question
correctly or comment correctly you want
your users to write JavaScript and your
engine will be just executing those okay
the question for that the question the
answer for that is that if you want to
write a Java expression then groovy is
java so you can write a groovy script
which is basically jello right yeah
there's the other kind of danger where I
stupid yes there isn't one I was talking
about groovy HD transformations I know
that there is an HD transformation which
is checking for potential infinite loop
and can drop that yes could you repeat
that you get the question killing the
misbehaving script haven't tried that
well one option is that if you execute
those things in threads then you might
you know with debugger go and kill the
thread but it's not very safe of course
four months i'm not sure if i am sure I
understand the question so
yes it caches you don't have to
recompile the time of course then it
depends actually on the engine some
engines don't have any difference in
evaluation and compilation so for
instance if you if you use direct
embedding of groovy actually I think it
doesn't really evaluate the script all
the time ok thank you guys</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>