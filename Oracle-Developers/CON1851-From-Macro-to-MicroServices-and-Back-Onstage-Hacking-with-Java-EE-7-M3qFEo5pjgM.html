<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>CON1851   From Macro to MicroServices and Back: Onstage Hacking with Java EE 7 | Coder Coacher - Coaching Coders</title><meta content="CON1851   From Macro to MicroServices and Back: Onstage Hacking with Java EE 7 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>CON1851   From Macro to MicroServices and Back: Onstage Hacking with Java EE 7</b></h2><h5 class="post__date">2015-12-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/M3qFEo5pjgM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I think last year we were in the same
room different topic and it was
incredibly full last year and this year
is normally full so last year it was
like completely overrun and I delivered
a session which was actually not planned
someone asked me about this this was the
community session at Sunday with similar
topic and the problem was I I corded one
line and i got i don't know several i
don't know 50 questions or several
hundred or whatever so what happened was
i answered 45 minutes questions and
after the session another one hour so i
spent one hour in the rooms or what
lessons learned is there should be
almost no questions right now so you
won't get any t-shirts for the questions
because after the session there is birds
of feather and in the same room and you
just questions so save the questions for
later and the next session this is half
an hour in the same room this is a java
ee q and a and you can ask me whatever
like architecture d TOS dollars this
another session is just for questions
okay I'm a freelancer start with Java in
1995 and still like it so I'm really
curious if java is going to be 40 in 20
years whether I'm still the same opinion
but right now everything is fine still
and all right the block is more like a
notepad so it's like we them not to
forget things I've write some pieces of
code I to save time I organized a few
times in year in own in Munich never
somewhere else some Java Eve workshops
and they are the next in December have
some attendees from USA Saudi Arabia
interestingly and and Costa Rica and all
of Europe of course but this is
interesting so this ax news is like
mailing list or or a meter spam like I'm
from time to time once a month I'm
writing about events like at this but
nothing technical and effective Java is
our online course so if you're
interesting how to build pragmatic java
applications you might like it and x 2
v's afterwards so this is what usually
happens once a month and so ok java one
could be also interesting these are the
workshops this is the other one and this
is the sessions and this is the last
slide so um and
so we save some time already and I tried
to thought about real-world example and
actually in the session before this were
a great mass phone session so I wasn't a
session and I got actually an example
where we build several years ago eight
years ago micro service without knowing
it and we were forced by the law to do
this and the problem was a number
generator had to be certified you can
imagine what kind of industry it was
right and if you wouldn't separate the
service we would have to certify the
whole software which is mission
impossible so we had to keep this
certification part as small as possible
at this could be an a no service because
the functionality was stupid like get me
the random number it will actually one
method but was it was extremely
important to make it fast generator
which is as small as possible to make
the certification path and the
certificate the algorithm was quite
complicated so we need to provide
monitoring gemach stuff so actually
occurred to me it was our micro services
in about in two thousand six or seven
without not knowing it so most of the
micro service they are building without
knowing this the let's create such a
micro service from maven archetype and I
call it ID so we safe already a few
bites of code right so this is the palm
should never grow what we add to the
palm from maven is a view test
dependencies usually but usually what
what standards gene is more kitten
nothing else what's prohibited in all my
projects microservices are not our
runtime dependencies you will have to
justify why you need them so before you
are not downloading to hold apache
commons or whatever you will have to
think twice because each dependency
causes problems problems means you have
to maintain all the versions and
actually care about the dependencies
which it doesn't come for free and i
have a secret agenda behind this so I'm
the less dependencies we have the
smaller the war the smaller the word the
faster deployment and fast deployments
are extremely important to me
so this is why I like small Wars so this
is actually the main reason it's a
larger the war the particular end okay
we'll see later or deploying whatever is
network-related the larger the year the
diverse it gets so because I do it all
the time there's a bin 6ml which
basically enables dependency injection
everywhere so we can use just poachers
and eject whatever you like with EDD
inject this is the this is the thing
here with java 7 and i could also say
annotated many claim it's as fast as i
get is faster but if you measure the
performance it was never probably my
projects and non means there's no
dependency injection know or you have to
declare the classes explicitly and what
also happened behind the scenes jax-rs
is configured because all my java ee
projects use jax-rs endpoint what jax-rs
does it expose HTTP services hopefully
they are restful not RPC but it's just
HTTP ok hopefully no questions of our
ride you have very short question you
can ask me but very short one so if I
can you know just answer yes or not so
um this is allowed ok a hex saw this
name and usually I think a lot about
packages package names and this
shouldn't matter in this in this course
in the intercession so and ID IDs
resource and what I just we do is the
boundary because it looks strange so I
these resource and what would be
sufficient to have here path IDs and we
get the ID and this is going to be get
return certified this is the first test
it looks good I would try to run it
remember I using pyara so what is pyara
is like page glassfish so there is a as
a bubbly no Oracle doesn't support
there's no commercial support for for
gas solution anymore and many of my
clients say ok what do you do right now
and fifty percent migrated to white fly
the other
tu pyara pair as a company from UK what
they do is they patch glassfish and get
on github so therefore glass wish to
github so everyone can contribute they
have lots of patches and my clients are
able to buy commercial support sls and
whatever so and because this makes no
difference you will see it acts like
glass fish i use pyara because it has a
higher eclipsing version and so forth ok
so i go pee from them they are not
completely unbiased but so I'm resources
and what was it IDs or ID you know it
IDs IDs so it works so the first
microservice so usually what i would
like to do is something like is it is it
this i always forget the new you you you
you you ID right no this is a static
method this is what i always forget here
and what was it random uid to string so
and this was something like this with a
little bit more elaborated so the
certification would be right so I'm but
so because what you would do this was
crazy complicated so I'm really it was
not like this and I forgot actually what
was the real problem but I know there
was a problem so we create a you wait a
second you ID generator and the ID
generator has actually the method here
and this is best practice and I need it
on purpose so we have this here and this
gets injected inject what was it ID
generator generator and what I would
like to do is generate a Dodge ID and
say here just prefix j1 that you see
something happened so this won't work
and it stateless or request code or
whatever to make usually stateless for
performance this is a good idea because
they are pulled if they are pulled /
instances injection happens only once so
request scoped it will be jected all the
time this is petey is not saved right
very good so you have always safe even
the microservice world saving is crucial
so um so what why I did it this is
actually real world if you would like to
test unit test ID generator and you will
put the code here you will have to mock
all the all the usual you have here no
HTTP context and HTTP headers or
whatever and there's a lot of work so
this is our best practice to split them
but let's imagine the ID generator would
be very slow and you won't like to block
the threat from from from the server and
even more in microservices you have to
be how it's called not exceptional not
handled you have to be resilient always
a nice we have the exception handling
two thousand and now we have resiliency
so they have to
be resilient so what it means usually
you will have to set up a pool and say
no more than five requests otherwise my
server will die okay so what we can do
right away I can say the following void
async suspended so spend it acing
context context and then i can say
context dodge resume so no resume async
request sorry i think response response
response resume and what i can do i can
just send this back or actually a
response but let's do justice to adjust
generator
generated or was it ID and usually I
could also pass the response but let's
save time so it should work the same way
so it works now it's asynchronous so a
little bit crazy because it what means
asynchronous it only means the method is
will complete and the server will still
maintain a connection to the browser so
we gain nothing right now it looks a
little bit more cool but no gain but it
the observation is the following so
let's I would just change that so what
we could do here I could say or this is
actually
consumer of objects
got it so i implement an interface so
this is a method handle resume it
consumes objects the method name doesn't
matter okay the generator is eid is what
supplier of strings so an worry could do
would be cool to create a pipeline so i
would like to chain them together in a
thread pool it's done in java it Oh what
I what I forgot to say oh I said it
already right dependencies are evil so
if you can achieve microservices without
any dependencies do with the perfect
case so and what I like to do I try to
leverage as much as possible Java 8 if I
cannot find anything I searched further
in Java EE if there is still nothing
then think about external library is not
like searching internet first ok so I'm
completa bellucci cool thing supply
async supplier then accept consumer done
so now it makes sense and it's
asynchronous but not java compatible and
unstable so unstable means if I would
SWAT i will start many threats i will
get as met the application server will
maintain all these application service
threads internally plus all threads
started with 40 and framework so what
happens we under seized incomplete able
future uses for current framework with
default setting and I think the default
setting is like number of course twice
or just number of course so ok so if you
have many course you could have a
problem so how to fix that at resource
managed executor service mes managed NX
executed service is an incredible
interface from Java EE very complicated
it just extends executor service nothing
else so it is an executive service java
8 so what it means we can pass now the
manage executor service here and now we
build a pipeline with three lines of
code fully asynchronous which chains a
supplier with consumer and users managed
application server threats and I could
open the console from pyara go to the
default default executor and set up the
number of threats okay three lines of
code no questions right what we could
also do I could say response dot
settimeout cancer ok if this takes
longer then one day then I can set a
timeout handler
and the timeout handler gets the
response and I could send HTTP status
code whatever asynchronously back so
timeout is handled gracefully so even
the de client site will no longer wait
longer no more wait longer than one
second so in this is lambda so you can
write clean code with plain Java and
this you will say of course a little bit
nicer like a question so far and what it
could do then is to say response dodge
status and find appropriate one no time
then 500 I think this this daily but
there's a dead log the same happened
yesterday no 503 ah yeah service
unavailable thank you for this so you
get a t-shirt afterwards so this is you
can do and I get the response are and
then I could of course say here response
dot resume our
full asynchronous are handling the nice
story is what I can do here I can even
reduce their function so if the
exception happens in within the pipeline
I can also react to it so as you can see
I already reach with just Java eight
eighty percent of all the flow frame box
and then I story is I've come to a due
to come into a project and they show me
you know five microservice frameworks so
have you ever looked a job aight no then
first thing download something from
internet because they were on at
conference right came back from java one
and and and take five gigabyte
frameworks and try to deploy it as a
micro service so um so and then accept
so exceptionally i would just keep the
exceptionally because i will show you
some so exceptionally i would have to
register by function which resists is
nothing which every returns nothing and
i would just pass the response to the
handler and i would throw five or three
or whatever so i will convert the
exception to HTTP status code so i would
skip this because we want to learn
anything new i would just look whether
it still works yeah it still looks good
so um now what is the next step I'm oh
the next step is hystrix the problem
list um what we will have to do in a
micro service environment I would have
to deploy in Dhaka glassfish open the
console and change the settings or I
will have fiddle with XML to set up the
thread pool settings and what's with
monitoring what I would like to know is
no is this is this red pullover loaded
what happens on overload back pressure I
want to have to set it up so this is and
this is what basically historic stars so
what I did I looked at the problem it's
okay how the implementation would look
like with javi and I implemented project
porcupine which is my github account and
they are basically five classes or even
less
five and what they are just doing to
adjusted some statistics because
everything else happy to application
server i have already thread pulls i
have managed threats the only thing what
I can do execute a service part of Java
I only implement the monitoring stuff
and I would like to include the
porcupine here dependency power Q Prime
and this pie version I show you why
porcupine porcupine so now i will like
to rebuild us i'm using maven yellow
already show you this and the only
difference is and go to the ID resource
and say this is now add inject qualify a
dedicated and this is not needed
yeah and then I will run it and
hopefully it will work still works and
now the funny part is or find a useful
part is that nothing happens this was
was this pie yes it actually what I'm
expecting is is the following what it
should have it should inject to the
headers because this pi Edition all the
all these statistics so this is what it
does
id3 resources IDs so this looks nice
here and here okay all you can see is
adjacent like structure what do you have
the pipeline name is mes so what it
actually means convention of a
configuration the name of the thread
pool is the name of the field if I don't
like it I can override this with the
simple qualifier and specify the name
the value whatever I like so if I say
there's not a porcupine but pick and go
yeah I probably would get to because no
even virtuous pic so I and now
redeployed everything and reconfigured
the DD pool and what I of course can do
do I can inherit from configuration and
specify whatever like okay so these are
basically the five classes where i show
you i will use it in production to
monitor the stuff and now if you yeah oh
no questions it's very quick one varies
faster it's not measurable but it costs
something so how it's called a haizen
Heisenberg principle right there is no
no no measuring without impact so
usually if we need monitoring the
applications have different problems i
would say so last week I was in project
they call the transaction that it took
one minute you know so then the header
who cares about headers so no questions
yeah so uh very good we are very fast so
far very productively should remain the
same so TM now the question is what
about back pressure and all the stuff so
what you can see here is we have the
following we have executed service
expositors the the thing and number of
total number of tasks is one and so now
is to there are no exceptions remaining
keuka passes on 100 completed tasks
count is one and rejection execution
handler there is one handler which what
it actually means rejection execution
handler so what I thought this
we need something like what happens if
the pool is full right what would be the
simplest possible solution to the
problem hmm what do nothing yes but
where it is already solved in jdk the
standard execute to service a different
rejection policies I think the name is
rejection policy hopefully so there is
an object rejection but it gets sent but
there is a rejection policy no something
like rejection policy in the executor
service and you have three strategies
out of the box run a Iraq calls in run a
threat policy it means if the threat is
pull the next invocation is going to be
synchronous then discard policy it means
if this threat is overloaded the request
is get going going to be discarded and
and then is discard first though there
are I have to just invoke javadoc and
search for this but it is old since JDK
15 so this is always there and because
we have Java EE what I did is the
following I said okay we we have another
policy if the pool is full a CDI event
is thrown is the statistics and you can
receive the event and you have the
context with the statistics and you will
get this and you can react to this so
the funny story is it is already solved
in jdk 15 back pressure you can call it
back pressure and Inge a decade what's
called Colin run policy or something
like this yeah how is the name of the
classic atossa t-shirt of course there's
no question is just the help the you
hear you yeah discard policy yeah
discreet perfect so discard all this
policy and there are different abort
policy and color runs policy this blocks
so we have back pressure
this aborts and this discards abort this
exception this discard is it just
forgets questions okay Zen move on the
last last week in a project someone
asked me we have to you have to invoke
soap services which is already bed sign
and they they use metro and sometimes
because of a namespace resolution it
blocks for unlimited amount of time and
or item for overview seconds or for
human is no one knows how long and and
the problem is it would block block our
threats how to deal with this and what
I'd tried of course they used at
asynchronous and this would make even
verse the old situation because it will
start more and more threads until the
service dies so what we actually need
weed a solution for this problem and
what I suggested is what we need is a
singleton java ee singleton which
doesn't block and it should just
implement a counter and on the first
time out it will increase the counter
and after threshold it will just stop
receiving the getting the requests and
we just omit if counter five then don't
call different metal anymore and of
course for this counter there is a
pattern called how what circuit breaker
so at every current that will look
there's a circuit breaker break apart
pattern and then a sec okay it's
actually stupid to implement as a
singleton so how as such as a circuit
breaker would work so imagine this is
eerily not reliable we watching lava
lamp and sometimes we got to know a nice
number or sometimes not so how to
implement this we would do something
like singleton concurrency management
beam so there's no locking so we have
one resource and this is somehow if we
do this we can do the next step and the
next step is creating a class called
break
so just keep the secret so and it
returns an object and break no this is
watch invocation context I see throws
exception so and what you would do is I
cidade proceed I see that precede return
so this is our No up breaker around in
vogue and I just exception e and say
here in counter it shouldn't be long I
think it should be sufficient
and we throw throw e and this should be
0 so now what you can of course do is
say if count equals something then we
don't call the method anymore and we
just return null which would work for
void met on the three other methods so
the simplest possible circuit breaker so
and the counter should be of course here
when it shouldn't be static why not and
now comes the trick we have a single
near and such a resource are usually
singleton and the Interceptor belongs to
the singleton so it's the same scope so
there is one-to-one relation between the
singleton in the Interceptor so i can
count exceptions whatever in the in the
interception there is a beautiful
solution actually so what you can do
right now i can say just interceptors
breaker where is my beautiful I have to
save breaker
it will do this and just to demonstrate
that it could watch something I will
just return the method and see what that
works it doesn't what it should
as you can see it intercepts the call so
the trick is it has to be a singleton
why is the singleton concurrency
concurrency management been because I
don't like any locking so there is
multi-threaded singleton and the
Interceptor what it what it lacks is an
if statement so if counter equals bigger
five then do something and because i had
a jet lag i implemented this completely
as an open source project and i'll show
you the source code so we can save even
more time and this is called breaker of
course in shorter if you would like to
be successful just misspell something so
and see a lots of stuff here right this
is a so I'm call me X breaker and what
what I did I'd introduce it another
annotation very simple annotation so the
whole project are two classes circuit
breaker and you can if you like you can
annotate whatever method you like ignore
calls when failures equals two or ignore
calls slower than minutes ten period the
implementation is trivial so this is the
whole implementation of the Interceptor
this is why I wanted to skip this
because implementing it twice in one
week is too much okay and as you can see
i'm watching for the for the annotation
if the annotation is here i'm asking for
the failures and the millets and then if
counter bigger than max number of
failures then I return now otherwise the
method is invoked and what I can do of
course using a timer from JDK and wait I
don't know 10 seconds pass or view
minutes reset the time or whatever what
I will do this the full version I will
throw CDI events if the circuit opens I
could eject all the statistics again to
the headers again we have seven classes
and we have configurable connection
pools and now we have circuit breaker I
looked at the history it's because they
wanted to use it there were 50 max of
jars is more than this but ok why
because the assumption is there's no
server
questions oh no questions no very fast
fast one no so it would be open forever
CDI event jo mix or rest because this
what I would do and I would inject hear
something like a monitoring service
whatever but this is a simplest possible
solution and yeah and and if i start
with decreasing you know what the
strategy and how long to wait longer it
me or whatever yeah but you got the idea
ok questions so why the service is still
micro because
the whole idea is 24k the war soham it's
for each docker build it will be
extremely fast and if it is would be a
fetch our it would be at least 50 mix so
whatever nice technology are using it
will be never kilobytes it will be
always megabytes and what we do we
commit several I don't know I commit 50
and 100 times a day and i builded one
other times a day so it makes a two
different input activity whether there's
a fetch our or a thin jar okay now we
have 25 minutes right so we need at
least another service which uses this
one so i will use service which for the
what the service could do do is a
archiver know where a second calm ax
this one archiver / e of course and the
question is how they to communicate with
each other this is the one of the most
asked questions so i would like to
implement this right now so what you
could do you can sign archive the
resource which is
archives
all
so now what you can do of course here
you can check the race to a client okay
so how would you look like first
stateless then in it post construct
client build our client yeah build a new
client this client perfectly fine this
target this client towards target and
the early was this and what I get back
is the ID target so and of course what I
can do right now is to say ID target get
no request don't catch and let's go with
drink i omit t Jason I showed it
yesterday to jason is perfectly possible
and then just say archive I actually
wanted to write with jpa to a data store
and use the ID here as a business key
but it doesn't matter actually everyone
knows the jpa can store IDs so what also
skip this so and was a little bit of
luck it looks good actually it could
work will improve it so how we will
improve it this is ugly the whole the
whole configuration here resource says
archives archive with ID so we have to
communicated services the first question
I get asked in projects you know which
framework to use which member we have
too many right so this is two lines of
code so the problem is is not very nice
so what you would do usually in Java you
would say okay I have like connection
exposure
let's say this so and what you can do i
can say this think back here and then
say web target expose produce this
return this ID target and i think this
may already work so i can now say ed
inject web target ID target so and what
it means now it is completely hidden I
config configured it in on one place
right so if I will run it hopefully it
will work Safety's already so it cannot
go wrong resources archives so it still
works so and of course you wouldn't like
to hard code the aura here and this is
just the last thing you need you would
create a configurator which exposes
whatever you like injection point so
what injection point is this the meter
data of the field so i will have get
everything class name or whatever and of
course annotations so i'm showing a
second so I'm just to show you
configured Orey Orey + IP get get member
get declaring class good name so this is
class plus IP don't get remember don't
get name so and to show you how it works
out just say it inject string ID early
and just say here plus this ID hurry
ideally this was J plus plus ok I think
I have to rebuild us so I'm what's the
deal with that injects drinkin figures
or what it actually means this is of
course doesn't make any sense what I
wanted to show you is the following full
full qualified class name plus fully
qualified field name I can go to a
database data store etcd in Finnish pen
hazel cars whatever fetch the
configuration and now my application
there is no configuration stored within
the war with one line of code you got my
point so and what you can also do i can
ask here for an annotated type here get
annotated so you get the annotation back
so get a field which is annotated and
what you can of course to hear you can
specify in the annotation a default
value so default is this or e if there's
nothing but if there something your
database give me this so the point being
the most asked question about in where
we use docker and Java EE and micros
services like this is how to configure
things and the answers what we do is
that simple usually we use system
properties first and in rare cases we go
to add to a sequel database and resolve
this from a table this is more than
enough if you don't build in clouds if
you have thousands of instances this is
not usual enterprise project we have a
view service this is what we doing go
usually okay so this is why you know the
requirements from netflix and amazon
you'd usually completely different from
from from from an average enterprise
project and what I had fight with is you
know people come back from conferences
from Java one and they try to split the
you know I don't know Vicky application
into 50 micro services and expect you
know prodigy after this herb okay you
mean why so run it archives
archival resources I archives still
nothing what's wrong what could be some
tears are back sometimes that this drink
is not unique yeah this was so what I
would have to do I have to create a
qualifier Ori very quick interface it
will be needed anyway in real time
retention runtime it's important target
is method and target is method and field
so and this is qualifier so then I can
go to the resource and say it inject
early and I can specify here no yeah
good default URI
non-binding okay non-binding what
non-binding would mean is it doesn't
matter for the qualification is just our
configuration stuff forget about that is
advanced nano service stuff so so we
have early we have produces and they
have to match URI and now it should work
better hopefully how much done we have
15 minutes okay
still no
oh sorry now I broke it completely thank
you it is this one inject holy and this
is also completely wrong this produces
so we are producing an early and the
archiver gets injected the earlier
perfect so the question is what about
docker right so how to deploy this to
something like Doc and okay is a good
thing so I will try to the last time
still not
oh now it's this means we have to
restart the server is like really bad so
um it doesn't take a long time so what's
what's with how to deal with Daka so in
with Daka the following happens so what
I created they prepared a small image
called pyara hacks and this actually
represents a typical image of an
application and what it does it inherits
from so we have the essential Java image
which comprises the operating system and
the java stuff so what we have to hear
is it inherits from center at seven
which is in the central repository we
use JDK 8 update 60 and in n UW get
unzip antara and this is j DK and I need
a neater and last one for internal
automation why join the session I don't
know this week is about nice one so i
will show you more tricks with nuts on
the job eh but we need nice one for
automation is far easier than shell and
you can debug it even so the built built
the image and there is no run because
you can run the base image then the
payara inherits from essential java and
this is the installation of the payara
server so what we discussed yesterday is
the following this comes usually from
operations that they set up the
application server with all the Java and
operating system and we inherit from
from this so what it actually means if
you build a new docker image each build
will take twenty four kilobytes which is
really micro if you would use fetch RS
which for unknown reasons I didn't got
this tend to be a best practice you will
end up having 50 max / built and this
makes a difference ok now in continuous
integration you have one problem with
it is asynchronous whatever you start in
a docker it completes the deployment is
asynchronous everything is asynchronous
okay so what we did so what what I
implemented first um with application
servers like glass fish or white fly
what would you get is restful
administration service so what you can
do you can communicate with the
application server via HTTP and you get
HTTP response back if it's deployed to
underst so what it means you can you can
in the docker image deployed to the
server and you know whether they
successfully deployed it or not why it
is so important because only if it is
successful deployed the next stage in
Jenkins the next jobs triggers in so and
therefore we have the utility called
loader what audio just did it was just
too cumbersome to use the curl over and
over again I just implemented a
command-line interface a Java library
which wraps this and what it does it
deploys it waits until it successfully
deploy and then is able to either get or
post a request so so what it means in
our Jenkins pipeline we are deploying to
get it builds everything it builds the
did the whole operating system image is
built by the operations so it pulls from
the registry the image creates the
application image with pyara deploys
weights this is in the start so it looks
like not here start in PI R X start in
PI R X it looks like this so run loader
with the server deploy pink and if it's
deployed invoke this and this would be
the parameterised early appt at the
early of the pyramid parameterize job of
Jenkins okay this is a small trick but
this is nothing to with Jerry so this is
if you start our services async owners
okay so how much this was unplanned
so 10 minutes okay
so let's review the code here the
archiver injects theory which is fine
because it now recognize it produces the
Ori who is a qualifier they have to
match and this seems to work connection
expose that produces web target the
producers is the right one here is also
the right one and in our archiver we
inject the web target and use it here so
it actually will work so probably what
happened was here the run was forgotten
so this service and this service so and
as you can see archive config configured
Ori so it's the whole dependency
injection chain worked so now
I forgot actually the template jax-rs
time out no Jersey time out the last
jersey time I have to look it up in
netbeans preferences editor this is the
problem with automation you forgot all
the stuff Jersey timeout jersey time out
so and this is a jersey specific
configuration so if you are using pi RL
glassfish use jersey if you're using
white values rest easy what you have to
specify always timeouts connection
timeout Andrey timeout so and what I
won't do right now because of time if
you think about this is the same chain
as of the other side so you can use
still completely future and the ND pool
and now on timeout exception happens but
you can now react to the exception if
you react to the exception you have your
next circuit breaker okay so and again
the configurator here it will use just
the injection field as a key and you
could go to system properties or you can
go to a database and you can configure a
system on startup okay now what is now
microservice and why why the session is
from macro to micro and back this is
what we always did so it's no different
in it so now we called micro services
but this actually would always happen so
one team deployed a small war they
communicate with each other period
anything else was like political madness
managers wanted to have you know
unlimited developers in a project which
was disaster but it's not reasonable so
if you would like to be a reasonable
small team produces one wore their
worries as small as possible and you get
at the end of the day if they have to
communicate you have multiple teams they
have to communicate and you get your
micro services so now there are
different commercial projects where I
was where we also implemented
microservices in different way and I
cannot talk about this but what I did i
implemented my blog as a micro service
so my server is full of micro services
and real epic
micro services and I will explain why so
what I had to do is or what would I had
I thought the someone would like to hack
my block because I got so many hicks
hits like the yellow of service attacks
whatever I tried to analyze the Apache
la crise there were two two huge so okay
then do it in real time so and so I
using apache rolla and the idea was I
just implement the Interceptor here and
the Interceptor will call the elise and
then i can write this to log file and
i'm basically set so problem was the
roller was all I wanted to stored in a
database northern file the roller is
implemented partially with spring and
spring use old hibernate and it couldn't
replace the old hibernate and therefore
I couldn't use Java EE and therefore the
whole plan then worked so I was forced
to implement my first microservice and
isolate this because it was impossible
to use Java EE inside I would have to
introduce you know there's a glass
fusion hibernate and I want to do this
on glassfish eclipselink what was
impossible so what happens right now
this is a small stop which sends put
requests and this receives just the
requests so what I did implemented the
database and it worked perfectly for
several years so there was all the
queries perfect the problem was if i
wanted to refine the queries i had to
restart the service and this became not
available so what i implement it what is
already the timeouts so after a timeout
you saw a statistic and minors on my
block so it means statistic not
available but I didn't like the idea so
okay the true answer to the problem is
to split the writing part from the
reading park part so what I thought okay
what we could do we have the database
here and this is actually a docker image
in a with a database you will also see
this in the in the NASA on talk and
there is another another service and
this reads from the database and this
write to the database worked perfectly
the problem was this was a database what
was it it was for historical reasons it
was a
h naught h tues SQL DB one and it is
some problems and what I wanted to do is
to play with lambdas a little bit and
what i did i find out that with lambda i
can implement all the queries with
without having i actually only need a
hashmap and lambdas and i can implement
with streams whatever like and what
happened right now is the following so
okay nice I don't need this anymore I
just need a map but the map is in memory
so okay how to replicate this what I
used is je cache so okay i use je cache
with the implementation hazel cast or
infinite spin I used hazel cast what
happens right now I'm writing here this
microservice has to be alive but i can
start another one who cares i can write
to hear hear it's always successful okay
this je cache with hazel cast
automatically replicates to all other
microservices what I do really I have
one you know statistics module number
one and I can deploy on my machine even
another it's synchronized with my server
and I can experience my machine and this
is a true microservice architecture but
it was probably three times more
labor-intensive than the monomyth what
is far more flexible the data is fully
redundant and have many moving parts
what is far more flexible and I think
this is a true microservice architecture
and I was in on in a Java user group
meeting to two weeks ago and there is
someone from from a huge company did
something similar not with hazel cast
they use I think Africa so they they
send events first and that data
redundancy in all services there was no
shared data was a silo each service was
responsible for own data it was
identical to this basically ok so what
it actually means sometimes you can
achieve this and and this was even so if
if the statistic module fails this
module does not even recognize this
completely separate ok so but there is
not even a use case for transactions
between the idd microservices is just
works
a very good use case for this having
that said in my commercial projects it's
only in one case where we gather device
data from all over the world is
something like this with elastic search
all other projects has to use a common
database so it is more traditional
architecture but what we still do small
wars which communicate which is other
way arrest exactly what are built right
now and this we build in minority of our
cases but it's perfectly viable and what
I will do on because it works already
for two years in this case I would like
to make it even more complicated and I
thinking about introducing Africa just
for fun to do something else I can do it
in my leisure no problem but not in
commercial projects okay so now we have
two minutes now I can ask me questions
and and what we can do in the buff we
can reverb this you can ask me whatever
you like we can you can dip or we can
this is just our buff so there is no
agenda and if you don't ask me any
questions I have two questions from from
from gate and from my blocks i will just
answer my own questions this started
originally with JDK 16 and lambda of
working with jdk 18 so if you look at
the streams and for instance in Finnish
pen or and an hazel cars already
supports distributed streams so the
queries will be Eve even distributed
across the cluster okay so with streams
and java 7 you need jdk 18 but the whole
infrastructure form before this would
work also with jdk 17 in java is six if
you like stickers you get t-shirts next
four of questions oh you get a t-shirt
to the questions then see you in half an
hour this is
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>