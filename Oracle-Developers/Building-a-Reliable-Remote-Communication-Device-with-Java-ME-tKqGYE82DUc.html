<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Building a Reliable Remote Communication Device with Java ME | Coder Coacher - Coaching Coders</title><meta content="Building a Reliable Remote Communication Device with Java ME - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Building a Reliable Remote Communication Device with Java ME</b></h2><h5 class="post__date">2015-06-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/tKqGYE82DUc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">and hello and thank you for coming my
name is Leonardo Lima on the software
manager happy to come and ninjas talk
i'm going to talk about our experience
working with java me for term for m2m
markets in Brazil so let me get you
started and about me I've been working
for a to the last eight years on v2 com
working mostly with Java ME and java SE
and EE to build both the firmware that
goes on the device also the server that
goes to the the the data that goes the
server all this software is built up in
house and also with some tools from
upper floors and from Oracle and we've
been doing that for the last eight years
before there was this kind of internet
of things there was the machine to
machine market and also from since there
was dial-up you can say there was a
machine-to-machine communications and
we've been doing that kind of work since
then so I also works with me and he
couldn't come Iago is a lead developer
for this platform and most of the work
I'm going to present here it was both me
and him working together to get three
hurdles and he's been with us for the
last six years and we expected to keep
working on this platform for many years
to come on so here I'm going to talk to
you about how how did you achieve what
we have achieved so far which is to have
devices on the field that has to be
online and these devices must be
connected and transferring data and
reading meters for 24 7 sending data
controlling the network for electric
distributions so we've shipped already
more than 5000 devices and fifty
thousand devices and these devices are
connected to more than 800 few devices
my few devices we mean the mirrors and
the network control
some of them are concentrated by another
gate ratio that's why they count it is
easy not one by one and about mine
company Viacom is a brazilian company we
work on a mi solutions with these
advanced metering infrastructure on
Latin America so we have clients all
over Latin America and mostly in Brazil
and we've been awarded last night the
2013 Java Business Innovation Award for
our work using this so mostly because
we've been doing java since the
beginning both Java me and java e SE NE
on the server side to do all this kind
of stuff and java helped us a lot and
it's nice to know that oracle think
sales as well so we've been joined we
are joining the JCP we are already a tcp
member and we're starting to work with
the JCP we're being nominated for JC for
an easy election that it's coming next
month in October to foster Java ME
development so what we want is to mostly
be what I'm what I'm going to show you I
want we want to make them standard some
are already being worked on some stuff
is not that it's not that consolidated
yet mostly because the Internet of
Things is getting momentum so Java me
has been neglected for some time and now
it's picking up again and it's a good
it's a good thing and we want to help to
shape the way it's coming so we want to
do that through the JCP and as
developers it's a good thing that we can
help and change the language I don't
know the other side of the force or
Microsoft nuttin and if they allowed
that kind of stuff learning java you
have this power so if you don't know
about the JCP i recommend you to get to
know it and maybe some pain points that
you have and some stuff that you wanted
to see down on the language level so
it's not only on a single framework for
example you can push it through the JC j
srs and a good thing too
no so our clients we work mostly with
electric distribution companies in
Brazil and in Latin America who have
cadenza which is in Colombia and CH
Electra which is in Chile there is in
Peru as well and we do mostly in
Brazilian companies and our water
company as well there and what we have
mostly is this scenario we have these
legacy systems which can be both billing
systems from the companies or SCADA
system from network monitoring they want
to be connected to the few devices and
on the past they did these using private
lines for example for to communicate
with substations but this kind of
connection is really expensive even
nowadays and with the rise of dial-up
connections and later on with GPRS
connections the cost really went down so
it makes more sense to them and it's a
really big problem on when your network
goes down they want to have a fast
response so to bridge this gap between
the legacy systems and the devices we've
built a whole suit of softwares so on
the server side we have the intelligence
wear suit which I talked about yesterday
and you can download the presentation
after after Java one is over but also
we've done a lot of work on the gateway
which connects to the devices and this
gateway can be as complex or as simple
as a client needs and on the local area
network depending under a use case you
can have a direct one-on-one connection
from the terminal to the device for
example recloser zor commercial building
commercial industry bit meters they have
a single terminal which connects to the
to the meter or to something like a real
closure it's a big box that opens and
closes and let energy flow so but it can
also be for example residential meters
the seller connection is cheap but not
cheap enough to allow one one reader and
one cellular blind it would be too much
of a burden to keep all these lines
connected so we concentrate and use a
local area network and this network can
be as complex as a 200gb nodes talking
to each other over several blocks
connected two meters are can be an
rs-485 mesh on a building for example 44
floor to floor reading and these all
this complexity is related using this
gateway so the our use cases are both
ladies too it's an automated meter
reading as we get the data from the
meter I read it and push it through the
to the commercial billing on it's also a
CIS come but mostly for billing purposes
and also for fraud detection and
tampering and lt detections and we
mostly do energy in Brazil because it
with energy you are have you have energy
to power the device but we can do also
water meters so the device is packed
with our battery pack and it reads and
send data every six hours and it has a
battery pack that was really big it's
like the size and it kind of last five
years so it goes on the ground and keeps
on their water and it's just an antenna
cable goes and get out of the manhole so
it also works with any kind of media
really the mainstream is energy
especially in the last 23 years and that
smart grid it's on the zone folk so what
we have for example in our company we
make our own beer so we have a director
who learned and liked and introduced to
us how to make our own beer so the beer
process is kind of complicated because
there is depending on the I don't know
never in English but depending on the
know everything that is delivered during
Portuguese and yeast it has a different
temperature that if
has to be alive so we have a
refrigerator with a monitoring
temperature thermostat not thermostat
it's the only a thermometer with I to
see connection and we send it over to
our data center and already testing to
process the data and if it's too high or
too low it sends an alarm it go there
and because every fear it is too
downbeat doesn't have any a controllable
thermostat and so or if there's a big
summer day in Brazil we have spikes as
35 or low as 15 degrees in the same day
so if it changes a lot then we have to
go and fix the refrigerator so it can be
any kind of meter reading and this kind
of process it can be use it as well as
in vaccine for example the vaccine has
to be kept in a certain temperature and
legislation requires that you measure
every eight hours to show that don't
lose velti so if it gets too hot the
need of life living thing inside the
eyes and then you if you get a shot it's
not effective so all this kind of mirror
reading it's one of the things we do the
other thing that I mentioned is also a
network control so net when I say
network is not network as in IP networks
it's electricity distribution control so
what it does that mean the power line
leaves the substation and there is there
are feeders out as well and they go in
this is being transformed from medium
voltage to low voltage that we have in
our homes and now this network of
electricity distribution it's something
that has to be as most real time as
possible so mostly because also a
legislation requires that you have when
for example if a tree falls over a wire
and it tripped the wire and beads are
caused the shortcut and a short secret
and then it opens the network you have
to know where it failed and try to
rebalance the network to another route
and this
of operation is done using our system so
let me go back one slide so that what
happens is the SCADA system the upper
actually is one okay so the operator on
the data center he has she says okay
there is a circuit here and I want to
enable that and he presses a button here
so this boot on sends out the mp3
command all of our high available
performance infrastructure on the server
connects to the to the device via GPRS
it sends a command that can be or not
routed Nina inside a locker our network
and then this device response and this
response go back and this has to happen
in less than three seconds so it's a
kind of it's not a real time but it's
and it's not hardly real time but it's
something that has to be accomplished
because Saudis is effective if it
doesn't happen in three seconds the
operator is going to press a button
again and again and again and again
until it does because he did so what he
does he want he has to have these
network working really well so these are
the main use cases for our products
right now but with these internet of
things you can think anything like the
gateways automation that you see all
over double one they are talking about
all these kind of things can be
connected to our devices and routed
through the data center so it's a big
board that is coming and with these
internet of things they're good thing is
Java me is coming back to fashion and we
hope that we get a lot of more
developers interested in doing this kind
of thing we it's really hard to find
somebody that wants to knows and wants
to work with this kind of thing I hope
it's get better now so the technology we
use to build that is in our gateway we
use Java recognition one what is why did
I say one because before there was the
three lines that is being released it
today and they early access 8 there was
this Java profile
NP n IM P&amp;amp;G version 2 and CLD c 11 hi
and this is the prayer prehistory of
Java ME it's one like programming on
java SE 103 it's really old if you think
about it java for java one at for the
two was like 10 years ago and it's like
programming young I know assembly if you
think about it so it's really tough and
we started on the TC 45 six years ago
and it was Simmons and Jimmy's got
bought by tomorrow and on the end we
have the TC 65 module line it's a
somebody some people talked and their
accession especially from freescale and
gemalto that they mention about the
cellular ship it's a cellular shape like
this size it's very small and it has a
lot of gpio a solar connection and you
can build it's like a system-on-a-chip
and you can do whatever you want with it
it's not that expensive it's uh I guess
eighteen twenty dollars and you can
build it can be everything everything
that have to the run a system like this
one it's already there and also on the
on the server side we use Oracle Java
Enterprise Edition 5 being run on a java
SE 6 virtual machine from oracle did the
same machine that we download to develop
and for the data center we are using
your utilities mutated management so
what happens is the data from meters are
read from our device and fed into the
system and our hotel it is meter data
management stores is data so the
operator can see it so we for commercial
industrial we read the data every 15
minutes and send it over and there for
example if there is a temporary at empty
over in the in the field there is these
hope this big measuring measuring site
because with for example a car factory
it's a big consumer of energy so
there is this whole installation it
receives medium tension medium voltage
and converts to go inside the factory
and there's a this meeting station that
has a door and if these doors is opened
this device has to alarm and check it on
the system is there something scheduled
for maintenance on this guy if not then
this is a temporary attempt and also a
phasers can be used to detect are people
trying to tamper with the current flow
inside the meter so it also has to have
this kind of intelligence ok so this is
preamble what I'm what I'm going to show
now is the hurdles of living and better
life and when you go in bed it for any
embedded in machine-to-machine
communication sorry crap ok there are
three Commandments on our company than
everybody that works with them to em
should abide to the first one is the
device is a power source it must be on
it can't be shut down so if you have
something it has to be on it's as simple
as that so if can be on it must be on no
matter what and how's the second one is
firmer must be remotely upgradeable
because one of the fields certain things
on software life is bugs we always have
bugs and we always also have business
demands changes so the guy that wanted
that meter data at 15 minutes now want
every 15 seconds and another different
set of data is not so not that simple
that we can just change a perimeter so
we have to remotely upgrade the third
commandment is a kind of a derived from
the first one it's if it's on it must be
online and connected and if it's not
connected it has to be trying to connect
so if for example if I the GPRS
connection is offline you have to keep
trying and trying in until you get it
and if you
I will talk more about this kind of
scenario so we just doesn't suffice to
be on it has to be connected and all
available to receive commands from the
data center and also doing metering
stuff before if it's our automated
metering reading system so there are so
few hardware choices that help we abide
to that Commandments the first one
everybody that has done them to em or
any kind of embedded development has you
seen it it's all in all devices a
watchdog so one of the few how is must
have circuits is this you have to have a
something that if you don't fit it it's
but it bites you and shut you off and to
anyone again and it's that simple it's a
dedicated ship qg 8 that we use and it
has a pin and if you don't shake that
ping after I guess it's 10 minutes it
shuts the TCC 65 off and they're not
turns it on because if that happens it's
something locked up in a firmer and it
almost never happens like that but it
almost never happened but when it
happens it's something bad and we have
to have it on so there are other harder
choices is a dual sim card so we have to
have a fallback for communication as
well and it's it's what it says there
you should really have a backup if your
business is critical when you can't
afford to be offline he has to have a
way to try another one in Brazil we have
four major carriers for not here you
have a lot of man normally people have
to with the they take the two biggest
ones on that area and install two chips
and if the one fails it switches to the
other and you can fall back to the to
the first one again and all these
connection has to be handled by the
device as well and also to serial ports
especially for command and control and
the debugging as well it's good to have
two three reports and it's a simple
thing to achieve
using these the amount of series of
modules so it's good to have and we
chose from the beginning of the company
mostly we chose Java me why because it
has a lot of a lot of advantages over C
and what are their advantages yes javis
can be slow but we don't have to have
hard real-time but Java allows us to
write on sand deploy anywhere yes it
happens we better we pick from a
motorola device and go to a gemalto
device and it happens and on its perhaps
you have some customization for board
specific stuff but it happens so with
seed has to be compiled against another
tool chain and mostly of the resolution
doesn't happen a java me already has a
provisioning infrastructure thought
about so it has the chip the module we
sent an SMS where they were all of the
new firmware and it downloads by itself
so all this kind of infrastructure the
java me already have has is one of the
things that maybe we go with Java ME
also the Java me java being the same
language from it is like Portuguese and
Spanish when you think about Java ME and
java SE so it is not the same thing but
if you talk is lowly in one language the
other language the other person can
understand it so while we don't have you
can put a java SE programmer on the top
of java me one and expect him to perform
greatly but he can understand what's
written and he can help the bug and he
can go back and forth in his world so
it's a really easy language to pick up
and with java me eight it's getting
easier even still you i don't know if
you've been here maybe you've been to
the Java ME eight sessions and it is
really exciting to not have this
separation anymore sure
and for software we had to keep sing
things up are so well when you start
developing you normally don't have this
kind of certain ideas we want to get the
work done but once you go on and you
develop one two three applications you
see you have to have a layer that
handles these basic connections and
basic stuff for m2m market so what we
did is we have three layers and these
three layers also we even in this Java
me and this new world java java SE and
batted and all these the same three
layers apply and continues to apply so
the first one is all we call hardcore
it's kind of a bad translation of our
mac microkernel but i doing portuguese
make sense and so it's it destroy it
abstract details on the hardware that
it's running on so if it does your
mother chip there is one thing and the
GPIO is one thing and the motorola is
another thing and if the if it is for
electricity it's one set of device is
that we have and if it's for water it's
another set of device is that we have so
we have lots of boards that brands on
the same module but we still have these
kind of super abstraction before so the
application can be simple and the second
layer is what equals Zion which is a
fairer layer and it handles all this
common infrastructure so things like
back end connection message queues logs
and logging and all kind of things that
timers everything that has the
application running it's on this layer
and it also as the Java ME abstractions
are not that complete we had two
isolates things like 80 commands so how
do you send 80 comment to send an SMS so
it's different on motorola it's
different on Gemma on motorola and
yamato and tallit so depending on the
the modem that we are running on we have
to have a different set of commands for
gpio for SMS GPRS connections all kind
of stuff so these layer abstracts all of
these and as I will say in the end most
of this stuff is being handled now by
Java me eight which is great and but we
had we didn't have these six years ago
so we had we build a lot of
infrastructure to handle this and the
last layer is the application layer
which handles only the logic so these
enable us to have a very simple for
example if we all we want is to push
data from a serial port to a TCP port
all over the server it's a very simple
you read byte from the serial port and
put it on the TCP pipe and another
thread bridge from the TCP pipe and
because it's Heidi doesn't have a
non-blocking i/o so it's only blocking I
oh sure you read from there and put
there so we had two threads per port
doing this kind of connection and this
is what we call transmen pipe and also
can have a lot of automated automated
meter reading roles that reads the
mirror every five seconds to see if the
meter is there and which data every 15
minutes to see if the phaser changed and
to see if consumption is too high or too
low when to see if the alarm has to be
triggered so it has to be it can be as
complex as needed and with as many
protocols as the memory fits but it is
very separated so uh I guess I already
said all that he's so much more detail
about what it does for example desire
has the handle DCP communications we had
to build our command shell because we
wanted to be able to send to write
comments and 2 c's and d's and read this
file and all kinds of stuff we normally
do on ssh over server we wanted to do
the same thing on the device and there
was nothing like that and we developed
our own and well i see this stuff simple
stuff like math
to calculate the D is very limited on
Java me one and string you choose there
is no substring for example a good
substring bite conversion to BCD into
other Excel strings stuff like locks and
Q's also they are not there we built an
event bus to help even more separate the
layers and also it can hello even more
harder stuff like SNMP connections
monitoring and CHD with is called
switching i don't know i forgot the d
but it's a dial it's like internetting
the late 90s in brazil's we had to use a
motor and I on sure it happens on the
cell phone it's expensive as how it's
like in Brazil it's I guess it's one
dollar per minute connected it's too
expensive but some people want this kind
of real reliability if GPRS network
fails try and dial and sabash a
connection and the application is really
simple and I meant to add a packet
diagram here but it would be so crowded
but it's Moby v2 comes io n application
control harder communication event
protocol tools and utilities for the
lower two layers and then
application-specific so protocols and
this when I saw Java me eight slides on
the sessions I said ok you are guys
wanted to do this say most of the same
stuff dude he did and with his great but
it's kind of we wanted you to do these
back then but ok we have it now and if
you want to do see code i have but i can
show on screen i can show you later some
kind of some codes that we wrote to
handle this kind of stuff and now to the
challenges we faced and we are now i'm
going to show some of the hurdles and
how we came across it and stop that we
wanted somebody to have told us before
we started so the first thing i said
that you have to keep it on and how do
you keep it on and why is that because
the the center
no specific but the the ship set in the
operating system can have a bug as well
it software so it can encounter a
deadlock you can encounter a bad flash a
dress that doesn't read well it can do
anything and it shuts down the
application without warning it's just
shuts so it's like a Q minus 9 from the
operating system linked to us show it
the application shuts down is never
turns down again so we have the hard
watchdog and also many other watchdogs
we because even if it seems to be online
it doesn't show for example if I have a
deadlock on two threads that the threads
that communicates on the serial port the
device seems to be on but it's actually
offline it doesn't do any nice work so
we have to have soft watch dogs so we
have a whole package of watchdogs and
watchdog about things that has these if
you don't feed me in game 10 seconds 10
milhas 10 hours we are going to unthread
uq your thread and start your thread all
over again so you just kind of stuff
keep the device on its very hard and it
if you don't go the hardware way you're
going to have a mess so if you're ever
thinking of giving a prospect by to do
internet of thing home automation stuff
for example for your house see if it has
a harder watchdog and if it does and
provide one for it so it's a because
then you're going to see oh I want to
turn on the terminal side of my house
and you see it's offline and doesn't
come online and it's because the Linux
shut you down for something reason and
you if you just unplug and plug again it
works so why not do it on the with a
hardware watchdog and it's on but it's
not a line and if it has it is GPRS
connections I don't know if you remember
when you pair are now 3 g's and other
stuff but even 3g
do you think the weight you want to
check your facebook update and it kept
there loading loading loading anywhere
load already and then you what do you do
when the network fails on you so two
solutions again many soft watchdogs to
retry attachments and what what we mean
by retry attachment it's something what
like what we do on our phone we turn it
on to airplane mode and then turn on to
see if you handle if can connect to the
3g network and also dual SIM cards as i
said and before we have these as a
safety backup even because especially
for network control when there is an out
power outage most of the time also the
cellular tower is off from one Operator
can be shut down if they don't have a
battery backup because thieves enter and
leave take the battery backup so the
happens in Brazil I don't know the other
part of the world but in Brazil it's
it's Brazil so we have to network to
sell where and clients don't for example
there are two curves that share the same
tower so they don't put the same tube
because if there's our infrastructure
problem in one the second one will have
the same problem so we have to kind of
have this kind of balance as well it's
very hard for them to keep up with these
problematic cellular infrastructure so
that's it we have to sing cards and what
happens mostly is most utilities they
have a primary Network contract and a
secondary one which is more expensive
with less bites on the contract and they
keep on the first one and then if
something happens for example day you
don't have a connection for five minutes
you switch to the other one and if this
is ok now we you stay on this one for
one hour and try to go back again and it
doesn't work you go back to that one
again and keep swinging this is a very
good thing to have when when the GPRS
connection is bad enough they go
satellite so it's another kind of
vice because then you have a internet
mode in that connects with the satellite
and talks to the device but it's
something we have as well and when we
talk to our networks we talk about
public or private ap ends I don't know
if you know about what it is a PN but I
PN is what it's mostly for common people
it's transparent because we all will use
the public APN which is we can connect
to the internet using our phone but we
can't connect to our phone using the
internet mostly it's like our network
provider for house most in Brazil they
block everything you don't have a we can
sometimes you don't have a valid
internet IP you have a private IP gas
gets netted outside and it happens on
the cellular level as well so what
happens is we need to connect the device
to send comments to it and how do we do
it and we do it using something that we
call a software switch because device
can pull server some solutions are you
keep your device asking for new commands
every 10 minutes or every one hour and
one of these works eat so many cases
doesn't allow it for example this
network control thing it has to be
online all the time and if the device
fails for something reason in you have
to establish the connection and you
can't go the public APN Pharaoh so what
we have the software switch with we call
it software switch because it's not a
switch on the level 23 on the of the TCP
network it's on application switch it's
a server that is a meeting amadou
approach the device connects to this
server switch the indie service which
opens a TCP server socket to wait for
connections on to this device and if
when you want to send comments to this
device you connect these TCP port and
send comment over and the switch grabs
from the Mon TCP connection inputs to
the other one and this goes back as well
so we have something like a switchboard
from the whole days of telephony where
you have somebody that has to be pulling
cables all over again and all over the
place and we found the same approach is
round here so when you don't have a
private APN with a private APN you don't
have this fire on the way so we can just
connect straight on the device but when
you go public because it's a for example
it's your only your home so you don't
have the money or the disposition to go
through this cellular provider hurdles
to get this established this has to be a
VPN it has to have a contract it has 45
days of delay and you have to be some
someone big for them to care so whenever
you're tility it's okay by me when
you're not it can be a pain to get a
private VPNs a private APN so if you
want to go public and you you don't have
internet connection you have to have
some kind of server that do these men in
the middle so that's how we handle this
problem and once you get the TCP
connection we have to keep it up and
especially on cellular networks the
device the the carrier it cuts your
connection without letting you know
after five minutes so if you handle if
you idle there and you have a connection
it if you don't traffic anything because
it has to be online available to receive
command but if it's not like every time
you have a comment for it so you collect
and say there the switch connection is
there and it all goes out and the
carrier pyro cuts your connection and
you don't know about it until you right
into that pipe or you try to read and
also Java me is a blocking I oh and the
available method always returns zero
most part of the time on the Java ME
implementation that we have and the DCP
alive there is a TCP Allah keep alive
that can happens on the TCP stack layer
but it's also not supported on devices
like this one because very small it
Linux reports it but the divine module
node so we have to keep sending
keep-alive packets people I've packets
and we delayed these as long as we could
be implemented it only after four years
of doing reconnections so after five
minutes of time out we cut the
connection you reestablish again but
this is expensive because the carrier's
build everything that it's like you go
to a buffet in Brazil buffets are
commonplace for lunch where you go
there's you pay by the kilogram that you
eat and it's like if you go to a place
like these and they pay the Bureau by
the plate your play you're eating your
it you have to eat on a plate and you
have to have tcp heathers IP headers and
the TCP handshake meets a lot of bites
that has to run and it's not a useful
bite it's unnecessary bite and you don't
see this bite but they bill you for it
and once the the boost when the
utilities started they was okay how much
how much it costs you we want these kind
of stuff but they started singing okay
let's reduce reduce the riddle and we
how okay we have to have keep-alive
sockets and this switch has to handle
this because this Kate I can't see these
packets because it's a known protocol
issue and it's all complicated so
keepalive packets and Java ME eight they
have our keep alive it's not package I
guess it's the client an option that
keeps sending packets I'm saying gasps
because the early access started on this
weekend I've been here so we couldn't
try it out but keep our lives are use it
a lot and we have a four minutes delay
to start sending keep-alive packets and
as I said before bugs dare bugs and
there are many devices on the field we
have am online per client depends on the
clinic some clients have 10th up 10,000
device is connected online reading and
some other clients has a little less but
and these are deployed on the many
meters that are different that are made
by different manufacturers and we want a
specific maybe some specifics depending
on the on the case this version of this
meter has to have a specific command and
we want to update that one and how do we
do that and we have no one also likes to
mess deploy so what everybody means
nobody wants to press the play button
and okay although the feud is going to
be updated because everybody fear nobody
in IT companies they do a mess update of
Windows or they always do controlled
update oh it's the same thing here and
we have to have update dispatches as
needed and it's kind of a manual
operation mainly because we have people
to do this it could be automated and
there is when you go osgi and when you
go like for processed and compact around
their companies that provide
infrastructure for these kind of stuff
on osgi it's very common because OSI
also provides this kind of api's and
java amia we didn't find anything and we
developed our own solution we have our
server which called the actual server
that controls all the communication
layer and this server has the version of
everybody and when we want to deploy
specific version we list who has this
version and we start out on a date
request and also one of the things that
Java ME allowed us to do with is the
over-the-air provisioning which is on
tap is we can send an SMS that even if
the our program is not running the
operating system of the module received
easy SMS intercepted and then start
downloading the new framer and it has
some simple checks to see for valid
named invalid size and then it changes
the firmer if the download it was a okay
or not so one of the reasons Java me was
a good fit because they already did
these and this is our like a must-have
functionality and it was really nice and
there are when you are developing one to
the bug and this kind of devices were
these kind of modules they don't have
many debug features at least not in the
back days and Java me one didn't have
any kind of log in infrastructure so our
first logs was just system.out.print
lines and when you start to spawn 16
threads with suzanne outs without read
names and without class names and
without anything can be really messy and
when the first developers started doing
this you say how do you know if these
message is the next one of these the
same thread oh I know it because we
coded it okay you know it if i head to
the bug days or if they are the client
wants the bucket how how do you keep the
flow honey I don't know I just know it
ask know so we had to develop our simple
logging framework that captures a thread
name and we had to develop named thread
class that accepted a thread name is
Santa threatening and this kind of
boilerplate that people don't think
about it because developers I am
developer but developers only normally
things about themselves first they if
they can see it if they can have it
running everybody can it works on my
machine why not work if it doesn't work
on yours it's your problem right say hey
and we have to okay you're going to use
this logging framework now and please
try it keep the bug levo a message the
thread and a timestamp also there was no
time step so imagine you have two pages
of season outs without time stamps
without oh you had the this serial
program it keeps time steps for you so
and if the client doesn't have the same
program please think about it so it's
one of the things we had to do mostly
before any house and also because the
the device is so simple
with when we're developing java sea we
have all these a lot of frameworks home
myself for j slf4j when log back and
look for j and the java you two
frameworks and we didn't have anything
for java me we had to cook it and i will
not start about remote break points
because that's impossible now it is it
will be possible with java me eight
which is yay finally but we didn't have
that and also when you're the when we
are developing we don't want to be
deploying all the time because the
deployment process is bothersome you
have to connect to the serial port of
the device and send it over over a 15
kbps connection and we can develop many
of the stuff also because you have
specific for the device so how do you
get a string connection how do you
assess a single file this kind of stuff
is specific to the device so we had to
build our javab struction layer which is
what we call our a simple implementation
of the Java ME framework for the desktop
and we recommend that now actually with
the Java ME eight you don't have to do
that anymore thankfully but if you're if
you were going to start now using these
kind of stuff we recommend you to work
on the device that you have do a simple
layer that is a single jar that has the
cone stuff that you use to run on your
computer it's much faster to develop
this way and people use it to have one
day when we begin we just had a six
lights to the bug so if one light is
blinking if the application is alive
then no no this this doesn't work we
have to have better stuff to work with
so we developed this simple here and we
are glad to see that Java me H has that
cover now and also when you are running
on the field we you can't have these
logs on forever on the server even when
you have one terabyte of data you can
keep your log for weeks and months and
when the client complaint is what
happened last week you can go back and
see their log files
but on a few devices you don't have
flash for it it's very expensive to keep
out this data so well normally our
module only can capture because we are
kind of a verbose because when you are
developing you are the verbose and we
keep the logs on because when the client
wants to the bug it's because they have
something a very specific problem and
when we have this we can only keep 30
minutes of logs and the problem happens
also when they are not online so the
client wants to know on that out on that
thunderstorm that was three hour long we
couldn't connect your device why is that
right how can I know it was a
thunderstorm the GPRS connection must be
off I don't care I want to know exactly
what if it tried to switch the sim card
if it had something to do with the
malfunction or was it online even was it
did it have a power source on all this
kind of stuff so we had to develop our
own something that we call black box and
it's like the air planes black box we
want to keep this kind of information
very small and very specific event so
every time he attaches to a GPRS network
what is the herb name and what is the
sino level and when it disconnects what
was the cause and did it when it
switched sim card when it's online when
it in our software soft watchdog fails
this kind of information we did on I
guess it's eight bytes eight bytes can
fit the it's eight bytes plus a comment
for urban name for example but to enable
us to store many weeks of the bug
information of this level it's we had to
develop also decrypter because it looks
like a very non Portuguese log but it it
helps to keep the small the log file
very small and it's something we
recommend to anybody keep track of your
module using these black box thinking
that airplanes has have sorry
um also I'm running out of time sorry
but I will keep you off fast enough so
we have to have synchronized access
resources so when you have two threads
that want to access the serial port they
can have it on at the same time and to
avoid receptions we have to have
synchronized at access and let's
synchronize it access it can lo to lock
ups especially when the there's a bug
and because synchronizing keyword is
silent it synchronize it locks in the
keeps waiting for the lock forever and
java c5 you have the concurrency
framework and you have the Java Sea
locks and reinsurance locks and wings
but we're inspired by them to build our
own block class and these we added two
very great methods with this trilok that
if you can't lock you just return false
and show you you don't fail if you can't
you don't throw interception it's
something that is a graceful graceful
they fail and a fast lock if you know
that if you want a resource for a very
short period of time do a fast lock
because if somebody tries to lock a fast
lock the method wait so it doesn't have
to report a failure to acquire because
only have two for two seconds there is
also the problem of the parameters
defaulting or when you have the same
femur for different clients they have
different needs in different parameters
and this is a problem for the flash
memory can get corrupted and you lose
your parameters file and what do you do
you send our truck to the field it costs
like 100 bucks to be to send one of that
and nobody wants to pay that bill so we
use the jad file parameters for these
it's something that we didn't know you
know why we didn't know we spent two
years without using it with hard hard
hard coded parameters and specific fumer
files for each client intends on the
tiago said there's this we can get a
perimeter it's something on the midlet
and oh really and so we wish somebody
had told us that before and also there's
some painting challenge
is because you can't win them all and
it's a small list but it's something
that keep troubling us so how do we make
binary smaller Java me each we didn't
get a very good support for manage our
files inside the middle incentive module
and update them on smaller fragments and
if it's our only a big 100k femur if it
fails to up to download for any reason
everything fails so and the client
doesn't want to spend oh you know you
had a bug or you had a new development
and you have to download 100k when they
only have two megabytes of data to
transfer every month and their
application already downloads the two
megabytes so how do we have the smaller
binary fragments the FM e 8 has that
cover thankfully but ah zapping point
already and run multiple applications at
the same time so especially its on this
new gateway kind of application you want
to have one application to read one
meter and another to read another with
isolation and we can do that with
threads but when you have the same
resources shared it can be on starvation
problems so we'd like to have two
different applications running at the
same time communicating with each other
or not but it's still separate and Java
me eight has that covered but we are we
still to have Java me eight devices and
we need more permanent in order remote
login so it's mostly a harder problem
because we need a flash to be there and
or a log resurrection which doesn't
throws the log only to the serial port
it if something for like a TCP logout it
would be a nice thing to have I don't
know if java me has that java me it has
that and a lot of security issues are
there were a lot of security sessions
also here in java one that we had to
think about noah says if you think about
it if you didn't think you have to think
any when you
you get scared about all the bad things
that can happen and it's really for us
our devices are around up above the
medium voltage on the poles it's a very
hard to access place and most people get
killed trying to when they try and but
anyways you have to think about security
so better management of keys when you
talk about SSL connections and gentle
untie and tight temporary measures so
you your device and get it doesn't get
violated and you did change the sim card
for another one and I had to write DZ
slide after I've been here in Java one
thankfully my my session was in the late
ones because I saw lots of Java me eight
sessions and they have a lot of what I
have ready told you covered they have
device I yo to isolate most of the
common the device I Oh covers the
watchdog covers I to see 80 comments and
there is the access point the
functionality that covers multiple apns
for the same sim card a day it has java
and I yo javanne oh I guess it's javi
and I you like but it's mostly
non-blocking i/o for communication so
it's a very nice and there are lots of
others I don't have the the screens yet
to and the early draft was available but
it now the early access api's are
available to download if you think about
developing for java me if you can go
ahead and download the java me three
there are available for Kyle and
raspberry pi frameworks they have a lot
but Jeff me8 he's a lot of promise for
next year so it's out really and if you
look at now it's like a very thorn
rainforest to travel on but know that by
the next in the next year yes it's going
to be a much more beach like location
like do you have in Brazil so there are
some stuff that they still need to work
so when I saw there is no concurrency
support and I say how can you not put
logs and you need I don't know if they
don't
put but for some no concretion normally
they lock their insurance law classes
and stuff like that is not there so we
have to port in it's one of the reasons
why we are joining the gcp to help
foster the java in the evolution and to
put stuff that we see that's necessary
for the java me and it's it will the
reason they didn't put a lot of stuff is
not to bloat and we don't want to blow
to just want stuff that are really
necessary for us so with four minutes
for questions please go ahead okay show
the question about synchronizing
real-time clock we do use MTP so yes we
have the ntp and the module i guess it
we send a ntp Datagram over the internet
and when if we are on the public APN we
go to the pool from whatever country you
are and get it back or the the utilities
they have satellite gps satellite
satellite gps ntp servers and then we
connect to eight and one of the things
we can't do is update the real time
clock when after it started so we have
sometimes we have to have a delta and we
do have a you to not do to but get see
current time meal is that we that we
have the delta added to end every to
every call so we don't use a system get
current mirrors we have another class to
have that because we have this delta and
if this Delta changes too much we have
to reboot so this new time is okay it's
a tricky thing to resynchronize aunty
the real time clock and it gets
dyssynchrony I don't know how but it
goes back to two thousand two lots of
times oh we had to handle that yes any
more questions go ahead
had 50,000 devices connecting back up to
the servers or 50,000 gateways yes
gateways that 50,000 is if we pull
everybody together we have on our major
client is neighboring ten thousands and
we actually the main problem is the
connection to the utility do the seller
provider sometimes they don't have the
pipe big enough to handle this kind of
data but 10,000 devices on the linux
servers like peanuts so meet when you
when you go to this internet you have
millions of people tried sent to it and
we then 10,000 is not that much so and
the 50,000 is our combined clients they
have that but we are there is this
network provider in literacy preventing
the south of some of Brazil that they
have 15,000 and they are deploying still
they are on the 8000 at vida be the
server load is like the RA load average
is 2 on the server so it's not a lot
mostly because when you have a network
control you have a lot of traffic and
there can be spikes that's why we had to
use Java nya on the server to handle
these all this kind of traffic and we we
didn't have Javon I oh we had to have
were several instances of this job of
platform you had at most it was 1000 per
JVM because you had to have two threads
one threat for one and and as there is
to see reports there is to steer connect
to TCP connections so we had this limit
after we did version 4 of our of our
server platform we need a Java and I you
approach most like twitter twitter runs
java ngaio to handle all these network
traffic and we did as well because the
we used the java JJ it was jboss Nettie
but now it's just nachi I o-n-e TTYL and
are very good network connection and
network abstraction over java in I Oh
Jeff and I Oh bare-bones is
crazy way tried it it it didn't work
well but with an ID we had that cover so
that was the two problems the pipe we
had on one client that said you were
devices keep not working on the day and
where they work on night and said
doesn't make any sense we don't have
anything controlling time and what
happened is because on during day time
there is more electricity flowing it was
a network control so there was a lot of
requests in response from server so on
the on the night there was very little
changes so the devices didn't report
anything back so their load was married
a lot so we spent two days of debugging
and after said there is no problem
neither on the firmer not on the server
and then he said yeah I know I don't
know how to say it but our connection to
them with half a megabyte to the pro
seller providers and one hundred percent
for all of the during the daytime so
okay thank you for waiting there are two
days hey I was down that projector it
was really they say okay no problem call
us next time you have a problem again go
ahead I don't know I don't think they do
I don't think so oh well you can always
get your time I guess yeah but I don't
think they have the Java the new
datetime API I I sorry yeah I don't know
you know yeah desiccated the jar sites
return yes yes but I don't think there
is I don't I remember somebody saying a
bit but if it's different but I don't
know really don't know well the early
access yet early access is is now it can
change so it's not final yet and the
early early access they made it
available this week with the
announcements and everything so I really
encourage you to download and there is
this very nice simulation platform that
I didn't have before and if
and emulate the i2c connection you can
emulate gpio you can emulate anything so
it is promising very much and we are
especially now that we're joining with
join the gcp last month and we are
getting up to speed to how can we help
the java eh java me it is infernally to
light but we are going to re it's not
really late but we are going to look
into the jsr s that are in 28 and they
are considering 29 and to see what to do
you guys get wrong good i was talking to
a lot of expert people on the job
especially how the java team that did
Emmy we are doing formal work Oh what is
your use case for this kind of scenario
so for multiple ap ends on the sink do
clients want multiple apns they do they
want to be able to have a private EPN
but if they they're linked with the
provider fails they want to have a
fallback over the public APN and we
didn't think about it before they asked
then it's it can be multiple AP and
spare sim card and we have multiple sim
cards per per device so this kind of and
now with bigger modules we have other
connections and I don't know if you
heard that Apple launched iOS 5 with
ios7 with multipath TCP that can route
connections over 3g and if this
connection fails then you can go on
Wi-Fi and if Wi-Fi is crowded go back to
the 3g and it's the same tcp connection
and this kind of new multiple connection
devices they are going there trying to
cover these on the Java me 80 it's it's
promising a lot okay so I guess I'm I'm
out of time but they didn't copy anybody
has a and more questions nope okay so
thank you very much for coming thank you
on my email address if you have any
questions you can go over there and you
forever to Brazil we were invited to try
our beer and it's very good there for
our kinds are they are pea whale pulsing
and wisin &amp;amp; Porter thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>