<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Autumn Collections: From Iterable to Lambdas, Streams, and Collectors | Coder Coacher - Coaching Coders</title><meta content="Autumn Collections: From Iterable to Lambdas, Streams, and Collectors - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Autumn Collections: From Iterable to Lambdas, Streams, and Collectors</b></h2><h5 class="post__date">2015-06-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/jjjBOcBqhDU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so welcome to this talk called ultimate
collections some sorry it's not about
fashion it's not about night closes just
put this title to lure you guys to this
dog and I can see that it kind of kind
of worked ok this talk is about Java 8
lambda expressions I guess you all aware
that lambda expression are the big
things the big the big new language
feature of Java 8 and also about streams
and collectors the stream API this new
amazing API introduced in Java 8 that
really fully leverages the power of
lambda expression and the collectors is
not an API in itself is just an
interface along with the factory class
but it works hand-in-hand with the
streams and we're going to see that for
the reducer step maybe you know this
book it's quite a notebook now it's
called the Gang of Four but if you don't
you really need to how to get to aware
of this book it has been printed written
in 1994 that is even before Java was
released 20 years ago and if you check
on amazon it's still available let us
it's not an advertisement I don't have
anything to do with Amazon but still it
is still sold I mean books in computer
science about patterns and stuff that
are still sold 20 years after they've
been written I quite rare so there must
be something really interesting in that
book that book is about patterns there
are cultural member exactly i think it's
23 from the amount of buttons to build
algorithms techniques etc they are still
available sits nearly everywhere in the
room so please don't have sit and there
is one fundamental pattern in it which
is the iterator pattern the iterator
pattern has been introduced in Java to
back in nineteen ninety eight is the
fundament of the of the collection
framework the correction framework is
built on the iterator pattern and
precisely this talk is about that the
interracial pattern is not going to to
be made obsolete by the stream API but
at least old fashioned and this is this
talk is just about that I would like to
answer two questions in this talk for
why lambda expression have been
introduced in jdk 8 we've been waiting
for lambda expression for about six
years because there was first scheduled
to be released in two thousand eight and
their introduction delayed the release
of jdk 8 by six month so there must be
important that's the point and the
second question how the introduction of
this new language feature will change
the way with build applications and the
way we think our application the design
of our application this is exactly what
what this talk about my name is jose a I
live in Paris in France I'm I've got two
jobs in fact I've gotta I'm an assistant
professor and the university of paris
and i also work at as an independent for
various companies i also contribute to
open source development I come from math
sorry about that i also have a blog but
mostly in French so you might not be
really interested in that and if you're
interested not to be spammed by twitter
you can follow my twitter account
without problem i'm also a member of the
parish java user group and we've been
organizing a conference in france would
gathered 1500 developers over the last
three years called Devils Franz ok if
you have questions you can use Twitter
and this hashtag I will monitor this
hashtag over the next few days so if you
just want to chat comments have reverse
or interact in style sheets here you can
use this hashtag there are two here's
one here if you if you have available
seats please can you raise your hand yes
ok so let us introduce lambda expression
what are there this is a tutorial
session so I want to introduce things
clearly on a very simple example let's
take a very simple beam I guess we all
wrote loads of beans and how we develop
his career and let's put that those
beans in the list plain old list ok and
let us compute the average of the ages
of the people in that list I'll probably
end up writing this kind of code take
your take a sum put 0 in it compute the
average iterate over the list this is
exactly the iterator pattern it's just
that get the edge of each person i
accumulated inner in this integer and
since i come from mitre I don't really
like division by zero so i'll have to
check if the list is empty or not and if
it's not divide the sun by the the size
of the list to get the average i can see
already that i have a problem if the
list is empty what does it mean to
compute the average of the ages of the
list of person if this list is empty
we'll come back on that later okay trick
here the average of the edges of people
older than 20 it's almost the same
pattern it's still the iterator pattern
this is a bit tricky because I need to
count the number of person older than 22
/ this number at the end of the day okay
so this is the kind of code I've been
writing for for many years even before
Java this is a java code but it could be
C++ C whatever this is called imperative
programming what does it mean it means
that at each step of the algorithm I
precisely tell the CPU what to do take
an integer put zero need get a person
get the edgefield add this field at the
value of this field to do to the integer
etc the the CPU doesn't have much wiggle
room to optimize anything no the
compiler the Java C compiler not the
just-in-time compiler because the
description of what i want the cpu to do
is so precise that there is absolutely
no wriggle room for optimization there
is available seats just here to three so
please take home it doesn't have to be
like that i could write this kind of
code select average from of age from
person were age greater than 20 what is
the difference between this code on the
previous one this is just a description
of the result i'm not telling the cpu
how to compute things I'm just
describing the result of the computation
and there is still one available
stitches here this is sequel language
sequin interest is 40 years old can you
imagine that 40 years old and 40 years
ago I could write this kind of code
exactly I still write the same code what
I'm sure of is that the DB servers 40
years ago would not compute the
in the same way as today but it goes to
to to write this the query is just the
same and this is a very powerful way to
do things why because I push all the
optimization stuff down in the API and I
don't put the optimization tab which is
technical code inside my business code
and this is exactly what the stream API
is about what I want to do is to
describe a result and to let the API
compute that result in the best way
possible let's focus a little on this on
this algorithm because we are going to
keep that example until the end of this
talk it's called the map filter reduce
maybe some of you already know that so
the first step is called a mapping what
does a mapping do and just take a list
of a given type here Lisa person and
written the left under of another type
live here a list of integer the region
list at the same size as the input list
same number of elements this is very
important to note and if it's a real
list in a Java sense compared to a
collection at least as an order then the
holder has to be kept during that first
step the second step is called the
filtering it's completely different from
the mapping the filtering takes a list
of a given type and returns me a list of
the same type so the type of the list
doesn't change but the number of
elements in that list does change over
there will be less elements in the inner
return list and the last step is called
the reduction I'm not going to define
the reduction precisely just now we are
going to do that later in this talk for
the moment the reduction is just an
aggregation think about the sequel
aggregation the summer minimax whatever
okay so how can I model this algorithm
using the tools I have in Java 7 well in
Java 7 i'll probably create an interface
to model the mapper just the elementary
operation take a person written an age
right an implementation of this
interface using the tools i have
probably an anonymous class which is
fine and this is the implementation of
it i'll do the same for the filtering
the filtering does take an object and
returns a boolean
and implement it like that undo the same
for the reduction and here i'm using a
trick what I'm telling is that if i
define the reduction over two elements i
will be able to reduce any kind of array
or any kind of list will come back on
that later on show and have a look at
the precise algorithm to do that okay so
I've got three interfaces a mapper a
predicate and reducer and let us
implement that and build a muffin to
reduce algorithm I'll end up writing
this kind of code which is not the
nicest code one can write in Java okay
it is if I if I know the shortcut the
keyboard shortcuts of my ID is pretty
straightforward right but it won't be
very easy to read very easy to maintain
so I don't really want to do that this
is precisely the way of writing things i
want to change if you've got an
available city new you can you raise
your hand okay there's still plenty of
room so please okay so how am I going to
do that in jdk 8 i'm going to first
rewrite the mapper which is an instance
of an anonymous class like that first
I'll notice that there is only one
method in the mapper interface and this
is fundamental we'll come back to that
later so I'll take the person p and what
do i do i just copy paste the block of
parameter of the method i'm implementing
it's just a copy paste and then use this
little arrow like ascii art stuff you we
all read about ask you or don't we yes
it's all stuff it's a dash sign followed
by your greater than sign and then copy
paste the return statement I can omit
the return key word itself and this is a
lambda expression the JDK 8 compiler is
able to recognize this as an
implementation of the mapper interface
how does it do well I'm going to see
that in detail later okay so this is a
nicer way to write this implementation
it's lighter there's less code it might
be a bit hard to read at first but with
the little habits it becomes very much
they are common cases to write lambda
expression first what if there is more
than one statement in the implementation
of the method well I just need to copy
paste the block of statements between
curly braces and keep the return key
word here just to tell you what I'm
returning and it works perfectly well
what if there is no region value well in
fact nothing happened because returning
no value its returning void so I just
write it like that and it works
perfectly well too and what if I have
more than one argument well once again
it would just work the same just copy
paste the block of arguments and put it
in there at the beginning of the lambda
expression okay nice how can the JDK 8
compiler recognize the implementation of
the mapper well the first step is that
this map of variable had to be defined
somewhere and the type of this variable
is obviously mapper so the GDK eight the
compiler will just say ok I've got the
mapper on the left of the equal sign
then I must have a mapper on the right
of the sign the second stuff is that
there is only one method in mapper hear
what I'm basically doing is I'm just
implementing a method without giving the
name of any kind of class so I ought to
method in it it won't work very well so
this this stuff there is only one method
in mapper his mandatory and third both
the parameters and the return types
should be compatible with the signature
of the method and if i have any
exceptions they also should be
compatible but in fact if i check those
four conditions there's only one that is
really constrained because the other one
are conditioned i already had when i was
implementing method from interfaces of
course and then writing more lambdas
become natural i can write my mapper my
predicates and my reducer just like that
it's let's less boilerplate code it's
probably nicer to write and easier to
read for sure and I can even omit the
types of the parameters of the lambda
expression why because the compiler is
smart enough to tell that the person
seen this is a parameter of the method i
implement should be of type person
think about it it is the first time in
Java then we can write variable and use
it without telling its type we couldn't
do that in jdk 7 so this is new from
Java 8 okay just a quick note about the
reduction how does this reduction work I
told you that defining a reduction on
only two element will enable me to
reduce a big lists and a big arrays so
let's take an array of integer here I
lambda the reduction of the lambda of my
reduction yes it's readable I 1 I 2
gives I want plus I 2 i'm going to apply
this let this expression iteratively
over all my array the first step i take
the two first elements just reduce them
it brings me another integer this is the
first step and then i can take the third
element and one by one consume all the
elements of my right this is how it
works so it's pretty simple and it's
very nice because it's very easy to go
parallel with such an algorithm all I
have to do is split my arrange to put
the first and the second on the two
calls of my CPUs apply the reduction on
each of my calls at the end of the day
will end up with two integers each
computed on edge cause of my on each co
of my cpu and then reduce them again by
applying my introduction one in the last
step this is great by doing that I'm
using a special the special stuff about
this reduction this lambda expression of
reduction is that I 1 plus the sum of i2
and i3 because think about eight calls
or more it's not about to cause should
be equal that the sum of i1 and i2 plus
i3 if I write it differently it's the
reduction of I one with the reduction of
i2 and i3 should be equal to the
reduction of i1 and i2 reduced with I
three now this might be my to raise some
memory into your mind this is called
associativity in math that's probably
not good memories sorry about that
my lambda reduction should be
associative the sum is associative of
course which is great but the sum of the
square of the square the sum is not
really associative we all know that and
if I want to compute an average I really
should not take the i1 plus i2 divided
by 2 because this is not associative
neither how does the jvm of the compiler
help me in knowing that reduction lambda
expression is associative or not it does
not so I can program things with this it
will work computer result this result
will be completely false okay but it
won't crash no exception whatever so I
need to be extra careful with that it's
even even worse than that if I if I take
a given data set reply with a
non-associative reduction on it in
cereal it will bring me a result and if
I run this time these computations have
more than once the result will always be
the same but if I go parallel on that
the result won't be the same because i
have no i don't have their hand on the
splitting of the array so i don't i
won't have the same results for each
ramp which is not very nice and very
confusing okay so a new category of bug
new kind of bug that will have to deal
with great and we have no tools to deal
with that of course okay so what I have
so far lambda expressions it's an
alternative to write in sensor for
instances of anonymous in a class great
very often we can write this person
gives person that gate age and once
again I don't have to preside the type
of person because the compiler can guess
it right and I've got another syntax for
that which is called method reference
and which is this one person the name of
the class collum collum get h name of
the method it might look like a static
code but it's not a static call okay
it's it's really another way of writing
a lambda expression strictly equivalent
to the first one so if you prefer to
write the second one go for it if you
don't like it just keep the first way of
writing things
and I call on and i can also write a
style you static method in method
references I've got two new methods on
the integer class the sem on the max so
i can write lambda expressions on the
expressions like that and I've got also
the string to lower case unfortunately I
cannot pass arguments with the syntax
even if those arguments are constants
which is the case for the local France
here so this is not possible okay let's
look more about lambda expressions I
lied to our three questions about
lambdas the first question what is the
type of a lambda expression in Java
everything has a type so lambda
expression has to have a type what is
this type second question can i put a
lambda in a variable and if i can it
just great because i will be able to
pass lambdas to method method will be
able to regional andas which will be
great and the last question which is the
most tricky of the three is lambda and
object everything is an object in Java
it's a it's a fundamental stuff of the
language what model for lambda lambda is
an instance of a functional interface I
looking for it yep okay okay hi sorry i
lambda is an instance of a functional
interface this is a functional interface
the definition of a function legend face
is the following it should have only one
abstract method and that's it I can put
an annotation functional interface a new
annotation from Java 8 on an interface
and it's just there to help me I bid
that if i put this annotation on an
interface the compiler will raise an
error if this interface is not
functional but I can I don't have to put
this annotation is purely optional why
because with such a definition all my
old interfaces from Java 1 2 3 4 etc
that have only one exact method will
become functional interface so if I have
all jars in my project and I move to
java 8 i will be able to implement those
old interfaces without recompiling them
with lambda expression so this is very
powerful thanks to that ok well only one
abstract method but you can tell me what
what what else can I put in in an
interface about abstract method and
there's only upside method in interface
right yeah but in Java hate this is
going to change and we see that you
already know that great can I put the
lambda in a variable the answer is yes
she really yes this is a consumer i can
write my consumer like that and put this
consumer in a variable no problem i can
also write by the way this consumer with
the method reference yes we'll get used
to that syntax I hope ok and last
question is a lambda expression and
object and now we are going to play a
little game became of the seven arrows
you know that maybe some of you have
children the children are very good at
that game but we are adult and and it's
early in the morning so we are going to
play a simplified version of this game
with only one error ok and the question
is what is the difference between the
code on the on the top and the code on
the back of the bottom now you'll tell
me well the difference is that it's not
the same code yes that's true it's not
the same good but it is the same code
because the the first way is writing
this implementation with an onion was
class and the second who is just a
lambda expression so it's not the same
code but it's it's the same notion in
fact the biggest difference is that in
the first code I've got this new keyword
that I don't have in a second so in the
first version i'm asking explicitly the
JVM to create a new object and the JVM
will do that because it's imperative
programming so the java has to do that
and in the second case i do not so the
JVM is free to optimize things and not
to create a new object so is the answer
to this question is a bit tricky and
said no but it's not really no because
we have an object in the JVM for lambda
expression this object is not a good old
object as we used to have we should not
call the ash cloud method the equals
method the two strings and stuff on this
object it's an object without an
identity and you should not use that
object for synchronization for instance
it's explicitly said in the
specification so it is an object but
with the special status and we prefer to
say that it is not an object in fact
sorry no don't do that forbidden just
use it as a lambda expression and that's
it I've got plenty of lambda expressions
here they are sorry I've got plenty of
functional interfaces in a new package
called Java util functions there are 43
of them so we are going to check them
one by one sorry no we're not going to
do that the only four categories in it
the first category the supplier well we
will see that an example the supplier
the supplier just doesn't get anything
and returns a new a new object the
second category is just a consumer
system dot out dot println do the
simplest consumer one can imagine so
just take an object and doesn't return
anything the fourth category is a
function in fact I don't have the map
interface in this package I have a
function interface that takes an object
think of a person and return the age of
that person and after the predicates
last category which takes an object and
returns a boolean and I've got many
variations on that some function can
take two parameters instead of one and
it's called a bit functions etc let's go
back to the map filter reduce pattern
and what I would like to do is to
implement this pattern using lambda
expression leveraging lambda expression
on the list of person now why should I
do that what is the reason of that
because in all my application the
collection framework is really at the
core of any kind of business application
in Java and my data is mostly in an
interface of collection whether it is a
collection a list or set or map so i
would like to apply this pattern on the
list of person
the usual ways to iterate over the
elements and to apply the pattern so I
could write a helper method in a special
helper class I don't have a lists class
in the JDK so let's create one let's put
a map method in that in that class push
the data to that method my list of
person and push a lambda expression
because of course i'm going to write
this with a lambda expression or a
method reference to the stuff this way i
completely remove the technical code of
computing the mapping from my business
code this code is moved to the API and
this is exactly what i want and i'll end
up writing this kind of thing with a map
the filter and the reduced stuff ok the
API can be optimized in an independent
way from my code two things are
completely separated and this is exactly
what I want to do so this is great do I
have any TV ads in this kind of code
maybe I could take a closer look at it
so post person is really a big list 10
million 20 millions of people in it ok
what do I do when in the first step I
take a list of person and compute a list
of Ages and I have the same number of
edges at the number of percentage this
my list of edges is also a big list and
the filtering step does the same it's a
second duplication start a complete
application with still duplication and
what do I do with those two lists that
were so costly to compute costly in
memory footprint and in CPU on in
computing time well I just sent them to
the garbage collector because all i need
is the is the sum of it at the end of
the day it's just an integer so i spent
a lot of time and a lot of computing
power to compute lists just to send them
to the garbage collector now i'm sure
that there are people from working on
the on-loan on the JVM that work late at
night that would be very happy to know
that we're using the full power of the
garbage collector but probably my boss
won't be very happy with this kind of
thing because all my users okay i'm a
developer so i don't care about users we
another
let's say I killed by a job so I want to
keep my jobs I don't want to to write
this kind of crappy code okay this is
not nice but don't worry we can we can
we can do or we can do even worse in
fact suppose the suppose the reduction
is an all match reducer okay the
different the sum has to scan the oldest
to compute the Sun but the old match
doesn't have to write that to do that I
could write a whole match like that ok
the all match is true if the predicate
is true for oil all the elements of my
list so as soon as I found an element
for which the predicate is false I can I
can return with the force stuff I don't
have to scan the whole my whole list to
get the results I do not need to do that
but it's quite sad because in fact I
already computed the list of the names
of the people so I i paid the full price
of duplicating my big list into another
big list of strings just to realize that
the first name of the first person was
already 22 characters that will return
me false so this is completely silly
this is this is really not the good way
of implementing the map filter reduce on
the on the collection we lost a big
opportunity for optimization and
probably with us our job to because ok
we should have applied that filter step
lazily remember the first pattern i
showed you at the very beginning of this
talk it didn't work like that it didn't
build any kind of intermediary huge list
to compute the map free to reduce so it
was much more efficient than this
pattern so this pattern is useless if
it's implemented in the JDK nobody will
use it nobody ok so this way of
implementing the map it to reduce
pattern is certainly not the right way
of doing things neither this one putting
a map method on a collection map filter
and reduce method directly on the
correction interface is certainly not
the way to go because of that what about
in place operations they will commit we
don't need really to duplicate those
lists we can think about in
operation in fact it doesn't work
because the mapping changes the types of
the list okay so if we change the type
of race it's not an in-place operation
the filtering could be seen as an
in-place operation but if i want to go
parallel then i'll have concurrency
issues because this list has to be
visible among all the cause of my cpus
so in place operations are not a
solution neither we need a new concept
to handle big list as well as small one
by the way efficiently and this concept
is precisely the stream API that we're
going to see the correction framework is
not the right tool for that job clearly
so what pattern to choose and what
pattern has been chosen in jdk 8 even if
this way of writing things doesn't lead
to viable patterns it is still a nice
way a pleasant way of writing things so
what has been chosen is to add an
intermediate call on the collection
framework which is a stream method that
returns a stream interface that is a
completely different thing from the
collection interface and that will
handle the map filter reduce efficiently
for us ok great so I need a new method
on the collection interface last time I
checked the collection interface there
was no stream method in jdk 7 9 so we'd
really need that but if I do that
arraylist will not compile anymore
because already needs to and to know how
to implement this method link at least
neither but we shouldn't be using liquid
list so we don't care about that but
arraylist doesn't compile so there's
something to be done I could say okay
I'm going to refactor a released and put
the implementation of this method in it
but it's not the solution because the
declaration framework has been here for
15 years now they are custom
implementations of correction absolutely
in all our business application in all
our project so what are we going to do
if youíve to to adopt JDK 8 we need to
refactor all our implementation of the
correction interface we won't be doing
that ok so the adoption of JDK 8 needs
another concept to be able to do that
what do I need to do i need to add
methods on interfaces without providing
the implementation in the implementing
class and we and with keeping the
application running okay it's not
possible in java 7 because this is not
the way interfaces work in java 7 so in
java 8 the way interfaces work has
changed we have a new concept of
interface raleys need to know the
implementation putting this
implementation in the ArrayList class is
not the solution so what are we going to
do well just put it in the interface and
this is the concept of default method we
add the implementation of the method of
those new methods directly in the
interface which is new ok great this is
called the default method is about
making evolutions of all interface as
possible in Java does an interface
become the same as an abstract class
this is this is a nice question because
in an abstract class I've got abstract
methods and concrete methods and now in
the interfaces I've got to abstract
methods and default methods so it looks
the same in fact the answer is no why
because an abstract I can have fails an
interface console an abstract class can
have a state which is fundamentally
different from an interface and an
abstract class has a constructor and an
interface doesn't ok and I can put code
in this constructor does it bring
multiple inheritance to Java the answer
is yes but we already have multiple
inheritance in Java if you check the
string type we can see that the string
type extends serializable comparable and
call sequence what we have in java until
seven is multiple inheritance of type
the type can extend any number of other
types what we don't have and what java 8
brings is multiple inheritance of
behavior this is new and what we don't
have what C++ has and what we don't want
in Java is multiple inheritance of state
because this is where the trouble is and
we don't want that in Java
are there any conflicts possible with
multiple inheritance of behavior
multiple inheritance of type I can't
have any conflicts so this is great the
answer is yes we can have conflicts so
we need rule to handle that let's take
an example the class see that implements
a and B and in those two interfaces I've
got the same default method define I
create an instance of C called the a
method which of those two implementation
is going to be called answer is simple I
do not know so if I don't know there
must be an error somewhere and what's
nice is that this error can be detected
at compile time and the copilot I'm is
nice because it's when I've got my
coffee on my eclipse or intelligent
beans or whatever so it's there i will
have this red underline stuff to that
this is the right time to fix this kind
of bug so this kind of vibe cannot be
raised at runtime okay it's at compile
time when I'm writing my code okay great
how can I fix that well I've got two
solutions in fact the first solution is
to provide a concrete implementation in
the class itself and this time we'll say
that the class wins the concrete
implementation will wind over the
default implementation great and the
second rule is to say that if interface
a extends directly or indirectly
interface be then a is more specific
than be so a will be chosen and in fact
this is a rule we already have in the
JDK when we do overloading of methods
between between the different methods
that have the same name in the same
class and i also have a specific syntax
get you a real question yeah oh yes it's
a compile-time error
it was already compiled against you
can't do that because you need to know
both interfaces to write this kind of
code so you can't have the the other
interface at runtime just in another job
sound possible you can't be in that case
yeah yeah then then you have a problem
you need to fix your project I'm sorry
but you should you shouldn't be doing
that clearly but it's not it's not a
Java problem it's a DevOps or whatever
just push the problem energy around
someone else would you care of it ok so
you want the book by the way because
I've got a book to win I said first
question one of the books are you your
mother Barry okay two simple rules under
the conflicts of multiple injuries out
of behavior the first the class wins
plain and simple and the second one is
most specific interfaces went over less
specific okay and this is a role I
already have it the JDK so this is not a
new rule in fact I only have one new
rule which is class wins which is really
simple okay great let's take an example
I guess we all wrote at some point of
our career an implementation of iterator
yes I've got three methods to implement
for iterator the next the as necks and
the remove method which had never need I
mean thank God this method can raise an
exception so I just take that code and
copy paste it in all the my
implementation of iterator it will make
my son of guys cry and shout at me and
send me emails you've got duplicate code
in your in what you've done okay I know
that but it's just that okay it's okay
in Java 8 the interface the iterator
interface has been refactored and the
remove method is a default method so
starting with Java 8 when I have to
build my own iterator I won't have to
implement this remove method anymore
which is great I'll need to find
something else to have my son of guys
who shout at me
okay so the concept of interface change
in Java 8 and I mean it really changed
deeply I guess we all wrote this kind of
code at certain point of our courier
probably at the very beginning ya know
will now be able to write this kind of
code to did you see the difference let
me do it again now we are going to be
able to write this kind of code click OK
we can put static method in interfaces
now in Java 8 why that it's just too
it's just about building new api's new
ways to design api's and we're going to
see examples really very nice example of
that later in the talk so Java 8
interfaces I've got default method
multiple behavior inheritance rule to
handle conflicts so that compile time
and static method in interfaces this is
about moving all the interfaces to this
new Java 8 and about bringing new ways
of writing patterns of using interfaces
in our code great so where are we we
have a new syntax lambda expression we
still have a new pattern to implement
well the new pattern is not new but we
need to find a better an implementation
for the map fields stuff we know how not
to do it but we still don't know how to
do it and we have new interfaces to keep
backward compatibility great so let's
talk about this stream API what is the
stream from a purely technical point of
view a stream is an interface and it's a
typed interface so i'll talk about
stream of personal stream of of strings
of character ok and I've got also a
stream of numbers just to avoid having
to bugs on unbox numbers in my
computation so this is about optimizing
your performances it's a new notion the
stream looks like a collection it but
it's much different from a correction it
has nothing to do with the collection
effect it's built on a sauce this sauce
can be a correction we are in this
example it doesn't have any data
provided at build time and doesn't hold
any data in itself and there is no limit
on the data the source can produce think
about
socket for instance the stream can they
belong a collection iterator
input-output sauce some of those sources
are not limited the first concept where
that I say is a stream does not hold any
data the collection does hold its data
not a stream there's no data in a stream
just an object and I'm going to define
operations on the subject second point
the stream cannot modify its source I'm
going to connect the stream on the
source and I should not be modifying
these source if I do it will come by it
will run it to raise masses of
exceptions it will completely crush my
application but I shouldn't be doing
that Third Point this source can be
infinite it doesn't make a lot of sense
to have infinite source but the only
point is that when I create my stream on
a source I might not know the amount of
data this source is going to produce
this is this is the meaning of infinite
in this context and a fourth point a
stream works lazily I don't want to
build intermediary computation as I did
with this silly list of person so this
stream needs to be towards lazily and in
fact this false notion is completely
linked to the first one if a stream
doesn't hold any data then it works
lazily let us see patterns to build a
stream of course I've got the collection
dot stream call this is why I I changed
the way the faces work in Java I can
build strains on arrays with this new
method static methods on the well-known
arrays class I can I've got a factory
method on the streamer which is the off
method then you can see that the stream
is an interface and the off method is a
static method of this stream interface
sorry consider well okay so this is this
is new kind of pattern from JDK 8 using
the static method from static methods
from interfaces and I've got other
pattern the stream got empty which will
be useful for for testing purposes I
guess swim off with rigid just a single
term and generator an iterator and I've
got a bunch of other methods scattered
all over the place in the JDK for
instant on the string class I've got a
curls method that will build a stream on
the letters of this string of characters
so the the elements of this dream will
be the letters of the string very useful
we're going to see example of that the
lines method from the bufferedreader a
class will be the stream on the lines of
a text file so to analyze the text file
I just need to do that and to declare my
operation and by the way this train is
also plausible so I can use it in a try
with resource statement which is nice
and radam institute to build random
series let us back on our first example
so the first step build a stream on the
list of person second step declare
operation the map and filter operation
are lazy operation so no computation is
made on those steps those method calls
and the reduced step triggers the
computation that will be conducted in
one pass over the data in much more
efficient than the crappy ways we just
saw before sorry yes there is a zero we
go we'll come on that later yeah don't
worry that's Jessie it's a default value
I pass a default value which will be
used if my list in my if my stream is
empty because the stream can be empty I
mean the source can be can be empty can
stop yeah there was a one yes it's also
a seed we'd see that also but I prefer
to present it out as the default value
like that consider your easier less easy
to understand I think three things on
streams first there are two types of
operations on a stream intermediate
operation those our operation that
returns a stream and that don't do any
computation those operations are just
declarations on the stream and terminal
operation that will trigger the
computation its themselves the reduced
call whether terminal operation to
trigger the computation on one pass once
again so again I've got a state on a
stream inside deep inside the
implementation I've got a word well an
int an integer which is a word in fact
called carousel characteristics and I've
got a dozen of bits that have meaning in
this world here for example the size bit
tells me that I know the elements in
that stream the number of elements in
that stream the ordered bit tells me
that the the order of the elements in
that stream has a sense as a meaning
think about an ArrayList this thing did
mean that all the elements are unique
think about the set and salted means
that they are all sorted in some kind of
order think about the sword set and this
is all about optimizing stuff each step
can modify the bits the filtered France
and I know that I have 50 people in it I
filter for people older than 20 I do not
know in advance how many people are
older than 20 so the site bit is set to
zero with this operation and the same
goes for the mapping I can't have the no
duplicates in my list of person but once
I've got the ages I might have
duplicates so the distinct bit will be
set to 0 2 same goes for salted and
suppose I write this kind of code stream
that distinct that is remove the doubles
from that stream that map that filter
that reduce at compile time I don't know
the exact implementing type of my
collection but at runtime I know that
it's an are set so the stream bid on an
asset as the distinct bit set to 1 so
this the distinct call will not trigger
any kind of computation once the result
method is called and the same goes for
the sorted set suppose I want to sort my
stream I've got a sorted method for that
and then forage and print out the result
in fats run time I realized that my
implementation is assaulted set which is
already sorted I certainly don't want to
call the quicksort once again on that
stream so in fact the sort method since
the salted bit is already set to warm
the sorted method will not trigger any
kind of computation okay and last stuff
it's about stateless and stateful
operations and this is very important to
understand for parallelization and
performances some operation are
stateless when I do pay that gate age
all the information about the edge of
the person is held in the new person
itself but if I call limit I've got the
limit method on the street
that will take the 10 million first
elements of that stream not to be sure
that I'm taking the first in one I need
some kind of index some kind of counter
and if I go parallel this counter will
be distributed among all the calls of my
CPUs so I'll run into visibility and
synchronization problem at least this
counter should be an atomic variable of
some sort so this this counter will be
contention point in my stuff this
operation is stateful and a stateful
operation will not paralyzed well we're
going to see that on an example let's
sort an array of string as an example I
could write this kind of code take a
random build us an array of strings and
use this nice trick to generate random
strings okay those are really particular
string because I won't have any letter
pass the f later since this is exactly
single representation of numbers but
it's still a string and I can solve them
do you like this code ought to be java 7
to be told no ok let's rewrite that code
in a nicer way I could write it like
that so in generate and pass a supplier
as a parameter does the same but it's a
directive stream is it better lead like
that well in java 7 i've got a new class
to replace the random class problem with
the random class is that the seed is an
atomic long so if i want to go parallel
little bit contention point in my code
so i shouldn't be using the random class
but threadlocal random current night
long this is from Java 7 by the way ok
but I could write it like that too
because I've got the lawns method
directly on the thread Locker random
class that returns a long string and I
can map this long string to be 2 to
build a stream of strings just by
calling this that i can also write with
a method reference ok much nicer hmm so
let's take the town first million
element of that and let's solve that
stream another computation takes four
milliseconds to run which is fast
incredibly fast when you think of it
that's 10 million random longs to draw
convert them into strings of characters
and then launch a quick sort on it it's
not a bit weird it's a bit fast don't
you think so if I want to copy this trim
in an array it will take 14 seconds to
run ah there are two solutions either
the guys from the JDK that wrote the
limits and salted method it's really a
great job and the guy who wrote the two
array method it's really a crappy job
this is the first solution and the
second solution is there is a trick and
of course it's the second solution in
fact the limits and the sort method add
intermediate calls okay so they don't do
anything when we formally second adjust
to the time it takes for the for the JVM
to fire up in netbeans or in eclipse
okay so there's nothing down here in
fact the salted call just set the salted
bit one and that's it okay so they are
intermediate and terminal operations a
stream is processed only on the terminal
operation call and the terminal
operation is clearly stated in Java doc
so you can check that interlock
basically if a method on the stream
returns the stream it's an intermediary
call and if a traitor doesn't return the
stream or doesn't return anything it's a
terminal call only one terminal
operation is allowed on a given stream
so I cannot build a stream make a first
terminal call on it and then you reuse
that streamed with a second terminal
call this is not allowed the team cannot
be processed again and I cannot clone a
stream neither for for performance
reasons all right what's night with that
is i also have parallel streams and this
is really awesome the first the first
optimization is laziness of the stream
the second was in parallelism what do I
have in my toolbox to do paralyzation in
jdk 7 what the bad news is I have the
fork join and the four joints is not
very easy to use and even less easy to
debug if there's bag without bugs in it
the joint is still present in a jdk
8 and it's the foundation of parallel
programming in
eight but the good news is I have
parallel streams to use the fork joint
to be the parallel swim I can just call
parallel stream directly on the on the
stream while building a stream or on a
given streamer on an existing stream I
can call the parallel method which is
nice how does it work can I decide the
number of calls on which my computation
can be conducted the answer is yes and
the bad news is i need to do that to do
it so it's not not very nice but at
least i can do it in fact in the JVM
I've got a common folk joint pool that
will be used for all the computations of
all the stream of all my streams in my
in my application and I can set the
number of threads the numbers of well
this is not the number of threads is the
parallel ilysm stuff of this for John
pool with with this method call can I
decide to yes sorry ok the next question
you kneel down yeah yeah it's just the
next slide so you won't have the book
I'm sorry again the question is can I
decide on which can i change that
behavior and I can I build this my own
for John put to run my computation in it
the answer is yes it's a bit tricky and
it might change in the future versions
I've got this submit a bill my for jump
oh okay and I pass it call able to the
submit method with my computations in it
and this time my parallel computation
will be conducted in that for joint pool
this is an implementation of a collie
ball a credible is a functional
interface so I can implement it with a
lambda expression which is just what I
do here that I don't show you a question
yeah
is parallel ISM really that simple this
is a rhetorical question it's like the
answer is in the question and the answer
is clearly no the problem is
performances let's take that code it's
just a code that will generate 10
million random values in the list with
the eternal pattern okay let's write it
again with the stream stuff I can use
this stream generate and limit the size
of the string to 10 millions again there
is this atomic long inside to count the
stuff so it won't parallel as well and
this is exactly what I want to show and
the third code does almost the same but
with in a different way it just called
the lungs method on on the shredder
local random class if I run those three
codes on given pc okay whatever it will
run roughly in 300 milliseconds okay I'm
not going to paralyze the first code
because it's so just an iterator pattern
so I want to be doing that but I can
call the parallel method on the streams
from code 203 and what does it give it
gives me this it's not better okay doing
parallel on those streams led to
performance hit instead of performance
improvement why so because I've got
stateful operations in it the limit
method is a stateful operation so it
does not parallel as well and this is
this is the lesson of that and I mean
that there is a hidden stuff in here
that the 300 milliseconds is just using
one core of my server my lonely in this
in the second way the perilous stuff i'm
using the eight core of my server so
I've got a performance aids on my
application but also on the other
applications running on my server so i
should be really extra careful with
parallel ism it's not that simple yeah
it's a very complex question really
there is an article that has been
published a few weeks ago by do glee
with precise guidelines about that and
there are many parameters to take into
account to answer that question but the
first first half it just just do some
tests just as your your your project on
real data sets and see if you if you get
impervious improvements or not and what
I tell you CPUs yeah sorry sorry I can't
hear you yeah yes you talking about the
am the law okay you need you need to
understand that it's it's not that easy
to think and it's not the only the only
problem with parallelization you got an
algorithm that do not paradise at all
the part going parallel will change the
result of your golden so it's not just
about computation performances it's also
about correctness of your goggles yeah
I'm a downloads yes I need to repeat the
question for the recording sorry so I'm
not law would just give you a limit and
nothing more than that yes true I've got
a sneaky problem here let's take an
arrest stream map collect collector to
leach we are going to see that in a
minute just a matter of reducing stuff
in the list okay and suppose and what I
need to tell to to understand is that
the ordered bit is set to 1 because this
is an error list and an original ordered
collection now if I'd want to go
parallel this ordered has to be kept
among the CPUs and it's a huge
performance it because it's it's quite
hard to to keep track of that so before
calling that I need to call the
unordered method that will set the order
bit to zero and that will just make the
computation much faster in parallel
alright so parallelism implies overhead
most of the time means every time and
badly configure parallel operation can
lead to a needed computation that will
slow down the overall process you need
to we need to have that in mind what
about the reductions so we saw that the
reduction is merely the sequel can kind
of sequel aggregation we did that here
with some of Ages what I would like to
do is to pull directly as some method on
a stream the fact thing that I don't
have this some method on a stream on a
tight stream but i have it on endstream
double stream and lon stream so how
could i convert this stream in an
in-stream by the way this is a stream of
integer so i should have a way to do
that in fact I've got a method for that
which is the map to int method I just
Pat the lambda expression to convert the
element of my stream to a int primitive
type primitive Java type but if I check
if I double check my car I can see that
the map call already written is an
integer so maybe I can do that here not
to int at the beginning of my processing
and this will lead to much better
performance because in that way i will
save the cost of the boxing and unboxing
concerned boxing and boxing of my
integer so this will be much more
efficient than the previous code what is
the value of the sum of the persons list
or if the filtering step removes all the
elements from my stream well the default
value is zero okay this default values a
bit tricky and I would like to focus on
that a little what about the max and the
mean how could I choose the default
value for the max operation our first
question what is the default value the
default value is the reduction of the
empty set if I go to an empty set i
reduce it I have the default value but
it's not only that it's also the
identity element for the reduction are
no more math sorry we had the
associativity now we have the diff the
identity element let us see that on the
on the perilous stuff
remember we head out our array we
splitted it into to distribute it among
the calls about CPUs t1 and t2 we
reduced it on each goal and merge the
two values in in one just by applying
that T is the fusion the union of t1 and
t2 and the reduction of T is the
reduction of the reduction of t1 at the
reduction of t2 this is what we wrote
and we need to have that if you want a
repair Allah stuff to work okay now
suppose T 1 is empty my folk John didn't
work very well and if I there's no
element in t1 it meant that T equals t2
alright so the reduction of T is the
reduction precisely of the empty set and
the reduction of t2 which is T and this
is precisely the definition of the
identity element so reduction of the
empty set is in fact the identity
element of my reduction operation mm-hmm
so in fact this old it's also the
identity element for the reduction now
the problem is that the max and the mean
method do not have identity element that
is another element forage max of E and a
should it be equals to a for any kind of
a obviously it's not 0 because the max
of 0 minus one is zero stop minus one
should be minus one minus infinity is
not an integer is not a number by the
way so it cannot be minus infinity a
qubit you'll tell me we are dealing with
integer we are dealing with computer
science so we have this integer that
mean value we could use it as an
identity element in fact we can't
because we can convert integers too long
back and back and forth okay so if I
want to convert this to a long I should
also modify its value it will not work
obviously so the answer to that question
what is the default value of max on the
main is plain and simple there is no
default value for the max on the mean
but the next question is what should be
the return type of the max method
because if it's an int Java primitive
type then the default value is zero and
it doesn't work average set the integer
then the default value is new if you
have the feeling that you don't have any
enough nullpointerexception in your code
you can choose this personally I
wouldn't okay so what has been chosen is
to introduce a new concept in the Java
language the concept of optional and in
fact the return type of the max method
is optional int in this case could be
optional of tea journalism as an
interface and this option Elysians it is
in fact an integer of rapper rapper the
integer is also already a rapper type
for the for the int primitive type but
it there's also value there's always a
value in it the difference with optional
painted that there might be no value in
it because if the the max of the empty
set will lead to an empty optional how
can I use this new staff I've got four
pattern 22 for it in fact the first one
is to test if the if it all the value
I've got there is present method and a
get method to get that value I can also
read the value and get an exception if
there is no value in it third pattern I
can read the value and provide a default
value now this is not a general default
value it's just a value default value
that has a meaning in the context of my
application which is much different from
the real default value and the fourth
pattern is raise an exception and I
provide the exception supplier which is
lambda expression to build the exception
if I need it okay so new concept
optional in Java 8 i've got available
option all these it's a type tired
parameters of sorry it's typed interface
so I have it like that I've got a bunch
of reduction defined on the stream
interface I've listed them all some of
them will need to to to scan the all set
with all elements of my stream but not
all of them
for instance the fine first of fine any
will not need that though they all match
neither and on the streams of numbers
I've got two for the method the average
method that will compute the average for
me and the stammerer statistics method
which is a great method that will
compute a bunch of Statistics directly
on my stream on one pass I've got the
account with me in the max the Sun on
the average and if you need another one
you can very easily extend this stuff to
compute other statistics if you need so
this is really great with method and
once again it works in parallel so I can
paralyze that stuff to do to compute
that and then I've got another type of
reductions called the mutable reduction
I told you that the reduction was not
only about aggregating stuff and this is
the case how does it work this is an
example of mutable reduction I will in
fact accumulate all the elements of my
stream in a given list with this pattern
collectors dot to list let us see
another example collectors the joining
will join of the name of the people in
this list into a given a give into a
unique string of characters of course it
works with string buffer so it's very
efficient this is an example of a
mutable reduction beautiful reduction
are about putting the elements of my
stream inside a container this container
can be a collection or a stringbuilder
as we just saw bit it can also be rash
map and we're going to see examples of
that what do I need to build such a
stuff I need in fact two things and
optionally a third one the first thing
is a way to build the container which is
basically constructor it's a lambda
expression the second thing I need is
how should I add a given element of my
stream to that container concatenation
of a string or just an add method of
arraylist and if i want to go parallel
it means that i will have to partially
filled instances of my container on all
the cause of my CPUs I need a method to
combine them to merging into one so this
is for paralyzation if I won't don't
want to go parallel I don't need this
third operation how can i read that
collect the constructor of a release for
instance new released this is called the
supplier building your list the
accumulator this is the method of adding
an elementalist very simple and the
combiner just an adult call or on the
earliest the combiner will combine the
two partially filled containers build on
each cause of my CPUs i can also write
it with method reference which leads to
probably much readable code mean easier
to read code than the previous statement
with the previous way of writing things
okay and in fact i can all this element
have been wrapped in a special object
called the collector I've got these
collectors class and the collectors to
list just wraps these three operations
great let's talk about the collectors
this is a really great great way of
processing data the collectors class is
a factory class it has 37 method with a
bunch of magic stuff in it really we are
going to see that an example if I want
to collect my stream and compute the
average of the edges in fact I've got a
collector for that dredging double I
pass a lambda expression that will be
applied to all the elements of my stream
and this will give me that the result i
want i can count the element of my swim
with the special collector's collectors
that counting i can concatenate all the
elements of my swim and this time i will
pass these little strings of character
to the joining method and this strength
of character will be used as a separator
inside my concatenation so you can throw
away this silly code c string builder a
tad and the end of the day you need to
remove the separator because you have
one less a brighter than elements so you
we can just use that too good to
concatenate stream straighten forward i
can accumulate in a list okay we already
saw this example like we can also
accumulate in a set I've got two
collectors to set and if i want to
accumulate in a
facial structure I can just pass the
constructor that structure for instance
in a tree set here if I get the max i
can compute the max of the stream
because I've got two collectors for that
max by and this this will return an
optional of course we already see that
and to this max by call I am going to
pass a comparator now can you see the
new way of writing comparator from Java
8 comparator comparing person that get
age ok so this is a new this is the kind
of new way to write API was talking
about a few minutes earlier comparing is
a static method from the comparator
interface that will enable me but that
will much simplify the way we write
comparator let's write another
comparator more complex do I need to
tell you what does this compare to do I
don't think so new way of writing
Capasso comparing is the static method
of the comparator interface and then
comparing is the default method on that
interface comparator is still an
optional interface because i only have
one abstract method and nearly all of
the the method from the java.util
functions package I have only one
abstract method but a bunch of static
and default method just to leverage new
new way of you using them by the way
this new compared to a PR just great I
can reverse the given compiler once this
is built with the reverse method which
is great and if I want to sort list you
know that while sorting lists you never
you never know what what you want to do
with with no values which is a potential
I put the new value either at the
beginning or at the end of the of the
sorted list in fact I've got the
comparator for that nulls first we'll
put the new value at the beginning of it
and news last will put them at the end
of the stuff ok so this is really great
I've got a grouping by method on the
collectors API used to build ash map let
us see that on an example stream collect
grouping by person
get age this will be the ash map the
keys are the ages of the people and the
values the list of the people of that
age automatically and if I'm not happy
with that list if I want to too precise
that I want to set something I can pass
another collector as a parameter called
the downstream collector to tell in this
case that I want to set instead of a
list which is great this is just one
line of code you can imagine the amount
of code I would need to do that with the
jdk 7 iterator pattern probably much
painful if I want to to further press I
think here with these collectors that
mapping which does a mapper as a
downstream collector okay I could just
get the last name of the person put them
in a set and this will give me a map of
integer the edges of the people and only
the name of those people put in a set
and if I want to solve them in the
alphabetical order I can also pass the
constructor of the tree set as a
parameter and get them in a tree set
instead of a plane set and if I want
this map to be sorted in the increasing
order of the age I can build a dream up
by passing the constructor of a tree map
as a further parameter do you like that
no I don't like it perfectly terrible
pattern okay nevermind how to create an
age instagram what is an edge Instagram
adjust ash map the keys are the ages of
the people and the value is the number
of people of that age okay this is just
a one-liner grouping by person get age
pass the downstream collector which is
the just accounting collector great i
love that one really i've got a
partitioning by method that creates a
map the values are brilliant so i only
have two values for boolean which is
true or false of course so I just
specify a predicate and which will cut
my distribution of people in two okay to
the false value I will have the people
younger than 20 and to the true value of
the people older than 20 which is great
also and now of course I can pass the
downstream collector
that collect 22 so let's map that
extract the last name of those people
and collect them in a tree set to have
them sorted in alphabetical order once
again this is just one line of code
great well the line of code is a bit
complex we need to indent it if you want
to read it easily but it's still a
one-liner I've got a collecting and then
method which is called the finisher
method this is a post-processing over
over the the stuff all over the map you
see and are just going to pass the map
gumgum entry said this is a once again
this is a lambda expression that will
compute the entry set of of my map so
this is basically a set of key value
pairs wrapped in a map to the entry
stuff and that's it this is called the
Fisher this is the only way by the way
to a compute immutable ash map if you
want to compute immutable ash map you
you need to pass this collection and
modifiable map a lambda expression and
it will return you an immutable ash map
one this is this is built maybe you want
to see real example ya know live coding
do you like that no you don't are there
any developers in the room yeah okay is
it readable for the people at the back
now stop sorry I need to take it a
little bigger get rid of that is it
better yeah that's nice alright so one
can find really many things on the net
very interesting things in this file
words that Shakespeare that takes T I've
got all the words used by Shakespeare in
its place books and stuff and in this
other 50 SPD that exceeds it stands for
official scrabble personal dictionary
I've got all the words aloud efficiently
allowed at the for the Scrabble game in
English this is
can you see where I'm going to and on
Wikipedia because I'm sorry I'm French
that the scrabble game I have a dome is
a French version so i had to find the
english version of this cause of the
letter of the scrabble game and also the
numbers of each letter in the little bag
with all the all the letters you know
everybody know Scrabble don't you yeah
for instance there they are too why in
English Scrabble and there are only one
why in the French couple and the scope
the Y is not the same it's worth four
points in English and tenure in French
so it's not the same how many words do I
have I have roughly twenty four thousand
words of shakespeare and eighty thousand
words available at the scrabble game
another question is what how good at
Scrabble would check they have been if
it was able to play Scrabble of course
it's not the case because scrabble has
been invented much later than than
Shakespeare but this is this is the
question I would like to do so the first
point is how can i compute a score for a
given word at Scrabble I need to build a
function that will take a word as a
parameter so a string and that's where
we tell the number of points of that of
that of that word that is an integer let
us call it this method score it takes a
word and entrance this is a string and
the compiler knows that now how can i
compute the score of that what i could
do is build a streamer on the letters of
this word transform this the stream of
letters into a stream of integer and
each integer is the score of which given
letters and I've got an array for that
and then sum it up so in fact computing
this Cove a word in scrabble just a
MapReduce stuff so I've got this very
nice method I showed you in the slide
could cause that will do exactly what I
need this car method builds a stream
over the letters of this world I'm going
to mad that each letter should be should
give its call so let us copy pay
that and I'm going to use that old trick
from the sea time later minus a you'll
know that trick don't you and just send
the stuff okay and that's it this will
compute the score of a given word for
the Scrabble now what I would like to do
in the first step is to build a sh map
to see the repetition of all the the
words of shakespeare compared to their
scores i'm going to be lush map the key
will be the score of the words so
integers and the values the number of
words that have this core in the
shakespeare dictionary and i'll take
long to muddle that so this is a map let
us take the words of shakespeare build a
stream on them and collect them in a
hashmap sorry in a hashmap so collectors
grouping by I regroup my word by score
score is already lambda expression it's
really a function so I just pass that
function at the first parameter of this
collector and then the profs processing
if I don't do anything it will build me
a map with on the value with the list of
the words and this is not what i want
what i want is the number of the words
so i just passed a downstream collector
just to count them and that's it let us
print out this map and see what it gives
okay so have got roughly thousand words
for six points if I check the maximum
I've got two words worth 40 points sorry
okay so let's have a look at those words
instead of I want I'm going to filter
them filter them I'm going to keep the
word it does call this word so I've got
the apply method apply word is greater
or equal then 40 yes okay so I've got my
only my two words in my ash map so let
us change its ash map instead of
counting I'm going to put the
words in the list like that so it's not
this map anymore this time it's a map of
integer the score and instead of the
number of words this time is the list of
the words so a list of string all right
let us run that so I've got two words
it's very hard to pronounce okay
honorific Abby Lee to deny that abuse
hey did it and they began its out right
should be worth should be was more than
40 yes that's true but there might be a
problem with this way because it's
really a big word I mean probably even
bigger than the scrabble ball no so I'm
not sure I can put it on a Scrabble
board what i could do is just remove the
word that are not allowed in the
Scrabble game and I've got the the
scrabble dictionary for that some sorry
for Shakespeare but this word won't be
accepted I apologize I don't you just
want to keep a word if its present in a
in a scrubber in the scrabble dictionary
and by the way this so lambda expression
i can also write it like that with a
method reference up nice okay let's do
this stuff again and count the word with
this new with this new condition let's
have a look at the max so I've got the
word with 29 points and another one with
33 so let us filter that greater that 29
ok so let us have a look at those word
and see the list
okay so the two words are whizzing and
buzzards and now there's another issue
with those words because well as a
Frenchman our first time I saw that you
okay buzzer there are two Z's why not
but I went to Wikipedia yeah I went to
Wikipedia and check ok how many Z's do
they have in the English Scrabble and i
discovered that there's only one z yeah
absolutely there's only one Z so to be
able to write whizzing I need to use the
blanks letters all right but I've got
only two blank letters in a scrabble
game both I think it's the same for
languages this time okay I only have two
blanks so in fact I should modify the
way i compute things by saying okay all
the words that need more than two blanks
should be removed so this is a further
filtering this is a filtering step and
the second thing is if I'm using a blank
to write Buzzard then the second blank
should should score zero point so I also
need to change the way i compute the
score of the scrabble the way i compute
it is not the right one anymore and all
the beauty of it is that it's still a
map filter reduce stuff let us do that
how could I know the number of blanks I
need to write a given word at Scrabble
what I need to know is that there is one
B and compared to the number of
available bees in my game one you do
these and see that in fact i only have
one Z etc so the first thing I need to
do is to compute an Instagram that will
give me for each letter the number of
letters needed to write that given work
an N histogram is ash map and an ash map
is a collector's grouping by so let us
compute that let us write a function
that takes a word string all right and
that switch on the ash map the keys of
that ash map are the letters so the
letters are modeled by integers and the
values are the numbers of letters needed
to write that given work
so it's a long map integer and long so
this is my instagram basically let us
call this function is to it takes a word
as a parameter i still need the streams
of the letters of that world now this
stream is not where it's a real strain
but it's an int stream and on and the in
string I don't have the correct method
that works in the same way of the stream
of integer so first I need to convert
that stream into a stream of integers
I've got a method for that not to ob's
that just take integer new the
constructor of the integer class okay
and once I've done that all i need to do
is to collect that stream in a map
collectors grouping by the keys are the
letters themselves and it's it's already
a stream of letter so it's just the
identity function okay and i need to
count the number of letter in that
stream so it's just to collect us dot
counting all right by the way i can
rewrite this with a static method of the
function interface which is identity ok
so this is this is the way this it will
sorry this will give me the histogram of
the letters of a given word once i have
that i need to compute to write another
function that will also take a word
sorry the string of character a word as
a parameter that will compute the number
of blanks that i need to write this
world so a number of glances along and
i'm going to call this function and
blanks takes over third parameter i need
to work with the Instagram of this world
so let's apply the Easter method to that
world what do I have here i have this
which is a map and i can't do much
things but thing with the map in the
stream api because i don't have a stream
method on the map interface
I need to convert this map into a map
dot entry set stuff in sorry set of map
dot entry stop the set of key value
pairs to be able to drill the stream on
it so I'm going to create to call the
entry set stuff let us do it like that
and build a stream on that because an
entry set is a set here I've got the
stream and the element of that stream
this room has been built on the entry
set of this sorry of this map so the
element of that stream is a map let me
write that here is a map dot entry of
integer and long ok the integer being a
letter and the long being the number of
time this letter is used in a given web
in the given web what should I do with
this dream I need to map it and to tell
it for this letter I need a blank or not
so I need to compare the number of
letter in this key value pair to the
number of letter available in a scrabble
game so it's a map all right I take an
entry as a parameter and then I need to
compare let's rattle a here the entry
that get value which is the number of
letter needed to write that word and
sorry I need to go and read the content
of this array
entry dot get key is the letter itself
minus a and this number doesn't compile
because it's just cool away sorry oh
thank you and this number is the number
of available later for this letter in
the scrabble game so what I can do is
just make the difference compute the
difference between those two numbers if
the difference is negative it means that
I've got enough letters in a scrabble
game to write my word if it's positive
it's the number of blanks I need to
write that word so all I need to do is
to take the max those are inter sorry
loans take the max of 0 and this
difference yeah where is it I ok thank
you here yeah so I need one here and
this one is not needed anymore ok so
this is this is the number of blanks I
need to to do and what I would like to
do is to sum all this number of blanks
for each letter so it's not a map that I
should use better map too long to be
able to use the same method on that does
it compile it does so I guess it works
ok so this is the number of blanks I
need to to consume to write a given work
another second thing I need to do well
the third thing the first one to build
the Instagram is to compute is to write
another method to compute the score of a
given word taking into account that
there might be blanks used to write that
word and I need to completely change the
way I'm going to sorry and I should
completely change the way I'm going to
write this the
this call the beginning of the code is
the same because I will go from the
Instagram I'm going to call that skull
to its ask also it's cause our integers
okay so this is still a map entry of
some and this time it's still a map this
time I am going to multiply the score of
each individual letter and by the number
of letter needed to write that that word
taking into account that this number is
limited by the number of letters
available in the scrabble game so what
is the score of this stuff it's okay so
it takes an entry as a parameter the
scope this stuff is this one I already
wrote that so let us just copy paste
that the letter is the entry that get
key this is my letter so this is the
score of the given letter times the
number of later used so this time it's
not a max it's a min integer because the
score is an integer that mean between
what between the number of letter entry
the gate value which is the number of
letter you used to write that word it's
a longer rapper type so i can take the
in value of it because i need to convert
that to an end and the number of later
available in a scrabble and this is
exactly that i already use that in a
previous case okay and i need to cast
that to an it because it is along
alright so this is the number of later
used to write that word taking into
account that some of those letters are
blanks and once again since i want to
sum it up i need to to call the map to
end and call it some method at the end
of it all right I think it should work
ok so now I've got this method to
compute the number of blanks I need and
the new scoring function so I need to
change the way I build this ash map
step is still the right one I need to
filter feather because I want to remove
the word that need more blanks then
available and I've got two blanks in the
scrabble game so number of blanks should
be lesser than 2 the score is now a
score to because I change the scoring
function and by the way I'm going to
comment that let's go to hear and I need
to redo all the stuff that is to build a
new Instagram of the stuff but that's it
let us run that yes so this time i only
have scores of 25 and 26 so it has been
lowered of course let us have a look at
those words did this word of 12 that
that is worth 2626 okay i need to have a
look at that word
it's towards quizzes the best word of
Shakespeare's quizzes worth 26 points at
the Scrabble game and the beauty of it
is that i also found another file with
the words of Dickens so if Shakespearean
and Dickens would have a scrabble game
together okay which one would have been
the better the answer is just one click
away ah might be might be Dickens is
winning with the squeeze that whether
the DS was to point instead of one so
they can could have baked them
Shakespeare the Scrabble game I'm very
happy that we could answer this
fundamental question of computer science
with you thank you and by the way what
we could you work with we could look
once we have those those tools is to
check that the scrabble game is a very
cleverly designed game because i would i
would like to have a look at the word
that i cannot write due to the fact that
it would need three blanks instead of
two let us take the word of Shakespeare
build a stream on them and just filter
out the words that need more than two
blanks and let us just count them
whatever okay so the count method will
return along yes
and let us have a look at that
oh this one there's only one Shakespeare
has only one word that cannot be written
at the scrabble sorry Dickens and
Shakespeare and Shakespeare three so
they're not many word that cannot be
written in the scrabble game if I most
of the world can be written that thing
about that there is a twenty twenty four
thousand words in the Shakespeare
dictionary okay great so the example
available here and i'll push this stuff
here and by the way we can go further
with that is that wants you one we have
got the word we can still further
optimized by telling okay which word are
we going to how can we place this word
on the on a given on the scrabble grid
and there is this double letter square
on that so you can so you can optimize
that also is it okay I can put it on
twitter if you wish if you just google
it you'll find it don't worry okay so
this leads me to the to the conclusion
of this talk we ask two questions at the
beginning of the talk and the the first
one why was why a lambda expression
introduced in Java 8 and I mean
everybody every kind of blogger on the
Internet has an idea about that and the
first idea it's because it's in the mood
think think about it they even have
lambdas in C++ we didn't have any java
that's crazy okay so i'm going to show
you something that was in the mood when
java was invented and that might be not
that much in the mood nowadays now you
shouldn't be laughing because this is
Saturday Night Fever yeah it's a sex
symbols of the 70s really we did the
collection framework was not introduced
in Java too because it was in the mood
at that time and we are not using the
collection framework 15 years later of
16 years
because it was in the mood 16 years ago
it's because it helped us to build
better applications and to write better
api's and that's it the second thing
that we read is because it allows us to
write more compact code ok so i'm going
to show you what is compact code this is
compact code this is C code ok it does
come pi by the way and it also does
execute we can run that and if you run
it you will end up in that this is
called a mandrel bolt set maybe maybe
some of you and know that this code has
been submitted about 20 years ago in a
contest that was held i think it was in
berkeley or something the contest was
about writing the most unreadable c code
possible and guess what that code did
not win the guy who won the contest was
able to write his email address at the
beginner at the center of the mandible
code unfortunately the internet seems to
have lost track of this artwork too bad
really this is not about writing compact
code this is about writing readable code
why because we spend much more time
reading code than writing code and
usually when I read up sorry when I read
code that someone else wrote it's to fix
a bug some are not really in the mood of
very happiness not very happy to do that
while my under been introduced in Java 8
because it brings new and efficient
patterns that enable performance
efficient computation parallelization we
need that for our applications and obey
API writers also need that and this is
exactly what Java 8 is about with the
lambda expression on the new interfaces
tava hate has been released 10 weeks and
Monty got nine months ago it's the
biggest update of Java in 15 years there
were more classes modified by the
introduction of lambda expression than
the number of classes modify by the
introduction of generics in Java
5-10 years ago so it's really a huge
update moving to Java 8 I heard that
some of you guys already did that will
mean a lot of work for us self training
to really learn how to use lambda
expression to really learn how to use
this stream API and the characters
changing the way we think our
applications think of the Shakespeare
example of the scrabble example I mean
it's about leveraging the power of the
streams on the character ok but it's
also about thinking the way I can do it
my data processing stuff differently
think about the amount of it or volcko
that would have I will need to write to
process this example so it's about
really changing how habits and this is
the first time that happens in in Java I
mean the introduction of generics didn't
change the pattern the introduction of
the strain API does changes the pattern
and also convincing our bosses but this
is always the most painful stuff of
course shooter it works there are
several books are released and all the
authors of those books are present in
Java want so if you can meet them and
have charged with them the all those
boots are really excellent there's no
difference this one should come a very
soon by Maurice naphthalene so go check
it to go to go go go check them and use
them to learn that in 1997 james gosling
the father of java wrote the seminal
article called the feel of java whether
we can still find it on the internet in
which he said he said that java is a
blue-collar language java is about
writing applications solving problem in
an efficient and productive way it's not
a PhD thesis is not only it's a language
for a job and Brian gets the creator of
the the stream API and lambda
expressions made an interview about a
year ago or in 4q in basically in that
interview basically said there is it the
same thing introducing lambda expression
is not a goal into itself it's not about
being cool or being in the mood or
whatever it's about bringing new tools
tools for the job to build new
applications and to build new API which
leads me to that conclusion
is that even 15 years later the good
news is that Java is still Java which is
good for our jobs thank you for your
attention
and I'm happy to say that we are time
for questions which is great so if you
have questions yes please so the
question is about the synchronization of
the stream API I don't quite get what
you mean either way to receive a future
from that no there's no there's no
matter that we turn the future as far as
I know but you can still put it in a
render bowl or callable or whatever and
get a future on the results there's no
problem for that but it's not introduced
in there in the API itself any other
questions yeah sorry so I didn't hear
what you said yeah Oh can still boot yes
yes you can nest dream and there's a
flat map method to flat everything if
you want to unless the the nested stream
and angles yeah
so the question is about the different
performance across the different JV ends
the power lead is just is really an API
stuff all parallelism is handled inside
the JDK itself inside the classes of the
JDK so if you want to go parallel you
just need to call that and the JVM will
eventually optimize stuff through the
JIT compiler so you fall down on the
same kind of difference of performances
that you have one on regular
computations I think I domain admin by
impacted sorry there's no reason for
that really I mean I mean if you have a
Jovian that is slower for certain kind
of computation it will also be slower
for this kind of thing because the
parallelization is really handled on top
of the JVM and not inside the JVM itself
okay yep the scheduling strategy for the
paralyzation it's big on top of for
joint so all the scheduling strategies
is assembled by the for joint itself the
fortune has been modified between Java 7
and Java 8 doesn't work exactly the same
it has been optimized
oh yeah no you you no no you can't do
that when you call parallel in fact what
you're doing is that you're just
switching this yeah so the question is
about applying different filtering
filtering functions different predicates
and is it more efficient to apply one
predicate with the end in it which is
possible by the way because I've got an
end method inside the predicate
interface yeah yeah that does the antis
the default method of the order yeah too
and there's also dot not do you really
need to check that those those
interfaces because there are many many
different methods in it that to compose
function to compose predicates and stuff
so is it better to have two predicates
or chop just one merchant one it really
depends on the on the amount of data
that each predicate will we will try and
it's not always possible to merge
predicate because they've got a filter
map and at another filter the type of
the stream will change and the predicate
won't be the same and it won't be
compatible so it's really a matter of
organizing your your processing and
yourself ok yeah just color to static
yeah so the question is out to compare
lambda object to static objects you need
to go and listen to Brian goods just 30
minutes in the room next to here on the
dollar where it is exactly and they will
answer that question much more precisely
than I that I can pretty thank you any
further question yeah
paarl dream for hydro array so the
question is is it possible to use
parallel swim for i/o operation under
and the answer is yes you can do that
now it depends on the type of i/o
operation you have and it depends on the
is your IO peril a parody table or not
this is this is in fact that the real
question inside because you shouldn't go
parallel if you have a state full
operation they said this is the
principle if you do that you you won't
get any any better performance it will
be even worse in fact so this is really
what you need to have in mind before
going parallel so okay so we do I need
to repeat sorry father for recording the
fall jumper is not suitable for parallel
operation for i/o operation it depends
on the i/o I think depends on the i/o if
you should just reading 15 of course it
doesn't make sense ensuring a bunch of
files or bunch of circuits maybe could
make sense thank you any further
question yeah yes I posted the slide a
few days ago on the Java one side but I
modified them sorry so I put the last
version on it and I tweet about that on
a on SlideShare because the stag would
be also on SlideShare thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>