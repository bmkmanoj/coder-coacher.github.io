<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>CON3672   Docker for Repeatable Builds | Coder Coacher - Coaching Coders</title><meta content="CON3672   Docker for Repeatable Builds - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>CON3672   Docker for Repeatable Builds</b></h2><h5 class="post__date">2015-12-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/M2FIk14h5k0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everyone welcome to my session the
path to repeatable builds it did mention
docker in the schedule so there will be
some slides and sams some bits of story
about docker later don't worry let's
start with the basics my name is Andrea
chic I know it's a bit hard to save
pronounce and spell so I have a shorter
twitter handle and those ties will be on
SlideShare and as far as I know they
will be put up and somehow synced with
the youtube channel for java one so of
course can take pictures but you don't
have to a couple of facts about me I
come from Krakow Poland but I live in
London and I organized a conference
called geek on I lead the polish java
user group i have been one of the
founders of the software craftsmanship
in crack of founded crack of Hadoop user
group so I've been involved in the
community for a number for a number of
years and in a number of ways and if you
have twitter well I know that Java one
has a handle and they have a hashtag and
i also have a handle so nothing boosts
the ego like seeing tweets immediately
after this talk and there is an
important know that I have to make if
you have any questions try to wave your
hand and attract my attention because I
will have well I have three sessions in
a row today so immediately after this 1i
will have to run to the other hotel so
as much as I would love to have a long
long conversation with the corridor and
argue too well probably to lunch that
will not be possible so questions try to
raise their race your hands or approach
me midday somewhere I will be in the
hilton later so to start with something
moralizing for the morning it's just
like I really like and it's what I try
to apply to whatever I'm doing with
computers sometimes when I'm doing
something it seems like a great idea and
you might have experienced that
yourselves and then it turns out to
discredit great idea is so well there is
a quick fix there is a workaround and I
keep doing that and I keep doing that
and it turns out that i'm doing this big
bowl ugly head
bowl of mud and the idea is not really
that good and then if you multiply that
not so great idea by results it's not
really different from from a very bad
idea from the start so I try to ask for
feedback and I try to ask people if what
I'm doing makes sense so I would love to
get your feedback after the talk so
please tweet and a disclaimer of course
for the legalese people from where I
work my opinions are my own I'm not
representing a company I work for sorry
yeah so let's start this talk is
constructed well it's made of a number
of episodes it's about the journey that
I've went through with a number of
companies and some some of the patterns
some of the things I observed around
continuous delivery around builds around
pipelines so some of the things that I
observe some of the common themes and
common patterns that some companies
stopped at and then they are happy or
less happy and what can be done about
that the first one I call it the new
Jenkins if you can see a reference to a
popular movie you're probably probably
correct what happens a new department in
a new company and you probably have
witnessed that a number of times so what
happens well of course developers come
in everybody is so eager so so so
focused so we'll do this code this time
will be it will be different due to all
be perfect and two weeks later usually
am will need the Jenkins so somebody
will download Jenkins or team city or
well your favorites continuous
integration tool they'll try to set it
up probably on their own machine because
well that's where you start and that's
that's the easiest and then you get this
at first ad hoc manual Jenkin somebody
runs and only if they are in the office
and that works and that's there because
well as I said the department is new you
need to run the test somewhere because
you want to meet making progress after
some time that happens and what happened
in the case of my last place I worked
for it was a development box
and see I which also likes well makes a
lot of sense to dusk that that desktop
was very powerful the caveat was that
was a development desktop so it was in
the office if somebody tripped on the
cable if somebody well disconnected the
cable if somebody wanted to use the
desktop well our Jenkins our CI server
was affected so what happened later that
desktop was turned completely into a CI
so somebody didn't have a desktop it
worked on of course it worked while it
work which means when it broke down
somebody had to fix it because I hope
that that was a development test but you
can expect that nobody was managing that
system in a way that you would expect to
for a system to be managed and then of
course somebody had to fix it first
question is becomes who fixes somebody's
development test when that person is
away now it's not me I don't want to
touch their computer I don't know to
touch their computer it's not mine i
really don't know this flavor of linux i
have no idea what to do on windows you
probably have seen that before so what
happens what since uses magic mysticism
well problems in pain its gory on a
scale from 1 to 11 with 11 being
reserved to absolute awesomeness just
gets a one why does it get a one because
it's not repeatable it doesn't scale yes
it gets you somewhere but this is
exactly as good as Jenkins hosted
somewhere in the cloud or Jenkins being
run in a vm on your machine and actually
Jenkins being run on on a vm on your
machine has the benefit that you can
share that vm with with other people so
you can store it in a safe place and
when it goes badly you can actually
revert to a better place if thats
adjusted desktop that's running jenkins
things will break what happened in that
case we went from a develop from a
desktop running Jenkins on on its on its
own to a box that would be running a
virtual box with Jenkins why virtual box
because it was the easiest thing to set
up what happens well it that work pretty
well for quite some time until somebody
up gets upgraded the host and then
virtual box broke and so we were with
obviously
I for a couple of days and then only one
person wanted to be the person fixing
that because that involved some hacking
around Colonel configs because that's
what they found on Stack Overflow some
other people would say then Anna's just
get rid of whatever whatever is there
and then reinstall it no it was a person
it became a personal challenge to fix
that desktop so as you can see well from
a development team that point that needs
a CI point of view it's not really the
most efficient way from somebody wanting
to play yes it's it's ok but as I say I
would prefer to have a dedicated box
something that everybody looks up to and
not not such as somebody's under the
desk not of course not to mention the
cleaning stuff that can sometime that
sometimes want to water the plants and
then of course from time to time not so
often but they do water the server or
the computer that we have in the office
and then well moving on episode 2 well
no Dwarfs as I said I mentioned all the
cleaning people or just me being
stopping the office in spilling coffee
everywhere machines break that's that's
not a surprise of course when that
happens everybody is surprised because
well I know other machines break but it
doesn't affect it never happens to my
machine my night book my my I don't know
might my desktop is super and it used to
be the case for me but this year I'm on
my sixth macbook pro for a number of
reasons so yeah machines never break for
me until they start or they they never
did because now it's too late and same
happens to desktops of course so
machines fail and you need to do
something when that happens when a
machine fails well you need to create
another one that's that's that's obvious
but also you need to create more see is
when you have more bills because when
you have more bills that need to be
happening and the resources are the
constraint well did you just need more
CPU power how do you get that well
machines if you're on Amazon or
somewhere you just will click if you're
in a desk in an office environment well
you maybe not messy you do click a bit
fast
also we'll have to reconnect something's
the problem that happens is you need to
get those boxes into a knot maybe maybe
not a shirt state but you need to
install Jenkins you need to install all
the other necessary things for all those
servers so to do that we used oh not
this Jeff this Jeff we started doing
Chef and chef for those who here has
heard of Jeff well half of the room
that's that's good for the rest of you
it's a configuration management tool so
it allows you to express infrastructure
and system configuration using code so
we don't have to right bass you don't
have to write I think it's called
PowerShell on Windows but I don't touch
windows I'm very proud of it the thing
is it allows you to write some code and
then apply to a number of boxes and
that's that will get them to a state
that you want them to be which means you
can quickly spin up or have a number of
the of Jenkins boxes and move on pretty
pretty fast and concentrate on
development so what happened there
because we had a way to bring
effectively to break machines and people
started feeling empowered to doing so
doing things to the VMS to to see I
servers to the software which is good
because well we are developers we are
change agents we want we actually need
to change we are paid for bringing
change to two organizations having a way
to revert to a very safe state even with
something as important for a development
team as as the CI server means it's it's
okay to break stuff it's okay to play
because well in the worst case i'll just
will click a button wait a couple of
minutes 44 chest to execute and then
everything will be there my machine will
be in a state that i know and from a CEO
from development team having a CI point
of view it's it's absolutely awesome
because if anything goes down click wait
you're there if you need more boxes to
to run your bills click wait you're
there so
that situation of course was so good
that a couple of other things had to
happen first of all we started checking
our Jenkins server and our nodes and
that was awesome first of all because if
java and our typical development
department for mostly java developers
starting using cheff so sta started to
learn about Linux they started to learn
about how you do system configuration
they started to learn people love
learning of this I love learning and
data gave people the feeling of power
now I'm the awesome omnipotence
developer who cannot not only do
backends they can do front ends with
angular and I can also do servers it
feels good of course we will later
realize that you're not as an XP as
experienced a system admin as it could
be but it still means that you actually
can do something in that very space
space that probably you some of us never
touched what happens also is we try to
go a bit too far in certain directions
so when all you have is a knife or the
knife that you're using is extremely
comfortable you're going to try to see
how far can you push it so for us that
meant trying to check configuration so
trying to generate a Geoff Jenkins
configuration which is an XML file using
to Ruby templates and a lot of nested
ugly for loops it sounded like a good
idea in the beginning it felt like we
are not exactly sure when we started
doing that a bit into the task and then
it turned out to be an absolute
nightmare and maintainable piece of code
that only we could fix nothing on
stackoverflow it's not that we need it
but it's a very useful thing to have
stack overflow when you want because
well you can ask about Jenny's you can
ask about Jeff or you can find a lot of
things but not about doing house tools
unfortunately and that also meant that
we effectively wasted time on things
that we could have done in a different
way what we learned is probably it's the
best way to to configure Jenkins is
ideally ended in the Jenkins UI or the
command line because that gives you the
power to do too well do except to do
there you don't have to learn the
completed attempt with the templating
language you don't
have to learn the configuration syntax
and that changes from plugin to plug and
so it's so much easier to do it in you i
am also speaking of configuration
because now we were running in a more
distributed more bigger environment we
started thinking about backups backups
turned out to be a problem because the
first question is how much do you want
to pick up our is your build history
important of course it is because it's
green and you can see your well test
coverage going up and up and steadily up
and almost never failing because we
deleted the failed builds a number of
times and that was all good but those
builds totes the veiled history can be
heavy and it turns out well in our case
specifically turned out that we don't
really care about that the intuition
that that we followed him immediately
was yes let's back up absolutely
everything it turns out that backing up
just the XML files just the configs was
just enough but as I say this is a story
of what we went through some of the
decisions weren't exactly good and
coming back to the aspect of the
environment being bigger so we had a
master Jenkins we had a number of slaves
and obviously as some of those nodes are
sitting on some boxes somewhere in some
cloud and we started thinking about
monitoring yeah because that's what you
do two systems you you monitor them you
analyze them you want to be alerted if
something goes down and you want to some
you want to have some pretty pretty
graphs that will show you CPU usage all
there is a build kicking at E yes we can
see that from from the red on the cpu
usage and monitoring nodes yes they
should be there when we need them but
turned out to be another yak shaving
activity because yes it's a Jenkins
thing its its its development
development tooling and you don't really
need it to be highly available and
replicated and everything because that
was again pushing pushing the knife that
we we felt so comfortable with a bit too
far on my ranking scale this approach of
of having running it with javan and
the doing infrastructure to your CI gets
an 8 out of 11 because learning how to
do infrastructure was was extremely
valuable it helped it helped a lot and
that's that's a skill that was used and
applied later in many many cases in
terms of just the CI due to do the
minimum or do the medium average amount
and then let's let's just move on
because having a highly available
Jenkins installation it's not really
that needed having allowing Jenkins just
to just to spin up instances of it as it
needs from from configured images that's
just fine we don't need those nodes all
the time of course we had to learn that
so that took quite some more quite some
time a number of a number of months but
well this is this is a story of what we
did good and bad so episode 3 what what
happened why do I call it revenge of the
VMS so we've had our beautiful Jenkins
installation we've had our beautiful
software written it was all Java and
Scala so so much win it turns out not
really because there came a bit of
software that unfortunately happen to
run only on Windows and what do you do
two pieces of software that la that run
on Windows well what we did was we try
to put it into a vm contain the damage
and move on why do i say contain the
damage it's it's not that the software
is is bad because it's run it's running
on Windows now there are certain pieces
of software that don't really support
automation and they are just not
development friendly because if you want
to install them you need to click you
need to activate you need to enter a
serial serial number not even to mention
dealing with corporates license
management because when you have a
number of Windows installations who who
activates them who does what they're if
you're not covered by a blanket license
or if your use case is makes people who
are taking care of the blanket license
for for windows a bit uncertain those
discussions get funny for us being
developers licenses are very important
but what
what hurt us on a daily basis was
software just didn't like to be
automated that it didn't like to be
touched it we just needed it to be up
there what we did is we made a vm we
made a sacrifice we spent too long long
long and painful days we will treasure
the image after the software was
configured and then we were running it
from a snapshot every single day of
course the image was stored in a number
of places and nobody wanted to touch
that because well that's just normal and
that was a very very young there was
great treasure the image doesn't store
it in a very safe place and then and
make sure that it's safe and and then so
that's like a treasure we didn't hide it
on an island and marked it with tags
because we need it to work with that but
that's morally very close because you
don't want to go in and login into that
image and then change too much because
well you don't need to but on the other
hand it sometimes when this software
that we depended on and was upgrade we
needed to in to integrate the upgrades
and then of course precious treasure
let's do it properly listen to break
anything let's move on to our java
scholar comfortable environment moving
on mobile one do i mention mobile who is
who here has anything to do with with
something touching mobile development
yeah so i used to work for ebay and the
thing about ebay e is well ebay in their
development efforts are certainly taking
and pushing for a mobile first approach
what that means is when you're doing
stuff on mobile and not and not only
meaning mobile as in native mobile there
is a lot of mobile web you need to test
it and if you need to test you need to
you probably want that to be automated
because humans scale only that well the
tool that we were using was iOS selenium
driver anybody heard of that yeah a
couple of people I had the well-to-do
the pleasure of working with francois me
what we were doing is we wanted to
create a farm that would automate
testing on iOS that was a lot of fun
it turns out everybody industry trying
to do automation for OS X uses my mac
minis because of OS X individuals a
virtualization licensing limitations
because you're only allowed to run to
ver two instances of of the system on
that so Mac Nene gave us the biggest
amount of bank for the back and what it
also means that mac minis will well they
have to sit somewhere because we were
using Virgie to Mac minis which me
translates into 64 VMs we needed them we
need them to be put into a data center
and then that's it that's a bit of a
funny discussion we your data center
people who would like to put something
in there sure sure how many how many
rugs do you need we don't know or what
was the hardware oh it's Mac minis sure
you're crazy no I know there are there
are attachments that you out there are
shelves it's it's Mac minis our data
center kind of friendly or average
differently well it can be done it's
what a lot of people it's a lot it's a
lot of it's what a lot of people
actually do it because well you want
those machines far away from you because
you don't want to be knocking them over
watering tripping and and so on you want
them well cold and when when you get 32
machines they also create a bit of noise
but you have the machines you want to
automate them you want to do something
with them so obviously that has to
happen remotely first of all how do you
configure an OSX to be able to run
selling I mean in an automated way on
with your iOS things it turns out you
can do which a server there that's what
we did and then we started using log
stash to collect and analyze the logs
from there and the doll was it was all
power with VMware because we were very
happy using this here that's what we did
that worked and what was funny OS X is
full of quirks OS X is not your typical
Linux installation and trying to
automate that is funny because sometimes
what you get is
a pop up and going around the pop up so
that your twist can still work is
sometimes tricky unfortunately I so
there was a bit of hacker involved
whether a serious hacker involved at
times we needed to be able to rebuild
nodes so the OS XP virtual machine is
very very quickly as as soon as we
needed them or as soon as they corrupted
themselves because they also started to
express this to have this this feature
that they would go they would rot for
for some reason only on the large scale
of things the whole cluster was 64 VMs
that worked and is still working to at
least to my knowledge very well and the
money to build the automation that we
put in place that when machine stops
working we just use the api's for for
vsphere and then rebooted put in the
image budget run chef against it that
was that were that works all good and
the problem is well yes you need
somebody that is knowledgeable about OSX
and automating OSX somebody who likes to
hack with it because it's it's a
different system to what I spend most of
my time Swift and it has quirks
sometimes you need to reach out to Apple
developers sometimes that's that's very
very very difficult because they don't
want to give an answer using traceable
channel so they don't they don't want to
give you a plane and a straight email
back you have to find somebody and then
get connected and then meet them for a
calf and and and unfortunately yes
because well from from an outsider point
of view Apple turn turns out to be a
very secretive company about everything
thats that's not publicly in their dogs
so sometimes there is a lot of time that
is being spent and if you're testing
mobile you will need to test iOS of
course so probably that something that
you you will go through but good part is
iOS on OSX works quite well and since we
had so many nodes and since we had
software that had to run mobile web and
since we had software that had some
other dependencies I mentioned the
windows boxes and somebody are
one place and it wasn't it wasn't at
ebay it was the pattern the pattern
repeats that that's what i call the bad
idea of the century when it comes to
trying to testing software and it's
called X in a box and I don't mean I
it's nothing to do with Xbox it's X in a
box as in your whole production
environments on a single box a databases
mongos Cassandra's service a service be
serviced see service d everything in a
single box so that I can shoot the box
to you and then you can test your
software and do integration testing well
you have to do our system running here
so if you need to do anything is quite
easy and it starts innocent because as
you know software and modules and
testing the testing dependencies is
sometimes it gets very hard and very
complex you can try to put the things
together it seems like a great idea
because all the dependencies turn out to
be in one place it's easy to do
integration testing it's easy to do
let's say performance testing because
everything is on this on this box that
we have under your desk it's easy to
deploy my stuff because the other stuff
doesn't change and yes it's just bubbly
the promise that you will get are
exactly like not doing continuous
integration so when you integrate cold
light you well the other pieces of
software have already moved forward you
know depends we know those pains very
very well that's why we everybody loves
kid that's why everybody loves having a
CI server that why we want to run tests
very often on the most recent up-to-date
version of the code base same happens to
the same rules apply to dependencies
because well called compiled or
everything else compounded yes things
will break a bit but but what why do I
mention this as a the worst idea of the
century so imagine you're putting some
spaghetti some modules but these well
your software I can bet it must be
better but the software I sometimes work
with is a bit of smell a bit like
spaghetti and it's not about the sauce
and you put that into a box yeah box is
happy hour omnomnomnom
that was a very delicious spaghetti and
time goes on time goes on people keep
working and then it turns out that the
spaghetti doesn't fit into the box
anymore okay well what would do you do
10 it's it's quite easy you go to del or
your other favorite hardware vendor you
order a bigger server and you have it we
have a bigger server now so we can put
even more spaghetti and then well again
that will not end with a fat cat picture
that will just end with a big very big
powerful box and it's seems like a great
thing to have because we have this
almost 100,000 box of having all of our
environment just under our team's desk
and then you can multiply it by the
number of teams that you have in the
company and here's it will cost a bit
but actually this is not a biggest
problem what you get from this approach
is first of all everybody sees that
there is so much space left on the
device so much CPU cycles that go up
waste it so we don't really have to
worry and yes I'm talking about the
system that does nothing because it
doesn't get any real traffic but the box
is so powerful because to get something
that can run your whole production and
we are talking a full production of a
reasonably sized enterprise it needs to
be a powerful box so performance not a
problem threads they come for free ram
we have a lot like really really a lot
and what happens is you get a dependency
spaghetti because you don't get to pay
the network Tran a network costs you
don't get to paid it you don't have to
look for how much disk space there is
what happens in that very case was
software which let's say use 20 gigs all
together in the beginning ended up as
you beyond 400 gigs or everything
together because people started people
didn't have to pay attention because the
resources seemed to be to be free and
that was that was painful and the place
that did that to my knowledge still
hasn't done tongue just just just to
remove that untangle this new to this
whole mess it's still there there are
companies some of them in or around
Silicon Valley in which you can mention
the name of
company in a box and people will cringe
you can probably test test that during
each other one because we have so many
people from so many places so you can
order your work and this in a box no
okay by name i will not an unguent but
if somebody cringes are I know I know
you know again dependency testing it
seems like a good idea but it's not
because you don't get the isolation you
get strange effects you get really
strange effects because let's say the
database decides to do something and
because it's sitting on a single box
it's not isolated it's strange things
start to happen so people start making
strange assumptions and then if you try
to imagine having a Jenkins connected to
that sea of services it becomes really
really difficult first of all because to
be able to run tests in a reasonable
manner you would like to start from an
on state to reboot your whole company or
half of your company's system and well I
know what to do to my applications but
what about those dozen or a couple dozen
of other applications this is this is no
maintainable so your tests start start
to degrade you're just start to degrade
in terms of performance in terms of what
day test you get false positives you get
false negatives because there are
interactions there are races there are
just just interaction that you couldn't
have foreseen because all strange things
happen the team that is being rude made
responsible for maintaining and
provisioning those boxes because at some
time you make a release and then you
have to reinstall everything on that box
and you have to multiply it by the
number of teams and then because this is
this will become an error-prone process
you will say that yeah we'll give you
three boxes and we all hope one one of
them works and again expensive boxes
times the number of teams this is this
is getting into serious money don't do
it just just don't do it don't go this
way they are there a better way there
are simpler ways test your software
welding isolation rather than testing
everything all together moving on
finally some docker since some people
seem to be asleep because it's morning
or you enjoyed yourselves yesterday who
uses doctor already okay so docker for
so for the rest of people since you're
not using that from mine experience and
our experience at ebay and in different
places it does break a bit sometimes
knots not too seriously it's absolutely
amazing for for hacking it's amazing for
productivity it's amazing for for
development that's where we started
that's where we will immediately we fell
in love because it's all so much lighter
we used to be who we used to be using
vagrants and virtual machines a lot and
docker so much better so so good so so
great and we're on a java conference so
there is a caveat we just installing a
JVM getting a docker image that supports
Java is nothing nothing really that
difficult it's a very really a very well
understood process and the caveat
happens when you have to do maven or SBT
because you need to get the dependencies
and of course you can try to put the
dependencies onto the onto the docker
image and then the docker image will be
fat because well maven needs these
things if only to delete a directory not
not not to mention just building some
software so perhaps a similar problem is
well connected with Vicki because it has
to resolve the transitive dependency so
you need to be new tools of the be new
tools of the digester ODB noodles the
solution of course is to use images we
started with clean Java images we then
run the build threw away the target
directory I heard some noises those are
funny noises that they made me smile
they've they're made other people smile
if you have some more cool music my eye
I can borrow the microphone for a moment
so anyway coming back to the doctor and
and images in dependency problem or
libraries and we started doing clean
build so something equivalent to let's
get a fresh docker image with Java this
is when maven and clean install in there
if it go if it all passes let's throw it
all away that's waiting a lot of this
case a lot of time a lot of time and a
lot of time because maven and the or SBT
or anything like that has to resolve a
lot of dependencies and every time you
recompile you lose a lot of times that's
why
wanted to I really wanted to stress it
out so what we started doing this we did
run a build we throw away the
compilation product just to have an
initial maven installation and yes we
won't we created an image out of that
just to save ourselves some time and
then the amount of time lost was so much
better than smaller not larger because
that's what better means in that case
for me and we did we were very
comfortable the important bit of why we
went this way is VMs you tend to you
tend to keep them you don't want to be
starting VMs from scratch every single
time because it takes a couple of at
least seconds to boot a vm in our cases
it was most more like minutes so docker
starting running the build almost
instantly and have been done with within
a minute so so so good yeah another
thing we another nice thing is from
within a docker container you you get to
or interact with with the docker demon
and you can do it with using rest
services so you direct there are
libraries on even in Java that allow you
to do that or you can do it on your own
if you prefer which means if you have a
distributed system and you just want to
spin some dependencies remember the big
bowl of the big fat server story don't
do everything just just the initial
immediate dependencies that you have and
do some limited interaction testing we
could do that and we did that and that
was docker allowed that's in a very very
easy way what happened almost
immediately later was we got into a
place in which i call developers doing
infrastructure what do I mean that by
that is not that it's bad for developers
doing to do infrastructure no that's
great that people are interested in
people want to learn and the thing is if
you are a person who spends majority of
time doing spring doing go doing Scala
doing acha pick your favorite technology
and then you try to configure something
on the infrastructure side if you
succeed early well you will get this
impression that it's actually quite easy
and sometimes yes it is quite easy but
linux as a whole thing or a production
environment as a whole thing is is a
huge thing there is a reason why
software administrators are also paid
very well
or there should be it's because well
there is a lot of knowledge that they
have to a lot of good practices that
they have to be up to date same as we
have to catch up with Java with all the
libraries with all the oldest packs
maybe not ejb toes anymore but they have
to do the same the problem what we had
was we have a talker well we have this
doctor that we run for testing we want
to ship it into production and then it
turns out that production doesn't really
support it the way we want to and
because our daughter doesn't do X our
daughter doesn't why our daughter I
don't know doesn't care about upgrade
security logging monitoring all the
things that you would normally have and
there are two ways in which you can do
it now you can well you the developers
can start learning about it or you can
start looking at different teams because
there are probably teams in the company
that already are responsible for making
sure that software runs in that
reasonable statement and mob is being
monitored and then looked and character
for and that's in our case that was the
solution so when you have multiple teams
and you want to use docker what we had a
we had to we had to find a way to make
it work so at first we start publishing
docker files and then people who depend
to the doctor files and then we try to
go to through a eunuch grand unified
docker file for everybody that went
nowhere for those of you don't know the
docker file is an equivalent of a build
file for a docker image so a bill file
for your vm but in dokur terms docker
file and we try doing that it didn't
really work because people needed to
change text and sharing that with with
people who have different approaches to
to source control doesn't doesn't happen
and what worked much better is first of
all a multiple team so there would be
the the platform team the production
environment team that will create a base
docker image that we would then be
allowed to install and configure our
software on top of and that worked
pretty well because that meant you had
you get something that's certified
that'sthat's trusted that'sthat's well
understood that they are very happy that
you're using because you
using their work and on top of that you
get to install your Ruby or your your
job I your Scala whatever that is and
then will they get to see that because
the amount of changes that they have is
it's from a well well known state that
they created to and they're just
examining little changes that you you've
created in there and another good thing
is probably you're not the only people
who are doing that in the company so for
them it's much easier thing to
understand for for you it's much easier
thing to understand because you don't
have to understand everything that
happened before we effectively went to
it well story very similar to running
things with VMs with with many many VMS
but just just on docker and because you
can spin a docker on this very box and
you guy can do it in on other boxes that
was that was a great idea the caveat was
well the idea pushed a bit too far we
didn't go that far but there is a the
temptation was in the year you could
clearly feel it and container all the
things we did have Cassandra in a
container we did have a database in the
container we did have something else in
the container and then somebody
mentioned maybe we should put that other
set of services into a container and
then somebody said wait wait wait wait
wait because we're starting to become
this monstrous monster there is a caveat
because it's so easy you people
sometimes you have to take a step back
and with docker because it's so easy and
it's important not to try to instantiate
an enemy launched absolutely everything
that one's for the reasons that we
discuss with the big bowl of absolutely
everything because it's so easy it's
tempting then software well having some
isolation is good and also some more
some more quirks some developers myself
included laughs OSX because it gives a
decent desktop experience while looking
decently while pretending to be a Linux
if it's it works as a little thing as
you can't run dhoka dhoka dhoka demon
directing on the web sex which means you
get into things like glue to dokur some
time ago or docker machines which means
sometimes the docker machines will
explode which means the
for those of you who are not familiar
with with the docker or dr. machine
because OS X will not run docker
natively you have to what you do is you
run a vm using VirtualBox usually that
will provide the doctor environment for
you to run your docker containers in so
you're not running that on that directly
but you're running inside the vm and
when you create a VM of course you have
to allocate some cpu some memory and
then some disc and when you ask you do
more and more containers that vm
sometimes can go down and what you learn
this way what you learn while doing that
is having a corporate image repository
is an extremely important place it
doesn't have to be corporate wide but it
is just 0 if you're doing anything
serious with docker you have to have a
repository and dependencies and
orchestration yes if you have software
that is convoluted and you will have
dependencies and you only want to
orchestrate them because you will want
to start different things at different
times how can you do it well we did we
did use the rest api and we were super
super happy with that i wholeheartedly
recommend that and the last great thing
is well Jenkins at least from my
experience runs with can use docker to
run the test and that works well but
what works even better is having having
a starting point inside your test that
will spin up whatever is needed and so
that you expose the docker handle to
your tests and the question is of course
where should you take it further which
where should you now take it to and
that's a question I don't really have an
answer for because this is this is about
the step stopped I and then the teams i
work with went through i can't see into
the future I'd love to so if you have
any questions just wave your hands and
I'll try to repeat the question and then
answer it yes doctors what was the
learning
for learning Gawker versus the time it
took to develop a culture of how to use
it so the question is what about
learning curve of doctor or and how much
time it took us to to actually learn to
be productive and there was almost no
learning curve this this is this is a
department in which half of the people
actually learn how to do chaff easier or
slower or faster and doctors dr. was so
much easier so the learning curve i
would say in two weeks we felt confident
with technology and I mean in two weeks
because some people were on holiday
somebody goes sick somebody's busy so
it's but in two weeks we were okay to
get into a steady workflow to get into a
to be able to write to say what how we
should work in a distributed team
fashion that took us two months all
together and the process that we have
created was was decent we felt quite
happy of course it's not all over
because dockery wasn't in production at
that place so yes there will be changes
because of the the the rest of the
company that really will impose that we
did have to reach out to pro two to the
platform team so that they would be
happy with us using docker images that
they would provide so they needed to
start to provide them but if you ask
admins or admin like we're all platform
kind of people to create docker images
that is just yeah of course habit it's
like I would have every our games but in
a daughter that wasn't a huge deal of
course they were important to have there
is mentality I had the pleasure of
working with people for with which that
wasn't a problem so I'd say two weeks to
get developers is nothing amex and
nothing unheard of and then a couple of
months for 22 to go to get everybody on
the same page but it's it's super easy
super fast and well did the immediate
selling point of being able to run a
container just like that and not having
to wait a couple of minutes to spin up
the VMS is a great selling point there
is a question on the left here
uh-huh so the question is if there any
differences or what I would say what the
differences are between puppet and and
docker right so puppet and daughter are
completely different technologies they
are they are extreme they are orthogonal
puppet is a configuration management
tool this is a tool that you used to
deploy changes to systems so if you need
to install apache if you need to
configure apache yes pls yus yus puppet
if you want to create users on systems
ESU's use puppet if you have a large
fleet of servers please use puff that
same goes for Jeff same goes for uncibal
same goes for web configuration
management kinds of tools docker as a
technology is a container well doctor is
a container technology which means what
they try to do is they will allow you to
run containers and how you prepare them
is your your your choice you can of
course use puppet you can of course use
pass you can use chaff you can do
whatever you wonder but we try we
started with Jeff because we started
with doing chef before and it turned out
that we had to do less chef when we were
doing to occur so we had to configure
them less or the order configuration
steps were so much simpler because that
usually was just applying a couple of
commands to an existing image so did I
answer your question okay thanks I think
well I'd love to have a continue this
conversation over in the corridor
brother I will have to run immediately
after this this finishes anybody else
yeah there is a on the right
is there a difference in windows running
docker and linux and unix yes if you're
on Windows you have to do you have the
same story us at least to my knowledge
you have the same story as with OSX you
have to use a toker wrapper so good to
dokur or not dr. machine because you can
when I last checked you couldn't run
docker images matter the negatively on
windows so you needed that role in X
component run linux runtime somewhere so
that effectively meant you needed a vm
that would run the image for you a does
it run smoothly yes it probably does but
I would expect there are my mature
virtualization tools available on
Windows but as I was stressing a couple
of times I don't have a lot of
experience with windows because I focus
on environments that use Linux so some
sort of links for production did I
answer your question also yep the
problem with maven dependencies and and
docker saw the problem if you were
sleeping guys when you get a clean image
that only has java you put maven in
there and when you first run maven it
tries to download the internet that's
that's what maven is it is and will
eternally be famous for what we did is
we had a clean install of of a system
then we would run that maven with a set
of different flags so including site
site because it downloads a lot of a lot
of different dependencies the dependency
sources and so on and so on and then we
would package the m2 repository into the
into the into the image that was step
one and then what developers did on
their desktops was instead of running on
top of that image which was quite fat
because of the because of the jars we
started playing with just just exposing
your your own maven repository to the
docker image so the docker image would
talk to your maven repository so that
would be effectively whatever you were
using as a developer and that for
development was obviously it worked
extremely well especially if you had a
number of snapchat dependencies because
then you didn't have to go all the way
to
publish it to an access or published to
an artifact turi or your tool of choice
on the other hand the caveat was you
can't really it's not a solution that's
sustainable when you are publishing
software because I might have my my
snapshots in my on my desktop but if I
don't want to push them how is how is
the decrease or Paul going to use that
that's not that is so that's why we had
the way to put them into the image as
well for real for real for release
builds we we only did release jars we
don't want to keep snapshots lying
around because that's just bad if you
want to release a jar make a release a
jar and then that's when it becomes
public to everybody else yes we will try
to be to save time and there was a
question in the back here can you come
closer because I can barely hear you
docker images
uh-huh from what stable version of
course softly
you can join and then they work on the
source code because there are very
complex uh-huh yes so the question is
where if there are if you can solve a
problem of new new people joining teams
with working already on already complex
software by by putting the complexity
into the docker image and then giving
that to the new developer so then the
source code scan source code changes can
easily be added on top of of that and
yes logically it would make sense but
from what you're describing it seems
that the problem that you have is in the
complex is so I would try to instead of
introducing another tool into the mix or
using docker as a as an interim solution
i will try to tackle the complexity so
that it would effectively be easier
because yes you can orchestrate around
the constant complexity and you can try
to build fancy things around it but I
what the problem that you're having is
as you said it is the complexity that's
what you want to get rid of in the first
place and if there is a lot of steps
then you can probably put that into a
script and then if that's just a number
of steps if you have them in a script or
if you have them in a docker file I
wouldn't object immediately because it's
script our best done in a by mashina I
get bored easily and i would expect you
to have very smart developers who also
get get bored and also I made mistakes
when I'm when I because I can make
comments up so putting that complexity
into docker image sounds like a good
idea without knowing to my too many
details so is there yeah
boy pls but i like the idea of being
able to do depth as
2 g's when you're not testing things
as you see
so replacing the question is do I see
any problem with with putting my runtime
into a docker image effectively it
versus running inside a vm for for
testing so so using Dockers to run tests
immediately and then having the big fat
tests later using VMs this is exactly
what we did we at ebay the software we
were we were doing was targeting VMs and
in development we started doing docker
images and running in a running start
test from from containers first of first
of all because you get a first container
every time second because it's it's so
fast because we as developers at first
when you're when you're writing software
you when you're coding you want a very
quick cycle so doctor gave us that quick
cycle and then yes the integration test
some time later we would push docker up
to the integration changes and
integration changes would then happy
with the big fat beefy if you will VMs
powering them and yes there there are
some differences but that depends on
your soft already you will be impacted
if you're just a web service or if
you're just a web application or a
back-end that talks to a Cassandra or
something that's not a big deal if you
have native cotton a native code running
somewhere that depends on the what your
native call a code does so I would
expect 75% of the software would just
benefit from having a way to quickly run
your tests in isolation you might of
course following that specific category
in which you you might observe some
differences but that depends on your
software one caveat in which I wouldn't
immediately recommend it is there are
there might be performance there will be
performance differences between running
software inside the docker container and
the vm and if your software is very
critical about about the performance
that need that would need a more
thorough and a serious discussion yeah
so just to set some context there are
say there are seven minutes that how
many questions do we still have in the
room can you
just just one just to okay two questions
and then I will need to go sure go ahead
can you come closer because your voice
is not come closer because I will not be
able to hear you okay so so the question
is how do you use dr. within the with
with an application server and if you
change something into the application
how do you avoid rebuilding everything
and I would my personal context this
icon I happen to be lucky enough not to
have to work with too many application
servers now actually since the past
couple of years but what I would try to
do is I would try to create a base image
in which which would expect the source
code to be in a directory inside docker
and then you would the products of your
compilation you will just put them into
the into the directly so are you using
tomcat or something we are so if you're
using tomcat you the directory to which
you would put the web application just
just make just connect that to your
let's say local local file system or use
that as the integration point have
everything tom cut already in the image
but then put your the products of your
compilation in there and then spin it up
this way that that should be not even a
yes called would be d out a code would
be dr google code would be outside of
the image and then your and then you
would merge the base image that already
has tomcat java and everything real
everything else needed with the product
of the computation that should may give
you a decent development cycle and if
you need more details send me an email
to a tweet to me i'll be very happy to
continue that over because there is one
more question that and we only have a
couple minutes
why exactly are you guys have to build
inside the doctor why aren't you doing
the build outside you know a man and
every day
taking the artifact
and that's an awesome question the
question is why are we doing to build
inside the docker and why not do the
build traditionally and then called
polish the products into a door into a
container the first reason is
repeatability because we've using docker
what we get is we start from from
scratch there are there are we start the
same container every single time which
means the only things that that changes
is the application code second thing
it's trivial to set up a new environment
for any anybody who joins the team
because what they need is they need
access to our the doctor repository they
run they are able to if they can run is
Vicki and they can run docker they can
run our test all the complexity for
example cassandra our software relied on
Cassandra so we were spinning up a
cassandra image and of course yes you i
can ask somebody who can you please go
to apache or do homebrewing so Cassandra
or I have no idea what you do on Windows
but there is must be something like that
yeah of course I can but why with docker
that problem those problems go away you
and everybody in the team gets the very
same experience so there you lose the
problems you lose the differences in the
machines that would sometimes give you
false positives or false negatives
because everybody runs the same set of
tests which also means that if the tests
pass on your desktop and this is
actually what we are what we have
observed is we stopped having tests
surprisingly failing on the CI server
because of differences because you
effectively are running the same the
same code design at the same environment
which you don't play with that much and
that was a huge win because in a if
there are and if there is a number of
components changing at the same time of
course sometimes at least my development
desktops sometimes get polluted with
with things that I don't expect to build
some things are lying around some things
I'm changing a name of a file and then
I'm doing a good stash or trying to
revert and I'm in the middle of
something then at the Nightside yeah or
or just forget about it and compile
something and docker takes that away
problems that are happening for because
of that reason they don't have they
didn't happen for us because
specifically because we were using
docker and we were starting from a clean
plate every single time
thank you very much for your attention
and I would really if you have any more
questions later send me a tweet please
press the green button the green Duke as
you exit then I'll get to see some
numbers that people that you actually
enjoy that I'm really happy that you
woke up so early to be here on time and
spend the hour with me thanks and also
if you're interested in the next session
i'm doing it's in the hilton in imperial
ballroom b and i don't remember what
what topic is that that is about thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>