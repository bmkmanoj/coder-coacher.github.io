<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Introduction to Java DIO APIs | Coder Coacher - Coaching Coders</title><meta content="Introduction to Java DIO APIs - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Introduction to Java DIO APIs</b></h2><h5 class="post__date">2015-06-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/1YqiiO_NN08" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">alright this is an introduction to drop
a device I oap is my name is Jen Doherty
I've worked for Oracle in the Java group
for the last two years mostly on java SE
embedded and for the past eight months
or so I've been working on my main
project has been open sourcing the
device io api's okay so today we'll i'll
start off with a little overview of the
device i oh openjdk project will talk
about how to build the libraries and
we'll talk a most of the talk will be
about well we'll talk about a little
intro on how to use the device I api's
overall most of the talk will be looking
app for the first four supported ap is
for the open JDK version of jdk pio
package gpio SP is grade c and you arts
and then we'll give you a little more
info about the OpenJDK project itself ok
so the device I of project is an open
JDK project to provide Java level API
for accessing generic peripherals on
embedded devices it's these api started
out and Java ME and we're really trying
to now that we're starting to put them
to tea now that we have the OpenJDK
project to use them with java SE a we're
working to keep the api's in line as we
go forward so hopefully as we add stuff
to the emmy side will continue to add
stuff to the FSC side and we'll switch
back and forth and keep them in line so
right now the OpenJDK project targets
Linux arm single board computers the
fully supported ones are the Raspberry
Pi
and the saber light board that's an imx6
board i believe it's it's a design
specified by freescale and the
particular board we're using is from
boundary devices and the first for AP is
that we're supporting our gpio spi i
squared c and you arch so and we try to
provide a consistent method for
accessing low-level peripherals and
embedded devices from java level we also
take care to make it expandable with
service providers so if you develop your
own devices or you have your own set of
devices that you want to treat as one
composite device you can we let you do
that and let you work with that in the
device io framework and we also added
stuff to help you kind of manage
multiple hardware configurations and
yeah signing logical names and ID's to
the devices so you can you can take your
code that was written on the Raspberry
Pi and because it's Java we want you to
be able to use it on other devices even
though you are accessing very low level
hardware devices okay so building advice
I Oh libraries right now the official
support is building on a Linux host an
x86 or 64 whatever with an arm cross
compiler requires jdk 7 or jdk 8 and
linux arm cross compiler and gnu make
and we also have one of the samples for
the service provider also uses aunt
so to use the the default belt you just
define Java home as your path to the
java jdk and export pi tools which is
probably not good if you're billing for
a sabre light but whatever as the path
to your linux arm cross compiler and you
get the source from the openjdk
mercurial server I you just CD into the
dev directory type make and the output
is a jar file and a native esso library
okay so I'm an easy way to work with the
wave device I oap is once you build them
and once you're working on say the
Raspberry Pi is to use netbeans it
handles remote Java platforms really
well so this is is that readable at all
yeah someone okay so the first thing in
order to set NetBeans up to work with a
remote java platform you want to go into
tools Java platforms bad platform select
remote Java a standard edition click
Next and then you have some fields to
fill out you need to give it the address
or hostname of the Raspberry Pi which we
need to be on the network with now I
can't even see this here and also to
work with some of the devices you will
need root privileges so in your NetBeans
the easiest thing to do is just set up
your NetBeans remote platform to login
as root
okay so once you've set up a remote
platform you need to configure your
project to use that platform so you're
going to right click on prop right click
on your project choose properties down
at the bottom of the menu and you'll get
the screen on the on your right and you
give it the remote platform you just
created give it a name give it and give
the arguments to start are the vm
options you're going to have to set
those up and point to which i think
actually is next slide once you've done
that you need to add the dao jar to the
let's see under libraries at a jar
folder find your di OU jar and this is
this is just on your host this is on the
computer you running NetBeans on so they
it's going to compile it on the host and
then it's going to load it to the
raspberry pi this is just for the
compile part so you add to our folder
and then you find the browse to the dao
jar file and then you're set up to
compile on your host okay you're also
going to need to copy that the lib lib
di OU s 0 to your native Java library
path on the target device or you specify
its location with the minus D Java
library path vm option on the in the
properties on the last screen nope to
back so in here under vm options on the
right is where you specify minus d java
library path
you can also specify minus DJ TKD IO dot
registry and vm options that would be a
properties file that has some hardware
configuration figurations in it and
that's basically you'll understand this
better later in the slide but it's going
to be basically a list of pre-configured
hardware that you can just refer to
logically later when you're using the
main api's device manager keeps tabs on
all the devices if you want to look at
all the devices registered when your
program is running device manager list
you'll get a list of all the preloaded
and user registered devices you get
device instances by using device manager
open methods and when done with your
twice you want to be able to release the
resources so you need to always call
close method on the device and access to
devices depends on appropriate OS level
access and new Java permissions that
we're adding with the library okay so
we'll look at gpio first gpios general
purpose input/output it's just a logical
one or zero it's usually used for a
single purpose you know it drives an LED
or it's a status flag or you're using a
bunch of them and your bit banging a
specific protocol a more complicated
protocol
so the key things for GPIO pin is pin
number direction whether its input or
output the trigger which is specifically
for input whether it's triggering for
Linux it's only going to trigger on a
rising edge or falling clock edge other
systems will trigger also on a level
mode is refers to whether it's using the
drive mode whether it's using things
like internal pull-up resistors and such
like that while this stuff is here mode
is not actually used for the Linux port
so it's basically I don't care for the
Linux raspberry pi for this started out
and say P I started out in MA lower
smaller boards we're running more bare
metal mode it can be configured in the
software but not for the Linux api's
we're using so the main class for the
GPIO is JD ke di oggi pio GPIO pin it
represents a single GPIO pin you can
configure it as input or output input
can be like a button press to use it to
detect a button press use it to read if
you're doing a bit banging use it to
read in a more complicated protocol or
output you know drive an LED you can
also for input you can register
listeners to handle value changed events
you know I want to know when it switches
from a zero to one I want to know when
it switches period I want to know when
it goes low and that's backwards
okay so here's some sample code I found
the ellipses represent exception
handling I thought it would be better to
fit more this code on the screen
everybody knows what exceptions look
like in Java so here so at the top where
it's a leader pointer we're getting a
handle to we're creating recreating the
object now we're creating the config
sorry so the first argument is the
controller number for raspberry pi I
believe there's only one gpio controller
we have access to anyway so that's just
we're using a default we don't care
about that value we're saying 18 is the
pin number so that's going to be a
specific pin coming off the chip the
direction for this is output only and
the mode is ignored so we're just saying
default anyway trigger none because this
is an output pin so we don't care about
the trigger and false is just the
initial value we're saying to assign it
so to create the GPIO pin object so we
can we can manipulate that actual device
we call device manager open we pass it
the config and we just call set value on
the pin and that's gonna if you have an
LED circuit hooked up to it that's going
to turn on the LED with jess java
okay so this is an example of let's see
an input pen I think yes so again config
default we don't care about the
controller on the Raspberry Pi there's
only one pin number is 23 Direction
input only if I've gotten what that is
because I'm nervous mode we don't care
all right I'm saying I yes I didn't fix
it trigger on either a rising edge or
falling edge so if it goes high tell me
if it goes low tell me just tell me when
it changes so we passed that to the
device manager in the open method and
then we can just call input pin get
value and it will read the value on that
led on then I switch you can also set an
input listener so we get a call back
when that changes so we're taking that
input pin calling set input listener and
we just pass it a new pin listener class
that just prints the pin value in the
value changed method okay so spi spi is
a serial peripheral interface not to be
confused with service provider interface
which we also have so it's spi is a
single master multiple slave connected
to a single bus serial full duplex so as
you're writing bits out to the device
bits are coming back
so the key configuration number details
device number which is it's really the
bus number so that's for the whole SPI
bus the chip select address is going to
identify an individual slave device on
the on the bus the chip select active
level it's just whether let's say so to
address different devices within SPI you
have you put multiple saves on a bus and
then you give each device its own chip
select line and the master is only going
to activate one of those lines at a time
so the chip select active level is
saying you know is this business device
considered active when it's chip select
value is high or low and clock mode
that's oh yeah so that's that's the
value you're going to have to get from
the data sheet for the device it's a
combination of you know its clock values
and polarity values when how when do you
sample the data on the line for this
device and when is this device going to
sample the data ok word length word
length usually is 8 8 bits for a
microcontroller and that's just saying
you know the device is going to talk in
word in words of 8 bits and bit ordering
of course endianness
so the main class for spi is spi device
it represents a single slave device it
provides methods to read write read &amp;amp;
write to from the slave device and these
things are different if you do a read
and then if you do a right and then a
read it's not the same thing as doing a
write and read because as you're writing
bits shift in as they shift out so if
you write you've lost those eight bits
that shift it in while you were writing
eight bits because you didn't read them
write and read is how you do that at the
same time and it also allows to surround
a series of writes and reads with begin
and end and that will what that will do
is it's considered a transaction it will
keep the same slave select line open or
active for the entire set of messages
and it uses the spi device uses java nao
byte buffer in api calls ok so here's an
example of opening device config so
device number for raspberry pi i believe
there's only one SPI bus yes so again
we're saying device config default on
that slave select line in in this device
is going to be connected to c e 0 on the
Raspberry Pi ok and we're saying it's
chip select let chip select is active
low so we pull that line low yeah so the
pilot of the device I own library is
going to pull that line low when we're
trying to read or write from that device
and leave it high otherwise
and eight means eight bit words and what
did we call it on the last slide two
slides bit ordering is big endian and
it's same as gpio once we have the
config we can open a device this example
is for the mCP 3008 it's a what is it no
no bad let's see it's a 10-bit yes it's
a 10-bit a to D converter so this is
implementing a specific protocol a
different device would use a different
set of reads and writes and values for
this but I want to take you through
something specific so it's II think it's
easier to understand that way so start
out by setting up our byte buffers the
whole communication is only three bytes
long so we've got two by byte buffers
three by three bytes long and the output
buffer we're going to put in the
commands to configure the ADC and tell
it what channel we want to read so the
first byte is a start bit it just says
ok i'm starting a command now and the
next bit is going to be let's see so
this is a little backwards the weights
it's set the 0 x 8 the x 0 8 is just so
this is all going to be shifted for over
so the second bit that needs to be sent
as I believe it's telling it that it's
single Indian so it's only going to read
instead of reading the differential
value between two inputs it's just going
to read the value the difference between
the value on one channel see and ground
and so we roaring
the channel see with the eight and then
shifting that so those are in the right
positions for the protocol and the rest
is just padding because we know we're
going to have to read and write a total
of three bytes so we don't care about
the rest it's just zero and then we flip
the buffer what that does is it resets
the position of the buffer if we didn't
flip the buffer before we tried to send
it it would be at the end of the buffer
we wouldn't send anything it wouldn't
work at all obvious if you worked with
the niño buffers before not obvious to
all the testers and everyone testing
this code for the first time let's see
so then to actually read write and read
from the device its write and read past
the two buffers and when we get it back
in where we care about 10 bits we care
about the last 10 bits so we're setting
up the high and low bits of the two
bytes we care about that's the what we
read in from the device and we're just
calculating the 10 bit value and
returning that and then we have the 10
bit number that corresponding to the
voltage level on that line so I squared
C
interior integrated circuit it's a multi
master multi slave bus but right now for
advice a oh we're only supporting the
concept of a single master the host its
serial half duplex so it's go out and
come in on the same line they go out on
and so instead of two wires one for
output one for input it's got two wires
one for data bi-directional for data and
a clock but it doesn't use the address
lines so the configuration points4 I
squared C devices are at a controller
number the slave address the address
size which is usually seven bits
although 10 bits is extended and I'm not
sure if that's fully supported and the
clock frequency so JD ke di oh I 2 c-bus
I to see device represents a single i
squared C slave device provides methods
to read/write phone to slave devices I
like the SPI bus api's it allows you to
surround a series of related writes and
reads we've begin and ends keep a single
transaction and it also uses Java niño
byte buffers in API calls
see so this is this specific sample is
showing let's see how much video I show
know that much okay so this is showing a
little bit of a protocol for a BMP I
think that's a typo I think that's the
BMP 180 not 160 it's a I squared C
pressure temperature sensor from I don't
okay OSH hence the be okay so the
escrowed see bus number we're using on
the Raspberry Pi is one the 0 x 77 is
the US currency slave address that's
configured at the device whereas the spi
that was controlled on the host on the
Raspberry Pi by figuring out which line
to connect it to this is actually
controlled by the device sometimes
devices will be somewhat configurable
they'll have a base addressed and you
get to choose between you basically get
to add a couple more bits if you need
the extra address space the dress size
is seven bits and the clock speed clock
frequency we're requesting is 3.4
megahertz think the only thing that that
you have to be careful with their as you
stay within the frequent within the
speed of the device okay so very similar
to all the other device I oap is past
the config to the device manager open
you have handle to device to read so
this shows reading the calibration data
which we're just allocating a buffer of
22 bites
reading that in we give the this is
doing a let's see a read from sub
address sub a dress size and buffer so
the 0 XA a is going to be the eeprom
start address that's the it's basically
telling it which register on the device
to read and the one is telling it that
that that they addresses the registers
are addressed by one bite that's all
that is okay the the fourth the major
API we're supporting right now and
device io project is you are universal
asynchronous receiver transmitter okay
so key configuration details there are
controller name or number your TTYL am a
0 baud rate and then parody stop its
flow control so the main uart device
class is JD ke di o uart you arch allows
for control and access of a you lava you
are twice provides methods for
synchronous and asynchronous reads and
writes implements the java niño
channels interfaces readable bite
channel and right above light channel
that's really neat we'll see you later
and it also uses the java and IO
bytebuffer an API calls so here's an
example of using using it on the
Raspberry Pi so we're saying we want a
you work controller TTYL am a zero the
channel just device config default 9600
baud
data bits seven priority non flow
control none so like all the others it's
device manager open config so because
it's using the wet is it the writable
bite channel interface we can just open
the street is it open a stream and and
just open a writer on the stream and do
reads and writes on it okay so if you
want more info about the device i oh
openjdk project at the web address their
HTTP openjdk java.net projects di oh the
device io mailing list sign up for it if
you're interested send us some emails
the wiki page has a couple has a couple
project setup has a simple LED circuit
and code example or how to actually
sample circuits and stuff for the
samples that are in the repository and
the device I own material repo is Hg
openjdk java.net clash di OU / dev
that's the the main repo where the work
is going on now okay and I went through
the house fast on any questions well I
try to set up my demo which hopefully
works
absolutely right here there's my demo
not gonna work okay so for any given
angle security for Asia feels like for
her life to see you are not individually
for I can see since you can have
multiple peripherals on that bus is
there anything that lets you apply
security to specific devices Foreman
once you have access the bus get access
to everything no yeah I mean no to the
last part of your question yes to the
first part of your question
unfortunately I don't have a slide that
shows that really well but the
permissions it should be on em eat it
should be the same on Emmy to you the
permissions go by individual device if
you set up the config not the config
sorry if you set up the registry and you
have a set of you know pre-loaded
configurations you can specify it will
look for that particular device name in
the permission you can device addresses
I
or bed devices yo yo kin in general then
you have like a whole system so i guess
but if you have access to 1i can see
parental sometimes you have acted
everything on that chain what you might
not be an intense of the actress-model
you want for especially for security
reason because you might have Harvey
years and other things on that channel
but you want to protect how does that
work um let's see so you do you can with
permissions specify individual device
names it's a different permission to be
able to open any i squared C device so
you would have to write so so how you
would keep it so ad hoc configurations
are going to basically be looking for a
generic i squared c permission that
doesn't depend on a name if you don't
give them that permission they can't do
that you can give permissions to open
specific name 2i squared c devices only
but then you have to you have to make
sure you control that list does that
make sense
just give acid the specific devices in
that mess review to be aware of all the
devices that are connected on the bus it
specifically rejected now you
specifically give access to name devices
still taking more questions while I'm
trying to get this to work yeah what
that that's what we're focusing on now
so it can it can build on the pie
absolutely if you set those values to
the right we have people building on the
pie we know of people building on the
pie it's just we get to use netbeans
this way it's a little nicer right yep
its it'll work it's just not what we're
doing so if it breaks a little bit it
might take a little tweaking that's all
fit that I don't know about right now
we're trying we're just starting out in
the project we're bringing it over from
me2 SE starting with the Raspberry Pi
and Linux our machines you know we do
want to get people involved and maybe
you know see what what the community
what directions the community wants to
go what what they're interested that
kind of thing and you know we're still
working on it planning to add new things
and do ports but no details now no
details yet
it should run on Java 7 yes that may be
old early on in the project it did I
think we fixed that but I haven't run it
on seven in a while so you know if you
find that it doesn't run on seven sign
up for the email list and let us know
No
if the community is interested in it you
know we might be interested in it yeah
so let me see yeah there's a wow this is
not my computer oh did not want to do
that oh I probably can't actually get a
browser on that but yeah if you look at
openjdk java.net there's can usually
find it pretty quickly you know there's
stuff there to tell you how or you send
an email to the mailing list and all
send that info now out okay and oh I
don't have internet on this so I can't
show you okay so enough of that but yeah
openjdk java.net on where you know it's
not in the openjdk project itself it's a
separate project but it follows all the
same rules for you want to look for how
to be a contributor and
yeah I don't know why this isn't working
okay I think I'm not going to be able to
show you the demo darn it that's not
able to get that working so any other
questions oh why di oh baby right now we
don't have any plans to we don't have
any plans to distribute it it's an open
jdk project where you know developing it
out there in the open but where it goes
next we're not sure you know the more
people that like it get involved the
more likely it's to get released at some
point but in the meantime it's there for
you download build and use or add to
okay
right now we don't have we don't have a
release schedule or I mean that's really
a release schedule and we don't have a
release there let's see if YouTube bugs
openjdk java.net the you'd want to look
for you can look at the bugs for against
the open project under a component
embedded subcomponent di o advance I
think my demo is officially not going to
work I can't seem to connect to the PI
from my setup Sarah so
you mentioned the two part where
distributions plan on supporting I would
you expect under that the board members
themselves to implement that future what
was the vision again it's you know we
put this stuff out there as an OpenJDK
project and we're looking for feedback
from the community on that kind of thing
what we do have now what you remind me
is it is a generic linux on port so i
mean i've also in addition to the US
actually developing and running on the
Raspberry Pi and the saber light board
I've been running this on a BeagleBone
black same thing no issues I wouldn't
expect any issues on any other Linux our
board unless it had a really weird setup
like 10,000 gpio pins yes
rising edge falling edge it's the other
way around i think for raspberry pi yes
sports rising and falling and not the
level yeah oh what did i do I
accidentally fixed it yeah except we're
at the beginning
advanced you have a GPIO interface I
haven't seen a guy so many dumb
questions cover with if I have a GPA of
students at that I communicate to be a
spy or I swear see can I use the same di
oggi PL ok that's you wouldn't use let's
say as it's implemented now no it's
assuming an actual GPIO pin that the pie
knows about what you'd want to do for
something like that is probably create
your own service provider interface that
implemented the GPIO pin interface it
would be a different class and we'd be
writing I squared C code to implemented
or again it's an open project maybe
that's something that should the
community feel should be in the library
and you know if there's enough interest
maybe that will happen
I to see extender and now you have
consists of gpio objects but the
extender yep and if you want to know
more about the that would be the jdk di
OSP I package service permit meaning in
this case service provider interface not
serial peripheral interface I actually
have a talk tomorrow I believe 425
specifically on that kind of thing on
more information on the jdk di o
registry file and right here we did all
ad hoc configurations right we created
the devices in the code with the
registry file you can you know specify
them in a properties file refer to them
biological names use these logical names
and permissions control access to
specific devices and also the talk will
cover the service provider interface
creating custom device types like you
might do for a GPIO pin on that I
squared C expander
notified by that interrupt or by our
grimaldi background pulling this Java
doing that falling out of that the life
of the C code that's in the lib di o
okay no other questions okay well thank
you for listening thank you for being</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>