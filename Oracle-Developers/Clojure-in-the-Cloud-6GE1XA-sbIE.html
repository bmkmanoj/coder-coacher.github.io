<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Clojure in the Cloud | Coder Coacher - Coaching Coders</title><meta content="Clojure in the Cloud - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Clojure in the Cloud</b></h2><h5 class="post__date">2015-06-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/6GE1XA-sbIE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">I want to start by thanking you very
much for taking the time out of here at
lunch to come and listen to me talk
closure is a great language for working
in the cloud it's a great language for
working with web services and web api is
i'm going to use those two terms kind of
interchangeably and we're all interested
in using the right tool for the job
right so my conjecture here is that
closure is really great for working in
the cloud hi there my name is Everett
abe's I'm a developer advocate with
rackspace in our developer experience
group and I still get asked all the time
you know just what the heck does a
developer advocate tube I get asked the
question enough that I do like to spend
a minute or two at the start kind of
explaining what it is a developer
advocate does so first and foremost I am
a developer I write code for some
portion of my time you know it varies
from week to week month to month and
sometimes its twenty percent sometimes
it's eighty percent I'm a project
management committee member and
committer on an Apache top level project
known as Jay clouds this is a multi
cloud toolkit that you can use to talk
to various various many infrastructure
as a service providers clouds out there
the advocate peace is the guy doing you
know the song and dance before you today
he's the one that runs around to
conferences and user groups and meetups
basically wherever the developers are
and I advocate for our technologies
Rackspace OpenStack Jay clouds things
like this but I also advocate for you
our users our developers who are
building your applications on top of our
platforms it's something about our
platforms suck I really want to hear
about it that's especially when I want
to hear about it because I want to make
it better that's part of my job is to
make a better developer experience for
our platform
and this is me giving a presentation
here as an advocate and I've done a bit
of operations in my time in a previous
life i should say my previous job I
helped build the first openstack cloud
up in Canada we had one region in
Alberta and one region in Quebec and it
was connected the high-speed research
network I actually just kind of recently
learned this was the first openstack
cloud built outside of NASA and to that
end I helped co-author the OpenStack
operations guide kind of a neat story
this is a book we wrote in five days
during a book sprint it eventually got
picked up by o'reilly and edited down
and turned into the dead tree version
you see here on the left but if you
don't feel like chilling out for the the
dead tree version you can go ahead and
download it for free at this URL here so
I know a bit about Java and I know a bit
about the cloud and working with web
services in the cloud particularly
OpenStack but also other web services
and HTTP ApS as well so what do I know
about closure I know a little bit about
closure I'm no expert that's for sure
frankly I consider myself something of a
novice but I do want to share with you
what i have learned working with closure
and experimenting with it and working
with it in particular with web services
in EP is so closure is a programming
language of course of course as we all
know it happens to be a lisp created by
rich Hickey and I'm not here to convince
you that closure the language itself is
great you know that's much better done
by other people I'm here to simply
convince you that working with closure
and the cloud is great so I'm going to
give kind of a very brief overview of
closure really the minimal amount of
things you need to know about closure
for the purposes of this presentation
it's certainly not comprehensive not
feature complete
but it's just the minimum that we need
to know for this presentation and
actually maybe just a quick quick survey
who here has ever used closure at all
before ok so maybe about half who here
uses closure in their day-to-day job ok
like less than a handful and notice my
my arm didn't go up either this is
really something this was self-directed
learning when it came to picking up
closure okay so everything enclosure is
a list this is you know probably a
hallmark of Lisp based languages is that
everything is a list and this is what a
list looks like starts with an open
parenthesis with a closing parenthesis
now if you want to use a list as a data
structure enclosure you would have to
include a single quote in front of it to
actually use it as a data structure
enclosure because it looks like the rest
of closure this is kind of one of the
more confusing aspects of closure is
that you know you have the list data
structure and everything in closure
itself is a list you have vectors these
array data structures indexable array
data structures that are denoted by
square brackets opening and closing very
simple index-based vector then you have
the absolutely ubiquitous map so this is
one of the key central data structures
enclosure one of the most important and
it opens with a curly brace ends with a
curly brace and the keys have colin's in
front of them you might know them as
hashes or dictionaries or whatever if
you're not working in Java or closure
parenthesis so this is another kind of
hallmark of lists because they're you
know everything is a list you wind up
with many many parentheses and that's
okay it's really not a not a big deal so
you have stuff that looks like this if
you're calling a function it's going to
be the first thing in that list is going
to be interpreted
function call or if you're using
something else enclosure might be
interpreted as a special form so this
kind of goes hand in hand with the fact
that closure uses prefix notation that
is the first thing in the list is
actually the operator and the rest of
the things in that list are the operands
so if you're going to add two numbers
you're going to put the operation first
and you're going to put the operands as
the rest of the arguments there could
actually be any number of arguments to
the plus operation here so plus 23 you
get the result 5 obviously you know
we're working with Java day in day out
we're used to in fix notation where it'd
be more like two plus three functional
language functional programming language
so there are many many definitions of
functional programming language and
that's okay too it just means that we
have to kind of say what it is we mean
when we're talking about a functional
programming language so we're all on the
same page so a functional programming
concerns and facilitates the application
and composition of functions the notion
of a function is first class in Lisp and
closure so what does it mean for a
function to be first class that means
you can store it like you would any
other value you can pass it around to
other functions and you can return it
from functions you get to work with
functions like you would any other value
so here's an example of the definition
of a function very kind of trivial
function here where we take a number and
we add 7 to it so we're defining a
function at seven this vector in the
middle here is our parameters to our
function we're just taking one in this
case X and we're going to add 7 to X
pretty simple
here's how it looks when you go to
actually evaluate that function and you
get the result 10 by adding seven to
three now because it's a functional
programming language we can actually
take that function that we created that
we'd already defined and pass it in to
another function in this case we're
passing it into the map function and
what the map function does is apply the
function we pass in to all of the values
in a sequence as passed in as the second
parameter so we're going to add 7 to 2
and 3 in this vector and we get a result
back that's a list of nine and ten okay
types this is a fun one so to be really
specific about it every value enclosure
has a type and the program can know that
type at runtime now types are not
enforced at compile time enclosure there
really isn't so much a notion of compile
time that kind of is enclosure there is
something known as type hints enclosure
and we'll see that towards the very end
of the presentation but they're really
kind of outside of the scope of this
presentation so here's what happens when
you try to do something like adding
seven to a string so when this actually
evaluates when this is run and is
evaluated you're going to wind up with a
classcastexception because the plus
operation is expecting to get numbers
and not a string so you wind up with a
classcastexception there's this notion
of d structuring enclosure here's
another fun one so the structuring
allows you to positionally bind locals
based on an expected form for a
composite data structure so that's a
mouthful very wordy definition almost as
if I pulled it right out of a book and
read it right off of my speaker notes
for our purposes
we're just going to be using closure
destructuring as a way to bring in
keyword arguments into our functions
we're going to see an example of that
and so you're going to take a bunch of
parameters to a function and turn them
into key value pairs into keyword
arguments if you're familiar with this
sort of thing maybe from Python or
another language so here an example
really really helps we define a function
on line 1 and then on line two we take
two parameters but actually we're taking
a first parameter and then we're saying
and the rest of the parameters that you
pass in to this function and they could
be interpreted in a varied amount of
various ways we're going to interpret
the rest of the parameters to this
function as keyword arguments and we're
going to create a sorted map out of the
rest of those parameters here's what it
looks like when we actually go to
evaluate such a function so we print out
first that was our first print line here
put my neph then when we go to print out
our sorted map it's taken the d
structured rest of the parameters which
happened to be key value pairs just
listed one after another and prints them
out as a sorted map here lambda this is
probably something you've heard before
because now it's in Java 8 lambdas you
can simply think of them as anonymous
functions a function that you don't
necessarily have to give a name to well
that you don't have to give a name to so
before we had that add seven function
and we predefined it and we used it and
we passed it into the map function but
you don't actually have to pre define a
function in order to create one and use
one you can create an anonymous one you
don't have to give it a name so here
we're just creating a function on the
fly in line and passing that into our
map function this is equivalent to what
we did before with our predefined add
seven function
and we get the same result macros again
the way to think of macros they can be
used to define syntactic constructs they
allow you to introduce new syntax so
that you can write code which is more
concise and meaningful again another
very wordy definition as if I may have
got it from somewhere else so you can
use macros to create syntax specific to
your problem domain so if you're solving
some problem for some customer and you
find it easier to work in the language
of that problem domain you can do that
with macros you can create little
languages using macros that's one of
their uses perhaps you've heard of the
term domain-specific language macros
enclosure will allow you to do that
relatively easily here's an example of
defining a macro called when this is
actually the macro when in the closure
language itself so when is something
that you can use when you're using
closure I've just basically copied the
source this is the actual source code
minus a couple little things from
closure very simple I'm not going to get
into all of the bits and pieces about
implementing macros but that's what it
looks like and when you use it when
something is true you evaluate the
expression and you get the result and
we'll come back to this a little bit
later too then there's line which is
short for word line again I really like
the tag line for this project it's for
automating closure projects without
setting your hair on fire you know in in
the world of Java we've had to suffer
through quite a number of package
managers and line is of this ilk and it
does a really pretty good job of
actually managing your dependencies and
all the bits and pieces
around a closure project so it's a very
easy way to use closure and it allows
you to focus on automation and
configuration and get those things out
of the way early on so you can
concentrate on your code it is very
similar to maven a lot of these commands
might look familiar you can create new
projects very easily clean install test
run very very similar to what we see in
maven if you're familiar with maven and
then there's this last one here if if
you can see it at the back line repple
so what does that do that's kind of a
new one ripple is this really fantastic
thing enclosure and they have it in
other languages as well enclosure it's
the read eval print loop so this is like
an interactive environment that you can
start up using line or using just
closure itself you know that you've
downloaded from closure org but you can
also create a ripple from line and it
reads in some code evaluates it prints
out the resume prints out the result and
then loops back to start all over again
very simple very powerful interactive
environment for you to work with closure
code and do your development okay so now
that we've talked about closure we're
going to talk about the cloud a little
bit and exactly what kind of cloud are
we talking about because cloud comes a
lot of flavors right and it's not there
actually is a really good definition for
it it's the the NIST definition national
institute of standards and technology
i'm not going to get into the whole
definition but suffice it to say that
the flavors of cloud that we're going to
talk about today our software as a
service these are services that provide
an API to you and probably a web
application GUI interface as well but
for our purposes the important part is
the API so like Twitter
github or gmail has an API now Facebook
as an API linkedin has an API these are
software services that also provide ap
is for you to access them
programmatically then there's
infrastructure as a service these are
cloud providers that provide you with
virtual machines or object storage or
block storage or DNS or all these
different things that you can use to
build modern cloudy applications
examples here are of course Rackspace
amazon web services google cloud
microsoft azure and a dozen others
there's no shortage of infrastructures
of service providers and just to note j
clouds talks too many many of those
providers so the bottom line when we're
talking about cloud is that we're
accessing resources via HTTP API that's
the bottom line as i said before i'm
going to use HTTP HTTP API and web
service kind of synonymously so if you
can access it with an API over the web
this is what we're talking about now
HTTP API is have a lot of things in
common so let's talk about a few of
those things because they're going to
come up later and they're going to be
kind of important
so of course these are things you access
with the HTTP protocol the hypertext
Transfer Protocol and one of the most
important things when it comes to
working with these kinds of AP is is the
documentation of these api's so even
finding the documentation for these AP
is in some cases can be quite
challenging depending on who's put
together this API sometimes if it's a
you know kind of an open source API or
open data API they might have the code
over here and the documentation over
here on completely different sites it
can be difficult to find it can be
difficult to parse through there are
many different formats for API
documentation and a lot of different
ways you can read it there was a really
interesting survey that ProgrammableWeb
did at the beginning of 2013 that said
when they pulled developers about these
kinds of API is these web service API is
what's important to you the most
important thing to developers was
documentation for the AP is even more
important than reliability and uptime
which kind of sounds crazy but when you
think about it it makes perfect sense
because if you don't know how to use the
darn thing then reliability and uptime
are a totally moot point so just make it
easy for me to use your API then there's
logging if you're working with a web
service API you're going to want to
enable logging very early on as you're
experimenting with it because I
guarantee you something is going to go
wrong and you're going to be left
wondering what the heck is going on and
if you're actually logging what's going
on over the wire you're going to have a
much better chance of debugging what's
happening of course there's
authorization you know most web service
API s require authorization in some
sense just you know confirming who you
are and
thesis is done often with OAuth or some
custom authorization scheme then you
have an endpoint that you actually need
to connect to a URL that makes up part
of the resource path when you're
actually working with something in an
API and finally well not finally just
before you can connect you have your
development environment such as repple
where you might include some of your
credentials that you're using to
authorize yourself to work with that API
so finally you can actually connect to
the service and start working with those
resources this includes being able to
make requests and get back the responses
now part of the request and response
cycle are the headers that make up the
requests in the responses you can kind
of think of this as metadata that you're
sending along with the request and
getting back as part of the response and
the body of those things as well so this
is the payload that you're sending with
the request when you're working with the
web service API trying to get it to do
something for you giving it enough
information to work with it and then
likewise back in the response getting
the information that you need the
information that you requested when
you're working with that API and very
often that payload these days is in JSON
it's what's being sent across the wire
so if you're not familiar with JSON
already I suspect most people are you'll
likely need to get from the familiar
with it in order to start working with
web service API s okay so now that we've
talked about closure a bit and we've
talked about the cloud a bit and web
service API s let's talk about closure
in the cloud and how we work with that
why is closure a great tool for working
with web services there's a handful of
reasons that I like to go through and
I'd like to start with kind of my
original conjecture I tried to think of
a funny clever joke about closure
and I couldn't quite make it work so I'm
just sticking with the conjecture that
closure is greater than Java when it
comes to working with web service API s
let's start with domain modeling in Java
versus just using plain old maps
enclosure this is a fun one an example
here I like to call surprise so we're
working with this API that's returning
metadata as simple simple key value
pairs just just couldn't be any more
simple right and you can model this very
easily in Java code with map string
string and if you're using a DC
realization library like G song that's
google's JSON library or maybe Jackson
or what have you you know it's just drop
dead simple couldn't be any cleaner well
all of a sudden black you hit this
corner case this one percent of the time
that instead of returning just a simple
string value you get returned this huge
object blah that has nested objects in
it and everything and all of a sudden
you know this undocumented behavior has
become a huge headache this came out of
nowhere this this ridiculous corner case
and you're left scratching your head
okay do I take this beautifully simple
King you know map string string key
value pair and do I start breaking it
out into this great big ugly black
object to handle this one corner case
that happens in like one percent of the
time and it completely wrecks your whole
data modeling that that you had worked
up around these resources and you get
this parse exception because your Java
code isn't expecting it and Kapow it
blows up on you
another example of this is that you'll
have API designers who think changing
the objects around and their responses
is a good idea this is well-documented
behavior that they consider to be good
design and I kind of would disagree with
them so you'll see stuff like you know
for returning the same resource you'll
have well documented that oh it can be
returned as a string or as an object or
as an array of objects or strings or
what have you and this seems like a
really good idea to people I'd argue
that when I see stuff like this that API
design is really in its infancy I mean
restful api is have actually been around
for quite some time but the idea has
only really caught fire in the past two
or three years and if you look at some
of the sessions during javaone a lot of
the API ones people are packed into them
they're overloaded you can't even get
into them you're on a waitlist and I
think that's really indicative of kind
of the lack of knowledge around doing
api's and doing API design so when you
have designers who are working up these
api's they're doing stuff like this and
thinking it's a good idea but it's
painfully apparent that they're not
thinking in terms of your object
oriented language in our case java this
stuff does not play well with java
because you have all these this one
resource this one object cannot be all
these different types very very painful
to model very painful to parse and there
can be lots of conditionals that you
have to throw into your code to deal
with this stuff
one of my favorite ones web services
will return just a ton of data to you so
the the API designers have decided that
you know they'll throw the kitchen sink
at you because you know there could be
some relevant detail in there for you
they don't really know what's relevant
so they're going to return could they
seem to default to returning absolutely
everything so let's have a look at this
it's bit of a gag slide obviously what
the what we're looking at here is one
tweet this is just one tweet returned as
JSON there's over a hundred lines here
and it's a lot of information being
returned for just one tweet and the
tweet is like 20 characters or something
like that and and this is everything you
get back so if you're deserialising this
stuff and trying to put it into a java
object think about all the fields you
would have to model even if you're
generating this stuff with you know
lombok or you know maybe you're using
your ide to generate all that code it's
still a lot of code it's a ton of code
to create these bespoke domain objects
to deal with data structures like this
and if you're creating a library around
this if you're creating a SDK or a small
library for somebody else on your
project for working with this web
service do you include everything in
here how do you know what's important
who are you to make that call and if
they need something else that you didn't
include in that object because you
didn't think it was important or you're
going to have to go ahead and coat it in
there and re-release your little library
and make it available to them and then
of course you can run into any of those
other problems that i mentioned before
so what do you do enclosure you simply
use maps super super simple all of those
things will fit into a closure map no
problem you don't have to do anything
except maybe say Oh take this JSON and
turn it into a proper closure map data
structure so there's a quote that I
believe is required to be in every
single closure presentation and so I'm
going to include it here it's from Allen
perilous or perlis it is better to have
100 functions that operate on one data
structure then have 10 functions that
operate on 10 data structures and that
is exactly the point that I'm trying to
make here if you're creating a bunch of
Java domain objects you know that model
each and every single field of those
responses being returned to you you have
to create methods upon methods upon
methods to work with that stuff because
it's all custom you have to know exactly
what's going on in there but if you've
got closure maps there are many many
functions already out there that work
with closure maps and so you can slice
and dice that data as you need to so I
find it much more simple than actually
trying to generate a bunch of Java code
to work with these resources these
objects being returned to you okay so a
quick warning here we have some demos
ahead demo is short for demolition right
because that's usually how these things
go so if it works out great we do have
some stuff that's going to be using the
Wi-Fi so if it crashes that's great too
will simply move on
when it comes to working with web
services as I said you know
documentation is really really important
and you can read documentation until
you're blue in the face but it really
requires a lot of experimentation to
when you're working with web services to
really get an idea for a feel of how
this API is put together how this API is
designed you really got to get your
hands on it and then when it comes to
java code you know you wind up in the
I've got my class file I'm going to
compile it we're going to run it and
then I'm going to pepper it with print
lines right we've all done it I've
continued to do it so that's all well
and good and you're doing that kind of
incrementally or we can go back to using
the repple this interactive development
environment that I mentioned earlier so
this is going to be our first rather
simple demo hopefully
where am I okay so I've got my terminal
here and I won't torture you by typing
in everything i'm going to start up a
repple in this terminal and so it's
going to take a few seconds to start
because we're creating a whole new JVM
in order to host this repple and here we
go we're ready to go so let's start oh I
shouldn't have done that oh well so
simple enough right and these examples
i'm going to put we've seen before
because they were at the start of the
presentation we're adding two numbers if
we want to define a function if we go
ahead and easily enough to find a
function so now that function is
available to us in this ripple you can
call it get our result printed out we
can call it with map and have it iterate
over that sequence and apply that
function to each of those values this is
kind of a neat one you're able to get
any documentation string that's loaded
into the wrap well for any function i
should say any function that's loaded
into the repple so at your fingertips
you have available all the documentation
you need for working with a function
very very useful n and there it is if
you can't see it in the back it's simply
calling the doc function on any function
here is our destructuring example and
we'll go ahead and call that
and again we get our result
here's an example of the lambda again
getting the same result because we just
included the anonymous function in line
instead of pre defining it and there's
actually a shorter syntax for that but
don't really have time to cover it
another nifty feature of the repple is
that we can actually get the source code
of functions which can be very handy of
course you know one would never
recommend coating to an implementation
but sometimes it can be very informative
very illustrative to be able to look at
the source code easily when you're
working with a function and finally
we're going to define a macro and I'm
going to be redefining when but you know
calling it when demo because I don't
want to shadow the one that's already
part of closure and then we can simply
call it as you would and when it's true
that expression evaluates okay so very
easy to work in this environment and try
stuff out so like I was saying it takes
a lot of experimentation to work with
web services in the cloud and the repple
certainly helps with that but what about
when it comes to using libraries that
work in the cloud closure libraries for
interacting with these web services how
do you experiment with those well if
you're in Java and you're using maven
you know you're going to put the
dependency in your pom.xml file you're
going to use some maven command to
download that code you know you're going
to download half the internet while
you're at it and then you can get back
into creating a class and compiling it
and running it and peppering it with
print lines etc etc etc
in line there's this great plug-in
called blind try this is something that
you know you need to manually go out and
add to line in order to experiment with
any library out there in this case I'm
going to be experimenting with clj HTTP
so let's see what this looks like and
clj HTTP is a closure wrapper around the
apache HTTP components client so we're
going to start this in another terminal
and the command is simply line try and
then the name of that library that were
experimenting with it drastically
reduces the barrier to experimenting
with a new library so you can use
something better and discover something
better and then we go ahead and we
require the code we need this is akin to
doing an import in Java so here's the
part where we see if the Wi-Fi is doing
okay excellent okay so what we did there
was we simply did a get on closure org
so we got all of the source code of the
closure org website all of the HTML and
JavaScript that makes up that website
for the first page for the front page
and it's a bunch of gobble to give to us
we're not browsers we don't know how to
render that let's have a look at
something a little more specific like
you know the status of doing the get
operation we can grab that out of our
data structure very easily and 200 okay
let's look at the headers that are
associated with this response blam
there's a whole bunch of headers they're
kind of difficult to read they're all
mashed together it's it's kind of
difficult to read and we'll fix that a
little bit later again of course you can
use the doc you're ll put spaces between
this stuff so it makes a little more
sense hopefully try to put it at the top
use doc in order to get the doc string
for the HTTP GET operation makes a
little easier to understand how to use
it let's find out what server closure
org is using its using engine X there's
also a shorthand version this macro the
arrow macro that allows us to perform a
series of functions on something and
here's kind of a good example of
function composition and this allows us
to easily get the same information as we
did before i mentioned p print I believe
earlier and so this is a nice way to
print out all of the headers that are
associated with the response coming back
to us from closure org from calling out
to closure org I'm going to skip that
one and we're now going to have a look
at this other API the open weather map
dot org API so what's going on here so
we just called out to this API where we
don't actually we didn't have to
authenticate ourselves
and i think i was saying authorization
before was nigh i meant authenticate
before when I was talking about
authenticate that's all right okay so
we're pretty printing out the response
that we're getting from this open
weather map API and I'm simply saying
what's the temperature in round rock
texas which is where i'm living right
now just outside of austin and we get
back all of this information tons of
stuff here here's the headers and then
here's the body and a bunch of
gobbledygook in there some some plain
language description and we can see that
the the temperature is buried in there
somewhere so let's see if we can get
that temperature out easily because when
it comes to the weather I mean that's
the thing you want to know right away
what's the weather and in place x you
know whatever the temperature is that's
what people primarily want to know
what's the temperature so I should be
able to get that pretty easily but look
how not easy it is to get it look how
far down I have to dig so body okay I'll
give them that of course you have to get
the body out of the response but then
there's this list thing that's part of
the response and then there you got to
get the first thing out of that list and
then there's a main object in that thing
the first thing in the list and then
finally you can get the temperature out
of this JSON that's come back in the
response so now after I've dug deep deep
deep down into this response I can
finally get that thing that everybody is
going to want anyway that's the first
thing that everybody wants and it's
buried way deep down inside so to me
this is a good illustration that API
designers are not thinking in terms of
object oriented languages imagine if you
have to model all of this stuff with
java objects just to get this one piece
of information just so you're
deserializer would work
so the last one here and this is kind of
a neat one I like to call works for me
versus I feel your pain so when it comes
to helping developers with their issues
they'll contact you and in some way
email or IRC or maybe they put a
question on Stack Overflow and you know
oh I'm encountered this issue here are
all the versions i'm using here's my
code you know here's how you can try to
reproduce it and then over on your side
you try to reproduce it but everything
works so you say oh sorry works for me
can't reproduce you know bug closed
whatever there is there's nothing more
frustrating for a developer than that
kind of case when they can't reproduce
your bug so they won't they just simply
aren't able to help you so there's kind
of a nifty feature in the repple that
allows you to feel their pain directly
and this is the kind of thing that makes
in my opinion for a good developer
experience is if you can feel the
developers pain directly so when I was
creating those ripples there with line
it's actually creating something called
the N repple this network repple and
this is something that you can actually
run your entire process and it doesn't
just have to be a little bit of chunk of
code you can run your entire process in
there so if you have a developer who's
created an application enclosure and
they're using your web service API if
they were to expose that repple to you
in some way hopefully in a secure way
then you could actually log in to that
end revel and start monkeying around and
say oh look here's how you're trying to
use my API oh here's where you're going
wrong here's the problem because you're
actually able to change and modify the
running code in that process in that n
repple so you're much easier able to
debug problems monitor problems and even
patch the running code in order to help
you do those things so let's take a look
at an example here and we use this
connect parameter when we're firing up a
ripple to do this
and before when I said oops I shouldn't
have done that that was because I need
to look at the port on this one so i'll
have to use this one here really
shouldn't be a problem yes so i'm going
to go ahead i'm going to copy in this
port of the ripple that i started in the
second terminal so I've got a repple
running here in this terminal and I'm
going to connect to that one in my third
terminal so notice how it started really
very quickly because I wasn't creating a
JVM for the repple in this third
terminal I'm simply connecting to the
already running repple in the second
terminal and this one in the middle here
so now that I'm connected to it I have
full access to do anything I want in
that repple so I can do stuff like
define a function
those in run to you yes the repple runs
into JVM sure oh yeah sorry so I mean
but it didn't have to start a separate
JVM for the repple itself
and now that I'm in the the second
terminal where I originally started that
repple I could run that function that
was defined in the third terminal now
because I got rid of what was in that
first terminal this little example
doesn't have quite as much punch but
remember if you remember in that first
terminal I defined when demo the when
demo macro and if I was connected to
that first terminal I could actually
overwrite the definition of that macro
instead I'm just going to put it in the
repple from the second terminal and I'll
be defining it for the first time here
so i'm not actually overriding it i'm
not patching it but as you can see i
threw in a print line just to say oh
that i'm in the body of this it could be
anything it could be printing out what's
in test it could be anything just to
help me debug someone's problem with
their closure code using your service
and then of course you know back in the
second terminal we could run that code
and now we see that in when demo was
getting printed out when I run it
okay so getting into some of the working
up a little use case for actually
working with some web services and I'm
gonna have to hurry things along here so
let's say you've got a web service that
your organization is running that your
company is running and you're providing
an SDK for this web service could be in
any language closure Java Python Ruby
whatever and you want people to
contribute to that or they're they're so
interested in your project that's so
invested in your platform that they want
to contribute to it so let's say you had
a developer who made a pull request to
github and you had Jenkins watching
github via web hook that triggers a
Jenkins job which goes ahead and spits
out a status to Twitter saying hey
thanks for the pull request and you put
that status on your company's Twitter
account and then you make a comment on
the github pull request saying oh we
made this shout out to you on Twitter
you know thanks a lot for the
contribution we really appreciate it and
then you go ahead and you save that in
an object storage system like Rackspace
cloud files because this was such an
important event that you want to
treasure it forever and so you store it
in a durable object storage system okay
so I'm actually going to skip this
section or I'm going to run through it
very very quickly just some of the
different ways to talk hdb with closure
you can use an HTTP library like clj
HTTP as we did when we tried it out with
line try you could use a Java SDK and
you know use Java interrupt the Java
interoperability features enclosure to
actually access that Java SDK you could
use closure bindings for a Java SDK this
is actually the case with apache j
clouds j clouds ships with a closure
interface for our compute service in
basis and our blobstore interfaces the
compute service is the interface that
works across the compute features of a
lot of different clouds and the
blobstore interface is the interface
networks across many different object
storage features of many different
clouds then kind of the ideal situation
you can use a closure SDK SDK that's
written entirely in closure for
accessing one of these web services and
some examples here our Twitter API fort
of course Twitter and the tentacles SDK
for github ok so the Twitter API let's
take a little dive into this this is an
unofficial closure SDK for Twitter they
do mention it on their developer page so
it's somewhat sort of official or at
least recommended to some degree let's
look at some of the dependencies of
Twitter API not going to get too deep
into it I'd like to point out on line
three here it's using this HTTP a sync
client and this is a wrapper around the
asynchronous HTTP client for java so
this is how it's actually putting bites
on the wire and then it uses another
library for to help with OAuth so i
would say that twitter api is kind of
defined primarily in terms of macros
this is how they create the functions
that you call in order to interact with
the API and if you recall macros can be
used to define syntactic constructs and
those constructs here are just functions
that you can call so this SDK is
literally stamping out functions with
macros that you call to work with
Twitter resources so here's kind of a
simplified version of one of the macros
that is used to create the functions
that you call so on line two we've got
our vector of parameters to kind of
required parameters and then
we have this destructuring thing the end
rest at the end and this is where the
key value pairs come in and we create a
map out of RIT out of it on line three
we're working with this thing that's
being passed in called resource path
we'll see how that's used in an example
and then lines four through six or
cleaning up a function name and again
when I show you the example it'll be
much more clear how that works and then
we go ahead and we call another macro
with some of those values that we've
generated so here's the next macro and
the chain of calls again this is what's
in the closure SDK itself and the
Twitter API SDK line two again is the
the vector of parameters line three
we're defining this rest map thing this
is again the keyword arguments that
we're passing in now line for is where
we actually take that function name that
we created in the previous macro and
create a function that you can actually
call from your code and ultimately on
line seven this HD HTTP request function
is what puts bytes out on the wire okay
so examples so line one here this is
actually part of the library itself this
is how it constructs the function that
you would call so we're creating a
function to do a get statuses on the
home timeline now the statuses home time
line that's the resource we're working
with that's actually the resource path
that we're working with that gets
appended to the Twitter endpoint so we
know what resource were working with in
Twitter and that's a status on the home
timeline now online to this is code that
you yourself would actually write to
make a call in order to work with
Twitter in order to get the statuses
from your home timeline
and notice how you know its statuses
/home underscore timeline that gets
normalized to an idiomatic function
named enclosure that's just dashes in
the function name then we pass it pass
in our credentials and a pram to say we
want a count of three it's we're passing
in this map for our parameters and we
get our response back you know blah blah
blah all this stuff the hundred-plus
lines that I showed earlier another
example is posting a status posting
status update with this library and then
again on line two you go ahead and you
call it and you get back a response so
the documentation for this particular
library is not so great there is a
readme for it to kind of get you started
but there are no docstrings for the
functions because they're actually being
generated with macros so when it comes
to working with these functions you
can't just go doc function name and
figure out how to use it you have to
actually pick yourself up out of your
closure code and go and look at the
Twitter API code so now you've torn
yourself out of your code and you're
reading through the Twitter API code to
figure out how this function over here
works and it's just not the greatest
developer experience not not the best
way you can do these things but I
certainly understand why the author did
it this way because there's a trade-off
in terms of time for development of
creating that library the logging that
works with this is log4j because of the
underlying asynchronous HTTP client for
java so tentacles this is what you use
for working with github another
unofficial SDK the dependencies I'll
point out on line 3 we're using clj HTTP
for talking HTTP this one is more
defined in terms of functions
again this is a simplified version of
what the library does to make an API
call we have our vector of parameters on
line two and then on lines three through
seven we're defining all these values
for working with for working with them
and on line 6 and 7 we're making sublime
de calls here exec an exec request one
why why is that so when it comes to
github a lot of the results are paginate
'add and so if you have like a thousand
issues in your github repo you're not
going to get all 1,000 back at the same
time you're going to get back you know
25 at a time 50 at a time and this
library makes it easy to either just
make one request or say you know what I
want all the pages which is what's
happening online for and finally it's
it's on line 6 here we're actually
making the request that puts the bites
on the wire so here's how you would
actually use it you call you know create
comment on the issues resource which is
kind of different because as I said
before we're working with a pull request
it's actually much easier to make a
comment on an issue which appears in the
pull request just because of the way
github issues and pull requests are kind
of intertwined then you pass it all the
relevant information including your
credentials and you know it makes a
comment on the pull request and returns
you the response pretty good
documentation docstrings for all of the
functions so you know how to use them
there's even some design documents for
this library as well I really quite
appreciated the documentation of it and
logging again is log4j moving on quickly
to j clouds this is a multi cloud
library for many infrastructure as a
service providers the dependencies here
let you know that Jake let's actually
has its own kind of little language for
talking HTTP so we don't depend on any
of those others like the other libraries
do I'll point out online for that you
have to specify exactly what resource
you're working within the cloud in this
case we're working with rackspace cloud
files that
our object storage service what's called
the blobstore and Jay clouds and it's
primarily made up of Java classes and
methods and we have an interoperability
language wrapper for closure with NJ
clouds that ships with Jay clouds that
makes it a bit easier to consume using
closure so here's the code for creating
a container I'm not going to get into
too much just to say that on the last
line we're creating a we have a blob
store and we're calling this method on
it that's what the dot is at the very
start so that will actually create a
container in cloud files to put a file
in that container we wind up calling put
blob on the blobstore object on the
blobstore interface and we give it the
container name the blob the file that
we're putting in there and some options
around that file so here's how you would
actually use it in your code you would
create a blob this is really just a file
you know named my file dot log provide
it with a payload in this case it's
going to be just a string that we're
putting into that file and then we go
ahead and create a container for the
file and we put that file into the
container in Cloud Files the
documentation could be better there is
some dog string for the namespace that
kind of gives you a general idea of how
to use it and there's minimal docstrings
for the actual functions themselves you
probably have to dive into the Javadoc
if you wanted to figure out how to
actually use it which isn't ideal and it
could be better logging is done via
slf4j so you can configure it with log4j
or log back or java logging okay so
wrapping things up we've talked a lot
about closure in the cloud I've talked
about closure the cloud and then we got
into some details of how you would
actually talk to an HTTP API using any
one of these various mechanisms using
any one of these libraries so what I
kind of want you to take away from this
is you know not only is closure a great
language for working with web service
API but also kind of that body of
knowledge around the kind of things you
need to consider when you're working
with a web service with closure you know
how's that is it a just a Java library
and I'm doing closure interop is it 100%
written enclosure what's the
documentation like what is it like
contributing to that project if it's an
open source project do they readily take
contributions so a lot of things to
watch out for when it comes to working
with closure in the cloud and the more
knowledge you have the better things
will go for you and hopefully you've
agreed that closure is great for working
in the cloud thank you very much I think
I'm right at time here and but I'm
certainly willing to stick around and
take questions I'd like to point out a
couple of other sessions these are both
tomorrow one is closure made simple by
the creator of closure himself rich
Hickey he'll be doing that session
tomorrow and I also have another session
here tomorrow called the introduction to
Apache Jay clouds that's a very much
more Java focused session and I invite
you out to both thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>