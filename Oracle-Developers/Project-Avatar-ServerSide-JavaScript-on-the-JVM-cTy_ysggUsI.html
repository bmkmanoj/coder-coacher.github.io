<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Project Avatar: Server-Side JavaScript on the JVM | Coder Coacher - Coaching Coders</title><meta content="Project Avatar: Server-Side JavaScript on the JVM - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Project Avatar: Server-Side JavaScript on the JVM</b></h2><h5 class="post__date">2015-06-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/cTy_ysggUsI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so it sounds like most people here have
an idea of what avatar is you've read
the abstract and keep it pretty simple
it's server-side JavaScript on the Java
Virtual Machine and more aptly probably
recognize is you know node running on
the JVM right so I thought I'd kind of
give an idea but who the Avatar team is
in order president of presenting I'm
John Klingon i'm the product manager for
project avatar we have a key i could get
a picture for healing time you Chloe
uses a soccer game okay what about sorry
so I to the keel kills the second guy
over here and then we have our fun
unfortunately a couple of members
couldn't make it so two team members
brian at SAT is the lead architect and
Santiago is also one of the key
contributors to project avatar and he
couldn't make it but if you ever happen
to be on the user aliases now you can
kind of put a face to the people behind
the emails now we personally enjoy that
since I work at home and I never see
anybody I like to know if it look like
so I can visualize it safe harbor
statement we are going to be talking
about some potential futures so don't
make any business decisions you know
based on what you hear this is the first
time you guys have seen this agenda so
first we're going to set the context
then talk about avatar itself and then
we'll get into a an actual demo so
you'll be able to see avatar in action
so it sounds like you know there's a few
nodejs developers in here but not
necessarily a lot of kno jes developers
and so I thought I'd give a little bit
of background in context setting about
note itself so node is basically a
server-side JavaScript engine it
basically uses the v8 engine that was
that is used underneath the chrome
browser right so that's the the
javascript interpreter and basically
well you know some folks basically took
that and the javascript files are out of
chrome and turn to basically into a
server-side platform for doing
JavaScript and it's all available an
open source right and it's designed for
scalable Internet applications I kind of
pulled this out of one of their slides
and I kind of find it funny because
there's anyone advertise that their
platform is not internet scalable but
and it now me that as a joke it's just
that they note skills differently from
the way java ee scales right and as seen
with other platforms so out of curiosity
how many here are familiar with you know
Java Enterprise Edition and developing a
job on the server okay good so you guys
have that context which is why i didn't
really dig into java ee in the slide
deck so it's a melting pot community i
really like to say that because I go to
node meetups I'm from Southern
California and I go to node meetups and
people using node come from the dotnet
community the c-sharp community the Ruby
community PHP or the pure browser
developers right and they can all come
together because of JavaScript and its
really interesting just kind of meeting
people with very different backgrounds
all kind of coming together to learn
JavaScript on this server side and okay
I was accurate by the way I have the
fact that there was 96,000 or sorry
90,000 yeah 6,000 plus so I was correct
and that number but now it really should
be ninety seven thousand plus okay and
so it's a very vibrant ecosystem right
so I gave you the maven stat earlier and
this is just showing you that you know
the JavaScript community is I think
server-side javascript is equally
vibrant so the node.js programming model
is very different from the java ee
programming model so with java ee it's
typically a thread per request model
right you got a request coming in for
example to the servlet container and
then that thread basically follows the
request or the request is following a
novia thread context through the various
containers and along the way it might be
blocking right if you make your restful
calls going to pause wait for the rest
response to return then it goes off to
maybe an ejb and doesn't more
and then it returns back to the client
right so it's a very easy model I think
to understand but it's you know it's you
are kind of blocking the thread while
it's waiting for other work to get done
with the node programming model it takes
a different kind of angle now
multi-threaded programming is hard
because there's times when you have
these you know many concurrent threads
going on and what happens when you want
to access some shared state right and in
shared state in a in a multi-threaded
environment basically means you have to
deal with you know locking shared
resources and so on and it leads to
potentially things like dead locks and
race conditions and all of that so they
take just a very different approach and
blocking on Io is bad is another kind of
mantra in note so notice basically this
single threaded environment and if you
block on this thread and there's only
one thread then basically you're going
to you know wait for the wait for that
thread to finish executing whatever code
it has to execute so you want you
definitely don't want to hold do a lot
of intense business logic in what at one
time because you're going to be blocking
all the other requests that are waiting
right so it has the single event loop
and what basically what happens is as
things happen it's basically
event-driven with a callback model and
so when something happens you get
notification of it you execute the code
and you return the results and then the
next event is handled and then the next
event is handled so it's all kind of
callback driven and what I have here is
a very simple code snippet and I
apologize if it looks a little small for
the folks in the back this is where I
might use the pointer it's this binding
on this box over here and if this is a
basically very simple HTTP server and
this is the kind of canonical example
you'll always see with with node where
you require the HTTP package which is
locked a lot like importing a package in
Java and you say create a server and the
code that executes sin the server you
basically pass in
as a function in some ways it's
synonymous to lambdas in Java Java 8 now
right basically now you can pass code
around and inside this code it's
basically has a response when you're
writing out the the content type you're
writing out hello world you say end
right but the important point is that
you're actually passing tote around and
what happens is this is that piece of
business logic that gets executed on
that event loop okay so if I hit
something really really long running in
here everybody else is going to have to
wait until it's done right so note has
ways that it tries to get around that so
basically server-side javascript is all
about asynchronous computing right and
what if I'm with Java shop so how many
here are kind of in this situation where
you know you want to run node or you
want to try out note in your environment
but your Java shop right you got Joe
developers you've got all this
experience in doing Java development
you've got third-party frameworks that
you use that have gone through some
corporate standards architecture right
that are approved for use and you may
have even invested in third-party
commercial libraries that you don't want
to lose that investment in right so
that's one thing to think about the
other is in the actual infrastructure
itself so that basically means maybe you
have java ee application servers that
you've invested in and it's not just you
know licensing and support kind of
things but it's the fact that you've
built out this deployment model in your
infrastructure and you also have to
again go through all these processes
these steps and again the bigger the
company the more process there is
because the risk is higher right so you
got all these all these investments in
the tools as well like the gmx based
monitoring and you don't want to lose
that either because basically if you go
to IT and say yeah we want to start
doing node they're going to say wait a
second we're Java company and or they'll
say you know we already do Java and we
have net and now you're saying you want
to add another one right so that's kind
of the situation I think we're
potentially a lot of the people in this
room are in right this is
java conference were primarily Java
developers but javascript looks really
interesting to us so that's where
project avatar comes in what we're
trying to enable customers to do is
leverage their java investments while
being able to basically leverage those
investments perhaps in the context of
running server side JavaScript right so
if I want to create this node project
but I've already written all these
libraries that execute some business
logic I don't want to rewrite that in
JavaScript I just want to be able to
call that those Java libraries I've
already written so that's where avatar
comes in so it's basically node running
on the JVM okay that lets you leverage
the let's see 96,000 plus or 97,000 +
node libraries those you know 60,000
Java libraries are in maven and great
that's a tremendous amount of logic that
you can leverage right we've also we
also provide some Java EE on our
interoperability and will explain that
later but for example you can actually
call into jpa and what's nice about that
is such as JavaScript API you make jpa
calls and that because jpa uses jdbc
drivers to talk to virtually any
database right so basically now if node
you can use one library and basically
talk to any database that's out there
right that's really nice and you of
course you can use it to build
enterprise applications in JavaScript
right so you can we're used to running
our enterprise applications using the
Java EE infrastructure right and now we
can basically augment that using project
avatar and a lot of times what we see is
this this architectural layer where you
know I mentioned there's tends to be
these very mature processes within an
organization and they don't want to make
changes very often
this enterprise infrastructure right
then you got people within the
organization trying to build these
mobile apps and if users see that a
mobile app hasn't been updated in six
months they think it's a dead app right
so you have this very high rate of churn
for of applications that you want to
present down to these mobile users but
you have this very mature infrastructure
that doesn't want to change very often
and what's interesting is what we see is
this intermediary layer that a lot of
users are looking at node for to
basically rapidly build new api's and
new functionality to deal with that high
rate of change as it goes down to these
mobile devices but yet it calls into the
stable back-end right so that's kind of
a use case that we see that's very
popular so what's new and avatar too low
so out of curiosity how many have
actually been out there again to see
avatar 10 and maybe you've downloaded it
and play with it okay okay good because
there's some important changes and I
think improvements to what we're doing
with avatar so if you go in you look at
avatar right now and you've downloaded
from avatar cat java.net that's the plug
intentional what you'll see is avatar
running inside of glassfish a java ee
application server right so in that in
that scenario you actually have to be
running an application server to run
your note apps right and you know we
talk to developers and we were running
into some interesting technical
decisions as well and so what we decided
to do was change things around a little
bit to get that interoperability we
don't necessarily have to run inside of
the application server so glad so avatar
basically runs now in its own standalone
JVM so just like with node you say node
and then the name of your JavaScript app
no basically you can run avatar and just
give the name of your JavaScript app and
it'll run it okay and so no application
server is required just to run a new
pure note app and it runs out of the box
right so basically you know you download
it young zip it and you say no and
you're
you're off and running and so it's all
from the command line just like notice
and avatar what you will currently see
out there on Avatar java.net as we also
kind of have this prescriptive model for
how you should define services whether
their services that are exposed of her
web sockets over server sent events or
over restful endpoints and it tightly
coupled to this client framework we had
created which is basically a JavaScript
client framework and there was this
model that basically was really good at
doing binding with between the two and
the problem that we had with was it was
doing that was theirs you know note has
a very you know a ton of libraries right
that can that basically can do web
sockets and rest and on the client side
there's a constant rate of change for
JavaScript clients in libraries right so
what we decided to do is you know less
again make this look you can feel more
like node so instead of trying to do
something different let's just let you
use the node libraries that you like to
expose the services and the JavaScript
libraries that you like to consume those
services and we'll just focus on the
Java interoperability and the Java EE
interoperability and the manageability
ok and I think this is where we get to
Akhil
and so we take a look what's inside
avatar so one of the components of
avatar is a project called avatar GS
it's a little bit confusing
so avatar GS is basically a port of
node.js for the Jovian we tried to use
as much as possible of no Jay sources BD
use the JavaScript sources from noches
as is and under the covers we replace
the JavaScript engine from v8 to our own
the Nassau and JavaScript engine in in
jdk and we also used the same libraries
that known uses there's a library called
Libya V that node uses for platform
abstraction to get the same asynchronous
i/o behavior on oil platforms we have a
Java binding for that and we call into
that and then the HTTP parser also we
use the same HTTP parser that node uses
so that this lets us achieve 95% node
compatibility as measured by nodes unit
tests and we have to patch some of the
unit tests to increase timeouts because
our party vm give slightly differently
it's it's tuned for long time
server-side performance rather than
client-side performance and so this lets
us use whatever popular packages are not
know Jess they run on Avatar Gia's as is
but there is this limitation that since
we do not have yet so any any 8pm
modules which use the chrome api or the
v8 api they will not run on 10 so no no
native so that was our third year so
that's one of the components of avatar
and then we add some enterprise features
to it one of the features that we add is
multithreading you can run multiple
threads in the same vm and i'll be
talking about that in a in the next
slide we also have api's for
communication between those heads and a
persistence api and then for talking to
java ee so that in a nutshell is avatar
here is an architecture diagram with a
lot of boxes I'll quickly talk about
each one going up from top to bottom at
the top is your application and notice
that it says JavaScript modules as well
as Java jars so since it's an avatar
application it can be written in a
combination of Java and JavaScript so
you would have a jar as well as some
javascript in your application which
would call into third party javascript
modules these are npm modules that you
would get from the npm repository and
underneath that is the avatar API
modules the ones that we talked about
the persistence and shared state
underneath that is the node modules like
that you would be familiar with if
you're a note
programmer things like buffer net HTTP
you saw the HTTP module in the earliest
life so that part is JavaScript then the
purple purple boxes are Java code that's
that's mostly implementation detail that
is not exposed to the user so I won't
talk much about it but some components
like i'll talk about nasa in the next
slide because that's important to
understand and then at the bottom we
have the JVM itself and the lib UV
library that i talked about earlier that
gives us compatibility with not so that
chavez NASA one was it is a JavaScript
engine that that was written from
scratch it was introduced in Java 7 it's
written all in Java and it is one
hundred percent compliant with the
hikmah script standard it it provides
very good interoperability with child so
you can call into java from javascript
and you can call back from JavaScript
into Java both ways it makes it very
seamless there are there's a lot of
documentation available on NASA on but
the one that I would like you to look at
is the scripting guide that shows you
how to go about directions and the call
is actually very efficient from going
either way it's there is no conversion
happening because both are running on
the same jvm so it's very efficient and
we have Marcus here who can answer any
questions on NASA as you can see it's
very fast as compared to rhino rhino was
there in earlier in Java 6 and nasaan
has replaced by knowing 7
it and it's going to be much faster in
nine next slide so this is a very
interesting slide this shows how you can
combine java and javascript in the same
application notice that the orange code
is JavaScript and that's your typical
node application the very similar to the
HTTP server you saw earlier now the blue
code is actually Java code in when
you're doing note programming you when
you learn not programming you you learn
that you should not do computationally
intensive tasks in your JavaScript
because when you're because it's all
single threaded and then when you are
doing that computationally intensive
task everything else blocks until you
are finished with that but if you have
access to Java like here if you are
running on the JVM you can you can
actually work around this limitation by
this example like assume that this
filter operation is is very compute
intensive so what will happen here is
that this compute intensive task gets
split up by the streams API and it gets
distributed across all of your course
all of your processor cores and it will
actually execute in parallel the results
will get collected and then the
responsible cell will be same so this is
a very good example of how you can
combine java and javascript in the same
application another thing to note here
is this this
lambda expression that is an argument
for filter you can see that it is not
it's not using the arrow syntax so the
lambda here is actually a JavaScript
function that's pretty cool you can pass
JavaScript to any any function that
expects a lambda expression talk about
multithreading so what what avatar
enables you to do is running multiple
instances of the same application in a
pillage avium so the idea behind this is
that if you were to do this in node you
would run each instance in a separate
process but here you can run them all in
the same jvm and this gives you higher
density you can run like you can use
more course using less memory each each
instance will have its own event thread
and it will have its own JavaScript
context so it's it's isolated from each
other if they want to talk to each other
they have an API which we call the
shared state API and talked about and to
to send messages to each other and for
coordination there is also something we
call shared sockets that that allow
incoming socket connections to be moved
out multiplex multiplex to different
instances so there's a configurable
policy that you can use round-robin for
example to have connections go to
different instances and if you want you
can also create background threads
explicitly for doing say compute
intensive tasks that you would in the
node value would be forking processes
for those here you can just for cough or
thread
and threads is much cheaper than
 processes so here's a diagram
that explains what I just talked about
so you have incoming connections from
the top into this shared socket library
which is an implementation detail it's
not exposed to the client it's not
exposed to the application it just works
seamlessly and then connections get
distributed to your various instances
which is each running on a separate
thread on a separate core and then if
coordination like each instance can send
messages to other instances wire this
shared state API these these messages
that i send are not object that's like
serialized objects the objects
themselves are not shared
representations of those objects such
air so we look at some corner here is an
example of how would you will create a
new event threads it's as you can see
there's a there's a threads module you
just use the usual require avatar /
threads and the threads module exposes
an API new event thread you give it a
name and the second argument is the path
to a script that you want that thread to
execute and then the third argument is
some parameters that you can pass to the
thread and then when you you can start
the thread and it takes a call back so
the callback has two events started and
we ran out of space there's a stopped
event also cite it calls you back when
the train starts and stopped
it's the shared state framework as to
api's one is the method a message bus
API which is a very simple
publish-subscribe messaging and another
API will it exposes a map kind of API
which can be scoped to the instance or
to a session and then different threads
can put objects into it and pull objects
from it and avatar provides the
underlying infrastructure to enable
these LS and all these api is work a
synchronous ly non-blocking is an
example of the message bus it shows you
how to subscribe to any event it's very
it's a very commonly used pattern in
node program you give it the name of the
event and a call back so whenever an
event of this type is received your
callback will be called and then you can
do whatever you want subscribe is
similar to 12 to the on method and
here's an example of how you would
publish an event an event can be any
arbitrary JavaScript object so here we
are publishing an event called messages
with this large JavaScript object which
contains various fields and then anybody
listening on messages would get this
object would get a representation of
this object
another very useful API very easy to use
API is the persistence framework it's a
JavaScript API which supports relational
databases as well as no sequel databases
and you can configure which one you want
based on just some configuration setting
you don't have to hard code anything you
can switch dynamically it it's very
similar to some existing JavaScript
persistence API is and we haven't
there's a lot more work that can be done
here like in generating JavaScript
schemas that we haven't finished yet
here's an example of how you could use
this API first you have this
configuration that you can use to switch
back ends and provide credentials and
stuff and then you define a model log
which is in JavaScript and then you find
the model to the store
so this is where you can find the model
to different stores the store can be
specified in the configuration once
you've done that then these methods on
the module become available get all will
give you all instances of all objects
that's stored you can create new objects
you can delete them by key you can
towards the end you can see there's a
get my key and there's an update banky
so some things that are still in
progress and and there's a t3 there's a
JavaScript API for the t3 thin client so
that you can call into your existing ejb
and JMS applications there's feature
that is very cool way you can have
avatar watch your javascript and java
files as you're developing and as they
change it reloads the application it has
it speeds up development we are working
on adding flight recorder probes to
avatar so that you can observe it from
now you can have remote manageability so
you can see what your application is
doing in tools like Mission Control and
visual vm we are working on tap
integrating support for coherence
and that's when last light I think now I
find will show you a cool demo that
bitter
ok
so can you all hear me
how can you hear me
okay I'm trying I'm gonna shout a little
so no you're not here shut up sir all
right okay now it's working okay ok so
the demo basically tries to show the
threading concept in avatar here's a
diagram of the architecture of the demo
basically you have we have the main
application the Avatar application
that's called main da GS it's a
javascript file that that starts up the
whole application and it uses the
Express GS module in from node to set up
your route api's and that is what the
browser will communicate with with
avatar application so what we try to do
is the demo has the concept of simple
ball so you have a UI where you set up a
small ball and that ball has is attached
to a javascript on the backend and each
each time I try to create a ball on the
UI the new thread will be invoked we'll
use the new will use the create event
thread and the balls dot JS file will be
run in that thread so the idea behind
the demo is that the main application of
the main dot JS file is connected to the
ball dot JS files there will be multiple
instances of ball Dodgers and they will
be communicating with each other through
the message bus so once the ball dot JS
file has been invoked and it is running
in its own thread it will start
communicating with the main file or the
main application through the message bus
and start sending various messages
across these messages we are terming as
heartbeat so once a ball receives a
heartbeat prompt from the thread that
it's running in it will start bouncing
up and down so at the same time we have
something called model yes that is the
model store API so each time a new
thread is created it takes the data of
that thread and stores it in a database
so that once you shut down the
application and we start the application
you'll still be able to get hold of all
that data and start creating the threads
again okay so let's so I'm going to
start the app we have a command line we
have Gordon aimed at lira so it starts
the main de geus and on the UI just kind
of okay so i have received a message
from the main dot J's file or the main
application so we can post about the
whole thing okay so the the bottom
section over here we call it as the
heart beats so the heartbeats are is
where you'll see all the messages coming
from the threads so I'm going to go
ahead and create a new thread so okay
there you go so now what has happened is
that one ice once I said new thread it
send a REST API call to the running
avatar application and that application
basically created thread thread is
nothing but it has a color and gravity
just two fields and it's toward that
information into the database and then
start it a bald or GS in the threat of
its own that ball dot J's file what it
does is it uses the message bus API and
sends messages back to the main file
telling that ok i am alive now and this
is my data so that message is received
through a web socket on the client over
here and once the client the UI receives
that message it knows that the thread is
alive now and it starts moving the ball
up and down now what we are trying to
show over here is that there can be
communication between the main
application and the threats that the
application has invoked and that
communication happens through the
message bus API so at the same time I
can also say update the thread or update
that particular thread let's say if i
want to send arguments i want to speak
to the thread and say that change I want
to change the data and the three
so let's say I want I'm gonna are better
I'll crate three threads so this you
cannot do in node right now because they
knowed you'll have to create three node
processes to do this whereas over here
we are just creating three event threats
in the same jvm and they are each
running an instance of bald rjs so i'm
going to send i'm going to tell it tell
two of the balls to reduce their gravity
so they'll start bouncing a little
faster so now this happens the message
this what happens over here when I when
I click on save I again use the rest api
to send a message to the threats that
your gravity has changed and once the
gravity is changed in the balls itself
they send a heartbeat saying that okay
this is the new gravity which is picked
up by the UI so that's how the message
communication happens between the
threads and the main application now I
have a shutdown button over here what I
am going to do is with shut down I'm
going to shut down the main application
so once the main application shuts down
the heartbeats stopped coming to the UI
so the balls will stop bouncing up and
down and okay there you go so over here
as you see that the the script main has
stopped so it has been shut down so now
this shows what a one-size restart this
application the main script will use the
model store API to look into the
database and it will try to pick up the
old threats that were have been stored
and once it finds out that there are
threats over there it will try to
restart the event threads and try to
recover you get with the UI let me try
to restart okay
so it's starting so once I start
receiving the messages okay the client
is up and the heartbeats come back so
now the balls start bouncing up and down
so I'm going to go into the code a
little bit so that we can show you what
what actually is happening so okay this
is the main dot J's over here what it
does is it it is a node app this is like
no Dupuis are just invoking the we are
requiring express HTTP and our avatar
modules and over here we have a rest
module and the ws that's a WebSocket
module which we require so the main the
meat of the code is in rest over here
the rest are jess is basically it sets
up the roots where we asked where the
calls from the UI come in for example /
threads returns all the threads there
are in the database and / thread
basically tries to create a new thread
so once it receives when I when I click
the new thread button it comes to the /
thread and it tries to create a new
thread so this is the new event thread
API that we use to create an event
thread and it takes the ball dot J's
file and passes in these arguments so
the ball tour jess is a simple
javascript file which which basically
sets up the message bus so it's
listening listening on events like kill
arcs update and then and it is going to
it it uses publish messages so it that's
how it's going to communicate back to
the main application so I'm going to run
this in an interval of every two seconds
so that's the heartbeat so every two
seconds it sends a message to the main
application okay I'm alive and these are
the components that I have the main
application takes that heartbeat and
through a WebSocket sends it to the
client to the browser and the browser
tries to
do the stuff with with the message that
it receives the storage s is our model
store API so basically over here i
define a store which is the access to
the database and that's configurable so
that's do it so the store basically what
what it does is it tries it creates a
model store it sets up your jpa link
into the database and this is
configurable in the sense that I can I
have conflicted ebit on name right now
i'm using Derby but you can use Oracle
XE you can use no SQL you can use
MongoDB whatever you want so it will set
it up for you you don't have to do and
basically once you change the database
you don't have to make any changes to
this J escort the the model store API
will take care of that for you so so
this is the API I call get threats
threads model not get all threads model
dot create delete and that's going to
take care of creating creating the rows
in the database deleting them or
updating them at the same time so it
it's a very simple you API and it takes
I mean you don't have to think about
databases you don't have to know what
database you're writing to what the JPA
store will set it up for you yeah this
is non blocking because yeah so the
question was whether this API is
blocking or non blocking right so this
is non blocking right now because over
here we use promises and if you see I'll
show you if you see the update thread
I'll try to increase the font just give
me one second
okay so that should be so what we see is
I'm doing ball threats get and then
that's a promise basically so it it goes
to the database and waits for the data
to come in once in that data is
available the promise we use the when
API and it says Deford not resolve that
I have data now and that is what's red
red over here and so it it's it's not
going to block the whole app but it's
going to wait so at the same time the
data from the client also uses the
promises so once the data is available
it's going to move on until that it so
it's not going to block on any of this
thing so what at the model store layer
we have written has API functions for
that so it tries to what it tries to do
is if there is a blocking API then it
tries to convert it it makes it into a
non-blocking API by submitting using the
event loop and submitting returns into
that zone
yes seem a pity passionate so the
question was whether the thread support
the multi-core architecture right yes so
the answer is yes for that and the WSJ's
module is just we are using the web
sockets over here to whatever whatever
data we are receiving on the message bus
that is being sent to the browser the
client so we are already open for
questions yes so actually maybe people
can type of venture doing so I you know
what we tried to show with this demo is
a few things we tried to show of course
some of the avatar specific API so you
saw the persistence framework you saw
the multi threading we should also try
to show the fact that we're using node
frameworks right so we're using Express
you probably saw we're using the web
socket I think there was a what was the
other one went in sequence and right so
there's no DPI's in there as well that
we're using we're using some of the
it'sit's java ee in terms of the model
story p I using GPA right earlier earth
on not agri fine mikheil mentioned that
we also can remotely invoke ejbs and
communicate with JMS brokers through the
weblogic t3 client thin client API hmm
Krista who wants to listen from West
Michigan west or from other like jvm
right so what about other GMS yeah or
you know remote connectivity solutions
right to other app servers that's why
we're here okay oh oh okay that's our
that's different question so one of the
things that we plan to do I think it's
next slide I have the slide so that at
least one solid income because it's just
as long as you have a java jar for it
like you just call it this you just you
can call any java api yes any any API
that you have Java code for you just
drop the Jardin into the lib directory
it gets picked in picked up and you just
call into it the only thing that you
have to watch out for is that some API
is our synchronous API is some Java API
is our synchronous so you need an
adapter to make them asynchronous
essentially we will provide an adapter
that will adapt that API it'll make that
synchronous call inside the thread pool
so that and when the call when the
response comes back it will call a call
back so you will have to use this
asynchronous adapter but you can
essentially call any Java API that you
want there is no restriction
using job if it was the lady was running
on a gba and the messaging yeah so so
the question was the only thing Java
that we show it was the fact that I was
running on the JVM and we were calling
into GPA yeah we didn't show it actually
invoking perhaps a Java library that
could have been some custom java library
right it can adjust we were trying to
constrain the demo because we weren't
sure how much time we would have for the
demo at QA but you can definitely call
into your own Java libraries right in
fact that's what we do with the GPA
right is we call under the Java
libraries using Nan's forms ability to
have java javascript or operability yes
question guys exposed in transactions di
somehow for this be persistent layer ok
just have to roll for when
some bad result okay so the question was
are we basically exposing transaction
api's for transactional model reason you
can guess one answer that again it
doesn't matter what the AP is as long as
you have a java api for it you can call
it from the JavaScript application yes
there is a store and Moodle at the end
is available yes it would be nice
together somehow you know if you have
tried this aspect of sadness from BGC
would be nice to girls are so low
configuration based research management
works on out what you're doing about I
don't know the answer to that we do have
we do have a transaction API in mortal
store right now but that is linked to
the JPA thing but if I guess what you
are trying to say is let's say I don't
want to use JP I want to use some other
life I have you much for ki dua
or if I say yes you can or whatever why
some elves yeah so we are working we
have I mean there's a prototype on that
so but it's not we hopefully will be
exposing that but that there is a
transaction API you can run transactions
you can commit and there is two phase
commit and all that that is supported
okay so I'm gonna try to somebody else
here okay we have another question in
the back yeah so the Vela btus java and
javascript is that restricted to avatar
and the answer is no it's in every every
basically beating with jdk 7 and above
you can basically call between Java and
JavaScript because the nance form
JavaScript engine basically is available
beginning with jdk 7 I should mention
though that avatar requires jdk 8 okay
but generally speaking for that
interoperability katie k 7 was a
question way back there in the back
apologizing was a sense of speed
comparisons between is a match on me
because you guys keep talking on natural
right all the time okay so we have a
performance question about between as
horn and v8 and would you know that we
have the nazil developer here one of the
key developers you want to use the mic
because they're recording everything
yeah maybe you were my session on monday
or maybe you weren't a session at okay
and well it comes to node we actually
had some very good results with server
workloads 48 the upcoming a 240 release
if you're running with a new optimistic
typing framework there are a couple of
benchmarks that emulate server load on
on the avatar such as the HTTP en rest
benchmarks and similar loads like that
we are actually able to show that we
have peak performance that's and that we
maintain that's similar to what you get
with running note would be v8 this lee
ready know that the job was a loading to
and if you look at pure benchmarks
number-crunching micro benchmarks mini
benchmarks like the octane sweet we're
actually already on par with v8 several
of them and there are there is ongoing
work to make this even better and invoke
dynamic is for serious application of
invoke dynamic where it's like every
fifth or every tenth byte code we've
implemented lambdas in july with invoke
dynamic but only now we've been able to
sort of see where it performs and
doesn't perform and we are working very
hard on making it work even better so
both on the JVM side and another on
itself we are we are spending a lot of
time and effort on getting your native
performance so this is something that
should get just keep getting better and
better right now we have a little
regression in warm up that we're also
confident that we'll solve because of
the extra type calculations that we have
to do there is also type cash so or up
the optimistic type cash and the code
cache so if you're running the same
avatar workload again again the same
code you can actually see realize all
optimizations made no code to disk and
have very short start up with maintain
performance so slowly but steadily we
are getting results that we thought were
impossible we started with invoke
dynamic so so I'm quite quite happy with
the direction this is going
sorry I'm trying to find some of the
hands and answer question will try to
get to as many as we can oh yes are you
were next in that booth over there yes
the same time giving use what need to be
able to get a new towel everything sir
you'll have to have not on that oh fun d
so so the question is if you wanted you
java and javascript around probability
do you have to have some kind of wrapper
around it and the answer is no you can
just invoke your your your java code
from javascript and then like you saw in
that example where i was just adding
variables to an array right there was
that one code example you may have to do
a little work first to get tickets
access to the object but after that is
just making making calls you can
actually then if you want a pure
JavaScript API so perhaps you're the guy
responsible for wrapping this old
JavaScript developers can use it more
and more naturally then you might write
a Java Script wrapper around your Java
code if you want to and also if you want
to convert it to a synchronous yeah so
if you have a synchronous API that
blocks that makes a network request and
may block four seconds at a time you
don't want your JavaScript application
hanging while you are making that
request so that's the reason why you
would want to wrap that application in
with this asynchronous rapper okay so
sorry next question yeah
what support you have for java
annotations or the spring or Johnny to
eat with your JavaScript and you just go
in those JavaScript applications in
JavaScript so to me I'm starting to
repeat the question so so the question
is can you use annotated you know Java
annotations within your JavaScript
applications right E&amp;amp;S horn known as one
does not support and that the syntax is
different so it would be put through a
syntax error rights range then you can
directly use that success for sponsor
yes vs. for JavaScript yes is there some
way you know I never prove anything
Billy yesterday there will be away
greats it's not there yet you um you
could like comment out you could have
these annotations as comments and then
you could write a custom post processor
that will process them after that will
be an ID on to NASA on its its work in
progress so talk to my doctor Microsoft
Azure ok ok we have another question in
the back
so when it national enquirer say he
introduced all so doesn't require knows
we stole the consumer and well never
stopped because any advance with the
notice though so the question is does
avatar require node to be installed to
basically use NPM to download packages
so at the moment yes you need note and
NPM to be installed to download the
packages but once you downloaded them
you can just package them and put them
under avatar sorry yes once yeah avatar
will you use any packages any NPM
modules that it finds in in the same
path that that node looks for right yes
exactly the same directory struct it
uses the exact same algorithm to locate
NPM packages okay next question so
yes so so the question is does avatar
maintain a dependence on native
libraries right these native libraries
yes there are two native libraries that
it uses one is this Java binding for lib
movie and the other is the Java binding
for HTTP parser both are open source
projects that you can look at download
and avatar jas khatiwada sorry those are
the question becomes citrus are coming
all are waiting for Santa tracker this
was the result in some type of you
good fair okay so so the question
basically is I got multiple requests
shouldn't that result in multiple
threads endowed right some somehow you
gotta handle multiple requests
concurrently right so yes so that the
way this is the node evented model so
what happens is as as requests come in
they are serialized and and callbacks
are called one after the other this
happens quickly enough that you don't
need multiple threads know if you see
like compare note benchmarks if it is it
is very fast yes so so the request
itself gets serialized it uses
non-blocking are you so you don't have
threads you don't have a thread per
request so as a request comes in it is
kind of put in the background and then a
callback is called into JavaScript and
that callback can then take as long as
it wants mean I apologize takes several
seconds and then when it when it is
ready when it has data ready to be sent
to the climb it it kind of makes up that
request you and and writes it out in
apologize we're it's it's four o'clock
and our sessions ended we have to let
the other one but one thing I did want
to say before we go the code that you've
seen with a demo it's not out yet we're
going to basically push avatar 2 point 0
out to have it avatar dead java.net give
us a couple weeks to a month we couldn't
get it done in time for java one but
just kind of if you can't go there join
the avatar mailing list and we'll let
you know okay thank you very much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>