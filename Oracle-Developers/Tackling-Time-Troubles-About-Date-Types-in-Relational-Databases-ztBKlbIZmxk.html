<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Tackling Time Troubles - About Date Types in Relational Databases | Coder Coacher - Coaching Coders</title><meta content="Tackling Time Troubles - About Date Types in Relational Databases - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Tackling Time Troubles - About Date Types in Relational Databases</b></h2><h5 class="post__date">2018-02-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ztBKlbIZmxk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right doors are closing it's ten
past two so I guess I I guess I'll start
now I hope everybody's fine after lunch
um I certainly feel I'm full enough to
take a nap now but I shouldn't I'll try
to stay awake through this and if you
don't III have sympathy so this this
talk to attack me time troubles it's a
collection of things that I found and
we're interesting around dealing with
times and time zones and all of these
things and it's a it's a collection that
I thought I built together from some
things that I've encountered I hope it's
useful for you yeah let's see that tube
molecules um so I've been working as a
it's mostly an Oracle database
consultant for the last 15 think
approaching 20 years now I do a lot of
consulting some clothing around PL
sequel and some coding among ETL
pipelines and I've done a lot of other
things in DevOps with systems and
automation most recently things that is
really exciting you're screaming ETL
pipelines all of you were in Gwen's
talked earlier about Kafka and K sequel
that's the stuff that currently really
really excites me nice direct on Oracle
developer champion that's really cool
and this is a really old slide thickness
a seven-year-old sly tech and I used to
do a lot more triathlons than I have
done the recent past and 2014 I actually
did an Ironman and there's a triathlon
in San Francisco where you swim from
Alcatraz to shore those were fun if
you've done this it's an amazing trial
fun and actually the bike is the hardest
part that so the swim in the bay I mean
I mean have a decent swimmers that's
fine it's just cold but the bike was
really hard on these hills I didn't
enjoy that very much so I haven't done
much of that but at this year I said I'm
going to try it once again so I thought
let's leave these pictures up here so
I'm originally from Germany a town
called Hamburg which is way up in
northern Germany it's second largest
port but a year ago I moved to Canada
which is why I'm wearing this Despero
now and I really love Canada is a
gigantic country obviously you guys are
all Americans you know how big this
continent is this is a picture of the
town I live in in Ottawa this is a
picture in the summer and then this is a
picture right now
got to say the air-conditioning of you
is so hard but I feel it's colder in
here than outside and out there at home
I usually get asked what are these weird
thoughts on the name and how do you
pronounce and I I've got to say it's
really hard like when I switch my brain
to English speaking mode I can't even
pronounce my name I'd have to
concentrate really hard so it's constant
pronounced beyond but I usually say
björn and when I'm in Starbucks I call
myself Brian I'm just explaining how to
write this is really hard and I mean
don't have when I have a five-minute
discussion for two minutes coffee and
the name is actually swedish so it's not
a german name it's a Swedish name and it
has the meaning and there's actually two
famous Swedish people there's beer and
board which is a tennis player and now
he makes underwear and then there's some
there's another one of the singers from
ABBA was also called The Onion's it's my
parents both like tennis and European
pop music so I'm gonna vote so it is
it's actually word it has a meaning and
it means pair sore that would be me but
if you look at me then this is probably
a proper representation of that right so
that other way like I said this is
really all presentation this is a first
time I did this presentation was in in
London and and this was the calendar of
that day and I thought it was fitting
because I was still preparing slides
five minutes before the presentation I
thought this is this is gonna be good so
so look at my my flight which is my
calendar told me it's going to leave it
8:25 and if you look at the notes it
actually says you know you're leaving
7:25 British time and for some reason
this counter and she wasn't made
correctly it's just one of these points
that I thought this is funny so other
people have problems from struggle with
how to manage times on data so that was
my point of yeah this presentation is
probably useful to help others maybe
avoid things like this there was also
another like talked about Apple and iOS
there's another weird part just a year
before where they change the timezone
but Apple didn't fix or it didn't have
the proper code in their alarm app so
the alarms didn't go off the right time
so that was kind of inconvenient then
they fix this bug and the year later
this this happened so I was I was
actually at a brunch and you see the red
line says 9:30 but it's between 10:00
and 11:00 so they did fix the
they still didn't fix that thing lucky
if my alarm went off the right timing
that on that day and then this happens
all the time we have this lady like the
company I work for it's very global we
have people all over the world we have
meetings at any given time today back
then I had meetings with the rack
special interest group and we'll set up
a meeting and somebody would send an
email saying where are you there's
nobody on the bridge and I would say
well the call happened an hour ago
and that was one of the first years were
in the US which the daylight saving time
earlier so that confuse people this is
Facebook even Facebook does it so this
is my birthday 24th of November if you
want to send me presents so you see that
there's an event on the 24th which is
the invitation for my birthday party but
if you hover over it it says that my
birthday's actually in the November the
23rd which again yeah you can Facebook
dustless but the actual problem I
started this this talked about was this
one this was something something
actually somebody paid me to fix and
they rendered this error they receive an
Oracle they are saying specified field
not found in day time or interval and if
you look at the error message it
basically means that whatever time you
were trying to select or query or insert
does not exist because of this daylight
saving time switch now the weird thing
was that the underlying table that this
thing was currying didn't have a time
limit on zone so it shouldn't have the
problems because there's no way for
Oracle to validate if a given timestamp
is valid if it doesn't know the time
zone with it
so why did I get this error and we get
to the explanation of why we got this
error somewhere in the middle of the
talk I think there's a bit more of an
introduction coming all right so that's
the agenda we talked a little bit about
what time data is some want you to think
a bit about how we carry it and then we
get to data types one of the key points
of me is functions and math and I've got
a couple of fun examples of things that
are broken or maybe unexpected and then
in the end we'll go into time zones and
daylight saving time and all the all the
good stuff
so things that we store in and dates are
like thanks since things when things
happened or maybe a user sign update a
user's birthday schedule jobs things
like that that's usually things that we
double use
Storen types of data the curvy run are
usually range based if you think about
it that makes sense we almost never
asked at which specific time did
something else happen but we might ask
give me all the events that happen on a
single day or it give me everything that
happened after this other event or it
give me everything that happened in a
certain interval around another event so
we almost never even though some of the
queries you might write have an equality
sign there it's almost never equalities
actually are almost always arranged and
that's even more true for Oracle than
some of the other databases we talk
about data types and my sequel and
phosphorous and they have they have to
make it easier to ask for for equality
but in Oracle at least pretty much
everything we do is a range the range
scan so and there's two things that I
see people doing and I want to
discourage you from from making the same
mistake is it's so tempting to just use
fire cars to store dates because that's
easy and it makes it easy for us to read
and you can see this like instead of a
table and create a column called daytime
and give it a var car data type and then
insert whatever I want to insert into it
but please don't use this and the reason
why I want you to not use this because
it's so easy to make mistakes but it's
so easy to insert invalid data it's so
easy to it's really hard to do math on
this because what what if now you want
to know how many days to New Year's it
is like how do you calculate that you
would have to extract all that logic and
program that in your date in your
application which is something that's
really boring you don't want to have a
date parser and then implement data
arithmetic especially since it can get
really complicated the other thing I see
is people using UNIX timestamp subspaces
second since 1970 similar problem is
those always exist but again you have to
translate that back to a date if you
want to display it and then how do you
do like how do you add subtract things
to it what's the meaning I also want to
discourage this and then recently I
worked on I worked on a data warehouse
by somebody created a date I mentioned
which at first seemed like a good idea
so they created a table that had a
surrogate key so just an ID for for the
key and then they stored the actual
calendar date in Oracle state format
and
they had a bunch of other columns that
basically just pre-process things like
give me the month of the year so that
would be a number between 1 and 12 and
the quarter and the weeks and day of
week name all things that we can
actually do right from the date itself
and this made really easy for the BI
guys to write their queries because if
they wanted to get something for the
first quarter they could just say give
me something where quarter and join this
dimension table and say where quarter
and count like your equals one or two or
whatever but there are lots of problems
and we try to that's a simpler quarry
but once you get into more use cases
like give me compare this fact to effect
that happened a month before this we now
have to join this dimension table twice
and do the math there and it really
makes querying these fact tables a lot
more complicated so I'm trying to get
them to not do that anymore
so it's a bit of a quiz for you guys
which of these dates are actually legal
so let's go over them look which one
these dates are legal
let's let's go over them one by one so
the first one who thinks the first one
is legal no and then why is that okay
it's a sixty Seconds thing okay the
second one it's not legal it's it's not
a leap year 2013 was not a leap year so
29th of February didn't exist all right
um the next one 2011 142 a Europe London
well your bluntness is GMT sort of so
that time a day early or later would
have been valid but that's the time when
in 2011 the Europeans changed the
daylight saving time so that's when we
skipped an hour and that's also why the
next date is also not gathered because
2014 that thing is when the u.s. changed
today light saving time today or away
from their savings they switch skip the
hour what about the next one
I know it's a while ago possibly
possibly invalidate your my thunder so
yeah so if you could try to do that if
you try to compare you the 5th of
October 1582 or the 7th of October
Oracle actually knows it doesn't so I
try to produce a date that is the 7th of
October 1582 and Oracle returns the 15th
of October so that's odd so 5th of
October that we turned the same result
ninth of which one would return the same
user that's that's weird so what's
what's going on there
and this is this is what I would call a
good pub trivia if you want to impress
other geeks this is I think this is good
stuff so Julian I guess Caesar invented
the the Julian calendar and he was
pretty good already for being like what
2,000 years ago they already figured out
that a year like a solar year was 365.25
days per year so they already figured
out how to do the leap year thing and he
figured out the problem is what he
didn't know is is that the real solar
year is about 10 minutes or 11 minutes
shorter than 365 point
so he didn't care and I mean the
difference wasn't that they to make a
difference until 1508 fifty hundred
years later this guy had a problem with
this and that's Pope Gregory and his
problem with this is that the date of
Easter is tied to the lunar calendar and
also I mean I supported chief joke but
they couldn't find the easter eggs in
the snow because it just moved that way
in the year but the other other problem
is also that Easter is supposed to
happen after some lunar Solstice thing
that is happening in the bottom the
equinox awesome but it wasn't anymore
because of this like by this time ten
days have shifted so the lunar calendar
was out of sync with their calendar and
he thought this was a big deal and he
said that fixes so he said wasn't right
he brought solution and solution was
let's just skip ten days so to make up
for the ten days that we've lost the
last fifteen hundred years we just skip
ten days and he just picked the October
5 to 15 4 5 to 9 14th as the dates to
skip so these days never happened and
I'm just happy that at that time
computers were another thing because if
we think that the year 2000 was a big
problem then I don't want to know how
accounting software and everything else
would have dealt with that he also came
up with the idea of leaving out a leap
year so the problem was that every four
years was a leap year and we had to skip
leap years every now and then so the
formula now is that we only have a leap
year of one out of four times so 1700
was not leap year in those divides over
5 489 it was not leap year bit although
it's advisable for 1900 not by 2000 was
a leap year because it was not only
divided by 4 but also by 400 which was
the rule
he also modified the lunar calendar
slightly I didn't read up on what
exactly you did there but since then
Easter Easter is all right Easter is
doing fine the weird thing is this
hasn't been so he said let's do this in
1582 but he had to get everybody else to
do it and so I think the US or Britain
and the u.s. changed this in 17 some 270
20-something and the last kind of change
to the to the Gregorian calendar was
Greece and they still use it until what
almost a hundred years ago so they were
still using
the old Julian calendar because they
said we are rear auto docks we don't
care about the Pope so that's that sing
with the pots right so the the before
Christ after Christ all of these Roman
emperors were really egocentric and just
decided that every time they were born
that's when the new approach will start
and it took until like 500 after Christ
forum some Hmong to say that they should
use Jesus's estimated birthday as the
Year Zero you're one see that's that's
like you see my thunder again so I'm
trying to get a year zero I thought it
might be your zero so I'm trying to get
Jesus birthday so select the state an
Oracle and get the 24th of December zero
I'll try to do this and I get an error
says no you can't do it you have to
specify a year between and this and that
and it must not be zero and you might be
right I think it was actually year one
that they said he was born which as an
IT person weirds me out that they would
start counting at 1 so but I didn't give
up I said I still want to get 24th
December zero so I subtracted eight days
from the first of January zero one and
sure enough Oracle can produce a date
that is some that is in the year zero
again not something you might need every
day in your jobs or your education needs
to have but um you need the state just
subtract from from your one
all right so datatype somebody to go
back to these already lives in a bit I
think I talked about other data chips
it's just a reminder please don't use
the character base please don't use the
unix time there's proper time stem to
deal with day time data and my secret
thing has it has it pretty right I think
they they having they have something
good going for them it's probably only
one thing I would like to see from my
Seco but did so what they have is they
have a data type for a year which really
only stores the year date columns in my
sequel really only store as the name
suggests the date they only store the
year the month and the day you can
specify a time and that only specifies
the time then you can combine the two to
date time which stores everything up to
seconds there's a new
but they can also specify its fractions
of seconds at least sometimes don't know
IDs I think both of them anyway time
Stannis looks exactly the same the
difference of time step is it actually
stores it takes it up you put in it
stores the data in UTC in the database
and then when you carry it returns it in
the server time zone so it has the
notion of of time zone so whatever it is
it the server to what you can't do in my
secrets you cannot define a data type
that stores the time zone separately or
I'll provide your own time zone so you
want to do that you have to get that
yourself other things my secrets it's
weird like me is not recognized it's
weird that you can specify zero as
something so 2018 February's zero zero
that's a valid date and my sequel and
the idea behind this is what if you want
to specify only to a precision of months
and you don't care about the date so we
don't know the days and you can still do
that if you don't want to do that
there's a parameter you can set you can
set no zero and date and then that
wouldn't work and in my C we can also
choose by default this is off but you
can also choose to say I want to allow
invalidates and you can also store the
forty-second or february of any year
that's my sequel and that's how much I'd
say consume when we look at like how
they store data they way of pharmacy
with us this very similar or it doesn't
have the details about oracle in a few
slides posture is very similar to my
secret i find that this is the same
thing
recent versions of hospice introduced
the precision so they allow sub-second
or milliseconds both in timestamps and
they're taken not a day to your static
and only store it's the the year the
month of the day so very similar their
Oracle is a bit different and these are
the timestamps so they've got date which
is weird in Oracle because date and
Oracle store is not only the year the
month and the day it also stores the
time after seconds and that's again goes
back to why it's hard to do equality
searches you usually search for a range
or you just truncate your date and store
midnight
0 0 it has timestamp which automatically
comes with more precision than date and
then this times a different data type
for timestamp with time zone which is
where you actually store the time zone
off a date together with the date and
then they'll say that's just saying more
specific version is the local timezone
which they just use whatever the server
times just normalize whatever I give you
to that and then there's an interval
type which is the period between or it's
just a length or yeah it's an interval
so if you look at date it's 7 by it's
always 7 by it's an Oracle I think in my
siculus of 6 well there would be time so
that's 3 bytes or day time that's 8
bytes and in my sequel Oracle stores
same thing in 7 bytes and the way they
store is is stay they store in us in the
bottom here you can see that they have
the the gear after 500 so 2011 and they
have the month 9 September they have the
day 8 and then they do the the the
minutes and seconds they do that offset
by by one so 703 is 84 and 58 is 59 I
think the reason for why they store it
that way so that they never have a zero
value in there cos 0 and Oracle's
usually associated with null and I think
that's what they didn't want to do if
you subtract to two days from each other
the difference is not an interval the
differences is a number so that's the
number of days or fraction of days
between two dates and then we get the
functions in a bit whether you be here I
created a table with a date and they're
just into assisted into it I don't
that's just showing busy she's showing
what up and the other slide that's why I
asked it in the other presentations this
is interesting so if you do if you do so
this is I did this yeah I suck so this
is this is if you if you cur your table
so this is 60 minutes past 10:00 and
it's stored as 23 17 that's the one
offset start if I write a date into a
table and then I dump it that's how it's
good so it's on disk if you just do it
from memory so I just select this estate
and I dump the cyst 8 so without storing
it to a table you can see it's not
offset so it's 20 to 16 and still 20 to
16 so that's that's a bit we
when you do this and this is the same as
we do in PL sequel that's also how the
memory is represent in PL sequel
yes that's nothing to really worry about
it's already handles it it's just
something I find with weird times them
is a different datatype it not only does
it allow you to specify a precision it's
also different even if you think of
timestamp 0 it's just times them and
have zero precision for sub seconds it's
basically the same mistake but it's not
still treated as a separate data type
and why that matters is something that
we will come back to and then depending
on how much precision you have to store
between 7 to 11 bytes and if you
subtract two time stems from each other
the result is not a number
the result is an interval type so
instead of getting one for one day you
get an interval type that's called one
day same same demo I'll just dump this
into a table it's not so interesting
local time zones always fixed at 13
bytes so if you do a time zone install
up with it you even if you specify the
position to be 0 it'll always be 13
bytes it'll always be stored in the
local time zone but it will have the
time zone attached to it I mean you
carry it it gets displayed either in the
session time zone or in the time stamp
with time zone that yes it can also
specify you wanted to be returned back
with the times and let you store it with
it all right this is this is one of the
keys of gets of the of the useful part
of the presentation is as an overview of
Oracle functions that that do things and
this is important to go back to my
earlier point so the first time to
assist state we used all the time when
we want to produce a date we use since
date and any idea what the equivalent is
that would be would you say timestamp I
heard such timestamp as it is a trick
question because it doesn't exist
sis times them always returns the
datatype
times them with timezone and and that's
that's a bit nasty and what this
actually is this it's a sports aside and
since they're actually the time at the
server so if your session is finding a
different time zone this is the the
server time if you get into the client
times I want to have the time at
whatever the client is running
the function for data is called current
date and there is a time standpoint
that's called local time stem it's not
called current time stem it's what local
times them and current timestamp is the
time several times so that's there's a
difference here and we'll get to why it
matters IV I can add and subtract
intervals two dates or integers so
numbers also work actually should say
number of integer and four times seven
times symbol time zone you can only add
and subtract intervals and that's a
trick so if you can also do get a local
time stem and just say plus one but you
can say select local time stem plus 1
from you'll the problem with that is it
will actually cast the time stem to a
date then add one and then cast the
whole thing back to a time step the
problem with that is you lose this sub
second precision so you only get seconds
because casting it to a date will lose
the the fractions of seconds for you
dates you truncate the truncate function
will remove the time and/or the date or
the month from a date so you can say I
want to normalize or truncate to stay to
the first of the month or the beginning
of the year again no such thing in time
step or time several time zone then
again if you use trunk again it gets
casted you lose the precision and that's
fine but the result what this factory
chance is always a date and that can be
a problem to create them is today two
times m2 times some time zone that's
easy and then the last thing is if you
want to this is another special
arithmetic you can do you can add months
to a date but you cannot add months to
intuit and only at intervals and there's
more trivia on that coming up later so
they I think the key point is this thing
I made here so there's no equivalent to
assist state for for time step and now
we go back to this initial problem that
I that I talked about which was this I
got an error because I carried something
that had to do with a timestamp column
so it doesn't know what the time zone
doesn't know about valid times it
doesn't know about daylight saving time
changes and it still gave me the 0 this
I was actually carrying some view and
the view definition looked like this
it said compare this column next
execution time with the system stem -
interval six hour so it's doing six
times then subtracting six hours from
and was doing it properly that's not
using the the cheap number arithmetic
you'll see actually using the proper
interval arithmetic I was doing this but
if you think about this slide two or
three slides back where I said such
timestamp returns what it returns a
timestamp with timezone so what we're
doing is we are this is what I wanted
comparing apples with oranges we're
comparing time stems like in the column
with the timestamp with timezone in the
memory and what Oracle actually does is
it can't compare these two different
data types it can't compare them as they
are they have to be casted in some in
some way and casting usually looks like
this it's usually this internal function
which is doing the casting so it's doing
some casting of this column here and
then there's this extra function called
sis extract UTC and and that's the
problem so this function sis extract UTC
says take whatever you give me which is
nucleotides them and turn that into a
UTC is basically cast it into UTC and if
the time does not specified and it
wasn't it just takes a default time zone
which is the times and associate with
the session so what it did was it took
it perfectly valid times them in a time
zone that I knew it was in but I didn't
give them a Maitre D' Oracle when I
turned into UTC to be able to compare it
to a times number time zone it just
randomly guessed that my session times
all might be correct and in my session
times on some of the dates in this table
were just invalid so I thought this was
a pretty cool probably find some other
interesting problems around dealing with
the data are um are these so adding a
month so that's this so I have the 30th
of January 2011 doesn't matter which
here and I add an interval of one month
so I said earlier for dates you can use
either interval arithmetic or the add
month function any idea what this was
returned
adding one month to the dirty earth 30
of February
well if every it's not it's not
completely wrong it's trying to get the
30 of February and then it says that's
not valid you can't do that you can't
add a month to the 30 of January this
way which sucks because what if you want
to do it what if you have a job that
needs to run a month from now or we want
to schedule something so this is
annoying we could even use this function
we can use the the ad months function to
it so ad months 30th January 2011 what'd
you do with that what return yeah same
arrow it's not a buck well it's it's
other thing yeah I guess you could call
it a buck I think Oracle will probably
call it a missing feature implementation
I think so what they did would be at
months is they actually improved it and
so ad month is a bit smarter and Edmond
says if whatever we're adding something
to is the last two or three days of a
month we will just and whatever would
return is not valid it will just set it
to the last day of the month
so ad month is safer it just puts it to
the 28th of February which is probably
what you had in mind what happens we do
this 28th February and we that's the
same thing isn't it
no its 28th of February so we had the
28th of February to to something this
would return and it's interesting with
July I actually forgot what it will do
it will just revealed in a second but
the interesting thing is I just said so
the 30th of January gets converted to
the last day of the month in February
well the 28th is actually the last day
but I think it actually gets no actually
I works so yeah so it also knows the
28th it could act one month and could
make it the 28th of March but it says
because of this logic of the 28th that's
the last day in February we'll also turn
that into the last day of March is that
better or not than getting the error
with the e at interval I don't know and
one way to get around this what beaches
at a fixed number of days but it's just
something to think about when you do
something as simple as just adding a
month two to something they can recur in
calendar things so all right so there's
a new Nexus that's that's the other
thing that goes back to me saying we we
only do range scans so I set up this
test and I had a table that I called big
table and this table I queried and I did
something but in Oregon
I see all the time this we basically
want to know what I think the big tip
was actually just a copy of DBA objects
or so and I want to know which objects
were created on this day so on the 8th
of September 2011 and what I do is I
have to truncate this because if I if I
didn't truncate this and the table would
have been created on the not 8th of
September but it not at midnight but at
10:00 a.m.
it wouldn't be 20 quality because that's
not exactly the same date so I have to
truncate whatever I have stored in the
table to midnight and then this is also
based the at midnight and then I can do
this equality thing and I get a count
and it takes seven seconds to run so
that's um it's not bad it's not good I
don't know but here's here's a different
examples the same same thing same table
and what I did here is I said query the
same column but use between to date and
it's midnight that day and midnight the
next day it's actually not exactly the
same query because this one would also
include midnight on on that date whereas
this one doesn't but the interesting
thing is I run this query which looks
pretty much the same as that query other
than that this is more company to write
and runs in 20 seconds at 20
milliseconds um so that's amazing so
that's the that's what is it 200 220 I
can't do math it's it's a lot of uh
speed up and why is it in this case and
well the title is dates and indexes so
it's because I use an index on the state
so this way we have an index on this on
this on this column called last DDL time
and that allows all record here's an
index and not coming because now I'm
checking equality or doing actually
arrange scan on this index and I'm
saying lethean X get me what you have in
there that's and that's the execution
time for the truncating case so when we
do the truncate we can't use the index
anymore because
now we're not querying the index we're
actually carrying a function or the
result of a function and that cannot use
a regular index one way to go around
this in Oracle would be you can create a
so-called function based index but you
can create an index on the result of a
function but I didn't in this case and
that means I can't use the index and now
I have to do a table full scan and that
obviously is fast so this is actually
one of the things that I find easily and
people's code is especially when they do
take math so I find a lot of times where
indexes don't get used because of this
and I guess they take away is it might
be worth to look to write to write this
somewhat lengthy or syntax rather than
doing doing the other easy thing which
is the truncating of something in the
column but that's if you have an index
you don't even have to have an index to
see the difference here so I think the
setup let's demo over for this thing is
similar to the first one but it uses
Mullenix there's no index on this this
next table that I'm showing but I'm
using same some examples so I'm starting
with this which is not using a function
so I have another big table and I said
where created between its different
column low index on it and I'm doing
this and I'm doing a full scan and the
full tail scan took me five seconds in
this case so that's good and now I do
the other curry again where I do the
truncate and I have to do a full scan
and this full scan takes 12 seconds so
that's still two times slower than that
and it only takes me I only have to
write this out once but I save twice the
time work after I runs and half the time
then listen even though the execution
plan is the same I'm doing a full scan
in both cases and it's nice animation
here the the the reason for that is that
in the in the upper case all we do is we
do a full scan and we compare the value
of the column to whatever I specify in
the second case we have to actually
apply a function to everything read from
the table so we do a full scan we read
each row we get the created tell them
and then we run the truncate function
also we have to make the function call
which
the value of the function and then
compare that to whatever we specify and
that's extra over that we do it's extra
CPU time that we burn it's not really
needing that so he wastes the time now
that this was another fun thing that's
when I was working back in Germany is
somebody actually wrote this and they
hard-coded on and in hard code but they
they they passed all of their dates they
were lazy enough they didn't actually
create dates in their application and
passed date types through JDBC they just
passed character that they created in
the application and then just wrapped
around the to date function just like I
mean I'd write my ad-hoc queries and
this worked really really well in June
it worked really well in July and would
really buy in August and work really
well in September and then it broke in
October
oops and the reason for that is that in
German October written with a k' and in
English it's written with the C and the
application was speaking the application
was speaking German and the dataverse
was speaking English so I was actually
passing 20th or first Oh Katie 22 2012
and later I said I've got no idea how
much you can we want to convert this so
if you are doing things like that if you
are being lazy and you pass characters
do not rely on whatever is this session
might be said to whatever your your your
the thing we accept you saying it so you
have to first of all specify the actual
format and then you are self to make
sure that you specify your NLS settings
to be to working so let's we just
reminder please don't do this
this might just fail I mean it's easier
if you do English and English but if you
ever have to work with people in
different languages this is something
that that happens all right so last
photo stalkus is going over it some
sometimes on things and time zones
didn't exist when we first started doing
doing time every little village had
their own clock tower and that was their
local time and they try to make it so
that every like noon was sort of when
the Sun was at the highest point and
that was fine because people didn't have
telephones people had no way of meeting
other people in different time or
different regions where the clocks might
be different but then when the u.s.
started built out the railway network
they discovered it was really really
hard to write a rail schedule or a
timetable when you have to take into
account that every station has a diff
when time that they're sort of him so
somebody decided let's create this thing
called time zones where we break the
world in distinct time zones that
initially we're planned to be off by one
hour and just break it up like that so
that we have everything in the same time
zone has the same clock and that they
don't just adjust their their noon to
whatever the Sun is and then some
country said we don't want to do this we
don't want to do the full one hour
things we want to do half hours so I
actually had a call with somebody in
Australia this morning and the central
time zone Australia's between two other
time zones and they said screw this we
actually want to be closer to Sydney so
they're like eight and a half hours
ahead of East Coast time or you're they
half an hour off anybody else so India
India also has we have position in the
world where they are sitting between two
time zones and they said let's let's not
do that let's try to avoid that let's
just do half an hour offset and just
lift somewhere in the middle where it
sort of works and they at least won't
have to worry about this whole time zone
oddness and then um and then an endless
day like saving time so um
some time ago people decided let's let's
switch or add an hour in the summer so
that we have more of our working day in
in daylight time and then switch it back
in the winter and some of the good idea
at that time and it was a really big
deal in the 70s when we thought be an
energy crisis and we thought we were
running out of oil and we thought this
could save huge amounts of energy and it
didn't nobody could actually prove that
it did but we still do this daylight
saving time thing not every country does
it and even sometimes I think there's a
counter so in Arizona that just refuses
to do this so that's gotta be fun and
some kind of stone especially the ones
that are closer to the equator where the
difference in time doesn't really matter
much and Orica tries to keep up and the
problem is that some countries just
changed when they do their thing the DST
changes an Oracle updates what they call
the time zone file you can actually
update this manually I think it's
released once or twice a year you can
download it you can replace the time
zone file in Oracle with this and Oracle
knows about these things but it's it's
not keeping up so people are changing
their time the definitions fast on
Oracle's and I
one of the applications that work with
was a global logistics application we
actually needed to know these like time
zone changes all over the world so we
had to actually get them right our own
time zone files and inject those into
Oracle because Oracle's times the
definitions were not current enough for
us that's the world that's from an
on-board magazine from from Emirates
which is way because this is a map of
the world that has to buy us the center
just looks completely not like the world
we live in
and similarly I traveled I traveled
through Egypt once and I got this funny
message on the right a few days before
my flight which was because Egypt for
the longest time did not do daylight
saving time and then with a few weeks
notice I said let's do it this year
that's just let's just do it everybody
else seems to be doing it in Europe
let's just let's just go with it let's
just do daylight saving but they're a
Muslim country they said it's really
hard to do this during Ramadan because
the Ramadan calendar doesn't do this and
basically the Ramadan day is I mean
sunrise and sunset are really important
so it's not do daylight savings so they
actually switched twice so they switched
to daylight saving then when Ramadan
started they switched back and then at
the end of Ramadan they switched to
daylight saving again and then it was
over they switched back and of course
again no IT system dealt with this and
then this is this email this message
says be aware of this if your ticket was
issued on Sunday then the new departure
date is correct if it was issued on a
different date and your departure date
is off by an hour and then think about
all the connecting flights but because
people have to connect through I was
actually connecting through Cairo and
the big destination the location of my
plane was leaving from didn't do these
shenanigans they didn't have daylight
saving so that was a big mess I missed
the flight for some fun there's a good
story to tell though and then this is
another iOS bug and then 2016 I travel
to Azerbaijan which is a beautiful
country beautiful city but Apple didn't
Apple didn't quite update their their
timezone definitions so I got to bed to
set my alarm got up but I have plenty of
time for breakfast and then when I got
down for breakfast they told me we just
closed we closed an hour ago you're on
the wrong time
and that's because they also introduced
a daylight saving time change Apple
wasn't fast enough to implement into
their phone so my fall had no idea the
the
how could I work around for this was and
I don't know how good you're with
politics but Azerbaijan is in basically
in the war with Armenia which they don't
recognize as their own country but if
you set your Apple phone to Armenian
location it would display the right
timezone but they didn't want to hear
about that very much so daylight saving
time
you are the basic thing is we skip an
hour in March that's coming up soon
that's next week after next we got the
next I think
which means there's an envelop period so
we switch from one hour to the next
which means that there is a period of
one hour that doesn't happen and there's
a difference between how the US doesn't
how Europe does it in that in Europe we
do it at the same time so the UK's which
is from 1:00 to 2:00 central yields from
2:00 to 3:00 and Eastern Europe's from
3:00 to 4:00
which means that we all do it at the
same time in the u.s. we all switch from
1 to 2 or from 2 to 3
singing from 1 to 2 but it's Pacific
time does it then an hour later central
time does it and then or East Coast
Central Pacific so that's weird and then
in October we reset the clock so we turn
the clocks back so there's a pier that
happens twice which can be really
annoying if we want to sort something by
a date and then you have the date twice
and something that actually happened
after something happens before something
and to avoid it is the second thing and
already you can say I don't want you to
be able to produce these dates and
instead this arrow and over that time it
doesn't actually produce these events
what they do in Germany is really
annoying is they actually no problem and
they switch the clocks an hour back all
the trains will stop at the next train
station and wait for an hour before they
continue so that's really annoying if
you are a train the trains perfectly
fine the train could just go but because
some other passenger might think that
well the schedule says leaving it to 30
it's gonna be 2:30 in an hour so they
can also come back an hour later but if
you on the train already it's really
annoying because then you're stuck on
the train setting your station for an
hour it's not annoying the advice for
this is if you're dealing with anything
time zone related my advice is to store
everything you can in UTC and the nice
thing what UTC is UTC does not do there
that said UTC is basically the reference
clock that we all take up time so it
doesn't do daylight savings so that
makes really easy it's also really easy
if you have I get
question a second if you have service
assistant different timezones need to
compare something to it or something
else really good if you have the same
time than everyone that should UTC yes
yes is OSS we use UTC as the reference
clock there's a difference between GMT
and UTC which is a very technical in
nature
okay so UTC does not have to do anything
with format UTC is really just a
definition of what should our reference
time be and then formatting yeah there's
also a specification of how to format
time that there's nothing to beat UTC
I'm not so sure about that I think it's
just a default and Oracle um I'll
research that ah one more minute
so explicit time so names nothing I
learned so Pacific time that works if I
specified this specific time this was
the daylight saving time change a while
ago it says doesn't work if I do it but
est it does work even though that was
when East Coast switch their time as
well so why did this not work I don't
know what things because some regions in
East Coast are still actually following
ESD so it's not taking the invalid but
if you specify a u.s. Eastern um it says
that again this is invalid because
that's when you switch time zones or DST
I explained this you can set the overlap
time to to false if you don't want your
database to create dates in this weird
time in October when we switch times
back can set specify that and I might
have to give up and not talk about the
leap seconds or maybe I should so UTC
actually has as a concept of leap
seconds so this is not something we can
could date so we actually have to
measure how fast or planet revolves
around something else in the universe
and sometimes you have to add or
subtract a second to just make clocks
fine and that's when whenever we do this
there's two dates the year when this
might happen actually this becomes a
valid time so 23 59 60 becomes a better
time or we might just skip this one
second all together the skipping hasn't
happened but this has happened a few
times and this is also bad because
Oracle
can't handle this Oracle would tell you
this this doesn't work we try to insert
this doesn't work even though this could
be perfectly valid and then what you
have to get into is you have to actually
fake your system into making it look
like it works so this would be either
the case where this NTP this is just
Linux at some time this wouldn't work
and you can set it to either say for
this one second basically just report
the same time back to the system or you
can configure NTP to just search time
packs with from 5959 it goes to 59 yeah
15 there goes the second back here so
that's that's leap seconds I think we
had one a year ago or two when it was a
bit of a deal some of our clients said
what do we do about this and we said you
have to configure NTP correct it's
nothing you can do in your database all
right
summary is we made it through 45 minutes
after lunch um my my yeah call to action
is please don't please don't store dates
in correct UTS and use the characters or
the number of things don't trust in
locales like if something like the
default representation for a date works
for you and you want to insert something
specify that same with the with the time
with the language then think about not
every one of your clients might be using
English as a language and then October
might not be your probe it might be
something else or mais written with the
I in German if you do queries avoid
functions on the column so do not write
the trunk color if you're worried about
performance because you're always have
to apply the function which means the a
you can't use an index and B you can't
or it takes more time to to calculate
avoid this implicit casting that was the
initial case was the I compare apples to
oranges I had something producer
timestamp good time zone and compare it
to a time stem and then we have two
tasks one of the other and only cast
there's always the risk of losing
something which can either lead to you
losing precision or getting into errors
time zones are incredibly complex do not
underestimate it and which is why am I
my recommendation is to always use you
to see if you can at least for storing
and processing your data if you want to
display your data it's fine to attach
the times and to translate it that's
easy enough and with that is its thank
you guys there's an email there's a
Twitter account there's a there's a blog
address and I'm doing a second
presentation to to
get Malala today together with Stuart
price on it get in version control so
you want to come to that I would highly
like to invite you and I'm gonna be
available outside this room for
questions if you have any and if there
aren't I just wanna say thank you very
much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>