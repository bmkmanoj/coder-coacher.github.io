<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Office Hours for DBA - April 2018 | Coder Coacher - Coaching Coders</title><meta content="Office Hours for DBA - April 2018 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Office Hours for DBA - April 2018</b></h2><h5 class="post__date">2018-04-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/z011NjCJp3E" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">everybody welcome along hopefully you
all can hear me and you can see me my
name is Kyle McDonald for those who
haven't been on the sessions before all
it says I can't detect sound for my
microphone can everyone hear me people
hear me that's what I'm talking the chat
line yes I can fantastic well some
people hear me crisis of Earth
zoom popped up and said no one can hear
obviously zooms not as intelligent as my
audience welcome to office hours DBA
office hours once again a fairly generic
topic we had some questions come in
during the month that's just gone past I
hope you all had a very good Easter I'm
pretty excited because tomorrow I'm are
up to Duesseldorf for apex connect first
time going to that conference and um I'm
in the Germany for about 20 years so
I'll be good to get some German beers
under my belt um in fact what's the URL
I'll say let me write it there so if
you're in Germany or anywhere in Europe
go to Apex
org there we go right that's the
conference I'm told it's an
exceptionally good conference
so are we there next week and um I will
do a video hopefully someone's just said
someone I've never been to Israel I will
get to Israel at some sites doing the
plans hopefully for the rest of the year
will be probably four or five trips to
India and then hopefully the South
American developer tour I've applied for
that submitted for that
in fact just departing off the DBA off
Versailles track critic I'd strongly
encourage anyone even if you've never
presented any kind of conference before
start submitting X abstracts you know
because you might get big for conference
if not you might get big for a smaller
user group but get into presenting
because it's a great way to research on
topics I'm loving these office hour
sessions because questions come in and
I'd love to say I just look at the
question and go oh yes I have the answer
straightaway but generally I don't they
require me to research which is like
free training free training
for me so it's pretty cool anyway let me
share my screen and show you what's come
in so there we go
that's what's come in so far and you can
add more in the chat line but I had to
make a fairly full sort of list of
questions there
um I'll explain the first one shortly
but so the questions we have Oracle my
sequel numrows regular regular extras
place that's a big one which what we'll
spend a bit of summer on because that
ones could be very critical if you're
upgrading from 11 to 12 one 502 for skip
unusable indexes what happens when an
index is poor and therefore you're doing
full table scans how to improve it and
and a couple other base I put plus admin
in there but if we don't get to that
that's just some admin on my part but if
we don't get to that that's not a big
drama so let's get rid of that one and
let's share let's get into some actual
good content so hopefully you can all
see that this is the first question that
came in I'm not even gonna try to
pronounce it but I just cut and paste
that into Google Translate and came up
and basically Google translates it my
sequel Oracle exactly how much support
so if you're on the call I hope I've
translated your question correctly and
that is how much does it cost if you
want to use Oracle support for an open
source product actors my sequel the
solution to all these things in my
starting place for all these things is
to go to shop at Oracle com it's an apex
application believe it or not so that's
another example of Apex out in the wild
and I just follow the drop-down lists
and look for my sequel and come up with
a screen effective it looks a bit like
this now there's actually a lot of stuff
there there's cluster level stuff which
is all about high availability but in
terms of just stocks down at my sequel
support you can see the prices there at
the bottom of the screen sort of between
two and six thousand dollars u.s. now I
always start with shop the oracle.com
because it gives me the list price and
in a perfect world like you know
all systems what you see on the screen
is actually what you pay but the reality
is you know in the commercial world the
market basically dictates things as does
various other things like if you go onto
our various website to buy things you
might have promotion codes you might
have gift vouchers or for example if
you've got frequent flyer miles you can
often get discounts and stuff like that
so it's a bit of a sad world we live in
but the reality is your status or your
relationship with the vendor often has
an implication on the way you press
paper also your geography does as well
plus the example is if I'm trying to buy
Apple products here in Australia the
same phone Apple phone in Australia
generally cost me a lot more than if I
actually bought it in say the US or in
Europe it's just one of those
unfortunate things where geography and
various other market forces come into
play so I always start with shopping
Arabic calm but if you're actually
trying to find out what I would call a
real price as opposed to the list price
most importantly is find your local
Oracle account office find your local
Oracle rep rep because they're going to
work with you as an Oracle customer or
an Oracle license holder to actually
hopefully get you the best relationship
and the best prices on things sometimes
you get discounts other times you might
want to bundle some products together
and get better deals etc I'm stressed
I'm by no means a sales consultant I
don't work in the sales division at all
I don't even work anywhere in the sales
organization I just have very little to
do with the sales itself but I do know
from my past experience of being an
Oracle DBA outside the organization that
you know it's all about establishing a
good relationship with an Oracle local
office to come up with the best
understanding of your licensing
requirements and needs the other thing
obviously is you know the world is
changing I put consider PAYG which in
Australia not sure if it's a universal
term we call it pay-as-you-go that is
effectively like the subscription-based
service like cloud etc that seems to be
the way of the world nowadays it looks
like people are moving away from buying
something like a support agreement
they're looking at buying things like
credits to actually subscribe to a
particular services
and obviously putting my marketing head
on you know that does not prohibit you
to bring your own licenses to Oracle
cloud etc but I suppose what I'm really
saying is is start with list prices
contact your local Oracle
representatives and consider all the
alternatives available to you to get the
best value for any kind of not just
Oracle product any product you buy you
know it's funny my recommendation is
always try pay as less as possible for a
product but make sure you pay as much as
you actually need to satisfy your
business requirements where let be
service level agreements support level
agreements excedrin
so that's what I'll say on that topic
question two
so that was we got that one hopefully
out of the way that's dollars and the
light out of the way to fairly quickly
question to why numrows equals zero in
using indexes now I should stress that
when these questions come in on the
offer sales page they're actually not as
brief as this they're nicely laid out I
just don't want to basically clog up the
screen with lots of content so it's a
bit vague in the question there but what
they really said is when I do a query to
the data dictionary I look at the
numbers column E and using indexes for a
particular index for a table it has
thousands of rows and year that says num
rows equals zero and now you know it's
just a bug is that a problem
how do I interpret it so we'll have a
look at that so let me stop the share on
this one hopefully we can see that now
this um sing out if that font is too
small we can make it larger if necessary
so let's start up for the demonstration
here as I've got a table called tea and
I'm putting I'm creating it just as a
slicked connect from jewel less than 100
so there's gonna be a hundred rows in
the table using the standard connect by
level less than 100 trick that we do for
jewel there's four columns in there W XY
and Z and if we actually look at the way
we've constructed those columns each
column is populated almost not now
send me not now etc so for example it's
and then we've added a constraint
primary key W so we know W is not null
so if I knew a slit count star from T
you can see there's a hundred rows in
them that makes sense
let's gathered some table stats and now
look at the number of rows from user
tables not user elected user tables and
as you expect we've just gathered stats
there's a hundred rows on the tables and
numbers equals 100 got to be happy with
that that makes logical sense now let's
look at the index so I've got a primary
key index on that table and the number
of rows in user indexes equates to the
same thing that would make sense as well
there's a hundred rows in the table
there's a hundred rows on the primary
key we have a hundred rows so so far
everything seems to be making a
reasonable amount of sense let's now
look at the data distribution of the
actual columns in that table the count
of rows in the table is a hundred that's
count star the count of rows of X X :
there are 70 there are actually 17 not
null values in the column called X 30
then we're left null simply by the way I
manufactured the data Y has 20 values
and it actually has no values even
though I created a column called Z
there's actually enough they're all none
in there now let's go create some
indexes on those columns so I've got a
column an index I x2 on the column
called X I've got an index I x3 on the
column called Y and I explore on the
column called Z and I've commented in
there the number of non dollars that we
had in there and here's where the
confusion often comes I'm regather in
table stats now I probably didn't need
to buy regular stuffs just to be sure if
I now look at the distribution of rows
or num rows column in the user indexes
table you can see where the confusion
can start to occur what num rows and
music indexes is effectively the number
of index entries now that's equivalent
to the number of not null columns in
sorry the number of distribution of
nochmal columns in the actual index
itself so for the primary key there's a
a value for every single row so the
index there 100 index entries and hence
num rows equals 100 for index 2 which
was the column X there are 70 not null
values so we don't actually index the 30
null values of X for a standard b-tree
index if all the entries are now we
don't actually create an index entry in
there in fact you could actually argue
that index number 2 is actually smaller
than actually the table itself because
it only holds 70 entries and not 100
index 3 similarly has 20 and index 4 you
can see this is where the confusion of
the question came in originally there
are no values for the column called said
so the index I X 4 which is on columns
it has no Rosen and the index is
effectively empty so you'll see this
from time to time not just on columns
that are all null but for example if I
add a new column so here I've added a
new column called you call it sub type
integer and obviously by default when I
add a new con there's no values in it so
I create an index on that new column
gather table steps again and now you can
see that IX 5 also has numbers equals 0
that's probably the most common time I
see it when you've added a column and
there's an index on it for example a
foreign key index etc if you have a
populate of that column yet numbers will
be equal to 0 it's unlikely that that
column will stay now lead imagine
because a column which is always full of
null values probably isn't very useful
in terms of where that numbers for you
comes from you need to also consider
when it comes to composite indexes I've
created an index here called ix6 on
columns z x and y now the way an index
works you could conceptually think about
it as the index key being the
concatenation of those three columns so
if I was to concatenate Z which is all
now X which has 70 values not now and
why we test 20 it turns out if I can
catenate of those three values I ended
up with 70 rows that were not not so you
can see therefore I x6
the second last row and the query from
using indexes it also has a number of 70
if I perhaps manufactured this data a
bit more intelligently if we had say 20
not null rows for
I and 80 not now rose 4x but there was
an overlap between those 20 and that and
the 80 we might come up with some other
number like say 95 or 92 but it is
effectively the logical concatenation of
those values do they all come out or any
of them come out as not null that would
result in an index key and as a result
you would get numbers not being 0 or
numbers in the index being equivalent to
the number of not null entries of that
concatenation so hopefully that makes
sense and it's important to realize
because that figure being different to
actually the number of rows in the table
helps you then define it helps the
optimizer define how good that index
might be for use because sometimes an
index might be very small compared to
the overall size of the table if a lot
of the values for the columns been index
are none that can make that index very
attractive when it comes to for example
if I do select count of an index column
from a table
the database might quite simply say well
why would I scan the whole table maybe
it's better just to scan the smaller
index either with a range scan or maybe
a fast full scan so knowing that an
index is actually smaller than the size
of a table is useful for the optimizer
and hence your query performance so that
was that questionnaire let's see what
next what's next the next question
regular expression replace is not
allowed in a check constraint now what
happened here is then I have a spot on
this oh let me start off with a strain
and 10 for humor regular expressions
came in an Oracle 10 and people love
them and especially if you've come from
UNIX or a scripting kind of background
we've used Perl or stuff like that
regular expressions are everywhere and
they have enormous power and for those
of us that you know have children that
watch the spider-man movies there's that
quote yo with great power comes great
responsibility
I prefer it more this way that is if
you've got a string parsing problem you
can you think about using regex and now
you have two problems because regular
expressions can be fairly complicated so
let's do a demo to see where this why
this is going to be very very important
for you if you're currently on eleven
and looking at moving to twelve let's
say someone gives you this requirement
make sure the zip code is numeric a zip
code being a column in our table and we
have to make sure it's always a numeric
now we might choose through something
like this alter table whatever my table
name is add a constraint check regular
expression replace the zip code column
any number of digits and I've left out
the third parameter of the replace
command there which means replace
effectively whatever I find with null so
what this is doing saying look along my
series of object codes here and the
reason we might choose to do this is
because the zip code might be a bar
chart for some other possible reasons
but let's say in this case with simple
requirement make sure that it's always
contains just digits so what the regular
expression is saying is saying look for
a digit that's backslash d+ means one or
more so it has to be one or more digits
and whatever I find in terms of digits
replace them with nothing so what that
means is if I present a regular
expression which contains only digits
that regular X so if I present a column
which has only digits that regular
expression will replace all the digits
with now and then by saying check that
that result is null I'm guaranteeing
that I only have digits now I run that
command and in 11g this is where you'll
see nothing spectacular it'll simply say
yep
table altered and that's what you'd
expect let's now upgrade that database
to 12c in fact when I say upgrade let's
do the exact same test on 12c I run my
command alter table add constraint check
one regular expression replace you're
going to get this you cannot add that
constraint in 12c in fact you'll get a
sort of a cryptic error message you'll
get date or system variable wrongly
specified in the check constraint now
you still have a look do you think well
there's no dates
there's no system variables
aramis is coming out now Alex let me say
in advance of the error message is
because this was a bit of an emergency
fix and I'll come back to why that was
the case but let's see what's actually
going on now when this came out everyone
just went ballistic
everyone say you know this is going to
be a bug that works in 11g doesn't work
in 12c etc in fact even I was one of
these people um this I sort of saw this
when it came on the office ask questions
I mean finally out very shortly after
they came Edison asked on question and
then I saw it on a stack overflow
question and so I love to bug inside the
organisation and someone came out to me
said no it's not a bug it's actually an
emergency fix we had to do and this was
the explanation so the bug is there it's
actually a bug in 11g we should have
never allowed disk soup that check
constraint to be added it's actually a
bug that we allow people to use regular
expressions like that in check
constraints and other places now let's
talk about this error message date or
system variable wrongly specified why is
that
aramis is coming out well you may have
seen this before if you've ever done
something like this and when we're
fairly new to the database this is a
common mistake that um that we as IT
professionals make we get taught yes we
should have lots of constraints in the
database you know make sure the data is
valid and one of the common things that
people say as well I want to make sure
that all the data comes in you know is
date stamped greater than today and so
I'm in our mind we think oh I can do
that with a check constraint I'll simply
go create table tea I've got a date
column called X and I'll be check X
greater than Cisco and straightaway you
get that exact same error message date
or system variable wrongly specified and
in that case in that particular example
it makes a lot of sense that error
message makes a lot of sense because you
can see are I'm using a date sis date
and date or system variable wrongly
specified
sis day probably matches both of those
criteria it's a date and it's a system
variable and when we get around when we
learn a bit more about constraints and
the definition of them they are they
implement a effectively a rule about the
data that is
always true and I'll put aside no
validate constraints and the like little
bit you can see why this doesn't make
sense because sis date is a constantly
moving target you know I could put a
date in there that's date marked in two
weeks time and it would validate your
would-be valet if that constraint was
allowed but of course as two weeks we've
drawn that data would actually then
become invalid because it's no longer
greater than sister it was two weeks ago
but now it's not you can't have a moving
target or effectively something that's
going to change inside the constraint
definition it just doesn't make sense
and it's sort of one of those light bulb
moments for you that we stumble upon the
Golf Course you know that never would
have worked as a constraint so how does
this relate to regular expressions well
let me say as you can see the reason
that is syste is not deterministic right
it's not something that is basically
consistent and works all the time in the
exact same way every time you call sis
day you might get a different result so
if that same error message is coming up
for the regular expression it would
suggest that the reason we're stopping
you from doing it is because regular
expressions might not be deterministic
and that leads to the question how could
that be the case like a regular
expression for a given set of inputs
must surely always return the same
output well here's the problem the
problem is we live in a big wide world
right and unfortunately regular
expressions are not deterministic once
you actually consider these on a global
scale and to best illustrate that let's
jump into sequel plus so with all due
respect to any Germans on the call but I
thought I'd use German because I'm in
Germany next week um I had to fire by
new secret bus station because I had to
set my language to utf-8 so I could just
end my dose code page to a utf-8 such
that I could actually show all the
characters we need to show so I've got a
very simple select statement then as you
can see and now for some German
complexity and their complexity BAE
there's a unlap I think is the two dots
and all that on top of the oh and you
can see the sentence comes
and now for some German complexity let's
apply a regex to that and let's this is
a fairly common regular expression you
might see we're gonna cleanse that data
we're gonna sort of normalized so what
I'm going to do is I'm going to first of
all make the sentence uppercase so we
have uppercase the sentence and once
I've done that I'm going to get rid of
anything that is not the the character
says not anything that's not a to Z that
includes spaces etc so as you can see
I've made the whole thing up the case
and all the spaces are gone
including the over the umlaut you can
see it says and now for some German
complexity no spaces etc right and that
makes sense where am I getting into the
regular expression and with the
non-determinism here well the definition
of what lies between A to Z actually
depends on where you live on the planet
so let's now do for example alter
session set my language to German so all
of a sudden I've bought again I've taken
an early flight to Dusseldorf I log on
and dusted off set my language to German
I run the exact same query the same
sentence upper case regular expression
remove everything from that's not ADA
said and look in the German language
settings the unlighted Oh sits between I
ends it so you can suddenly see that
what happens now is depending on your
session variables regular expressions
might give you different results and
therefore regular expressions are not
deterministic that's why we had to
actually lock it down in 1202 in fact it
wasn't actually something as simple as a
check constraint what happened was in
the actual original bug was someone
created the table created an index and
the index was on a regular expression
then they change their language settings
to German and or some other language and
didn't analyze index on the table so
what happened was the when you're doing
analyze indexes the index keys no longer
match the
that was actually the table simply
because I've changed my session settings
and you can imagine what a drama that
was because all of a sudden it simply
says okay your table is corrupt because
the index keys do not write the index
keys do not match the table keys and
there's all this you know hey
so we've locked them you can sort of see
what this was an emergency fix and why
we simply this throughout the
non-deterministic error message and
regular expressions but it is actually a
bug fix not actually an introduced of
the bug
what's going to be affected by this
regular expression like regular
expression replaced substring ah so
that's a typo that's regular expression
underscore count
there's no exp in there that's just a
bike that's just me cut and paste fail
but all of those regular expression
commands are no longer considered
deterministic now and that's why you get
this error yeah regular expression
replace you can see how this is all
gonna pan out whoops sorry
mostly what I press in but hopefully it
wasn't yeah I'm so yeah sorry to someone
to scam the chat line does that mean
that any regular expression is not
allowed to check constraint pretty much
you're gonna you're going to struggle
anything I don't think at the moment we
go looking inside the regular expression
stream to actually see whether what
you've done is the regular expression
itself with them for clarify as
something I think it actually says I
don't care at the moment it's a regular
expression it's not the terminus T
that's all we can guarantee I don't know
that for sure but I'm free I'm my
understanding is that's the case regular
expressions are pretty much out at the
moment I spoke to some people in the
sequel team about this what's going to
happen going forward are you probably
notice that C in some other functions
like to charge to number and stuff
there's often a third parameter or a
fourth parameter which lets you set the
nls language or some some functions
actually have an analyst
equivalent of their function I'm hoping
that that will probably be the case I've
heard no promises of that but given that
now we're releasing more more frequently
maybe that'll work
so you'll see the problem also for
example like this
if I track crime index on a regular
expression same thing because it's not a
pure function is not deterministic in
the same way that function based indexes
unlike a good so the key thing here
really I suppose take away from this is
really be careful an upgrade because in
eleven you know people have seen the
power of regular expressions they'd run
fantastic function based index check
constraints etc all that stuff might go
pear-shaped to use an Australian
expression when you go to twelve and
just be careful one thing I have not
checked I haven't had time to check
before this office hours is when you
upgrade to twelve whether we're gonna go
through and check all those existing
constraints and do something you know
mark them invalid or whatever I'm not
totally sure whether this can be allowed
to go and therefore you might be setting
yourself up with what I call a a sleeper
problem or a river time bomb where you
might change your session settings and
then they're getting things you know you
get incorrectly will be reported things
like index corruption or something like
that but we'll check constraints will
fail when you didn't expect them to but
it's just something to be aware of but
in twelve two you generally don't want
to be using regular expressions in any
kind of function based index or check
constraint X syndrome and so hopefully
that's sufficient warning don't want
anyone can take that away I have the
people who are far more linguistically
qualified than me telling me in the chat
line that all that odors does not belong
between a and Z I didn't rather software
I'm just reporting on the findings from
the database that hopefully you know you
understand as it hopefully we'll get an
analyst rate expression if it does
you've been probably looking at
somewhere in Oracle nineteen and it's
funny how those of us who are on or
eleven I still think that Oracle 19 is
like 30 billion versions away but
obviously it's about eight months away
okay so here's the next question I'm
getting an ro1 502 now what's one 502
and that is is that error that we used
to get back on or off or nine which was
you do some sort of paper table level
operation you move a table you drop a
partition etc and the index becomes
marked unusable and you can no longer
use it and you get told okay
you have to rebuild the index now in
Oracle 10 we made the default we said
that we injuries
parameter called the skip unusable index
in fact that parameter was there before
Oracle 10 but it always used to be set
to false in oral 10 we defaulted it to
true we decided it was better for you to
actually not use the index than to get
your applications crashing except now
there are some exceptions to avoiding
skip unusable indexes so let's look at
them as an example first let's go back
to this one so just to set the scene you
can see there that I might skip unusable
indexes parameter is actually set to the
default it's set to true I haven't
changed it anyway I'm gonna create a
table called tea it's got 10,000 rows in
it it's got two columns x and y just the
integers 1 through 10,000 and I'm going
to create index on T nothing complicated
there let's prove that index can
actually be used so I'll do auto trace
on and select star from T where x equals
1 2 3 and as you can see it's going to
use the index index brain scan that all
works fine that makes sense now I'm
gonna make that index unusable now I've
done it explicitly here if I had done if
this was a petition table and I'd done a
move or you know move compress excetera
the same thing would happen but I just
don't explicitly set the index to
unusable and as you can see nothing's
wrong with a select statement I can
still do a slick start from T with the
exact same query I just don't get to use
the index anymore I'm doing table access
full as opposed to using the index so
far so good
and just because the index is unusable
it doesn't stop me doing operations on
the table you can see that I can still
insert new values and that's no problems
where things get a bit complicated and
this is the case in all versions of
Oracle is when I have things like unique
indexes so I created unique unique index
um on column wireless time so every
unique index as you can see I'll turn
auto trace on the same query works this
time using common why not column X and
I'm doing an index unique scan or works
fine I'll make this index now unusable
select statements work fine as perform
but if I try do an insert statement now
into the table I get I can't use I can't
do the insert
and this is really the setting the scene
for this question this is no different
to this this is how Oracle has been
pretty much all the time with an
unusable index if it's a normal index
not unique index you can still select
from a table you can still insert update
delete in fact if I look back to my
slides I think I made a little slide on
there yeah so our normal index you can
select you can insert you can update you
can do it with a unique index you can
still select from the table as we saw it
just does a table access full or uses
some other optimization method if there
were other indexes available but you
can't do insert update and delete now
that seems to make sense to me because
how do I enforce any kind of uniqueness
if the index that is used to enforce
that rule cannot be accessed you can
make an argument that well maybe there
should be some way of deferring that but
the way you would do that is actually
create a non unique index put a unique
constraint on top of the table to
further constrain allow the inserts and
then reactivate the constraint at commit
time so that it can be done I'm just
saying that with a unique index by
default it makes sense to me if you
can't do any kind of DML because it's
impossible to validate the uniqueness of
that index but here's where things were
interesting this is why I thought I put
it in the office hours queue today it
had we're getting it on a select
statement
now I've just said that doesn't matter
if it's unique or non unique slick
statements work but they're saying they
were getting up on a select statement so
let's look at why that's the case and I
have to give a shout out here to someone
named Michael who helped me out with
this one because I couldn't think about
why that will be the case but then if I
couldn't think of why what the
resolution was but we'll come back later
but it was actually gonna and Michael
helped me out so that's a great example
of how the community helps in terms of
growing the knowledge of everyone let's
run our second demo so I've dropped the
table I'm creating it exactly as before
I've got my table called T 10,000 rows
it's got
an index I X one on the column quit X
I'm gonna make it unusable so it's just
a normal index not you can XO it's not
gonna be affected by the insert update
delete stuff and here's where the
problem comes in right hints a hint is
actually a directive to the optimizer
it's saying if you tell me to use the
index called I x1 that is my option
that's what I have to do and so this is
where you can get caught out with a hint
no I've said use the index is one it's
unusable the optimizer doesn't go our
I'll bypass that and do it to full table
scandal come up with some other
optimization method it respects your
hint directive and says yep definitely
when we use the index finds that the
index is unusable and of course then
you're in trouble
it doesn't matter even if you use what I
call the preferred or alternate syntax
for a hint and this is a bit of a sort
of a segue here in the sense of if
you're ever using hints and hopefully
it's rare this is the hint X you should
use if you were using an index hint
rather than saying hint TI x1 which says
this is the name of the index I want to
use you can actually nominate the
leading columns of the index so the
second example there says select index
on the table called tea choose the index
that starts with the column called X and
I can put multiple columns in there if I
want why do I prefer this even though it
doesn't solve this particular problem
we're having is if your DBA goes in and
renames an index then this hint becomes
immediately broken whereas this one
simply says yep if I can still find an
index that leads with an X I'm gonna be
able to use that hint and I like this
because it's probably closer to the
reality we generally don't say that
index over there is the one I wanted we
actually say I need an index on this
column that's where I want a hint at so
I always prefer that second syntax
having said all that it doesn't solve
this problem if I do a hint and they
hint on the index is unusable then
you're gonna give the error even if you
had to skip unusable the indexes equals
true what have we learned
hints are bad right even single + tell
them
directly with a little bit of prompting
from myself hints are bad generally try
avoid them if you can because you can
get into these kind of messes so how do
we fix it and this is what my friend
Mike will help me out it's really simple
from 11 T onwards if you make the index
invisible then now even if you nominate
the index with a hint
the invisible overrides that and simply
says it's not available - it's almost
like the index did not exist so in this
case you can see when I do a trace only
explain even though I've said use the
index called I X 1 we ended up with
table access full so that's pretty cool
you can see that if you have hints in
your code hopefully you don't um and you
said those index are unusable you can
end up with some grief and hopefully
using invisible indexes can help you
work around that of course while you go
back and fix the code to remove those
hints and work around the issue in what
I'll call a proper way so as I said just
a segue this is the beauty of things
that office hours
ask Tom stackoverflow the forums etc um
this was a problem where I couldn't
really get my head around a solution I
tried a few things try a research a few
people and leave me inside the
organization that was like think and
then someone from the community said
have you tried marking them invisible
and it's just one of those things where
yeah it's almost embarrassing I went
googling for invisible indexes and the
first thing I found there's a blog post
of my own talking about them but it's
amazing what you forget in terms of
tackling particular problems so yeah
shout out to Michael for his assistance
and obviously a great benefit I'm up for
showing how the community can work
together still on the topic indexes and
yeah I always get tempted sometimes and
maybe we should change this office hours
from DBA to performance tune because it
seems to be the most common thing that
we out get asked about but let us us
persist my indexes poor how to make a
full scale queries faster now just to
flesh this question out a bit more as to
how it came in I said
indexes are great when I've got a small
amount of data to query and obviously
there's
go around about what that percentage is
but let's just say I've got a nice small
selective piece of data out of a large
table and index is generally going to be
the best way to do it or there's the
exact opposite which is I've got some
stuff which means it's absolutely no one
you know no one have you know me indexes
of you so I'm you know I've got a for
example the table it only has two
distinct values and it's evenly
distributed across both and then this is
so this middle ground this list of this
sort of catch-22 we can get stuck which
is let's have a table of customer
details let's say customer transactions
so if we're given customer there's lots
and lots of rows if I'm doing we're
customer equals 123 let's say it gets
about that blue percentage of the table
I'm guessing it about 20 percent of the
number of blocks and the table need to
be accessed to get custom ID 23 how do
we solve that because we're sort of in
this awkward situation where it's too
much data to access it with an index
constant you know do an index on
customer ID scanning twenty percent of
all the blocks is probably going to be
slower than a full table scan but it's
too big for a full table scan I mean I
have to do a full table scan in this
particular case but it's a problem in
the sense that it doesn't meet my
business requirements of having you know
my careers are taking to long term um so
I'm sort of in this stuck in the
situation if someone says putting index
on it there is one already it makes it
too it makes it slower ah
we'll do a full table scan that's too
slow you know what are some of the
options that I can do to tackle these
sort of awkward boundary cases where
indexes aren't good enough full table
scans aren't good enough I thought we go
through there
let's my sequel plus window ah
fast scan fast there we go so this
will take a bit I'm creating a table now
which is ten copies of DBA objects using
select one from jewel ah and that's just
a bad query that's not going to be such
a problem um mod row num comma eight
slash tag means I'm creating a column
Tagg it's only going to have eight
distinct values 0 1 2 3 4 5 6 &amp;amp; 7 and
because I'm using mod it's gonna be
evenly distributed that's what this
career was going to show but obviously
typo in there somewhere
I mean ballot : so dbl dicks is about
80,000 rows times by 10 800,000 rows so
there were a hundred thousand rows of
each individual tag now I'm going to
create index on that column that column
called tag and I'm gonna do some queries
on now here's my first query it's like
start from T where the tag equals two
now because this data was only eight
distinct values of tag so it's about 12%
of the table those dead aliens are
scattered throughout the table Oracle
has correctly said to me you know that
UNIX is going to be useless I'm a little
table access full so the optimizer has
actually got it correct just so it's a
bit of a you know for me it might be
just too slow to actually do that so
let's give it a run see what that costs
22,000 is for that full table scan now
obviously it's nice and snappy I'm not
gonna bore you guys with 30-second
response times but you get the idea I
might be thinking twenty two thousand
dollars is a problem now I might say
well let's I've got the Knicks let's
force the index on it well it's actually
worse in fact that's why we optimizer
stayed away from it it's actually
another five thousand iOS on top of it
just to get that data so I'm sort of
stuck as I suggested in the slides a
full table scan is too slow an index
scan is worse what am i doing how am I
going to work around this so I just
thought I'd show some examples of where
you might choose to actually get some
benefits here here's my first suggestion
to you and obviously this requires the
petitioning option and that is I'm gonna
alter the table I'm gonna create I'm
gonna petition up on the tag column I'm
gonna choose 16 partitions I could
choose any power of two doesn't really
matter
I'll do it online because I have the
luxury of running 12.2 now I rerun my
query you can see I've actually kept him
out of physical i/o down dramatically
and I wanted to stress this because
people often think of partitioning as
only in regard to date based data the
archival being able to segment off data
or you know coming up with smaller
manageable size chunks but it's amazing
how there are so many uses for
partitioning just to solve actually full
table scan issues and you can think of
it I call this poor man's Exadata you
know Excel data has storage level
compression storage indexes etc you know
hash partitioning for me is what I call
poor man's excavator it's baking up a
lifestyle into lots of little small
chunks such that I can full scan those
small chunks more efficiently that's
pretty cool so if you have a
partitioning option don't just think
about it in terms of oh I only think
positioning for me is only about
historical data sometimes carving up a
big object into smaller objects can
actually be very very useful
now I've obviously bypass two important
things here number one is it's a
licensed option you gotta pay for it and
so I'd suggest this only if you already
have the partitioning option or whether
the actual benefits outweigh the actual
cost that's the same with any option in
tabs of any product you know what do you
what are you prepared to pay for it as
much as it benefits you the organization
the other problematic thing with this
approach is when you partition the table
well you've dramatically changed the
structure and in this particular case
this particular query is now a lot more
efficient that's fantastic but what have
I done to other queries what about under
the rest of the system and so you
generally need a fair bit of careful
testing to make sure that this task of
partitioning it hasn't actually cause
damage else for any applications you
know as a result you may keep the global
indexes and therefore limit that damage
but if you may move to say so locally
Nexus you've actually changed the
underlying physical design fairly
significantly and you might want to be
very aware of that let's recreate my
table now and so I may not have a
petitioning option or and I thought well
it's actually too much risk profile this
is something else which i think is
really cool so this new one which is
coming in 12-point my meat
what I think if not definitely 12.2 you
can take a table and add an attribute
called clustering and I've chosen linear
clustering here but there's also a
couple other options of no but we'll
stick with the simple one and what we're
really telling the database is that in a
perfect world we'd like all the tags
with this common value to be housed
together in the table sort of like
partitioning but without actually going
to the partitioning option now just
doing ad clustering by has no impact on
the existing data and in fact it's a
sort of like most operations in the
database like compression and the like
it only applies to direct operations but
with 12.2 where you can do so much stuff
online the thing I like about this is
here's my table tags are scattered all
over the place I add clustering by
linear data I can move them online you
know take a quiet period move it online
I haven't interrupted the service in any
way shape or form
all my indexes stay up there this will
regather some stats just as my mummys
dead stop growing now let's see I'm
forced to full hint here on my tag
equals to it's still at 22,000 is now
are using the index hint and it stopped
from being far worse than a full scan to
actually being significantly better than
a full scale now I haven't actually
changed the index the benefit of God is
is that an index key on the tag now when
it points to a particular block in the
database lots of other entries for the
same tag are going to be co-located in
that block because I've plastered the
data that's what that auto and
clustering is done it's effectively like
reloading the data in a nice sort of
order without ever taking it offline
from anyone so this is another option in
terms of I had an index that was too
slow so I had to use full table scan
well if I can make the index better by
shifting the data then maybe using the
index becomes more attractive again so
there's another example of how you can
make what I'll call a full table scan in
this case flip over to an index scan but
actually get a benefit as opposed to
making things worse and just to prove
that it wasn't me forcing the hint in
there if I actually run it with that
you can see that Oracle chose to use the
index scan so partitioning is a good
option if you're licensed for it but if
not look at these twelve features for
shuffling your data around in an online
fashion to get benefit for queries later
on and I think that's probably a vastly
underused facility now you might be
thinking I'm stuck on eleven point two
or 12:1 and I can't do these online
operations you can do similar things
using DBMS redefinition you can add the
clustering attribute but if you look at
the DBMS redefinition API there's
actually a sorting clause but they
demonstrate a difference so you can
actually reload data in a sorted fashion
to get to similar benefits okay this one
came in notify another application about
some changes okay this is like a
minefield this is yeah and don't you
wear on this is our own follows Oracle
because over the years we've invented
10,000 ways of doing notifying
applications or tracking changes so what
I'll do is let me switch to camera so I
don't believe in all this junk out the
way let me fly through some of the
examples I got to keep it all the time
as well on a time so here's how that
abase hopefully you can see and
understand my terrible writing and
here's a really locks so we're gonna do
in a nutshell here what are your options
I'll switch to a fresh color anyone
laughing on the chat line at my writing
abilities will be kicked off the call
mom are there okay so here that some of
the options that you can consider the
most simple one is using triggers
triggers sit in your database and it's
fairly simple right you catch the data
as it comes in my trigger you write it
up to a table now the most common use
for is for example auditing information
as in terms of and and the reason I'm
covering a few options here is the
question wasn't really clear on whether
they want to grab it and then send it on
words or will they want to capture an
order trail or the like but I will flip
over I'll flick through a whole stack of
them so triggers are really good for
capturing audit information I made a
change
grab a couple of things you don't want
to be doing is don't be doing
non-transactional suffering triggers
like with prana muscle sending emails or
writing to files because triggers can
actually fire multiple times they even a
single operation just because of the way
I work so you can get dodgy results as a
result so inserting into other tables
and the like triggers are fine
I've draw them up here because they
obviously have an impact on your
production system you know if you
actually have them on your production
system the triggers actually add
overhead to DML on your production
system that might be an issue um so what
people sometimes do is they'll do
something like okay they'll say well
let's do materialized view logs now
they're more efficient than triggers
because there's no actual actual trigger
on the table it's actually managing term
internally you create a materialized
view on the table and it automatically
captures all the track the changes and
then you can use that materialized view
log to actually then derive the changed
rows and send them off somewhere else
having said that please do not ever do
that
I've seen this implement in so many
places and it's just a disaster and not
a disaster that's happened now it's a
disaster waiting to happen
customers have no control over what's in
materialized view log we build them to
satisfy our needs for replication so a
materialized view using materialized
view logs is totally fine why should we
be brought out there shooting this
materialized views fine because the
technology for materialized view is
bound to materialized view logs but what
I'm seeing more and more as people
saying well materialized view locks
capture the ladder I need anyway and
then I'll simply use that to write some
queries and then trunk of the
materialized view log the reason that is
so incredibly fraught with risk is what
happens in 18.3 when we change the
structure from two eyes view log we
might put in ten rows for every row
change we might put in no row change we
might bring in just an SCN number
there's we could do whatever we want
because they're internal tables so
we realize V logs plus materialized
views that's a valid scenario but please
don't just capture data in materialized
view logs and say that's good enough for
me other things you can do at the
database you can use triggers and you
can those triggers to simply rather than
catch the data itself you can actually
love them into an advanced cube queueing
is very very scalable you can scale it
to very good limits and the reason that
a queue is very useful is because you
have those queue semantics it can be an
ordered facility so as you then pick
data off you can actually pick it off in
order of it occurs and then send it out
to external systems so a queue coming
from triggers is another option what
else we got once you got a key you can
consider how let's go from either using
things like m GW
that's the messaging gateway inside of
Oracle once again just part of the
product what that does is you can
effectively map an external messaging
system like for example WebSphere or JMS
etc with a Q such that in the database
you simply stick things in a queue and a
demon in the background takes things out
of the advanced cube sticks them into a
third party messaging queue which might
then sent off to other places as well so
in terms of notifying applications or
other parts of your enterprise messaging
gateway coming from a queue
also works very very well as well what
else we got
ok so let's get down away from the
database now let's say all these things
are too expensive on the database how do
we now do it for example not in the
database so let's go down to our reader
you might be thinking you might be
familiar with terms like streams and
something the spool on top of strangers
a thing called change data capture these
are very popular technologies that have
been used for many many years
and sadly I no longer support of inside
Oracle from 12 point to I think onwards
there D supported and certainly
deprecated from earlier versions so if
you're using streams are using CDC
you're going to need to move away but I
put these in there because there's still
heaps of information out there about
them there's heaps of blog posts and
stuff so it's very easily
upstreams I'll use that and be aware
that you're setting yourself up for a
problem in the future
all these things have obviously been
replaced with a technology called golden
gates and obviously the advance of all
these things is what they do is they
mine the really locks there for your
application up here is all your database
performance is almost unimpacted right
it's done reader logged mining and
that's obviously why Golden Gate is
generally the preferred option as
opposed to some of these it's incredibly
efficient also though it comes with some
restrictions there are some things that
you can't do in any kind of log mining
facility answer the in terms of data
types and stuff like that so once again
read the documentation carefully but
Golden Gate is generally a preferred
solution um this one obvious problem
with Golden Gate
it's separately licensed you have to pay
for it now once again you know I don't
want to sit there and say you should buy
torsion balance InDesign does the
investment just to fire the benefit if
it does go ahead but if it doesn't look
at other options
there's third-party options is a company
called DB visit there's some guys just
across the water in New Zealand they
write a bespoke really tracking system
as well so there's those I haven't been
finished yet sort of sitting somewhere
in the middle here now other options
there's one called
flashback say that archive what that is
is a background process I don't know
what it's called now but it I'll just
call a background process might be
coming up with this if RA I think maybe
background process and you can simply
say I want to do a flashback data
archive on a table in here and
asynchronously we track all the changes
that have ever happened into a separate
set of tables so it's like an audit
trail without having to use triggers you
could use flashback data archive as a
means of capturing all the changes and
if necessary then reading from that to
maybe send to other applications there's
another one which is called asynchronous
callback
and really that's just an automated
version of using something similar to
what we've got up here with triggers and
cues but once again it's asynchronous
you are so effectively associate entries
I think with the table and when you do
easy a DML on that table effectively the
system internally puts an entry in the
queue a database job is kicked off to
process entries in that cube and that
database job then calls a routine of
your deciding so you could say whenever
a row gets inserted a table X that
automatically gets put into a queue a
background job reads that queue and
calls proceed your wife and that
procedures is something you like
yourself so that's asynchronous callback
that's generally good for low scale
things like if you're adding tens of
thousands of rows to a table you don't
want to be creating tens of thousands of
background jobs and to messages but for
example something that says from time to
time entries coming to a table I need to
be told about it I think this callback
is one option for things like in the
third in the middle tier Spacek feedback
for example java.net etc there's other
things there's one called
object change notification and that
simply says whenever you change an
object it actually sends a message
asynchronously to a diamond waiting on
that message and it's a non-locking call
so you can have an application reaches
in.net for example running away and
it'll be simply sent a message saying by
the way you actually have to react to
this message that's been improved from
eleven point to one words into a thing
called continuous query notification and
what Katinas qui notification is there's
just an enhancement of that rather than
saying I'm interested in a particular
object changing which obviously might
change lots of times of stuff that
you're not interested in continuous
query a notification simply says I need
to be notified only if the results of a
particular query would have changed as a
result of all these changes in various
tables etc so now that is a lot of
options you have a lot of stuff there
you can work with I'm hoping to answer
your question I could spend all day
talking about each one of them but
hopefully that's enough information that
you can you can look at the video
afterwards to get those acronyms in the
again to actually get an idea for that's
4:30 to get an idea for what best suits
you and which of those technologies you
should see a clear because it is
supported and which of the technologies
were best suited for your particular use
case it's 4:30 I think we'll wrap it up
I'll say I'll save those questions for
next month he says optimistically
knowing full well there'll be a whole
bunch of other things coming in again as
well and I'll be in trouble but knots
were um the last little bit of admin I
will share which I wanted to get in
before we finished was I've had some
feedback offline people say that this is
not a great time to be running a session
in terms they prefer to a couple hours
later um so if you have any thoughts on
that can you I'll leave the chat line
open for a few minutes you can just sign
the chat line if you're happy with now
or you prefer a couple hours later or
other particular time I just saw in the
chat line um I'm generally fairly
flexible on that unless it's in the
middle unlike for me
um yeah that's just my thoughts thank
you very much for attending will
obviously be recording this and carving
them up into videos that you can watch
again at your leisure so that's my blog
Connor - McDonald comm this will go on
to my YouTube channel but also I have a
lot of other YouTube videos as well and
continue to putting out as many as I can
that's my Twitter handle please follow
me as I said throw on the chat line in
the commenting about what time is the
best run this office hours but other
than that I'll leave us up for a few
minutes and thank you very much for
attending everyone we'll see you all
again in a month's time I am off to
Germany
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>