<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Refactoring to Functional Style with Java 8 | Coder Coacher - Coaching Coders</title><meta content="Refactoring to Functional Style with Java 8 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Refactoring to Functional Style with Java 8</b></h2><h5 class="post__date">2016-09-20</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/wjF1WqGhoQI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right welcome to the session on
refactoring to functional style using
Java 8 my name is Venkat Subramanyam I
want to spend just a few minutes talking
about functional style in general and
then we'll jump into some a few examples
maybe five or six examples where it will
take a piece of code that looks very
familiar to us in the style we know and
then refactor it to more of a functional
style of programming best time to ask
questions or make comments is when you
have it so please do raise your hand
draw my attention and ask the questions
I'll be more than happy to respond to
your questions or comments whatever you
have so let's get started well one of
the really interesting things about java
8 is that java 8 predominantly probably
one of the most significant changes in
the java platform is that it provides a
functional style of programming so what
does it really mean to programming
functional style well the very first
thing is we get used to higher order
functions so higher order functions are
well we are used to passing objects to
functions we are used to returning
objects from functions very also used to
creating objects within functions well
we can do very similar things with
functions as well we can pass a function
to a function we can return a function
from the function we can also create
functions within functions as well and
so these make it higher-order functions
so rather than just doing object
composition we can also do function
composition as well when it comes to
using these one of the key things about
functional programming is it greatly
favors immutability they don't want to
be want us to be changing state of
objects so rather than changing the
state of objects we don't what is called
state transformation or rather than
state mutation so in a way a lot like
for example if I give you a $10 bill and
ask you to break the bill I'll be really
offended if you take the bill and break
it so instead I would expect you to take
the bill away and then return maybe you
know to a lower denominations a
combination of them so it's a
transformation rather than a mutation
that you really are looking for but one
of the key things about functional
programming is functional programming is
packed with decorators style of
programming we are used to imperative
style of programming in Java or a lot of
languages so far in an imperative style
of programming we do two things
we
tell what to do and we also tell how to
do it in a function in a declarative
style of programming we focus more on
telling what to do and we like the
underlying libraries figure out how to
do it that's one of the biggest benefits
we get out of declarative style is we
can focus on the problem and not get
really dragged down into the details and
let libraries of code deal with it well
to use higher-order functions we're
gonna be using lambda expressions lambda
expressions are just anonymous functions
that we can pass around so it turns out
functions have four things in them the
functions have a name they have a return
type they have a body and then a
parameter list of the four things we
only care about two things we don't care
about the name of the function we don't
care about the return type because that
can be inferred based on the context so
what really comes to is we want to know
what the body of the function is the
most critical part and we also want to
know what the parameters are what are we
working with so that's basically what
lambda expressions are anonymous
functions and we also have streams
streams are the most charming
capabilities in Java in Java 8 because
streams provide us dataflow computing we
can take a stream or a data flow of
objects or data and then we can
transform through those very effectively
but of course it is no fun to be
creating a collection from a collection
to a collection to a collection because
that would end up with garbage
collection and that's not going to be
really a fun at all so as a result to
deal with it properly we want a very
very smart manipulation of the data to
these transformation and strange
wouldn't be fun at all to use without
lazy evaluation which is one of the core
features of functional programming in
functional programming we do what is
called lazy evaluation we with lazy
evaluation we get three things in our
hand we can postpone things until the
point where we never have to really do
it and we can also postpone it long
enough to do minimally that we have to
do so we get to choose when to execute
or we can execute it right now if you
want to that's one of the beauties of
lazy evaluation enough talking let's get
down to some problem-solving so I want
to take about six problems if time
permitting
and see how it feels to code in a
functional style compared to more of a
imperative style that we are all used to
so let's talk about imperative style
versus functional style just for a
minute and then we will look at how it
defers well in an imperative style of
programming we are going to tell what to
do but we also tell how to do it in a
declarative style we focus on what and
we like the underlying libraries do the
how so this minimizes the amount of code
we have to write but it's not just the
minimizing of the code it becomes a very
effective way to communicate and one of
the things we do with the computer all
the time is we communicate with it
my son was learning to program and it
was fascinating for me to watch him go
through the programming and and there
are certain phrases that he used that
were golden in my opinion one day he
said computers are so stupid you have to
tell them everything why can't they just
figure out what I mean I'm like welcome
to the club son right and and that is
something you have to keep in mind the
other thing that he said the most
valuable was he said now I know why that
needs a steady stream of junk food when
he is coding so that was a very proud
moment right oh I have to keep eating
when I'm coding because it's not
frustrating sometimes so and when you
have to talk to the code well the point
really is we have to deal with all of
that but what are the things that come
out of this kind of coding is well guess
what let's talk about it after we look
at the code so let's switch over here to
the code and look at the code and this
is something we all are familiar with so
so in this case if you look at the maned
right here I'm looping through 1 through
8 or 1 through 7 rather well right there
I had to really think about whether it's
7 or 8 and then going through it I'm
going to print out whether that number
is prime or not of course we don't want
to touch a piece of code until we make
sure it's working before we refactor it
so I run the code it tells me 1 is not a
prime but 2 and 3 R 4 is not a prime 5
years and 6 is not 7's ok that's a good
start
we could have written automated tests
but this is good enough for our purpose
right now so how do we go about you know
working with this code let's look at
this code real quick
to see what this code is actually doing
well here is the function called East
Prime that is the only good news in this
code the function name tells you that it
is trying right and then it's downhill
after that well the next line what do
you see
it's called divisible why do you call it
you call it flag now anybody here raise
your hand if you like flags
not a single person right we all hate
flags that's why we call it temp because
we tell it you don't deserve to be here
right so that's we don't give good names
right we give horrible names to it
because we don't like it so we create a
temporary variable a flag are called
divisible then what are we doing we take
the I equal 2 to 1 value then we say I
less than number then we say I plus plus
I'm gonna say this is one of the most
complex chord we're going to write you
say wait a minute
complex you meant we do this all the
time well we often get confused between
two words and it's very important for us
to keep these two words separate the
word familiar versus the word simple the
word familiar simply says I've seen it
so many times I don't want to see it
again
that's what familiar means right kind of
like the in loss right very familiar
with them but doesn't mean anyone hang
out with them well on the other hand
simple means that it is less noisy it's
less troubling it's less error-prone and
this code is very familiar and yet very
complex what we want to do is we want to
start using something very unfamiliar to
all of us we have not done this but we
can't even judge whether something is
simple or complex until we take the time
to get familiar with it and that is one
of the biggest impediments we are facing
today is that we are so familiar with
the imperative style we are in the
confirmed zone and when people say that
functional style code is complex they're
using a wrong word what they are saying
is it's unfamiliar and we have to really
share that and using these terms really
makes us feel better because now we know
the problem is not complexity maybe not
but it's a familiarity
we can become familiar with it well then
we say if I is divisible by if number is
divisible by then we painstakingly said
this flag and then we break out of it
how do you feel when you write code like
this
not very well isn't it now this code
feels like you're talking to a toddler
now what do you do when you talk to a
toddler you tell the toddler sweetie
don't walk like that look where you're
going hold the glass with both hands
don't step on the cat's tail you have to
say every single thing and I would give
it to you the first thing you talk to a
toddler it is wonderful I'm sure you
went to a friend or tweeted about and
said this was awesome this toddler is so
cool and then you realize the next day
you got to do the same thing again and
then you realize this is going to
continue for the next 18 years right
that's called parenting well that's how
this court feels right you got to sit
there and tell it every single detail
and that just burdens us and when you
are to me programming is a series of
light bulb moments I think of something
I want to crank it code and see how it
works and the minute you come to this
code yet another for loop you're like
nevermind I want to go home now right so
it becomes really tiring well let's see
how we can do this a little differently
so what I want to do is to refactor this
to functional style so to understand
that I'm gonna just comment this code
out and then we will see we can rewrite
this the very first thing I'm gonna do
here is I'm gonna import Java dot util
dot stream dart into stream because I'm
gonna make use of in stream to begin
with
well now that I've broadened the into
stream I'm gonna say in stream dart
range from the value one well notice in
this case it goes from 2 to 1 less than
the number so I'm going to say 2 to the
number so this is going to be the range
function
stop right there let's talk about this
for a minute now what we have been doing
for oh I'll give you this is a little
challenge for you when you go back this
evening
do a quick grep on the word for in your
code base and tell me how many four
loops you have it's insane
isn't it you every corner you turn
there's a for-loop well this is kind of
like you hear a knock on the door you
open the door and there's a guy standing
with the hammer and he look at this guy
and say who are you he says well I got a
call that you guys have a problem in the
kitchen I'm here to fix it and you say
don't have any tools he says oh I don't
need any stinking tools I got a hammer
and takes a whack at it you'll probably
go to let the person in and go out and
call the cops right because this is the
four hammer and we use the four hammer
everywhere you see but on the other hand
a pleasant experience is you hear a
knock on the door you open the door and
there is a person with a little bag says
I'm here to fix your kitchen walks into
the kitchen puts the bag down and you
can see tools in the bag you say hey
that's interesting you got tools
oh yeah that's a chisel that the
screwdriver that's arranged that's this
okay that's all nice Wow different tools
and maybe a little hammer too and then
you ask the person are you gonna use all
these tools and the person says of
course I'm not gonna use all these tools
because a person uses all the tools is
called a consultant well I'm gonna only
use the tools that actually make sense
right so you decide to pick and choose
maybe a chisel right now maybe ten
minutes later for a different problem
maybe we'll use a wrench but the point
is we do use different tools so we're
gonna use different tools to navigate to
look through the collection in this code
so what are we gonna do now I'm gonna
say given a range I'm gonna say none
match and in this case given an index
number mod AI is equal to zero and I've
asked it to tell me none match and
return number is greater than one and
and of course I want you to tell me that
none of them is matching through that so
what we just did is we took all that
function away and we wrote it in a much
much simpler not just elegant
not just concise it is more expressive
as you can see so the code that worked
before is still working but we ended up
actually writing a lot more effective
code in terms of communicating so we got
rid of quite a few things let's compare
the two pieces of code that we have in
front of us let's look at the imperative
style code we wrote there
in Paris style code I said ease feels
like talking to a toddler
well the functional style code feels
like you're talking to an adult or a
responsible adult you simply ask for
what you want and you get it that's one
of the biggest benefits you get out of
it so you can see how we went from
having to set the garbage variable
that's exactly the name we give for it's
a garbage variable which we would rather
not have and then we loop through the
functions to process it versus here we
don't have any garbage variable on our
hand we were much more fluent in what we
are our intention was easier to
communicate as you can see right here so
switching over what did we achieve first
is the code is less noisy we're not
writing a lot of code to get our work
done that's one of the biggest benefits
sure we had to become familiar with the
few things we got to take the time to
learn there in streams and other types
of things that are in Java we have to
take the time to learn about these new
functions that are available like none
match but these are very effective in
telling what to do rather than sitting
there and going through if you want to
relate to this a little bit differently
if you will if I give you a database and
I ask you to get a group of data you
would never go to the database and go
through one row at a time to look for
the data you would issue a select query
on the database well that's kind of what
we're doing a select query is a
declarative way to access and get the
data from a database here we are being
very declarative about data in a
collection so that's the transition we
do in how we access it there are no
garbage variables in our code
things like divisible and stuff like
that we got rid of that very effectively
we are using higher-order function
where's the higher-order function well
if you notice in this example now the
range functions are either non match
function is taking a lambda expression
we are passing a function which is this
anonymous function the lambda expression
to the none match function so the none
match function is the higher-order
function in this example so we are using
our order function to do the job rather
than imperatively looping through and
getting
the work done that's one of the biggest
benefits we saw in how we wrote this
code right here
so that's one first example of
refactoring to more of a declarative
style and mixing functional style into
it so just to kind of see how this works
together we have a functional style but
a functional style is also declarative
in nature and that is one of the biggest
benefits we see here is we are enjoying
the declarative style of programming
along with functional style it kind of
becomes part and parcel with it that's
the benefit you see here
well let's we want to look at one other
example I want to write a little program
that's going to count the number of
lines I have a word appearing in a file
we'll take it from the imperative to the
functional style again and see how that
looks like so here is the code I have
right here I have a main function as you
can see well within the main I've said
the search word is localhost and the
path I want to search is etc hosts and
then I said this garbage variable as you
can see so long the count equal to zero
and then we do a bufferedreader anybody
loves doing this right this is this is
when your heart sinks right there's the
lowest point of coding or not this
bufferedreader again so we could be open
the bufferedreader and new
bufferedreader new file reader and then
like I'm gonna get a cup of coffee I
just don't want to do this anymore right
and then if you thought that was worse
more is coming so then you have a string
line equals now right at this point
you're like why am I even here right
that's how it begins to feel and then
what do you do you say while line is
equal to bufferedreader dot I mean look
at that line right you would never show
this in public right you would never
invite somebody to say hey is
programming cool and you show them that
code right and they are like really so
this are the lowest point program is
mostly cool but don't look at this stuff
right so this is saying read the barrier
of value from read line set into line
then check if it is null well this is
called primitive obsession we
to do everything at the lowest level we
can have confidence in our libraries to
do the job so again talking to the
toddler kind of a mode then we say if
the line that contains that then
increase the count and then of course we
come back and celebrate eventually okay
here's the output we are done with this
thank goodness so it even causes allergy
somebody sneezes already you can see
that so that is an example of how we are
writing this code it is not really fun
so what can we do well let's first good
news though as it works to some
definition of works so the word
localhost occurred three times or at
least on three lines okay but how can I
write this in a better way let's see if
we can change this around so that we
don't have to struggle so hard so I'm
gonna say import Java dot n io Dart you
know file dot star so I'm bringing in a
package right now into the mix so now
let's look at this code right here the
pen the problem is in this area where we
are getting the count
so we'll comment that out so we can
compare what we are doing to what what
was there before so what am I gonna do
now well the very first thing I'm gonna
do is I'm gonna say over here
well app adds dart get and then I'm
gonna provide the path to it so this is
going to give us the path given here I'm
gonna get the Pats dot get and get the
path from it okay that's great what are
we going to do next I'm gonna say file
start lines and I'm gonna ask it to get
me the lines from the file at this point
we'll come back to that in just a minute
so notice that line of code for a minute
in one shot you said I want lines now
this is one of the things I really
appreciated in Java 8 they didn't
implement lambda and then throw it
across the fence and say good luck guys
and walk away you know I'll be honest
about it I was I didn't care about Java
8 and I was like yeah what's a big deal
Java is gonna have lambdas why do I care
and I remember clearly kind of poking
around Java 8 you know okay there's
lambda ok there's method reference tell
me something new and then I hit the
stream and the minute I saw the stream I
immediately said I gotta write a book on
this stuff because
this is just amazing stuff if Java has
this this is worth doing and that's how
a compelling stream was to me because if
you can work with the stream you got the
full boatload of functional style in
your hand lays evaluation on your hand
well what does lines do lines are
remarkably gives you a stream and and it
says here you go I'm gonna read the data
from the file and stream to you and you
can sit back and relax and handle it you
don't have to work so hard
using the imperative style and to me
that is a game-changer right so files
start lines and I've got it okay great
but what's the next thing I want to do
dart filter well I don't want all your
lines please given a line I want to know
that line dart contains and I'm gonna
ask for the search word well that's
exactly what we did on line number 17
but we are doing that here using the
filter so imagine this you got all these
things coming at you you put a filter
and things get blocked and only a few
things kind of pass through so you got
things coming through and other things
being blocked right there so now you
have a filtered stream in front of you
okay that is great now what do I want to
do dot count I just tell me what the
number of lines are and I'll be done
with it so now you can simply say in
this case long the count is equal to and
give me that data and be done with it
so we took this long count but rather
than having to sit there and keep
incrementing it as a garbage variable we
simply were able to turn it around and
use it so now let's go back and run this
code and see that you can see that it
produces the output right there but all
the junk that we saw in front of us is
gone and now we have a much smaller
piece of code in front of us but much
easier to read easier to understand if
you look at the top code here's a
challenge I normally post to people you
take this piece of code and you show it
to somebody but the fun is to be in
front of them and watch their eyeball it
goes like this right you got to go up
and down through the loop and then
eventually it comes to this point that's
called the point of confusion right like
what
looking at well if you look at the code
in the bottom it is a single pass
through you're saying file its lines
from that path ot got all the lines from
the file next give me only those lines
that contain their search
all right cool what's the next thing
count it so you can see how easy it is
to follow once we get through the
unfamiliarity it becomes highly
expressive and so the single pass
through evaluation for our human brain
is one thing I really appreciate a lot
because this gives me an ability to just
understand the code very quickly without
having to be dragged into the details
that I don't really care about because
those are just the tactics this is
giving me the overall idea of what I'm
actually doing that's very very
beneficial as you can see so what would
we achieve in this example well there is
no explicit mutability in the score
we're not sitting there an incrementing
account variable over and over in this
code and we use to stream and we use the
filter to evaluate it so to be able to
take a file and to be able to process
that file as you can see as a stream
really gives us a power to really take
the data and do transformation on the
data without having to sit there and do
two state transformation that is very
beneficial as you can see so given that
let's move on a little further to see
what we can do well what did we do so
far we used an inter stream so we have
to explore and figure out a few library
of functions available then we also
looked at how to use a stream and filter
to perform transformation of the data
and then again we had to figure out that
oh given a file I can actually get a
stream and that is one of the nice
things is there are a lot of file based
api's that are returning stream and we
can benefit from them so that's one of
the challenges I would pose is when you
go back to look at the Java API keep an
eye out for where things are returning
stream as an example even the random
class returns a stream of random numbers
now for example so you can start dealing
with the random numbers very differently
today using streams then we once used to
so a lot of charming things around we
can make use of well let's move on a
little further
in the next example I want to again
remove the verbosity and go towards more
concise and a little bit more flexible
so let's look at what this example does
for us well in this case I have a main
function as you can see and the main has
a scores hashmap and I filled this hash
map with a bunch of names or strings and
along with this course and I want to be
able to take this and I want to group by
scores so in other words I want to get
Jack standing alone but I want Jill and
Darla and Nick to be in one group and I
want Tom and Nancy to be in another
group because they all share the same
score so I want to do the grouping based
on these numbers these course so what
does the code look like to do this well
let's look at this code for a second the
first thing we're doing here is well
let's actually run this before we do
anything so when we run it you can see
11 is Tom and Nancy 12 is Jack and then
you have 15 darlin you can Jill okay
so if you look at this code what are we
first doing we first create an empty by
score map it's a map of integer and a
list of strengths then the next thing is
we start looping through the key set one
at a time and we say give me a scores
key set give me one set key at a time
then we say hey scores get me the score
for that person but that string and then
comes the charming part we create an
empty list first of all then we say hey
is the score it already in the map if it
is already in the map if it if it
contains it we go get that particular
list and then we add to the list if it
is not in this we then add to the empty
list and then when we are done we put it
back now if you look at this this is
very highly imperative anybody here who
enjoys writing this code
not a single person this is why we hire
interns right so we tell them you're
gonna do it and they're so happy they're
like this is awesome you're like oh yeah
yeah right and we know right until
graduate him figure out darn it you guys
gave it to me because you don't want to
do it right I've been through the
channel right the first time I god I was
so excited only two years later I
realize they gave it to me because not
because I was good it's because nobody
else wanted to do it right so this is
what we do we kind of push those jobs
away we don't want to do it well it
doesn't have to be this noisy it doesn't
have to be this low-level after all we
can do a lot better than this so what
can we do in this particular case let's
give it a try let's go ahead and we're
returning this collection in the end so
we can remove all of that for a minute
and then let's start with the return to
begin with so what are we going to
return well first of all what is our
input what our input is the scores after
all and then we are calling the get key
set so this part is actually useful so
we'll grab that part for a second so
scores start key set and then we will
say over here our dart stream and now we
are in this beautiful world of
functional transformation so we go from
the old collection and data structure to
a stream stream is not a collection
stream as an abstraction and it gives us
a view of the data as it gets
transformed to the collection so we got
a stream on our hand
well great what do we want to do next
well in this case I want to group them
so I'll say dot collect and then I would
say grouping by and where is the
grouping by coming from well we are
going to go ahead and do a static import
and this is going to be a Java dot util
dot streamed art collectors dot and
that's where the grouping bhai is coming
from so now that we have the grouping by
on our hand we can ask it to again think
of the declaration Eicher you're telling
it what to do rather than doing it
yourself right so as a result what am I
going to do here I'm gonna say grouping
by well you know what you want to group
by you want to group by scores and this
is going to be on the based on them on
the value of the scores so that's going
to be on the get after all so you can
see how very concise
the code is compared to what we started
out obviously in this case we got to
know a lot more to do this but you know
more so you can do less how does that
work right so that is the beauty of this
right so by knowing more you're doing
less and as a result you're being more
effective and after all that is what our
goal is is to become more knowledgeable
so we can get stuff done with much less
effort and it goes line in in with that
so what we did here was just a very
charming collect dart grouping by and
and that is one of the beautiful things
we have to start identifying the
functional style our to this code you
know and be willing to spend the time
for it personally I grew up programming
in the imperative style that tells you
had a terrible childhood right so I grew
up programming an imperative style and I
would tell for myself I'm about a 50%
level right now so if you give me a
problem 50% of the time I can quickly
show you how to do it in functional
style the other 50%
I got a struggle with it I was on a
cross Atlantic flight it was a nine-hour
flight and I'm so glad I had nine hours
I took one problem it took me a solid
seven hours to refactor the code from
imperative style to functional style at
the end of seven hours followed by why
did he not see it before right so the
hindsight is always 20/20 but it took me
that seven hours and I then stared down
and thought about wow what a mental
block I had not being able to see it and
I had to take piecewise ins keep
refactoring and then in the end I was
like oh my gosh why did I do all of this
and then throw it out and three lines
later the solution is in front of me but
I think that notion is very important
right to be able to go through that is
important because the more we do it the
more we are able to think in functional
style and code and functional style and
not only can we refactor code from
impaired style functional style but
start writing in in functional style as
well along the way so what we saw in
this example was we took this imperative
style code where we are getting the key
set and then checking if that exists the
key exists in the collection already if
not you know go ahead and create a new
one otherwise go ahead and insert into
an existing one and then putting the
collection back a lot of work we are
saying no no you go ahead and do it for
me I don't have to spend the time and
effort doing it and so in this case we
are simply saying hey put this back into
a collection for me a grouping by but
the power of grouping by is you can do a
lot more with this you cannot not only
do a grouping by you can transform while
you're grouping as well so you got a lot
of power on your hand as to how you can
go about doing this so that is one of
the things so it's very highly
expressive we are using the declaration
style and we did use some specialized
functions here though the only
specialized function we used is of
course the collects grouping by in this
case but the grouping by function you
notice we nicely passed a method
reference to say that I want you to grew
by the content of the get function so
that's the value that we're gonna get
from the score so we are able to just
specify that very easily that worked
very effectively for us okay so we saw
how to do a lot of these work but in
almost everything we saw so far it was a
little function and the function was
doing something and we wanted to take
that function and refactor it to a
functional style but what about
object-oriented programming we use
objects quite often is there a place
where functions can come and save us a
little bit and reduce the burden reduce
the noise and make it lightweight
compared to a lot of things we do well
the next example I'm gonna take here is
gonna show how that can help us in in
here so what I have here is a decorator
pattern well let's look at the decorator
pattern for a minute I got an applicant
and the applicant has a function call is
credible which returns a true this is
just an example where of hard-coded
these things so an applicant is is
credible so we ask if your applicant is
credible it says yes it's the applicant
is credible well I want to get the
credit score for the applicant that's
hard coded at 700 in this example so
okay great
how many years does this person have an
employment well 10 years great or does
the person have a crew
no record sorry does have the criminal
record to write so now I want to
evaluate whether to hire this person or
not and there are times when this person
is a good hire there are times when in
the person is not a good hire and I'm
gonna decide that so what are they what
do I have here I've got an evaluator and
this evaluator is an interface it's got
a boolean evaluate that's what we have
here and I have a qualified evaluator
well you can see what's going on here
the qualified evaluator implements the
evaluator and returns just the east'
credible then I have an evaluator chain
this should remind you of the filter
iostream or input stream where we can
keep putting multiple things together
right well that's our decorator so what
does this do it says I'm gonna call the
evaluate and then of course called
evaluate on the next applicant when you
call it and then we have a credit
evaluator and then we have an employment
evaluator and then we have a criminal
evaluator care evaluator so I got a
bunch of evaluators now how do we go
about using all of this well we've done
this in Java before and it's a lot of
code for us to write so here is the
evaluate function as you can see and in
this value eight function we have the
applicant coming in but the second
parameter here is the evaluator that's
coming in and what we are doing here is
we are calling the evaluate function and
if it returned a result after evaluating
we are just printing whatever that
result was that's all we are doing in
returning that particular result and
then finally in the main we have an
applicant created and we are going
through each one of these evaluators
well please note down the number of
lines of code we have here about a
hundred lines of code so what are we
going to do with this we're gonna remove
a lot of fluff in this code and reduce
this to use a lot more with functional
style but more so with lambdas and the
functional interfaces so what do we want
to do starting with this hundred about
hundred lines of code let's start out by
removing a few things but before that
let's just comment out a few things here
and then start over well the first thing
I want to do is to attack this evaluate
function so if I go to the evaluate
function I have
applicant as you can see right here but
I'm gonna change this evaluator but
we're asking the evaluator you know hey
is it true or false so there's a
beautiful functional interface already
there that we can use so I'm gonna say
import Java dot util dot function dart
predicate and I'm gonna take the
predicate here with me so now that I
have a predicate on my hand what am I
gonna do with it well the beauty is a
predicate can come in really handy here
we don't have to have our own interfaces
in the making so I'm gonna simply modify
this evaluate function if I know where
does there this if I take this evaluate
function and I'm gonna say hey instead
of evaluator go ahead and change it to a
predicate applicant evaluator so I just
asked it to use a predicate applicant
rather than evaluator applicant so I'm
getting rid of that interface eventually
and then within the code I'm gonna say
instead of evaluator dot evaluate use
the method called test so the predicate
dot tests will evaluate the applicant
and tell me whether the applicant should
be accepted or not that's what we're
doing here so the good news in this case
is the predicate is coming in we don't
have the evaluator anymore well that's
great so far but what about the
decoration we'll come back to that in
just a minute so we have the predicate
on our hand so far so good now what am I
going to do here in this code well I
have the applicant on my hand so I want
to evaluate the applicant based on that
credit evaluator well what is the credit
evaluator after all do the credit
evaluator if you remember is simply
checking if the credit score for the for
the person the credit evaluator says the
score is over 600 then you are accepted
well that's all I need actual actually
isn't it so what am I going to do now so
I'm gonna simply go back here and say
well a predicate and this is on
applicant and I'm gonna call it as a
credit let's call it as credit evaluate
or is equal to given an applicant I want
to simply return applicant dot get
credit score is greater than 600 so we
simply wrote this little a predicate
called credit evaluator and what does
that do give it an applicant it returns
whether this code is greater than 600 or
not so that's a boolean result we're
gonna get from it well the good news is
now I'm gonna uncomment that and in this
case evaluate applicant rather than
sending the new credit evaluator and
then oh I even have a qualified
evaluator Oh tricky so not yet so we'll
come back to that in just a minute
so we'll start with a qualified
evaluator pardon me I didn't look
through that so let's go to the
qualified evaluator what does that say
oh is it credible or not oh that should
be fairly easy isn't it
so let's go ahead and say predicate
applicant and we'll say qualified
evaluator and evaluator so what am I
going to do here and I'm gonna simply
say equal to applicant is my memory so
weak as you can see is credible that's
what I want
so is credible in this case so that's
basically what we're gonna call hey I
met that reference work really nicely
there because we didn't have to do any
extra work for it so now let's take this
in baby steps so I'm gonna simply call
evaluate an applicant comma and I'm
gonna say qualified evaluator and and
pass that one in here so oh he doesn't
like the applicant right here because
that's already up there so we'll change
this to an applicant and that's going to
be the given an applicant okay so try
that so you can see that the applicant
was accepted hey this was simple we send
the qualified evaluator but our problem
is a little bit more difficult we want
to evaluate not only the qualified
evaluator but also check the credit so
what do we do well here comes the charm
we can say qualified evaluator dot and
credit evaluator and we can combine the
two together that is the power we have
on our hands right so we are able to say
not only do I want to check for the
applicant being qualified I and want to
check for credit evaluator just pay
attention to this variable for a second
evaluate function is receiving only one
predicate that's all it's not receiving
multiple predicates just getting one
predicate
however we are passing that one
predicate which has been chained down to
another predicate so we are passing
multiple predicates as a chain here but
the receiver only knows of one predicate
and they can use it this is one of the
nice charming features of these
functional interfaces is they give you
this compositional capability that it
can put things together very nicely well
so that's taken care what about the next
one well this guy wants a credit
evaluator which we have but it wants an
employment evaluator so let's go ahead
and fix that so what we're gonna do here
is we're gonna say well we got a
predicate right here so here is a
predicate and this is going to become an
applicant and there's gonna be
employment evaluator and what does this
do well this is gonna take an applicant
and it's going to evaluate that
applicant an applicant dot get year well
what is it called get employment years
so get employment years so we can say is
greater than you know whatever that
value that we wanted earlier we can use
that so get employment years should be
greater than pay zero that's great so if
you're alive and breathing willing to
hire okay great
so that's zero so that is an example of
employment evaluator well how do we go
about using that now well we can say
evaluate our applicant comma and then we
can start chaining those together very
fluently we can say here well-qualified
evaluator and in this case of course we
want the employment evaluator and we can
combine that and that gives us that
particular capability right there as you
can see that's the two things we wanted
so we can remove that and we guard what
we wanted
well then comes along the criminal
record evaluator so how do we do that
well that's going to be also relatively
easy predicate in this case an applicant
let's call it as crime check equals and
in this case an applicant and then we're
going to say not
an applicant dart has criminal record so
we don't want a criminal record we could
have called this and we could have gonna
negate on it as well if you wanted to so
now how do we use that we can say
evaluate applicant and then over here of
course we're gonna change this the first
thing in line is the qualified evaluator
and and what we do employment evaluator
and we're gonna say criminal or check a
crime so we can say criminal check so
crime check and then we can ask for that
so those three run it we can see
rejected right there and then finally we
can see that we can say evaluate
applicant and this is gonna bring the
boatload of stuff in front of us so this
is gonna be bringing in the qualified
evaluator that's the first thing and
well the next thing is going to be the
employment well that uses a predicate we
chained again and this is going to be
the credit evaluator and then we chain
again and then we say a criminal crime
check and then we chain again on that so
this is gonna do all of those and you
can see how that's gonna merge together
well having done all of that how does
this really help us well let's go back
to this code and start up here and then
go all the way you know excluding the
applicant itself so that's the applicant
so leave that alone for a second and
then up to here both and then we can run
this and the code is still working and
down to about 61 lines of code over
there so we can reduce a lot of noise in
code by using these things like function
and predicate and consumer and look for
how we can compose things with them and
so we went from a hundred lines to about
60 lines forty lines that was not
totally unnecessary to create the
decorator pattern oh pardon me how did I
miss that so my numbers are wrong so
there we go
fifty-five lines of code a little bit
better so that's basically what we see
here so I decorator pattern using
functional interfaces that's one of the
things that excite me is that you don't
have to build heavy weighted systems you
don't have to build a lot of code to
provide these kinds of
patterns but lambdas the way we use
patterns evolves and becomes a lot
easier and better to work with as well
that's one of the benefits we get out of
this but I want to show you two more
examples here we did use a composition
and higher-order functions so far but I
want to show you one more thing well
this actually came from a question
somebody emailed me after being in one
of my sessions and they said hey I see
what you're doing this is really you
know easy to write but my problem is a
little different so I'm gonna give you
an example of a problem very similar to
my problem how do you solve this well so
before I go into this problem and solve
it I want to set the stage for a
possible solution so it becomes easy to
understand so to understand this problem
let's take a slightly different example
and work with it so we have a wonderful
developers in this room so what I can do
is I can say developers start stream and
then I can perform a dart map and I can
say developer so we can say developer
and then I can say developer dog ed
email address so this is a great way to
spam everybody by getting their email
address right so we could ask for a good
developer email address well if everyone
has one email address I will have a as
many email addresses as the number of
people in this room so that works really
well but let's change the problem just a
little bit some of you may have you know
one email address that you use for any
official purpose but you may also have
multiple email addresses what if you
have seven email addresses three four
two whatever that you may have and
you're so eager you want to give all of
them well the problem is you know is
like really okay so so how do we work
with that well in this case in this
example what are we going just look at
only this example where we have one
email address so only let's say only one
email address per developer okay so what
are we going from so collection of first
sorry stream of person to
stream of string which is email
addresses right so that's what we are
going through so in other words we went
from a collection to a collection but on
the other hand if this was multiple
let's say multiple multiple email
addresses now we are in trouble isn't it
we're going from a stream of a stream of
a person okay stream of person to what a
stream of list of strengths makes sense
so all of a sudden we're like yeah
that's not what I really want isn't it
so how do we deal with this situation
properly I'm going to switch over just
quickly to give you an example if you
don't mind
Java quite doesn't have this capability
but learning about this helps us a
little bit to understand what this
really means so part of me here to
switch here for a second and I'm gonna
just show you one little example of a
little Ruby code and you could do this
in multiple languages I just picked one
here so I have a list equals let's say 1
2 and let's say three four five and six
and then a seven just to prove the point
I'm gonna say list art count and you can
see that it says four and you should
know why it says for now right because
our list contains one to another list
and then a seven so that's four elements
well that's great but I have a list of
list potentially so if you don't want
that you can do in this case list art
flatten and then you can do a count so
in this case you have flattened the list
so in other words you are saying I want
to take this list but I want to convert
them all into one list rather than a
list a list of list so this is called a
flattening operation well you want to
flatten some times and you want to map
sometimes well even though Java doesn't
have a flatten it nicely provides us a
flat map so if I say developers over
here
and actually I'll move this up here so
you can compare this if I say developers
dart stream and then I'm gonna say a
dart flack map so flat map and then
developer and then I'm gonna say
developer dart get email addresses
addresses dart stream well you went from
a stream of person to a stream of string
again so because it Maps it and flattens
it so this can be a very powerful
operation to do so here's a very easy
way to remember when to use a flat map
when you perform a map does it give you
a single value for the single value oh
yes it gives me a single value use map
when you do a map does it give you a
multiple value for a single value oh
yeah it gives me many values well most
likely in a flat map so that's the
easiest way to keep that in mind right
so one to one map one to many flat map
right that's a way to think about it
well given this now that we have seen
this one let's look at an example to see
how we can benefit from from this so
what I have here is a little get triple
and this is giving us a triple value as
you can see a B and C well in this case
of course compute triple it simply takes
an empty array loop through m2 2 onwards
and 1 2 onwards and then you can see the
imperative style all at work and then
finally I'm gonna come in and run this
and you can see the display of those
values that it gave us 3 4 5 8 6 10 5 12
13 a few values okay but how do I go
about reducing this code and and
transforming to functional style well
let's take this for a second and remove
all of that right now and let's see what
we can do first of all I'm gonna go
ahead and say in here a stream dart
iterate so stream dot iterate gives us a
way to transform through the streams
well this is great
where do I want to start well look at
where M starts with and starts with -
and keeps going
so we'll say - comma given an element
element plus one so this is going to
keep counting one at a time
well that's great what am I gonna do I'm
gonna do a map right now and in this
case I'm gonna say given at em I'm gonna
say in the stream so in this case stream
dart eat the rate and I'm gonna start
with that M right now and give another
element
give me an element plus one well now I'm
starting with the M being what about the
value of M s well why because well
actually this is going from n equal to
one through less than M so let me
correct that so I'm gonna change this to
in the stream dart range and what is the
range gonna be starting with one but one
shy of M because it's less than M so one
shy of M well now that I have that in
two stream or what is the next thing I
want to do well in this case I want to
say map given a n value I can call get
triple on M comma n because that's what
this guy is dealing with it's got a get
triple m and n so I'm gonna pass that m
and end to this but we got a bit of a
problem on our hand what does get triple
return after all get triple returns the
string value so that's great but
unfortunately though this is going to
return a collection of values so we go
from one to many
so once the many is not going to go too
well for us isn't it
so what am I going to do I'm gonna
simply take this and say dart so we got
a map given on this and then I'm gonna
say this is a flat map and I'm gonna ask
for a flat map well great now that I
have a flat map what am I going to do
well now that I have the flat map on my
hand I'm going to then say well dart and
this is going to be limit here look at
this charming charming code you would
love this so we have a count equal to
one and then we check if count is
greater than number we
Rickett but that's not enough we got to
do it one more time right post that to
somebody and say why and you can see
them do that right so no need to go
there so we can simply say limit count
and then once you have done it collect
and then collected to a list of values
and return so we're gonna just put a
return on this so you can see how let me
make sure it's working so we can return
a list of values so I need to bring in
the static dart stream dart collectors
and now we are and of course I need in
stream also support on me so import Java
dot util dot stream and in stream and
stuff related to that okay so let's see
if that does anything good for us so
what am i doing Oh a limit count what
did I call that let me check what the
count is that I wanted so in this case
the count is gonna be number of values
so that's what I really wanted so let's
call it number of values so that's the
number of values and that's the value I
want and a collect to list
let's see incompatible type okay I
probably need to throw in a boxed over
here but let's see if that works so do a
dart or I can do a map to object how
about that let's see that works so so in
this case essentially what we just did
is we went through a transformation so
let's take a look at what we just did so
we said give me all the values from 2
onwards then for every M value get me a
transformation to get the tuples or
triples for it and then since it is a
collection one to a collection I do a
flat map and then I would limit it to
the number of values and then return it
to a collection so that's extremely
powerful of course we gotta know what a
flat map is right but but with practice
that becomes a lot easier over time to
understand and work with it not too
difficult at all I want to spend just a
few minutes on one more thing just one
final example in the next remaining
about five minutes this is something we
all have seen several times over so I
want to kind of take a look at it and
see how to solve this sum of square root
of K prime numbers starting with n so
let's look at how this is going
appear first of all and then we'll go
forward so compute sum of square root of
primes 101 251 how are you gonna
implement this so look at this beautiful
code you look at this code it says I'm
gonna say indexes start and then
computed count to zero and a double
equal to sum then we start with a while
loop and how many times you do this you
pass and you ask the question is it less
than or less than or equal to they ever
asked that question every single time
and the day you don't ask it's called
the national off by one error day right
and that becomes really problematic
right so you got to ask the question
let's do less than or equal to then what
do you say is prime and you're asking
well if it is a prime you get the square
root then you add to the compute then
you increase this count and you better
not increase this count if you do this
inside this it's a lot of fun right it
goes into an infinite loop for a very
long time until you realize and if you
move this to here what's going to happen
it's not going to work either right
these are like the stars have to be
aligned right they gotta be in the
proper place and then comes the fun part
you're looking at this code and your
business analyst comes to you and says
what's this car doing and you're like
that's what I'm trying to figure out
shut up right so it really is annoying
right this extremely complex code and
hard not many lines but it causes also
so we can see how terrible this code is
so what can we do to make this better so
we got to rewrite this but let's see how
we gonna write it the first thing I'm
gonna do is well I want to compute the
sum of square root of primes oh great so
return and I'm gonna say stream dot eat
the rate and then I'm gonna say starting
with what starting with the given number
well the given number is called start as
you can see right here so I'm going to
say from start and then I'm gonna say
comma given a number number plus one
stay right there and look at it what in
the world is that
that's called an en
thinit's dream it has no limits
whatsoever
it starts with start star plus 1 star
plus 2 star plus 3 star plus 4 it keeps
on going you may look at that and say oh
my gosh if it's infinite we're gonna
store it on the cloud of course so so
the point really is that this is an
infinite stream but it is lazy
evaluation it knows not to do the stuff
until you demand for it well then what
am I going to do
well now that I have the heater rate
going I'm gonna say filter and I'm gonna
say given a value element well I want to
know if the element is a prime so YZ
prime I asked for it oh great now what
do I do
map it with math square root and I'm
gonna ask it to map and I'll even say
map to double and do the mapping well
that's great but this guy is infinite I
don't want to infinite I want to stop
somewhere where do I stop it
limit count did you notice not less than
count not less than or equal to count
its count damn it keep moving right so
it's that simple right don't have to
think about it twice and then of course
you say sum and that's what I want to
return from this call so you can see now
you show this code you can have a
conversation with your business analyst
right you can say it dude that's what
I'm doing
is this what you want to do in this
problem statement you're able to
communicate a lot better with this then
have it to struggle with it so what we
saw in this example is we made the code
more concise we did make use of infinite
stream but that's only possible if we
have lazy evaluation not otherwise if
you're interested in the code example
you're most welcome to download it from
my downloads page if you search around
there you'll find it otherwise drop me
an email I really hope you found this
useful
thank you
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>