<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>DevLIVE | Coder Coacher - Coaching Coders</title><meta content="DevLIVE - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>DevLIVE</b></h2><h5 class="post__date">2017-10-04</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/CHoLKhRk8_o" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">good morning Dan McGann how are you very
good thank you thank you again yes good
to see you too it's a great show isn't
it so far so good well we have a little
bit of administrator to do here we're
going to get our periscope broadcast
stream set up so let's take just a
second to do that and then we'll get
started with tips and tricks for getting
started with nodejs cool so that's cool
all right so it is at Dan McGann right
yep cool all right
there we go so you know watching me type
is awful at DM
getting started with huh I gotta are we
live now we are live so what else are we
going to start talk about it's alright
getting started with let's see the node
great J yes and that new thing place do
it models spell check oh my gosh that's
horrible
this is really bad video no js' ant and
let's say they are ml e and i'll explain
that and l e go live alright so we've
been live on YouTube for a while
good morning it is Wednesday morning
here at Oracle OpenWorld were at the at
the Oracle developers lounge here it's a
great show
yeah it's been a lot of fun yeah three
talks down two to go a lot of things
going on yeah it's really good so it was
really cool of you to agree to do this
little interview because you know you
talked about just three sessions but
then they want you at that theater at
that demo at the you know so you've been
running all over the place and booth
duty this is a good show for you so
let's get started because we've got
maybe 20 minutes so and we're gonna
break this up into sections so that you
can jump forward and back yeah but let's
start with your tips and tricks alright
so actually before we get to the tips
and tricks I just want to let folks know
about something new I can finally start
talking about this this is something
that the Oracle Labs group has been
working on for a little while
I just wasn't allowed to talk about it
but now they have a release out so it's
kind of official and it's now a thing
and it's basically JavaScript in the
database you know there's been this
trend for a while of using javascript in
more and more places that's really what
node.js is all about using javascript in
the middle tier and so now we're taking
it even closer where the data is at
you know actually in the database so
he's a very high-level overview where
we're doing a typical NPM install here
and we're installing a package known as
validator and validators this really
great library that has all kinds of
validation routines including one for is
email but there's tons and tons of
others and they're actually quite
complex you think oh I could just write
a regex and be done with it but it's
really not that simple so we get this
package and then we can deploy it now to
the database using this little utility
here DB j/s deploy right and just
specify your package here it's validator
jeaious and then your connect info for
the database and off it goes and into
the database and so one of the ways that
you can use this is as a user-defined
function in the sequel engine so here we
say select email from emails where
validator dot is email equals one nice
because the sequel engine doesn't have
boolean so we use zero on one okay so
this is just really cool technology and
let me flip really quick to a web page
now the URL that you're gonna see here
is not the actual you are out what I did
is I just created a bitly link so that
folks could actually remember it so it's
bit dot ly / Oracle - ml e and the MLE
as you see here is for the database
multilingual engine now what it is if I
could get this menu to stop popping up
it's basically technology that enables
developers to work with multiple
languages in the database so they
started with JavaScript but the idea is
to add in other scripting languages over
time okay you can choose your favorite
language no way and at this point what
they have now is a download and it's
basically a VirtualBox VM it is rather
large it's a 12 gig download it has
Oracle database installed it's 12:1 so
it does have JSON capabilities ok as
well as this new MLE and so folks can
come over here to documentation kind of
learn a little bit about how it works
and start kicking the tires and we're
just really excited about getting this
out there and interested to see how
folks use it and adopt it and see what
they come up with and put it to you
I do love that so I noticed that you
clicked on that OTN license no maybe you
did not if we went over to the document
licenses this under do you happen to
know I do not know well we'll get to
that and we'll double double back on
that so it's good it'll be good to know
yep absolutely so yeah let's switch back
over to Tips &amp;amp; Tricks so this is a basic
this is actually not just tips and
tricks for the node.js in general rather
more specifically the know just driver
that we have for Oracle database okay
let me just get through some of this so
at a very high level overview I don't
have time to get through it all but
we'll just see where we end up but high
level we start with some basics when you
start using the driver in general then
we go into what you need to know when
you're working with more than one user
and finally what you should know when
you're executing sequel and PL sequel in
general alright so let's start with
getting started with the driver you need
to be aware of your session timezone and
you need to encrypt connections so we'll
start with session timezone and here's a
scenario imagine you create a table it's
a very simple table T and it has a
single column a date column C and you
write some JavaScript code and use the
driver to insert a row into this new
table you've created right right so you
can see here on line five I'm creating a
new date and JavaScript and it's a UTC
date and the actual value its January
first midnight 2017 right right okay so
we take this value and we use the driver
to insert it into our new table and we
just bind that value in pop quiz what
date value made it into the table the
default one well you would think right
no well as always it depends we don't
have enough info at this point to answer
this question accurately okay and in
fact if I go into sequel dev and I just
run select C from T I actually get
December 31st at 8:00 p.m. so about four
hours off of what I would have expected
so let's look at a few things we need to
consider here the first thing is that
actual column its if it's either a date
or
timestamp these values do not have a
timezone component so it's kind of
implicit you actually have to know when
you're designing your schema what
timezone those dates should be okay so
if it's Eastern maybe we don't have a
problem maybe it's accurate but if it's
UTC suppose for UTC then yeah we're four
hours off and there's an issue right so
let's assume it was supposed to be UTC
and we do in fact have a problem well
the next thing you need to know is how
oracle database driver binds in these
data types and the way it does it it
converts it to a timestamp with local
timezone which is a nice data type
within Oracle alright so the next thing
is what happens if we take that data
type and insert it into a date column
well here's the problem we get an
implicit data conversion Oh No okay ends
up happening the value when we do this
of that data type is converted to the
session timezone not good we'll come
back to that and then it's inserted into
the date column and we lose the timezone
stuff and we lose milliseconds right so
the big question is where did that
session timezone come from and that's
what most folks are going to run into
and the answer is with no two oracle DB
it's going to pick up the timezone from
the operating system when you start up
your node app okay got it
so nodes running in the middle tier on
some server and you know this is admin
whoever created that server when they
created it they had to pick a time zone
and if they picked a local time zone you
may have a problem because it may not
match what you're expecting so this is
actually really easy to work around not
a big deal okay we have an environment
variable or SD TZ and you can set that
prior to running your node app and get
whatever time zone you want so it's just
something folks need to be aware of if
you need more granular control over that
that's fine too we can go at the
connection level and just alter the
session time zone you can use a logon
trigger for certain schemas there's all
kinds of ways to work with it the key is
really just to be aware of how this
works and how to how to deal with it
when it's not working the way you want
it to I got it
okay good cool let's move on to
encrypting connections between node and
the database so the way this generally
starts when you have a traditional
three-tier architecture folks always
think ah we need a secure connection
between the browser and our mid tier
right so they look into SSL
get there they get their certs and yeah
they're good to go off my braces okay a
little bit later folks think about the
actual data especially data at rest and
I thinking oh man we need to secure this
if folks get to our disks or for running
backups we need those to be encrypted as
well right so of course Oracle has
transparent data encryption we make this
really easy so they enable that and
they're good to go then folks look at
this connection between what's behind
the firewall from node to the database
and they think this is overkill right
it's it's obviously gonna be a real pain
to deal with
we're not even gonna bother no one's
gonna ever get there anyway right
do you recognize this slide so this is
one of the many slides that came out
when Edward Snowden exposed the prison
project right and they were actually
looking at Google and I'll just focus
your attention right here on this slide
it's nice
SSL added and removed here smiley face
right so this is obviously their target
they were taking advantage of the fact
that most folks don't encrypt at that
layer and you know if the good guys are
doing this chances are the bad guys are
doing it too right exactly so we do want
to encrypt here and what I have here is
an example of a query that you can run
to detect whether or not your node
servers enabled with encryption and it's
basically just pulling data from session
and such and connect info okay and then
we just log out the rows and when we do
not have encryption enabled you get
these three rows back and you'll see
that we do have an encryption service
and checksumming service available we're
just not utilizing them right now so how
can we do that well it's important to
understand that we can do this at the
database level or we can do it at the
client level and at the database level
the advantage is that we can make sure
that all connections coming into the
database are encrypted that's nice but
maybe not practical for everyone
especially if they're just starting down
this encryption journey exactly so we
can do it at the client as well and
that's what I'm doing here
so all we need to do is create a sequel
matura file on the node server yeah and
we just add these four lines not
terribly complex right so we save that
to a location like opt Oracle config and
then we set another environment variable
the TNS admin we just point it to this
directory okay then we rerun that same
query and you're going to notice two new
lines and you'll see that we have the
encryption service
dr. running and the checksumming service
adapter running so now encryption is
enabled but if you don't trust the
additional two lines you want to
actually see this thing in action those
different ways you could do it you could
use some some advanced tools but they're
often hard to like Wireshark they're
kind of hard to install on your database
server right so we actually have an
easier way you can do that thank you
visit that sequel net aura uh-huh add
these four lines in which you're
basically doing here is enabling a
diagnostic trace okay and saying where
the output files should go and that kind
of stuff and then what you do is you run
two tests one with these settings here
commented out with hashes and the other
with them not commented out enabled
right okay got it what you'll end up
with they're two separate trace files
the first with encryption disabled you
can actually see those select and column
names in addition to the query going to
the database you're actually gonna see
the data coming back from the database
and it's all gonna be in plain text Wow
on the encryption side you're not gonna
understand a single thing lot of dots
yeah so it was super easy to enable
there's really no reason not to do it
these days so get the encryption on and
you're protected end-to-end suite so
that's the basics for getting started
with the driver kind of like just after
install right but what about what does
it both really importantly so I'll hang
you up later down absolutely you know
when you start doing your best dates yes
dirty data and cleaning that up is gonna
be a pain dirty data that's right all
right so let's look at what you need to
know when you're working with more than
one user ok so the basics got to use a
connection pool we do have a connection
pool cast and help make that easier and
there's a trick with node to be able to
use more than one or more than four
connections at a time which we'll have
to look at as well so we'll start with a
connection pool there's different
classes in Oracle we heat in the
database driver and we have the base
class and the base class is usually used
to either create a pool or a connection
and when you create a connection from
the base class we call this a one-off or
dedicated connection that's fine if
you're doing occasional scripts that
maybe run periodically right but if
you're creating something like an API
where you have multiple users sending
requests in you cannot do that it will
not scale
you have to create a connection pool
first and then get these connections
from the pool okay so pool first yeah
advantages the the pool has the
connections created and then you just
simply use and reuse them and release
them got it
you know how do we create a pool it's
actually quite simple use a base classes
create pool method so you're passing in
the standard connect info you normally
would but then you have additional
parameters for the pool itself and in
this case the poolman and max are the
same the increment set to zero so we
have a fixed pool of 20 connections here
and actually the real world performance
seam recommends this kind of fixed pool
thing so it doesn't spend time a
resources scaling up or down all right
so I like that and then we can use that
pool to get our connections it's super
easy so I have here a test that I ran to
compare the two right I got it I got to
convince people to use the pool right
and so if you're not gonna use the pool
and we're doing an iteration here at ten
thousand iterations we're getting a
connection from the base class using the
config so this is that one-off dedicated
connection huh we get a connection we
execute a query we close the connection
we do it about ten thousand times
nice on my laptop with a local VM that
took about three hundred forty-six
seconds all right okay so then I have
another test here with a pool and the
big difference is I'm creating this pool
before we get into the loop and the only
difference in the loop is that I'm
getting the connection from the pool
that's really the only change okay took
six seconds I can put them side-by-side
you can see how much you're gonna save
just by using a pool side-by-side yeah I
had a 3d alright a couple other notes on
the pool for again connection we do have
a cue so you don't have to keep polling
if all the connections are in use so it
makes it nice and easy to use the key
with a pool just keep the connections
out only as long as you need them
previously for as long as the
transaction takes and then release them
back to the pool okay that's a good idea
now one thing that you'll run into we
were running into this when we first
created the pool technology was
often times with node you have multiple
files or modules within a node
application right so you're gonna create
this pool in one module but you need to
consume the pool and many other modules
right understand if you create it in
main the question becomes how do you
then share it to these other modules and
what it really was forcing folks to do
is create a separate module where they
create their pool and then add methods
like get pools so they could retrieve it
from the other places that was just a
lot of boilerplate code we didn't want
folks out to do so we built in a little
pool cache and I'll show you here how
that works so the idea is in main jas
were creating a pool with the config and
note that I'm not even referencing the
pool anymore I know that it's been added
to the cache the first pool you create
becomes the default in that cache and
then what we can do from another file
like employees j/s is simply use the
base class again this time I'm calling
get connection but note that I'm not
passing in a config and when you don't
pass anything in it knows to look in
that default pool and grab the
connection from there most folks are
only gonna have one pool so this works
fine for them okay good and the case
that you have multiple pools or you
don't like that implicit default you can
explicitly use an alias so in this case
our configuration for the pool has a
pool alias called human resources pool
and then from employees jsut just pass
in a string human resource is pulling it
knows to grab the connection from that
pool gotcha super easy to use really no
reason you shouldn't be using the pool
in the pool cache the only other thing
you need to be aware of is how nodejs
works with threads and thread pool it's
often described as a single threaded
environment but that's just kind of part
of the story okay
so and in reality the way it works is
you have this main thread for JavaScript
all the JavaScript code you're gonna
write is gonna run here but part of that
code will eventually make an async API
call out maybe an HTTP request database
driver requests things of that sort okay
now it's gonna fall into one or two
pools it's either going to be completely
evented things like timers and tcp which
includes HTTP HTTP or or it's going to
come into this thread pool bucket that's
file i/o DMS and user code which
includes encryption compression and
anything you're gonna do with the
database driver gotcha now really the
secret sauce for nodejs is right here in
the evented category this is what node
does better than just about anything
else out there and highly efficient can
scale real well everything else has got
a leverage a thread pool so really what
happens with the thread pool and what
folks need to be aware of is that node
starts off with four threads in that
thread pool by default okay so if you
create a connection pool with 20
connections but you leave that default
only four connections can be working at
any given point in time later you'll be
saying why can't dad told me to set up
it won't scale and it won't connect not
only that no J's deadlocks they they
it's a new kind of deadlock we had folks
that were complaining these our folks
have had complex transactions yeah so
they were doing updates and row level
locking was occurring and they tried to
do the commit at the end which was that
last round trip to release the locks and
they couldn't get a connection I
couldn't get a thread from the thread
pool because other connections were
waiting on the locks to release though
that was a really interesting scenario
but really easy to fix there's an
environment variable for node.js called
UV thread pool size okay and the key is
you just need to set this prior to
running your node app and and you're
fine so we recommend you set it a little
higher than your pool max if you're
using multiple pools you need to do the
math and the max is 128 just keep that
in mind so what we have here is an
example of setting this prior to running
your node app okay yeah good idea
yeah easiest easiest way to do it if you
do it in your app you can do this too
but it has to be done no it just has to
be done at the right time so as long as
you do it before this call here this is
an async call okay once the first async
call happens that's when they create the
pool and that's when these the default
of force if you set the default prior
you're good okay otherwise it's gonna
use the default how we doing on time you
know we're doing all right on time uh my
kitchen would just joined us he's over
there
catching up on a couple things so all
right so to wrap up three really cool
tips on using the nodejs driver right
the and
are a new announcement yeah absolutely
very go check it out download it have
you tried it out yet not I have not I
literally I just got here it's been a
bit of a whirlwind right and and the
team that released it released it on
Monday yeah also hotel yeah downloads
gonna take a little bit yeah a little
work
yeah right well that's excellent well
I'm so glad that you dropped by thanks
for having me all right we'll talk to
you soon and I will see you on your blog
of course sounds good and keep up for a
ODOT io y SJ s AO dot io meaning that
you've moved out to get up right now
well it's JavaScript and hora Cole dot
IO but it's not in github although I
love that idea
yeah all right well good I'm really glad
to have you on board today and we'll
talk soon thanks again Thanks okay
and a lot more sense</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>