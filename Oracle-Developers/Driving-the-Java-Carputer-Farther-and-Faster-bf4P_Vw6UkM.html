<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Driving the Java Carputer Farther and Faster | Coder Coacher - Coaching Coders</title><meta content="Driving the Java Carputer Farther and Faster - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Driving the Java Carputer Farther and Faster</b></h2><h5 class="post__date">2015-06-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/bf4P_Vw6UkM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">right so first question did anybody come
to my session last year about the Java
carputer a couple people right well
that's good because I'm not going to do
anything the same that I did last year
so even though the the subject is
slightly the same it's about a carputer
I am going to go into very different
kind of material to the material that I
had last year and i have to say that
this has been a really fun project for
me to do in terms of all the stuff that
I've got to do and as you'll see as we
go through there's some kind of
interesting stuff that you can do with
your car because i am a confessed petrol
head so i really like cars i'm real
engineering and being a geek as well
I've combined my two favorite hobbies
into one project now as an Oracle
employee first slide I have to put up is
the usual safe harbor statement saying
that we're not promising to deliver any
product on a particular date I think we
can feel fairly safe once you see what
I've done that this is not going to be
an Oracle product anytime soon so that's
good right in terms of the structure of
the presentation I'll start off with a
little bit of introduction about the
carputer and how I got to where I am at
the moment and that will be a little bit
of a recap about what I did last year
for the presentation and the ideas that
I then used moving forward and really a
lot of what I've done this year is about
getting more data from the car so using
different sensors different ways of
extracting information about what the
cars doing where the car is what kinds
of things going on the other thing that
I did this year was I had some thoughts
about how to actually display the
information so this is this is the
carputer from last year which is uses a
sort of 7 inch display which is quite
common I felt this year let's see if we
can do something bit more interesting
let's use a heads-up display so kind of
fighter pilot style thing which is which
is what i've got here i'll talk about
how I designed that
and some of these of engineering that
went into that and the ideas behind it
and then i'll talk about driver analysis
so i used the system to collect lots of
data about what the car was doing how i
was driving and so on and they'll have
written that an application which will
enable you to play back the information
and then you can see exactly what you
did is you drive it and this action does
have real-world implications and
real-world applications in the sense
that you can have insurance data you can
have fleet management you can have
driver training all those sorts of
things really do actually have
real-world applications and then I'll
just wrap up with some conclusions and
resources and then I'll show you a
couple of demos now clearly I don't have
the car with me so I've got a video of
the heads up display in action and then
like ourselves I've got the application
which actually shows you the playback of
the data and I can show you a drive that
I did and all the information that came
with that so start with an introduction
to the carputer itself and so one of my
colleagues here has a car this is a 67
did you say 66 so it's only one year
younger than me it's a 66 chevy impala I
has zero lines of code and this is the
thing about cars if you look back to you
know 20 30 40 years ago cars were very
mechanical yes there's some electricity
involved because you have the idea of
you've got to actually ignite the fuel
inside the system so you've got things
like points you've got things like an
alternator you've got things like a
dynamo those kinds of things but it's
very electromechanical it's not
electronic and in fact my first car was
a mini and one of the original meetings
and that had no electronics in it at all
so it was just wiring and 12-volt system
but no electronics in it now if we move
forward
and like I say looking at last year's
carputer this is my current car so this
is an Audi s3 it's about three years old
now and that has lots of electronics in
it so there's all sorts of things that
it can do is things like it's got a
satellite navigation system it's got
some very fancy things called debris as
I kind of move announced it Rio mega
magnetic suspension so there's actually
a magnetic fluid in the shock absorbers
that you can vary the viscosity of by
changing the magnetic field around until
you can actually little button in the
car you can go from from normal mode to
sport mode which basically means you can
go from comfortable mode uncomfortable
mode and so I built the computer which
as I've got here is a sort of box and
you can see the the inside of that
inside there is a Raspberry Pi which are
used to actually control everything and
so I put the Raspberry Pi in their Road
some Java code connected to various
different bits and pieces in the car and
then presented some information and
really the idea behind this particular
project was adding more information as
you are driving a lot and this was the
user interface that I came up with a
nice little splash screen in the middle
and then I had various data that I was
presenting in terms of you know what was
the throttle position what was the
engine load what was the temperature of
the coolant temperature the catalyst and
so on and I also had a mixer ometer in
there so the bottom left-hand picture
you can see I did the sort of formula 1
style g-force meter so as you're going
around a corner you can see how how much
G how many g we're putting off how many
percent of a GU were pulling and then I
also did a thing where you could
actually have a graph and you could see
over time how your my throttle position
or of power or whatever was actually
changing so as I said the idea of this
project was more about presenting
information as you were driving along
rather than collecting the information I
did collect the data as I was driving
but that was more about in terms of
being up demo the system what I wanted
to do is be able to replay
afterwards so people could see it during
the session so this year I sort of
thought to myself okay what can I do
taking this the next step forward and
really a lot of it was about how to
collect more data and one of the big
areas that was looking at how to access
the canvas in the car because rather
than having wires that connect all the
different systems independently cars
nowadays use a bus architecture and so
it's a twisted pair kind of thing where
you have two wires that go round and
deliver signals to different devices
different devices has a different
address and then you can send messages
from one device to another across the
bus and control all the different things
so I thought that would be a really
interesting thing to actually hack into
to get information about what's going on
because there's lots of sensors that the
car uses just to drive along there's
things like the steering wheel has an
angle sensor on it so you can tell what
angle the steering rose that because the
electronic stability program needs to
know what the angle that the wheels are
at in order to determine if you're
skidding or if you're out of control and
what actually needs to take and so a lot
of information there that I thought
would that be really interesting to see
we'll see how successful i was with that
as we go through another thing was gps
data and obviously cars got satellite
navigation but getting access to that
information dependent it is not possible
so i decided to add a gps sensor so i
could actually track both the position
of the car and also things like speed
and the bearing i could compare the
speed that i got from GPS sensor against
the speed that i got from the car itself
and that was my interesting odd come
back back again in a minute I mean I
thought let's let's add some human
information some biometric information
so let's add a heart rate monitor so
that way I can see what my pulse rate is
as undriveable and then you know we can
see what actually happens as the car
loses control and how my heart rate goes
up and things like that other things I
looked at
found some information out tire pressure
monitoring systems being a big formula 1
fan I know that you know these kinds of
things are very important when you're
driving a Formula One car I thought
would be interesting to see whether we
could add some tire pressure monitoring
system to the car as well and then the
other thing was thermal sensors and so
again we'll talk about that because got
some ideas from formula 1 in terms of
what I could do that and what I was able
to achieve was was not quite what
formula one who does as I say different
display method was really one of the big
ideas so adding a heads-up display
changing the way that I actually
presented some of the information that
was kind of a separate project from
collecting all the data another thing
that I thought about in terms of placing
information would have a camera that
collected the video of what we what you
could see out of the front of the car as
you're driving a lot and so there's
quite a lot of information there about
what I had to do in order to make that
work and then the other thing I thought
about was looking at how cars are
developing now and in the future
telematics is something that's very big
in fact in Europe there's legislation
that's coming in which means that from I
think like either a year or two years
from now every car that's produced in
Europe has to have a modem in effect
built into it so it has to have GPRS
built into it so in the event of an
accident the car will be able to dial
the emergency services and direct them
to where the accident has happened a lot
of companies like Audi like BMW and
Mercedes are looking at that and saying
well okay we've got to put GPRS into the
car what other services can we layer on
top of that so I thought let's have a
look and see what I can do in terms of
adding GPRS and and talking to the cloud
from my car and then like I so using all
that recorded information playing it
back so that you could see what had
happened during a particular drive so I
was all the sort of ideas that I came up
with and what that led to was an
architecture
because of course you know being a good
computer scientist so I had to come up
with an architecture so this is the sort
of approach in terms of the architecture
these are the different sort of sensors
and song that I actually either did
connect or attempted to connect to the
system so in the middle we've got the
the the computer itself I upgraded that
because last year i use the raspberry pi
model b this year i used on the model b
plus because they have more USB ports it
also handled the power on the USB ports
in a better way unfortunately it still
didn't give me enough USB ports and so I
need more USB port and to get around
that problem i decided to use a second
Raspberry Pi in order to collect
information from some of the senses so
there's several of them connected via
USB there's the the thing on the left
hand top left hand side this is thing
called an elm 327 and what this does is
it you can plug it into the service port
on your car and then you can actually
read information from that in terms of
things like the temperature of the air
going into the car and the temperature
the catalytic converter on the exhaust
and things like that and I'd use that
last year so that was there was a fairly
easy thing to bring the project again I
squared C to connect to the
accelerometer used the UART to connect
to the GPS sensor and there's lots of
different sort of ways that we connect
things and then all of this obviously
done in Java now I did have one big rule
about this project because i like my car
but i don't actually own it it's a
leased car so the big rule was that I
couldn't actually modify the car in a
permanent way and I was pretty good I
almost succeeded in following my big
golden rule as well as they though there
was one bit i had to had to make every
now he's never change to the car but
i'll explain that in a moment so let's
talk about how we get more data and
different sensors and how we can
actually approach those things so the
first of those was
packing position trapping speed tracking
the bearing using a GPS sensor and this
was the GPS sense that i'd used for
another project we actually run or ran a
massive open online course for Java ME
early this year and one of the things we
used for the development of that course
was a GPS sensor and so I decided to
repurpose that we use that in the in the
project that i was doing this is quite a
nice device because it's quite simple to
actually connect it to your ice cream
pie because it uses a serial interface
so its glow you know it it's rebated 10
hunnam's so give you 10 readings per
second in terms of your GPS position and
you know for what I'm doing I don't
really need super high resolution and I
can get away with 10 readings a second
quite happily and in terms of
configuration it's pretty easy first
thing you have to do is turn off the
console on the Raspberry Pi so you're
not getting the information being sent
to the the pins and then you just
connect the pins on the Raspberry Pi
uart directly to the right of the GPS
sensor and then you set up the
configuration at again it's pretty easy
in terms of the Java code because you
use the lib rxtx package which gives you
the old Java calm API and allows you to
talk to serial devices so you set it up
in 69 600 bowed 8-bit state data bits no
parity and one stop it and everything
works might happily and then in terms of
reading the data and actually writing
the code it was it was pretty
straightforward the only thing I found
was that quite often the data got
corrupted in terms of the lines that
were being read because he was trying to
write so quickly but often because it
reports different types of data some of
the data get sort of interleaved in
terms of the lines that being written
didn't really cause me too many problems
but it was something I had to take into
account in terms of parsing the data and
you had to look for where you've got
corrupted data and then just ignore that
and read the next line until you've got
a lineup
valid that was okay I'm again very
simple in terms of the protocol because
you don't even have to ask it to to send
you information it just continually
sends all the data that's got and you
just look for these two particular
sequences of characters at the beginning
of the line and that gives you the GPS
data in terms of the latitude and
longitude and the altitude as long as
you've got enough satellites that you
can see and it also gives you the
velocity so velocities vector so you get
the both the speed and the bearing that
you're actually moving in in terms of
the heart rate monitor again this was
pretty straightforward I found this this
is a one of the sparkfun boards and this
works with the polar heart rate
monitoring which a lot of people use
when they go to the gym so that was easy
so I already had the sensor for that
just leave provide the board very
similar in terms of the way you set it
up to GPS it's just a serial connection
but this time over USB so you plug it
into a USB port it appears as / dev /
TTYL us be 0 and then you connect to it
in the same way 9600 bowed and so on
this one did actually require a little
bit more coding because you actually
have to send a message to it asking to
read the data so using the line saying
read the data and it gives you a line of
data bound and so that was that was
pretty sort of straightforward one
problem I did have with this was that
originally I thought oh well you know
I'll mount everything I can inside the
box that I've got and have it as part of
the system and when I finally got around
to reading the documentation which was a
long time after I'd actually started the
project and actually done most of the
work I discovered that the range that it
will work over is only 80 centimeters
and it also says that you should really
have it parallel to the sensor and not
have lots of electrical interference in
between you and the sensor and putting
it behind the screen and behind the
Raspberry Pi really didn't work so I
actually had to move it out of the
out of the box and so I've got this very
nicely designed box that I created out
of am a business card holder I like to
repurpose things so the next thing cause
in-car video now this is something
that's actually becoming a lot more
common now does anybody here anybody got
in car video no okay I was in Hong Kong
little while ago and a lot of the shots
they were selling these in-car video
systems and so I thought that could be
something that could be quite
interesting in terms of this project and
I looked around and found this
particular device which is the is made
by transcend who also make a lot of like
SD cards and memory and things like that
and this had some nice kind of features
to it because the big thing was they had
a Wi-Fi connection and so there's an
application you can download onto your
iphone or in to your android phone and
you can connect to the camera now i must
admit i don't really see the benefit of
that because if you think about it car
the cameras in the car and so you can
connect to the camera from your iphone
so you're either driving the car in
which case using your iphone whilst
driving is not a good idea or your
passenger in the car and if you're a
passenger in the car you can see out of
the front windows so actually looking at
it on your iphone doesn't really make a
lot of sense but they did it anyway so
that that's fine ok so it's got Wi-Fi
and it's got a nap so I thought right
great so what I should be able to do is
use that connect to the Wi-Fi connection
pull video into my car pewter and then I
can record the video as of driving along
wrong with my data so how do we do that
well ok so we're in the first of all was
I actually approached the the transcend
technical support people and I said this
is what I'm trying to do and they can't
make anywhere no we're not going to tell
you how to do it so it's like okay fine
so I kind of hunt around on their
website a bit see if they've you know if
there's anything useful their
documentation wise and I come across its
big zip file which is like source code
I'm like oh
source code that's good we like that so
if I download that unzip the file and I
get a copy of VLC because clearly what
they've done is they've used VLC which
is open source in order to comply with
GPL license they have to put it on their
website somewhere but didn't really do
much good so then I start getting into
like reverse engineering the the
protocol and that they kind of took me
into a thing called Wireshark anybody
use wireshark are right here time you
have very good in terms of enabling me
to track different things and of course
i did a port scan so i could figure out
which ports were active on the different
sides and i discovered that there were
sort of three control ports and then one
port which was being used for rtsp so
it's just doing real-time streaming to
VLC so in theory it should be pretty
straightforward but the problem is when
you start looking at all the packets
that are going back and forth there's
some kind of negotiation that happens
before it starts doing the the streaming
which is a whole bunch of sin and act
packets and when i started looking at
that I just went oh that's just like
it's too much like hard work so I needed
a different approach so I came up with
an idea and what you find is that the
simplest the simplest solution is often
the best so the solution I came up with
what sticks so rather than actually
going down a technical route and saying
well I'll try and connect through the
Wi-Fi connection and actually download
all the data I thought to myself where
all the data is going onto the SD card
in the camera so all I need to do is to
be able to synchronize the point at
which i start the video and at a point
at which i start recording the data in
my car puter so rolling using
clapperboard actually just use the piece
of cardboard so i put pizza car building
from the camera and then i needed
somewhere synchronizing that with my
data so what I did was I added a button
to my box so that what i could do is i
put the piece of cardboard in front of
the camera obviously i have to be
stationary at this point because i need
both hands so put the cardboard in front
of the camera hold the button down and
then when I'm ready
start I just moving the cardboard and
release my finger off the button and
both of them start at the same time now
obviously there's you know maybe a few
milliseconds difference but it's good
enough for what I was trying to do and
that was pretty easy because by a push
button you can just connect it to a
couple of gpio lines on the Raspberry Pi
you can use PI for j and it becomes very
trivial to actually write with a code to
use the button tire pressure monitoring
now if you look at tire pressure
monitoring systems here in the US they
have this thing where a number of them a
few years ago there was a big problem
with tires from firestone i think it was
and so that cause lots of problems with
various cars not not working properly
and they decided that they were going to
mandate tire pressure monitoring systems
on all american cars and they came out
with this with this wonderful thing
called that the tread act and economy
that favor es is the transportation
recall enhancement accountability and
documentation act how long did it take
them to come up with the number of words
that could actually spelt read so sure
so that's what it is so they decided
that they want to all cars have tire
pressure monitoring systems and what
that means is that there's they're very
cheap now so you can buy these things as
aftermarket systems from china and they
cost like about twenty dollars to get
this set of these my car actually has
got a tire pressure monitoring system on
it already but it doesn't use sensors
what it does is it uses the ABS system
to monitor the speed of the rotation of
the wheel and if one of the tires starts
be plating obviously the radius of the
tire changes and it can actually detect
that and tell you to pump the tire up
this but I thought we'll use these
because that's going to be a lot more
exciting and so what I do is oak I got
on some of these and first thing I do of
course is take it apart and find out
what's inside and I discovered that
there's a very commonly used chip which
from Infinium
chip manufacturer and it's basically
just a little chip which measures the
pressure and then transmits the data it
uses the 433 megahertz range which
certainly in the UK where I come from is
an unlicensed part of the spectrum so
you can send whatever data you want and
it in terms of getting the information
from that I sort of did a bit of search
around on the web and I discovered that
there was a very nice youtube video from
somebody who've done some decoding
specifically of this kind of thing and
he kind of pointed me to the idea of
using what's called a software-defined
radio receiver and these are sort of
like a USB dongle that you can get plug
into your laptop and its really designed
for a record will for allowing you to
access radio or TV on your computer but
you can also tweak it so it'll actually
go down to the 433 megahertz range and
then they will you to detect information
on that so I had to go that and I found
there's a thing called RTL underscore
433 it's an open source software that's
available on github and so I set that
all up what that does will actually
decode packets for you and show you what
the data is coming in those packets so
my first problem was I discovered that
there's lots of things that broadcast on
the 433 megahertz frequency so like my
thermostat talks on that frequency the
wireless cordless telephone talks on
that frequency so I had to go find
something so i basically parked in a
field somewhere so i didn't have
anything else around me and tried to get
at the signals but I don't I'm wasn't
very successful with that the software
that i was using this this an rtl 433
didn't sort of pick up enough in terms
of the package structure and things like
that so what if i'm going to do any
further with this i think i need to
start looking there's a thing called new
radio which goes down to the sort of the
level of picking up the individual radio
signals and it's going to process that
but i have to say that in terms of the
data that you're presenting to the user
tire pressure monitoring systems
probably a lot more exciting in Formula
One when you're driving your car because
most of the time the tire pressures
don't change in your car I mean there's
a little bit of change as you the tires
move them up but it's not very exciting
to see changes in the actual tire
pressures so that landing didn't work
and we won't really kind of going to
that any more detail then I thought
thermal sensors because this could be
quite fun so this is this is from
Formula One this is something that
started showing more recently is to show
you the tech guy how hot the tires get
how hot the brakes get things like that
so I thought that would be really cool I
could have that in my car so I started
doing a bit of research and I discovered
that funnily enough for being a one have
a bigger budget than I do so when I
looked at the kind of sensors you can
buy the sort of professional sensors you
can get for doing sort of whatever is if
people need thermal sensors for they're
really expensive so a camera which would
give me a resolution of like 160 120
it's like eight thousand dollars so I'm
like nah I can't do that although
funnily enough literally just this
afternoon there is an article I saw
where somebody's just launched a thing
that plugs into your phone and gives you
a thermal sensor and it's only two
hundred dollars so I'm definitely gonna
have to buy one of those because you can
actually get pictures like this of him
or so they claim so i had to find
something that was a little bit more my
kind of budget and this is what i came
up with so there's a infrared
thermometer which will read temperature
at a distance and this is a it's a was
it so mm x 10 6 14 and there's a
breakout board you can get again from
sparkfun which will give you the
information about the temperature that's
being recorded or being observed and so
I did a bit of research on that I found
that it hasn't i squared C interface so
I thought I'd use that originally but
looking at some of the posts that people
who had on forums and things like that
they said but with a raspberry pi and
the particular version of Linux it was a
little bit
to make that work but they've had a lot
of success if you just connected into
this ftdi board which basically takes a
serial input from the the sensor because
it also that cereal and then just
converts it into a USB so you can read
it over the USB connection as a serial
device and just get information from it
so i thought i gave what will use that
then because that would be a lot more
simple and so then we came to actually
writing code and i thought well okay
this is a java conference i should put
some java code on my slides and this was
something that was was kind of pretty
interesting for me because essentially
what the sensor does is it just gives
you a stream of data which is the
temperature that it's seeing at any
particular point in time and it does
that as a series of lines of text and
what you get is something like this 73.2
f so it uses this funny Fahrenheit scale
and I don't like the Fahrenheit scale
I'm you know European so i bought the
Celsius scale so i wanted to convert it
to that and when i look to this i
thought oh this would be really good
place to use lambdas and streams because
you know we can do that and this is what
i came up with as a solution to reading
the information and so I've got a
background thread that I run and the
thermal reader is just a bufferedreader
that i created to the serial port and i
can get the lines from that as a stream
that's all good and then i can pass the
answer map to double so i can use a
lambda expression today i want to pass
that as a string to create me a double
value and so I want to strip off the F
from the end of the string so remove
that the last character take that stream
parser into map so i can convert it from
this funny fahrenheit scale into proper
celsius and then what I only what I want
to do is I only want to react to changes
in temperature so even though is
reporting the temperature a lot I only
want to react to changes in temperature
so I'll filter it based on checking
whether the temperature has changed or
not and then I'll pass that into this
this wonderful thing called peek what
pig does is it takes a street and just
the input stream and pushes it on to the
output stream so it doesn't do any
changes to it but it allows you to look
at the stream as it goes past and so
what I wanted to do there was to a
listener to the fact that the
temperature have changed so to do that I
used an optional because that was
another thing that came in java SE 8
which allows you to avoid the problems
of null pointer exceptions so i use an
optional listener to say listener if
present then use another lambda
expressions who had a kind of nested
lambda expression get really good now
and so we said if we've got a listener
tell it that the temperature has changed
and what the new temperature is and then
we need a terminal operation to finish
off the stream and in that case we're
just going to do a for each and record
the temperature that has changed so this
is all good and when I wrote this it
worked which is wonderful because I like
that works however I kind of came back
to this and looked at again I thought I
have no idea why that works now can
anyone spot what's the potential problem
in that code no ok well the issue is
that it's actually in a lambda
expression you can only access an
external variable if it is effectively
final so you can't modify a variable
from the surrounding scope in a lambda
expression it's just not allowed same as
an anonymous inner class anonymous inner
class you can only access final
variables in the surrounding scope
lambda expressions it's kind of the same
but you effectively final so in order to
this I thought we'll hang on I've got
this current temperature that's an
external variable and I'm actually
changing current temperature in my lab
regression so how is it that that could
possibly work and it took me a little
bit of digging but the answer is is
quite clever what the compiler does is
it converts a reference to a variable in
the surrounding scope to this dot
reference to that variable so the
effectively final is this
which is effectively final so it doesn't
have a problem with that now clearly you
need to be a little bit careful about
using this in a multi-threaded
environment but in this case I'm only
using a single thread so it's not a
problem but it was something that kind
of as bees a java code it was kind of
interesting to see what was going on so
then it came to so I've got down my code
working so now we need to get into the
interesting bit which is how to mount
the sensors on the car so this is the
front of the wheel a notch front wheel
arch on my car and I thought what I do
is I put one sense of there pointing at
the tire so I can measure the
temperature of the tire as I Drive a lot
so I basically put it into the box and
then just clamped it onto the front
wheel arch so no changes to the car
those screws involved up holes that was
all good and then I thought I have
another one which I'll measure the
temperature of the brake disc so that
was a little bit more tricky because
what I need to do is Mount it somewhere
that it could point at the brake disc
from behind so I found there was a handy
suspension strut in the the wheel arch
and so I basically put a u-bolt around
that and then clamp that onto the other
thing and put the temperature sensor
there so it would point at the back of
the back of the brake disc is it a
little bit difficult to see from the
pictures because you can't really get
the camera in to get a really good angle
on this but you use these brake discs
there and it's kind of pointing in the
right brunt of the right direction then
we get into the like okay so so we've
got the sensors mounted we need to
connect those two our second Raspberry
Pi in order to get the data from so I
came up with this idea well there's the
space in the engine bay so i'll put my
Raspberry Pi use a couple of cable ties
strap it into the engine bay then I
could just run the cables underneath a
wheel arch get the USB cables connected
to my raspberry pi and then in order to
make it work what I'll do is I'll run a
cable network cable from the Raspberry
Pi underneath the bonnet and then in
through the window so I've got my
networked car
and I can obviously right power cable
Simon same idea so as you can see here
I've got I've got a nice little sort of
example and how that works and so that I
did run into a couple of issues one of
them was that my code had some bugs in
it so what I do is I wrote it a server
little server on the the second pie
which basically just listened on a port
for connections coming from the first
pie and saying give me the data and then
it would give it the data now I had a
bug in that which meant that when you
connected the first time it worked but
when you try to connect to second time
it wouldn't give you any data so you had
to restart the server every time I think
I will have to go back and fix that
because it's not that big a problem the
other issue I had was that because I've
got two devices connected if I booted it
up with both devices connected it wasn't
easy to figure out which USB port was
connected to which sensor so the
solution I came up with that was a bit
of insulation tape a particular color
boot it up with one device connected and
then once it's booted plug in the second
one and then know which is which so
that's all of that problem then I ran
Matt I gave it a test so I drove it for
about 10 minutes and this is where
things get kind of interesting because
one of the things I'd neglected is the
fact that the internal combustion engine
gets very warm so I've got a Raspberry
Pi mounted next to my engine and so what
I discovered was that after about 10
minutes in the engine bay got up to just
over 50 degrees Celsius which i think is
still with any working bounds of the
rods before my but it's kind of getting
to the point where it's getting a little
bit warm so that was after about 10
minutes so I needed a new approach I
needed to solve this problem as well I
couldn't have the Raspberry Pi in with
the engine so it's like how do I solve
this problem hmm we're actually pretty
simple longer USB cables is the answer
you just put the longer USB cables to
the sensors run those into the car and
have the Raspberry Pi in the car with
you then it's all at the right
temperature getting data from the can
us now if this was this was something
that was really quite challenging shall
we say so the can bus like i said is
really good because it's a bus
architecture lots of information being
sent through it and potentially look to
information that we could use in an
application now if you look at the sort
of socket underneath the dashboard of
your car which is this what's called
obd2 there are two wires there which are
the canvas so there's pin 6 and pin 14
will give you the canvas so I connected
to those I've got a little bored which
connects to the pie its called a pike
and funnily enough I connected those to
the wires on the obd2 port and then I
got no data so I was like hmm ok then I
did some searching around and the forum
said well you need to rebuild the kernel
with this bit need to rebuild the driver
with that bit and it will be very
complicated so I thought okay well we'll
try something else and the elm327 module
that I have before had a mode that you
could put it in which would just read
all the data from the campus so I
thought great we'll use that so I tried
that and I got no data so then I thought
right ok ok so I'll buy another thing
that connects to the can bus and so I
plug that in and I came with a cable
that plugged into the obd2 port set it
all up ran it no data so eventually I
figured I've got to look at it in a
different approach so I got the
oscilloscope out when I connected the
oscilloscope to the two pins and there
is no data on those two pins so all over
wires are connected the gateway which is
serving all the information is not
actually giving the data to that
particular part of the car and I believe
that's probably because the
manufacturers now don't want people to
be able to hack their car but it's it's
easy as a security measure because it is
possible to steal cars by hacking in
through that pork and doing some things
to the internal systems of car so I was
then faced with a problem so okay so I
can't get the cam
that way how will give to the can bus so
I went on to the internet again and had
a look around and I found somebody who
posted a very useful article which told
me that the wiring color for the canvas
on audi's is this so you've got three
different buses one for the power train
which is the engine that breaks the
steering and so on one for the
convenience bus which is all the
switches the windscreen wipers the
lights and so on and then the
infotainment bus which is your GPS and
the hi-fi system and things like that
and so if you can find the orange and
brown cable which is can low for all of
them and the one of the other orange
cables then you have the canvas and you
only need two cables because it's a
differential system so it measures the
difference in voltage between the two
wires rather than between ground or plus
12 volts so pop them on it and have a
look and found there's a little warring
loop down at the front of the car and lo
and behold this orange wires there so I
thought cool or in quiet so this is
where I kind of failed in my golden rule
because what I actually did was I got
the scalpel out very carefully removed a
little bit of the insulation off these
wires and then I wrapped some some wire
around that so I got a connection and
put some insulation tape around it so
aside from removing a very small amount
of insulation I haven't made any
permanent changes to my car so I
hopefully the disease company won't know
about this and then I basically put a
insulated connector on there so I could
then connect the camera system to it and
where I put the oscilloscope on it lo
behold I got signals so I was like great
I actually have a system that's got
connections to it and yeah and the car
still worked that was the most important
thing so despite having made some
changes it did still work of course
that's the easy bit actually getting the
electrical connection is the simple bit
then you go to start doing something
more useful with it so I use this USB
device that I bought
and again it appears a serial device to
the operating system and what I really
need to do now because i only got this
working last week is I need to now go
back on the right a Java library that
will use that information and decode the
packets that are coming on there so we
get both the the idea of the canvas or
device sending the data and the message
that's being sent but I used the little
application that they provide with it I
did prove to myself that I was actually
getting information from there so
hopefully in the future I will be able
to to do something interesting with that
so this is the the system in its
finished state on the Left that's the
inside of the the carputer and then on
the right you can see where I've got the
various sensors and bits and pieces all
sort of set up so that I can collect
data ready to to give you playback so
that was the the data capture system
talk a little bit about the the heads up
display because that was the other
project I kind of worked on this is
something that is also becoming very
common now lots of manufacturers are
looking at these kinds of systems for
future kind of cars and so this comes
like continental there's really there's
a mini cooper there there's your little
system on it jaguar doing some some very
impressive virtual windscreens and then
so there's a number of different
companies who are doing this so I
thought right I'm sure I could do
something like that so I my first
attempt was using a little micro
projector and a half silvered piece of
perspex and and that didn't really work
that wasn't so good because essentially
what i ended up doing was just getting a
lot of reflection off the projector and
ricci anything that i was trying to
project so that that wasn't really the
right solution so I did a bit of like
looking around and I found that probably
what the issue was that the the half
silvered perspex I was using was too
reflective I needed something that
transmitted more light and reflected
less so what ended up using was a piece
of glass
which goes into a teleprompter so when
you see people standing up and reading
speeches they use a teleprompter and so
this is the this is the the bit of glass
that I came up with so you can probably
kind of see there's reason that a
reflection but also quite a lot of
transmission and you can also see that I
used plenty of wood which is something
that's very important to all software
projects so this was kind of what I came
up with the idea of using a flat screen
that connects to the Raspberry Pi and
then having that mounted underneath the
reflective glass and transmission glass
so that you can actually project
something and still see through it so
that then brings question okay so how do
we make that work because of course half
the problem is that it actually has to
be in the image has to be inverted so
what you're creating on the screen has
to be the mirror image of what you're
actually going to see on the glass in
the car so this is this is what I came
up with is just a sort of simple display
I wanted to show the current speed but
also the the current speed limit and so
I found that with javafx you can just
use a reflection effect and by setting
the parameters so that you don't have
any graduation to it so you set the
opacity to be one you can get a nice
full reflection and then all you do is
just shift the whole thing up so that
you only get the half of the display
that you want which is the reflective
display and that solve that problem then
in terms of actually displaying data on
it what I did was I said okay let's use
the speed from the car that was easy
because I had the connection to the obd2
port which gave me the speed and I could
also what I wanted to do is use GPS
coordinates use that information
connected through the cloud into some
kind of server which would then give me
back the speed limit where I was driving
based on my position so I did some work
on this but I didn't quite give this bit
finished either so I got to the point
where i was using a mobile phone with
the Raspberry Pi through bluetooth I've
had the two I could actually set up a
network connection through my mobile
phone
and point it back at my IP address at
home I have set up a servlet on my box
at home and then opened up the
appropriate port so I could actually
send the information to the servlet and
get information back problem was I
hadn't then actually written all back
end stuff which would take the gps
coordinates and actually tell you what
the speed limit was so again that's
something that is a future project for
this particular thing and then the kind
of net effect is that this is the the
sort of result that I came up with so i
took this photo when it was dark because
that actually gives you a lot better so
the brightness is not really very good
for daytime it's alright if it's not too
bright but and so you can see I've got
the speed limit the speed of the vehicle
and then at the bottom is the idea of an
LED tachometer so the LEDs change color
and you can see how fast the engine is
going so then having recorded data I
wanted to do some data playback so let's
do a little bit about that before I show
you some demos so we collected lots of
data and I thought right so now I need
an application that will actually show
all this information in a useful form
and so I sat down and started writing
this using javafx and really the idea
was to say ok I've got a video stream
and I've got my data stream and now
they're synchronized because I've got my
my clapper board my piece of cardboard
so all I did was I took the videos from
the camera off the SD card edited them
using iMovie and then just found the
point where I'd removed the the piece of
cardboard and then cut the video at that
point and then just made that work data
I recorded as a sequence of texts
records so just use comma separated
values each sensor generated its own set
of values and just recorded each of
those I did it four times a second so
it's not fantastically high resolution
but certainly as you will see i think
it's it's good enough for what we're
actually trying to do maybe reading the
the information fairly straightforward
and I figured what I do is read all the
data in before I started running the
applique
originally I thought to myself oh that's
probably going to take quite a long time
so I'll probably have to do like a
progress bar as its reading it in I
generated about 15 minutes of data which
was wasn't actually that much in the end
and it took like 80 milliseconds to load
all the data so I didn't really need a
progress bar for 80 milliseconds going
very fast progress bar synchronization
issues so I felt myself right will
record the data four times a second so
that means that in order to do that I
need a thread dot sleep 250 so that
would work with nip yes well actually no
it doesn't quite work I'd forgotten you
see that the Raspberry Pi has to do some
work as well and it's not it's a good
machine but it's not blindingly fast so
I've kind of hadn't taken that into
account and it turned a it took about
six milliseconds to write or read the
data and write the data for every record
so my records are now 256 milliseconds
rather than 250 milliseconds not too
much of a problem because what we can do
is apply a correction factor during
playback so I've added that in and that
seems to solve the problem all I need to
do now is go back and solve the problem
source and measure the time between
record rights and then apply that
appropriately in terms of data there's
lots of information that we can provide
in terms of putting the thing together
so obviously the video with some
controls there's g-force data as the GPS
coordinates the altitude there's speed
and we can get speed both from the car
and from the GPS so we can compare the
two that was quite interesting what I
discovered is that my speedometer is
actually very accurate which I hadn't
been counting on because I normally when
I'm driving along ago oh well it's over
reading isn't it so I can comb I'm not
going as fast as I think I have the
police won't stop me no it's actually
very accurate so who need to be careful
than that what else did we have Oh
things like the bearing engine load fuel
pressure that you get from the
vd to air intake temperature coolant
temperature exhaust temperature high
temperature break temperature from my
thermal sensors throttle position engine
rpm and my heart rate so I wanted to
display all this information on the
screen and so what I did was I looked
around and what my good friend Garrett
here has done a lot of work on the job
jf extras project and so he provided me
with some very useful things in terms of
dials and LEDs and stuff like that that
I can include in there and where I also
if it'll be fun would be to do or the
sort of formula one style of display
where you've got the kind of combination
of things like the throttle position the
engine RPMs when the brakes being used
and things like that and if you look at
Formula One again you see that on the
top of the steering wheel to have this
row of LEDs that shows them the the
engine speed which was what I put on the
heads-up display as well heart rate is
not a particularly exciting number so
it's just like a number so I thought I'd
do some some interesting things with
that and tried and put some little bit
more in in there and so I did a sort of
pulse thing which you'll see in a moment
and that providing move a few challenges
in terms of having a number of parallel
transitions happening but offsetting
them by time so that took me a little
while to figure that out but I did in
the end so that that was good so just
before show you the demos a couple of
conclusions and some resources there's
lots of data that you get from cars and
so I think this is something that will
see more and more of in the future
especially through the idea of like
black boxes for insurance purposes fleet
management and those types of things as
I've already said and lots of actual
real-world uses for this kind of thing
so it is quite an interesting subject
place to go for more information
sparkfun as I say they produce a lot of
these little boards that have all sorts
of useful sensors on them adafruit is
another company that produces these
kinds of things obviously the raspberry
pi foundation for information about
raspberry pi i have a blog blog oracle
com / speak java and
my big goal for when i get back from job
one is to actually start blogging about
this particular project so i haven't
done any blog post for a while now but i
really do want to start getting this
stuff written up so people can see
what's going on and i will put all the
code up or github as well so let's
actually have a look at a couple of
demos so the first one I'm going to show
you is just really yeah this is just a
little video i did it's only 30 seconds
so you won't get too bored this is the
this is the heads up display in action
so this is during the day and so what it
sort of shaky because we were kind of
trying to accelerate quite hard now one
thing don't be alarmed by the fact on
breaking the speed limit because and so
this was just when i was parked at night
so that you could see that the system
worked better during the night so you
can see the tachometer there obviously
I'm not moving so you won't see any
speed there so it was just sort of
showing an action like I say don't be
alarmed by the fact I was breaking speed
limit because one of the things I hadn't
taken into account is that the speed
that I get from the car is actually in
kilometers an hour vs. the speed limit
the stone on there is in miles per hour
so this is the weird think we have in
the UK because we have both systems
right so then i will show you the
application that i wrote for playback so
it just takes a couple of seconds to
start up and there we go so this is the
the application i came up with in the
end and what we got here is a number of
different types of sort of numerical
information i did some little
thermometers to represent the the
thermal information from the different
sensors i also have included a map and
that there's one bit that's not kind of
working properly yet so i've got those
of the basic map what i want to do is to
then be able to track the position of
the car and overlay the information on
that but i haven't managed to get that
done yet the bit at the bottom right is
the the idea that sort of formula 1
style system and there's a couple of
bits of information I need from the
canvas to really make that work
obviously one of those
is the year that I'm in so I'm always
going to be a neutral for this
particular demonstration and I've put a
bit on the side there so you can tell
when the brakes being pressed as well
but just so you can see it in action
I've actually sort of added some the
buttons here so I did the very nice
little animation there to change gear a
couple of garrett's dials there for the
engine load and the fuel pressure and
then the bit in the middle obviously is
the video and a bit at the top is the
LED tachometer again so if I if I just
started running first thing it will do
is is actually sort of start because one
of the things is when you take the
cardboard away from the camera it
actually takes a little while to to
start up so this is just a recording we
did and so I added the little heart rate
pulse thing there so you could see the
how fast my heart rate was and you can
see the the engine load and the fuel
pressure changing and the engine rpm and
throttle position on the bottom there
GPS coordinates are not terribly
exciting unless you can translate those
into something meaningful I also put a
little compass bearing at the bottom
there so you could see which direction
that was going in and you can see the
difference in speed between the car and
the GPS hopefully just about to see that
at the top there and then what I also so
oh yes and of course we've got may be
able to just see the bottom right hand
corner of the video I've got the g force
sensor so you can see the acceleration
and braking and left and right G forces
that the cars being exposed to and and
then what I can also do is I can
actually just wind forward through that
and so again just like a bit of driving
around find some some country roads
where you can try and go reasonably fast
without breaking the speed limit of
course would never do that and then the
other thing i did was i thought well so
that's kind of interesting to be able to
see like real-time data as you're
driving along so the data matches what
you're actually seeing from the car
but then I also thought well let's let's
see what sort of the overall thing so
for example if i pick engine speed well
then say was okay let's let's do a graph
so you can see over the course of the
whole drive this is the variation in
engine speed and then you can also look
at for example throttle position so how
much so the variation in throttle
position the modern woman sorry yes yes
good although I mean to be fair we were
actually trying on this particular run
we were trying to get as much variation
in the data as possible if you look to
that out like a motorway that probably
wouldn't be anywhere near as exciting
and then of course the other thing that
we could graph is the drivers heart rate
and so we can see how my heart rate
varied interestingly enough at about
just over 11 minutes I became very
relaxed so I tell her what happened ever
and somewhere something something
happened at about just under 10 minutes
that push my heart rate up but I don't
know what that was it wasn't anything
else I needed to say about this I don't
think so um yeah so that was that was
really what I wanted to get across was
you know the idea of gathering data from
the car and then being able to play it
back recording it and really the next
step is sort of analytics and actually
taking this information and then doing
something more interesting with it one
of the things I've kind of got in mind
is to look at using like the opencv
library to do some analysis of like the
video so maybe picking up where you've
got other vehicles and maybe sort of
pointing out distances and things like
that but there's lots of ideas that I've
got for improving this project further
so with that uh nothing thank you very
much
I think I've got ya couple of minutes so
if anybody's got any questions yeah I
didn't look at that so the question was
about whether projecting on the
windshield rather than using a actual
reflective surfaces I did look at that
but it just the problem is it's too
transparent so you don't get enough
reflection you probably could do if you
had a very bright light source but then
you start running into other problems of
like oh I don't know how they do with
the systems that like Jagger are doing
because they obviously are projecting
onto the windscreen it must have put
some sort of coating on the windscreen
on the inside of the windscreen to
elaine allow them to do that but i did
try that and it didn't work very well
yes the glass well here in the US
there's a company if you just look for
what is it teleprompter glass they will
sell you glass like this cut to size so
this this particular piece of glass was
about fifteen dollars so it's just like
a six inch by 6 inch piece of glass that
they cut size for you fifteen dollars is
what it cost it cost me nearly a hundred
dollars to get it shipped to the UK only
in so much as the so the question was
whether Bluetooth was a problem with
communication link only so much as
getting the Linux configuration right so
it was a quite a hassle with the
different Bluetooth packages and things
and pairing it and making it work but
that seemed to work ok because I could
have the phone reasonably close to the
the the carputer and that seemed to work
ok ok look
yes I I did think about that in fact and
I went as far as buying because you
can't because this is a this is what's
called a tude in fitting and so I've
actually went on ebay I like eBay I went
on ebay and I bought like a plastic
surround that you could so I could
actually take out the existing infant
Ament system and then put this in as a
replacement but I just haven't got
around to it simply because I kind of
like listening to music and using the
sat-nav and things like that whereas if
I put my system in it wouldn't quite
have as many features so it's if but I
could do that in theory because it's
easy not take the whole system out and
then you could put this drop this kind
of in okay great well thank you for
staying till till the bitter end</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>