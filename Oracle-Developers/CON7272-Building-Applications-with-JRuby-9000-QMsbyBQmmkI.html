<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>CON7272   Building Applications with JRuby 9000 | Coder Coacher - Coaching Coders</title><meta content="CON7272   Building Applications with JRuby 9000 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>CON7272   Building Applications with JRuby 9000</b></h2><h5 class="post__date">2015-12-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/QMsbyBQmmkI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">my name is Tom this is charlie we
co-lead the JRuby project and between us
I think we have about 23 years worth of
work in this so we've been working on
this a long time for people who know
nothing about jruby our number one goal
is to be as compatible see Ruby as
possible for our current major release
our goal is to be compatible with the
latest version of see Ruby which is 2.2
but we still maintain our last
significant release which supports the
previous two significant releases of c
review be pretty silly for us to be here
if it didn't run on the JVM it's an open
source project you can pick which of
these three license you want to
distribute as most people pick the EPL
because its most permissive and as
you'll see later in the talk we
integrate really well with the JVM and
the Java ecosystem
so we had a hard time figuring out our
next major release number because every
number we came up with seem to conflict
with see Ruby and then we came up with
this joke let's just call it 9000 and it
was based on this dragon ball z video
which I don't think we're allowed to
play for copyright reasons but you can
go and search for it and the joke became
reality for people who don't know what
Ruby is I'm just going to go through
some of the basics of the language and
what I like rubies a single inheritance
base language just like Java rooted in a
common top type and there's some minor
syntax differences the constructor is
called initialized enough class name but
you'll see that we're still calling new
now instead of having special syntax
like Java it's actually a class method
in this class method calls allocate and
then it calls initialize on that
allocated instance and then returns it
but what's cool about this is you could
actually override new on a class if you
wanted to
there's almost no reason to do that but
it's nice that you can do it a big
difference for people coming from Java
is Yoon us that there's no type
declarations and that's because of Ruby
being duct-taped language the saying is
if it was like a duck and it quacks like
a duck then it better be a duck so if we
go and try to call swim on an object and
it's a duck well it knows how to swim
try to call it on an anchor not so much
you'll generate a runtime error a new
method or in you have to deal with that
so that seems really scary coming from a
statically typed language in practice
there's tons and tons and tons of Ruby
developers that right really large code
bases and no one's complaining about
this as a problem and in my experience
it's about as dangerous as actually
doing an explicit Java typecast then
when it comes down to it we all write
tests for our applications so we're able
to go and catch errors like this
incredibly fast not as fast as Java Sea
but i think that java sea provides a lot
of constriction and and the amount of
work to get around the type system in
places when things don't fit well so for
example you have some type and you want
to add a companion type like let's say
swap a list with a tree and you need
that to fit into your your existing
architecture and then you realize that
these two types don't actually have
anything in common so what do you do you
go and create an interface that marks
the signatures that you care about and
you Adam in well oftentimes the name you
don't have a good name for it because it
doesn't doesn't fit
it's not really an object and then it
gets even worse if you're working with a
third-party library because you can't
actually go and add an interface for
that library so then you create another
class and have it implement that
interface and then you use delegation so
there's some of these headaches in Java
that I don't think we think about over
time because we just get used to like
working around it when you have
something like duck typing you just add
those two methods you need and you're
done so this sort of problem just goes
away and in fairness I'll just say one
other thing about duck typing in a
statically typed language like Java the
IDE support is better you can go into a
foreign code base and navigate around if
you do a refactoring you know it's going
to work that's I guess that's duck
typing is sort of a double-edged sword &amp;amp;
senic tidings of double edged sword and
I think they're about even as someone
who does both commonly
well it's a long discourse and duck
typing much longer than I planned okay
um instance variables have a single app
signal class variables have to add
signals we do have a return statement in
rubies so that you can do really returns
but idiomatically no one puts that on
the end because the last expression is
going to be your return value closures
Java 8 now has closures which is great
I'll just go through this quick if we
look at the upper left hand side we're
calling a method called my open or
passing it a file name and then we're
passing it a block or a closure this
closure is just like an anonymous
function it accepts one argument called
I oh and then we can see inside the body
of that anonymous function or block that
it's getting one line if we go and look
at the definition of it immediately
below we can see that we open a file and
then we get a live I oh and then right
below that we yield that I all this
yield statement is saying I want to
invoke any closure that was passed to it
and then we hit an insurer region which
is just like a finely statement and we
close the i/o so there's two cool things
here one is that we get rid of this
repetitive boiler code boilerplate that
you see over and over again the code
where you have this try-catch more
importantly if you mess up and do your
try-catch wrong you just made a mistake
so closures are a great great tool for
improving the quality and readability of
your code quickly in the upper right
hand corner you can see that we have
curly brackets this is just another
syntactical form for blogs
all single inheritance languages need
some extra magic to deal with those
multiple inheritance sort of scenarios
Java has interfaces and ruby has modules
the most famous module which we'll use
as an example here it's called a
numerable it does every possible thing
you could ever want to do with the
collection and every single one is
written in terms of a single method
called each now the single method each
needs to go and accept a block and yield
every element in the collection to it so
if we look on the right hand side we
have our own custom tree class we
include innumerable we define this one
each that can give every element in the
tree and now all of a sudden we can do
every possible thing you can imagine
with collections like find a person
whose ID is 123
another big difference from Java is
absolutely everything in rubies an
expression so here we are in a class
body we have this hash map of three
colors and then using Ruby
metaprogramming we define those three
methods so it's pretty cool Ruby's an
open type system this is another double
edged sword at any point you can go an
add remove or update a method and do the
same thing with instance variables class
variables constants you shouldn't do
that most cases but you have enough have
enough rope to hang yourself but it's
very powerful and very useful at the
same time so Oh last did not least or
maybe it is least it's a pure
object-oriented language this is one
really strange thing with Java for me
that I wish had a language level
everything was exactly the same between
primitives and objects like if we look
at this bottom line here 11 dodd ? why
can't we call methods on a primitive it
makes sense to me so
alright so I'm going to run through a
quick little interactive demo just to
kind of show how you can play with JRuby
let's bump this up a little bit
so I'm going to use the interactive
console for for JRuby which is called
IRB or j ir b if you run an under jruby
and a gem that Tom road which is a nice
little Ruby wrapper around jmx ap is so
if the demo gods are happy all the gems
live out there on rubygems org we'll be
talking a little bit more about what's
out there in the community but we can go
and fetch these libraries they know
about their dependencies and they pull
themselves down now it's available for
us to use sort of like maven but it's
just a simple command and there's some
simple files you can use the download
these very easy to get access to all the
thousands of libraries in the Ruby world
so I'll start up jir be all right and
once I'm in here i can just require the
jmx stuff in now I've got access to the
jmx library that Tom made we're just
going to start a simple server on this
machine and I'll just connect back to it
alright so that's all up and going and
then jmx connect by default will just
try to connect to this JVM alright so
now that I'm in here I can get access to
any of the M beans that are available on
this GBM let's look at the memory one
and you can see every time he types in a
line it shows the return value and
prints it in a display format right so
it's it's all interactive it's all live
objects so we've got access to the
memory and being and we can see let's
see keep memory
usage used all right so right now this
is uh this JVM has about 26 mega stuff
in the heat right now and of course we
can pull in other Java classes as well
so this is a ruby rapper Ruby library
rapping jmx we can java import Java X
swing jframe will do that as well with
jig label I let's create a frame usage
okay we'll create a label as well some
bogus text in it for the moment
okay framed up content pain add label
very flexible syntax again you'll notice
sometimes I use parentheses around
method calls sometimes I don't and let's
do visible equals true and of course
this is j framed setvisible but we make
them into nice Ruby attribute set and
get just look like da equals or dot
visible equals and whatever visible is
true and it's going to hang out behind
there so we'll do another cool feature
of IRB is that it has a completion
library where it can look into whatever
object you're trying to call methods
against and give you a list of available
options so frame dot always on top
equals true there's our frame now and
we'll pack it so we can see the overall
size there ok now that labels a little
bit small so let's bump it up a little
bit font equals label font dot dr font
let's do like 40 pixels big and frame
that package
alright and now we're running the JVM
and unlike regular Ruby we can have real
parallel threads that are running in the
background they have threads but they'll
block each other they don't get as much
performance as we would so I'll start up
a thread and just have this update to
heap so thread new in in Ruby pass it a
closure and then we'll just loop on this
will sleep for one second every loop and
then label dot text equals memory memory
usage dot used
and to this all right that looks right
are these closed up properly here okay
there and so this is fun way that you
can play with libraries and see them
update live and see them do things and
play around with it a little bit you
know I usually when I want to play with
a new library I pull it down into IRB
load it up and you can even do like
require some jar for example require my
library jar no messing around classpath
is just available for you then so maybe
we've tried to make it as easy as
possible to play around with Java
libraries and to still have a good Ruby
feel and make it really interactive for
you I think that's it for me mm-hmm
although I was really impressed that was
a lot of typing all right what's next
year ah yes the next area so that's it
for the little live demo um what else is
there oh no just this oh ok yeah so so
we'll have tell you a little bit about
getting jruby we do have a windows
installer that can come either either
stand alone or with a JRE built into it
so anybody on Windows has access to that
if you are on any of the UNIX is there
the usual answer for Ruby folks is to
use our vm if you go to our vm do
there's a little bash command line you
can run that goes and fetches it
installs a ruby switcher into your
environment and then you can switch back
and forth between JRuby and see Ruby and
different versions of JRuby as well
makes it pretty easy to play around with
all the different Ruby versions
if you are one of the cave men out there
that just goes and fetches tar balls and
dumps them where they're supposed to go
we do have a full binary distribution
there's nothing you have to build you
just unpack it put the bin folder in
your path and you've got junior become
in airb gems all of that stuff is
available very easy to get at and then
of course we have all the maven
artifacts if you're doing it more on the
Java side pulling in G reviews a
dependency into an application we push
all of our we push our main JRuby plus
all of our sub artifacts as maven
artifacts too so so why is it not just a
jar why do we actually have like a
tarball distribution well the Ruby world
kind of does all their work at the
command line and so we wanted to make
sure that our jruby command line would
act and feel like regular Ruby we
support all the same command line
arguments we have a very nice
interactive console so all this stuff we
need to ship in the box and have it look
just like a regular Ruby distribution
you unpacked that tar ball and those
commands are all there and available for
you so one of the biggest use cases for
using JRuby in addition to just being
able to use all the Ruby libraries out
there is obviously writing java stuff
playing around with java libraries
bringing it up in the IRB interactive
console and as you saw in the demo it's
much lighter weight than writing it in
java there's no compile cycle that you
have to go through there's a lot of
ceremony in the code makes it much
easier to play around with libraries and
try them out
I already did this yeah so you were the
owners orders a little screw there all
right so we did that Tom's going to talk
a little bit more about how you can
embed jruby into applications now yeah
we can go both directions here and I'm
going to use a personal example it's a
library that I wrote that allows you to
make minecraft plugins using the Ruby
language you can probably tell from the
graphics that minecraft was written in
Java to it too edgy for java one okay so
um when you want to write plugins in
Minecraft you build it on top of a
library like spigot and you write a Java
plug-in so I thought huh I'll write a
Java plug-in and it's called Prague in
and then what it does is it loads
plugins written in Ruby here so this is
a fairly typical embedding use case but
I'm going to show you a video so
normally when you throw an egg you might
get some chickens to come out and every
time I throw an egg here I get a hundred
chickens to come out and this is from a
plug-in that I made and I got extinct
red obnoxious on this video
this is a great way to destroy your
server so here's the code in Ruby at the
top we're including a module to say hey
this is a pro this is a plug-in and then
we give it a name and a version number
and then there's this on and able method
this method gets called when your
plugins first going live and what you do
in here is you register commands if you
want to create a new command for the
game or there's all sorts of events that
you can intercept and do something
useful with in this case i intercepted
the player egg throw event and make sure
that's always hatching and then it's
going to throw a hundred chickens and
this is pretty nice it's quite a bit
smaller than the actual Java equivalent
but let's let's look at the actual Java
code for this I did condense this just a
little bit to make it fit on a slide but
it's not much more than this so the
first thing you need is you need a ruby
instance i'm using our internal
embedding API scripting container you
could have used java 6 scripting api's
to do this but I have no plans to
support anything other than Ruby and
there's a lot more power with their own
internal embedding API but you always
need a reference so we create one
the next thing that you'll typically do
is you'll go and load the main main Ruby
logic that you want to use and you can
call run scriptlet and give it an input
stream or a reader of the source code
that you want to be have evaluated in
this case I'm having it returned a class
that contains all the logic and then the
next thing that I'm doing is I'm calling
the method new on that class that was
returned and I'm passing in some java
objects to it now this is actually a
minecraft plugin in its own right so it
gets on enabled called when it loads and
then i use call method again to call
into the brains and let it know that the
ruby stuff needs to on enable so if we
just look at that ruby code we programs
already loaded all the ruby plugins we
walk over each one and then we register
those against the java plugin manager so
then again this is interaction of Ruby
playing well in Java it's it's
impossible to tell that that's actually
a Java object there but basically this
format is exactly the same every time
you in bed Ruby you get a runtime you
load a file or two and then you call
methods on live objects that you save
off into the Java code
alright so I talked a little bit about
how there's a rich ecosystem out there
there's obviously thousands hundreds of
thousands of developers out there doing
ruby stuff so we're going to talk a
little bit about some of the build tools
and tooling that you might be interested
in using from the Ruby world or how Ruby
is kind of helping the Java tools
improve over time so the standard Ruby
build tool that everyone still pretty
much uses in the Ruby world is rake it's
modeled after make of course so it has
the dependency management in the flow of
events flow of artifacts that it creates
but it is still mostly imperative it's a
big ruby script you're writing ruby code
and then putting it into to rake tasks
feels similar to aunt but with actual
scripting language in it that you can
use and it actually works really well
for jruby projects so we have a rig file
for part of Jay Ruby's build in fact you
have a very simple syntax a very simple
dsl here we're setting up a default task
is going to depend on build the build
task which has a description of build
jruby is going to call some compile task
maybe has some other logic afterwards to
bundle things up and then we're also
aliasing build to jar so you can do rake
jar and get the same result now this is
all nice especially you're living in the
Ruby world you get used to using rake
for all sorts of stuff as I mentioned
there's a you can do imperative code in
here so within these tasks is just plain
Ruby here we're getting a list of files
that we want to delete setting up some
includes and excludes and then iterating
over those files and cleaning them up so
here's how we can actually just right
Ruby code to do our delete or clean task
for this particular bill
now most you are probably going to be
using maven or Gradle for builds and
there's a Jay Ruby support for both of
those as well most recently maven which
is very verbose all declarative kind of
has a corset it defaults some of the
maven folks have been working with us to
add polyglot support specifically adding
support for Ruby as the build language
rather than XML there's now several
different languages Ruby's probably the
most mature in the maven polyglot stuff
there's JavaScript groovy etc any of the
other JVM languages can be used to write
your maven build and you don't need to
have the xml file you don't need to be
adding and editing an xml file anymore
URL here is the Kauri polyglot maven so
in the first off there's a simple way to
actually take an existing pom.xml and
turn it into a pom RB it's in the
documentation on that dakari link that
you'll be able to get these slides later
so let's take a look at a couple
examples here is however most maven is
just getting the basic things set up for
a project group ID artifact ID some
dependencies and so on you throw that
into the ruby dsl and it's obviously
much cleaner so here we've got our
application name we've got a link for it
the ID is group ID artifact and version
all in one it's going to be a jar
package and the jar dependency here is
much cleaner and easier to read than
that xml you're even able to add some
white space lines yep that's right
you're going to clean it up a little bit
so obviously a great improvement here
coming down from all the extra XML tags
here is a snippet from our own build
where we actually read whatever version
number we want to use out of a separate
file and use that within our pom Darby
so we can just run plain Ruby code and
that to build up our maven build rather
than having to do it all declaratively
or write plugins externally to make all
that stuff happen property is again less
verbose just do a simple mapping from a
to b dependencies you saw a little bit
earlier again boils down much much
simpler in this code and again they have
this for various languages but I like
the way the Ruby stuff looks it's very
clean here's a single plug-in that we're
using with in JRuby just to shade all
the dependencies into the jar and that
boils down to two significantly less
code too much easier to read pre shading
we're creating JRuby jar we're
relocating some stuff doing some
transformations all that and this is
actually comparison that when our build
runs the palm Darby every one of them
also spits out a pom.xml so that any
tools that don't recognize palm RB yet
will still have it work and that
generated pom.xml which is pretty well
packed down is almost three times larger
than the palm RB and character wise
easily twice as much so it's a lot of
crap to maintain inside those builds and
anybody who's had to maintain a maven
build would probably be happy to have
something a little bit lighter weight
okay the last little bit about this all
you need to do to a maven build to have
this is in dot mvn / extensions XML in
your project specify which of the
polyglot modules you want to use and
then you can use palm RB or palm that
groovy or whatever else
this is maybe 3310 and higher which
hasn't quite gotten out there into all
the Linux distributions and so on so
we're using another takari project here
maven wrapper gives you an MV NW an M
BMW bat that you can throw into your
project it knows how to go out and fetch
the right version of maven so anybody
can still build it even if you don't
have maven 331 on your system and Gradle
has something similar for this cradle
w/a talk later today at 1pm is going to
talk about this polyglot stuff and other
things that are going on within the
maven world so if you're interested in
seeing some of that you might want to
stop by and see Jason talk through there
we've been also working on support for
JRuby in Gradle how many folks are using
Gradle for bills a couple maven ok so
maybe is still up there all right so
Gradle is nice it's great environment
for doing builds but if you want to work
with JRuby applications you may want to
run some JRuby code you may want to
package up a JRuby application or rails
file so we've been working on building
some tasks and some of additional
plugins for Gradle to help all that fit
together so the base the base
configuration here in your Gradle file
applied plug in JRuby cradled up base
we'll pull in all the basic
functionality you need for it you can
have it executes some Ruby so there's a
JV exec that you can use within the
Gradle here we're doing we've got a task
that its sole purpose is to execute some
Ruby code we specify what script to run
what arguments to pass and so on you can
also just do this in more of a DSL form
with Gradle
Ruby dependencies can also be specified
so if you've got both Java and Ruby
dependencies you've got some libraries
that your G Ruby stuff is going to need
like rails for example just gems say
what what project you want it to be what
version it is these will all get fetched
for you and put in the right place for
your day Ruby application and similarly
you can do all that and have it bundle
it up into a single executable jar that
will have jruby all the Ruby libraries
all the Java libraries bundled together
executable on the command line and then
here's an example of actually doing the
govt jar with some default gems
specifying what the gem directory is
supposed to be how to lay it out it's
very flexible it fits into the way that
Gradle builds work and how jars are put
together also for war files of course
we're going to talk a little bit about
rails in a minute but you can bundle
pretty much any Ruby application web
application for JRuby in a war file
deploy it on a standard Java server and
it's up and going just like it's any
other application we've actually had
people sneak JRuby applications into
into the enterprise no one was the wiser
it's just a wire file some more tools
that you could use we actually do most
of our testing of JRuby using a ruby
framework called r-spec our spec is a
behavior driven development you specify
what you expect to come out of these
different calls having a nice
description of what you're looking for
and it gives you a nice output when you
have failures shows you what you're what
you're passing on what you're failing so
here's a little dummy class just adds
hello to whatever you pass into it
we can just Java import this into our
spec file so we're describing here we're
saying we're going to test the hello
library add hello method we're setting
up some prerequisites we've got we want
the library value to be a new hello
library object and then we specify what
we want that behavior to be so it should
prepend hello to the given string here
in the Ruby code expect library add
hello to equal this result expect
library at hello with nil to equal that
result write our code and then we can
print out all these specifications see
exactly which things failed and why
rather than trying to figure out why it
was an assert false that failed we've
got a nice description Ruby folks have
been using rubies are spec a lot more
for projects as time goes on if you want
actually run this in your build here
I've got an example with the polyglot
maven stuff about yes so we add a
repository that knows about Ruby gems
being out there we've got gem specified
here Ruby gems are spec 330 tests and
then a plug-in from one of our companion
projects r-spec maven plugin looks for
the spec files runs them as part of your
maven build and fits into the rest of
the year your build cycle and here we
see we've run it it pulls into our spec
stuff runs our examples and gives us a
result so you can fit it into any sort
of java application whether you're
building it as a ruby style thing or
whether you're with fitting into a
normal java environment we could do all
this stuff this this example showed two
dots because to expectations ran but
have there been an error it would have
combined the described and the it things
into a sentence and pointed out how it
failed so it has a really nice error
output right the air up would actually
represents what specified behavior to
fail so you can see what's really wrong
with it
alright take over alright so the thing
that made Ruby popular and continues to
make Ruby popular is Ruby on Rails so
we're going to go over it a little bit
the first thing you have to do is get
the ruby gem it's packaged as a ruby gem
which is the default packages for ruby
and it will get all of its dependencies
as well then once you have it in
addition to getting the ruby files you
also get this bin script called rails
and you can do a bunch of things like
create a new rails out so we're creating
one called Java one in the screenshot
creates lots of stuff and once it
creates lots of stuff then it runs this
program called bundler which will look
at all the dependencies for the root
Ruby on Rails application make sure that
everything's been downloaded and can
load so oh and i apologize i changed the
name here on the slide um once you go
and create a new application it creates
the directory at the same name and it's
entirely self-contained so at the top we
have a gem file which you go and can
update when you have new dependencies
that you want to add there's an app
directory for all your application code
I think it's becoming quite clear that
this is a model view controller
framework it is we can see there's a rig
file down there which Charlie was
showing you some reg stuff earlier and
you get lots and lots of commands right
out of the box rails server which is
just going to start off your application
we can do this right now rails Council
which basically starts up IRB like
Charlie was showing you earlier
just tons of stuff so if we do start it
up we see a really boring like splash
screen but we didn't do anything other
than type of command so that's pretty
good so one tool to get up to speed
faster this isn't meant to make finished
applications as is to run scaffolding
and what this will basically do is
create all your model views and
controllers for simple crud sort of
resources crud stands for create read
update and delete if people don't know
that um and so um ok model controller
views right Wow and something else
called a migration migrations I as far
as i know is a fairly novel concept with
rails it's a ruby dsl for creating
schemas and you know it's not new well
no no no i'm sorry it's it's novel
versus other frameworks now not new
right unique somewhat unique i was i was
waiting for you to say no every Java
framework hasn't now okay thank you Oh
it's it's it's a DSL for specifying your
database schema we actually got this
particular snippet for free from our
from our scaffold command that allow us
to go and define your tables and a
syntax that's decoupled from the actual
database you'll notice that the the name
of the file also has a day date and time
on it and that's so that you can roll
forward and backward when you're doing
testing if you've got a version in
production that's a different version of
the database these have up and down so
you can go back to a previous back to a
previous version of the database figure
out what the bug was and run your tests
against it when you actually run your
database migration it'll actually
generate the table for whatever database
you have configured so this is really
neat because you could use sequel 83 on
your laptop to use less resources but
then deploy to Oracle later and the
other thing when you first create the
model the object request manager for
rails and the models that generates is
called active record it literally only
creates two lines the name of the class
and that it extends active record and so
what happens is when your application
starts up it connects to your database
it looks at the name of this class
figures out what tabled is on the
database says what metadata do you have
and remember earlier I said that ruby
has an open type system so now that it
knows all this data that needs to add
methods for it goes and adds those
methods live including the ability to go
and save that record and find those
records so it's really quite cool but
you single source your data to the
database and you don't put it in here
unless you want to active record has
tons of features it has validations so
you can make sure that the last names
always said or that age is in a range
you can make up your own validations if
you need to it supports civilization to
various formats so if you want to dump a
record as JSON you just add dot JSON
onto the model instance just tons of
features in order to actually get your
model objects you have to use something
called active relation which is a
database relational algebra dsl sort of
like a link or something similar yeah so
if we look at this top example person
where last is Anna bow and where first
is Thomas it looks like sequel the cool
thing is until we call the first method
which requests that we get the first
record it doesn't actually execute any
query it just builds up the knowledge
that it needs to generate a query so
it's lazy and this is really really
useful so if we look down below it's the
exact same snippet is above but I save
part of the query to a variable and then
I use it later in fact this is such a
common thing that they added this as a
concept called scopes and an active
records so that you could save off these
useful partial queries into their own
concepts
I think it just reads really nicely you
get all these routes generated by
default when you go and create a model
in a controller crud crud based
controller I'm only showing this API
because you have the ability to go and
customize it if you need to but here's
all the default actions that you get
when you generate a default restful
resource which is what you make better
fall rails here's the controller it only
shows two actions so we find a person in
the database and then we respond with
that person which then sends it off to
the view a couple other things on here
is you can go and Taylor to specify that
if you if someone puts JSON unto the end
of the URL you can only perform these
actions so you can constrain that easily
views look just like JSP it should be no
big deal for everyone here the nice
thing about rails is they create tons
and tons of helpers the routes API will
create people pass so you don't have to
remember where to put slashes and stuff
like that and it's horrible to type a
href if I never have to type that again
in my life I'll be happy so there's a
nice helpers for
stuff not worth a whole slide templates
for navigation headers and footers so
you can put that in a separate file so
you have to put it everywhere partial
views for renting things that are in a
whole page but you want to use across
pages variance is actually fairly new in
rails oh but you can go and ask the
request and figure out that you're on an
actual tablet and mark it as a tablet
and then in your controller you can
respond to it has a tablet and it it has
a convention for loading the right GRBs
so it's nice and clean way in your
controller of specifying that you have
these different devices that you want to
render things differently to
okay so if we have our rails application
we want to deploy it somewhere so
probably the standard Java way is to
create that war file it's talking about
earlier and the library in the jruby
world is called Warbler and it comes
with a command warble which will
generate your war file pulldown all the
dependencies put things where they need
to be you can also customize the
configuration if you want to combine it
java application with your ruby stuff or
do a few other tweaks to the web.xml you
can also do that with the horrible
command a little bit more advanced
modern way of doing jrb deployment is to
use torque box a torque box wraps a
JBoss a s or the now wild wild fly stuff
with a bunch of nice Ruby wrapper ap is
a bunch of dsl's and has a nice set of
command line tools very similar to what
you would do with standard rails
development so we've got a wrapper
around the web of the servlet parts of
the system is using rack API from Ruby
we've got wrappers around the messaging
that gives you a nice Ruby API Ruby
configuration and so on so you can have
all the benefit of using wildfly as a
set of services that it provides but you
can pick and choose a little bit you can
run it as a little simple Ruby server
and it just ties in with rails and all
the services that rails provides here we
have an example of torque box in our gem
file we're just going to do a Sinatra
app Sinatra is another small web
framework for Ruby good for doing little
micro services and we're going to use
torque box web so we only want the web
component of this we don't need the rest
of the Java EE stuff we'll do our we do
our jemmons do our bundle install with
this gem file it'll pull down all those
dependencies and everything that torque
box needs to run and now on the right
side the config doubt are you that is
the rack up file so every web framework
or every web application in Ruby hooks
up to Rack it's essentially the quilt
their equivalent of a servlet API so
require Sinatra
if somebody does it get to the slash you
are I just returned hello world as the
response and then at the bottom runs
Sinatra application so this is an entire
working server entire working little
application here down at the bottom our
commands bundle exec torque box and run
it into a jar we bundle torque box JRuby
and everything else all together and now
we've got a little a little jar that can
just be executed anywhere we'll start up
a little micro service somewhere using
Ruby using all the libraries that come
along with this stuff that's pretty cool
so community wise we we've always felt
that it's good to have a nice language
language is important we try to make
JRuby feel as good as possible make it
fast make it well compatible but you
also need to have a strong community
behind your languages and in some cases
community is a much larger and more
important aspect for a language contrast
what ruby was like 10 15 years ago
before rails really became popular and
what it is now now there's a lot more
ruby going on Ruby's actually a one of
the top 10 languages so with JRuby you
actually get the best of both worlds we
get to use rails and other libraries
that folks have worked on in the Ruby
world and we get everything that's on
the JDM all the libraries that are out
there and maven and in Scala and groovy
and everything else as well so you can
utilize all that stuff by using JRuby as
opposed to just using job are just using
Ruby itself so some statistics here that
if anybody's seen the tob language index
they update this every month based on
search results job postings and so on to
try and see which languages are the most
popular the most interesting right now
and Ruby kind of waivers a little bit
goes up and down over time but very
recently it's back in the top 10 there
and it's interesting to note that
that Ruby is probably it's one of the
only JVM languages in in wide use that
even shows up in the top 10 we love our
friends in the groovy and Scala and
closure worlds but there's still a
little bit further ado I thought Ted
wells yeah Jeff on hey I don't know what
their statuses of these days though
another another metric is the job trends
on indeed this is just showing the
number of job postings and like the like
the tie OB numbers things go up and down
but there are quite a bit more
opportunities out there in Ruby than
there are for some of the other JVM
languages here but of course this is
also very questionable fact questionable
information here here we're also
comparing garbage too groovy Scala and
closure and apparently garbage is also
much more popular than the other JVM it
is so take these take these numbers with
a grain of salt talk about the Ruby gems
world in the community that's around it
there are almost 7,000 individual
libraries and of course many different
versions of each of those libraries over
time 6 billion downloads since
rubygems.org was was brought up a few
years back so there's a ton of work
going on a ton of folks out there using
Ruby gems writing new libraries and
building applications with this stuff
another good example is SAS which was
started out as just a ruby dsl ruby
library for doing CSS generating CSS
from ruby with a nicer syntax that came
from the Ruby community and it kind of
grew out of the Ruby community and
became popular and became useful for
developers and other platforms and other
languages very much because JRuby could
just run it can does anyone use sass
here that was a few fist few hands okay
a little quick example here we've got on
the left the this ass dsl for generating
the code we can specify variables we can
reference those variables elsewhere and
then eventually will generate the CSS
for us perfect syntax and all that a
nicer way to actually do set CSS and
again came from the Ruby world available
to you because of jruby almost of the
finish here we've got to just wanted to
show that there are a lot of folks out
that are actually using jruby for
applications of course we got some stuff
at Red Hat that we're doing a square if
you've ever used square anywhere to
purchase something you're a J Ruby user
and we're very thankful to have you
let's see these comcast the BBC of
election results for the past several
elections for the Scottish referendum
for parliamentary stuff it's all been
run through JRuby the results are all
presented by JRuby logstash the log
least stuff is anybody using log stash
yeah that's the jruby based application
so there's a lot of folks out there
doing stuff with this and they're
they're helping make our community
better and take an advantage of all the
work that we've done so we're going to
have them if you find this interesting
and you're interested in what the future
of jruby might be there's going to be a
talk later today 3 p.m. in Golden Gate
four or five on the other side of the
hall our friend Chris Seaton from
horrible is going to talk about some of
the research work that's going on to
make the next generation of junior B's
runtime pretty impressive results and
really high speed performance so that's
another talk that you might want to stop
by and I think that's all we have today
so thanks very much for coming out
it looks like we got about 10 minutes
for questions anybody rails jruby there
is no such thing as a dumb question oh
well but we'll go here first so in
general jruby is faster than see Ruby if
there's something that isn't faster we
usually hope people report that as a bug
because it usually means we're doing
something wrong on simple applications
small applications it can be anywhere
from 2 x 25 times as fast as the sea
implementation a lot of times it also
depends on the quality of the libraries
but in general JRuby should be quite a
bit faster than see Ruby and yeah so
Ruby on Rails the only thing that isn't
really faster is our active record our
model implementation takes a little bit
of a hit because we have to go up
through jdbc and then back to the
database it's a little bit more
abstraction there but in general it's
going to be at least equivalent to see
Ruby and you're going to be able to run
just a single instance of jruby rather
than having dozens of see Ruby instances
so to actually scale an application out
so we will it will get ahead generally
there one other important performance
thing to mention is that if your
application only runs a tenth of a
second we won't run as fast as see Ruby
right right so short scripts small
things at the command line will take a
couple more seconds than see Ruby but
once the JVM gets warmed up and and
optimizes will be immoral every time
any other questions oh yeah right there
this this this won't solve the problem
but do you know about dash dash dev that
pedal half that'll have the time on your
right wall clock about a year ago we
added a command-line flag to Jay Ruby
dash dash de Vie that will turn off some
of our internal optimizations our
longer-term optimizations tweak some JVM
settings and in general it'll be about
twice as fast to start up almost all
command line applications so that's
that's a big way to help speed stuff up
that makes it pretty much palatable for
most people other stuff that you can do
beyond that you know if you're if you're
running a rails application or doing
rails commands you can look at drip
which keeps a warm JVM in the background
ready to go and there's a a wiki page if
you search for JRuby startup time it
should be the top hit and it will give
you a whole bunch of tips about using
dash dash dev some JVM flags some warm
background JVM stuff nail gun as though
she said nail gun is still out there and
we still support it the problem with
nail gun is that if you have any
long-running resources like if anything
through spins up threads or has global
data that's in memory since that jbm
never goes down it just accumulates more
and more of that stuff so the drip
approach we've kind of preferred every
time you run a command it gets the next
JVM ready for you in the background and
you could have that load up your
libraries get everything ready to go but
it will actually shut down when you shut
down but yep all on the wiki so it
should be easy to to configure it and
get it going anything else yeah Chris
we
well so jigsaw wise there are a couple
things that might come out of that one
that they're talking about is the
possibility of a head of time compiling
sub modules that would be mainly for
their core stuff in the JVM but we may
be able to actually use it with JRuby to
get rid of some of that startup time
presuming that the jigsaw stuff the aot
stuff actually comes out for us on the
valhalla side if it's possible for us to
start specifying some of our numeric
types as value types in Java 10 or
whenever it comes out that would
actually help improve performance of
numeric algorithms we wouldn't have to
use as many tricks or did rely on as
many tricks at the JVM level 2 speed
those things up what was the third one
you mentioned Panama also Panama is the
the native access that'll be huge for us
right now the way that we were able to
provide such good compatibility with see
Ruby is because we do actually have a
lot of native calls we use native i/o we
use native process management so we can
actually do process management like UNIX
does rather than the horrible process
manager that we have on the GDK Panama
will make that built-in out of the box
and we'll get some better optimization
those calls will not cost as much less
jni overhead so it'll just continue to
get better and we're working with the
Panama folks to try stuff out to
anything else
yeah any opinions are metrics on like
the performance of uh get Jay Ruby Ruby
on Rails application versus like a play
framework application uh I don't have a
lot of metrics about it and it really
does depend on how much you're leaning
on rails magic like if you're hitting
active record stuff really hard it's a
very full-featured framework but it adds
some overhead on top of that as well we
have had people that have built smaller
applications and rails made like doing
just direct database queries and keeping
it light weight that can get you know
thousands of requests per second they
can get up there to the level that you
want there's a what's that tech in power
there's some guys that do some web
benchmarks of various frameworks and
they will include jruby rails they
include jrb with Sinatra and simple
applications and we perform well we
perform very well on those compared to
go and play and all the other frameworks
that are out there it really just it's
kind of a matter of how much of the
magic you pull in that starts to slow it
down
tekken power yeah so you can find that
they they do periodic results I think
every month or two something like that
the other end like round nine yeah
anything else
alright thanks everybody</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>