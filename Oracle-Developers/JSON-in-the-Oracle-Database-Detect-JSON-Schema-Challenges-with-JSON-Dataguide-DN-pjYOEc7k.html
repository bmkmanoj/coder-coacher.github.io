<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>JSON in the Oracle Database: Detect JSON Schema Challenges with JSON Dataguide | Coder Coacher - Coaching Coders</title><meta content="JSON in the Oracle Database: Detect JSON Schema Challenges with JSON Dataguide - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>JSON in the Oracle Database: Detect JSON Schema Challenges with JSON Dataguide</b></h2><h5 class="post__date">2018-02-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/DN-pjYOEc7k" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome to the fourth video on the JSON
data guide I will show you in this video
how you can get notified and perform
certain actions if the J's data guide
detects that your schema has changed in
this demo we start with a table to store
JSON data and we immediately create the
JSON search index and we enable the data
guide feature meaning the search index
will detect if new field names have been
added to the data and we add this new
Clause here unchanged add underscore EC
and that stands for if a change occurs
add virtual columns so we insert a new
piece of JSON our first row which has a
field a which is new because it's the
first row of this table so the Jason
search index works on commit meaning I
have to commit the change before the
jason search index scans it and now if i
describe the demo table we see that
there is the ID column and the json data
column which were part of our create
table statement but there is an
additional column here which is json
data
underscore a which is a virtual column
extracting the value of this of this
field here so let's insert another row
it has again the a field but it has also
a b field whose value is hello world
we have to commit it again so now if i
describe the table we'll see that
another virtual column has been added so
I can use these virtual columns to
directly query the data without having
to specify any syntax with Jason
operators to extract these fields I can
directly reference these virtual column
names so this is one possibility of the
data guide to perform an action
in this case adding virtual columns
whenever a schema change has happened
but what if you wanted to do some other
action maybe your own action this is
explained now in the second example
where we've write our own PL sequel
procedure
it's called schema change notification
and it takes the table name the column
name at the path of the new field that
got added the data type whether it's a
number or a JSON boolean or a string and
the value length so if we have this
information we build a string a message
string and we just write it to an alert
lock so this way the DBA could get
notified if change happens at the schema
another possibility here would be to not
write it to a trace file but instead
make a rest call and notify the person
or the DBA with a message so let's
create this procedure and we have to
rebuild the index to reflect our change
so instead of change virtual column we
say now if there's a change invoke
schema change notification and now if we
insert a new row which has a new jason
which has a new field name which doesn't
exist we'll see well I have to commit it
here and we see the JSON schema and the
table has changed new field is dollar
dot name so this is the message that we
generated here and that was also
outputted but we should also see that
there is a log file and if we open this
we see that the message also has been
written to a trace button so now maybe
the use case is a little more complex
that we don't want to get modified on
every schema change but only if certain
changes have happens for example if one
of our developers is adding social
security numbers or credit card
information into our adjacent
for this I've created a function which
is called is bed value it gets a string
and it checks if the string is credit
card number or a social security number
using the regular expression chair so
now we modify our schema change
notification to search for the value so
for this the data guide will invoke this
function bad schema change notification
it will pass in the table name column
name at the path and we use this to
build a JSON value query meaning we take
the path expression and we query our
table and column to find the newly
inserted values so we execute this we
get all the new rows the new values we
iterate over these values and whenever
one of these value is a bad value
meaning it's either a credit card or a
social security number then we build our
message and write it to the trace
flowers now let's run this and again we
have to alter our search index so that
it's invoking now the different PL
sequel press function here procedure so
now we insert fucki a field with a phone
number so this is the phone number value
and this is not matching the regular
expression of a social security number
or a credit card number so we see the
commit is completed without any action
but if I insert now a field whose shape
or the pattern is the one of a social
security number we should see that the
schema change gets now called we see
there is a new bed value so again we
should also see this reflected in the
trace file and there it is found a bad
value this is the social security number
obviously since these are plc equal
procedures you can write your own custom
code
you either check for values or for for
field names or you have a lot of freedom
to do whatever you want here thank you
for watching</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>