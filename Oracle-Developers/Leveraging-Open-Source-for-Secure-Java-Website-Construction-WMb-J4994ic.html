<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Leveraging Open Source for Secure Java Website Construction | Coder Coacher - Coaching Coders</title><meta content="Leveraging Open Source for Secure Java Website Construction - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Leveraging Open Source for Secure Java Website Construction</b></h2><h5 class="post__date">2015-06-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/WMb-J4994ic" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey good morning everyone thank you for
being here we're to talk about secure
software and building secure
applications with open source libraries
of the Java ecosystem and my name is Jim
Annika on one of the global board
members the OS foundation I'm really
stoked I just pushed out a book with
Oracle press called ironclad Java with
my co-author August Ellison and hey and
I've been I'm just a Java coder right
I've been slinging java for a long time
and we're huge fan of the language and
and I'm from Hawaii so Aloha to you as
well and I'm really disturbed that I
have an uncanny resemblance to Duke and
so I gotta admit to that and I tweeted
this out and so yeah a little bit too
much let's just move on and last night I
went to the Macklemore concert with you
know there's a Aerosmith and Macklemore
big fan of them and so I wear my way up
front so i can at least see the first
couple of songs right there like for
there from the from the band and then
for Macklemore and these two guys were
in the VIP area so you're all of us the
commoners were roped off into the non
VIP area and right next to us was the
VIP they had to front access to the
whole stage these two guys were in the
VIP area and I was like nose waving at
him like what's it like to be in the VIP
area and they're like will show you hang
on what's your what's your poison so few
people order drinks these guys went to
the VIP bar came back to the commoner
area and started handing out drinks to
us before security pulled them so what I
have no idea who these two VIP guys are
from the Macklemore concert but there is
them adding me a coke and bourbon I
don't know who they are but you are
kings
of men whoever you are we don't know you
were know your name but you're awesome
from the yeah that was my night last
night these got and so look I'm not
trying to pimp a book you don't make
money writing a book this is this is
really just a community of people who
worked on this book is what I really
want to talk about so this is me Jim on
the the author who got pulled in by
Oracle I immediately pulled in August
detlefsen who's sitting here in the
upper left-hand corner he's my co-author
I just kind of like sloppily spit out
all the chapters in August did to finish
work put code samples and to make it
really professional and this dude here's
Milton Smith he's the director of Java
security for Oracle yes the whipping boy
job he's basically had a nine tails
himself every day as the media
mispronounces Java security issues on a
daily basis but everybody wants Milton
to like be a tech editor for the book he
jumped into ours and he was more of a
co-author than just a tech editor we
were so we wouldn't be doing this
without him and we're all smart enough
to know that were clueless about
intelligent cryptography conversation so
we pulled in Kevin Keenan who's the
author of a semantic press book on
cryptography in the database and so we
we had great time doing this it was a
big honor to be a part of this so all
right let's get to work now I'm going to
talk about some of the main chapters
that we talked about and I'm going to
try to give you some helpful information
on each of the major category wherever
you're talking about security one of the
first topics that should come up is
authentication and before I get too deep
into these little subtopics I want to
talk about if you're writing
authentication code if you're building a
login mechanism login page password
storage system session management you
better have a good reason to be
doing so sorry you said you should not
be touching authentication code unless
there's a really good reason to do so
like you're one of the lead security
architects building this service for
everyone else or you've been tasked to
fix a specific issue but if you have a
large company and everyone's out cowboy
style writing their own authentication
layer you have a big problem usually
that you should either have a
centralized service or a centralized set
of libraries that have been well
well reviewed and there's good
documentation for the masses to use this
authentication layer in a repeatable
securely usable way so again warning
number one don't touch authentication
code or write your own authentication
layer because you know developers I know
hey so we have to build a login page
what should we do let's just write it
from scratch right am i right am i right
that's we all do but you better have a
good reason to do so you want that to be
a team sport architectural II thought
out okay so let's dive into one of the
risks here one of the main risks that we
deal with in an authentication system is
how you store a password there's been a
lot of misinformation about this topic
so even though for some of you it's you
know the answers already let's go
through it again anyways when you store
a password the main attack you're
worried about is when someone steals
your database in some way either you've
been injected and they pulled it that
way or a backup tape valve or how about
this who here is a DBA DBA are you a DBA
who here has access to their production
database at work come on bring it on
okay sir can I have a copy of that
database for ten dollars okay hang on
hang on how about 10 billion in cash i
have 10 million in cash 20 million in
cash nothing's it'll work i need to try
someone else who else is DBA we're up to
five mil for your production database
are you oh you're like cheeseburger in
five dollars on i kidding aside so your
database is now lost and the attackers
have access to your actual
authentication database and your
password storage it's now the clock is
ticking how long will it take for you to
detect that it's been stolen and rewrite
that area of your system or reset the
users password or manage the incident
before the attackers can use crypt
analysis or whatever tools they use to
brute-force your password storage and
they use that in some malicious or
publish it or what not to harm you it's
a race because there is no perfect
security when you store a password it's
just going to buy you time now what
attackers are using it's not even
exaggeration attackers are using super
computing capabilities to break your
password storage system once they've
stole
in your database they'll use a tool
called hash cat here's an old school
video game machine with like you know 15
video cards popped into it to give it a
lot of floating-point computation
capability just that in that and go and
it's a relative supercomputer doing
billions of hash comparisons a second we
have online hash services we have cloud
cracking services I saw one dude who is
just amazing he looked at all these
cloud providers what does every cloud
provider do to lure you into loving
their service they give you a free month
right that's a free month of computing
power so he wrote a system where would
automatically create all these accounts
on all these different cloud
architectures that gave you a free month
and combine that computing power to give
him a super awesome giant cloud service
that he used for free just a one-month
freebies he automated the whole process
I digress so number one when you're
going to store a password avoid hashing
use the proper kdf key derivation
functions these are slow one-way
functions we'll get to that in a sec you
also want to use a per-user salt random
and unique per user salt for every
single user this is less effective
against special kinds of tax going after
one account specifically but use them
anyways you want to have a good password
policy and you want to be using
multi-factor authentication so if you're
debating multi-factor authentication
stop the madness just implement it this
solves problems in security from 2004
and before that so Oh multi-factor is
not some sexy new feature it's something
we needed a decade ago so who here is
like debating ah should we do
multi-factor who's debating it I wonder
if we should implement multi-factor
who's debating it stop the madness don't
debate it just do it we needed to have
baseline good application security I
digress I'm sorry ok back to back to
back to this all right so we want to use
assault bcrypt s crypt or the ppk df2
key derivation algorithm those are the
only three choices you really should be
thinking about for password storage you
can use an H Mac in a specialized
situation we'll get to that so number
one allow users to give you joy
long passwords with any amount of
characters so if they throw a password
manager at your website and that
generates like a 200 character humongous
random password you should accept that
this is good responsible use don't try
to not accept certain characters for the
sake of defense that's always a bad form
of defence there's better ways to go
about injection protection and be
careful you got to have at least some
reasonable limit the de django python
framework they allowed unlimited size
passwords they were using one of these
adaptive algorithms and it caused like
one request to be able to denial of
service the whole entire like a 10
megabyte password will drop to django
before September of 2013 so 4096 bytes
is a nice large limit for password size
that won't hurt you now use assault if
we had the same password your password
is fluffy bunny one my passwords fluffy
bunny one with most protection
algorithms the crypto will look the same
so we want to deduplicate that so before
when you create your account I'll put a
huge random string 32 to 64 character
random string in your user table for
your row for your one user only and
before i protect the password i'll grab
the salt out of the user account and
then i'll call the protection algorithm
so even though you're fluffy bunny 1 i'm
fluffy bunny 1 r crypto the the cipher
texts are the hash of the password we
will look different because we each have
a different salt it also staves off some
rainbow table type attacks which really
aren't used anymore anyways next you
have the option of an H Mac proceed with
caution if you're going to use this this
is meant for super high scale where you
need to handle hundreds of thousands of
users logging and concurrently if you
don't have that need then don't do this
but if you're like a bank or a video
game that's one of the top video games
and you literally have millions of users
logging in in one clock cycle you want
to use an H Mac and proper isolation
this is a key derived hashing algorithm
it's um it's a Mac it's a it allows you
to not just hash a string but a key is
required to get the result in a
reasonable amount of time at least you
know before the Sun stops working so if
you have that key that's long and kept
protected so it's not exposed to the
attacker in any way then an H Mac is a
great
fast way to store a password but if that
key gets compromised this whole system
is broken so unless you have really good
key management really good key lifecycle
infrastructure you're using h SMS or
some kind of righteous data protection
hardware don't do this this is for
specialized most of you should be doing
this you should be using the worst
choice in the good algorithm family for
password storage is PB kdf to
password-based key derivation function
too so say it with me call and repeat
I'm going to say a word then you say a
word are you with me on this so
password-based key derivation function
to very few people can say that's a neat
little life skill so that's a good
algorithm choice but we got to make our
work factor one of the parameters for
this function here's an example this in
Java 7 so I can give it the password no
problem I can give it the salt 32
characters cryptographers say it can be
various a very small value make it a big
random value why not an iteration count
this is the the slow factor we're going
to purposely slow this algorithm down as
slow as we can tolerate then the key
length that we say the key length should
be the same size as the H Mac hash that
we're using under the hood so that
iteration count that's going to slow it
down why the heck do we want to slow
this down on purpose because when the
hacker steals this but there you know
hash cat super computer we don't want
them to be able to do five billion
checks per second we want we want to
slow them down to a couple hundred set
couple hundred checks per second we're
just going to slow them down so I see I
use like 10 million here when I can it's
really slow it's like an eight to 10
second delay on some hardware I see
people using like 500,000 the standard
says you should be at least using a
hundred and twenty eight thousand as
your slow factor and the higher number
you can tolerate the more security
you're giving it but this conversation
is horrible conversation don't depend on
this by itself oh and if you can get
away with it use bcrypt or s script this
is a much better algorithm it's I don't
see a really good implementation of that
in Java there's some there's some some a
few pokes have spit these out i think
bouncy has an undocumented one but this
is the best standardized way to roll
right now but if you can use bcrypt
arrest grip go for it's a better choice
all right but we should be using
multi-factor we should at least be
offering it and then within a few years
or if you're if you're like a banking
application or stock trading app or
you're managing billions of dollars
worth of IP or or financial value then
you should for enforce it some services
like banks force it even for a low
security service it's very responsible I
think to implement it as an option
anyways and one of the other
authentication workflows is forgot
password we have a cheat sheet on this
at oh ah spits the OS forgot password
chichi good name for it so we're going
to ask you to provide the identity
information we're going to force lockout
so you can't brute force through this
then we're going to send to token out of
band and then let you change the
password the key here is when you look
through this in more detail it's
mimicking multi-factor authentication
when you're allowing the forgot password
workflow to fire off so you want all of
your authentication endpoints to be at
least as strong as the main login point
that's why most banks are doing this for
forgot password another control real
authentication it's not used enough
things like when the users try to change
their email when they're trying to
change their profile data when they're
trying to change their letter and a
credit card or change their credit card
data make them really Kate and we see an
example of all these services Facebook
and Amazon and meet up making me provide
a password just in order to change my
email address and that's the right
security decision now this is a big
topic a lot of cheat sheets on this
topic authentication password storage
forgot password session management it's
and really be careful you surely
shouldn't be touching all that occasion
code unless you have a good reason to do
so so next let's talk about access
control I'm gonna go through this
quickly there are so many ways to do
access control this authorization we're
checking to see what the user has
permission to do within your system
they've already gotten in the front door
we know who they are we already
identified who they are we're now just
seeing what they're allowed to do and
the difficulty with access control is
that what is java what is the java
ecosystem rely on for access control
what pattern is the main access control
pattern in the Java ecosystem
say it what's role-based and I see
role-based access control primarily is
an anti-pattern those are tall words
that's a that's a big conjecture to make
but if any of you have ever done
multi-tenant applications where you have
like ten companies each within their own
domain in your application or how about
this have you ever written an
application before and a customer shows
up and they use your access control
system in your code then another
customer shows up and says hey man I
have a whole different set of
permissions and roles that I want to use
and you're like well our system doesn't
support that I'm sorry and they're like
well we're not going to buy you and
here's a lot of money if you make it
happen so you go make it happen now
you're like well if the customer is this
they'll let them do the check these
roles and if the customer is that will
check these roles or if the customer is
this check these roles and you are sol
at this point you have to touch code
every time you want to change something
even with an annotation you annotate a
certain role for a certain function what
if you want to change that permission or
what if you have ten customers who each
have a different set of rules and roles
in the same cloud architecture like a
Salesforce you're screwed so this is
old-school thinking I want to move
beyond that so all I just want to talk
about the enforcement point of access
control and that's what this is this is
the enforcement point in code we're both
my enforcement point and my rule engine
through the same thing in code this
makes no sense breaks a lot of core
rules of what good access control is
even though I'm putting up Star Wars
pictures to amuse you and so you know if
the user is a star wars video game here
if their users a Jedi or if the users a
pot of water if the users a Sith Lord or
if the user is a Jedi killing cyborg
robot General Grievous here then we'll
let them activate the lightsaber so
every time we have a new character come
into the game here like Han Solo uses a
lightsaber to open up a door we have
other types of characters and enter the
world is to change this code every time
it doesn't work that way it leads to an
unmaintained abyss 'tom so this is a
permission check this is enforcing
access control within a you know within
an application in a way where I can add
this code as an enforcement point but
it's not the rule engine the rule engine
is split off into a separate piece of
code
so it's the same kind of code here is a
user allowed to wield a lightsaber in
this made-up video game well if the user
is permitted to wield a lightsaber let
him do it but that's just the
enforcement point the permission check
the actual engine that looks up in the
database who this user is and what their
roles are and what their permission and
what their entitlements are so that's in
a different set of code in the database
probably so I can have a different set
of rules for all of my different
customers right that's the power of
permission-based enforcement points and
if that's all you do then you're a
leapfrog ahead in terms of access
control design because again you can
support multi-tenancy and you can change
the rules system without having to
change code that's the power of this and
here's a data specific check here we're
not only am i checking if the user can
drive this vehicle but I'm going to see
if they can drive the current vehicle
that they're in so it's not only can I
do a basic this is another reason why
role-based access control falls down it
can't handle check like checks like this
out of the box with with the way it's
implemented in the Java ecosystem so I
grabbed the Winnebago ID off the request
as a parameter and cast it to an int so
I know it's a number within my system
that's the Winnebago ID that I say is
the user permitted to drive Winnebago of
that number I can change the whole rule
system of this entire application
without having to change this code ever
again that's the power of a permission
based enforcement system so let's move
into the into the user interface now
cross-site scripting who here has heard
of cross-site scripting we all have
right what's the main defense to stop
this this threat to your application
output encoding that's the answer
because I want to talk about a concept
called perfect injection resistance when
you build your user interface what makes
up your user interface code it's a bunch
of variables at a bunch of markup
usually my goal is that regardless of
how those variables are populated let's
say we know nothing about what's
happening upstream we look at any UI
code and any variable and we assume that
any day
data can be pushed into those variables
we're still resistant from you I level
injection attacks like cross-site
scripting now we have perfect resistance
to do that we primarily need the we need
escaping and sir we need validation to
in certain circumstances we'll get to
that so you're both right encoding
depending on your arcade here's other
thing depending on your architecture we
may need to focus on a different kind of
defense the other thing is if you're
doing advanced JavaScript programming
then neither of these are good then the
answer is more using of safe api's but I
digress so cross-site scripting is when
the attacker can get attacker driven
JavaScript into your application so in
the when your body of your browser is
rendering this character it usually
thinks it's code it usually thinks
you're rendering the start of an HTML
tag we want to convert it to an HTML
entity so it looks like a less than
symbol but it's just display data not
code I don't think there's a lot of good
encoders in the Java ecosystem the
Apache want the yeah the Apache encoder
that a lot of people use in their
validation library is missing a lot of
contexts and j2ee won't won't include it
neither will do core java because it's a
web specific problem so um Jeff I
kanowski is a peach decompiler theory
student brilliant guy wrote this library
which i think is the best encoder for
java this is meant to escape data in
your user interface code so if
javascript gets to a variable in your UI
in some way you're going to escape it so
it looks the same but it neutralizes the
attack it turns the attack characters in
to display data characters so an attack
like this would it would show up on the
screen but it wouldn't actually execute
and this up here is stealing a session
cookie this here is just to facing the
whole page real simple stuff so the OS
Java encoder this is a one jar maven DUP
encoding library to apply escaping in
your user interface and Jeff the author
of this went hog-wild he wrote every
single possible unique context that he
can think of because we go depending on
where you put this day
in the user interface you're going to
need to make escape it differently if
you put it in like HTML you need you
HTML entity encoding if you put in
JavaScript space like a JavaScript
variable assignment you need JavaScript
hex encoding you put it in the XML
object you're doing some old-school Ajax
you want to use different XML encoders
so every slot in a web document will
require a different escaper so a couple
these are underlined like look at the
JavaScript family of escaping functions
I can escape JavaScript I can escape a
JavaScript attribute I can escape a
JavaScript block or I can escape
JavaScript source on the server so and
if you don't want to deal with all the
intricacies of these different encoders
you can skip these and just use the
parent here same in the HTML family in
the HTML family of HTML and coding HTML
content like for a text area HTML
attribute that's a tag inside of an HTML
tag or unquoted attribute where the
developers not using quotes in the
template system talk about a pedantic
topic but if you're building an auto
escaping template system then use all
these different escapers if you're just
writing code then just use the parent of
that family so I get away with just
using one two and I never do this I
never put I never need to CSS inscape I
never let users Drive CSS so I have
JavaScript escaping HTML escaping the
URI and URI component escaping I can get
away which is like four of these and I'm
usually okay so here's a couple examples
of the Java encoder in place some
simplistic examples just to give you an
idea of how to use these in different
contexts here I'm just putting data at a
bold tag or a nappy tag in code for HTML
next I'm doing a text area so it's in
code for HTML content if you want to
again let's get back to perfect forward
in a perfect injection resistance I'm
writing this code so i don't care if
it's a validated or not I don't care
what's happening upstream because I'm
robustly escaping all these dangerous
characters it doesn't matter what input
gets to my user interface if I encode it
properly no javascript is ever going to
execute with this variable because of
how I'm escaping it we can do it for
HTML body HTML attributes where I'm
inside
value tag like from in my code I
actually write this code or August wrote
this code we do it once in a reusable
component escape it properly and get
everyone to use that component so it
auto escapes properly here we're dealing
with a URL fragment like a I want to
encode for URI component and code for
URI component that's the proper name for
this function I asked Jeff to change it
to for URL that's the common convention
other encoding libraries used and he
said no okay it's his library so uh
validate and if you want to validate a
URL like if you're a Twitter and someone
tweets you a URL you want to check to
make sure it's proper URI you want to
make sure it's absolute or relative base
that what you're trying to accept then
you want to make sure that the get user
info is empty that's just that's just
looking for trouble we have no idea what
this is really used for legitimately
this then we check if it's HTTP or HTTPS
only a JavaScript URL will execute as
raw JavaScript and then we normalize URL
and now we have a legal URL so this it's
actually quite tough to validate a
normal URL this is our mechanism of
doing this so if someone sends me a
tweet what do I want to do I want to
take any URL and I want to make it
linkable that's a tough thing to do so
sir I first validate to make sure every
word in that sentence is or is not a URL
ones that are URL and match this code
properly I still don't trust it I want
to escape it so I'm going to make a link
and that URL I put in the href body I
Satan code for HTML attribute and for
that URL but I put as the display data I
say encode for HTML content this is to
surgically encode it as minimally as
necessary and if you don't care about
that but you still want to be secure and
safe just use for HTML for both of these
and you're good to go here's JavaScript
escaping where I'm putting data in an
alert box or I'm putting data in in the
middle of a button press or whatnot we
can do javascript escaping in these
contexts if you're going to put data
into a CSS value you have these CSS
functions so there are some situations
where escaping is not going to be enough
when you're trying to protect your user
interface like what if the user gives
you a chunk of HTML
should be using markdown but it's not
available in every architecture so
here's the tiny MCE component everybody
anyone here use tiny MCE before what
does tiny MCE submit to your server in
the parameter it's a big chunk of HTML
so how do you validate that an arbitrary
chunk of HTML that was sent from the
user is secure or not so can someone say
validation just so i can pick on you
sometimes a validation okay thank you
you're good man I appreciate it so can
you write me a regular expression that
will arbitrarily parse a chunk of data
that claims to be html5 and return to me
the safe subset of that input no bleep
in way that's not what a regex is for
but the answer is validation you're
right or the answer is sanitization in
the same family of validation here we
have the OAuth HTML sanitizer this is
like there's a couple libraries that do
the same thing owasp anti Sammy there's
also the J soup HTML sanitizer J soup is
Dom based which means it's slow it's not
going to perform under scale anti Sammy
is decent library but it's not being
maintained anymore so Michael Samuelle
from google he's the app tech engineer
or the lead APNIC engineer from google
he dropped this project on us which
takes arbitrary HTML and returns a safe
subset so I can build up a policy in
HTML I'm allowing a tags I'm allowing
lakes with these attributes anything
else will get stripped out any other tag
will be stripped out and I can now
safely render this to every other user
in the system without XSS so same thing
here's another example of that here's a
more complex policy where I'm allowing
divs I'm allowing different h tags I'm
allowing class with different names
within that list so I can build a whole
bunch of policies and now I can build a
policy for tiny MCE for whatever widgets
I'm accepting there we get the HTML we
run it through the sanitizer validation
engine whatever spits out we can now put
in the database and then safely save to
every user so XSS defense is tough a
combination of validation a combination
of encoding a
combination of safe use of JavaScript
will tell that story another day let's
go to our next topic cross-site request
forgery and click jacking this is
basically transaction protection so
we're we're about the halfway point
right now so we're going about half an
hour or more so far so good just take a
little you know little little breather
for a moment take let's take a little
sip of water maybe one sec here so far
we doing okay so far so far so good
right on can I get a selfie all right
let's let's do a self actually a quick
break let's do a mid show selfie are you
with me on this come on we're geeks come
on sorry but can I get some like can I
get some love from the audience here
just like hands up yeah thank you so
much will push that out will push that
out all right little selfie break all
right so cross-site request forgery and
click Jackie this is transaction
protection so this is my favorite one
this was so rude this is like the first
recorded major CSRF attack against
netflix is a DVD ordering system I
didn't see and melton give me a
high-five high-five Milton everyone take
quick quick break we have Milton the
director of Java security I'm honored
you're here hello Milton hi Milton so
Milton Netflix is a sad story so this is
a this is an attack that was hosted on a
third party website so this is not
hosted on netflix itself is hosted on
some evil website or even worse someone
hacked a movie review website a popular
one like Enoch cool news gets a lot of
traffic by movie movie like earth and
they put this attack code there let's
see what happens so if you go to Netflix
and you can log on and you can say
remember me that keeps you logged on for
months at a time if your boss ever tells
you to do that you just say no and if he
insists just save the username but don't
fully save them being logged in and just
don't tell your boss you're done don't
don't explain it to them so don't ever
like actually save the user so they stay
logged in for months at a time that's
the antithesis of good security you do
want to keep away from that I digress so
this code your log to the netflix you
visit some website that has this code
and we started the body here it's going
to load
an image but it's not really an image is
to get requests out to the JSON API so
loading an image and making a get
request like typing in a URL the same
thing basically so it's a height one
with one image you can't even see it one
pixel it's going to automatically add
movie 701 1067 to to the queue and then
we so that's now at the bottom of your
DVD queue this then waits two seconds
and then we call load image 2 which is
load image too there's the image object
and then move to top 70 110 672 and so
this is a two-step attack that if I'm
logged into netflix i visit this code on
a different web page i'm logged in i
have an active session cookie it doesn't
matter where the request to Netflix is
initiated my cookie is always going to
be attached to that request if I'm
logged in as long as it's over HTTP owns
over the right protocol that that cookie
is supporting and so this movie which is
a basically gay pornographic material
not say anything wrong with that your
choice but to little kids and having
this dump in in the Midwest mothers were
not ready for this when all of a sudden
thousands of copies of soft gay
pornographic material landed in their
homes and so that's what this did you're
logged in it adds that movie to the
bottom of your queue then it gets bum to
the top of your queue and then gay porn
exactly so sorry mom so Reese and and
recent other attacks so that what
happened to gets Netflix it is kind of a
reputation hit to pet a it didn't damage
the brands they fixed it right away they
broke a few clients to fix it they fixed
it and now we talked about it in
security circles once in a while when
musing about the past but netflix is
still crank and making some good bucks
this attack really freaks me out though
this is an attack against a home router
where who here has who here has a home
router everybody who has a web console
to administer your home router who's
actually going and updated your firmware
and changed your password almost knowing
the room everyone else just just go boom
they'll fix it nada soon as you get home
go log into your home router update the
firmware and change the admin password
to be something very strong you promise
me you'll do that when you get home all
right thank you thank you that one
person humoring me so
this is an attack against an unpatched
home router so we host this code on an
evil website and while the user is home
behind their home router they visit this
webpage which makes a request to 192 168
1 dot 1 hmm what's that address your
home router web administration console
it's running the password cgi which
number one it's vulnerable to freaking
shell shock and now I can one hit do
command injection remotely on your
router and you're done that's besides
the point but this attack also we can
change the password here without eating
the original password and without being
authenticated to the system in the first
place so this is like you can't write
this more insecure unless you post the
Edmund patter when I hit the CGI it's
basically what they're doing so it
changes the password to be a known
password by the attacker now the
attacker can just shell into the router
or issue any other transaction command
like changing dns and that's what they
did the attackers change the dns so it
would be they changed the dns so it
would be a it would change bank of
mexico to an attacker domain so you can
steal passwords so the way you fix this
is with csrf cryptographic tokens and
and you really need to get cross-site
scripting correct if I can ever inject
JavaScript into your website then any
defense against request forgery is
circumvented oh so you must get your XSS
bulletproof and then you must have
cryptographic tokens and these are built
into most infrastructure are most
frameworks these days Spring has their
own interceptor that does adds random
tokens to every transaction struts has
had this since 0800 Asif as a project
called the CSRF guard project and the H
div add-on security framework also has a
mechanism for this and it's really easy
you generate a random tokens ticket in
session and that random token to
everyone's form as a hidden variable and
verify that that session and form
matches every request
so I'm not sure off top of my head i'll
give you my email at the end I'll look
it up it's pretty easy to figure it out
but I believe it does or at least it's
easy to pull off to add it you're going
to add when the user logs in push a rant
a large random value to session whenever
you render a forum for the user that's
sensitive that you don't want to be
faked out take that value from session
unique for every session right and you
put it in a form as a hidden variable
whenever someone submits that form to
your server grab the value from the form
grab the value from the session if they
don't match don't let it go it's really
easy to implement on your I like to do
it by hand I don't like using a
framework I want to do it by hand so I
can control it more but this is easily
support at the framework level we also
have clickjacking I'm gonna jump head to
make up little bit of time make sure
you're using X frame option headers same
origin this is an easy header to add to
every page which tells another domain
who's trying to load you in a frame that
your debt that they're not allowed to do
that and most browsers support this
header very well so this is another
there's about six or seven headers you
should care about things like strict
Transport Security X frame options
content security policy there's a series
of response headers that are relatively
easy to add to your site to add security
that's enabled at the browser you should
have this something you want to study
very carefully I say with respect so now
protecting sensitive data coming to the
finish here we usually want to use AES
for cryptographic storage and by default
Java uses ECB mode which is a mode of
AES that's basically plaintext we really
want to use GCM mode it's not available
everywhere so we're usually going to use
CBC mode which is widely supported you
want a unique IV per message like
assault don't forget to get your padding
right you also got the deal with key
storage and key management and you're
just Scott confidentiality when you see
bc so don't forget to H Mac your cipher
text to gain integrity and you really
should derive integrity and
confidentially keys from the same master
key source and don't forget to generate
a master key from a good random source
and good luck with that good luck
because this very few get this right so
if you're worried about IV management
you're focusing in the wrong place i say
with respect don't write your own crypto
people tell me I'm an expert about this
and I'm not
student like you are and I would never
write my own crypto code values keys are
we and this conference I see a lot of
different instructors singing the same
song this year I thought to other talks
mentioning this this is a good thing and
feel boring for you but this is good in
that those of us who are talking about
security our advices is becoming similar
which it should so this is the only
library in all of computer programming
at the web level that actually does
crypto right the only one in any
language across the entire web
infrastructure framework of family do
you have NaCl which is a sea library
you're not going to use that in your web
application probably tomorrow but this
is dialed in and the only thing it
doesn't do for you is key management so
where you put the keys be either a
really specialized area in storage that
you're protecting or even better do all
of this in a separate service have a
separate lockdown service that uses keys
keys are to do your storage you store
the keys on disk which keys are does and
isolate that service and only allow
simple request to it to encrypt and
decrypt data so the keys are never in
your application the keys are held in
the keys are serviced so more on that if
you have any questions the other thing
is encryption in transit we want to make
sure we're doing the advanced practice
of using TLS 1.2 and above and you want
to be using ephemeral cipher Suites yeah
ephemeral cipher suites are you with me
yeah thank you strict Transport Security
and certificate pinning when you can to
detect if a certificate authority is
compromised and gives you a valid but
Ford certificate make sure you know what
pinning is use it anywhere you can you
can't trust the ca system it's a joke on
a joke with fraud and more joke and
don't depend on it so this lets you
detect when cas go bad which is more
frequent than we would like there's also
perfect forward secrecy when you're
picking your ciphers for SSL make sure
you use one with an ephemeral cipher
suite so the key on your server is not
the key used for encryption that's
ephemeral and it keeps changing there's
also injection I'm talking about a
sequel injection attack even when you
validate we can still blast through some
validation layers still inject upon you
when you want to deal with sequel
injection and proper
there's only one technique and that is
how do you stop sequel injection in Java
with ya if this is news to you in 2014
I'm concerned with respect I'm concerned
and we this is the number one most
damaging attack that will hit your
system it's the easiest to exploit and
you must always code this way in all
situations so there's something if you
haven't seen this before McQuarrie
parameterization is study this carefully
make sure you use it everywhere it's
secure coding item number one so in the
book I only wrote ironclad Java the one
area that I didn't know as much about
was the file upload oh come on up for a
sec if you don't mind this is August
Atlas and co-author of ironclad he wrote
the chapter on file i/o and file upload
which is one of the more complicated
chapters in the books I'm really proud
of the work you did there and he wrote a
problem when he telling about this good
afternoon everybody so when we went to
look for means of doing safe file i/o
and file upload in Java we found that
there weren't very many or any good open
source libraries for doing this there's
the isapi enterprise security API which
includes functions for doing safe file
i/o but that is kind of a hassle to use
it requires configuration it has a bunch
of dependencies so but as we were
writing a book we actually decided to
create a new project on owasp to create
a safe file upload file i/o API using
Java that would give you all these
functions in one simple jar file with no
dependencies so by all means check it
out if you have to validate file names
validate file uploads this is the way to
go the problem is in hang up here for a
second in all the different native java
file i/o functions if you do something
like dot dot slash and do path traversal
they always accept that the Java API is
don't see that as a problem but when I'm
building a web application and I'm doing
some kind of internal file i/o like you
give me a an ID and I look up a file and
I take the ID and maybe I put it in the
file path and you change the ID to dot
dot slash your now negotiating the
operating system lower level file system
so we want to file API that never
allows you to do that Jabba can't not do
that it needs it for other actual good
functionality so we're not we August
wrote a layer on top of the Java file
i/o system that makes a lot of these
features impossible making it a great
way to do file i/o safely within a web
container so this is emerging project
being worked on here let's talk about
the last half work together next let's
do in tues detection this is just the
the last one here let's go to the next
slide this is a the goal here is when do
most of you figure out then your
applications have been hacked right when
did the target executives find out that
that their target applications had you
know the largest credit card loss in
history at that time when they saw it on
the news yeah I'd like to know the
moment an attacker begins prodding my
application I want to know right away so
I can do something about it here's a
couple quickie techniques that you can
use to do that so how about the first
one okay so we talked about input
validation before and how that's not
sufficient to protect against XSS what
input validation is good for is a means
of detecting whether someone is probing
your system so if you start to see
characters that might indicate an XSS
attack and your input that will tell you
right away hey someone's attacking me
let's shut them down and there are some
frameworks that let you do validation on
the client in JavaScript now how
difficult is it for an attacker to
circumvent your client side input
validation how tough is that that script
kiddie stuff it's trivial do that you
disable JavaScript or you know you
override the JavaScript in the response
it's trivial but here's where
client-side validation is good if you do
client-side validation really well how
much server side validation errors
should you be getting if you're doing
client-side validation well how many
server side validation errors should you
be seeing none not so if you do really
good client side validation all of a
sudden they're getting a whole bunch of
server side validation errors this is a
sign that you're being prodded or
someone's turning off javascript or
circumventing your client to attack your
service directly there's intrusion
detection technique number one number
two think about an immutable field like
a radio button go ahead so a radio
button is something
that will have only a couple of
different values it can be you know you
can choose are you a great Java
programmer yes or no as your values that
will be choose about by a user and at
your server you should only see yes or
no in the request yeah is it even
possible for normal user using a
radiobutton group to give you a
selection outside of that radio button
group is that possible for a normal user
no it's not even possible for a normal
user but as an attacker I'll use a
intercepting proxy to intercept data
that left your browser and put
additional attacked attempts in it so on
the server if I'm expecting you to
pre-processing a radio button and I get
anything outside of the legal list of
values then I'm under attack so this is
these are super simple to implement this
is all of you only did these new things
you've been great we're almost done
let's do one more this is my favorite
one this is a you know that this is
getting a little offensive back to the
hackers a little bit so I go to
robots.txt and let's keep it between us
don't tell too many people about this
right so first let's go to robots.txt
and let's say that / admin / super
secret login JSP that search engine
should not index that you're not allowed
to index that now imagine you're a
hacker and you see my robots file and
you see do not index search engines for
super secret login JSP what does every
hacker have to do now they can't help
but they're gonna go and check that out
so when the Rope when the search engines
hit it I just show the login page when
the when an attacker hits it nice all I
see is a login page with the submit
button username and password and they're
gonna they're going to mess with it and
so anytime someone hits that it's got to
be an attacker so I don't like this this
login system up to any other part of my
system except through the robots file
which says please don't index this this
is a honey token it's not meant to be a
real feature of my application it's just
meant to give me an alarm when some
hacker hits it go ahead two slides is
your favorite slide we are done I really
appreciate you taking time to be here
August thanks for hanging out with us as
well up here any questions my name is
Jim Annika i'm at manna code on twitter
i'm jim at monaco
net no basically a secure coding
instructor I hope this was a value to
you in some way Aloha I have a great day
thank you so much everyone cool yeah
we're done okay question answers do I
have time for a few questions go ahead
question go ahead yep yeah you need to
be behind your router at home and then
go visit an evil site that has this
attack hosted on it then that attack
then gets rendered back in your browser
and then the attack launches from your
browser when we look at 192 dot 12 GA
that one dot one from right here where
it's some local network device on this
network when you are home and you get
that same exact page 100 you once you
get one dot one that's now your home
router and I can trick you into making
requests to your home router from your
house with this particular attack type
there's a browser called aviator that
will turn this feature off in the
browser it's worth looking at for
consumers exactly so i could make 20,000
attempts in under a couple seconds right
that's just showing you one I'll just
try one in one is that one not two not
three I'll just try and submit to every
single one and all 256 addresses and the
one or two dot one sixty eight dot one
subnet I'll get to you and that now that
I'm up to 512 request you know well or
not rebut i ah most home routers are 192
168 1 dot one that that get me 99 plus
nine percent right there yeah exactly so
yeah change yours to a different number
if you can I won't do any harm yes sir
so password policy the most important
thing you can do is don't allow users to
submit commonly used passwords go submit
top ten thousand passwords in 2013 and
do not let your users use any of those
that's the most important policy you
want to implement pass password hashing
is not good security never do that oh um
you can take the current hash and then
run pbk df2 on top of that but if anyone
ever stole the original hashes they
still got you so you trigger the you the
best is to trigger the user to reset
their password and that reset time then
apply pbk df2 or bcrypt or s crypt at
the change password time that's the
preferred way to do it but the problem
with that and that's usually okay but
the problem with that is if the hashes
were previously leaked or if the hashes
aren't storage and leak three months
from now you're still compromised so
that's the trait but that's a reasonable
approach but that's the trade-off
exactly what was your question sir I'm
sorry they may change the time at last
minute ami it's 1245 20 I got 10 more
minutes oh well I had they changed it at
last minute on me so I'm thinking 1230
we're done um I'm sorry I'm sorry about
that but we got a we got a condensed
version today any more questions I'm
sorry slideshare.net / Jim manic Oh Ji
mmas though will they be up on the job
of one site as well
ah that's the way I'm to distribute them
if you want them early i'm jim just hit
me up on email I'll give you a PDF of
questions sir I don't have a
recommendation for a consumer but
there's a lot of like cnet reports that
have done comparison I'd go there
they're smarter about that question than
I am but there's a lot out there now yes
sir single page JavaScript applications
the big threat that comes up is
cross-site scripting in those frameworks
so your goal basically is when you're
populating the Dom with untrusted data
or any data there's only two functions
that are safe dot Val or the dot Val
variable and the dot inner text variable
and you can apply those to any object
between the two of those functions so if
you just attach those functions on any
object and populate the down that way
you're going to be safely populating the
Dom if you put untrusted data into inner
text or directly in the Dom that I can
easily inject JavaScript into the into
there the other thing is when you have a
rich JavaScript application I can look
at all your code in a trivial fashion so
you should keep all your business logic
secrets in crypto out of there all that
belongs on the server treat even your
JavaScript applications as if they're
thin clients and you're better off cool
quick it again inner text and dot Val or
in jQuery it's a dot text function and
dot Val function those will
automatically in the JavaScript language
itself safely render any input within
the Dom that's the key thing and then
the next question you should ask what
about angular then that those are
framework specific issues and they have
different templating systems that do
some variety of escaping and not
escaping properly always comes down to
dot Val and dot intertext for population
of the Dom any questions cool good good
fair enough answer other questions I'm
sorry keep all secrets out of get
requests is a standard thing whenever
you do a get request that stuff leaks
everywhere so if you have a rest
architecture which is requiring you to
put like a password in a URL doing rest
wrong you're exposing secrets because
even a get request over SSL
Oh still going to a get request over SSL
is still going to leak that input in
proxy servers and other places within
the you know within the the chain so you
know make sure using SSL make sure that
you're posting sensitive data of any
kind and the rest is to standard web
security everything else we've talked
about here do good authentication do
proper session management all that stuff
question sir that's a good place to
start that's that you have to have a
good have a good reset procedure for the
user they can call in or what not have
them have some have backup codes like
the Google system google authenticator
when you first set up multi-factor for
gmail they let you print out like ten
backup codes you put in your pocket or
whatever putting your wallet so if you
lose your phone you have backup so
mimicking that mechanism in your system
may or may not be a bad idea depending
on what what you're trying to pull off
like for a bank he'll send you a new
token they'll resync and send you a new
token so you're out for a few days while
until they said that I'm sorry for the
any other questions I'm sorry the
session was changed like literally last
night after I started drinking I had my
mind to stop at to stop at twelve-thirty
I hope it was still a value to you in
some way folks thank you so much last
one go ahead i'll be at the book signing
in 21 minutes so i'm starting the books
in 21 minutes and yeah we're on the move
thank you so much everyone cheers</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>