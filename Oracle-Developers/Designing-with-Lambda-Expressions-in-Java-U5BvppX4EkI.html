<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Designing with Lambda Expressions in Java | Coder Coacher - Coaching Coders</title><meta content="Designing with Lambda Expressions in Java - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Designing with Lambda Expressions in Java</b></h2><h5 class="post__date">2015-06-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/U5BvppX4EkI" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome to the session on designing with
lambda expressions in Java my name is
Venkat Subramanyam let me talk a little
bit about what we're going to do here
today I am NOT going to talk about
lambda expressions itself I'm going to
assume you know what they are we're
going to talk about how to really use
them and you know how to apply them in
various things best time to ask a
question or make a comment is when you
have it so please don't wait till the
end anytime is a great time for
questions comments and and do draw my
attention if you have a question you may
not be in my line of sight so I won't be
taking any questions in the end so best
time is when whenever you have questions
so what are we going to do here today
we're going to talk about some ways we
can use lambda expressions to design
applications we've been using object
oriented programming for a very long
time and that's about the change with
Java 8 coming out with lambda
expressions the way we go to design the
application is going to change quite a
bit and then how do we go about you know
using some of these is what we're going
to focus on here today now before I go
into that let me just talk a little bit
about design and design patterns itself
one of the things we do when we develop
software it is constantly design now how
do we go about designing stuff well we
all are have been exposed to design
patterns let me tell you what I think
about design patterns before we set up
the stage for this discussion I really
hate design patterns okay that was very
motivating wasn't it well ok thank you
well the reason I let me clarify why I
say that well we all know that grandma
makes the best pie hands down so we all
you know we talking about grandma's pie
all along our friends say well if
grandma is making such a great pie why
don't you make it for us so you call
grandma and said grandma your pie is
popular I've been talking about it they
want me to make it could you please give
me the recipe so grandma says oh that's
very easy and it starts even the recipe
you say I tell me how to make it and
grandma says you know put some flour put
some sugar so no no no how much sugar do
I put and grandma say is about to is a
teaspoon or tablespoon and then you are
really medical eyes are taking all those
directions and then what do you do you
write this all down and then you ask
grandma what are the best practices what
are the do's and don'ts
then you go off and make the pie with
this instruction and how did it turn out
to be a disaster right I couldn't get
the spoon out of it the last time I
tried this so you hide that under the
sink and then you go get a pie from the
store and then you tell grandma this was
a disaster and grandma says what
happened you narrate the story and
grandma says why don't they make the pie
for you so you walk into the kitchen and
you're watching grandma make pie and
what does grandma do takes a sugar and
measures it very accurately and puts it
right no grandma is cooking talking to
you and take some sugar and does this
and you send you say what's that and she
says sugar and then you said how much
and she says enough and then you realize
grandma did not do anything she told you
and then you say why did you then give
me the recipes and says kid you asked
for it right well the guys who wrote the
design patterns book are the grandmas
and grandmas of our industry and the
worst thing those four guys ever did in
their life is write that book and and
the minute they wrote the book we all
thought oh we could do this too right so
the point really is the only way to
really get good at it is to really try
it so I use design patterns not to
design but I use design patterns really
to communicate if I'm sitting and
talking with you and you say something I
say something and immediately we could
say oh you mean we could go this
direction in a way think about this as a
program where you're drawing things and
you could gravitate towards a great if
you're very close to wear patterns kind
of help you to settle down on an idea if
you're very close to the vicinity so if
you wake up in the morning and in the
first thought that comes to your mind is
I wonder what pattern i would use at
work today i recommend you call in sick
that day right no need to go to work so
anyway having said all of that let's
talk about how we could use lambdas as a
design tool if we can apply some of
these things what are the real nice
things that lambda expression provides
is a very nice method composition now
what does this really mean method
composition let's look at an example
here let's say for a minute we have a
little string of names given to us and
these could be any names given to us
let's say for a minute we have a bunch
of names and this these are going to be
different names and different lengths
into it so let's say we have brent over
here we got Bob and we have Bruce and
let's go ahead and say for example we
have Sarah and we have Kim and we could
go on with a few more names over here
now the given problem is from the list
give me a list of names with a starting
letter let's say starting letter and
this could be b RK and also three are
four letters now this is a very simple
problem we want to deal with we want to
extract from this list only names that
have a collection of these names did a
few days ago I was working on a project
where I have a collection of items
coming in and i have to pick things from
this item and their various conditions i
have to apply to pick the items
conditions from the items how would we
go about doing this in the traditional
style well we would start for example by
saying result equals and then we could
say a raise for example arraylist and
then we could start with an empty array
list to begin with and then we could
patiently go through and say given a
name from the names collection and then
we could say for example if the name
starts with we could say starts with and
then in this case it would be a B or the
name starts with let's say okay because
so the problem statement says and the
name dot length is going to be equal to
3 or the name dot length is going to be
and then we could say equal to 4 and
then we could say in this case a result
dot add and then we could add the name
to it now the minute we write this code
the next step over here would be to sit
there and say did I mess it up right so
we wonder if this is correct or wrong
and when you run it in this particular
case as you can see here starts with you
can see in this case when we run this
code we have to make sure that we are
actually getting the result
let's look at what what the result is
going to be in this case okay that was
not the result I was expecting so so
what did I do wrong here uh what was
that a one person with somebody here a
forced oh of course for string of course
where did that in come from okay so a
string there we go not enough coffee
this morning all right starts with yeah
I'll fix it I'll fix it there we go
excellent thank you it does have a
lowercase K and it does it Lou that was
an uppercase scale very good catch all
right so but in spite of all of that
that didn't work because I'm not Sarah
sneaked in what happened in this case
we're going to go back and say oh wait a
minute did I do this right and what do
we do when things don't work we put more
code around it right so it's like can
this work right and then we kind of put
a little bit more and then we say did
that work really right so oh no that's
wrong where did I put the ampersand
around this whole thing right so we got
you know you can do this but there's a
pattern named after this it's called
scotch tape driven development right it
doesn't work with a little more tape on
it why go through so much pain that's
whole point right that's a real poor way
to program let's try this one more time
can we why go through that much more of
mess why don't we simply say output well
what do I want to output right here well
let's go ahead and say names for a
minute and I'm going to call a stream on
it stream is a very nice fancy iterator
in Java 8 and i'm going to say over here
filter for me and what am i trying to
filter given a name i want to filter
name that starts with the letter B or it
starts with and then i'm going to say
the letter K here and then I'm going to
filter one more time in this case name
again and the name dot length is going
to be going to be lets say equal to 3 or
the name dot length is going to be lets
say a 4 and then once I get all these
results I can collect this back into our
to list itself so notice what happened
in here we're using the composed method
pattern and the composed method pattern
says we're going to perform an operation
as a series of transformation or
composition throughout and so in this
case i'm using a to list method where
does that come from i'm going to go back
over here and say this is util dot
streamed art collectors and then that
comes from a static method in there so
I'm going to add this as a static method
right here so what did I just do so I
said given the streams filter the names
that start with a be or a k and then
filter the names that only start with a
three or four letters and then collect
the result into a list for me and return
it and you can see that it's able to get
the results for us so fewer Michael
feathers once said object-oriented
programming is about encapsulating
moving parts functional programming is
about eliminating the moving parts
notice what we did we eliminated the
moving parts here we're not sitting
there and juggling between comparisons
in one place there's another thing we
did here very nicely in the previous
code we totally failed a single
responsibility principle single
responsibility principle says that every
line of code must do one thing and one
thing well that if statement becomes a
monster over time and the for loop
becomes a monster because it does
multiple responsibilities in one place
single responsibility principle can be
applied at every line of code so we can
make sure the code is very cohesive and
you can see every single line of code
has one responsibility ear and it nicely
flows through the other thing we also
did here is we use an internal iterator
rather than using an external iterator
an external iterator also fails another
design principle which is called tell
don't ask tell don't ask principal says
tell the object what to do
don't ask for details from it over and
over and make decision when we use a for
loop what are we doing we are telling
hey object you're not smart enough to do
the looping I'm going to ask you how
many elements you have and control the
loop until I reach the end we are doing
a lot of work ourselves in the internal
iterator we tell the object to do the
looping and step back and watch it get
the work then so we talked about to
design principles that are applied right
here which is tell don't ask principal
and single responsibility principle
already so this is a better way of
writing code as you can see already
using method composition I won't go into
the details much over here for now but
one concern you may have is are we
looping too many times right now well
thankfully the way this is organized as
that these are streams are lazy so
rather than performing the operations
for all the elements they perform them
vertically and by collapsing or fusing
the operations together so they are
fairly efficient in what they do as i'm
writing this code if you are interested
in the topic list or the code they are
available on my website i'll put this
URL towards the end as well so you're
not in any rush to copy it I have it in
bottom also so you can definitely take
care of that later on if you're not
noted it already so the next thing I
want to talk about is about separation
of concerns now what is separation of
concern again we talked about single
responsibility principle but let's talk
about this with a little bit more with
another example here let's say for a
minute we have a list of integer values
and these are let's call it as numbers
to begin with and I got a bunch of
numbers on my hand that I want to work
with let's say for a minute this could
be any number of numbers but let's just
take this sample of numbers to work with
now let's say you are at work on a
Friday night and you evening you really
have this very interesting party to go
to and you're looking at your watch and
you want to get this last test done and
you want to leave right away so the task
you have on the hand is your colleague
wanted you to write a method called
total total prior values and then you
pass the numbers to it and you want to
get this done quickly so what are you
doing so you're going to say for example
over here simply say public let's say
a int total values take a list of
numbers on your hand and work with it
and what I going to do well for the
numbers well we could say total equal to
zero for a minute and then we could
return the total we have not implemented
that yet we will in a second so we could
write a for loop so we could say for int
element in the list itself so we could
say numbers and then you could simply
say total plus equals to the element
itself and we got that working so that
was pretty easy as you're about to leave
your colleague comes to you the one who
nags you all the time you know who I'm
talking about comes to you and says I
need one more thing from you yeah what
do you need and you look at your watch
he says not only do I want to total the
values i still need it but i also want
to total only even values you say all
right i'll get that done before i leave
you look at your watch it's getting
really late and you realize that most of
the work is already done because if you
look at this beauty of this code it is
doing everything you want to do except
filter through even numbers and you look
at you watch one more time and you tell
yourselves there's got to be a reason
why they took the pain to create copy
and paste right i mean if nobody should
if nobody should use it why would they
ever create it in fact this is so cool
they even have shortcut keys for it how
cool that is right so you say total even
values right away and then you get that
working and you say here if the value
that is going to be e is even so you can
say equal to two a mod two then it is
going to be total well as fake me have
it before you leave your colleague says
I really need just one more help last
help from you today but I need to total
odd values also now you look at this
code and you know clearly copying and
pasting code a third time is an act of
criminal negligence but but nobody is
looking so it's perfectly fine right so
we copy this one more time and we say
total art values one more time and then
we quickly get this done
and the code seems to be doing what it's
supposed to do and you quietly slip away
well on the way to your party you
realize how sinful this has been and you
pull over the nearest uh you know coffee
shop trying to refactor but
unfortunately some of your friends are
hanging around they ask you what you're
doing and before you could flip your
laptop they look at the code and find
your dark side right and and they don't
return your phone calls anymore they
don't wanna hang out with you anymore
how life changes drastically right so in
the geek language should never do this
so let's refine the time as if this
never happened so step back all the way
through and we have this code which only
does this one method so far and that's
all we have so now your colleague walks
in and says I want this another function
to total even numbers alone and you say
all right all right I'll get that done
but it's time for some little
refactoring so we'll go back to this
code right here and notice the total
values function was taking an object so
far on hand but we going to change it in
this case we're going to change not only
to send an object to this function but
we're also going to send one more object
which I call a selector now what's it
different between numbers and selector
numbers is an object where a selector is
a function or a lambda expression i'm
going to pass and the one I'm going to
pass here is called predicate and the
predicate is going to take an integer as
a value and one of the nice things about
a predicate is a predicate can accept
the value of whatever type it is but it
always returns a boolean true or a false
so in this case I'm going to go back up
here and change it to a function star
predicate up here so this is a
functional interface part of Java 8
already and I made this a predicate so
now I go back over here and say if the
selector dot test the value and if it
liked the value then I want a total not
otherwise I'll just skip it so the
selector makes the decision so what did
we just do we wrote the selector over
here and then back here in this code we
will simply say comma value simply
return a true as a response because I
want to total
all the values not we can go back and
refactor this code and say value equals
equals 2 and then you can see that it
only totals even values now your
colleague comes back in a few minutes
and says I need one more thing from you
I want to total odd values you say well
why don't you go back to your desk and
do it yourself because we have made this
really the factor this I don't have to
be sitting and babysitting that code so
we can easily reuse that code now what
did we just do right now all we did was
we extracted that little logic in this
code and we said while this method would
still be looping through this code the
decision of what the total has been
brought together and extracted and you
may probably look at this and say hey
that's really interesting but what are
we doing here well no surprise what we
just did here is the strategy pattern in
the previous versions of Java if you
want to do strategy pattern you would
have a corporate design meeting here you
just get it done as you can see it is
that simple to get that work done so we
just extracted that out into a strategy
and the predicate here in this
particular context gave us the strategy
for us and we were able to use that
right here so that is an example of how
we can separate the concerns and bring
it out now that's great so far but we
look at one other application of
strategy but in this case for the
purpose of delegation I'm a huge fan of
testability and be able to test code in
any particular setting so let's look at
an example of where we would get into
trouble with testability in a lot of
cases let's say for a minute i have a
class called will call it as calculate
net asset value so this is going to
calculate a net asset value for for a
given stock now this could be in an
application where i could write a
function called a calculate and this may
take a ticker symbol on on hand and it
may also take the number of stocks that
it has on hand the logic is trivial I'm
keeping this extremely simple so we
don't have to focus on the problem
rather than the solution so all that I'm
going to do is I'm going to simply
return from this the stock the number of
stocks we have right here on the hand
times the
I need to know the prize value so I'm
gonna say price you know fetch a fetcher
and then dart and i'm going to say get
price so what is this get price it's
going to take a ticker symbol and get
the prize for us so price fetcher is
nice a little object but how do we
really use the price fetcher well we
need to go get the price itself so i
could create an object over here called
a price fetcher so we'll call it as
price fetcher and the price fetcher is
going to have one function here called
double and this is called get price and
then this is going to take a string a
thicker as a parameter and then i'm
going to simply output here do the hard
work and get the price right you have to
talk to web services process some
responses and then return let's say 30
5.32 or whatever value that you really
get from the web service after
processing now the problem is this this
is going to do that all the hard work
and get the result for us so how would I
go about using it so we could say price
fetcher over here for example and then
we could specify that in this case it's
the price fetcher I want to use and we
need to construct this object so we
could say calculate nav price fetcher
and then we could say the price fetcher
and we could set this object over here
and say the price fetcher equals new
price vector itself and use it well
actually in this case the price fetcher
well that's good so far but imagine we
are writing a unit test I'm not really
writing a unit test here I'm not
bringing up you know unit testing tools
and using it but imagine we are writing
a unit test so we would say calculate
nav over here and then we could say
equals new calculate nav and what we
what do we do we have to pass an object
of this particular class to it so we
could say price fetcher fechar equals
and then we would create a new price
fetcher and then we would pass through
this particular object over here as a
fetcher and when we are done with it we
would simply call this out and say
calculate NAB compute and we could say
for example Oracle's start price and
then we could save probably a hundred
stocks and I want to know
what the stock price isn't asked for the
value so a calculate is the name of the
function i called it let's call it
calculate so what is what is the problem
in this code the problem is notice it
says do the hard work and what that
really means is this code is not going
to be unit testable because it's got to
talk to a web service it needs internet
connection on all of that but we know
exactly how simply we can solve the
problem right we don't write unit tests
for that reason well okay I think we can
do better than that what if it becomes
simply easy to unit test this code
because after all what are we trying to
compute that logic over there why am I
really interested in testing that logic
well it is possible that the stock value
is incorrect it's possible that the
value is not a good number I may have to
do negative tests and what have you I
may have to check for conditions when I
don't get the result properly which
means the get price may fail and I have
to write test for it so the military
start writing test for it there's a slew
of tests you're going to write but those
tests don't really work very well if you
have to talk to the remote system every
time so wouldn't it be so cool to do
mocking well how do you really mock well
marking is where unit testing efforts go
to die right because the minute you
start mocking then it becomes extremely
complex and we bring in marking tools
and framework life becomes really hard
what if mocking becomes extremely
lightweight let's see how we can do that
so notice I'm going to go back to this
code for a second and i'm going to say
price calc fechar impl for a minute so
I'm going to say this is a price fetch
your impl and then I'll just leave it at
that for just a minute as a price
fetcher impl but then i'm going to go
ahead and create an interface over here
called a price fetcher and then in this
interface i'm going to simply say double
get prize and then string ticker that's
all i have i created an interface notice
this interface has only one abstract
method those interfaces are sams or
single abstract method interfaces but in
Java 8 we call them functional
interfaces if you really want to you
could put an annotation on the top to
say this is a functional interface but
that annotation is completely optional
you don't have to specify that at all so
that is all I did I simply said that I
have a price fetcher which has this
function now I go back over here and I
modify the code just a little bit to say
over here given the price fetcher I want
to write a method on this called a get
price method so I'm calling the gate
price method on it to do the work itself
but how do I go about using this so
notice what I'm going to do if I'm going
to be doing the testing over here I'm
not going to create an object of my
price fetcher but instead I go back to
this code right here and I simply say
hey I want to accept a price fechar as a
parameter over here well that's a that's
a functional interface I'm going to pass
so I'm going to say given a thicker of
whatever the ticker is simply return a
marked out response for me as part of
that response to that function so what
did I just do online number 32 I replace
the constructor object with just a
lambda expression why did I do that well
because a constructor in this example is
receiving a functional interface as a
result I can pass a lambda expression
Israel passing the real code itself or
the object itself and that's all I did
in this particular case and I replaced
it that way so so what did I do notice
how i'm using the mark which mocking
became trivial in this case that's a
one-line sweet mark and say that's all i
want to do in another pairs I want to
know that my code is behaving fine when
an exception is thrown what will I do
I'll set picker arrow throw runtime
exception blow up and raise this
exception so very lightweight mocking
and did you notice I did not inherit
from the interface at all now do I have
to inherit from the interface no life is
a lot more lightweight than that so
notice now I'm going to create a
calculate nav and i'm going to create
calculate nav to this could be in
production for example right or
integration and how would i use this now
i'm going to simply say equal to Nu
calculate nav over here and at this
point I'm going to simply say over here
to use the
real implementation I'm going to say
this is going to be the price fetcher
implementation get price method and I'm
going to simply mark that method that i
have here as a static method because i
don't really have any state information
to deal with so i'm going to say the
implementation get prize is the method i
want to use and then i could simply call
this and say calculator and after that
compute and then calculate and i can
send over here to this calculate method
the price of the stock along with the
value that I'm interested in and I can
make sure that it's actually using the
right value instead of the old value
itself oh let's see what did i do here
price a fetcher a great price Oh
semicolon missing let's go ahead and fix
that right there so that is an example
of how we could use that and notice how
you passed in an implementation in this
case whereas in the other case you just
passed a lambda expression please no
absolutely you could grab any method so
look at the beauty right rather than
saying you know if you're sitting in an
airplane right you're sitting in the
airplane and a duty 6 next to you and it
turns around to you and says do you
support I like music interface what
would you say ding I want to change my
air is seat please I don't never on a
second thought I don't want to fly today
right so you don't talk to people like
that you say hey it looks like listening
to something what do you like is it
designed by capability rather than
design by contract so you're saying as
long as the method get prize has the
same signature that the other method in
fact if you go back to this guy here you
don't even call it get prize you could
say over here fetch the prize is the
name of the method completely arbitrary
method name doesn't matter what it is
thanks for asking that question and now
I can go back to the code and say fetch
the prize and that is absolutely fine
because we are designed by capability
rather than design by contract as long
as you support the same signature that
the other method is expecting I don't
care what the name is right so that is
more powerful design lightweight design
than what we are you
stew before so so this is the power that
you get on your hand awesome question so
that is the beauty of doing this is we
are no longer constrained by this
anymore and we are able to use that very
nicely so that is the delegation that we
use and simply modify the strategy to
use a delegation in this particular case
let's go a step further here I want to
use a decorator pattern where I can
bring in multiple different features
into it I'm sure we all have used
decorated patterns in Java but the time
somebody comes to us and says do a
decorator pattern you're like can I come
back after lunch right because it takes
a lot of effort you got right interface
as you got to connect them together
that's a lot of ceremony let's give this
a try one more time so in this example
what I'm going to do is I'm going to go
back and create a little you know a
filtering that we could nicely use and
play with so let's go ahead and create a
class called camera so the camera class
wants to have a little capture method so
in this case I'm going to return a color
and i'm going to say capped your final
color and then we'll say input color so
let's see how this is going to work so
in order to use this i'm going to go
ahead and import over here java dot r
dot color you can use anything you want
just a little example to use a color
here but what am I going to do with in
this well I want to do several
processing of the color now typically
what does a good camera do it gives you
a lot of filters you can apply so you
can take your camera and put two or
three filters on it and then you can
remove the filters and add other filters
the base unit is the same but you can
keep adding and removing stuff on it
that's what we're going to do with this
example so I'm going to return from here
and i'm going to say filters and let's
go ahead and ask the filter to apply
something on the filter and we're going
to send the input color to it so in this
case i'm going to just pass this through
the filter you could get a result and do
some processing of the result also if
you want to but i'm just going to return
whatever the filter is going to return
but notice the word I use here I said
filters over here so what is the filters
so I'm going to save over here function
and it takes a color as
parameter and a color as a result and
I'm going to call these filters so
notice i just created a single instance
here rather than a plural but i named it
as plural because we're going to use
filters in this case now what how does
this really work so in the constructor
of this class I'm going to say camera
and then in the constructor I'm going to
simply call set filters and then just
call the empty function on it we haven't
written the set filters yet but I'm
going to do that in just a second now
what would the self field set filters do
so the set filters method says this can
even be a public function that's fine so
a set filters says I'm going to accept
over here so lets us it filters it says
I'm going to accept the filter of color
and color but I will accept a varargs
over here and we'll call it as the
filters so now that I have a bar argh of
the filters how would I go about using
this bar argh in the code so here's the
way I'm going to use this I'm going to
simply say this is where it gets a
little tricky so it may visualize this
there are several objects you want to
connect together as a decorator that's
what you're really interested in doing I
want to connect these objects together
so in order to connect these objects how
would I put this together so I'm going
to say filters equals so because that's
the object i want to set over here but
i'm going to start with the first filter
so arrays dart as list and i'm going to
start with the filters given to me and
get a streamed from it now that i have a
stream on my hand I'm going to then say
given the stream of objects I want to
say go ahead and reduce this into a
single object this is a combinatorial
operation where we combine or reduce all
the filters to one but what can a
reduction I want to do given a filter
and the next filter I want to take the
filter given to me and I want to merge
it to the next pre-filter that I have in
the collection so compose this with the
next filter now just hand it that for a
minute and see if that makes sense if
you're given multiple filters you are
simply saying hey you why don't you then
just connect to the person next to you
you connect to the person next to you so
we
forming a chain of these objects and all
I have is a reference to the first
person in the list right so we it's like
we all holding hands with each other we
are connecting and composing a chain of
objects but we did that in a very nice
functional style using method
composition we said given all these
filters get me a stream of these filters
walk the chain of these filters and then
ask each with them to hold the hands of
the next guy in the chain and then the
last one you get is the result there's
one small problem in this code the
problem is the result of this operation
may potentially be an empty because the
filters may be empty also so it's going
to return an optional back to us do to
deal with that we going to call it our
else method and in this case we say if I
don't get anything given a color as an
input I want to simply return a color as
an output in other words this becomes
the most mostly a dummy filter where the
input is the output essentially that's
what we are doing make sense so far so
that is all we did we combine these
filters together in this particular case
well now that we have their done or
decorator in about one or two lines of
code we can easily put this to use in
our code very nicely so what happens if
there are no filters garbage in garbage
out whatever color that comes in is the
color that goes out so now if you take a
look at the capture capture up cause the
apply on the filter but what the apply
is going to do is it is going to say if
I'm alone I will do my work but if I'm
not alone I will do my work and forward
it to the next guy in the chain and the
next guy would forward it to the next
guy in the chain until the very last guy
responds to it so at the runtime this is
like a chain of command but really
you're applying the decorator pattern to
putting putting them together in the
formation that's what you're doing here
making sense so far how this is fitting
together that's a little bit of a loaded
code here but hopefully you're able to
see how the chain of operations can come
together so now that we have done this
how would I go about using this so I
have the filter setup here I've got the
set camera set filters called in the
constructor so it will just call it with
empty doesn't have anything
here well because we're using genetics
year it's going to throw a slew of
warnings here so we'll simply say
suppress warnings over here for
unchecked right here and now that we
have that let's see how we're going to
use this let's take a few steps and try
to use this code right here so first
thing I'm going to do is create a camera
object will say camera equals new camera
so this should have created an empty
camera object for us to use great what's
the next thing I'm going to do I'm going
to create a function and reuse it but
I'm going to be lazy I'm going to create
a function on the fly right here so I'm
going to simply say over here in this
case let's go ahead and say consumer so
this is going to be a print it and this
is going to be a message I'm going to
take so what is this going to do with
the message I'm going to take n so given
this message object all I'm going to do
is simply print out so i'm going to say
print out a string dot format over here
so this is going to simply print out a
width and i'll print the message and the
result also so that's pretty simple
isn't it so in this case it's going to
be the message being printed out on the
camera capture and i'm going to send a
color to this guy let's say 200 hundred
and two hundred so these are the color
values i send in so this becomes a nice
little instantaneous function within a
function now we can create functions on
the fly so I created a printed function
right here this is a consumer where as a
consumer come from well the consumer is
also another functional interface that's
where it's coming from so now that I
have this over here I'm going to simply
call print it and in this case I'm going
to say print it with ward no filters
right so I don't have any filters to use
I'm just going to call this without any
filters up the double coat not single
coat this is java so let's go ahead and
fix that for a second so so that is
basically with no filters being applied
so what does it mean if I don't have any
filters to use like I said the color in
is going to be the color out oh this is
going to be the filter function right so
let's go ahead and fix filter that's
going to be function
there we go and I hope I didn't miss
that another place we'll find out so um
so what estelle filters do oh it's a
warning actually at the time also that's
interesting I had said unchecked warning
over here so it still keeps giving
warnings not sure all right let me lower
this and take a look at it um so what is
it doing getting a bunch of filter
values so string dot format with okay
what did I do oh if I can see sharp okay
so yeah de liquid supper wanting the
right place I thought I thought I did
right import suppers warnings oh of
course not one many okay so thank you so
what are we doing in this case printed
this day is cannot find the symbol print
it while i created a printed right here
that I want to use right here so why
doesn't it find it let's think about
this so cannot find the symbol could not
load the object it cannot be what earth
course of course so this is going to be
consumer so it is except right so all
right so that is all we bed and what did
it do well garbage in garbage out as you
can see what we got to do a little
better than this let's do this one more
time this time print it except and i'm
going to say what do I want to say here
a brighter so let's try the brighter now
so i'm going to say Canseco camera over
here dart set filter and i'm going to
say color a brighter a brighter right so
we are playing one filter to this now
rather than the no filter that we did a
few minutes ago and what does this do
it's running through and you can see the
color is brighter than the input we gave
make sense yeah okay let's try this one
more time this time again this time I'm
going to say camera a darker and I'm
going to say this is going to be darker
and you can see that in this case the
output shows that it is darker than the
input the color has dimmer now as it
comes out and making sense yeah and the
last thing I want to do here is combine
them with multiple filters just with the
sake of fun here make it brighter and
make a darker what should happen if I do
that it should probably be the same
isn't it if everything went well and it
is the same as the input fair enough so
you can see how very lightweight
decoration of multiple behaviors so if
you have these functions hanging around
in your code you can change those
functions together by simply giving
their method references and saying I
want to combine them together to get
this particular feature so you can start
chaining things together very nicely
very powerful isn't it right not a whole
lot of code but a lot of learning to do
before we do that code like this is kind
of like operating a crane you don't need
a lot of strength but you got to be
awake right and be thinking so that's
kind of the way it is it is it is a lot
less effort to do okay I'm going to go
further and show you how to create a
fluent interface let's look at one more
example here of creating a fluent
interface let's say for a minute that
I'm interested in creating a mailer
object now what does this mailer really
do well it's going to help me to send
emails so I'm going to create a mailer
class so I say class mailer and the
mailer simply has a function let's say
void from so it's going to take an
address i'm going to say string from
will say address and all that it's going
to do is print out over here let's say
from and i have a bunch of other
functions over here so i gotta to
function and that's going to simply say
two for us and then i'm going to say
over here a subject function and let's
say sub over here and all that i'm going
to do is call these into my code to make
use of this object right so message will
give it a body of the message and then
finally we're going to say this is going
to be message and finally at the very
end i'm going to say send which is the
sending operation of
this email and so it's going to be a
scent so this object is helping us to
send emails and so finally I'll say
sending over here now how would we use
this in the code well let's give it a
try mailer equals new mailer so we
created a mailer object mailer dot and
what am I going to do too well who's
going to get this email well I'm going
to get this email special so the idea is
a two and who's this from so mailer dart
from and I'm going to say this is going
to be from my well let's go ahead and
put a from address it's going to be from
the Builder it's got a very important
message to me this morning it's a
subject and the subject is going to be
your code sucks and then it tells me the
message for it it's gone it's got to
describe how my code sucks today right
and then finally mailer dart send to go
ahead and send the email itself well
okay so we could call this code like
this and you can see that it's working
anybody who's written code like this
before everybody in the room absolutely
and how do you feel after you wrote that
code not not very well in fact if you
are doing this to a fellow human sitting
next to you they may try to strangle you
right because you kept saying mailer
mailer mailer mailer so many times so
there are several smelts in this code
the first smell in this code is it is
verbose it is it is repeatedly doing
things right and it's not very fluent
and the last problem in this code is on
line number 20 can i reuse the mailer or
should i not reuse the mailer we don't
know the answer how would you find the
answer and I know what you're thinking
you would say go read the documentation
how did that go the last time you tried
that right the other day it was late in
the night i was reading some java code
and the method name said pass through
honestly I did not know what that means
so I went to the javadoc and the Javadoc
said this method allows you to pass
through
those javadocs are called insult to the
programmers right so you would go read
that and I would not tell anything at
all then what are you going to do now
you are like downloading the source code
assuming this is open source project and
now you're starting to read through the
source code and you know that in the
middle of the night you never read
somebody else's code because you want to
keep complaining endlessly about I don't
like the code the way they have written
right this only increases the pain so
wouldn't it be nice if this is more
structured so we don't have this
confusion at all let's see how we can
use that approach so notice what I'm
going to do I'm going to make this
fluent the very first thing I'm going to
do is I'm going to take all these void
methods and I'm going to ask each of
them to return a mailer itself so each
of these methods are returning a mailer
object this is the composed method
pattern so I'm going to ask each of
these methods to do its work and return
the current object in the very end
that's all they are doing so now that I
made the change the code seems to still
working but then I'll go back to this
code and very quietly I'll remove these
ceremonies in the code and i will then
simply say i will call these methods no
more of these semicolons in the middle
so we could basically get rid of all
those semicolons in the code and we can
chain them together very nicely now in
the particular case the mailer itself is
returning messages returning that and
the scent is not returning anything
that's what it's complaining about well
that's fine we can fix that real quick
so that is the example of how we could
do this however there is still one
potential problem somebody could save
the value of mahler like this mailer
equals and then they could do mailer
dart and call this method also and
notice that works as well and you want
to prevent that why because if an object
should not be reused and we do reuse it
that's an error then an object should be
reusing we don't that could be poor of
performance and other efficiency
problems right so what can we do to
avoid that problem so here's an idea I'm
going to go back to the send the method
and make it a static method for a minute
and once I make it a static method
I'm going to take in a consumer over
here which is going to accept a mailer
as a parameter and we'll call it as a
block over here so now in this code I'm
going to simply go ahead and call that
block over here and have it except the
mailer object now what is this mailer
object mailer object is going to be
something I'm going to create here equal
to nu mailer and then simply create that
mailer right here and send it I know
when it comes back I'll do the
processing and clean up this object as
you can see here now how would I use
this object well life becomes a lot
easier I'll say mailer dart send over
here and I'll give it a block of code
which is going to say mailer and then
this receives a lambda expression so now
i can simply say given the mailer go
ahead and perform these operations right
here on the mailer and there's no reason
to call the send down the instance
because ascend operation is going to
work on the main object itself in fact
you don't even have to put a curly
bracket here in this example let's make
sure I brought in the consumer here so
import over here a Java dot util dot a
stream actually function and then I will
say the stream interface are in the
system the consumer interface ok so I
don't even have to use a curly bracket
here because it's all one single line we
could simply say give it a mailer go
ahead and do that operation for me
continuously and return the result over
here and we could write code like that
as well to configure and call it so
what's the benefit in this case online
number 25 it's very clear what the
solution is if you ask on line 25 can I
ever use the mailer the answer is what
mailer are you talking about right
because the scope of the object is over
you don't have access to that object
anymore so that is nicely done so that
is an example of how we can create a
fluent interface with this code by using
the the lambda expressions and the last
thing I want to show you is a pattern
called and execute a round method
pattern this is a pattern from the small
talk days ken Beck talked about this in
his book called small talk based
practices and the
is a pattern we can use in Java pretty
much because now we have lambda
expressions now where would we use some
of this I was working on an application
where we were having transactional
objects and when we had this
transactional object we were copying and
pasting code between transactional
services because all the code were doing
something very similar except the real
guts of the code you have to first
create a transaction set it up properly
and then you had to go about and say now
that I've set up the transaction do my
real work check for errors log if there
was an error and roll back otherwise go
back and commits this and stuff like
that and then once you realize that
you're copying and pasting this code
would it be nice if we can abstract this
so people can write only the code they
want to write so to understand this
let's go ahead and create a little
example here so i have a class called
resource over here and i have a
constructor for the resource in this
example and the resource essentially
says i'm going to simply say
constructing over here right and i'm
going to go ahead and create a little
method here called up one and this
operation simply is going to output
let's say up one that's all it does and
I'm going to just create one more
function and finally I'm going to go
ahead and write a constructor I'm sorry
a finalizer for this to say that I want
to clean up the resource now why would I
want to do this the reason is this
object may be using some external
resources which are pretty let's say
expensive and the virtual machine is not
going to clean it up until I product to
say clean up this particular external
resource so let's say cleaning up over
here now I want to use this resource how
would I go about using this resource
well we could say resource equals and we
could create a new object of this guy
and we call up one and call up to here
and finally when we are done with it we
want this to be cleaned up properly but
notice it did not clean up the resource
you can see it did not print cleaning up
now why didn't did not print the
cleaning up well did i misspell the
finalize method well it turns out I did
not misspell it I actually called it
correctly well it turns out the Java
Virtual Machine had a lot of memory
it doesn't really have a need to clean
this up right now and so it leaves this
in place which can have other
repercussion in in the program well one
way to solve this problem is to turn
into a close method then you could say
resource start close and remember to go
ahead and call close on it but the
problem in this case is you gotta
remember to call the clothes every time
and if I'm on your project you'll have
better luck buying lotto than relying on
me putting that method right so what can
we do about that we even worse than this
you have to put a try block around it
because there could be an exception and
in this case you have to make sure that
you are handling the exception and
cleaning up this object also just fine
when this particular method potentially
throws an exception now the reason why
this is important to fix this most of
the time programmers would forget to put
this and then when eventually people
find this you all you know eventually
get blamed if only programmers know how
to write code and I don't like to blame
programmers because I'm one of them
right and so it pretty nice that there's
a right way to do there's only one way
to do this so notice what I'm going to
do I'm going to go back to this code and
i'm going to say the resource dot use
and i'm going to get a resource on my
hand put a little curly bracket around
it and within this code i'm going to say
resource start up one and resource start
up to so i'm going to go ahead and write
the code in this way but not only am i
going to write the code in this way i'm
going to force it so that this is the
only way the users can actually use this
object the programmers can only use this
object so they cannot falter and say
oops i forgot so how can we do that well
it's very simple to do this i'm going to
go back up here and i'm going to furnish
make the clothes method private so they
cannot call it anymore similarly i'm
going to make the constructor private so
they cannot call it anymore also so now
they're forced to use the method in a
certain way so now i'm going to go ahead
and create a method here called a use
method and the use method could return
some result also it doesn't have to be a
void method what are we in return as a
final operation could be returned by
this method also
that's perfectly fine and then in the
use method I'm going to simply say give
me a consumer but if you want this
method to return something back then put
a function instead of a consumer so it's
up to you what kind of interface you're
going to use so consumer over here and
this is going to take a resource object
will call it block over here and what am
I going to do within this function I'm
going to simply say create a resource
first of all equal to new resource and
then within the safety have another try
and finally block we can clean up the
resource right here at the very end and
finally what I'm going to do here is
called the block and say except and
simply send to the block the resource
itself so notice what we just did we
wrote a use method we create the object
that we want pass it down to the block
of code when it comes back out we do the
cleanup and so the user of the resource
doesn't have to spend the time thinking
about this it is very streamlined for
them to go about using this itself and
life becomes a lot easier for them to
work with so now if we go back over here
and and run it Oh void method so this is
where close as a void method let's fix
that so when I run this code you can see
how the cleanup happened nicely at the
end of this call right away so this is
called the execute around method pattern
some people also call this as a lone
pair turn this is as if you go to the
rental car company a good one that is
and they clean up the car before they
rent to you you drive around town right
in the middle under when you return they
take for damages and do other stuff they
have to do so it is as if you get this
on loan right in between and you can go
back up and use it you can see some of
the patterns we are used to in the past
in different languages and in Java take
a very different transformation because
of lambda expressions and with as we
begin to use this more we would start
using more and more lightweight design
and that is more power to us as
programmers because a rather than
wasting overtime in creating ceremonious
code we can quickly try something and
and the whole thing about design is
trying out new I
yes very quickly and getting a feedback
and this is a shortest path between the
lightbulb moment and seeing something
working I hope that you found that
useful that's all I have thanks</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>