<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Tackling Time Troubles About Date Types in Relational Databases | Coder Coacher - Coaching Coders</title><meta content="Tackling Time Troubles About Date Types in Relational Databases - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Tackling Time Troubles About Date Types in Relational Databases</b></h2><h5 class="post__date">2018-03-21</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/jB1CvFqUVyY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">oh cool so I guess we'll start thank you
for yours for showing up and for for
coming in the late afternoon I'm gonna
say after all the food I feel like ready
to do you call it a day but not to worry
this is a very very light-hearted
session there's a few things that I
think are just good pop trivia and some
other things that are actually maybe
useful
the useful bits are mostly for Oracle
database things so if you really don't
care what Oracle database at all then
please leave now or stay but don't
complain but I also tacking some other
things so so not to worry all right uh
how does this work how do we get started
how why does this thing not work what if
I don't run well there's always a button
this is me my name is Buren I used to do
triathlons that's where I take the
pictures from but the last time I did a
series one was in 2014
I've gotten fan lady since then I do
work the mostly as a database consultant
I I have worked a ton with Oracle
databases and that's so where I do one
say my most valuable work I do a lot of
work today with cloud and migrating
customers to the cloud and building
cloud native applications that I find
very very interesting because as an
Oracle guy you usually work with fixing
something small underneath the covers in
Oracle and you really get to change the
data model or change the way things are
done when we talk about these new cloud
deployments I find them quite exciting
because we actually do get to improve a
lot of things and build things from
scratch I'm an Oracle developer champion
which is a new program they launched
about a year ago to promote people that
speak at events like this and talk about
not just all record core but also other
things that I had a talk earlier today
about Kafka and streaming ETL which is a
lot I think a lot more current or yeah
that's our current topic then and this
anyway still doesn't work okay so my
name is Bjorn I'm originally from
Germany if you've seen this before
pretend it's so funny I'm reaching
journey town called Hamburg which is the
second largest port in Europe and
recently moved to Canada a year ago
which I really love about the country
and the little town called
Ottawa
there's two pictures of Ottawa here one
is the big picture is Ottawa in the
summer and then to the left of it
there's a little picture of Ottawa right
now um it's just very very white and
very cool oh there it is right so people
ask me how to pronounce the name and
then I go to Starbucks I usually tell
them my name is Brian it's just much
less hassle but you guys get to
experience how the name is really
pronounced so don't be you're on but
it's really hard even for me to say when
I speak English and you can even write
it like this with a we're - through the
O which makes it even more confusing the
name is actually swedish and my parents
named me after a famous famous Swedish
tennis player named be on board he was
really famous in 870s I think and it has
a meaning it's an actual word and
Swedish and it means bear or or if you
don't get me being fat lazy more like
this one so now even though that wasn't
Swedish and and that so when I first did
this talk was in 2011 and and it is
talking in the UK which is what was one
times and away from where I was and just
showed me that this was very current so
I looked at my camera that day in was my
flight my flight back this was the at
8:25 so I thought I had good time to
make the flight 8:25 unfortunately if I
looked closer at the calendar the flight
was actually at 7:25 British time so it
was just one of these stupid funny
examples of timezone things are weird
and people get it wrong and my cabin I
got it wrong and that wasn't the first
time
Apple Apple mess with me a year before
that they had a nasty back where when we
changed to daylight saving time Apple
didn't update that and people got up an
hour late and got to work late that was
annoying and they fixed this bug and
then a year later they they set the
alarm right but if I looked at my camera
they see it was actually it was 10:30
but the little red line showed 9:30 was
less of a bug but so annoying and it's
more of these to come why do time
rosemary I used to be the president of
the rack special interest group and so
people would make me say hey why is
nobody on this call and it was because
that call was happening at a different
time that's was a photograph from India
and you didn't realize that the US had
already shipped
- - daylight savings bad for him another
example of somebody messing up time
zones is if you want to send me a
birthday present my birthday is on the
24th of November and this is the
Facebook and if you look at the Facebook
coming it's the 24th my birthday but the
details of the event say it's November
23rd which is not correct so Facebook
misses up Apple messes up times on stuff
Facebook messes up times on stuff how
hard can it be the the actual
inspiration for this talking from this
problem this was a production database
that have been running fine and then one
magic day around data at saving time
change actually this job got this era
this hora 1878 specified field not found
in daytime or interval and that's
typically the error you would get if you
try to produce a date that doesn't exist
so that is that it that exists in this
weird it's a lot of time where you jump
ahead an hour you try to generate a date
in that skipped hour it will tell you
this but that's orogeny you should only
happen if you have a timestamp with
timezone Oracle and the weird thing is
that this table that this error was
thrown on did not have a timestamp with
time zone which means that Oracle
there's no way of knowing if there was a
time a date I'd say any time change and
it has no way of telling me that
whatever I was doing with this table was
illegal so we get to back back to this
problem later but this was really prom
that started this this whole talk yeah
so we talk about time data we talk about
data types we talk about how to do math
on dates
I'm have a few examples that are
light-hearted fun I hope and then
towards the end we get into data at
saving times and time zones and we have
time towards the end we'll talk about
the leap second which hasn't happened in
a while but the last time I get or one
time I gave this talk was just a week
before this happened so on let's see
forget that the types of data be story
and dates are things like what birth
date sign updates whenever events happen
schedules calendars all these all these
things these are all points and time we
that we that we store usually the types
of queries though that when we query
dates we almost always do this range
based queries at least on Oracle it's
almost always range based and that's
because
we ask what happened on a specific day
we don't really ask what happened on a
specific day at that time at that second
we very rarely do this equality checking
queries or it might be a newer older
give me things that happened after this
event or give me something that happened
within a certain range of a date like a
day before a day after so that's the
kind of types of queries we run and I
want to scourge people from from
reinventing the wheel and trying to
store dates and creative ways in the
databases and one creative ways to just
store it as a character right you can
just insert something like New Year's is
the first of Gen 14 and make that a
character field that's bad and it's bad
because the database has no idea of
knowing this like the database if you if
you talk to the optimizer the ask the
optimizer how many days are between the
31 this December 13 and 0 1 Jan 14 it
has no idea if you stores a character it
would have an idea if you store these
actual dates but with characters it has
no idea how to compare them and so don't
do this there's a second way of
reinventing the wheel and when I first
gave this talk I said never do this and
I've come around and say sometimes to it
is storing storing UNIX timestamps which
is the number of seconds since 1970 and
I still say don't do this because again
it's really hard to do math on this like
how do you compare two dates how do you
you have to basically implement your own
your own date math then I said never do
this the reason why I say do this
sometimes now is because working with
big data I've realized that not every
Big Data data frame supports dates on
time stamps so like I use Avro a lot and
ever just doesn't do dates they do
everything as long so they actually
convert this whatever you put into a
date into a long number and then use the
units times them so you might still want
to do it but if you have a database
please don't do it because you just had
so much more out of a database if you
use proper date time it's yeah if you do
this you idiot no checks on integrity
and the optimizer has problems that
another create if you say I came across
recently where I'm in data warehouses
people like to create the age dimension
tables where you create a table that has
like just dates and they might extract
the counter day the month the year I
recently work with a retailer and they
have I learned that they have something
like the four five four calendar where
they break the year down in four weeks
and then five weeks and then four weeks
where they do something weird to the
month because what they want to do is
they want to ask for the third week and
then the fifth week and whatnot so they
set up these tables with de dimensions
and their own date logic in them the
problem you have with this is basically
do your math doing joints and that also
confuses the optimizer a lot so if you
want to say give me two days here date
and then a year ago in my own logic not
just a year ago from now but a year ago
and whatever my logic for a year ago is
and then you have to join to this table
twice and that might just really mess up
with your execution plans or make it
really hard to do the math on it or even
do things like efficient pruning and
other optimizations but I also realized
that sometimes you have to do it my
advice for these kinds of things is you
have your own logic like a year ago has
your own logic but then in the function
and you can use a function to to get
these things is that's all they do you
build the table no time on functions why
didn't you just use functions in your
credit so here's a little quiz which of
these dates on the slide are actually
legal dates which of them which of them
exist
I need any guesses third one is legal
you say okay what about the fifth one
the 1582 that looks legal
okay so 32nd of January Tory isn't legal
the thirteenth month is probably not
legal the 29th of February could be
legal but that was not a leap year so
yeah that that isn't legal the 60
seconds one actually don't know it that
this one might be legal
so the 1582 one is it's a case that I
actually have here so if you try to
produce this state and Oracle odd
actually my example has the 7th of
October 1582 you do Oracle please give
me a date that is the 7th of October
1582 it will give you the 15th of
October 1582
that's odd why does all record do that
yes this is this is good this is good
pub trivia by the way ice right so um
how about you 1582 that was was based on
on this guy that's a julienne camera for
Julius Caesar he figured out that a year
was 350 so he already figured out the UM
the leap year and the the leap day thing
and that was pretty accurate
um but turns out the actual solar year
is about 10 minutes 48 seconds shorter
than 360 5.25
I mean it's fair enough you know 2,000
years ago so I want to give him credit
for it for being almost right but it
wasn't quite right so then this guy came
along and 1582 and that's Pope Gregory 4
who invented the Gregorian calendar
which because Easter wasn't quite right
there was two things that were wrong
with Easter the first thing is Easter is
kind of character on a moon calendar and
so that was getting out of sync with the
with the actual account no people were
using and the other problem was that
Easter was just getting earlier and
earlier in the year which I guess meant
that they couldn't find their Easter
eggs in the snow which is a very cheap
joke because they probably born don't
for Easter
the solution that that Gregory suggested
was skipped 10 days so he just said from
the 5th of October that year to the 15th
he would just skip that we would just
skip these 10 days and then go on with
our lives
luckily for them they didn't have the
ERP systems or any computer systems back
then because that would have been a
nightmare to program right there's thing
about the year 2000 buck and I mean this
guy's say well later this year we just
skip 10 days and it sure won't be a
problem and then it's a solution to to
go to go forward was to leave out a leap
year we out of four times when that's
whenever the century is two Visal I've
got it somewhere
well anyway 17 1800 1900 is are not leap
years but 2000 would be a leap year so
the centuries he said shouldn't believe
us unless the century itself is divided
by four and he also did some
modifications to do not Canada I did not
understand that I read the Wikipedia
page like three times and I didn't
understand what exactly did to that but
now Easter and our calendar are very
much in sync and Easter always just
varies by a few weeks and and that's
fine um the weird thing is not everybody
said we will do this and the last
country had changed to the regarding
kept from the Julian calendar was Greece
and the reason for that is the Greece
our Orthodox Catholics so they didn't
care what the what the Pope said they
just said let's just go with our
calendar until they realize it's really
weird to have a different Catalan in the
rest of the world and they said let's
just do this a pox on the other thing
right so the ad BC thing that is that
was actually only done and like what I
think it was done in six seven hundred
after Christ and they actually started
to say let's just take Christ as the as
the apakah Steve when we or maybe start
counting centuries because before that
all these Roman emperors said well let's
let's take the Julian calendar but
really the colors like Year Zero should
be when I was born because I'm the most
important person and then people figure
out that's really confusing and said
let's let's just take one and it's how
they pick Jesus Christ
so trying to produce this an Oracle so
trying to produce Jesus birthday I tried
this and you know what happens tells me
you can't do this there's no way you can
get a year zero the year has to be
nonzero it has to be your one that's
fine so I said well I really really
really want to get 24th or 25th of
December in the year zero so I said just
subtracted eight days from the 1st of
January as zero one and this works and
and I warned you I said not everything
is really practical I hope you don't
have to actually put this data into your
databases but I was trying to figure out
all right so data types that we have so
the data happens that meat that I want
you to use this I want you do not use
characters I want you to not use you
next time with you and have to in Oracle
it's date time stamp tanks number time
zone times them with local time zone and
intervals the other type that we can
store data or day types in and this is a
little bit of an excursion into other
databases so my secret has something
that I I wish Oracle had
they actually have separate times for
dates and time so you can store only the
date that something happened on so like
my birthday there's no reason for if I
want to store the birth date of a person
and Oracle you always have to store a
time component you can make it 0 0 0
hours 0 minutes but you always have to
sort the time component with it in and
my secret can actually store just dates
or just times or both of them or
timestamps yeah
we get that in a bit and that's one of
the things that leads us back to the
initial problem we will so get back to
that my sequel also allows you to store
0 as a date so if you use a date and you
store 20 18 February 0 0 that in my
secrets of valid date you can use that
to compare to other things that happen
in in February so you can compare this
day to anything that is in February or
you can say I don't want this because
this is weird and then you just set the
no 0 and date parameter by default my
sequel will warn you of invalidates
select the forty-second at 2040 second
or February by default will be invalid
if you really want to store that you can
set a parameter called
in allow allow and validate and you can
you can store it that's the sizes let's
not try to remember these you can look
them up if you want to puskÃ¡s is very
similar it has to to my sequel they do
the same thing with date and time and
and combining them and they have the
option of storing the times on either
yes or no it's only an Oracle Oracle we
don't like in Oracle there's a time
stamp our data it called date but date
is not the same as in my Seco as we just
the date date and Oracle also stores the
minutes and the seconds hours minutes
seconds and then time stem stores
fractions of seconds and then as time
Stanwood time zone that also stores on
the time zone with it and then there's
times them with local timezone that just
stores the time zone the local time at
the server and it stores it and it will
give it back to you in this session time
dates and Oracle stored as as always 7
bytes it's always fixed thing and they
have separate bytes for storing the
century of the year the hours and the
minutes so they could probably do it
more efficiently and crunching the five
bytes but they choose a different byte
for each and the other weird thing I
think is the next slide this is so I
just created a table with there's better
date column and what I stayed in there
and if and then I fetch the date and and
the dump of the date and if you look at
this it's 22 it's 1016 and 42 seconds
Oracle actually stores that as it would
not set up one so the 22 becomes a 23
and the 16 becomes a 17 and the 42
seconds becomes 43 seconds here and then
the the year 2013 is actually 120 and
113
so this hundred officers actually to
store the BC and AC so if you want to do
like 2013 before Christ would be 0 20 0
13 and I haven't quite figured out why
they do the offset of 1 for the hours
minutes and seconds I can only imagine
it's for its for making sure it's never
0 because 0 has thought of this meaning
of null sometimes that's what I think
and I also think that storing them
separately byte by byte makes it easier
to compare like if I want to know give
me all the events that happened on the
5th of November I don't have to do a big
range just have to the way quality
checks for these bytes and I don't have
to look at these bytes at all I think
that's why they do it separately
Thanks if you do dates in memory if you
do dates and PL sequel or if you just
look at the the date as you get it like
like over here I do selects estate and
then dump off the cyst date so I'm not
storing it to a table the weird thing is
we don't get this offset so in this case
we get a different type so the type is
12 and the type of is 13 for in memory
dates and you see it's 2nd 42 and it's
2nd for you to here and we're here the
42 seconds get translate into 43 also
it's 8 bytes long now so that's that's
weird I didn't figure out why that is
but it's it's just there
Oracle has a time stamp type where you
can specify times them and then you
specify
season the precision is the number of
fictional seconds or the precision you
follow six if you do time stem zero it's
basically the same state it still
behaves different it's still different
type but its doors the same information
as a date and it's also 7 bytes long the
difference of if you subtract two two
dates like this effect one day from
another the result will be an integer
and it will be an or not an integer
it'll be a number and that'll be the
number of days between between the two
dates if you subtract two time stems
from each other we get an extra as now
that they've had back it's called
interval which can store both the
intervals but it's not numbers you can
come and do the same math on it that's
the same thing we're just dumped it do
that do this this is an interesting
slide this is this I think the only
thing where you actually learn something
in this talk so if you want to pay
attention these are two minutes now and
this is the different kind of functions
we have in Oracle to to modify dates or
generate dates
so the first easy one is is there's a
function called sysdate which will
return the current date and so that's
cool any idea what the equivalent for
doing the same with the timestamp titus
would think it's this times them but
actually it doesn't exist there is no
Oracle function that will give you that
we return a timestamp type and have the
current time step just doesn't exist
there is a command or a function called
sis timestamp
but that one returns a type of time
stamp with time zone yeah I see that
there's another command of a function
called current date and idea what the
difference between sister and current
they could be
this state gives you the time at the
database server whereas current date
gives you the time in the time zone off
your client so if your client is in
different time zone than the database
server current date would give you the
time at your client so state will give
you the time at the database server
oddly enough there's an equivalent for
timestamp and that's called local time
stamp and then there's also a function
that does it for time so a time zone
that's called current time step so these
exist for all three ATO types if we add
or subtract we get it shouldn't I
shouldn't say integer I should say numb
number or I can also add or subtract an
interval from a date and I still get a
date back from for my calculation if I
do have already map on timestamps I have
to add or subtract intervals if I add an
integer to a time step it will
implicitly cast the timestamp to a date
and then return a date so I will lose
the precision in the the sub seconds for
date there's a Trank function and the
trunk function you can use that too to
just discard any kind of position you
want so you can discard either the
seconds or the minutes or the hours or
the month and I guess at the point we
discard the year you don't really have
much left that's really useful for
comparing comparing things no such thing
for timestamps there's some there's
extract which you can use to extract
certain fields so you can extract the
year you can extract a month but there's
no simple trunk function so again if you
do a trunk and a timestamp what you get
back is a date there's two date that's
easy to times them two x over x and if
you want to cast implicitly and then for
for adding stuff there's a function but
at months so that works on dates and
only use intervals on timestamps and
I've got some more somewhat trivia on
that in a bit but would think to
remember to take away from this slide is
that there's no sis timestamp that will
return a times in Thea type so back to
this initial problem right that I showed
is where I had this table and add a
credit when against this and I had this
column next execution time which was a
timestamp time so no time zone and when
I created I got an error back that they
busy told me you're trying to vary a
date that doesn't exist in this time
zone which is weird because I didn't
have
times on here the cry was actually run
against the view and this is what the
view did the view said give me the rose
where the next execution time is greater
than six times then - interval six hours
and if we go back to the previous slide
we realized that this times then - an
interval will return a time stem with
timezone type and this next execution
time is a different type it's just
timestamp
there's no time zone involved so what
Oracle tries to do is it tries to
compare apples with oranges to different
data types we have to sort of compare
them and to compare them Oracle has to
implicitly cast them to something they
compare them against and it implicitly
casts them two times them with timezone
and that's the problem it takes this
next execution time and it implies this
internal function which is some casting
and then it just assists extract UTC on
both of these fields and compares them
and I had to look it up but the way
houses extract UTC works is it takes
whatever you put in there but it's
really a times of a time zone and it
converts it to UTC time to compare two
times times to each other but if you do
not have a time don't attach to whatever
you put in there then it uses the
session time zone which is the clients
time and in this case the client was in
a different time zone when I ran this it
try to apply a force at times on off the
client to this time sandwich didn't had
a time zone and and I broke it and the
solution to this was either to make this
column next execution time at times then
with time zone and explicitly stored
with it or to to not do this this times
them or to explicitly cast whatever this
returns to Lister times them and discard
the time zone part of it right more
trivia we do this we add a month to to
the states a 30th of January we add a
month now we add an interval plus one
month any what happens
Aroha no era very peppery 30th February
30th doesn't really exist so you get an
error so yeah you can't do that you
can't you can't add an interval of a
month to the 30th January because that's
invalid so that's a bummer
I really want to add a month to this and
luckily there's a function called add
months so we can add run add months to
the 30th of January and that will return
a valid date if we return the 28th of
February that's neat and time to view
this we add months the 28th of February
I think we can agree that the result
will be valid 28th of March
that's the 31st of March so the add
months function is kind of smart enough
to or it has this smartness built in
where it says if you add months to the
last date of a month it will actually
set it to the last date of the next
month and what haven't tried it yet
that's a good one at 12 months to go or
something yeah I'm gonna try out dates
and indexes so I built this big table
called big tap and I'm running this
thing on it and it has an index on this
calendar this column last DDL time has
an index I run this query against it is
simply crabby I just want to say where
give me all the events or the roles that
have the last DDL time and that has a
date portion of 2011 September 8th not
worried about the times because that's
what the trunk does trying busy says
discard the hours and the minutes just
give me the date and I ran this and it
went for 7 seconds and then I rewrote
the query to be a bit more complicated
and I said don't do the trunk on the
last EDL time but do way between when
you have September 8th and September 9
and the same query on the same data set
ran in just 20 seconds and the the
answer to this is why is this so much
faster is because the execution plan was
able to use an index scan
because we had an index on a date column
and I was actually comparing dates
whereas in this other case where when
with the trunk with the trunk the
execution plan has a full table scan
doesn't do an index scan and the reason
for that is we are not comparing the
actual date we're comparing the result
of a function trunk as a function and we
are comparing the result of the function
trunk to a date or an index that only
has a date but we can't do that and
Oracle has to cast where to apply the
function and after that it doesn't can't
use the index anymore
so you're basically preventing any index
access that's that's true a lot of times
for when you use functions on anything
you have in your in your where course
the solution to this could be either to
not do that and to do the slightly more
complicated date logic or to order use a
function based index also if you do
partition pruning it can also not do it
on functions left the other the other
thing the second example I have the same
table but I do not happen index on this
column so the column create it does not
have an index on it and I run my query
the same thing that looks a bit more
complicated because I have to pass a
date twice and run this and it ran for
five seconds so five seconds without
index that's that's alright writing the
same thing same column with the slightly
nicer looking syntax but using a
function now we're twelve seconds that's
two two and a half times slower for the
same query same result same thing and
the reason why it's the slower is
because now Oracle for every row would
retrieve said both both curries do a
full table scan but the one with the
function has to apply the function for
every row would retrieve so every row it
retrieves it has to call the function
get the result compare that next row
call the function and compare the result
and do that so it's a lot more overhead
and in terms of what you have to run so
I guess the the the thing I want to say
is it it may be worth to use this syntax
where you just easy pass a range again
in pass two dates
rather than being lazy and truncating a
column
and that's again it this is an Oracle
problem it's because in my sequel or in
Postgres you would well that's a cable
you would just we just use a date
datatype which has only the day in it
and you would compare that you wouldn't
have to worry about discarding the
defined portion of it
another fun example back from back from
Germany we had this application that
this is this at the way they produce
dates for some reason whilst they pass
Annika string like 20th of June 2012
they passed that and then casted it to
date which worked fine in June but fine
in July who was fined August but fine in
September and it broke in October and
the reason for that is that database was
doing it in English and the application
was speaking German and in German
October is written with a cape so it was
passing 2004 first of all Katie and I'll
get no way how to interpret that so if
you want to you want to do this make
sure you set your language right and you
said your um you said your date string
right because otherwise babies might
just get confusing this is this one of
these nasty box where you put in the
code you do some testing on it and you
run it for three for five months and
then it breaks it's really annoying
time zones well four minutes can you be
fine
so in the beginning of time there were
no time zones and it didn't really
matter because there was no internet
there was no way of calling somebody on
the phone so it didn't matter and what
people did or what cities did was a city
had it would have a local clock tower
and they would set the clock roughly so
that twelve would be sort of high noon
and they were fine everybody would set
their clock to the local the local clock
and it was fine and it's actually the
railroads in the US that demanded the
introduction of time zones because
railroad companies try to put a schedule
out for when they when a train would be
somewhere it's really weird every city
has a different offset if every city has
a different officer to the next so they
said can you please agree to have
certain time zones where let's do three
or four times on this continent and it's
just divide them all by one hour and all
of your clocks should be synchronized so
that the train only has to do with this
time zone witness when they cross a time
zone line
didn't-didn't stay at one hour some
countries then decided we would rather
and not do this like India said we we
are kind of in the middle between two
time zones but we don't want to do two
time zones because that's weird so they
just agreed that they would do have a
30-minute offset to UTC yes I think six
and a half hours ahead of a few TC
that's weird and then there's some small
I think Australia has a is a small part
in one of their provinces that has a 45
minute offset and some other islands
also a 45 minute offsets which is really
weird when you schedule meetings but
these people and their Canada doesn't
show a meeting on the top of the hour
but on 45 minutes passed it's weird and
then the other thing that happens is is
daylight saving time and so somebody
came up with the idea of saving energy I
think and actually I think it was before
about in the 70s this was a big topic
because people thought they had to
conserve energy and the idea was to have
more daylight time in than the day so
people introduced daylight savings time
and you have this in the u.s. we have
this in Canada that was in Europe
countries that are closer to the equator
don't do this and then also country
students at different times actually you
have we had most countries synchronized
until George Bush said let's just make
daylight saving longer let's make it
longer by two weeks in the beginning and
two weeks in the end and sort of short
notice and I think the first year the US
did it Canada didn't do it so there were
two weeks in that year where Canada and
the US have different offsets for two
weeks because of daylight saving that
was weird and it's still weird
so Europe is still changing next week
our this weekend and we already changed
last week and the weekend before so
that's weird and then some countries
also change how they update your time
zones or the daylight saving times and
Oracle can only keep track so often so
there's some there's an Oracle time zone
file which get up gets updated I think
once a year or once every other year if
you do an Oracle upgrade you usually
have to upgrade to a certain time zone
version between that most people don't
bother and don't update their time zone
file I used to work for a company that
did the noble shipping and global
tracking so we had to know when it truck
arrived somewhere if the next guy could
pick it up so we actually had to buy
their own time zone files so you can
actually pull
The Times information from some global
standardization company and you can
convert it to a form that Oracle
understands and you can actually update
or occur with that map of time zones of
a map years ago traveling through Egypt
I wasn't even staying in Egypt I was
just flying through Egypt and then a few
weeks before my flight I got this weird
email saying there's some weirdness with
our daylight saving and if you book your
flight between a certain time another
time then the time that's in your ticket
is not correct add an hour if you booked
it another time it would be correct and
what Egypt did was with very little
notice of I think three or four weeks
they decided let's do daylight saving we
haven't done this for a century or for
20-30 years but this year that's -
daylight saving - everybody else does
but then each of us also Muslim country
and they said we don't want to be doing
Ramadan so they changed today light
saving in March and then in June when I
was Ramadan they changed back to not
daylight saving at the end of June they
changed to daylight saving and then
October date was September they changed
back to not daylight saving that was not
much fun for me when flying because of
course none of the other airline
schedules have been synchronized with
that that was and that was actually a
it's worded for Oracle then the year
after that I didn't know - Oracle and
they went to this you you know what this
country is ours lots of flame towers
it's an other bhaijaan that's a really
cool country
it's like Dubai but it would actually
culture like they have amazing buildings
and amazing oil money but it's also
really really old culture so on that's
pretty cool and difficult I get 4000
year old city centre really cool anyway
I got to the city fly in set my alarm
next day so I wouldn't miss breakfast
and my alarm goes off I go downstairs
and they tell me no no breakfast is
already done what happened was that
again was Apple damn Apple Apple hasn't
updated the time zone information for
Azerbaijan correctly and the somewhat
politically incorrect but timing wise
correct thing for me to do was to force
my phone to be an Armenian time but the
politically incorrect thing is that
Azerbaijan Armenia and are in a war and
they don't recognize each other's
countries but that worked because Apple
time
correct for Armenia it wasn't correct
forum for other bhaijaan so I miss my
breakfast still to the conference it was
fine and then just last week my wife was
back in Germany and she was arriving
back on Friday to Montreal and the
scheduled time was 7 p.m. which but
really fine for me I thought well that's
cool it's a two-hour drive to get to
Montreal I just do my regular day leave
at 5:00 and then get to Montreal at by
7:00 only that remember the US or Canada
already change daylight saving you a
Europe hasn't the flight is still 8
hours long but it's busy starting an
hour early now compared to us because
it's daylight saving time so the flight
arrived an hour early and I had to
cancel a meeting and rush to the airport
quickly didn't realize that so time
zones got me skip an hour and March yeah
when we do a skip an hour mark that's
why this in Bella period happens but
that's better so one hour just doesn't
exist and also our different countries
do it at different times so here in the
US I find it weird because in the u.s.
we switch from or in Canada same it's
its visit from 1 to 2 or from 2 to 3 2 2
3 but it's the same in every time zone
right so New York changes for Chicago
changes no New York change from 2 to 3
then hour later Chicago change from 2 to
3 hour later mountain time change them
to the three and then Pacific time
changes so you've got these four weird
periods that don't exist but that are
not in the same time that's right
correct that's where Europe is much
better than than North America at least
in Europe they do these changes at the
same time so the UK's changes from one
to two central you have changed in two
to three Eastern Europe on three to four
so at least they all happen at the same
instant I have to worry about all these
witness thanks so much if you really
want to do this because other time
October's this the other weird thing
where you have the same
yeah possibility of having a same thing
time twice because you go back from 3 to
2 or from 2 to 1 and then you you have
two potential of actually creating
events with different time stems or
different times that have happened
different order than if you were to
order them by the time or you do the
interval between them if you want to
avoid that and already you can set a
parameter called
era on overlap time and if you set that
it will throw an arrow and just say you
can't do this I I'm afraid of touching
this time because it's gonna be weird oh
yeah Germany always good with the trains
when we do the switching back in October
obviously be it because you happen what
if your train is supposed to arrive at
the station at 2:30 the way they deal
with this is they actually stop the
train in a station so whenever you draw
a train in October in Germany in the
night the train might be unscheduled and
it will just stop at the next station
wait for an hour and then go I don't I
don't like trains and this is one of the
reasons I I guess it's then again it's
only happens once a year one of the
solutions it is is if you if you don't
wanna deal with time zone madness in
your applications and systems my tip is
to store and use UTC time it's also
really useful if you have to compare the
output from different logs or different
systems and servers across different
time zones always weird so I try to
convince a well should you just use UTC
because UTC doesn't do this whole offset
madness it's just UTC doesn't do like
saving as the reference time for
everything else
almost done here explicit time zone
names right so I try to do this 2:30
Pacific Standard Time in September and
this was invalid because this didn't it
oh and March this didn't exist because
that's when we set the clocks forward an
hour same thing Eastern Standard Time so
I tried to do the same thing
give me the 2:30 which shouldn't exist
because that's when Eastern switched
forward but oops this worked that's
weird and I think it's because yes tea
is actually the eastern summer time or
something and I learned the hard way to
actually be more explicit and say I
wanted to use u.s. Eastern and for the
u.s. Eastern it says here that doesn't
exist the u.s. Eastern has this EST and
valid period implemented and est for
some reason doesn't that's nothing I
learned that's just an example of this
overlap time it's the if you set this
parameter the arrow on overlap time true
it'll just fuse this error if you try to
reduce a timestamp or a date and the
overtime right two and a half minutes to
talk about each second
so Pope Gregory was pretty smart but not
completely smart because we realized
that UTC is defined by some astronomical
thing that I don't understand but you
can't even predict it so it actually
depends on some gravity patterns in our
solar system I guess as to when actually
UTC time is defined so astronomers are
measuring this and they sometimes have
to add or remove one second to keep UTC
and all other reference times in sync
with how UTC is defined which is some
astronomical thing they have two times a
year when they are allowed to do this at
San Julian December and they can either
add a second which has happened several
times or they could make a second
invalid and just skip one second and
they haven't done the invalid thing yet
or the the shortening they always had to
add a second
and there's two things that can fail
there's the operating system and there's
a software where and and that's that's a
bit weird
so Oracle Oracle doesn't deal with this
or it has no idea or that's what I'm
basically saying is there's a time in
June December where 23 59 60 seconds
does it actually valid time so on 58 59
seconds 60 seconds and then it's 0 1 and
that's an actually valid roughly valid
time Oracle doesn't know what this
Oracle does not an Oracle implement the
Gregory thing they implemented it time
zones and the data it's saving stuff but
I think this is where Oracle just said
yeah we have enough we won't do this so
you can't be the seconds always have to
be between 0 and 59 so if you if you
want to avoid this error you have to
fool Oracle and to never getting assist
I do you select the state from Oracle it
might just sue because the operating
system might be smart enough to do it
and that's what you have to you can't
configure NTP the time demon in Linux in
different ways where you could let by
default it would actually give you a 60
seconds so this is a simulation of that
and it gives you a 60 seconds and that's
where Orica gets its time from if you
just this time it will ask the local
system time it will fetch this you can
also set a different mode where but just
report the exact same time for a whole
second so for one second interval it
will just return the exact same time
from the system you can also turn the
time backwards which I find much weirder
so you go from almost 60 seconds so 59
seconds and 96 hundredths back to 59
seconds nd right 6 so that goes back to
the whole I've got a second that sort of
happened out of order and if you do this
skipping that's that's this example so
you can skip from 59 58 back to zero and
that's those are settings in your system
so if you want to get this right
set this fit this thing luckily this
doesn't happen so often and we don't
think about this but it might right 10
seconds 13 seconds are over don't
reinvent the wheel please don't use the
kappa
workaround don't use the unix times if
you don't have to don't trust in locales
and/or in languages it's easy it's easy
on this console because everybody speaks
English or French or Spanish
or any other language avoid functional
datums if you have a where class and you
use a function like trunk or anything
like that on a column it will slow a
database down because either you have to
leave if the sequel context execute a
function and come back or you avoid the
use of indexes try to avoid implicit
casting that was the original problem
where I compared at timestamp with time
zone to a timestamp and whenever you
leave casting to Oracle implicitly it
might just do weird things so think
about the datatype that the function
returns and either cast it explicitly
yourself or unused the same day I'd have
to both time zones can be really complex
and I gave you five examples of how I
got screwed by this and consider using
UTC if you set up new systems and you
get asked what time zone so you want to
set the system up in remember this talk
and say you are in said something what
UTC that's probably a good idea but this
time I say thank you very much
I hope this talk was somewhat useful I
try to enjoy giving this but I also
realize it doesn't have a ton of super
useful information anyway thank you very
much</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>