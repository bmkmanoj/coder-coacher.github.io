<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Building Real time Data in Web Applications with Node js | Coder Coacher - Coaching Coders</title><meta content="Building Real time Data in Web Applications with Node js - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Building Real time Data in Web Applications with Node js</b></h2><h5 class="post__date">2017-07-29</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/uR1Oo8nfb_Q" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">quick I just want to get a sense for the
crowd this is a first Oracle code so we
don't really have a sense but any
JavaScript
in the room decent amount all right a
view any node.js developers okay and how
about maybe Oracle database developers
okay so we have a decent mix I'd say it
skews toward JavaScript good to know
well now that you know a little bit
about about now that I know a little bit
about you I'll tell you a little about
myself my name is dam again I'm an
Oracle developer advocate and I focus on
the javascript in html5 communities I
have my contact info here but we'll make
these files available after the talk and
you can reach out to me at any point in
time if you need I'd love to hear from
you so this is the agenda for today I'm
going to start off talking a little bit
about the past kind of how we got here
and then we're going to talk a little
bit about where we're at now and then
finally I'm going to talk about how to
mix in the database but before I do any
of that I want to do the demo first
so if if you could please help me with
this what I'm going to do is show you
the app first and I'm going to give you
a URL and if you could go to that URL
and just participate I'd really
appreciate it so this is the app that
I'm going to have you guys go to in just
a moment and what we have here is a
listing of all the cities that Oracle
code is going to be at right so this is
the first one in San Francisco and going
to Austin next and so on and so forth
and what you do on the left here you'll
see the city name and its current
ranking and right now everybody's ranked
number one because they're tied there
are no votes that's going to change very
soon I just want you to pick your
favorite city might be a dark horse in
the room I'm kind of expecting San
Francisco to to win today we'll see
you'll see the number of votes here in
this column and finally this is the
button used to actually cast a vote now
once I switch to the dashboard you will
see what I'm going to leave up on the
screen but that's not what you're going
to be using and you'll see at the top of
URL I want you to go to as soon as I
switch to the dashboard you're free to
go there but I'll briefly explain the
dashboard itself so this is the URL just
go to bitly bit dot ly / Oracle - RT the
RTS for real time
and what we're going to see here is the
total number of votes submitted as well
as the updates pushed I'll explain that
and a little bit and I don't see
anything coming in yet
so I'm going to cast a vote myself ooh
ooh hey is that New York City New York
City's on the map folks New York City is
in first place right now
Oh San Francisco on for New York City
guys San Francisco is in second and it's
not doing so hot we got 48 50 total
votes submitted so far okay so it looks
like Tokyo just passed Sydney Tokyo is
doing all right in third place New York
City is killing it guys I'm casting for
out so uh San Francisco stone second
tokyo's oh they're still in third looks
like London's coming up real quick
Oh San Francisco catching up oh they
just passed New York City New York
cities fall in a second and now London
London's taking third Tokyo has dropped
already to sixth place Bangalore's
coming up we got Bangalore is in fact in
third now San Francisco is taking a
clear lead tell you what while you guys
are rocking the boat I got to pay the
bills real quick do a little work just
going to do a little a be testing I
don't know if you guys have ever done
this before but this is um a patchy
benchmark so I'm going to just run a
quick test here 150 concurrent users
10,000 requests I'm going to get that
going
okay paid the bills come back over to
see how the votes doing all right so
anyway
New York City's taking the lead don't
know how that happened my goodness New
York City's crushing it New York City I
believe has won this little contest all
right that's enough what I'm going to do
real quick and this is really just to
focus your attention on the talk I'm
going to enable a trigger which will
stop the voting now that oh no oh no I'm
disconnected
see if I can get reconnected and then
enable this trigger that's not working
alright I'll let that go I guess you
guys can keep boating but I do want to
lose by the end of this talk I do want
to point out one thing that's going on
here well this just too much voting come
on guys come on what are you doing let's
just disconnect here disconnect is going
to open this back up alright so all this
voting over shortly but in the meantime
I want to point out some of the things
you're seeing so notice the total votes
submitted that's how many votes you guys
are actually submitting in the stream of
course I did like 10,000 just myself but
notice that the updates pushed is far
less and this was very intentional I
didn't want like all these round trips
going cyclical you're familiar the
JavaScript folks they raise their hand
you're familiar with addy bounce right
so imagine a users typing in an input
field and you're doing some kind of ajax
request when they're doing it and you
didn't want to do it on every key press
you maybe wanted to do it every 300
milliseconds or something like that
that's actually what I'm using here very
similar technique only in the server
side I'm going to show you how that
works in just a bit all right let's see
if I can disable this voting
whoo-hoo it's over in who on New York
City okay good deal at precisely 12 27
the crowd turned on Dan all right so
let's talk a bit about how this came
together so we'll start with how we got
here so HTTP came out around 1997 acts
act says about 20 years ago and HTTP was
a simple request response protocol right
so the web browser would make a request
to the web server the web server would
just find a some kind of static file and
then respond with that file to the
client pretty simple but eventually
things got a bit more complex as we
realized that we can involve a database
in the mix and generate dynamic web
pages and the way that would work the
web browser would still send its request
to the middle tier the middle tier would
then use a database driver request
communicate fetch some data from the
database the database would then return
that to the web server it would use that
to generate the dynamic web page and
then send the HTML content back to the
web browser this was fine for a while
but when you think about it the web
browser at this point may be in sync
with the database data but all of a
sudden you know somebody's oh sorry real
quick some of you folks might be
thinking well actually Dan we use
transactions in our database and so our
content or our traffic looks a bit more
like this
and in fact we have to shard our
databases globally so we have more
database servers it looks a bit more
like this and you know what we're also
auto-scaling our web servers based on
CPU and memory utilization so it looks
like this and we're doing all that work
because we got a whole lot of users
right and so our web traffic is looking
more like this right I get that I feel
your pain this is what it's like to be a
developer these days but for this demo
we'll keep things really really basic
right so the web browser is at this
point in sync with the server but then
of course what happens someone goes in
and updates the database and now we're
at a sink so what's a developer to do
well we could from the database
let the
webserver know that there was in fact a
change we've been able to do this for a
while I'm going to tell you how we could
do it now that's always been possible
what has not been possible until
recently was letting the web browser
know about that change directly that was
impossible and for very good reasons
it'd be kind of weird if of surrogate is
tunneled through your firewall and you
know access your computer right the
ability to do this securely didn't exist
until recently and that's what we're
going to touch on so Hugh has probably
do some of this too but because it
wasn't available that started some of
this like push to simulate this kind of
thing using various techniques and raise
your hand if you've if you're guilty of
doing any of these so there was the
forever frame at first you would put an
iframe within your webpage and it would
be invisible and you would you'd set
timeout to kind of pull the server and
just bring in data and proxy that up to
the to the parent page anybody do that
that one actually worked all the way
back to ie6 not a lot of things did but
then we got Ajax and so it made Ajax
polling possible and and frankly I'll
admit it I still use Ajax going today
you know smaller projects why not
the problem with Ajax pulling is that
you're often going back to the web
server of course but then the web server
to the database looking for changes that
don't exist and so you're putting load
on the database that shouldn't be there
right not very efficient then we got
Ajax long polling now this one is super
cool a single request goes from the
client to the web server the web server
keeps that connection open until a
change actually does happen and when it
does it sends that change or at least
some kind of notification or data to the
client to let them know and then usually
reestablishes another long pole great
technology my personal problem with it
was at the time it was it was cool and
trendy I didn't know how to do it
I knew JavaScript but no Jess didn't
exist right and so you had to have
skills and talent around web server
technology you had to create your own
web server and I didn't know how to do
that so it wasn't an option for me now
with with not-it's like of course you
create the web server right and then
there was html5 server sent events this
almost bridge the gap completely a lot
of folks don't even know about it we
just kind of glossed over because of
websocket technology but it's very
similar to long coin in a way but the
server would then to send an event with
data and you could listen to the event
none of those quite worked very well but
where we at now well some new
technologies have emerged and really
allow developers to do these things the
right way the first of which is web
socket and web socket is really cool in
that it allows bi-directional
communication between the browser and
the web server and it works over HTTP at
first this is important because this is
what gets through all the firewalls and
the proxies and whatnot and so it starts
with HTTP but then requests an upgrade
and once you're on WebSocket you get
that bi-directional communication but
you also have more efficient
communication because there's no more
like HTTP headers going back and forth
and that kind of thing so really great
technology and its really great for
using push from the server to the to the
clients there's also web RTC now WebRTC
RT C stands for real-time communication
so naturally you might think that this
talk is going to be about RTC WebRTC but
it's actually not now this technology is
really cool but rather than connecting
the servers what it's usually used for
is connecting peer to peer and this is
great if you're for example building a
video conferencing application right
where you have an audio stream and a
video stream you don't want that latency
of going to a server and and back out to
another client right you can just
connect directly it's a little bit
difficult to do in that it requires a
turn server ataxic get the clients
connected at first and once that's taken
care of they're directly connected and
everything streaming obviously great for
audio and video streaming but it's also
great for arbitrary data including video
gaming these days it's really important
to cut the latency there for me the
problem in addition to the turn server
with WebRTC is just browser support this
may be okay for some folks some
solutions but for me it's just kind of a
non-starter right now I eleven edge 14
Safari it's like they're not even trying
so I don't know if that'll ever be a
thing but Safari is used you know anyone
on a Mac's probably isn't Safari
websocket on the other hand has a whole
lot more green so it's just a more
reliable protocol to work with right now
here's an example of using WebSocket so
within the browser we can just declare a
variable new WebSocket and just connect
it to the server and then we can add
event listeners when the connection is
open we can start sending data down to
the server and of course they can start
sending data back we'll add event
listeners for when a message comes in
and then we can log that data out now
that I've shown you that API I'm going
to have you forget about it very quickly
and the reason is it's a very low-level
API and a little bit tedious to work
with and it's not supported by every
browser right so I would recommend you
immediately switch over to socket IO
socket IO is really two parts there's a
client side and server side and we're
going to look at that
and hear a little bit but it starts with
long polling that that technique that is
pretty cross browser works everywhere
but if WebSocket is supported on the on
the browser it will immediately upgrade
and you get that advantage of web socket
technology very simple API even easier
than web socket itself
it handles multiplexing which is really
just name spacing so you can have the
concept of separate channels but they're
really using the same connection you
really only need one WebSocket
connection when working with socket IO
we also have the ability to have create
rooms so you can group your users but
then a certain namespace in a certain
room which is great for chat and you can
use it for all kinds of other features
and then Auto reconnect this is really
important imagine someone's on your app
and they go through a subway and they
get back out
obviously that connection was severed
right well socket IO will immediately
wake back up and try and reconnect to
the server as soon as you can so these
things are important socket IO does all
the heavy lifting for you easy to use
API why not take advantage all right
let's take a look at some of the
front-end code that I used to put this
application together we'll just focus on
that for a bit
so this application was constructed in
two parts we have the server and the
client we look at the server first and
so everything of course starts with the
index study HTML but I ended up
deploying this application to the Oracle
cloud we have this application container
service it runs node.js and so what they
requires this manifesto JSON here say
that real quick so this is a real simple
file right now as file is going to get
more complex over time as we build in
more features but notice right now I'm
just saying you know what version of
node I want it to use and I'm also
giving it the command it's used to then
start my node application so once that's
done it goes into index so what am I
doing here I'm bringing in our Oracle
database driver I'll also bring in an
Express for the web server and then we
have both a public API and a database
API now this is a little unique most of
the time you have a public API the one
that is you know facing public Internet
I'm creating a database API as well
because I want the database to be able
to let the web server know when changes
have occurred to data that's why I'm
doing this so if we come down a bit
let's see what's relevant so the first
thing I'm doing is creating a connection
pool note that I'm doing that prior that
this is a connection pool to the
database and I'm doing that prior to
initializing my web server because I
want my web server to immediately taking
requests from the screen and will send
them through and as I said this is an
express based web server I'm using
Morgan for some simple logging as a
request comes in I have body parts are
working with JSON and we're dishing out
static files from the root directory
I've enabled cores because when I'm
doing my local dev not in the cloud I
host my app on a separate port and so I
need everything to work I write cores
let's that happen and then here I'm
mounting that public API which exposes a
router I'm mounting that on the path
slash API and then I'm mounting my
database router
on slash DB a DB underscore API now note
right before I do that I'm invoking this
init method
we'll drill in on that that's in that
the DBA PJs so this file brings in
express again socket IO at this point
now remember sock and IO is two parts
one part is going to be on the server
and that's where we're looking at here
and one parts going to be on the climb
we'll see that later when we get to the
front end code so we bring in the server
side socket IO and all I'm doing with it
I'm exposing this init function and the
only thing it really needs to do is take
the HTTP server and invoke socket IO and
pass that along that's all it needs to
do that one line socket defies our
connection to the client that's all we
need to do now I have this instance of
the socket IO library and what I do down
here oops I use that to omit changes and
this is just a string but I'm kind of
using it for a simple namespacing
without this namespace in the socket IO
provides to keep things simple so I'm
just saying omit cities got change and
I'm passing on a body and I use that
when a request comes in so here's our
router for the database API if a request
comes in on slash super city's a get
request then I'm using the public API
I'm just kind of coming right back
around and getting the various cities
and then when I get the response that's
what I'm sending out to the clients via
web socket technology alright so then we
have the public API I'll show you that
real quick too so when you went to that
web page and started voting we needed to
see the cities right we needed the data
about the city so this is what fired so
we have a router and I'm routing slash
super cities get requests to this
function so I'm using the database
driver to get a connection to the
database and I'm executing this query
now focus first on this sub query
because this is the mean potatoes right
I'm getting ID name and date as well as
account by city of the number of votes
but then I'm using some analytic
functions to get the ranking that you
saw which was in which place as well as
the sum of total votes and I'm doing
this in sequel because I can do it with
two lines I could do this in JavaScript
as well and have each of your browsers
do it but it's just a little bit easier
with two lines of sequel sometimes the
other part of the API was here
and so I'm routing super cities and then
on the ID that's just a parameter slice
votes a post request gets a connection
and simply doesn't insert into the
database letting me know that you voted
for that particular city right with me
so far alright so let's take a look at
the front-end so for this app I built it
using the Oracle jet libraries jb's in
the back these BPM for Oracle jet so if
anyone has any questions I'll direct you
right to JV and so Oracle Jets a pretty
cool library it's it's unique and that
it's a full stack it's it's not really a
library it's not really a framework they
like to say jet stands for the
javascript extension toolkit because
it's a collection of already existing
well-established JavaScript libraries
such as knockout Jas require Jas and in
a number of others jQuery jQuery UI and
so on and so forth so it's in some ways
you could say it's a little dated but
I'll tell you if any of you are feeling
that the JavaScript fatigue that's going
around these days take a look at Oracle
jet and the other thing that it does
really uniquely is that it provides all
the capabilities in terms of going up
through the UI so that chart that you
saw all that's just integrated into jet
you just download jet and you're off to
the races you don't have to go find
other libraries could wrap up and
running which is the normal you know
type of thing you have to do if using
angular react or any of the other
libraries alright so it's a jet based
app and where should we start so here's
our source code
and we'll start in the JavaScript and
the first thing I'm going to show you is
the config I'm sorry I'm not to
configure the main j/s and this is where
you see where I configure requirejs
this is what it looks like and note that
I'm bringing in socket IO so you're just
pointing the location to a name and if
it's not AMV aware a synchronous module
definition aware you often use these
little shims to just basically get
whatever it is from the Dom and then we
can refer to it by name so I'm using
this little shim here that's how I
brought socket IO into the Oracle jet
environment and then I created this
little module right here it's very small
but it brings in requires in socket IO
and I map that to this parameter here
and again I did this on the server side
I'm doing here on the client side
I want a single instance of socket IO
because I just want that one connection
going through so I return that instance
and that's what I'm going to be using
throughout the rest of my application so
what do I use this well jet is composed
in modules and a module is really just a
view model and a view combination and
they are grouped together by name you
could rearrange as if you're like I'm
just using the default configuration
here and so we have the page that you
are looking at super cities I'll show
you the view first so we'll look at
super cities HTML and this is what some
of these jet views look like so this is
our main wrapping div and this was that
title you saw at the top what's your
favorite city and here I'm using an OG a
component that's Oracle jet component
it's a ListView component and I can
point it at some data that's going to be
exposed in my view model and I can use a
template for each of the Li elements
that are going to end up in this
unordered list so we see that down here
this is embarrassing I should have been
able to figure out how to do this
cleaner
but I couldn't in time for this talk but
I'll clean that up before often so this
is what a view looks like and so the
text for each li element is going to
show the rank value and I wanted to
apply color so if you are in first place
you're going to be green if you were in
dead last you're going to be red and we
had a lot of middle ground too and so
then you see the the name of the city
you're voting for the number of votes
that it has and and then we wrap in this
the button which is another og component
using icons and the click event handler
goes into the parent scope and invokes
the upvote method that was added to the
view model so let's take a look at that
view model this is the super city's view
model so we're just requiring in the
various modules that we need so real
quick
this talk was supposed to go to 1250 we
started about 10 minutes late so I'll
leave it to you guys
do you want me to fly through the rest
and try to end on time or do you want me
to go to I guess one and be a little
late for lunch late for lunch alright I
appreciate that thanks guys so what are
we doing in here well note self get in a
little closer so you guys continuous so
self is essentially going to be the view
model and anything we put on self is
going to be exposed to the view so the
first thing I'm doing is exposing this
data source that's going to be used by
the the list component you saw on the
view and then the there's a life cycle
system built-in so for example when
we're transitioning to this particular
view this one will fire but it's before
you know the Dom is available and so on
so I'm using that Handler to invoke an
ajax request and note i'm going to that
super city's URL this is what we saw we
set up the router to handle the request
coming in on and the server side so we
get the city data and then i loop
through and I'm sorting it here
I've actually done this in the query to
just little sort order by but I'm doing
it in JavaScript instead and then I loop
through and I'm pushing each element
that came in through the Ajax request
I'm pushing that into our observable
array but this is a knockout observable
array and what's unique about those you
know if the data changes in the array
the view will automatically update to
accommodate that change it's similar to
angular angular to dirty checking for
for that kind of thing dirty checking
turns out didn't scale very well for
really large app so they stopped or
moved away from it angular to this scale
is quite well because you're only saying
what should or should not be observable
down here I had to disable the ListView
by default it does some cool you know
transitions animations I actually didn't
want this because when you think about
it there was a lot of stuff coming back
to you guys and I didn't want the list
constantly refreshing with animations so
I needed to keep it really simple so I
just disabled the animations now here's
that upvote function so when you click
the button to cast your vote this is the
function that was firing just another
ajax call going against super cities and
unique city ID slash boats all it needed
to do was a was a post and now here's
that io so i'm bringing in that one
instance of socket IO that I have in my
client side and I'm saying on cities
change and you saw that event name on
the server side but we were doing Amit
so Amit can push the data and this is
how we add a listener for it and all I
do I take the data when it comes in and
this is our data source for the ListView
I invoke the change method just letting
it know we have some new data and it
knows how to match on ID and update the
data and then of course the view
reflects all of our changes so that's
how the view is put together cool so
that's how we might do this for our
front-end and our in our mid tier but
what about the database how do we get
the database to play in this interaction
well for any database to participate in
this kind of interaction it needs to
have two things number one some kind of
events to work
and number two the ability to
communicate when those events occur if
you've been using Oracle or actually
many databases at this point for a while
the the probably default you think of
when you think of events is triggers and
so triggers really simple there's two
main types DML or data manipulation
language triggers and also system
triggers so examples of DML triggers are
like before the insert of a row or after
a row is updated we also have more
advanced triggers like instead of
triggers which can reroute vml against
views so that you can do other things we
also have system triggers like after
logon when a user logs in or before they
drop a table or create a table or things
like that you can respond to these types
of events and you might think hey we
could use the trigger to send you know a
notification to the mid-tier that the
data has been inserted and then that
would work great so it's really simple
to do create a replace trigger just give
it a name so after insert on the vote
table for each row and then we have this
execution section now this is where we
would notify nodejs
and I'm not showing you notification yet
we're going to talk about notification
in a second but the reason you wouldn't
want to do this is that a trigger
becomes part of the the DML statement
and we're already doing a disk write to
make sure it's durable right we don't
want to add Network IO as part of this
transaction as well that's bad so don't
do that the next tool that we have for
events is scheduler and the scheduler is
a really robust tool within Oracle that
we can use to create jobs here I'm
creating a job just give it a name give
it a type and here's the code I want to
taxi cute this is just a stored
procedure and it'll start today at 1:00
p.m. and it will execute daily at the
same time and we enable that so this is
a really cool tool that calendaring
syntax that we can use here is
incredibly powerful but the neat thing
about scheduler is that we can combine
it with the trigger to solve the problem
we had before the the network i/o so
here I'm moving my notification
logic to a stored procedure and I just
called notify Jas and again we'll look
at notification here in a bit but now I
can go back to my trigger and I can say
instead use DBMS scheduler to create a
job and I can just tell it to invoke my
stored procedure what's unique about
this DBMS scheduler when it does this it
just sort of puts it on a background job
you know it's not part of the insert
statement anymore it's going to be done
by separate process now that would have
worked but maybe the metaphor wasn't
right
scheduler you think it's all about you
know when something happens related to
time not necessarily the insert right
nothing wrong with it
but maybe not the right metaphor there's
another tool with an oracle called
advanced queuing and this is a really
cool tool that you know it's like any
other message queue except that it's a
durable queue which is really important
especially when you're in situations
where maybe you're taking an order like
amazon.com or something along those
lines and imagine that in fact Amazon is
in this situation there's a lot of
complex things that happen when you
submit an order to Amazon and if you
really pay close attention they'll kind
of tell you that right we're going to
calculate your exact tax after you
submit your order right because that's
kind of intense so you don't want the
user waiting for those types of things
so what they do they just throw it over
the fence in the queue you got to make
sure it's durable though because you
don't want to lose orders right so
that's kind of what we're looking at
here and you can configure this in
different ways
so it can do point-to-point you can do
pub/sub however you want to use it but
one of the neat things about it is that
it does have a notification feature that
can notify you when something is in
queued into the queue which allows you
not to have to pull the queue all the
time to see if there's something new so
that's nice now for me though advanced
queue is way too too much for this
particular use case I didn't want to
have to create and maintain queues and
do all this kind of stuff I was looking
for a simpler solution and while I was
searching I came across this feature
called continuous query notification and
this is a super cool feature
that allows me to using PL sequel here
add some variables and I'm creating a
registration and here I'm telling the
registration what I want it to do when
something occurs and this is just the
name of a stored procedure and then I
can start the registration open a cursor
and provide a query and then close the
cursor that's it and now the database is
listening for changes on the results
that of that query if a change an update
insert delete occurs then my stored
procedure gets invoked automatically now
behind the scenes this is in fact
creating queues and doing all the heavy
lifting for us it's just a nice easy way
to do it maybe for your use case
advanced queues would be better or some
of the other options but this one was
the one I went with all right let's talk
about communication so you've had these
options for the longest time you tail
TCP HTTP has been in Oracle since 8 2 I
believe very long time you can also use
utl SMTP or mail to send mail and I
don't want to talk about those because
most the time communication these days
is done be a rest and the package that
you can use an Oracle to do rest
communication is Apex web service now
Apex web service is a PL sequel API that
came as part of application Express
which is a really cool sort of loco
development environment they have lots
of API this is just one that I can
leverage not even using apex right I
just get it for free so here I'm
creating a procedure called notify the
server and all I'm doing I declare a
variable which is a clobb and I set it
equal to a pecs web service make rest
request and I just give it the URL in
the method that's it rest done easy so
highly recommend this this is the one
I'm using let's take a look at the
database code
so the easiest way to show you this
actually is here there's there's two
things going on so you've already seen
the the database portion in the mid tier
which is I'm creating the the router and
the endpoint for the database to be able
to talk to the mid tier on right well
here's how we're actually doing that
communication so I'm using what I just
showed you this registration info object
only I'm calling a stored procedure
called notify super city's change and
you remember before I talked about the
the time-out capabilities I didn't want
to send a notification every single time
of okay man I wanted some kind of debunk
debounce functionality that's what these
parameters here about it's about
grouping notifications together and I'm
grouping them by time I'm grouping them
by one-second intervals so that's the
maximum that's going to come flowing
back at us again I just register our
very simple query because I'm just
looking for new rows and that part's
done and all I had to do and the
notification piece is invoke make rest
requests go against my API endpoint it
was a little bit more complex for me
because we're using HTTP so in Oracle we
have to make sure that's secure so we
have to specify wallet I'm going to make
the slides of course available for this
but also all the source code and I'll
include the bit on creating the wallet
so if you need to do that you'll have it
as well
also note that I'm using logger at the
bottom if you're not using logger you
probably should be if you're doing any
kind of PL sequel dev it's an open
source tool for doing logging and very
useful in a situation like this when you
know your code is sort of running in
another process and you can't track it
as well so that's why you see that there
ended up helping me quite a bit so
that's what the database side of things
ends up looking like
and I just want to touch on one last
thing this is native driver support this
is important this is where we're going
to go this is what the future could look
like that codes important it kind of
links back to that safe harbor statement
I showed you in the beginning of the
talk so to show you this what I want to
do is take our database code that's here
and I'm going to move it side by side
with this well it doesn't work very well
because I need to zoom in anyway but
remember when I registered the query
here I subscribed it well this is what
it might look like in JavaScript in the
future no more PL sequel right you're
staying in JavaScript land which is
where we want to be so I'm getting a
connection to the database and when I do
I could potentially use the database
connection to create a subscription
object a new instance of a subscription
and pass this callback here which is
defined here we'll see that in a second
so when data changes it will invoke our
JavaScript function and then those same
parameters were just passing them in via
JavaScript and down here under handle
query change I don't have to use Apex
rest requests anymore right it's already
that the database driver is going to
bring that notification to us directly
via the driver and so all we have to do
is respond as we did before you know
select some data and then use IOM it to
broadcast that back out to the client
make sense so hopefully that's where
we'll end up
but it's hard to say so I just have a
couple next steps here I'm going to turn
all these into links but if you're
interested in any these technologies I
invite you to go out learning code email
me if you have questions happy to take
those but I'll make sure I'm going to
actually fill this with a lot more links
because there's a lot of technologies
going on here from IO to jet trigger
scheduler q CQ and so on and so forth
but that's all I got
it's one o'clock I got to call it but
thank you all for staying late I really
appreciate it enjoy your lunch
here</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>