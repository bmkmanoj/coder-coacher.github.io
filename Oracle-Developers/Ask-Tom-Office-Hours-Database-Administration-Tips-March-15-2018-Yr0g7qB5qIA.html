<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Ask Tom Office Hours: Database Administration Tips | March 15, 2018 | Coder Coacher - Coaching Coders</title><meta content="Ask Tom Office Hours: Database Administration Tips | March 15, 2018 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Ask Tom Office Hours: Database Administration Tips | March 15, 2018</b></h2><h5 class="post__date">2018-03-26</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Yr0g7qB5qIA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">let's try that let's try again welcome
yeah so it's if you're here in the
morning in your time good morning if
you're here in the evening well hope
they haven't spoiled your dinner and
because it's Perth I'm afternoon tea
time for me
so wherever you are coming from the
world in fact if you want you can use
the chat I'd be curious to see what
country you're coming from
mainly so just for my interest and also
I can exploit it and put it back in my
KPIs that I had people from all over the
world so feel free to put in the chat
line what country you're coming from but
if not that's fine either I don't mind
if you prefer to remain anonymous so
this is the DBA office hour session feel
free that if you can't hear anything or
the video goes bad or anything that
doesn't seem to be working well just
slam into the chat line and I'll see if
I can resolve it hopefully I've got the
microphone and the web camera everything
pretty much sort of that I'm gonna try
some new things today with you over the
webcams because I bought a second webcam
and we'll see how we go so in terms of
questions let's see what we've got we
have if you come in earlier obviously
you can put in whatever questions you
want in there I'll just share the screen
so you have an idea for what we're going
to be talking about at least initially
there we go
so these the questions that came in
earlier through the art on office hours
op sales page I will say if you do have
questions obviously you can obviously
just put them on a house tom if you want
to but if you feel you'd like to have
them discussed in an office hour session
I always encourage people to put them on
in advance
mainly because hopefully I can give you
a better answer we can I can reach out
to PM's inside the organisation or it
just lets me do some slides and advances
of fuel these questions that I thought I
really couldn't answer just verbally
today so I thought I'd do a few slides
in advance or drag some slides out from
existing presentations just to hopefully
give you guys a better experience and a
better answer
so because it's a DBA topic you know we
pretty much take questions on just about
anything last month on you but on
petitioning in particular
but this month I thought we'll just
leave it leave it blank and people can
ask whatever they want so we got an
interesting mix up there of course
besides the fact that someone's begging
me about ask Tom not taking questions as
frequently as I like but I'll even come
with that one offers as well on the sea
okay so um we'll jump straight into it
now and we'll stop recording I didn't
want to do that the check um so what
we'll do now is we'll go through these
questions feel free to add comments or
refinements in the chat far away what if
you like and we'll try get to all them
or brand new questions I don't mind um
and if we finish on the hour file if we
finish before the end of the hour even
better I suppose for me and and for you
so we'll see how we go so there's our
list I'll take it off screen now and
I'll leave on screen until we are start
talking with a few things so the first
one is should I wait for 18 or should I
upgrade to our 12.2 let's stop this year
so here's my thoughts on that I'm just
making sure I can read my notes yes
wrong I just so people don't think I'm
biased because I work obviously inside
Oracle and it's fairly obviously it's in
our interest to have people upgrade as
frequently as possible or be as close to
the most recent versions as often as
possible it reduces our support effort
etc so I just want to rest assure that
I'm going to try to put aside that bias
because before I'm only bitter horrible
for two years before though I've worked
with Oracle products for about twenty
years almost exclusively in the private
sector around the world so I know the
pain I know the thing of when you've got
a version of Oracle that's running just
fine
and someone says well that's coming up
to our support or it's you know it's
giving bit old or there's a particular
feature but it's only in the next
version etc there's that you want to
upgrade but also you know that there's
that risk factor involved and there's
going to be a big effort and almost
often as DBAs we're not the people that
control the decision-making process we
can go to around management and say look
I'd like to move to version X of the
product and they'd say well we haven't
got the budget for that and what's the
risk and what we gain exception so if
I I used to be at the opinion and this
is but for many years of my working life
that if I had a version of Oracle that
was working fine I would do as little as
possible to that version and I think
that's a common theme with DBAs we're
naturally cautious people so why rock
the boat if I have a perfectly working
product why would i upgrade to the next
version or a pipe at so even unless
something is really mandating me to do
it that obviously has the benefit of
obviously less effort as well if I can
upgrade only once every few years you
know most the time when we're working in
systems we have these giant you know the
big they become giant projects I have a
friend just in Perth recently and
they're embarking on a 11g to 12 project
and I had lunch with her and she said
yeah it's a two-year project I just
about fell off my chair you know I
honestly believe that no upgrade project
should take two years but you know that
seems to be the case but so that's what
I've you know I sympathize with that
concept of let's not upgrade unless we
absolutely have to and most of places I
worked we got you know we were on 11 -
and we didn't go to 11 2:04 until all
the other versions were out of support
and then you spare them living to hunt
for as long as possible
now I've changed my tune on that and
this isn't just because I've joined
Oracle I changed my tune of bath wearing
him five years ago and that was I'm now
a big fan on upgrading actually quite
frequently and quite almost as as
versions and patches come out now that
may raise alarm bells for people
thinking oh my god that's just a huge
amount of effort and what about the risk
factors involved but I'll try justify
why I think you should upgrade generally
as soon as releases come out or all
there are there abouts when you upgrade
less often I don't think you actually
save on testing effort because when
you're going from say 10 to - 12 - or
even 11 1 to 12 - it cetera it is a big
jump it's often a big jump for example
we've gone from single tenant to multi
tenant and we'll talk about for multi
tenant stuff later on today it's a big
jump and understandably
I think the risk profile is much larger
and so that's why people do get scared
of the big testing effort and don't get
me wrong I think Oracle when I obviously
work for the company we occasionally
shot ourselves in the foot when just a
minor pad set has actually sort of had a
large functional increase and then if
you've done any reading of the various
blogs out there regarding 18 C and
onwards yeah we accept that we're trying
to address that by doing smaller
incremental pieces of functionality now
with the newer versions from 18 C
omelets hence the renaming 2018 so we
don't you me right I totally accept that
there's been times in the past when
eleven 202 211 203 had some fundamental
change in in the kernel somewhere which
you know for some people caused all
sorts of problems but I think makes we
acknowledge that and we're trying to
improve upon that but I reason the thing
I believe people want to be upgrading
relatively quickly and relatively
frequently is the change in
functionality will be smaller so the
testing of it should be less the other
thing is I think you actually get a more
responsive support from Oracle itself I
know people love jumping on the
criticize support bandwagon and I used
to be guilty of the same thing I'd get
upset with Oracle support from time to
time but having their work that asked on
for a couple of years I realized that it
is amazing how much you get questions
that are support related in terms of how
would I do this why isn't this working
and yet flying blind with someone's
question which simply says this this is
the Aramis I'm getting what's the
problem without knowing every single
thing that will led up to that point in
terms of what the applications like
etcetera is really really hard so I do
have a much more sympathetic eye towards
support now but if you think about your
support experience if you're on a
version of Oracle that very few people
are still on and you're jumping to the
latest version of Oracle you know I
would much rather be in the camp of 1
million customers there upgrading from
11 to add 4 to 12 to then 12 customers
or 10 customers who are going from 10
105 pets set for Pat step 3 bundle pets
to with two other special one
- 12 - right you're in a tiny a very
small group of customers with that
particular upgrade path the likelihood
of you finding interesting or anomalous
behavior during that upgrade is probably
higher than if you're in the soup with
thousands and thousands of other
customers and also internally when
Oracle's doing a lot of its regression
testing we're going to be doing the vast
majority of our regression testing on
the standard path you've gone from 11 to
a 2 to a 3 to a 4 12 and etc so I think
you'll get a less problems but if you do
encounter a problem you'll get a much
better experience much better access to
expertise within the support
organization because there's a lot more
volume of knowledge about those
particular standard paths so if you
start skipping lots of jumps I think
you're actually heading into a riskier
territory not just because you sort of
get to end of life and then to support
things but putting all that aside you
actually just get to a greater risk
profile so for me I think upgrading sort
of steadily and frequently and still
with a mind to doing good testing I
think is a very that's a more sound
approach in my opinion the other one is
the reason I believe this is the case is
the most common criticism that Oracle
takes when people have upgrades it's not
necessarily as it's you know
occasionally people get rr6 hundreds and
journal problems and things like that
all or you know crashes but the vast
majority of issues that in my working
life I've always have been on upgrades
is change in performance and obviously
that's related to sequel performance now
there's been a lot of work and our
stress that you should go read blogs to
oracle.com slash optimizer that's Nigel
Bayliss runs a blog now there's been a
lot of work we've been doing in Oracle
as since 12.1 to improve the way the
optimizer stability works as you move
through upgrades and and don't get me
wrong that's something knowledge none of
the fact that we probably screwed up a
bit when we went from 11 to 212
yeah we had a great swag of new ideas
for the optimizer in terms you know in
terms of its adaptability but we shipped
12 one with the more turned on and
so you know for a whole lot of people
half their systems go a whole lot better
and half this isn't your whole lot works
and that's the thing that everyone
remembers obviously you know pain as
much more as much more longevity so
after that stinging you know response
from our customers we've put a lot of
work into making a much more smooth
optimization path when you go to twelve
two or nine words and in particular one
piece of technology which is so
underused I credibly have use which i
think is an awesome piece of technology
is sequel plan management and secret
plan directives and and I was a user
group meeting the other day and some of
the customers gave me a hard time
because I said if you upgrade it from
eleven to twelve and you've got
performance problems then it's your own
fault and people didn't like that but
his is my view on this is with sequel
plan management you can lock down the
plan that you're currently having in
version 11 to make sure that when you're
upgrade to 12 you get exactly the same
plan and people have often worked around
this by setting optimize and features
enable 211 when they move to twelve but
even is that optimizer features now with
12 if you lock down your critical SQL
for single plan management they're going
to run the same plans when you move to
12 and I asked them why don't you do
this and they're dealing with saying
well it sounds too complicated or I
didn't know about single plan management
etc and and it's probably true we
haven't advertised it as well as we
could have in terms of a a mechanism for
upgrading often we pushed over the model
if you want stable plans secret plan
management but we probably haven't
pushed the message of if you want stable
plans across upgrades for the sole
purpose of moving some upgrades we
probably have an advertiser that well
for that but it's a very cool technology
for exactly that purpose
lock down the critical plans move to 12
you may choose to leave them there
forever you know in my view you would
slowly ease off some of the plans and
such that you know over time you would
see maybe 12 can do a better job in some
of them but by having those sequel plan
management directives in place you can
lock the plans in obviously there's the
opposite situation if you've got a
terrible 11 system it's just
like a dog then why wouldn't you move to
twelve like things aren't gonna get
worse if you've got a terrible system
running 11 I'd move to 12 and take
advantage of all those new optimizer
things sure there's probably going to be
a couple of regressions but you would
hope that the vast majority of bad sql's
would be the same or better by moving to
the new version so those are my thoughts
on on upgrading more frequently which of
course comes to the fundamental question
is do I go 12 - or do I go 18 see for me
I would start looking at 18 see today
now obviously you can't do it on premise
at the moment unless you're an excellent
customer if you are lucky for you good
luck to you but there's nothing to stop
you from running 18 C in the cloud now
don't get me wrong I can yeah I can see
when leaving the core going R here we go
cloud sales pitch I'll try to sell you
anything
when or ablating was in data I have had
access to it inside the organization I
can run 18c databases I can spool them
up and a lot now that it's production
it's actually harder for me to do so
because it's we're we're moving on to
the next bit of release and people are
working on that so they're actually good
access to a fully fledged 18 C
production environment for me is
actually more difficult now that it's
gone production so I did what any of you
can do which is simply I went on to our
cloud database infecting me this is just
sequel plus and yeah as I as you can see
I chose a very secure part of the system
/ Oracle but DB 18 is only declare
Oracle calm signed up for one of those
free trials that gives me a month of
playing with an Oracle 18 database so
even if my organization is thinking well
I can't get up on premise I'm not
exadata
you know I can't even look at 18
Moldovan consider it in terms of an
upgrade path well I would say you can
you can jump on and start learning about
the new features but also yeah with this
super cloud database it's just running
sequel bus that's my yeah two gigs
of shared I think it's got seven gigs or
this box etc it's just a stock standard
Oracle database running 18 C I can play
the new features but also I could
actually load to my existing data my
existing applications just on a smaller
scale and just to see if you know the
more critical things are going to work
so I don't think there's an excuse to
say 1830 is not available on premise I
should do nothing about it and the other
reason I think you should probably go
move through 12 - and then - 18 C is 18
C is really just 12 - it - it's just a
rebadged version 18 C is actually the
first major patch set for 12 tor - we've
renamed it because it reflects this
hopefully new model we're accommodating
which is every three months will get you
bug fixes improvements in stability and
incremental new functionality so if I
was if someone's asked me today I'm on
11 - what do I do
I would go get to 12 - it's available on
premise start playing with 18 C but try
look toward whether your organization
can adopt the advice that I'm giving you
which is rather than it's got to be 12
or 18 it should be now we're going to
start incrementally looking at smaller
less risky upgrades upgrades on a more
frequent basis and that's my my thoughts
on that question so if you have any
comments throw them in the chat one
otherwise I will simply move on to the
next one the next question we had those
notes what is a hybrid histogram okay
that's a duty okay
hybrid histograms before I can tell you
what I hybrid histogram is I probably
have to tell you how they evolved and
how they came about in the evolution of
how the optimizer works in Oracle so
here's an example that I've set up I've
created this fictitious table called
orders it's not part of the standard
examples or anything it's just when I
created such that I can control the UM
actual distribution of values
you can see that we've got eight
statuses and it reflects pretty much
what would happen in a system where you
can buy things I've got a thousand new
orders that haven't been touched by
anything yet then they get assigned to
someone to deal with or signed or some
process and I imagine that'd be a very
very quick thing your sign and then
someone starts working on the order so
very few people in your scientist at
aghori then they're in progress
I've got four thousand dollars we're
building things constructing things
wrapping things whatever whatever happen
to retail places and then the person
that's finished constructing it says I'm
done and it's processed and very quickly
we try to get it shipped so hopefully
the number of wrote orders that are just
staying as processed and their port
sitting there doing nothing is very low
then they've been shipped out to
customers five thousand people have then
received their goods and then we sort of
completely mark that order has been
completed so we know how long we have to
deal with it ever ate my natural
warranty period etc and then finally we
archive them off never to be seen again
off to our data warehousing so that's
I'm hopefully I've picked the data
distribution there which is roughly what
we'd expect so there's our eight
statuses first thing we see is our list
some SKU there and when we see SKU
people panic and we think we've got to
have histograms
so in 11g I might choose to create a
histogram I've done for all columns size
15 because there's more there's not 15
values as long as that columns number is
larger than the number of distinct
values
I'll get what's called a frequency based
histogram now a frequency histogram
doesn't require a lot of explanation
it's pretty much exactly what you would
expect it is we can store for each
individual distinct value we can store
the actual frequency distribution so
there's a thousand new this Tennyson
there's four thousand in progress we
know exactly how they're at the time of
gathering stats we know exactly how many
there are
particular status the way it's stored in
the database is somewhat cryptic and you
can see we haven't caught a vehicle user
histograms and the way it works is it's
actually the endpoint number is sort of
like a cumulative total and so the Delta
between them is actually how we store
the frequency distribution so you can
see there that for
for n value of one for new even that
says any V that's this part of the
cryptic way restored character values in
the history on table so we have a
thousand for the frequency and a
thousand for the end point number for
the second row of assigned the end point
numbers a thousand and ten and so how we
work at the frequency of ten is it's a
thousand and ten minus the previous
value so that's how we work that and as
we move down we have four thousand in
progress we have three prototype three
that are processed and so forth the cool
thing with a frequency histogram is
because we know the exact distribution
of each value when I do an execution
plan generally the numbers are going to
be bang on in fact if I do select star
from odds where the status equals shift
you can see the estimate was 800 and the
true value is 800 that frequency
histogram is actually spot on as we said
so far so good
what happens now though if we want to
have a histogram of lots and lots of
different values now I can mimic this
with my existing example by saying what
if I don't have enough buckets so
normally if the number of distinct
values is greater than 254 in Oracle MMO
for the stomach I'll come back for a
second then obviously there's a limit of
that many buckets if I got more than
saved 300 distinct values
I can't store an exact frequency
histogram that every single row every
single value there's too many of them
that numbers been lifted to I think two
thousand and Oracle 12 I'm going to
mimic that now by saying well I've got
eight distinct values but I'm gonna say
I'm only allowed to have six histogram
buckets or or ranges so to speak so I
can't actually get eight distinct values
into my histogram
what does Oracle do an Oracle 11 it
creates a thing with a height balanced
histogram now if we look at that same
view user histograms we can see this on
this quite odd information now we don't
get the values 1 through 8 anymore we
get nu which is 1 6 and received 7
complete an 8 and archived 2 3 4 &amp;amp; 5
seem to have disappeared and the
endpoint number is effectively something
that cryptic as well and no longer seems
to reflect frequency the best way of
describing it is by looking at hopefully
pictorially we have six buckets
hence my terrible artwork and we had to
squeeze eight values into those six
buckets and if I just flip back
we have those end points zero one three
and six jumping forward again quickly
the zoom will keep up with that what
we're essentially saying is is that
values one to six would all fit in one
bucket in terms of the total number of
values and value sevens complete would
occupy two of the six buckets
effectively 2/3 of the dollar and the
value 8 of archived occupies three of
the buckets or half of the data so
because we simply didn't have enough
buckets to store an individual frequency
we've done our best for this thing with
a height balanced histogram once you
start not being able to store exact
numbers that's when things can get a bit
risky when it comes to histograms
so you remember there were actually
20,000 archived rows the estimate came
out at 19,000 it's reasonably good when
I look at completed though there was
10,000 and this time we were over by a
factor of 50 percent and it's a bit of a
toss of a coin because this is
effectively how it's working if I've got
45,000 total rows in the table and I've
only got six buckets each bucket can
give me information about seven thousand
roughly rows so archive being twenty
thousand values worked out pretty nicely
it was builds almost three evenly sized
buckets so in terms of estimates we're
going to get lucky in the sense that the
estimate is going to be pretty close to
actually the reality when I look at the
complete the true value of complete was
ten thousand which is one and a half
buckets and obviously the definition of
half a bucket isn't stored in the data
dictionary yeah we assume that seven
spans two buckets not one that's the
best we can do and so once we start
getting into numbers spamming lots of
buckets or
not filling a bucket for lack of a
better term like the seven the value of
seven there is that's what our estimates
start going askew and in particular once
I look at a value that's not in the
history I'm at all I have this value of
two assigned which was so small it
didn't even fit in the histogram it was
all coming that first bucket going from
one up to six we're miles off there's
only three values for two of assigned
and the database estimates we're going
to get 1,200 if that goes into a join
condition for example we're probably
going to get a problem if there's only
three values I probably want to use a
nested loop to get three values and then
index drive into a secondary table if
the database thinks I'm going to get
1200 it's probably going to abandon a
nested loop and go for a hash join so
it's when you start getting height
balance histograms that those risks and
those horror stories you hear about
histograms start coming into play so
this is sort of you know weights once
you start giving history times it can't
accurately model your data this is a
slide I thought I put in this wee bit of
fun here the other guy says yeah I've
got a history I'm height ballast Cisco
for you how can I help and this is what
people often think about of the
optimizer when they have performance
problems yeah they just run screaming
from the room saying I wish the
optimizer wasn't there at all so buckets
panning is gonna be dramas and buckets
swallowing where multiple different
values are all swallowed up in one
bucket aware your estimates can go up so
that's what we had an 11 frequency and
height balanced and what that means is
if you and if you are gathering
histograms and this is an 11 or 12 you
may as well do 4 all column size to 540
you may as well pick the largest number
possible because ideally you want to get
that frequency histogram if you've got
200 distinct values you may as well have
a perfect histogram if you've got more
than 254 you're going to get a height
balanced histogram no matter what so you
might as well go to beautiful always if
for those columns that you choose to
have histograms on so let's talk about
12c now which is where hybrids can in
12c if you've got enough buckets
it's unchanged from 11 I've got 8
distinct values I asked for up to 15
buckets I got
frequency histogram just as before no
change there let's now look at if I try
six so once again I've got eight
distinct values and in eleven when I
said six buckets
I got a height balanced histogram and
some problems now I got a new thing
called a top frequency histogram in 12
which is pretty cool
if I look at the spread now I've got my
six buckets still but I've actually
still stored some accurate frequencies
for value is one three five six seven
and eight
so a new in progress ship received
completed archive I've got the exact
frequencies there so optimizing for
those values is going to be bang on just
as good as an or frequency histogram
obviously there's a couple missing
number two and number four what happened
to them so here's our six buckets we get
exact values for the other ones we can
do a little bit of an approximation here
there's forty five thousand eight
hundred and thirteen rows in my table
and there's eight distinct values I've
managed to cover six of them with a
frequency based histogram and that added
up to forty five thousand eight hundred
rows so the database can use that
information to say well I've got
thirteen rows left over and two distinct
values left over so I'm expecting to see
seven rows in each so even though I
haven't stored frequency histograms for
those two small number of rows I can
actually do a reasonable approximation
at them and that's what it does if I do
what's the number of processed rows the
estimate was seven the true value was
three I'm looking pretty good there I'm
not nowhere near that 1200 rows I had
with the height balanced histogram how
does Oracle know what it can do this it
simply says if the percentage of the top
number of values is greater than the
number of buckets minus one so all the
all bar one of the buckets times the
number of rows so let's do that in some
simple mathematics if I've got 12
buckets that means that the 12 most
frequent values have to consume more
than eleven twelve of the thousand rows
that we've got for example so we top
frequence that's like that the next step
down ideally I get a frequency
histogram if I can't get back I'll try
for a top frequency histogram and what
if that's not possible what I've done
now is taken my table and inserted a lot
more values into it to make it fairly
evenly distributed now you can make an
argument here that I probably don't need
a histogram at all if all the rows are
evenly distributed archived there is
probably the exception I can probably
get away with no histogram and Oracle is
going to make a rough assessment there's
probably about twelve thousand rows per
value and that will probably be good
enough and this is one of those examples
where you might think maybe I don't need
a histogram at all but if I force one if
I look at the distribution there there's
not sufficient skewed such that we could
do a top-end frequency histogram so what
happens is you get this thing with a
hybrid histogram and that hopefully is
going to help answer this question I
can't do a frequency I can't do a top
three top frequency I'm gonna do what's
called a hybrid which really is just an
improved version of the height balanced
histogram what we have now is have a go
at the time oh man I'm burning it mode
power here and I'm gonna get the
question to move here idea will speed up
if anyone's getting bored with hybrid
histograms put it in the chat line same
move on but we'll keep on changing
I don't mind tree back of that sort so
now there's a new column in user
histogram it's called endpoint repeat
count and probably best if we describe
that with a picture so what I'm doing
now is is I've got six buckets because I
got eight values trying to cram you know
six buckets so I couldn't do frequency
I'm using hybrid and what the hybrid
stores is an additional piece of
information saying that for the value
I'm storing so let's look at an example
here
the very last 1/8 of archived it says
I've got two thousand and ninety eight
values in there but the extra piece of
information I'm storing is that 1200
1200 13 of them for that particular
value so for the highest value in that
bucket which in this case is 8 of
archives this 2002
ninety-eight values in the bucket which
could spend several things but 1200 of
them are that particular value eight of
our card the reason that's useful we'll
see in the next slide is what it's
saying is 2008 occurrences 1200 an R
which means there must be 895 between
the previous value which is 6 of receive
which is the previous bucket and less
than this endpoint value now in that
case we know there's only one thing
between 6 and 8 not 7 but if there was
several it's the same logic applies I'm
getting better information from that one
bucket because I know the perfect
frequency histogram for one of the
values in the bucket and all the rest
fall into this this sort of um category
of unassigned so 800 rows are between 6
&amp;amp; 8 the nice thing with that is is they
use no longer span a bucket so the value
of 8 won't span a bucket it'll simply
have an endpoint repeat count well and
that's the end of Hydra history so let
me go back to the picture so hybrid
histograms I like a slightly improved
version of height balanced histogram now
having said all that let me wrap it up
you know you too long didn't read
frequency histograms are probably going
to make your queries S optimized better
top-end frequency histograms are going
to make your queries optimized better
high balanced sister games in 11g a
risky areas that's where when you've got
histograms you need to take care there's
a good chance that the history em may
make things worse my make things better
but you really need to have a good look
at each on a case-by-case basis
hybrid histograms an improved version of
height balanced histograms but still
same thing that's generally where your
risk profile is going to lie right if
you're having performance problems and
the columns involving the predicates
have histograms on them if their
frequency history and I think you'll be
fine if their height balanced or hybrid
take a closer look you may be better off
looking at something like sequel plan
management to lock the plans into place
or removing the histogram altogether
so there we got high balanced it to
grams
Oh holy moly man where's the time going
a - from I plant if you're getting too
much am i rambling on too much probably
you put that in the chat well if you
like we're recording this session but
we'll go turn on the next question was
Oh in fact I actually I wrote this
question actually I'm on the slide
because it's a massive question this
came in resource maps this is the
question that came in and I didn't want
to that every night between 10:00 p.m.
and 2:00 a.m. we see resource managers
doing maintenance plan as well as
weekends we've seen during this time
slower response time compared to non
maintenance resource plan and effect can
I disable the windows so we get the same
response time for the whole week and
this is what the person is proposing
them doing so what's going on ever since
all ten point to maybe 11 or 11 back in
ten point two was probably the first
release for the database started doing
things on your behalf
people will probably remember a thing
called gather stats job which was a
scheduler job that just magically
appeared in 10 in version 10 which would
do stats each night and then what
happened was in Oracle 11 we took that
to the next level what we did was we
introduced this thing called automatic
tasks and as well as all good things
because you didn't see anything in
scheduler jobs that looked clean and so
you thought well nothing's going in the
background but this thing called
automatic tasks came along there was
zero documentation or 11 about them
which was a bit of a bother now it's
fully documented in Oracle 12 anomalous
but it's been there since Oracle 11 and
what happens is if each night during the
what we call these maintenance windows
we start doing stuff on your behalf one
of them is gathering stats the other one
you can see on the screen is we have the
automatic space advisor and a sequel
tuning advisor so we go ahead and we do
some stuff and it really is designed to
make your database
dare I say autonomous but effectively
it's for those environments where DBA is
generally don't have a lot of time to
look after them and I use the example of
your average DBA yeah
in a good old days your DBA you got even
two databases look after and then as the
process became easier yeah no one says
where you got more free time it was it
there's another 500 databases to look
after so what happens is I find most DJs
and this has been the story of my
working life as well I've got a couple
of saying mission critical ones so
they're the ones I spend a lot of time
looking very carefully and very
carefully tuning and being much more
hands-on and I got 400 other databases
that just lead to departmental kind of
things you know that you know
performance 10 uses very low volume etc
so I don't want to be bothered doing
custom DBMS stats routine and customize
this and customize that a lot of
hands-on stuff I'll just leave all the
defaults set and that's what this is
designed to do it's a hands-off approach
to looking after those databases that
perhaps don't need that absolute utmost
in optimal care so we get other stats we
do space tuning in and stuff like that
and when does it happen
it all happens during these things
called windows and it's the normal
scheduler object of a window that we
create on the next slide yes I'll come
back to that so those windows by default
out of the box assume you're running a
business our system so out of the box
your windows a 10 p.m. to 2 a.m. Monday
to Friday and all over the weekend and
that's probably the first thing you want
to maybe look at and looking at changing
if your honor I'd say a 24/7 system you
may have a quiet period I work today on
a gambling website for a long time and
during the night was when people were
most busy you know they're they're
betting on a lot of overseas sporting
events and stuff like that in Australia
so we changed our windows but I'll show
you the script later surely such that it
wouldn't be doing that workload during
those periods of time um if you're not
using any of this stuff so hopefully
everyone's using automatic stat
equations you've got to get stats and if
you wander to an off stats collection
you would actually do it at a much more
granular level yeah a lot of those
particular tables lock that scheme etc
but you want the staffs job always to be
running because it's gonna be doing you
very very useful stuff but if you're not
using the space advisor or the sequel
shooting advisor in any way shape or
form
yeah you
could actually choose to disable them
that's option you can look at exploring
and the reason I say doing possibly
using it this way is the question that
came in was can I just change the
windows to change the resource plan I
don't think that tax you can do live
benefit but we know is still going to
come active and it's still an
effectively using resources the reason
your system is slowing down it's not
because it's disabling other stuff it's
simply burning a lot of i/o most
probably to doing these particular tasks
so if you're not using the space advisor
for example you may choose to actually
disable it the optimized one I'd say
everyone is using um if you want to be
absolutely brutal you could actually
disable the entire maintenance window
group that simply turns off all the
maintenance couple together I wouldn't
recommend that that's a bad idea and in
particular that's one of those things
that could be easily forgotten and
obviously as each version of Oracle
comes along and more tasks come along
and more goodies coming to those
maintenance windows and you're not
touching them that's probably a bad idea
and especially if you then go a lot of
cool Oracle saying I've got this problem
yeah I've got a bad execution plan and
they go oh yeah you haven't clicked
stats for three years then you're going
to look at the foolish so I wouldn't
recommend assailing but I'm just letting
you know it is possible to disable these
at a task basis or even at it in time
window basis this is what I did at the
Play cells
working where during the night was
actually a busy night and during the
weekend when there's a lot of sport
activities on and horse racing and stuff
that people gamble a lot Australia is
the biggest gambling nation on earth
which shows how morally bereft we are
not to worry so this is what we did we
said okay rather than having our
maintenance window going from 10:00 p.m.
to 2:00 a.m. every single night we
change to start at 5:00 a.m. and you can
see this is what you do you set
attributes on the actual window itself
so for the Monday window that's going to
work on here so for the Monday window
that I just move a smile I did the
Monday window we start at 5 a.m. by our
being equal fight so we start with a 5
a.m. when most of the overnight sport in
Europe has completed and then we change
it rather mean 4 hours long that's the
next slide we changed the duration to
being it too
our interval so for us we said we're not
prepared to suck up four hours every
single evening and almost all the
weekend doing maintenance jobs you know
the impact could potentially be on our
system very large so what we did was we
said we'll go Monday to Friday 5:00 a.m.
till 7:00 a.m. and when seven people
start working again so we wanted to
quiet down and we on the window on the
we only did an hour and only for two
hour period so we've had the amount of
time now you might be thinking well how
do I decide you know do I need four
hours do I need six hours what yeah
what's the best balance there's a view I
think called DBA auto auto task client
and what that is is one road for each of
those automatic tasks that are running
staffs job except etc as well as having
one row in there it also says over the
last seven days what is auto tasks so
deviate what a test plan we have the
client name which we optimize a job
secret tuning of miles etc but also we
have for example how much CPU has it
used over the last seven days what's the
maximum duration over the last seven
days so if my order of steps job is
running for say 30 minutes then
obviously I can reduce my window window
to say 45 minutes or an hour safe and
the knowledge that it probably isn't
going to force this thing to prematurely
to stop so to answer this person's
question is I'll keep the maintenance
window on looking at shifting it to
perhaps a different time slot which is a
quieter period have a look at seeing are
you getting value out of each of the
tasks in particular the auto task for
space advisor and sequel tuning if
you're not maybe look at disabling them
or shrinking their windows down and keep
the optimizer steps 1 don't disable the
whole lot and hopefully that's going to
help you out ok moving along how do I
set my SGA ok that's a nearly ok this is
all I've got so how to set my SGA in
Oracle 11 we came up with this awesomely
incredible idea which is
set one parameter and level manage all
your memory Italy s GA PGA you just say
I got a box with 16 gigs around like
this one's got it's actually my laptop
six gigs for Oracle don't have about
anything else that's pretty in Oracle
ever manual is a disaster so please
don't do this
and there's a couple of reasons why one
is the usage profiles for SGA and pga
are really dramatically different one is
all about private information on a very
volatile basis on this session by
session basis the other one is all about
the opposite shared memory getting value
for lots and lots of sessions and
hopefully something that actually
becomes quite stable over time you know
the number of things in the library case
things in the buffer case generally sort
of milk eventually form sort of an
equilibrium point so it's very different
usage profiles for SGA and pgo so the
concepts saying they really should be
merged and managed as one probably
wasn't such a great idea on our part but
we pushed it and that's became that was
the default as you can see in Oracle 11
so if you just reinstall the database
out-of-the-box you use what we call
memory management and that's one
parameter do it it also calls one other
massive problem on the most popular
platform which is Linux and that was one
of the things that for any serious
production level war or high activity
database you want to be using these huge
pages it's an operating system
enhancement to make the management of
memory much much more efficient and when
you use memory management with the one
parameter you couldn't use huge pages
absolute disaster for high volume
activity databases and as an aside I'd
recommend hue pages across the board no
matter what platform you're using or
what what volume we've got a database if
your platform supports user pages you're
generally going to see a benefit so
twelve guess what we realize that
mistake
the default now in 12 is what we call
automatic shared memory management it's
still a one
size fits all but we've separated SGA
and PGA you nominate one amount of
memory for SGA one for PJ they're held
separately you can still choose
automatic memory management the old star
one down the bottom there but notice
that it's actually not the default which
is a way of saying we generally want you
to steer clear of this and in particular
I think if you try and emulate more than
a four gig database for game aram we
simply won't let you use automatic
memory management because we're saying
hey you know if you're using 4 Giga RAM
it's generally not going to be such a
great idea and if you're running a
database less than 4 Giga RAM you can
see how many databases that pretty much
colors it's not many so yes so the SJ
sizing my first thing is use this one
automatic shared memory management so
pick an SGA pick a PGA I don't see a lot
of benefit and feel free to disagree
with me I'm in the manual shared
management which we used to do in the
old days yeah bigger shared baller buff
acacia et cetera generally the only time
nowadays I see systems getting into
trouble with the one-size-fits-all is if
they've actually site that they're
simply database cannot fit in the
available resources and what happens
then is your start seeing this sort of
jumping back and forth memory get spit
from the shared pool to go to the buffer
cache then it gets pinched back any
bounces back and forth that's not an
issue with shared memory management
that's an issue with not having enough
resources to run your system so out of
the box for me right
I'm if a box is only going to be running
Oracle I'm generally going to allocate
maybe upwards of 60% of the boxes ran to
SGA and pga combined and I'll carve up
those two depending on my expected usage
for a warehouse environment it's amazing
how much little buffer case you can
sometimes get a benefit and you just
cranked all in the PGA so people can
actually get some really good sorting
and hash area benefits as well um but
yes so it asks the question whoever
asked about SGA setup use automatic
serve memory management and then keep an
eye on the advanced upon the advisors
pretty good there's an SEO master pga
bonus keep an eye on them and make
adjustments as you go next question why
is ask tom not taking any questions
cool that's that's a easy one to answer
I mean let me show how a star works this
isn't anything hidden or secret this is
what we do so when I came into a ston in
the morning I come into our admin screen
which you guys can't see but this is how
it works and as you can see down the
left here right this is this is what
happened in ask Tom people ask questions
they go into this queue we might have a
look at some and if there's one I want
to answer later but haven't got time now
but it's been read but it has minutes it
if someone's even asked a question where
we need more information we'll flick it
back to them and it goes to the bear
these are ones that have come back from
people with more info here's all the
18,000 questions you can see Ann asked
Tom if you go the ask Tom homepage and
here's the five and a half thousand that
we've answered but we didn't publish
them because other the personal log sent
some information they said please don't
publish it or it's such an esoteric
question there probably isn't love and
value or sometimes it's the question
which is just have been tired of
profanity saying how much they hate us
and we answer and we don't publish it
and no further action or ones where
sometimes someone just made a comment
you know we usually just get feedback
this way but now we have a dedicated
feedback button at the top etc and then
as people do reviews you probably see
reviews and ask Tom we answer the
reviews as well and we've got 130,000
reviews so how asked Tom works is pretty
simple when this number gets above a
certain threshold we stop taking
questions it's not like because there's
none because we hate you there's nothing
it's not really like that it's simply
because like we don't want to get in the
case of where we've got a hundred
outstanding Christians because no one
wants to have their question answered in
nine months time that's not going to
help you and just makes us look stupid
so by keeping a cap on the number
outstanding questions so I think at the
moment it's set to 20 up thing but all
maybe 15 once it gets to 15 we stop
hopefully so we can do a better service
to those 15 questions no one wants to
have wait six weeks for question two the
answer so that's the only reason why we
don't take questions when we get the
number down we open it up again
for example Chris has had the flu the
last few days so he's been down so you
know we're down an answer Marie has been
traveling to conferences I'm off to
India and
in a couple of weeks for Oracle code so
we're just normal human beings we do out
we do have this but that's how we handle
a stop okay and next one
when will single teller BD support it I
have no idea but I think let me rephrase
that question into should I be using
multi-tenant this probably better
question is like you can't move me if
I'm upgrading to Oracle 12 should I use
a non tentative database or a
multi-tenant database or exception and I
would say my advice to you would be to
anyone would be if you're moving to
Oracle 12 use the multi-tenant database
and don't get me wrong I'm not saying
hey go spend some money on licenses you
know you have a fantastic time spinning
giving lots of money but Oracle yeah if
you're happily running 10 normal
database at the moment and you're going
to move to 10 databases are over 12 make
each one of them a single tenant
derivates there's no cost for that um
rather than a non tenants database at
all I don't really know I don't think we
didn't have a term for it was a non CBB
whatever it's something that doesn't
have any tenant um the reason that is
pretty simple
strategically we're moving toward multi
tenant all of our cloud databases if you
you know get stuff off our cloud runs
multi tenant where do you think all the
technological investment all the best
support all the bug fixes are going to
be targeted toward it's that platform
right it doesn't make a lot of sense for
anyone to maintain multiple code bases
remember back in the days when Windows
used to have Windows NT and Windows 95
or etc or XP to separate code bases one
per server one for desktop and emitter
they merged you know now generally all
these things run and common sort of code
base Oracle's the same it doesn't make a
lot of sense for us to run a non-si DB
set of architecture and a Seabee
architecture it's hot yeah we have to
carve up half the intelligence in the
organization to each group doesn't make
a lot of sense so rest assured
eventually it'll only be the tenant
adoption now I'm gonna try some you this
is something I haven't tried before
okay so this this has just been fun I
have two webcams so this is my second
webcam hopefully everyone can see shout
out in the chat if you can't see the
fact that there's a piece of paper and a
pen sitting in front of this red book
here's why I think moving to Tennant is
a good idea so this is the standard
diagram you've seen we say have a CB and
you'll have you know tenant number one
tent number two tip number three and
it'll all be fantastic and you're all
going yeah that's all fantastic except
for that you're gonna get skill me on
licensing fair enough but obviously if
you go this way with one tenant in each
database there's no additional fee
obviously no additional fee and you've
got 110 at which point you're going what
does that get me gets me absolutely
nothing it is true that there's a whole
stack of multi tenant features and
hopefully you've been going to the
patrick smoking you know office house
things and asking questions about it all
things like snapshot rolling carousel
instant cloning well there's really cool
stuff with multi tenant but obviously
you have to pay for it if you can get
value I say this on the petitioning
thing last month if you can get value
out of any option then you should spend
the money if you can't get value out of
it don't spend the money don't just
spend it because someone says a good
idea but here's my tip for why you want
to be going single tenant so here's a
single tenant here's a single tenant
without breaking your license you can't
put a second tenant into this database
but you can unplug this tenant and store
it somewhere oh I'll put it in ooh oh
I'll give it a different look you can
unplug that tenant and store it
somewhere and put another one in there
why is that cool well think about it for
example as a developer I can have for
example a call a gold image a version of
my development database application two
points you know my application is
version 2.0 I'll store that
out on the shelf that's applicable to
point though of my application I can let
someone bring that into that database
just the one tenant so not biting your
license and they can mess with it they
can do development against they can do
testing unit testing whatever they can
build version 2.1 all right mess it up
breaker whatever and then they go I come
I'm reaching for more color see and
probably go so I messed it up fine
I think I'm ready I can ditch it blue
doesn't work I can ditch it and bring a
clean version of to back going back in
and do some more testing so this whole
thing about our I want to do agile I
want to basically spool up databases
really fast it's so common that the
biggest thing that's a prop that the
problem we have in our own systems is
they say our everyone has to share one
database well with a multi-tier option
right we have multi tenants like this
you could actually very easily have a
whole stack of pre pre delivered or
pre-built clever balls on the shelf so
to speak as long as they're not
concurrently in databases you'll be okay
have them out on the shelf and you can
shift them into your database as
required and in particular what's coming
out later this year 18c Express Edition
it will have all options enabled all
right 100% free limits on the size and
having that normal XE but all the
options are there you can have greater
than one's plausible database in this
you can have in memory you can have
compression you know about everything so
as a developer I can have pluggable zin
my own little version of 18 CXC work on
my system privately unplug a database
from there and plug it into my main
development database out here in my
department will server somewhere when I
need to ship things in that's why I
think having a tellenson system even if
you're only running one tenant is
actually a cool idea
now it's ax
3:30 so it's almost time to go
but um please excuse me about my
pronunciation but if it's Arcana if
you're still on just if you can't just
put an X in the chat line if you're
still on if you are I'll talk to you
about full database cache and the others
can either hang around or they can go
away
I don't mind you can take big I
obviously like just chatting constantly
so ok I can't as online fine so I'm the
rest of you you're more than welcome to
stay
I'll keep chatting on because I could
just never shut up but if yeah if you
need to go down thank you very much for
attending hope you enjoyed it obviously
I get a little bit excited about this
kind of stuff and hopefully you are too
the recording will be made available
shortly I'll just dump it out and stick
it up on YouTube pretty in the next few
days or so thanks very much for coming
please jump on to ask some listen
feedback or I better do one last thing
um thank 15 please follow me on twitter
subscribe to my youtube channel jump
under my blog I love having people
especially on my on the beers I love
people's comments on the videos and how
I can make them better and how I can
make them more educational but yeah so
I'll leave that up there and I'll talk
about full database cache for anyone
that wants to hang around thanks
everyone
I get a full database cache the cool
thing about full database cache is one
of the nice things with Oracle is this
thing called the in-memory option it's
fantastic right you know and you've
probably seen plenty of content about it
Maria Cogan used to manage it now we
even have an in-memory office house it's
awesome and it's awesomely expensive
it's a I think it's about few chipset
add-on and and it's one of those things
when you know people bag Oracle for how
much we charge but the reality is you
know the value of something is what the
market is prepared to spend and
in-memory as one of those technologies
which I've never seen a customer have a
bad experience all I've ever seen
there's great things with in-memory
so understandably we charge a premium
for it unfortunately it's very expensive
so people say well I got this server
servants nowadays have stupid amounts of
RAM yeah you had these things where a
server can have half a terabyte of RAM
not even a terabyte of RAM and the
reality is you know the exception of
things I've gotta win houses lot of
databases simply aren't that big yeah
and they're in the hundreds of gigabytes
but you know the depth the days of where
a 10 gigabyte database was some scary
thing you have to worry about a god you
know databases in the hundreds of
gigabytes now don't even come close to
realizing the power of the servers
they're running on so if I've got a box
and I can't afford or choose not to
spend on an in-memory option can I get
some better benefit from having all this
available RAM for my database if I've
got a box with fire from the gigs of RAM
and my database is only 200 gigabytes
you know why wouldn't I choose to try
exploit that Ram more efficiently and
that's where two options come in in
terms of Oracle the first part talked
about is a thing called automatic large
table caching and the way that works is
is let me take a step back by default we
assume that if you're going to query
huge tables you probably don't want that
stored in memory that's part of fault
because if you go back sort of ten years
there's this sort of total thing where
you've got all this precious data in
memory I think it's enough for a blog
URL and stuff if you've got all this
pressure starter in memory then that's
come from all these little reads of
transactional data someone knows one big
massive table scan and flushes and all
that and the tables in them right that's
not what we want so we introduced a lot
of intelligence into the buffer cache
algorithms especially in 8.1 to make
sure the best data the data the small
most actively used stays in memory so
out of the box if you scan a huge table
it's very unlikely we're going to keep
it in memory in fact it's very unlikely
were even gonna touch the buff
occasional will do a thing called a
direct read which simply takes the data
at straight-up disk to that session
that's requesting the data into their
PDA we bypass the buff occasional
together but even if we don't that data
that comes into the buffer case is the
first thing in ditched so that made a
lot of sense when databases for this
speak and memory was this big now that
it's flipped
it's hot you know it might make more
sense to say when I scan a big table if
I've got huge amounts around let's keep
it in there still without interfering
with those precious small tables that
are in the publication all the time so
in I think that's from 12 and onwards
you can allocate a section or buffer
case or even if my buff Acacia say 10
gig I might say well I'll make it 60
gigs because I got all this spear man
the tanking stays the same and I'll
allocate I can choose a percentage I can
say I can say 80% of my buffer case is
dedicated fought and called large table
caching what happens now is when I scan
large tables they'll be dragged into
that dedicated area
it's a dedicated chunk of the buff
ocation for massive objects and I can
remember the exact specifics of the
terminology but we recall what's called
a temperature on these objects as and
how actively they're used and that's
what defines on the usage element when
these things get purged out but they get
dragged in and they stay in there as
long as possible until something else
push them out so that's the first
element of caching the full database is
single large table automatic large type
location where you dedicate a part of
your database to large objects the next
level up is quarreling logic which is
called full database caching and it's
simply the logical extension of that
it's still the database working in its
conventional form right there's no
in-memory columnstore there's no
particular enhancements or risk factors
it's not like the whole database is
kasemir me therefore if you shut it down
you're going to break things and lose
data etc all the normal concepts of
transactional integrity persistence read
logs still apply but you're telling the
system that the entire database will be
housed in memory it's so it's so small
on your own is so large that you don't
have to worry about purging information
out if necessary
so that's full database caching I
haven't seen a lot of people using it
and I think that's perhaps because of a
misinterpretation of the facility people
sort of said ah this is like a version
of times 10 it's effectively an
in-memory database that never rise to
disk and there
incredibly fast it's fast in terms of
reads but we are still using database
protections etc it's not tight it's not
a time sitting replacement it's just an
acknowledgement of the fact that RAM is
so big nowadays that a lot of databases
can actually just sit in silent and we
can adjust and then memory management
algorithms to take advantage of that so
hope you that answers your question
it's 437 my time my throat's just about
toast I'm gonna say cheers to everyone
thanks very much for attending and
hopefully we'll see you next month but
please jump on the other office hours as
well jump onto Twitter say hello to me
um and yeah hope to see you on YouTube
as well
take it easy everyone enjoy the rest of
your day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>