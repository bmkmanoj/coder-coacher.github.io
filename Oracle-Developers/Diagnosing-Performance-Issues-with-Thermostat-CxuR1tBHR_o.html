<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Diagnosing Performance Issues with Thermostat | Coder Coacher - Coaching Coders</title><meta content="Diagnosing Performance Issues with Thermostat - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Diagnosing Performance Issues with Thermostat</b></h2><h5 class="post__date">2015-06-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/CxuR1tBHR_o" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so let's let's first introduce
yourself here so I'm Mario daughter from
Italy working in read that in the Java
team but we do a lot of things actually
all things red 12 and jdk if somebody of
you hangs around the open gigantic is
maybe as in my mates or more probably
amazed amazed keep bugging people when
one takes the works always try to make
other people to our job you one of the
most important things i do i read that
is is thermostat which is a platform for
diagnosing performance issues how may I
will do that introduce yourself sure all
right so my name is Amir and it's Mario
said we work on the openjdk team I do a
whole bunch of things you know I'm the
cat involved with the open plug-in
support and web searching for also hack
on openjdk itself but as mario wii i
spent most of my time on thermostat and
and that's really because red hat feels
that there is a gap in new tooling we
have excellent compilers we have
excellent editors that are all open
source but when it comes to monitoring
performance and instrumentation tools
there's a big gap so that's what the
Messiah tries to fill it so what is
their most obviously oks essays are
diagnosing platform so I'd prefer eyes
what entire existence is actually
dedicated to doing analysis getting
performance metrics and all the career
my adoring importable things so that's a
little bit of special-effects the
presentation we upload will be a little
bit different they wanted will be mostly
the same though so when we started
working on thermostat exactly for what I
may say so there was a gap to feel so
there is a lot of tooling around
more or less accurate more or less good
most of them have one problem that they
are not free softer so we first wanted
to feel this specific gap now we realize
that just because it's free software
it's really really important for us
however is not by itself necessarily for
all people the reason to switch over so
what we want to do something even
different than what the alternatives
have so we started to design our
platform around three basic concept
which are extremely rated at each other
this concept you see here are the
console collection analysis and his
history historical examination did
what's about collection basically is you
may hear about that sometimes refer this
database ting collection or bacon as
iYou already tried thermal stuff
software i will keep doing this
presentation if somebody has already
knowledge the thermostat so maybe I can
say something that that may sound known
to you so it indulge me for a bit anyway
because it would be an interesting for
for everybody that doesn't know about
their Muslim so saying so the collection
we have basically metrics around we we
have a complete stock that we try to
integrate that goes from the lowest
level of the Veridian system up to the
application server passing for
applications are not necessary job
application as you see I ride the
application and draw up a machine
application server that's what we call
the vertical stock
time to say there is the second concept
which is the concept of analysis of the
data while collection is important to
retrieve the data we want to analyze we
figure out that giving people the
ability to to use tools that are
specially crafted for offline in
particular analysis it's it's really
important so we call it all the end the
data to see here from this kind of
database there is a big bucket where all
the analysis all of the data goes when
is collected and then we we transfer for
offline analysis and neckline which at
this stage come consists of a graphical
user interface client and a common line
basic client are able to perform
analysis on this data particularly the
GUI present you with tools like charting
support or specially crafted widgets so
you basically have a platform think
about I don't know netbeans or eclipse
but dedicated to data analysis and
performance analysis then there is the
final thing that puts together we had
this concept we call it the advanced a
cloud engine that basically is a very
linear between thermostat itself and the
cloud work McLeod I don't mean only
third party which is still possible you
can have a database backends that they
would put thermostat in the cloud for
instance we are working on our shift
lagina will probably see the light soon
but it's also possible to use it inside
your own infrastructure with whatever
you have the default thing that that you
get when when you wanna take thermostat
in this moment is a MongoDB database we
would speak a little bit more about
those components when we do them
together we we don't
why this is important because what we
told is that why you can develop an
application so you can fire up a tool
that does some analysis on what you
developing right now then when you stop
the data is now go somewhere now maybe
you can story but most of the tools
don't let you open the date again a
little time and compared with with more
recent version while we we try to
achieve something with with thermostat
good yeah sorry that is called a
constant monitoring platform so what we
do is that we take all those concept
around and we tied together with a
platform that is extensible so it's
super plugins so you can write your own
things you're your own plugins if you
have an application that doesn't expose
metrics for instance like jmx which is
kind of standard way you can write your
own plugin for test thermostat then it
may be something as simple as just
writing the backend that that retrieve
data from from the plot for month up to
the world stop so so analysis in in
decline or maybe you can just decided
you want to use thermacell funny for the
analysis part but you already have I
mean to to assess this data because some
announced to as I see all those things
are are are made because we want to have
a platform that can monitor constantly
the application but we also don't want
to introduce too much over it because
it's very important especially when you
have let's think about profiling when
you're providing an application but then
your profiles that introduce the ten
percent over it because of the oldest
romantic code then what your profile is
actually the profile version of your
application is completely different and
then uriel running application so we
want to have a
kind of reliability and we set our bar
in term of performance for a TI in terms
of overhead very low so we always try
and our tests show that that we are two
percent over it we always try to be as
conservative as possible for that very
same reason where you are providing with
standard to like jmx for for trade
analysis we keep those things disabled
by default so you are only going to use
this information if you really need
because they did introduce pretty high
overhead men and of course there is a
nice team because as free dog we are a
giant machine vendor so we are able to
perform changes on the code although the
GDK those changes eventually go upstream
so there will be benefit for every
everybody and this is one on to do we
are working on is to understand where we
can put better medics inside openjdk so
that we can get better use of it as I
said you can make goes well a
100-percent time money going to always
on without worrying about and then
finally as I saying it in the
introduction this is a open source tool
so for us right there this is the most
important value of the dope of the tool
for you it means that where you are
committed to use thermal stuff in your
environment if you do change listening
in in the code if you introduce plugins
for for your own application what you
have is a block from the dissolving and
it stays there it's open source this is
free software is developed in the open
our philosophies out are always upstream
first so we develop thermostat outside
the words or edit and then we cut down a
vision at any given time and we ship it
and and we will see how you can get this
passion
in reloj in fedora for instance so this
is really really important for us and
there is a stability issue then
obviously because if something moves so
fast where we understand though that we
need to put some some some rules also
for the stability because we want people
to depend on thermostat so we cannot
really break it yes of course we are we
have the code so you can you can say we
want this passion fix it for 10 years
but this doesn't really scale was so we
take care of this part and we promised
something that the that there are no
stability issues between major version
of thermostat so like we are developing
a version current list we just released
a 120 for the world I frame 120 you will
get fixes some bad ports where
appropriate but it would be backward
compatible the new version though there
is going to be out at some point this
year would be a new major version 1 the
2 an app version will still be backward
compatible with what you wrote so we
won't break compatibility when we will
do this when we are already planning at
this point but it's going to be a long
way for that one we will have a 220 and
we will decide ok we did some mistakes
in the past this is the time to fix them
now most of the time we want to be able
to add something that can be used
without thinking about the version
itself thermal stuff so you use
something you can really depend oh so
that's that's their monster basically
then no laughing for for this tool
that's a very brief presentation and now
owner will walk us through a couple of
real cases so to see how really we can
use thermostat to do some analysis
that's the state of the art and you know
it's not really the latest code around I
think it was a still basis somehow
Lee I saw so it literally saw one dot
zero but is probably they were all women
there some but this is mostly what you
see if you get there monster by on
fedora for for example so for before
going on i am a couple of question then
of course you are what color to do to
interrupt us and at any time if you want
to us something or if you have question
already so I would like to ask America
bout things so that we can proceed out
present I don't know anything about that
okay first of all how do I get their
Muslim okay so if you were here earlier
I put up a few urls will put I'll leave
them up at the end too but basically if
you're using some version of Linux you
can probably get a versions from your
package manager if not you can grab the
source and build it it's using standard
maven builds we have now packaged it for
a boon to somebody else might have I
think I'm not sure wound to itself but I
remember the last sometimes I go
somebody from from opensuse was I was
doing some work on palladino curse we we
are we have here we have to position we
are upstream thermostat so we don't
carry any distribution specific patches
in our in our you know infrastructure in
general so and even if sometimes it
happens there are things that may be
slightly completely like I don't know
some some property file configuration
file we don't care about downstream this
is something we fix when we take this
hat on and we get to the to the RPM so
distribution packager which is you know
is a kind of psychotic team to say
because it's like to be different person
but a reality is like that so so what we
do care a lot is the departing for for
fedora and red and Santos as well
because Santos carry on the same things
work well but that's something
downstream so we do
care about that so try to be nice of
course but we don't care about that when
we are developing so the idea is that
anybody using the code downloaded from
from the website is able to run it and
it doesn't matter if you're wrong move
on to or fedora or anything it's just a
job application indian i think so i
don't run a sentence directly so yeah so
taking me with a grain of sale of salt
why you said itself the salt as assault
issue work I not responsible for for the
packaging in general in a terrible
packager you don't want yet but I just
came in yes so the thermostat was
included in the recent release fri SEL
that went out so our if you're using our
edge SEL 1.1 or 1.2 whether words sent
away srl you should be able to get this
SL so is the guide was for RPM question
actually I'm separated or seven years so
it's not here so you can ask words about
rpms I'm sorry about it no but really if
you have problems running it we are
interested so that there was a joke of
course but if you run on sentence and
there is a problem then we are really
keen to make changes as downstream
packager to the RPM in order to
accommodate our sister project I will
call it and of course we want to assist
debian user or ubuntu users it's so part
of being an open source project as well
that the rule is that upstream works in
a way that tries to be completely
independent of whatever is still grading
system in particular the version links
it
yes yes that there there is some native
code in thermal stuff no no we will get
there but but but it's mostly just Joe
yes this is a 64 x86 64 machine so so
let's start with the demos okay so Mario
mentioned about a couple of components
of thermostat there's the agent that
collects data the storage layer which
commits which gathers the data and keeps
it and client that can later retrieve it
for development purposes I've kind of
put the first two together so this will
actually start up an agent that collects
data from all JVMs and everything on
this machine can you hear me all right
okay and also start a something a
storage component that will keep all the
data and later allow us to retrieve it
so that starts that and it will go on
and say lots of things cool the other
thing I want to run is that gooey so
this command oh let me just make
something clear first so when you have
thermostat in your path this is
basically what you will do you'll run
thermostat and the name of the command
you want to run their school either CLI
there's the shell there's a bunch of
things there I'm not going to do that I
am in a development version so great is
so the first thing is that thermostat
has security design in mind so this is
actually asking us for a password while
thermostat will collect data from all
your jvms in every host and if you're on
a network you will try and get it from
all your machines and put in one central
location this makes sure that you have
the necessary privileges to be able to
access that information yeah so let me
interrupt so we remember this lights
before we're speaking about this this
horizontal integration going from the
operating system all the way up and to
java application server and and job
obligations and we also have this team
how about the distributed storage i was
talking about
the cloud teen so this worker we call it
the vertical so the result of sorry
integration that means basically we we
have a set of systems that may be
different system in a cluster for
instance and we want to have to be able
to get information out of all those
systems but we don't want to run
multiple version of the database and
then ask the each client of the timing
of connect here connect their honest way
we do have a reason for making this
separation otherwise we will just have
one central place that is going to
collect all the information for for
everything that our network is is is
organizing yeah so for the purpose of
demo I have created dummy user accounts
and passwords so this is the thermostat
GUI there to a couple major components
to this well on the left you can see
there's a little tree widget that
contains a list of all the hosts and the
virtual machines that thermostat knows
about so my local machine is named trot
and it knows something about that and I
can click on each and every one of them
and find out more information so for
host for example thermostat will give me
the basic information it will tell me
how many processors there are where the
network specs are you know what the
basic kernel is and so on so forth I can
also get a good idea of you processor
load on this machine so I can see what's
happening same with memory I can get a
view of the different memory Regents and
what's happening to them and I can you
know check and uncheck and try and only
see data for the last minute there's
also some basic support for an umma so
you should be able to see what the load
is on your individual Numa nodes I only
have one note here so it's obviously one
hundred percent I can also see more
information about a JVM
I click over it so this is thermostat
looking at itself that is a 1-1 feature
that is one of my favorites the the
Chuck system that we recently
implemented is this notes thing here you
want to try to to use it yeah sure so
I'll go over the x 1 x 1 okay yeah so
there's a number review that's saying
what the users are with the start time
is what the main class is I can see what
version of open did he came running and
any arguments vm I also get some basic
information about how much CPU my
application is using so here we can see
the client is using well quite a lot
that's fine it's just a client hopefully
you don't run the client on your
performance intensive macadam the
machines are running production
performance intensive workloads yeah so
one one thing we kind of say before but
it's worth to go over it again so we
have this this infrastructure basically
so you remember the three steps so the
idea is that usually especially if you
are in a production system you don't run
everything together so you have the
database removed somewhere what
productive be on fire warren and secure
than and so on then there is the agent
we have 11 agent / system so one agent
is able to track everything every
information that has been configured for
in that system it won't try to track
data from other system so if you have a
major running on system a and some
virtual machine system be there is no
default way of course you can write your
own begin if you really want to but
there is not a full way to do to try to
connect to that other jay-jay and
running on the system be so the reason
for that is both about security of
course but especially because we want to
have a full control of the virtual
machine running on the system and
and if we do via some remote product
that will mean just cut a lot of
possibilities from the system so we need
to be logo in order to get access to all
the information we need for the system
right so moving on with the demo we can
also get a lot of information that is
specific to the JVM this is the first
bit we can see what garbage collectors
are running so we see on old generation
there's PS barrel compact and on new
there's scavenge and then we can see
there's one major garbage collection
that happened on old gen and lots of
stuff happening on the new gem which is
fine we can also see how many classes
are loaded and when they were loaded now
this this is more or less like it should
be usually because you get a spike in
the rough the beginning and usually
there is no other class loading activity
but it's interesting 444 osgi
application you don't get a straight
behind what you see three some plugins
this is our eyes dry applications is
running your tracking thermostat is
ending yeah so this is basically loading
things and then it stops a bit and then
a new plug-in assist other than any
loads class system and it stops again
and so on you can also see the size of
different memory regions so going from
the top we see what the size of the Eden
region is in how allocation looks like
on that and the same for the survivor
zero survivor one generations and we can
see what's happening at the old gen it's
not going too fast which is great and
what's in permgen permgen by the way
it's gone in eight so you won't see this
there's also the heap analyzer which
basically gives you a size of the total
heap regions yeah there's more
functionality sorry going not all sorry
so this is a difference graph sometimes
people may be a little bit confused but
I find it pretty pretty interesting to
see the hip data this way so busy
highway
the lower level which is the one that
doesn't contain any any any painting
basically is the what the system
currently is using and the top level
this red one is actually the maximum
amount that you can use then of course
it can grow a little bit because as Java
allows that and those are all example
what I was saying before so then the
super 44 custom-made widgets and
charting software for for message charts
we used jfreechart which is very deeply
integrating in thermal stuff and we all
we have all the numbers of other
components for example we will see that
later when we do the app analysis here
we have things that start to paint on
top of the or the chart so they are not
cast not standard components basically
but they're all modify in some way or
another what we're going to come back to
this later on it and see all the
different features here right now we're
just going a quick overview if you will
there's also a thread panel which gives
you information about all the threads
are running right now it's blank and
that's because it's off by default this
is actually one of the more performance
intensive operations so we keep it
disabled by default and when you
actually want to find out more
information about your JVMs if you think
that there's a problem with them or any
of your figures somehow it's probably
the interaction of threats that's
causing it you can enable it to get more
information we also collect a whole
bunch of JVM notifications and display
them here again they're off by default
because it's one of the more performance
intensive operations and you can enable
this on demand so this here is the
feature in murray was talking about
earlier basically you can keep notes
specific to each p.m. so i can add a
note saying this is a very important
yeah don't shut it down ever and save it
and maybe come back to it later on
some other client on some other machine
running somewhere else on a network food
is not enabled that the contact
performance he said that overhead is
only two percent is that the included or
not in extruder to the same so what we
what I'm issue it around is it's around
34 person when jmx is alive so it's a
little bit higher then obviously it
depends on what your you're doing
because if the application has a very
high number of threads is going to be
worse on performance sorry it really
depends on the application that's the
reason why this this top is off by
default what this is all simply basin so
a reality when we do enable thread and
the jmx notification for for jmx
information in general the overhead is
not a really substantial because we
don't sample every every one millisecond
for instance so but but obviously when
you say you ask the thread analyzer to
give you tread dumps then the
performance start to be a bit more
critical and you say if we trap dumps
the jogger time machine has to stop get
the thread down and and then it can add
this information to its internal
representation and this did again with
all the performance optimization but the
first thing is to do it's the ultimate
sand and this is actually area so we try
to do this in a way that it doesn't
allow suffering for if it's not useful
but if you need it then it is just a
little click and this enables so then
you can also close the GUI client if one
turn off this kind of analysis sorry if
you decided you want to have information
overnight for the jogger time machine
you can turn it on and then
the next day go there and take the
result and you don't have to keep your
your client open because the important
thing is that is the server my question
is related that what you just said is
that what's the best way to use this to
the photo shoot like moments like yeah
come on we have like to be
yeah but if we turn on transit of
education that we actually load which so
I gotta yes pick best use it it
basically depends on the kind of
application what you really need to do
what with the reason why is disabled by
default is because currently but this is
something we are working on that stage
anyway is that it's using JM x + JM x is
expensive we have other means or getting
the same data which we cannot show you
here because they were just development
in that moment but what basically
happens is that you we get information
from other sources so we will try to get
married soon I of a plug-in for for turf
and assistant up the promise that those
things give you a different kind of
information so it's not it's not the
same thing saying okay we jmx you get
the full stack trace and you get
something that the virtual machine that
lets you think you're doing it's doing
in a specific moment because the reality
is that the code executor may be
completely different even the start
rates may be completely different
because the java claw machine is doing
create the optimization so you get a
representation maybe you get something
that this says is running but the
reality is that something else is is
running in the moment so one is a
representation of the did on the graph
of the call graph overall the virtual
machine or the java code in the momentum
and one other is a real thing with perf
you will get the real thing and that
could be very very confusing for for for
user because you see something different
what you would expect so that's the
reason why way is not exactly the same
thing but there are all tools that get
together and then people develop
knowledge using them and can use to be
more effective and a pervasive tool is
definitely turning on all the time
because it's information we get anyway
know if this answered but we'll get more
in data even if we need to hurry up so
at that moment in that moment it works
this way we have the storage layer that
I was talking about this advanced a
cloud engine is actually two pieces it's
one is the database gate which can be a
little thing maybe a real time we will
show it later or and or is that the
remote stuff we are using now with the
web story then there is a second piece
which is responsible for direct
communication reading client and end
agent it still goes through the same pot
so there is always a gate in between if
you're running the web storage there is
always this this piece of software
running and taking because it needs to
check security if you are really
entitled to ask some operation or not
then if all the checks pass this
information is directed to the to the
agent at that point age it saves States
and start doing things like I don't know
getting jmx information for threads or
for notification or whatever and this is
something is also better home plugins we
we come back to that later because we
were running a bit all the time so
starting started coming
gala process was it configured so sorry
it's so the question was how does
thermostat identify job processes how
does it figure out it they're running on
the machine well there are a number of
ways so you mean how the agent knows
about built on machine on the same
engine so this information is published
by the job is done machine itself so
we're just what I proposed I know it's
very interesting maybe we show a couple
of demos and then we go back there and
then want to get them from their
discussion right now yes you be good i
just did everything so yeah so that's
the great running and now i want to run
through a couple of sample programs to
see how the thermostat actually can help
you solve real problems so i want to run
a couple demos the first demo I'm going
to run is very creatively named demo one
and it looks like this it's a really
simple program I'm going to run oops
let's pretend i didn't do the first one
look so that's what the program looks
like i'm just going to call java on a
class that i have compiled and let's see
what thermostat tells us about this so
thermostat has picked up this new
program that's running and then well
let's see what we have for the last
minute
well this isn't a very great program is
it it's doing a lot of garbage
collection old generation so you
remember before it was when we were
showing a thermostat stuff there was one
spike and and he forgot about that here
you see and and from the looking at this
graph you should already know that this
isn't right old generation is supposed
to happen when you have data that has
lived on for a very long time and then
it gets moved into the old gen so a lot
of new data fresh data going into old
gen sounds like a we have a sizing
problem our generations are not sized
correctly so let's see if we can fix
that yep actually that's exactly right
so the right fix here is actually simply
bump the size of the new generation see
where that gets us so I'm going to stop
this program and I'm going to fix it
so the fix is actually just that
increasing the size of the needed
generation let's see if that actually
helps again we've picked up the new
program that's running and in this time
things look a little better there's
garbage collection the new generation
that's why can you compare that with all
along yeah sure let me pull up the old
generation again there's a separate
option to show all historical data for
dead VMs they're still kept around in
storage and we can actually access them
so this is old guy look and the new guy
we can already see things are a lot
better with this simple fix the next
program going to run is demo2 one thing
I want to do while you're running this
team so that's what we're important to
have historical data you see it looks
like everything is up in a real-time
here that just because the application
are still running on the system reality
there is no real time thing here the
client is downloading data at some
interval from the storage and it's
checking your data is there the
application is still running you see
there and and so puts together things
like it's doing her real-time analysis
but it's very important to know that
this is not a real time is offline so if
this was a real case where thermostat
were running the agent remote on running
a Madonna on on a server you will get
all the memory spikes and everything you
obviously to the normal job of doing
critical thing like a performance
analysis and and all the graphics and
everything on the client which may be a
simple developer machine in the
and Monty we would like to do we don't
have it yet but we may have help from
you it will also be to be able to board
the Google iron to two other operating
system as well because the current state
of the art is that we still depend a
little bit on information that is on
Linux so I cannot run even obviously the
agent is twiga for OpenJDK but also they
look like not really run on mac for
instance or some other operating system
but if there is some interest to do that
that would be great already in patches
from from you as well so let's try this
this out what did matter what is first
of all because at that point we when we
we have thermal studies it's all divided
in a plug ins and everything so the
structure is pretty divided but is still
one monolithic program that gets
compiled that means it carries the same
information the same built information
that goes for the agent is also just
buried to the client so there are some
things and maybe the agent is using
there are some libraries and there is a
very tiny little bit of native code
using interval stud and you would get
this into into the source tree as well
so it would be difficult to to compile
for for for Mac the graphical client is
mostly without any any other code in
reality it's difficult to see here but
you see at least the colors and
everything looks a little bit more
integrated in the desktop that omair is
running so there are there are few
things that we do in order to get this
integration down and this using gtk
libraries really minor things that can
be fixed with with some work that's why
i said if there is interest we will
definitely welcome patches in order to
this especially the GUI client and then
the command line client more portable
across systems right well the client
died sorry the program I was testing
died cuz it's leaking memory and on
outer space so I'll start it again but
but well it's supposed to be a buggy
program that day so this is a begi
program and as you saw from the ER it's
actually leaking memory but you didn't
have to wait for it to crash you figure
that out we can also see it from the
memory region patterns so if you look
here there's a very particular pattern
here in the old gen it's going straight
up it's increasing linearly the heap
analyzer will show you something very
similar in fact it makes it even more
obvious there's definitely a Java memory
leak happening in this program you can
try hunt down what's happening but
thermostat it gives you a few tools to
help it out first you can trigger a heap
dump
yeah there you go there's a little
marker that appears indicating that's
the point the heap was down and we can
see the list and examine it let's save
it too so that's why all the madea you
just have to ask for it then is save it
in the in the database if in one year
time you want to analyze that you can do
it provided you didn't wipe out the
database obviously and well let's
hypothesize we have a memory leak what's
going to happen well there should be
some objects that that there are lots of
let's see if that helps we can sort by
instances and look this looks really
relevant it looks very interesting those
three actually let's go back yeah yeah
it looks like there's lots of these
uh-huh and there's a map in vault and
some bites possibly using store this and
well you can pretty much guess the
structure of the program already let me
show you the source code in fact here's
what the program is there's a map that
contains the objects there's a user
information class which contains bites
except now we see why there were so many
bites and there's a bit of a bug here
we're putting in with a key that's
different then the key that we're using
to retrieve data so here's the cash
which is broken there's a memory leak
and with thermostat we can find out
based on the pattern set there's a
problem and then we can even get a good
idea of where exactly the problem is I
think it was very obviously obviously
now we know how those problems work but
when I first tried that out I didn't see
the Dakota itself and that's real tea
and then it was really like wow that's
really directly there the broad are you
creating
too many things into an ash map or
something because it's really really
popping up right away so its third mo
this mo is actually based on the classic
computer science dining philosophers
Karen I think this is easy to understand
what it's doing okay so I'm going to
skip the description now it's a deadlock
okay I'm still thinking about eating
something I mean the toys yeah what's
blood yeah so I'm going to try something
first uh there is a deadlock detection
in thermostat that's built in so you can
just hit check here and then we'll say
no deadlocks that's great and now I'm
going to actually make them deadlock and
hit check and it will point out here the
threads that are deadlocked you can also
see that interactively here if I enable
the thread monitoring so this gives me a
list of threats and their states so you
can see based on the colors that these
guys are running these guys are waiting
and hey look our dining philosophers
Ellis bobbing mailer and they're all
blocked so well this doesn't tell us
that they're deadlocked but it does tell
us they're completely the block yeah I'd
send the internet you can check there
and see if it's a dead log or maybe
they're just waiting on Santiago and
that once again this in for this
information is in the GUI when you asked
for it but it's actually in the database
so you will have an historical that
means at some given time your
application that loaded or maybe didn't
or the treads you were tracking where
bloggers at that time and and this is
always there so in one year two years
time you can go back and see reconstruct
the whole story of threads in your
application so 17 first
not here but we will get back to that
yeah we definitely get back to that
because there are somethings that we are
preparing for the future and we also
talked about Shannon low he is in the
last three years like a microanalysis
space for storing the mattress is there
a mechanism for deserting old data so to
see if you want to start taller or if I
just want to throw away everything along
yes yes so I me t-shirt yeah maybe oh
the show so it is there and we get there
to the last question so as I say in the
presentation at the beginning that's we
we started out with Santa is not really
exactly one more tool so it even if we
have to give obviously functionality we
decided to give first the functionality
is more similar to other two so that we
can assist in migration but the nice
thing about thermostat other still don't
tell is both the level of integration we
can do in the virtual machine and the
fact that everything is a plug-in so we
are building a platform that you can
stand introducing your infrastructure
and and that is completely open source
it's completely free so that you can
take and it's actually really a platform
for monitoring we want to build
something that has virtually even if we
don't provide you with any plug-in ready
for doing analysis you have all the
tools to make them up easily so that's
the driving point then of course we keep
putting new feature inside especially
things are targeted at being integrated
with with the rest of our infrastructure
like a garbage collector like the Java
Virtual Machine like jboss application
server and so on so there are things
that are coming in the future will make
everything more integrated
keep spending on what we have already at
this point so we want to do let's say we
have a same similar starting point to
two other tools and we actually like
that there is a big ecosystem so that if
there are tools that do the job better
for you then you can integrate them
intermol stud in your workflow so now we
really need to rush Chris re you select
just JDM was that the monitor it has to
be so the focus is openjdk I've been
running we horrible JD gay and it works
because obviously the unfinished or did
I don't think that was a question no I
just I have Kim JDM veranda magazine i
only won 102 can I do that so there is a
way to do this because we have a way to
separate information for for thermostat
in order to Nam wider so thermostat this
point some agents that that answered the
West out there most others in the
monitoring the spawn some agents that
are responsible to take to connect to
specific virtual machine arani so you
can have a list and say don't do that by
default do that only if there is some
some water magic we never use it that
way so them probably have to be
triggered a little bit but it's
definitely possible and then of course
you can use thermostat in a way like if
you're running for a selected user then
it will only get information for that
user so if you run leave to a machine
without the infrastructure for
collecting everything from the system
it's also better support for tweaking
individual things on and off by default
not completely perfectly there so I mean
your use case that's something would
really like to get in completely I don't
think we're there yet yeah no but I
think there is already a workaround yeah
there is everything that is needed for
making work but it's not a use case that
we support by default
why make a difference if that Jamie
neither stand alone jbm or gave us
because I gave in yeah for the basic
functionality there is no difference but
obviously you may define some some
specific metrics jboss application may I
don't think it makes any difference if
you're running a jboss application per
se but obviously you may be interested
in in highlighting some specific feature
or jboss for example you want to take
out from the least some threads that are
specific to the Boston you know it a one
getting in the way and then of course
you can filter them out but making
thermostat know specifically about jboss
it's a next step is very what colony
should work yes yes yes so I think it's
the last demo and we're two more and I
got six minutes okay so you didn't need
to really really faster than the Western
I shut up so this time was called
Ellison Bob and we're gonna see the
thread control panel in action again so
here's a program that was theoretically
supposed to be massively concurrent and
doing tons of things by default but in
practice we notice it's not really doing
what it's supposed to be so here's how
we can find out what all the threads are
doing yeah so we're going to enable the
thread control panel and trying to
figure out our LS and bow threads and
hang on a second what are the threats
doing well yeah they're alternating so
our massively concurrent program well
theoretically it has two thirds our
massively concurrent program is really
single threaded so we don't know why we
don't know how but it looks like they're
trying to use the shared resource some
resource and only one thread is running
at our time at a time and and once we
find that we can try and track down
exactly why those threats are doing what
they are doing yeah but because I think
using my consumer produce it yeah that
wasn't most
yeah that's that's exactly the problem
of you know find out things that don't
work somebody uses a code and it should
be something else yes I sorry yes of
course if it wasn't enabled by default
so if you if you start with the trap
monitor off then of course you can only
turn it on when when it's running
because there's no way yet to relatively
doing that so okay show the golden as
you say
so this is the ping-pong program so
there are two threads and they're both
trying to lock on 174 yeah you find the
line oh yeah there you'll see is there
yeah that's the one lock the shirt lock
that they're both trying to acquire so
only one thread once at a time but we
didn't need to look at the source code
to find out that one there is a problem
and to hear the threats are involved in
this problem so yeah two meals for the
last two minutes for the levels a couple
of quest and more so okay so this one is
a bit more different I am going to turn
off everything okay so do you have a
question in the meantime sometimes very
very slow and we want you to shoot with
wait where is the slow cautious with
closely slow yeah that so which way
actually this was too so in that moment
you can try to find out where it slowed
down by analyzing the tread data so when
you have trade data you can see in time
when application slowed down by by mean
of tread States Ronnie obviously we
don't have yet at the moment a matrix
that gives you things like an hour
through boot or something but that's
something interesting we are trying to
work on something like get get
information or I don't know other other
things are can get
we want to thank you to see and give you
the Aquila for certain message how long
will take it just gonna keep it ah yes
you can all the specifics all message
and then we can just talk about it with
the whole time span and then we can yeah
definitely that's just part of the year
yeah that's this part of profiling
infrastructure it should be ready next
month or something sunday at this behind
the door and actually I had a demo
running for that but the code is a bit
disturbing yes yes we call that
everything the firm so everything that
the dell grading system give us for free
we get there another another thing we
are looking at it is to dip in the
process memory mobs say the information
that is posted in pro so all those
things are getting there and you will
definitely see an update very soon when
most of those features well so the last
time I want to show is how thermostat
how using thermostat if there is no
support for your custom program you can
implement it to yourself so here's a
custom program I wrote that I want to
understand how it's doing and in this
case I don't care about any of the
standard metrics that thermostat comes
with my program is doing something
special and I want to measure how fast
that thing is so in this case the
program writes some sorry in this case
the program computes something and then
writes its data to a file and then we're
in a thermostat agent and a client to
actually show us all that so this
program has an awesome new tab custom
that's actually showing you metrics for
that custom program oh there you go
sorry it was cut off so here's the
plugin for thermostat was the
yeah thanks so here's a custom program
with a completely custom metric that i
wrote a plug-in for and now we can get
this information this could be awesome
if for example you're writing a web
server and in that case you want to care
about things like how many requests is
it during at a time you can write a
custom plugin extract that the
information displayed and it fits in
with regular thermostat yeah this is
this is actually something use of what
I've been yeah working in embedded
devices for for some years and why
important things that we had at the
point is that we had well we will always
struggle to get the last tiny bit of
performance out of really two methods
cold maybe and or maybe an hour trying
out the analysis of something that goes
on when when it called it Jay and I did
so it's something like that you can see
this information right away even if
thermostat by default doesn't provide it
then you can write a custom plug-in in
order to put this information in this
case did that's better happy to let the
data if you yes exhale mikasa is the
plug in the custom tab is annual again
did that on the road the collapse this
information somehow that is a pleasure
so something that is specific to your
application and then the the thermostat
GUI knows about that so it can visualize
this information but it may be very well
that you already have a visualizer but
maybe just run on the single system and
you are extending it that by using
thermal stuff those customers which are
to be explored over jmx I don't know you
know we have a different plug-in API
there's an API for that so on the agent
side that API basically allows you to
push that out onto the storage mechanism
and on the client side pull it out and
display ssa's all right Joe busy
application so if your idiot some osj
basic application they should
pretty easy to introduce stolen junk
store inside use any national database
so at that moment we use as a back-end
mongodb but we try to be not aware of
what we are using that's why we always
use the storage layer as an example in
the in the case of the web is using rest
services setting a rest wrapper on top
of our storage and and I am be working
on our a generational database in
particular I wanted to use post
chris.cesca well we really didn't have
any any reason for doing this so far so
it kind of got lower priority but I
something in the works and and for the
next version of thermostat I will try to
get it back how much detail producing
today Julia ah really dev and so
difficult will lose it 15 days we had
like 60 gigs at da 15 15 yeah Santa but
but this is siding just analyzing just
thermal studying yeah i think so i don't
know excelled this is something pretty
easy to do because you can just run
thermal stuff for a bit and see how much
data it produces any it depends on the
plugins you're running obviously so
tried analysis every every so when we
when we want it to be very bad i started
doing something every five milliseconds
don't do that get in start races and
thread information the system was
hopefully slow and i think i got over
this this disdain that you say in this
magic you say in less than an hour but
at that's a lot of data obviously
especially in a but Devon's on sunday on
the back end because no I have no I
skewer mongering stories a lot of
strings and stuff
so in the application and exposed my
pics or vest so what can we do yeah it's
so it's so if you are using something it
doesn't come with thermostat you need to
write your own plugin so if we don't
know about your data it's posit data
then you need to write raptors and we
have the storage API superstud the
mapping of custom data types is more or
less working like javabeans then there
is a little bit of over at due to the
security but it's mostly just described
in the new data die and and then it's
nebula you have custom package for Wi-Fi
like transactions of all banks cute that
in on the road map yeah those are the
things we really want to do I want to do
application integration like web servers
containers even OSU I for client
applications or servers yeah but not
done yet no no excel and the most
important is Shannon doe integration
Christine this cable dead what is it
I didn't I didn't get it can you go
you're right I don't know well I cannot
speak about Mission Control because it's
close its source and what they do try
record I think conceptually is very
similar to fly record because you you
have run in the the the system and then
retrieve ended and say in for flight is
one thing I think it's pretty different
between thermostat and other tools is
our whole pulled data save it and then
study later on approach most tools will
require you to either start your
application with certain parameters or
once your application has started you
can do stuff with it once it dies and
you close like your client it's all gone
yeah we'll collect that out we'll keep
it you can remove the data if you want
but by default will collect everything
and preserve it so you can analyze it
yeah and they especially dated the way
infrastructure is running you don't have
to care about using special flex in the
on the command line and everything yes
everything that you seen even though
even the agent is all plugin bases there
are only two contain things fine
demo account because something is
written in Java is that true yes
happiness meet angel has no anything did
you c c++ I if you want I can show you
the source code of the entire plugin
thank you thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>