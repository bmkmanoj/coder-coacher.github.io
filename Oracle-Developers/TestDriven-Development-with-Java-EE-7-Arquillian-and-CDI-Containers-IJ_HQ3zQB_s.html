<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Test-Driven Development with Java EE 7, Arquillian, and CDI Containers | Coder Coacher - Coaching Coders</title><meta content="Test-Driven Development with Java EE 7, Arquillian, and CDI Containers - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Test-Driven Development with Java EE 7, Arquillian, and CDI Containers</b></h2><h5 class="post__date">2015-06-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/IJ_HQ3zQB_s" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello apologize for the technical delay
this is a presentation about test-driven
development with Java EE 7 achillion and
GlassFish container so my name is Peter
pilgrim I am a Java champion I've been
developing in Java since 1997 and I've
got lots of experience started out in in
Java SC and then crossed over to Java EE
I also ran a user group in London for
about six years and and so my background
in Java is really has being with
financial services and only in recent
times as it switched over to grunt not
you know what banks investments banks do
they actually are people dare who care
about a lot more things in the world
such as the digital web and html5 and
then some so this is the book that I
spent over a year writing it's called
the Java EE 7 developer handbook and I
only just finished it about a week ago
really it got printed on Friday but I
don't know it books were meant to
actually make their way to the local
bookstore but somehow it didn't make it
sorry about that I did my best but there
you go it's bye from Packt publishing so
I guess you will know about Java EE 7
the 8 derp you've been to a lot of
presentations already and yeah there's
lots of things in it so I'm going to
actually jump straight into a demo so if
I come out of here and get into in tell
EJ at the moment I have a a mock-up of
what I really want to do
and this I've broken it I don't have
time to fix it so what it is it uses
angularjs and it actually is supposed to
be a project tracker meant to be a where
you can add projects and then tasks a
simple application that because I've
added angular I've complicated things so
there's I so if you know about the html5
and digital web you can actually write
these things they're single page
applications in using jQuery and a bunch
of JavaScript libraries so so I'm having
to rethink I think for this good
question how many of people are here are
really Java EE 7 beginners so there's a
pajama there's a fair number
so maybe chucking angular in to in
presentation obviously complicates
things and that gives me an idea to
actually have two projects in the book
sample sample website where you have the
traditional way of doing a website and
this newfangled way of using the hottest
greatest thing that's out there now so
having said that this presentations
about code and and testing so I'm going
to actually show you some code right now
and yeah yeah you can't read that can't
you
so this is a West End point test and
it's slightly more than beginners and
apologize to you
profusely but what what it is is that
you can clearly see that it it's
actually testing a westphall post
service and I'm actually using JSON here
to make a call to the server
okay right and it uses something new in
Java EE 7 the jax-rs client API which
you couldn't use jep's OS 2.0 and it
means that you can actually use jax-rs
2.0 to actually test restful services so
let's go and run that and let's have a
look I'll explain a bit more what's
going on on ok ah yeah that's it you
know my brain is switching between the
clips and IntelliJ alot and so working
with Eclipse is you you double click on
the tabs if you want to expand the whole
as source code file but if you don't
want to do that you have to click
project so um so I'll do the same here
actually pull this up yes what you have
to do is do that so what's happening in
this code is that and an embedded
GlassFish server is being launched by
the tests and you'll find out much later
what's going on there and we're invoking
a westphall service and on it and
actually it's storing the data inside a
in inside the Apache Derby database
which is also configured in this test
and that's all I wanted to show you and
so I'll switch back to the slides this
is Java EE 7 for those of you who need
another overview this is what are we
trying to do here we have Java EE what
we're trying to do essentially is help
all these little clients at the top
which offered as dota view at the back
or smartphone tablet servers desktop and
wearable technologies
have any you guys gone up to the
Westbury pie challenge yet
not quite I really recommend you do to
see what Java effects and Java and
embedded is doing and what so we serving
those clients and that's the client-side
that's where things like angularjs and
things like that run and WebKit and it's
this bit in the middle that concerns
Java EE the bit that is more than
banking nowadays it is the digital web
and then we've got the other side of
that sandwich so we've got the two buns
in there in the burger so to speak which
is your relational database and your
hardware CPU cores networking all these
things that are supposed to scale and of
course you've got your clouds key value
storage yeah so these are the api's you
probably you've heard them all before by
now probably bored to death with them
the newest ones are JSONP for JSON
processing WebSocket concurrency
utilities now you can invoke Fred's your
own Fred's and tasks in application
server whereas before if you did that it
was forbidden and what would happen
you'll get out of memory leaks and your
server would get a stack overflow
exception and dying or something like
that memory out of interceptors is also
very new which is very useful sir
contents and dependency injection yeah
okay and you've got that processing
annoying in my book cover a JSONP
WebSockets concurrency utilities and a
little bit of interceptors there was
really no time to cover batch or no
space in a book in a book so who runs
batch who runs any IBM are a few people
I have to write another book on it I've
been asked to already to write another
book so I've covered the Java EE 7 demo
so testing now this this there is
something else in testing ok you'll know
how to test we should know how to do it
but it's about people what I find
is that people you know are characters
in a software project and and it's about
turning this idea of projects into
reality how many people here have to
deal with development teams in different
parts of the globe an awful lot of you
so it's the agile principles here so we
value the things on the left over the
things on the right like that is your
right isn't it yeah so it's individuals
and interactions over processes and
tools who we want working software and
in for our agile software you know over
a negotiated contrast we want customer
collaboration over condom you know
contract negotiation and the key thing
about agile is this thing here
responding to change and that drives how
we test because if we can't test how can
how on earth are we going to respond to
change we can't guarantee what happens
before and compared to what happens
afterwards so you know those names or
you are learning those names you know
Kent Beck Liske Oh Dan North behavior
driven design guru Linda rising Scott
Ambler for people who know UML these are
the people who have in the last 15 to 20
years have changed our industry when I
started in IT in the 90s early 90s there
was none of this test
you just wrote UNIX see perhaps VAX and
you coded perhaps there was hardly any
object orientated programming if he did
that you knew C++ and Strauss trip and
and what happened now is this human
interaction with behavior sprints
ambition and drive adding more
that in our technology field is about
working together we have to collaborate
it's about empowerment of teens it's
less about having an ego and there's
technical things there like jail unit
there's virgin control systems as well
and if you're lucky enough to work in a
really agile with a big a you're getting
to introspection and retrospectives and
lean and flow chains so these things
integrations collective working attitude
in ambition our driving test driving are
driven us to test-driven development
these are the ideas that what we do is
going to produce quality code so
test-driven development is kind of
schizophrenic you've got a Jekyll and
Hyde and the people who do it well are
you supposed to do it well you never are
actually mixing production code and
encoding on test code at the same time
so if you raise your hands if you are
peer programming or have experienced
peer programming so a lot of you have
already experienced that too so this is
a bit of revision really for many of you
so the idea is to get green bars so you
put your test cap on assuming that
you've got production code already and
you write a failing test the green bars
actually pass and and then you make sure
that the tests pass and then you go and
then if you most of the time when you
finished writing a test you end up we
factor in your test methods and test
classes and then we have to refactor the
main code again so I'm not keeping up
with my click in here and at the end of
the run you ensure you get all green
bars in your j-unit
you repeat cycle again and they're free
ease of testing so in testing doesn't
matter what it is functional testing
integration testing unit testing the
first thing you do is that you are in an
assignment face you are setting up the
behaviors that you need to prove that
behavior you're signing and then you act
on that behavior you're testing that
behavior and then you assert and this is
the basis of testing so there's two
schools of testing I'm here as you've
seen there is the school where TDD in my
experiences really really enforced and
you get teams that actually will not
don't know it you check in in code and
with if it doesn't pass a test and then
you get the substandard school as I said
I'm an independent contractor and I've
been around and then some companies
really don't really have any tests at
all and then you're a new person and it
could be huge
everything you walk into a new tech a
new business and a new role and we are
the test I I don't understand you don't
understand how this thing how you're
going to produce that new workflow
engine if there are new to no test so
the first job that you've got to do is
write some unit tests okay mocks so
mocks are the idea of where you have a
stand-in where you're testing actually
behavior and after your mock is not
doing anything so things like easy mark
J mark par for the course
you're the mock is part of a simulation
it allows you to actually test so here's
an example of a mock Jess provision this
is a short example where you have a I
call it wing chun foo mark foo and I
have my j-unit method called setup
I'm using mockito here to create a mock
of that interface so this is
intermediate stuff assume there's a an
interface there and I'm using CD eyes
injection from Java EE to inject it into
my test so once I've got the test class
I'm using a very easily readable method
named as my test I it's not just public
void test it's actually invoked wink
Chang foo and return zero so it's
getting into the mind side the mind
share your share in this code we have
other people and even if you come back
to it in a six months to a year later I
understand what this code is suppose
this test method is supposed to do so
these are the three A's again I am
assigning here I am setting up my mock
that I when I invoke some method it will
return a zero result very
straightforward I act i probe my
processor well my mock foo actually
should be calling some method and then
I'm verifying with mojito that this
method was actually involved job done
stubs stubs stop objects are a piece of
code that stand in place for the object
so most of you here will have a severe
expensive dependency like a database or
a web server that does some complicated
interaction and you need to communicate
with it and it might be where I've seen
it might be a W a restful service or a
soap service and this that you can't
replace PayPal so what you probably have
to do is stub it out in some way I've
gone too far
okay a stub is an actor it's not quite
the same as a mug and they help you also
simulate what's going to on but they can
also record statistic
so that you can actually test what's
your behavior your application logic is
doing so this is from my financial
background it's called post trade
services the the bankers and the traders
have all done their best is they swap
trades now we have to send out the
letters or the emails or we send out the
details or store it somewhere simple
interface job interface that a post
trade service that accepts a trade
detail and trade ito is okay it could be
an F p.m. L object something with severe
object graph a deep object graph so in
my stub trade service stub I'm actually
stubbing this method out under this
service out and store in be the trays in
a concurrent copy and white ArrayList
don't ask me why it's a long story but I
wanted to probably wanted to test many
of these things so I'm accepting the
trade store them in there in my memory
away and I'm returning just a basic
statistics there and that's a very
simple stuff I mean the thing with
Stubbs that I should say is that I'll
get onto that okay these are the testing
tools I think you already know J unit
test ng Makita we've covered Hudson
Jenkins and selenium if you are doing a
lot of web testing and in the past
writing Java EE tests has been really
difficult and that's because it's not
easy to test inside the container but we
all know we need tests
we need tests to validate and improve
our design and it's also reducing the
cost of getting it wrong in production
and the manager taking your head off in
real terms
if you get it wrong that then the
business leaves money leaves his money
okay and the reason why traditionally we
hate test fixtures is because we have
lack of patience so and to continue this
shorter theoretical bit it's this we
don't like fixtures because they're hard
to set up we can't we don't own them
it's hard to refactor and we have time
and size and scope challenges we need
the code that's code working now and
there's not a case as I suggested if you
start in a new role lots of people have
architectural noises in their head they
don't they're not they're only
responsible for the database they're
only responsible for the web someone
else is responsible for the database and
the integration with another services so
this is the old-school
it's called Jakarta cactus it's the way
we did it up into 2008 maybe and it was
a way of running say struts and EJ B's
inside the container pretty hairy stuff
and so not many people actually use it
and some people did they used it with
may even Apache maven or maybe some
strange project such as cargo but it's
hard it's hard so the new tools for the
trade and I'm and I'm pushing ahead in
this book of mine is Gradle Grado is a
fantastic tool and for writing build
scripts and yeah you can still use maven
you can use grater for your private
projects and if you're lucky enough to
have a client that already uses Gradle
then it's great and Gradle is like
the underlying bill to in now in Android
job effects also uses it and certain
upper people it integrates well with
maven and IV repositories so let's look
at a grade of example here it's written
in grooving and it appears as a
declarative you look it looks like
you're writing declarations but you're
actually writing in groovy because we V
is very malleable you don't have to add
a semicolon you can you don't have to
add dots between your object and your
member or function it's very nice so
these are adding this code here I should
stop using this and say what this what
the code - this says this line here
applied plug-in says get me the Java
plug-in the next line says get me the
war plug-in that will generate Wars for
me war files the next line says give me
the Eclipse partly plugins so I can
generate Eclipse projects and similar
for idea jetbrains idea and I can set
the equivalent of maven coordinates
which is group archive base name and
version straight forward any questions
with that No so the next thing you need
to do is with posit Ares and it then so
if you're working especially with the
java.net repositories you'll need to add
this line in to get you the the
GlassFish and the Java EE 7 repositories
but that's strictly not true the most
important one since I think I'll call
are pushing ahead they've actually
pushed that to maven central so you
should be fine now this is only if you
are on bleeding edge stuff so the next
bit is dependencies dependencies look
like this here where you just hangul
brackets quickly
he's here you've got the provided compar
which means that your that this this
dependency will be provided it doesn't
have to be part of your war file or ear
file and of course you've got compiled
dependencies an example here is
joda-time
and then you've got the test
dependencies here I'm putting in J unit
so very straightforward any questions
with that okay our Killian our Killian
is a win is the replacement from Apache
Jakarta cactus it's in container testing
it's really magic it's really for
integration testing so if you really
want to and we should be testing a lot
of our code inside the application
server the target one that we really are
deploying to and it's just another
useful tool it means that we can deploy
westphall sockets and WebSocket
applications and actually test that we
are invoking them as I showed you Jess
in just now in the in that early example
the way it works is that it's an
extension of j unit and test engine and
it has the secret formula okay that's
the URL down there arquillian org called
shrink wrap shrink wrap is a
programmatic API for creating your own
archives and they can and it can be a
jar archive it can be a web archive it
can be a enterprise archive and if you
are lucky enough to be Java connector
application connecting people your your
it can also generate resource archives
and so it's the key component in
arquillian and you use it to assemble
java classes and and resources so here's
an AR kili an example the first thing
you do is you have a you turn up and
station which they run with with the
Arcadian class tells j-unit to execute
instead the arquillian test runner and
this annotation here at deployment tells
arquillian how you are going to bundle
the archive for your test so I think
you're getting the picture here so we're
building a simple Java I carve here
which is a jar and we're using the
shrink-wrap class static method
cooperate with the thing that we want to
create and it can also work with the
other types as well then we add classes
I'm adding a help desk support class so
this is a jar with only one class and
then I'm adding something more funky
here which is the manifest which is the
meta in and I'm adding an empty beans
XML and that's quite useful to say
because if you have imagine now you had
different CDI beans and there that will
that's a way of specifying an empty
beans XML will be without even having to
have that in a resource in your project
so the next bit is really quite
straightforward it's the test and so I'm
injecting here my EJB I could be a CDI
bean but it is an EJB service and I'm
again you understand what this test is
doing this is retrieve unique not null
agent names straightforward so this is
the algorithm to get the next agent
names and the call center from our EJB
service and the algorithm it says
accumulate all these names in to
collections and and if you want to know
if they're unique
we it's an ArrayList and a set and if
the size isn't the same then we know we
have a problem here Houston straight
forward okay so that covers the ferry
and so now I'm going to go right into
demo mode okay so with the first thing
that I want to do is I want to
okay
I think it doesn't matter it doesn't
matter so let's go into EJB so where am
I
I'm here CD idea chapter free I think it
was no yes
okay that's why
that's what I did I mean the wrong
folder nice EJB like here yes good when
that come online to find him is working
okay so with a EJB test this is the
shrink-wrap test again and so I'll just
prove that it actually does work so
we've already explained that did I
actually fire up in a console yes it
does so what you get there is the
application server firing up okay I got
an insertion than ever
ah okay yeah I've got well obviously I
broke the test so but
and then I
that mean
I still have collapsed my ID me
let me do that okay that's better
okay guys messed up okay so the other
test that I have is an R is where I have
a master-detail
beam and and what I have there is what
you will find in in the typical j2e
application if you're 14 you have a host
name and and port and and what happens
there with this test is that it's proven
that the conductor master is able to in
capture the detail of the beam so so in
these tests these are really
straightforward EJB tests here and so
there's things here that will allow you
to in the book go and play around with
ej beads I did have a a shopping cart
beam yeah test here okay so I let me
switch around from that because I think
that is the most basic examples here so
I will jump into another Killian example
and this edge swap into CDI
and see the aisle is really the the most
useful thing the most key thing that you
should learn about Java EE so so I will
go again and find another intermediate
example which is I guess the credit
processor and so what this one does it
uses you have two types of credit
processor a premium and and a economy
processor here and this is the the
interfaces it so if the economy you have
qualifier and for the premium you also
have a CDI qualifier and so the test is
as generally is to ensure that you can
invoke the right inject the right credit
processor so these are really
straightforward examples and the upper
tests III have is even if something
called the sanctioned surface and what
that does is I it got a transaction or
credit service processor here and I
think what I've done with it
we did here is and where did I put that
sanctioned service so okay so I've got
an interceptor here and the Interceptor
is demonstrates how you could write your
own sort of transactional behavior so
okay
that we see
oops
okay okay so what obviously happens
there is that let me get out of that and
close that I just had it there I was
just showing so with you you actually
see here a way of into how you can
actually intercept invocations on CDI
beans and generally the reason why you
want to do this is because he wants to
have a cross-cutting concern and so like
a transaction intercept or something is
going on in your application that
requires a various form of checking and
I'm trying to see where I put this
sanctioned service at the moment it
might be somewhere else
okay so we've interceptors you need to
declare it in the beans XML and the same
thing you do with with decorators
decorators are kind of fancy
interceptors I don't know if I okay so I
did put it in here so it's I actually
put it in the in the decorator
so it's but it's easier to look at the
debug to figure out what's going on okay
so it's it's invoking the credit
processor and when you inside the
decorator you are checking for some kind
of sanction I think it's instructive to
go and look into the the premium credit
processor where and what was it this is
meant for people who really know Java EE
is a bit intermediate I guess and the
decorator class are here we are
this explains it now so this is what I
was looking for it's not again
okay I think my clickers just died so
let's not do that so will you have the
credit processor decorator and I'm
injecting a prior sanctioned service and
I have a delegate a credit processor
that unwrapping and I'm just checking
that the this that I'm sanctioning for
these operations with a hard-coded
currency for a peer which is euro
British pound so this is foreign
exchange currency an example so it's
hard cause it encoded so what will
happen here you can imagine you cannot
pass unless you have a currency peer
that matches this and this is a
decorator so anywhere I'm using a credit
processor I'm decorating that credit
processor in the CDI container and
because I am decorating it I can apply
rules around that credit processor to
say right you shall not pass if certain
conditions are
right so this is the key to CDI you can
inject light spring lots of dependencies
and your application can get really
complicated and with CDR you can also
have something called alternatives so if
you wanted to have mock or tests or
stubbed out credit processes for that
PayPal client you can do this as well
with custom beans that XML I think that
covers enough of I guess CDI let's see
what should I do now I think I should go
and find something really interesting
for those of you who are working with
stored procedures would you like that
it's okay okay let's see I've got to
find the IntelliJ file okay as you know
Java EE 7 at least JPA 2.1 does support
the stored procedures and it's really
cranks joy to straightforward to use it
so the first thing I do here is I need
to run our Kilian in a in a serve as so
it connects to a managed server so let's
see I need to do is the admin and then
after that I'll jump into WebSockets
I'll need to check my time of course
start domain and be verbose just for so
that you see what's going on because
these are examples you know ok so inside
some Fred area yeah
okay I'm on my in there's only one way
to find out by running that test and if
it fails I think it fells something went
wrong there there is something running
with GlassFish I don't I didn't see what
happened there
now why I'm sorry about that
it's the issues of the demo god
so okay weird stored procedures right so
that's not okay so JP a stored procedure
tests so what you do is okay so this is
simply you have a stored procedure query
and you give it a name the stored
procedure that you want to invoke and
you register some parameters and and
essentially it creates a tack it just
returns the results in a results list
and there are various things that you
may have to do depending on your
database say if it's all accord with
reference cursors so this is I don't
know yes
so what I do then is yeah I'm that's a
not good I wish that was working I'm
going to jump straight into WebSockets
then
Klein
okay who have WebSockets you can also
use both sides of the API so we so
there's a you can have a client-side web
socket and you can also have a
server-side endpoint web socket so this
is the most simplest endpoint that you
could create here which is an and web
echo WebSockets server and it has a
method called do listen and all you're
doing is returning a string here and so
to test this is if I can locate the unit
test class okay okay I think I've opened
the wrong project yeah
okay so I think that this one is the
demo of the of the chat server and I'll
be able to oh what the hell
yeah let's see the demo gods have really
messed me up today let me try and Safari
so first thing I need is day
some strange freaky things going on here
with all these demos today I hope my
server isn't
yeah so I'll show you the code actually
okay so and I think that's what I do so
I've showed you the client end point
there and there's another project which
said obviously a chat server here part
of it and the way the chat server runs
is it listens to messages on their own
message bit at on message and I'm using
just strings to interpret the type of
requests that go in to the server and of
course the surfer is quite
straightforward so I have a chat user
which is generally a POJO simple podium
and and of course the chat room so of
course it's a concurrent map I'm using
the life cycle annotation to show what's
happening
you can add users and the most important
bit here is when you broadcast users so
if you if you go back to the the the
chat so a server endpoint you your see
that it accepts a session object and
that is the WebSocket session it's
rather like the HTTP session but it has
a different life cycle and from there in
the chat room you can record and so
against the user who's in the chat room
actually
so you and of course here in this bit
with my concurrent map I'm adding users
and adding a new chat room user and what
am i doing here I'm going through and
working out who just joined in this loop
and then building a message so the code
is is I think fairly fairly
comprehensible and and you'll be able to
play with this in from the book it will
be it's on yes it will be on github it
is on good github for the benefits of
parlays and in the next thing you do is
is I have this broadcast message here
which iterates through all the users in
the concurrent Hashem map
yep concurrent hash map and then if the
if I I'm asking if they have an open
session
so remember WebSockets are full duplex
duplex and you can close from either
side you can send messages from from
both sides it's fully a synchronous so
and then I encode the reply okay so I
will that is a pity with demo gods as
they say let's I'm I'm sure that do I
have another one which is our Killian
norm I have a jax-rs one
which I which is a lot nicer because
it's running the inside the embedded
class okay and I know these actually
work okay so I'm gonna show you the most
basic tester here and this is using our
Tilian let's get this back up into fool
so I'm using the shrink wrap again and
it's really good I'm building up but
look what I'm doing here I'm actually
building a war file in flight and then
I've got this little thing called a
simple embedded runner that we will
deploy my war file no this is something
that's part of the book so it's this I
explained that check my time okay so I
can I can explain that afterwards okay
so what that does is that it just fires
a set of lines to to the server so I
should run this okay
so that something's weird I think my
port has died there's something running
there but I won't go and fix that okay
the other one that I do have is the
client side test which is showing
demonstrating how to run the test with
how to use a client builder to jet to
get the list of books from the web
service and from Jack's Arguelles so I'm
assuming you know what Jack Cyrus is
and so just which we even that so I know
that's not going to run and of course a
synchronous you can also run a
yes a synchronously and this is a bit
tricky and a reason why it
it's tricky is because you have to then
do a lot of concurrency code I do a bit
more work to get so we've jax-rs and
this is work also is from the server
side you're making a synchronous
requests and you get back a future and
I'm cheating here I'm actually delay
delay in for 3 seconds what you should
do correctly is use a countdown latch so
what you have back in jax-rs you I am
you to the countdown let excuse me
right so reason time you I've put it
actually in the invocation callback so
I'm expecting a response I'm reading the
entity the body from my jax-rs service
the entity and then I'm counting down
the lash so I know that in the test I I
don't have to do funky waiting waiting
around or Fred sleep well and because
you never know how long your Freddy's
gonna run or how the server is on the
other side
well now that's going to be really
useful running in Jenkins and and in
Hudson so what should happen is with my
assert I am checking for callback
failure here so f if I get a failure
with my invocation callback I will set
that the stack trace okay and the other
thing that is really nice is this is
testing something called jax-rs this is
a cipher test jax-rs allows you to have
we'd listeners and right listeners I
might know if I got it wrong let's go
straight in what you can have is an
interceptor reader interceptors so that
means that you can encode your entity as
gzip or you can encode it use
cryptography as I'm doing here and I'm
this is bad code don't never put the
password inside your class and the other
thing you can do is you can have on the
client side so you have two different
types of filter models you have
server-side filters readers and writers
but they're incompatible they're not the
same as you get on the client side for
obvious reason so it's actually called
client request filter and so you can
actually add debugging I think I've got
one minute here left so I think on that
basis I will wrap up and go straight to
the end
oops if I can remember how to okay
okay so I was so so to run that embedded
I'll be there okay yeah we are there so
this is the code for embedded runner and
you can use Tommy Tommy EE or jetty this
would be the same code but this is
specifically for GlassFish and GlassFish
allows it with the benefit of of using
an embedded container is that you have
control of the of the boot strap
classpath and you can control the size
and package your dependencies so the
really great thing if you have a
difficult organization weave you can
just chuck them a jar file and tell them
to run this code and then you have a
server in their environment that is yes
a restful service or doing something
that you really and you don't have to
deploy to application service because
your application is running an
application server so okay the executive
summary and our Killion is is great to
mock or not to mock what I mean by that
mocking is good for I guess 80% maybe a
maximum of 80% of what you do in Java EE
but I think that's gonna increase
downwards or decrease downwards to 60 I
think with our Killian we're gonna see a
lot more integration tests and it does
make sense to do it that way since you
know it's very easy to do it from now on
you stab so useful if you've got really
difficult resources and the resource
that never goes away
that always is annoying you in my then
in that case it's worth mocking it out
and even maybe using some something else
yeah
attitudes about testing I say keep
sending the bullets we've got to have
more tests we don't really
enough of them and I guess there's no
excuse since we have Java EE 7 and
arquillian and this is I've used a lot
of photographs and creative comments
from Flickr I need to attribute these
guys and girls and thank you I think
that's it</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>