<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>REST Assured: Hypermedia APIs with Spring MVC | Coder Coacher - Coaching Coders</title><meta content="REST Assured: Hypermedia APIs with Spring MVC - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>REST Assured: Hypermedia APIs with Spring MVC</b></h2><h5 class="post__date">2015-06-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/fx7K0ZYoNas" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so welcome everybody to this I think
it's the last session for today is it
yay all waiting so I'm the last obstacle
for you to see Aerosmith so yeah welcome
to this to the session on rest
hypermedia spring and whatnot I've been
to of quite quite a few talks in the
last few days and they all had these
kind of safe harbor statement it was
kind of new to me i'm from germany which
is a good thing because you're not
afraid of long class names right because
in germany every words like are and if
you've known abstrait single proxy
factory being and what I show you a
longer one even later on but i'm from
germany i'm not used to these kinds of
safe harbor statement so I came up with
my own one because I realized that
pretty many of the talks that I've seen
so far is like okay there is some API
that might be released in like 20 17 and
it you could might be able to play with
all stuff you'll see today is pretty
boring because it already exists right
and it's used I'd like that wild leasing
in production so we have quite a few
like customers projects on that stuff so
what is it that I want to talk about all
kidding aside or let me introduce myself
my name is Oliver kike I work for a
company called pivotal I'm responsible
for the spring data projects at pivotal
so what is pivotal in the first place
it's yeah so pillow is putting like the
fun back into enterprise Java for 10
years now as I've just found out spring
framework one at all was released in
March 24 2004 and it's pretty much a
rebranded springsource interface 21 all
the names that you familiar with it's
pretty much the same open source
projects you see the spring framework
groovy grails are there's tomcat a few
commercial projects like green plum or
the fabric campfire
so it slightly slightly shifted focus in
terms of that we have more data products
nowadays because I mean big data is a
big topic and but still the the very
core the very the open source projects
are still the same that they were like
interface 21 or the spring source days
all right I have a twitter handle I beat
the hell out of a drum kit from time to
time and i read a blog which explains
what organized means so if you want to
know I mean go to it or just check out
the block and put up some ramblings from
time to time there all right so what is
it that I want to I want to show you
today so coming from the point i'm
working on spring data stuff so what the
heck does this guy know about hypermedia
and rest right before i work on the on
the on the data stuff or yeah while i
did the data stuff in my spare time i
spent some time consulting for spring
source and we build quite a few rest web
services it was like from 2009 to like
2011 or that roundabout and we solved
quite some problems in these projects or
quite some challenges that i will like
bring up in a few minutes and we
actually solved them quite the same way
in each and every project so yeah I
started to look into that stuff take
some of the code from the customer
projects d customer eyes that and turn
that into a tiny library that you will
get introduced during the talk but um
yeah that's that's pretty much weddy
weddy the passion for the topic topic
comes from so what I'm assuming or it's
probably a good good point here to ask
you guys um who of you has built a rest
webservice already who is used spring
for that who like the experience that's
more hands than then than before anyway
so you probably quite familiar with the
very basics and that that's a good thing
because I don't really want to spend
like
10 minutes explaining what a URI is or
what the uniform interfaces right so you
know that we have these resources they
are identifiable or you interact with
them using standard methods these
methods are well defined they have
certain traits and you only interact
with these resources through
representations which is like JSON
representation or an XML representation
right so far so good that's pretty much
where and where everyone is still on the
on the same on the same plate here there
is and that's why I brought up the the
quote and then in the very beginning
from Roy there is another constraint to
the topic of rest which is the
hypermedia constraint and if you follow
Roy's thesis then as he suggested in
that very email is not an option of a
constraint something that you might do
or not do but is like a fundamental
concept of the architectural style of
rest and this is a topic that not many
people really get into they just like
thank okay we put our recourse mapping
annotations on it have like me Chris
method get put postally and we drop some
jason into the clients and then we're
done right but they're like this hyper
media aspect is quite a challenge I mean
to understand in the first place and
then to implement after that and I hope
this presentation can actually help you
getting a bit forward on that who is
used or has implemented hypermedia
elements in their rest web services
already okay that's I mean the bottom
line here is it's it's a lot less people
than are the that showed up when when I
asked who builds rest webservice and I
hope that I mean of maybe a few more
people will actually look into that so
what is this hypermedia thing about
right there is this other abbreviation
that is in this in the thesis and if I
asked like four people of you I probably
get like five different pronunciations
of that kind of thing and no it's not
hate oracle application server
although that might be a valid statement
come I don't think Roy was related to
Oracle in this case it's hypermedia as
the engine of application state and what
does that mouth full of sentence
actually mean so reduced to the very
basics it's effectively that instead of
just dumping the data to the client and
like we are feeding it with that and
leaving the client alone with like the
decision what it can actually do with
the resources it's including links into
the representations right so let's take
a step back how do you actually look up
a book at amazon com if you would do it
the way you usually write a client for
rest webservice you would look up the
documentation for the amazon website
right and then there would be a giant
uri pattern that says ok here in the
middle there has to be that ISBN and
then you go to your browser URL bar and
then you construct it you awry and then
put in the yeah what exactly right
there's no I mean the name in what is a
capital case it is a lowercase what
really identifies the book and that's
not the way you use the web right so you
go to amazon.com you find the form and
you enter like your search terms then
you get to a result list and on the
result list you find a link to an
individual book and you follow that link
right so on the on the browser it's like
means that are understandable to a human
on how to follow like the resources from
one state to another and the question
now becomes ok if we want to if we want
to implement rest for like
machine-to-machine communication how
could that process look like for like
yet Jason representations or X and loud
representations and what have you this
could like come in two different flavors
the first thing is like making obvious
in the representations that are that
things are connected to each other so
an order has line items but an order was
also like placed by a customer and we
one might want to point to the customer
that actually placed the order in the
first place so it's basically like
interconnected data but on the even more
interesting part is that you make like
state navigations discoverable right so
take take an order pay for the order and
after the order is like completed then
have a way to conclude it and yeah
that's all all stuff that we want to
want to look into today but start with
the very simple very simple things and a
tiny spring library that can help you
with with building that so this is a
JSON representation of an order class
that you might have just written and um
just have your spring MVC controller and
return that order class and then Jackson
goes ahead and create something like
this right and this is exactly what we
don't want in this case we want to make
obvious to the client what it can do
with it right so there there might be
you might say okay there's this payment
expected thing here but what does that
mean it actually means that you have to
now go ahead and consult the API
documentation and find the section on
okay how to pay that that or pay for
that order and what you can do that or
can do to improve that situation is
basically add links to the
representation and then basically
implement a client that says okay
whenever I find a link with a certain
name this payment thing here I know I
can actually trigger a payment to it
like on an iOS application that might
mean that a button like a checkout
button or something appears in the UI
whenever that particular link is present
right and the other side effect of that
is that we don't have to care about the
URI structure anymore right so because
we actually just the client will just go
ahead take the payment or the href the
value for the href attribute
of the payment link that's effectively
it ok so we bottom line is here we we
add additional data to the data like
hypermedia elements to the data and the
funny thing is that nowadays where
everyone like speaking Jason to each
other we get into an interesting problem
remember the Amazon story that I just
told you about before we can use
browsers and we can navigate from
resource to resource because browsers
know or one day when the server actually
sends some HTML to the browser it knows
how to find a link in the HTML right
there's a speck saying okay there's this
anchor tag and has an href attribute and
so the browser can go ahead display it
so that you as a human being as you
hopefully are our can actually click on
that link so if we like communicate in
Jason we have an interesting problem of
okay Jason doesn't really define any
link elements does it XML doesn't define
any link elements XML knows Adam who is
heard of admin before quite a few so
Adam for examples defines a link element
that has a nature of attribute and a rel
attribute a relation type which is the
equivalent to what we have here so the
question is okay how do we represent
these links in in Jason in the first
place if we want to use JSON and the
underscore links attribute here is not
something that I came up with but is
part of a standard called hell
hypermedia application language which is
immediate type definition definition
there such as application Jason that
builds on top of Jason and defines
certain attributes and the most
important one actually being the links
element so why is that important the
important thing here is that just as the
browser actually only knowing that the
anchor element in HTML is something that
it has to display in a certain way so
that you can click on it
you can actually build a client that
understands how to evaluate the links in
here right so you don't don't build a
custom a custom client for for some
arbitrary Jason or some custom Jason
that you made you made up but you can
build a client for for hell based if you
choose how as a media type for hell
based systems and actually I have that
link in the in the resources in the very
very last slides there is a hell browser
like a generic application JavaScript
application that you can point to any
hell based our rest webservice so that
creates a like a browsable URI so that
you can explore the resources what have
you it doesn't know about like any any
specifics of your applications bless you
but it can actually like generate or
build some some generic API alright so
we as developers like is the if you work
with spring MVC as I said the the usual
way people like create representations
is through by returning like the domain
objects or maybe even dto special
especially crafted for for that purpose
of being rendered by Jackson the
question is if we want to add or enrich
these representations with links how do
I should do that right so we let's say
we have our audit order instance here
and we want to now create something that
has linked attributes we can put the
links on to the order directly so what
are we going to do and actually that
challenge was one of the first ones we
faced when we try to implement the stuff
and in customer projects which after the
d customization of the of the code led
to the project that or the tiny library
that is on github nowadays on I mean
it's been there for over EU no but
coldspring hate us and what it contains
is it's more it's not like like
like let's say the spring data projects
or a spring framework itself that are a
container or runtime that actually run
stuff but it's more of a library lid
that you can compare to Apache comments
on what have you so you put that library
into your code and you get access to AP
is that you can use to to build these
hypermedia based representations it's
very core it's two things its
representation models and a link builder
API and I just don't want to spend any
time in the slides anymore because
that's probably better expressed at by
looking at some code is that readable in
the very back is it okay okay awesome
because otherwise it's get it gets if I
have to blow it up even more than it
gets quite nasty so what I have here is
spring hate your sample that's in my
github account that's all you don't have
to take notes in that case it's all the
links are on the very back of the slides
so what I have here is a tiny
springboard app which you heard of
spring boot already quite a few so it's
pretty much a the best way to write
spring applications these days a very
simple way I let me just run that I
don't want to go into the details of
boot here but what I have here is is a
customer controller let's start with
that one that has a soul oh let's start
with the domain that's probably better
so we have customers when we have orders
pretty simple right in order is placed
by a customer that's the order belongs
to a customer it has a list of line
items it has an ID and the customer is
here right so that's that's pretty much
it here's the customers instance that's
like a sort of a repository but
basically a map that has like instances
of customers so we can simulate some
data so what we're doing here so the
very very easy thing that's probably
what you would you already know is we
have a we map our customers instance or
/ customers to the get request to /
customers to return all customers here
wrap that in a response entity so that
we get for 200 with a list of customers
so that if I go to that you are right
here I actually get exactly that let me
try to size that up a bit right so it's
an array of like customer objects that
consisted of first name last name right
I mean pretty artificial but you get the
point so what do we need to do I mean
the order that I want to look at is okay
for a single customer that should have
been uncommented anyway so for a single
customer for the very first one so if
you want to access that we go to slash
customer / one and that's actually a
good point here there's this this this
list here doesn't really contain any
links right so if I just look at that
thing I don't know how do I actually get
to the very first customer I mean I just
applied the very same thing that I
considered stupid when browsing
amazon.com what I mean manipulated the
URI and actually got to the customer
right because I happen to know that but
it's not obvious from the from the from
the representation all right so what
what we can do to improve that I mean
that's just a bit of like Java 8 so we
have the customers thing here that we
extract the ID from the from the request
find a single customer and map that to a
response entity that's just using
optional Java 8 optional and if we don't
find a customer that's the or else thing
here we just returned 404 all right so
how do we actually improve that let's
kill the the server because I need to
change the method signature so instead
of returning a customer directly like an
HTTP entity of a customer I'm going it
going ahead and say resource of customer
and then wrap that thing into the
resource
that should work so what I'm doing is I
take the customer and wrap it into this
resource object and what is resource
it's basically the interesting thing is
resource support the superclass here
it's the customer plus a list of links
right so they go ahead which means that
we can now go ahead and add arbitrary
links to that resource here right
there's the link object so resource is
part of spring hate us link is part of
spring hitches so that's a link that's
the href so it would be like HTTP
localhost what have you and this is the
name of the link so let me restart the
application and let me stop it again
bubble bar debug mode so that I can
change it for the better then okay so
what does that resource look like now it
now has this links attribute in here
right so there's a there's a relation
name and there's an href like that that
has this target here so it's basically
just doing the very same thing with
Jackson so it's rendering the the the
the object as is right we didn't really
influence the rendering and as you can
see it's not underscore links yet all
right so we want to do that but the
bottom line here is that you don't
really build or add links in specific to
a certain media type but you just have a
generic resource model and you add links
to it and then later on by some means
tweak the output so that it matches hell
or collection Jason or the other all the
other media types out there so the first
thing that I show you that in a second
but the first thing that I would want to
get into it is that building up links is
using strings is quite a bit of a
stretch so even let's assume we wanted
to to create a self link that's
something that
it is usually used all right so let's go
ahead and then what do we do customers /
and then we add plus customer ID
probably get it for that so if I save
that we run it right so we get that okay
kind of cool it should be actually it's
it's black I'd like I prefer actually
like a really absolute link with
including the server and and the port
and what have you so that's a bit of a
stretch because I certainly don't want
to ride HTTP colon slash slash localhost
8080 into that and the other thing is
that I've pretty much duplicated the
mappings here right so its customers
here and its customers there and I mean
this is a single class but whenever I
want to build a link to a customer from
someplace else I need to know the
mappings and would pretty much have to
change them if I if I want to change
them in one place and all that scatters
through your coat so there is an API
that we ship with spring hate us that
allows you to instead of manually
building up these your eyes is allowing
allowing you to point to a controller
method and say all please spring hate us
create me the link that this controller
method is actually mapped to right so
that's what we say here this is a static
method on a controller link builder
saying method on customer controller and
then we can call the method I mean has
it has any one of you work with mojito
already or like any mocking framework
it's pretty much it's working the same
way so we're not really calling that
method here we record the method
invocation save the arguments so that we
can later on when we actually reduce the
link to the actual link object we can
then take this object that you pipe into
the call and expand the uri template
with it all right did I save it I saved
it and I can resend that thing here and
you see it already it already builds a
fully qualified link to that thing that
means it also incorporates like X
forwarded host and whatnot all these
these proxying headers that you might
get involved with if you're like having
you running your tomcat behind behind a
proxy or whatnot so all that stuff works
out of the box so you get that thing
built here so if i change that to let me
just kill it again because that's a uri
change if I change that to fool and
rerun it that should make the link look
the same man of Jesus this way say yeah
of course because it's map to fool Jesus
so you see that that just is the same
where has the the chain the manually
coded up one is like broken in this case
alright that was the first thing the
other one is okay that's not really not
really relevant it's just like using a
separate well so there's like shortcut
methods for the self row but you can
also like as you can see here define
find customers okay let me check whether
there was another thing another to do is
there any questions so far silent
re link oh and able help me disappoint
that's a good thing so way just too shy
or okay I just go ahead throw something
at me if I'm if I'm too fast or if it's
too boring then I go quicker that's fine
so back to the representation you've
seen that this is just a plain dump of
the object into the like through jackson
and the object structure effectively
being a one-to-one representation of the
representation here what we wanted to
actually use is hell as the hypermedia
format so a slightly different way of
encoding the links right if you remember
with hell it wasn't like the links being
an array of objects with rel name href
URI but it was an object itself that has
the property of the URI and actually the
the a nested object for the for the HR
for the edge for the link attributes so
let me just quickly take out this self
link that makes me nervous like having
to self links in the very same object
that's kind of all right okay anyway so
how do you actually activate that it or
do you have to do something yourself no
you don't of course there's some spring
for that if you're using spring boot the
end you add spring haters through your
classpath you actually get the health
support activated automatically so you
don't have to do that kind of dance that
I'm doing here because what I'm doing is
I effectively disable this auto
configuration to show you how to
manually enable it right so for you for
those of you who can't use boot to
enable the health support for spring
hechos you use that enable hypermedia
support with type hypermedia type hell
and if i reboot the app reboot that
would be a good name for the second
version wooden
makes me wonder what we would do for the
third none reboot boot or reboot reboot
reboot ah good let me try that G ok so
you see we all of a sudden we got this
links thing under schooling so it's
hella compliant effectively so that you
could put your whole client in front of
it and then actually access the I mean
why would you do that or spring hate us
also comes with in weather with a few
client side ap is that you can point at
a resource and then say give me the link
that is named self right and depending
on what kind of format you actually got
from the server you have to look up the
link in a different way right so in this
case it's under scoldings dot name real
name and in the other format it would
have been like a completely different
mechanisms so there's support for that
as well but I mean bottom line here is
an able at health stuff through that
annotation or just go with boot and
leave it as is here right okay um half
an hour I guess we leave it as s is for
that so whenever you have a spring MVC
application you just want to add a few
links here and there go ahead and use
that just a tiny library there's a bit
bit more to it there's like entity
Ling's like just being able to what
we've done so far as we said okay please
point I create me a link to that kind of
controller and to that method of that
kind of controller but this in another
level of abstraction where you can just
go ahead and say oh please render me the
link for this order right and it will
automatically like find the right
controller that it needs to it needs to
use anyway we've done that alright so
the next step actually is um yeah of
course
before secure environment
what do you mean with secure environment
yeah that's so the question is okay how
does that work for for like secure
environments like okay if you have HTTPS
used so what we're basically doing for
the link creation is we we take the
current request and take the the server
part and everything like into the
application that's pretty much prefixed
and if you're so if your clients asking
for HTTPS something then you would also
get the links like rendered correctly
and it's basically like the
infrastructure the headers have to be
set up correctly so then then the the
prefix creation will will work as
expected yeah Oh for okay let's start
here what about case where EMS is a long
murder excuse me what and about the case
where you have necessarily river traffic
past the offload or is no longer HTTPS
but yeah so do you inspect specific kind
of headers is there a way to tell it
which header to look at well it's we use
the ex forward to host and I mean it's
that's actually that spring framework
internals so this we use the surveyed
you all right components builder that
inspects the headers that we know about
like the sort of defined headers they're
not like the ex forward host is not like
officially defined but but that that are
the ones that we look into like also I
think AWS sets sets a few special ones
that are looked at as well network I
think so I'm not into the deep details
of that kind of stuff before any stuff
was that the same question one more this
is all you about get requests
or told you what do you mean this what
is the so the game is a quintal as I
thought you was yeah look like tha I
usually don't send help buddies for a
post request because that doesn't make
no sense the good good good question
that's that's all in the reading side of
things good good question yeah one more
of your library know that the link
format is actually held and not
something else this is um know what I
what these dissin able hypermedia
support actually does is that it
registers a special HTTP message
converter which deep by default listens
to the request and I've seen if you've
seen that I'm setting an accept header
of application Jason and if you only
enable a single a single hypermedia
media type like hell and you return a
resource that thing from your controller
by the combination of that it will like
enable hell it will also enable hell if
you specifically ask for application
helpless Jason but if you explicitly ask
for application / collection clustration
and would like render collection rates
and if you would have enabled if you had
enabled that specific thing so it's the
combination of the accept header and the
type that you returned if you just
return a customer it doesn't do anything
because there are no links attached to
it right that's that's a very pretty
very purpose okay let me go ahead with
with the next stuff then so as you've
probably seen here you could now go
ahead and implement like all that boring
stuff like showing a collection resource
showing having exposing an item resource
so for every individual customer a
special resource and implementing gets
on it implementing post on it
implementing put on it and whatnot
and as I told you I'm involved with the
spring data stuff we have move us spring
data has used spring data already for
those of you who don't the core
abstraction of it is like a repository 8
interface kind of thing which by
definition in the domain driven design
book is the abstraction of a collection
of entities right so whenever you have a
customer repository it effectively
allows you to retrieve all customers
individual customers and then you can go
ahead and do like find one or find by
last name what have you and that
actually let us build an additional
spring data module on top of these
repositories that will export these
repositories as rest resources and
that's the next thing I'd like to show
you because with very little or a very
little amount of code you can actually
create like rest webservice out of the
box I mean a very limited one but let me
just show it to you so this example is
taken from there's a spring data
examples repository on the web at github
and this one is I found a CSV file from
all this using all these starbucks
locations in northern america with the
geolocation information in it i think
it's like 5 or 6 megabytes or something
actually I found it there's no way to
get from moscone to this place without
not passing a starbucks right is that
you you are used to that kind of stuff
but I mean there's hardly one or two in
every city in Germany anyway so what
this app does is uses a MongoDB because
I chose Mongo in this case because Mongo
has geospatial features so we haven't
have a store class here that's just
mapped using spring data it has a name
and it has an address and the address
actually consists of is like the actual
address data and a certain location
that's a spring data abstraction here
point and a geospatial index that's
nothing really important to understand
it basically says ok Mongo please go
ahead this is a Geo this is a geo thing
so if we want to later on ask before
give me all stores in the like in
surrounding in one mile from this
particular location this is the property
you have to look at so to the main
classes right that's that's one thing
and the other thing is that I just
declare an interface here and that's the
spring data part of the story so I say
this is a store repository it implements
some based interface that allows you to
page through the repository so
effectively say give me the first 20
give me the next 20 committee yet next
21 have you and what I also do is I
define a curry method on it saying find
by address location near which by
accident like that part here translates
to we start at the store store has an
address property and the address
property has a location property and
near is the key word on it so that we
the spring data project actually can
derive the appropriate mongo DB query
whatever that might look like right so
with just that method declaration you
can actually curry Mongo for stores
surrounding a given location that's the
location and that's the distance we
expect and we want to page through that
so that's why we pipe in a page bowl
here it's basically expressing like the
first page by page size of 20 and we get
back a page that has like the 20 stores
plus how many pages are there in total
how many stores are there in total yada
yada yada right so that's one thing and
what we do in the store app is we don't
do anything we say ok boot run this
thing and we enable component scanning
that's effectively it oh one missing
piece is a store initializer component
that is basically using the store
repository and some Mongo operations
abstractions to read the CSV file and
write these like I think it's 11 k
stores to the MongoDB to the MongoDB
running on my machine so I run this
thing
and then let's see what we get from
remember to domain classes and a single
repository interface did that work looks
like it okay let's see so we go to
localhost 8080 because we don't know
what to expect and we got a 200 oh
that's kind of neat so remember we knew
about Hell and if we know about how we
effectively discover two links here we
discover a storage link and we discover
a profile link i get into the i might
get into the profile thing later but we
could discuss that offline but the
interesting piece here is that we expose
you all right template that says okay
whenever you want to access doors you
can do so by expanding that you're right
template is anyone not know whether you
are a champ lit is ok it's basically
like a URI with placeholders with it's a
standardized it's an RC as well so
that's indicated by ok this templated
flag here and that effectively means you
can pipe in a page size or a sort to
that resource and that might customize
the output right so its advertising that
possibility to the client so we follow
that stores thing here we expand the
templates you not include anything and
then we have a same thing here and we
get actually quite a bit of stuff
returned so there's the self link ok
that's the very same resource there's a
next link remember we have this
pagination kind of stuff in there so by
default spring gate arrest restricts the
the amount of items returned to 20 and
this is not like loading all stores and
then just rendering 20 it's just like it
translate that restriction to the mongo
DB query to the jpa query whatever
persistence mechanism you use and you
get the first 20 we didn't find define
any sort sorting order so whatever that
first 20 might be but there's no need to
find out okay actually there's no need
no need even to find
what do I have to to configure on the
URI to get to the next page because we
have an x-linked and the client can
blindly follow that next link just using
that remove expand the template and
remember we're on a second page that of
course makes a pref link appear to be
able to get to the to the first page
here right so you can actually page
through that through that collection of
stores but we want to find out about
like we want to access our our query
right that thing that we put here and a
sprinter the rest goes ahead and expose
this these queries through a special
resource through the search resource go
to send and you see that here is this
fine by location a time by location link
or named by location and we have to pipe
in some some parameters into that here
all right so if we can if we just go
ahead and do pipe in nothing and we
should just get a no Jesus nope how do I
pipe in nothing this way you get it for
500 that's not a good year so we pipe
better piping something like a location
that's our new york office and like half
a mile we have Jesus we have 19
starbucks within half a mile around the
people it's New York City my Lincoln I
would have expected that but but you
could go ahead ah what shall we sort
after if we could go with and sort
equals what is it name descending and
that should list yeah the West 23rd is
the first that's listed second is union
square Jackson Square Greenidge a what
have you so you get a pretty pretty
complete like set of resources exposed
already and yeah that's that's that's
effectively spraynet arrest I already
did quite some customizations here so by
default the resource is just named after
the method name here but we could
customize that but that's like details
that you might want to look into if you
if you are try to try two weeks to
explore that net framework it's not
really nothing nothing more than these
like two classes and an interface and
right you could I can just imagine okay
fronted by an iOS application or
something that that actually are like
looks up the location and sends that
down there alright so by the way spring
the rest of course internally is using
spring haiti us to build up all these
kinds of things to build up the
resources it's heavily using the
metamodel stuff that we have in to bring
that arrest the api's so it's it works
with Mongo with neo with G neo4j with
jpa with gem fire with yeah pretty much
every spring data module that exposes a
repository API so the interesting aspect
to it is that if you write a client for
that kind of API you're not writing a
client for a spring it arrest
application you're effectively writing a
client that understands how that
understand to your right templates and
that understands the profile relation I
don't think we're going to be able to
get to the documentation aspect of of
rest web services but we feel free to
get in touch afterwards the profile
relation or this an RFC that effectively
says whenever you find a link called a
profile then the target of that link
contains documentation of whatever kind
for that very service and Alps is a
metadata format to describe hypermedia
state transitions so what's printed
arrest does it adds that profile
relation to your service or the Alps
resources describing the service and
points to them through the profile
relation so if you write a client that
just understands these four things it
will be able to work with any sprint
interests exported service ok oh
now the demo was supposed to show up but
we've been there we were too fast for
the slides I like that so the last thing
I probably how much time do we have like
50 minutes the last thing is like the
most sophisticated one that has a few
more hypermedia elements to it as any
one of you read the rest and practice
book no one highly recommended one guy
so the book is or one core element of
the book is a sample project called rest
box which is a simulation of like a
starbucks like coffee ordering process
that consists of an order and in payment
and how these how this how you could
implement that order process through
through hypermedia aspects right so just
getting that or assuming that all the
other stuff that we need on a server
side like representations being able to
add links is in place so we could
actually build that you can actually
build the the service and is in a
certain way so that the client only has
to know the route uri and effectively
discovers the entire the entire process
afterwards one question I off very often
get is like what does the client really
have to know it has to know about the
semantics of the orders right like what
what does orders mean what can I do to
it can I get it can I put it and that's
like that's a bit orthogonal to the
approach here in the first place because
the easiest way to define that is just
open up textmate or sublime and just
write some text and say okay whenever
you find an orders link you can issue a
post request to it with the following
format and you can issue a get request
and you will get the get back the
following right that's the Dead Sea like
most human way to do it and it's
perfectly fine but you could also go
ahead and like try to to come up with
more machine-readable format
but that side right so in the very end
you were going to go ahead and call the
client that understands these these link
relations and that understands what it
can do to the links these to the target
the resources that the links point to
actually so let's just quickly walk
through like the happy path of that
ordering process so we have a client
like maybe an iOS application and you
open up that app and it allows you to
like to place an order why does it allow
you that because at the very root of the
service it finds this orders link and
the referent or the documentation
actually said okay whenever you find
that orders link you can post a certain
like chunk of JSON to that or this link
and so the client goes ahead finds the
the target of the resource and posts the
adjacent to it right so you've selected
your drinks and whatnot and post that
thing so you send that to the server and
you get a response that looks something
like this you have like the the
information about the the order plus
quite a few links here in this example I
this is very close to the book so in the
book while the one of the order is in
the state to be in this in this payment
expected state you're still allowed to
cancel and to update the order so at
another other line items to it or like
even cancel it entirely but the happy
path here is you want to pay and the
client can actually display that that
checkout button because let me just go
step back because it actually finds that
payment button right the payment link
here so it wouldn't display the button
then if it didn't find the payment link
in the first place so it finds it and
then because the client developer has
actually read the documentation it knows
what to put to the to the resource that
is pointed to so we we create a payment
for that thing so we put to that
resource right there it is and as a as a
response we actually get like the credit
card information
and the amount that we paid actually and
again the the server sends sends back a
link that points us okay the self link
okay if you want to refer to the payment
later we find it here but by the way you
might want to look at the order what is
what is actually doing and this order
process like the payment is actually
triggering the preparation of the order
so that the client would now go ahead
and pull the order to to get to to find
out like if whether it's whether it was
done already or it it's it's still in
preparation and palling is of course
nothing that you would like blindly do
and like ponding get requests sick at
the server but you'd definitely like use
e tags on the server side and if not
match headers we will see that there's a
brief demo in the very end we will see
how that that's actually working in in
the demo here so we follow the orders
link back it looks something like this
see the the payment link is gone we
effectively tell the client okay right
now you can't actually do anything with
it with the order except like updating
it I like updating in terms of like
requesting the the current state of it
so we pull the order and like the server
of course like caches the state as long
as there's not no state change but at
some point in time when the order is
done so is prepared I can we the client
receives a new representation of the
order which includes a receipt link
which is an indicator of like the order
being being finished to prepare and we
can actually access the receipt like
once again find the link follow it and
issue a request to the to the link
target that's that's pretty much it and
the I just realized it when I put the
Rings I say ok there's payment expected
down there that shouldn't probably
should be it but don't tell anyone is
probably no one gonna notice but I mean
that's cloud computing right so the
advanced form of cloud computing anyway
so we conclude the order by issuing a
delete request this is very close to the
book so I really recommend that one and
the book has effectively has an
implementation based on jax-rs which
then in turn like reimplement Saul the
kind of like yeah resources and links
and all that kind of stuff that's in
spring hate us and I took the chance to
actually use the the entire technology
stack that we have around the spring
framework like spring boot and spring
framework and spring data and spring it
arrest to actually create a springy
fight version of that example which is
spring rest box it's what I just said
the very same sample implementation and
just I just jumped to the demo because
we're running short on time and I
definitely want to answer one or two
questions here the client I built is a
cool new feature new in spring 40 which
is pretty dated in terms of in the
spring world I mean is anyone of you try
using Java EE our post holes so it's
more than a year old at the net we
introduced that kind of there's an MVC
test framework I don't know if you've
seen that so I built test cases that
pretty much that have individual methods
for the individual steps that I just
showed you right so we could we access
the root resource we find the orders
link let's go with a new order here so
we create a new order we trigger the
payment we trigger the pole and we we
pull until the order has the receipt
link and then we take the receipt and
then we verify the order taken so each
of these steps here is just a bit of a
bit of code saying okay I need to find a
link then i read this order that JSON
file and then I this is pretty much the
server interaction so it's defining what
we want to do
right create a post request with the
content type of application Jason and
send that content but the interesting
part actually being that you can define
expectations so we define that there
should be a 201 created returned there
should be a location header present and
so on and so on so let's let me run this
real quick because now we have a minute
to run through the not a main type
execute as a test case that should be it
I hope the demo gods are with me that
look good so let it complete so that we
can see the that stuff ok so it's green
that's fine we can go nothing broken so
it basically it just does the very same
thing that we just did on the on the
slides and accesses the root resource it
finds it finds the link at four for the
it creates the order that's probably
something like that I should log out
here but it discovers the payment
resource it triggers the payment and
then the interesting thing probably is
ok how does it actually do the pulling
when it requests the order after the
payment has been triggered we get back a
200 with a certain etag and we don't
find a receipt blink in here that's why
we go ahead and then have to like to
second pauses in there but for the next
request we not do only like say get this
thing but we add an if non-match header
to the request saying dear server please
only sent me a representation if it's
different than that etag right that's
like a hash over the state of the
resource and while the orders is being
prepared there should be this is a
server-side logging thing here it's
starting to process the order it's
pretty much an asynchronous invocation
to sleep for five seconds so very close
to what the starbucks guys usually do
so it sends back at three or four which
means effectively like what is it what
is three or four it's no content or
content is 204 it's not modified that's
it right I always mix them up but it
says ok is still the same etech it's not
modified so we wait another two seconds
and then the server decides to wake up
and finish finish the preparation
effectively mark that thing is prepared
which means the next request is
returning a 200 with a different etag
and then goes on because it finds the
receive link and eventually concludes
that thing so there's a lot of
strategies that you probably like built
into a client like this like increasing
the time that you want to wait so that
you don't overload the server but it's
it's pretty effective so that you don't
have to ascend like Jason back and forth
alright that's it so all that stuff is
on github and I really encourage you to
check that out if you're into that stuff
maybe I just switch back to that
particular slide here the the only bits
and pieces that are we're required to
implement for me where this kind of
stuff here so all the payment thing like
triggering the or getting the receiving
the payment information and then
triggering an asynchronous event to
simulate the preparation that's all
manual implementation but all the orders
handling is there's not a bit of code
that I actually need I mean except the
orders class but that's all sprinted
arrest and spring data on top of it and
we have a bit of code that actually puts
our integrates between orders and
payments on the website here but that's
effectively it alright what I hope is
that you got at least a little bit of an
impression of okay there's a quite a
bunch of tools for you to get started on
that topic in the spring stack check
that sells free feel free to get in
touch or email Twitter what have you
armed and or I mean I'll be
until like Friday or something whenever
you see that weird guy with a red beard
that's me right okay thank you very much
and I'll enjoy the concert this evening</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>