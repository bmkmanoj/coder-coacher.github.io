<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Using Oracle Java Flight Recorder | Coder Coacher - Coaching Coders</title><meta content="Using Oracle Java Flight Recorder - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Using Oracle Java Flight Recorder</b></h2><h5 class="post__date">2015-06-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/azshjd5Vsv0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this session is going to be about how
you can use the Java flight recorder so
my name is Marcus hurt I am working with
the Java project Ruppert Oracle and with
Miss Michael Avraham o who is working
with the e/m the Enterprise Manager team
for middleware monitoring and
diagnostics and yeah let's get going and
let's have well we'd actually worked
yay okay so this is the agenda I'm gonna
do a quick overview of the flight
recorder so what is it why should you
care that kind of thing I'm going to
show you how you can create recordings
in various different ways
so there are plenty of of ways to
actually get to these recordings I will
be talking about how to analyze
recordings so basically what kind of
information can get and what are the
kind of you know the results you can get
from those recordings I'm if we have
time and we probably won't I will be
talking about how to analyze recording
how to do customizations recordings and
then we're going to talk about the
future since both Michael and I are from
Oracle we have this mandatory disclaimer
slide which basically says that anything
we say is a big fat light now anything
we say is bound to change can't change
by Oracle at any given time and
shouldn't be basing any purchasing
decisions on what we say here today so
if we make any forward-looking
statements you know we might change so
okay so flight recorder 101 it's a
high-performance event recorder built
into the JVM itself you can think of it
as a black box in an aircraft it records
what is going on and if you have a crash
or if something happens something bad
happens you can take a look at that
information and try to understand what
led up to the problem and you can do
this at any given time with the flight
recorder
it's as I said it's built into the Java
Runtime so there is a quite a few
advantages of to meet that like that and
I'll go into more detail later and it
produces binary recordings so the
recordings you can't just look at like a
log or something you need to have a
parser to parse the information and and
to be able to review the information the
binary recordings themselves consists of
chunks and the chunks every single chunk
is self contained and self describing so
everything you need to be able to
resolve the data such as constant pools
and and similar things isn't the chunk
itself and everything you need to be
able to understand it so the metadata
you used to parse the information and
explain the information it's also
available in every single chunk so you
don't need more than a chunk it's
self-contained you can just use that to
see the information which means that if
you were emitting a constant two years
ago doesn't matter
you just need the last chunk you don't
need to try to resolve that constant
like from two years ago which is a very
good property okay so some advantages
from using the flight recorder then you
get very detailed information is built
into the Java runtime so you get high
frequency information you get a lot of
detail the overhead is extremely low we
it's designed to be low I mean we take
if we have two different abilities to
put in this to the flight recorder and
one gets you know a hundred percent
accurate data always but it gives you a
95 percent overhead we're not going to
add that to the flight recorder it's not
gonna happen we need this to be able to
execute in an environment that gives you
less than a percent overhead so we are
trading and we're making sure that the
overhead is as is low mm-hmm because we
want to be able to keep it on always we
want people to be able to start a fight
recording have it on in your production
system and get
ability to be able to dump it at any
given time so it's by design we have
tooling for analyzing the recording
built into the Oracle JDK so Java
Mission Control is one tool that you can
use to to dump the flight recorder
control the flight recorder and analyze
the resulting recordings and then we
have some job API so that unfortunate
they are not supported yet that you can
use to put information into the flight
recorder from from from Java space it's
very useful but it's not supported we
are going to make it supported in the
future so there will be a supported API
for both controlling the flight recorder
for putting data into the flight
recorder so if you want to start looking
at you know how it's probably going to
look it's going to be very similar to
what we have today you can start to
start playing with those api's as a
matter of fact there are some other
teams that have already done that and
even built things that are you know in
production code so you have Java FX for
instance that integrates with the flight
recorders if you are running a Java FX
application do with flight recording you
can get at Joe ethics information web
project server does that isn't as well
ok so this all came from the integration
our convergence between Jay rocket and
hotspot
so once Oracle acquired hotspot it was
decided that we would converge the
best-of-breed features from both of the
JVM s and build a new JVM well pretty
much the same as the old one we have
some additional features so that's what
we have now we have it in hot spot since
JDK 7 you 40 and not earlier than that
actually the recording engine is in just
7 u 4 but it's not very usable because
we don't have the critical amount of
different event types to make it really
useful before before 70 or 40 then Java
mission control 5.4 was released with a
220 that is the the latest version of
Mission Control out there right now a
5.5 is going to be released with a 240
but most of the development effort is
actually spent on the next major version
of Mission Control and we will talk a
little bit about that later so there are
two different kinds of recordings you
can do with flight recorder you can do
continuous recordings and those have no
end time they keep running you need to
tell the recording engine when you want
the data you can tell it upfront you can
say that when you exit the JVM please
stop the recording or you can say things
like well I'm going to show you later
there are some command line options and
there is also there is also a command
line tool that you can use to dump the
recording but you must explicitly dump
it then we have time fixed recordings
and sometimes call those profiling
recordings those have a fixed time and
if you start them from within the
mixture control user interface they will
be downloaded once you're done and
opened up so that you can do your
analysis so I will when I say recording
I really mean one or two things during
this session one thing being the
configuration of event settings that
tells the recording engine what to
record so an actual on going recording
in your JVM process that's one thing I
will sometimes mean the actual artifact
that the physical binary chunk of data
that you got from the recording and you
will have to know from context and if
you don't know just raise a hand and say
hey I don't know which one you mean now
it might help to think of the server
side recordings the only going
recordings from which you can have many
as simply named collection of event type
settings that are active for a certain
period of time I don't think of them as
individual cassette tapes like in the
flight recorder because they aren't the
we for performance reasons we are
recording them to the same buffer even
if there are several ones and we use the
union of settings for any given time to
decide what you record
so I could probably put this in a better
way but if you have a continuous
recording running for a period of time
and you start the time fixed recording
which has more data in it for for
another period of time and then you get
back to just doing the continuous
recording if you dumped the first
recording it did but at the time that
overlaps like when you have two
recordings running for the time you
actually have two recordings running you
will get the events from both of the
event type settings so from both both of
the recording which means that if you do
a recording from your server you might
get more information that yeah then you
ask for if somebody else is in the
system and also recording stuff so you
will get at least what you asked for but
you may might get more so a quirk from
us choosing performance first but yeah
then there are different kinds of events
that can be recorded in 32 the flight
recorder we have instant events which
are just data points in time so
timestamp some data we have requestable
events which are periodically poled
events they call some callback to fetch
the data and the user can configure
health and that should be polled we also
have duration events those are probably
the most useful ones because you
typically want to time something you
typically want to know how much time
something took how long did it take for
me to do this service request how long
did it take me to do this io piece of
work how long did it take for me to do
whatever so the duration events are the
most usual ones they have a start/stop
time and some data associated with it
then we have timed events which are just
duration events but the user is allowed
to set a threshold so for some very
frequent events in the JVM we actually
have a threshold set by default in our
templates so if you do Java monitor
enter events for instance that can
happen a lot we we just catch the
outliers by default so I think the limit
is like 10 milliseconds or
two milliseconds so you can't take you
know take that down to zero if you want
to but it might hurt you
yeah we've definitely record a lot of
information you will get big files so
the inner workings of the flight
recording extremely low overhead yeah we
do that by doing a few different things
we record data that we already have I
mean it's an adaptive adaptively
optimizing your runtime it's caching
create collecting information from all
over the place to do different things
and we take that data and we try to
record it when it makes sense to do so
we also have a very high performance
recording engine so do things like use
invariant ESC to timestamp our events
not relying on system current time -
Millis - because that's expensive so
when we have timestamp for countries in
the CPUs we use them and a lot of other
nice things so events are typically
recorded thread locally you know once
we're done filling up one of these
thread local buffers we have the
circular arrangement of in memory
buffers if you have configured Mitch
control or flight recorder to do so we
will keep recording them over and over
again you know just keeping the last
couple of minutes of data that's
actually the way that WebLogic server
uses it so when wls needs to produce
what is called or WebLogic diagnostics
framework needs to produce a Diagnostics
image because something bad happened it
will dump you know the couple of last
couple of minutes of data and it won't
write this before that so testing is a
good thing
flight recorder is being tested by
running stress tests etc like like we do
for the rest of the JVM so that's part
of the normal testing of the Oracle JDK
so we punish the JVM hard to make sure
that it will will stay together when we
went when you need to in in production
there are third-party events from
WebLogic server and DMS Java effects you
can add your own and again
supported yet getting there okay thanks
so demo for creating recording select or
not demo yet actually talking about
creating recordings first so the most
important slide in this entire session
is this slide because it tells you what
you need to configure on your JVM to be
able to use the flight recorder so if
you don't remember anything I've said
remember those two flags in a 240 you
can forget about those two flags but for
now you need to remember those two flags
does enable the flight recorder then it
enables you to do flight recordings it
doesn't actually start the flight
recording you will need flags for doing
that as well if you want to do it just
from the command line but it sets
everything up that can be done
dynamically in a 240 so not yet and if
you want to do remote monitoring you
need to hook you know use the standard
komasan management flags to start up
with gimmicks agents etc creating
recordings using Mission Control is very
easy you just start the UI you find your
JVM that you want to do recording on and
you say hey I start a flight recording
double click on the fight recorder and
it's not gonna start a wizard and you
can configure it and you're good to go
it's very easy you think startup Flags
is very useful if you want to do
recording every single time you start
the JVM so or if you want to record the
startup behavior for instance you want a
recording from the very first second you
start then you can use this so in this
example I'm starting at one minute
recording 20 seconds after the JVM must
be started you can see the settings flag
there there are a few different named
profiles included with the JDK there is
a default one and the profile one if you
create your own templates from within
Mission Control you can export those and
put it in the Jerry Lib j4 folder and
you know any JVM or any mistral that
connects to running JVM
we'll be able to pick those up as well
within the template manager so can be
useful to know yeah and then there is a
bit of a thing that came with we have LJ
rocket flags that we are particularly
ashamed of this one being me just weird
and so if you want to use the ability to
dump the flight recorder on exit you
need to start up a very special
recording with ID zero for some unknown
reason that's strange
so you put default recording equals true
that gives you a running recording with
ID zero that can be matched to the dump
on exit flags so you know that will
hopefully change in a future version
then you can use J command which is a
command line tool to send commands
surrounding instances of the JVM and
there are a lot of different commands
you can do thread dumps you can do a lot
of different things but you can also
control the flight recorder so you can
start recordings you can dump them you
can check on the state status status of
flight recordings and how many Nick here
have used a command not that many so
I'll do a quick demo of J command as
well awesome so now we're here yay gonna
do a recording demo okay so here I am
running Mission Control inside of
Eclipse to start the recording maybe we
should start something to record this
use that okay
so we have a little thing running and I
am going to start a fight recording oh
pretty shit denied maybe I should have
ran these demos first okay the only safe
house
I've been exported oh darn it okay so
I'm gonna remove myself I probably don't
have write access on my temp folder for
this user so that's what I get for
running on a virtual machine running
Windows but anyways so I'm starting with
right recording against myself instead
okay here we go
so I'm gonna name my continuous
recording here continuous maybe let it
be a continuous recording as well I
continuous I'm using the continuous
template to do my recording and no I'm
not I'm fine with all this okay so now
can see that we have a continuous
recording running here you know this is
what it looks like if I would want to do
a time fixed recording on this it's fine
I can just profiling time fixed
recording for one-minute settings for
yeah profiling is fine I guess starting
it up and you see that you have depth
several different options you can set
here so if you want heap statistics or
class loading information you can just
select that and here we go I now have a
profile in recording running so I'm
gonna leave that in the background and I
show you how J command works okay so if
you just type J CMD you're gonna go get
a list of the actual running JVMs on the
system by PID so the ones with the same
affected user as yourself that's the one
running Jason Lee in this case we can
see that we have a bunch of them running
so let's just pick one maybe the one
with sixty one seventy six they seem de
we wanted either so help is going to
show you what different commands are
available in that particular JVM in this
case we can see that there is a bunch of
GFR related commands so in this case I'm
just going to do J for check and we see
that we have two running recordings we
have the continuous one that I started
in the profiling one and I can use
various different commands now to to
dump the information if I want to not
going to do that just gonna let it run
and here is the information that we get
okay so the perfect profiling recording
that I started just downloaded the
results down into the Java Mission
Control okay right so that's how you can
create your cording and I mentioned
start command line flags there if you go
to the command line parameter
documentation on the JDK you can find
the different parameters there as well
so Oracle I am yeah sure
what thank you
okay so the question was if you could do
a full heap dump without doing a GC well
that's basically what you do right I
mean you need to walk the entire heap to
get all the old object you need to
traverse the heap to get the heap dump
ah but why would you I mean the GC even
if it's a performance issue the heap is
a lot takes a lot longer than the GC to
dump a heap so why would you want to not
do the GC
I want to know why
okay so well okay we can talk afterwards
so there are heap analysis tools in
Mission Control that you can download
and do heap analysis like Jo flow and
other one other ones but Mission Control
flight recorder which this session is
about it's not really about heap dumps
so but we can talk about heat heap dumps
afterwards yeah okay so no Michael
introduced before but nonetheless so
anyway that applies manager why why
should you care so you've seen what
Marcus told you with the JFR recording
Mission Control in reality this is all
great and it works well really well
that's why we are really excited about
helping and making this more accessible
problem is that in production once you
actually you're because you're
successful the application is deployed
at bulk in production getting access to
host getting access to the JVM is not
something your admin will let you have
this is not gonna happen
they don't know they have to control
their environment they won't let you
touch it so you you're resorting to
either asking them to help you with
getting even more complicated for them
or other things it's kind of complicated
and then they have a lot of environments
they have test environment staging
environments all of those so so they
need to manage all of that in a in a big
way in many many many JVMs thousands
sometimes dozens of thousands of JVMs
and they all they care about is just
resuming resuming their serviceability
as soon as they can they don't I mean
they don't what they do generally
they'll bounce the JVM when something
happens something is slow if bouncing
makes it work then it's fine then go and
figure out where the data is and of
course we understand that really the
best thing is for developers to really
work in their own environment that's
what
productive if you give the developers
the data that they need and they can
carry over to there and our they have
the source code they have everything in
front of them they can actually
accomplish a lot and you really can't
count on on on always on reproducing
production issues in your environment
definitely not high scale production
issues yeah so so again so if we think
about what our production environment
requires they really want to control
what the users are doing in their system
they want to give the users just the
right amount of access to their JVM and
this is what
eeehm enables them to do is to figure
out to create user roles at the user
here is not an OS user the user in iam
is a user in DM if you use SSO to use
any other scheme of authentication
authorization PM accepts that allows you
to do all of that and then you can
figure out and in your rules what users
can do on what JVMs the fact that I am a
developer the develop application a
doesn't mean that I should ever access
to application B so that thing is
controlled here and that's why our e/m
admins are really excited about using
something like that because they know
they can actually do it in a safe way
and escape in DM we have environments
where we have million of targets many
thousands of je viens in those
environments many thousands of WebLogic
domains and standalone JVM JBoss any
other thing that you can think of I just
give you a screenshot here just get the
example of this and what I
go over is to show how we enable some of
this in the context of EMP we switch
myself it okay so that's uh essentially
that's a homepage of a JVM in Ian but
what you see here is there's a lot of
unattended stuff I mean you can't
monitor many many gems by looking at
charts and it's screens you have to have
something that will do the work for you
you have to have alerts on on thresholds
that you said what you see here on the
left on the left side here you have
alerts you do have historical data that
you store which is a lot more than the
you know the current what you have in
the buffer right now in in JFR you have
in here we show the life state of the
JVM and around here at the bottom we saw
what the threads are doing in terms of
workload that they're executing so you
can see on the left is the hierarchy the
association of the targets and and
things like that what you can see also
from here is you can go and you see it
is for the alerts that you see here all
these events that you see here like a
lock I don't know if you threw the ball
but threads in lock weight or exceeded
the threshold so you can see how these
metrics look like in our performance
summary before they clicked on the right
place yes
so so you see my note you see major GC
GC overhead so some of these things
obviously you see here matrix this is
not detailed in some areas you see a lot
of details some areas that the real
details are in jf r which is why we want
to you know what from the first place to
be integrating with jf r over speed we
had some demand from customers as well
but you can imagine a scenario where you
have a high GC pressure and what you
want to know at that point is who is
making these allocations and that is not
something you can do without uniform you
can catch the event which is the crush
that we're talking about so you have a
you have a black box you can catch the
fact that something happened and the
plane hit the water but now you really
need the black box to see what happened
and which is what what what we're doing
which here far so I'll show you where we
have jf r here so we have a place where
we see the j4 we have I mean these are
all J files that were dumped
automatically because of events that we
had in the system you see here that it
says that the local lurked snapshot
happened so these are the j4 files now
you can also create a jf are manually by
typing so it's not miniature this is
let's call it Java one and create a JFR
it's very very immediate there was a one
that I did before for tests but this is
the one that we just created
it's very very quick let me show you
also how to set the thresholds in here
so that you don't have to
so here
here's where we set the thresholds right
so you can see here the corrective
actions for each threshold we have
corrective actions you can select I
selected here to do JFR but you can
select heap dump or Oh trace of the
threads so you can do those from here as
well but let's go back to the dumb
snapshots just for a quick thing and
then we can download the one we just
created and again you see here the
credentials nobody knows the credentials
here I just see the user my admins set
me up with the credentials to get to the
hosts and bring the fine but I don't
know anything about it I just can
download it form the target from the JDM
that could be miles away or thousands
miles away and fortunately here okay oh
here it is
Superboy is supposed to kick in here
might already have it oh yeah me have it
open somewhere I don't see it oh I have
it open yeah yeah okay so he sees okay
there's a few that are open here you
probably will have to trust that this is
the one or I can close it and prove it
but you don't need to anyway
so I think for at this point probably
Marcus Smith can I kind of set more
light into what we can do with events
it's not just that we dump them it's
it's a lot of important nuggets in there
okay so we have a bunch of slides
between like his demo and my demo now
I've hidden them all so if you want to
look afterwards after this precipitation
and see what they say to see if I maybe
forgot to mention something you can do
that so just download the presentation
but I am going to just demo things
because I think that makes much more
sense so we are going to start analyzing
things so there are various things you
can look at with the flight recorder one
being the the method profiling
information so let's say that you have a
computational bound problem the CPU is
you know saturated do you want to know
how can I make my application go faster
which is a reasonable question and the
method profiling information from the PI
decoder is it's really good so we can go
to the code page here see that yeah
we're spending all the time in the
java.util package a linked list and if
we start looking it you know down the
hot path we can see that yeah somebody
seems to be using doing the linked list
contains calls a lot from this counts
intersection class and if we look at the
code we can see yeah we're doing a lot
of contains checks and we're doing them
on this linked list and we're trying to
count the intersection between two sets
really
so we have this we are putting unique
elements in both of these these lists
and doing a contains check on a linked
list is proportional to the number of
elements so order em if we just changed
this to be a hash set we're going to do
a constant time of average on average
and we're going to be much happier than
this kind of Rama much much faster so
method profiling one thing you can do in
production with Mission Control flight
recorder quite easily with a really low
overhead okay so let's look at another
kind of thing you can do so the flip
side of the coin is sort of looking at
latency so you have lots of thread
stalls you aren't saturating the CPU you
have massively parallel eyes to your
application your thought but you still
don't get the performance you're looking
for so we're not said leaving the CPU
here we think we should because we have
maximum maximally loaded the system
looking at the threads we can see that
they are blocking quite a lot which is
the salmon-colored things here
lots of blocking we can see in the code
here
sorry threads you can see that we have a
lot of contention and looking at the
actual log instances you can see that
there is one single monitor that
everybody is trying to to get so we can
see here that there are all these
threads you know waiting on the same
same one and we actually the same
instance so we can open that method see
that is this worker thread run that is
trying to call it to this and then we
get into this locker and now we need to
decide whether or not we will not log to
solve this problem or if we want to make
sure that we have a more parallelizable
logger
if one tab yes question
No
so I'm the question was where do I get
the source code from in this case I'm
running Mission Control inside of
Eclipse so I have access to the source
code I don't add it or anything like
that and I don't e compile it so if you
are running running it inside of eclipse
or outside of Eclipse is really not very
different if you are running it in
Eclipse you get the ability to jump to
source from any given stack frame and
from any different you know in a class
declaration or method so so that's
pretty much the only big advantage of
running it inside of Eclipse you get
everything else if you're on it in the
standalone tool so the reason I'm using
it here is that it's make makes it much
easier for me to launch example
recordings and jump to sourcing these
things okay so we let's say we solve
this problem let's say that we stopped
logging or we we gave a logger to each
and every thread or we didn't need to
synchronize here or something we are
going to get another recording that's
going to look quite different so let's
let's put them next to each other so
that we get to see them a little bit
clearer so in the one case we had the
CPU wasn't saturated after our fix it's
saturated looking at the different
events we can see that we now have
something that looks like this if we
graph them so not blocking anymore and
the weights that I'm using as a way of
sort of seeing the critical regions that
were executed in sequence here we can
now see that you know even those are
executing in parallel so you know it's
not not sequential anymore okay so
Layton sees another thing you can do
with the flight recorder is
to look at GCSE and allocation
information so allocation profiling we
have this very strange application which
causes a gazillion of garbage
collections they are garbage collection
all collecting all the time like nuts
and if we look at the the reason for the
garbage collections its allocation of
failure and if we look at the GC phases
none of them really stand out it's not
like we are having problems with
finalizes or weak references or anything
else taking a lot of time it's just that
we allocate lots and lots so why are we
allocating so much so we can see that
allocation taking place in thread local
area buffers are integers 100% of the
time and that constitutes quite a lot of
the memory pressure and outside the tea
labs actually introduced to which might
be weird but if you go to my blog I have
an explanation for that so let's see if
we can do something about this so have
this go method and if would have jumped
to the actual line we will see that it's
the contains key that is responsible so
this line is responsible for all the
integer allocations looking at this we
can see that we have that my a low class
that one has a primitive internet that
is being used as a key to look up stuff
well actually instances of my old class
so we will keep autoboxing this poor
primitive in since somebody decided that
is an excellent idea save like eight
bytes for this reason and you know we
will create objects all the time so one
thing we could do is to actually use an
integer object here instead and of
course here as well otherwise could lead
to a tool to water boxes every time yeah
so yeah
let's change that to integers well and
then we end up with something that looks
like this if we do a recording
here we go let's see memory tab so let's
give it some time garbage collections
here compare this to what we had before
which is this garbage collections all
the time garbage collections twice and
the only reason there are two garbage
collections here is that I was dumb
enough to enable a very expensive event
that is actually causing it you know
it's a heap inspection initiated GC
otherwise there would have been zero so
so that's one thing you can do and as I
mentioned you see the different phases
right so even if you have a final
isolated problem or weak references take
a lot a lot of time you'll see that you
can can look at the reference queues you
can look at a lot of other things as
well I'm not I don't have time
unfortunately to show anything oh so
Michael says I should stop demoing now
but I won't because I yeah so another
cool thing is that we have high-level
contextual information from the higher
levels of the stack so if you're running
WebLogic server you actually get some
some really neat information and there's
a plugin for Mission Control that allows
you to see things like database calls
you know what database calls are putting
in pressure on the system what service
services take take a long time executing
and the cool thing is you have you know
to only have this information right you
have everything else that is going on in
the JVM and the runtime itself so if you
do like this if you add related events
on Ystad for instance which is a context
ID that follow flows through the system
you will see things like the entire
let's just look at everything show only
what's in our property set you can see
the entire request and follow it through
so like you have sir
it's yeah bgp calls you have a lot of
things that Michael understand a lot
better than I do have been in here and
if you do like this so let's add
everything that is happening
concurrently that is in the same thread
during the same time you will see the
monitor weights popping out class loads
you know low-level stuff happening and
then we can go plot it all which is you
know there is a lot of stuff but in this
case we just wanted to see what was
happening in our little servlet
invocation here so we select that and
here we go this is how it looks like you
know plotted service requests being run
HP calls being called and some lower
level things that actually took longer
than our threshold popping out so so I
won't have time to download the java
ethics plugin but that's alright because
me and oleg over there has a
presentation on it we have a
presentation on Thursday about the
JavaFX integration with with with flight
recorder so I'm gonna stop talking and
demoing now yeah I think everybody does
oh you see the sector ASIS you see the
methods you see the classes you see
everything you can't just jump to the
line of code you need to open it up in
your whatever editor you're using Emacs
an older version
yeah so if you have the latest version
of the James II tool the one included in
a 220 for instance and you're running on
a seven-year 40 that is fine you can
hook it up the caveat of it's not
compatible with the G rocket right yeah
so you need to have j-rock admission
control potato rocket and Java Mission
Control four four four four four four a
hotspot actually let's wait with the
questions for just humor me
no no more no more demos I promise
promise so I'm on time for it well I
might item for man
no okay skipping cube for the few slides
skipping skipping skipping skipping
skipping skipping CP so if you want to
know the AP ice that you use to do this
yourself just look at the slides
afterwards I just want to quickly talk
about the future so these are things
that we have already checked in so I can
quite confidently say that this will be
in these releases even though you
shouldn't trust me etc etc etc and
anything might change at any given time
etcetera so this these are
forward-looking statements
JMC 5.5 is going to enable you to
dynamically enable the flight recorder
right so you don't need the flags
anymore you can actually enable the
flight recorder dynamically at any given
time that you want to from within
Mission Control we're using J commands
you can just so no longer will you be
there and oh if I only could
yeah you can't that's good we are also
hiding lambda for methods so if you're
running Nass Warren doing JavaScript or
whatever you won't have these like stack
traces step thousand anymore we will
filter out the lambda forms you will may
be able to make sense of the Secretary's
better you can see them if you want to
you just have to change the preference
setting in James e6 we're doing
automated analysis of flight recordings
so I had a slide on slide on some common
pitfalls that I didn't have time to talk
about so if you have automated analysis
of ride recordings it's going to guide
you to steer clear of those pitfalls
it is also going to show you directly
like
boolean things like you're using
deprecated flags if you upgrade the JVM
next time you try to start it it's not
going to start yeah things like that
also things like some complex
interdependencies between different
parts of the runtime and tell you what
you might want to do okay and the user
interface has been greatly revised so
we're probably going to get a lot of
flack for this because change shit
people don't like changes but maybe will
in this case I don't know it's going to
be more consistent and what we do
continually on this server side of you
know on the JVM side of things we keep
adding new events types so we're looking
forward to some improved i/o events
so disk i/o file i/o open file handles
things like that more GC events
especially for g1 so that we can do some
sophisticated analysis of what's going
on in g1 see what external libraries
have been loaded by the JVM etc so there
there is a lot of fun stuff happening
shameless plug and some resources for
for Mission Control so there's the home
page really easy to remember oracle comm
Mission Control I have a blog where I
blog about not only Mission Control
latest stuff but things entering the JDK
or the JVM so no might be interesting I
don't know
Twitter the official mission control
twitter handle is Java mission ctrl my
twitter handle is hurt and I wrote a
book together with a friend still kind
of useful if you're into adaptively
optimizing runtimes for e/m go too often
there is a lot of information there
okay so we're done we can do questions
so we have time for questions
yes
yeah
so the integration point here is three
okay so the question was you know these
JDBC events where do they come from
I guess and the answer is they come from
WebLogic Diagnostics framework so they
instrument these instrumentation points
dynamically but there will be um I don't
know if I can talk about this I will not
so nevermind yes
thanks Christian yeah eeehm yes it's but
yeah generally in production people that
have the Oracle make people that have
Oracle start database and stuff like
that they will have em generally yeah I
mean they pay for it they don't get it
for free but they generally would have
it because it's harder to I mean you
have to have something to manage the
ecosystem of table of applications and
stuff that you have you don't buy from
worker you buy for someone else the end
of the day you buy it
okay I'm not sure who was first but
we're gonna go there
so the question was if it's possible to
play back recordings well in the Mission
Control case it doesn't really make
sense I mean you can select the time
slice and you can move that time slice
forward and you can see the different
events that were happening and you will
see how this actress is change there is
no like play button that does that for
you but you can like move that time
slice forward if you want to and you
will see different aggregations of stack
traces yeah no no no we won't capture
variables for you yet it's not it's not
that the AVI there's no way to do what I
think what you're hoping to get without
impacting the JVM this is already so
basically you're talking about
everything that happened to the JVM yeah
so remember that we are targeting 0.5%
over if we run speck GPB with flight
recorder enabled we sometimes get better
performance by enabling flight recording
I mean it's like in the mountain of
errors and it's very weird but but we
are targeting really high performance
you shouldn't notice that flight
recorder is running it shouldn't impact
your performance and what you're asking
for will if especially if it's on the
critical path impact performance but if
say you had a dynamic instrumentation
engine that could dynamically instrument
flight recorder probes let's say you had
that wouldn't that be like wonderful
okay next
yes what so it depends we are actually
for a few different instrumentation
points or data points we are actually
doing bytecode instrumentation too but
most data points are captured with
without having to to dynamically
instrument anything which means of
course that we're going to be have to
deopt
currently optimized methods we won't
need to there's a lot of nice things we
don't need to do and there is also since
we sometimes can capture information
from the runtime itself that is already
been captured the cost is almost yeah as
I said we're trying to keep them cost
down so that you can use this in
production and we try to do very
comprehensive testing of this to make
sure that nothing bad can ever happen
from enabling this in production
well I'm gonna say you know you can't
notice the overhead do you notice your
overhead if you can't you know use it
with anything else no no no no no no
just no it's it's more than that I think
yeah let me answer this so the thing is
you will never get the same level of
detail if you think about I won't call
the competition you know for this
whatever you have in mind they would
give you maybe you know a few events
along the execution path of your let's
say if you have a WebLogic application
or any any web application you get a few
tears as it costs us tears you'll get
maybe that level of knowing timing
breakdown you'll never get the level of
details that you get here it's just not
there so when they say that they'll get
you below two percent of impact yes you
will know that it's you spend that much
time in JDBC and that much time a
network maybe and you'll know you know
how long the request took but you won't
know anything in between nothing no
looking nothing you won't know what the
block time is it's gonna be very very
missing you're talking about the level
of this is a completely different level
of detail and that's also the challenge
right so the visualization we have right
now is going to go like in your face
here you have the information it's like
wow lots and lots and lots and you need
to have a lot of knowledge to be able to
parse this information knowledge that
you shouldn't really need to know about
but you still need so that's the next
major version of Mission Control we're
trying to to make sure that we we do the
analysis the first stage of the analysis
at least and try to to to get you that
information so that gets a little bit
easier to consume all this information
but yeah level of detail low overhead
yes oh the licensing question right so
how is this licensed good question I'm a
techie but it's if you're in development
or if you're doing
if you're so development or evaluation
purposes it's free just use it if you
are in a production system with a bunch
of servers you should talk to Oracle
about getting a license
oh good question so the question was is
there a Java API to read these files the
answer is there are two just to make it
interesting so we have one which you can
think of like sort of a sax parser you
get each event you iterate through them
and and that one is included in the JDK
then Mission Control itself has a
slightly more advanced parser that you
can think of like more of a Dom parser
it reads everything into Java model that
you can play around with and in the next
major version you have even powerful
toolkits for doing aggregation and
whatever you would like to do and even
build your own rules if you want to in
Java and that one is included in in
Mission Control so I have blog entries
that show you how to do both so on my
blog you might need to search a bit
because it's probably a bit old one of
the older blogs if you want to move if
you want to start off by you know
creating flight recordings the
documentation in Mission Control is not
very good at this point
so you might want to search on my blog
for creating flight recordings then
you're gonna get to a blog but shows you
how to create them and you know how you
can configure it in various different
ways - to get to the recordings so so
that blog also has you know it's gonna
say like unsupported functionality in
big letters at the top of the blog but
yeah but please use it but please use it
no it's really fun and the lots people
do but again we are looking for feedback
on these api's as well because you know
at some point we will make them support
it and you know if you guys give us
feedback you will get to know API or set
of API is that more aligned with what
you want to do so please try them out
give us feedback
tell us how we can approve yeah
ever some performance problem comes
after the decision commands
yeah it's a reasonable thing yeah so
there is also the possibility but that
we don't want people to do right now to
use the jmx api's to control it but
please don't just mentioning the
possibility but among the unsupportive
things that the one new I want you to
not use but there is you know throwing
it out there it's a possibility
now not enable it but dynamically be
able to enable it so that's a difference
and the difference being that if you
want to be able to go back in time I
mean if you don't just want to do the
profiling case hey let's me profile for
a minute to see what we get if you
actually want to do diagnostics and be
able to go back in time you need to
start recording right so yeah
No so you don't even stop the recording
when you do that if you get the ability
to start recordings then you have other
command lines that you can use to
actually start a continuous recording
and have it running so for instance when
you're on Mission Control now we have a
recording running always I mean it
doesn't impact the performance why not
so when you in the JDK double click on
Mission Control Mission Control is gonna
have a continuous recording running so
if you want to know what Mission Control
is is slow sometimes just dump the
recording and see what's happening and
that's what we do so you know no reason
to not have it on doesn't cost anything
yeah so the question was is there cost
to periodically dump the fight recorder
and the answer is yes of course there is
you know to begin with that it depends
on how the volume of data that you chord
depends on what data you have enabled
and the thresholds you are using of
course but it's pretty much data because
it's very fine-grained information so if
you already have days of data that is a
lot that is a lot of data and you need
to consider the time it takes to write
that data and the time it takes to
actually sift through that a data if you
want to have it available through you
know if you're using for instance the
DMX interfaces to which you shouldn't by
the way again but if you need to stream
it over someplace yeah it's gonna be
Network I know you're gonna have these
large bay by trees that you're
transferring over over so it's gonna be
a OH
yeah you don't need that really because
you can configure the flight recorder to
do exactly what you want so you can
configure the flight recorder to emit
the buffers to disk and you can save for
you know how how far back in time you
want the flight recorder to keep the
data so you don't need to do that
manually you can just say to the flight
recorder using command line flags that
you know keep the last two days of data
around then you need to fetch it over
though you know when something happens
you need to stick the time slice and if
you select like two days of data in one
go from from for Mission Control
you know it's you're gonna have a lot of
data that you're transferring during
that time it's gonna be intense
so what did you have in mind you have
let's say a server in production or
something and you want to continue
monitoring like that
yeah well why six hours it could be a
whole weekend right so and then it's
more than one server also most of the
times we're gonna have more than one
service so you need to think about these
things and so I mean it depends on your
on your on the sides at the number of
events that you have it could be pretty
massive in terms of storage yeah and and
the way this is usually done is that you
have so for instance the way WebLogic
diagnostics framework does this they
never admit to disk
unless they have a reason to so they
have other low-cost signals that they
use to decide that something is is not
so good in the system and when they
capture diagnostic image they capture
what is in the in memory buffers and
they write it to disk so that they get
the last few minutes of data the way
they configure it but that's all they
need because they have detected the
signal saying that hey I need the last
few minutes of data just dump it to disk
and slurp it to you know the place where
you want to do that that's always also
in the example from en right I mean
where you have alerts and based on based
on thresholds you dump based on on on
detecting something wrong you dump jail
for so that's also an option but I guess
this yeah yeah
yeah and another cool thing with the
fight record is that even if you crash
the JVM we have tools to tilt from the
core dump get your flight recorder
information so it's really like it's
really the black box you know even if
the plane has gone like but it doesn't
recommend that you cross the G no please
don't
it's not you know it's not ethical to
keep crashing JVMs but should it happen
you can get the information okay cool</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>