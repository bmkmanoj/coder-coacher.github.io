<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Groovy DSLs: Beginner to Expert | Coder Coacher - Coaching Coders</title><meta content="Groovy DSLs: Beginner to Expert - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Groovy DSLs: Beginner to Expert</b></h2><h5 class="post__date">2015-06-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/rk9ZR2EkE3g" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so it's missing the first third of my
screen and won't let me predict it full
screen so if I'm popping up any windows
and you can't see it just remind me that
I've got to move them across to the
right hand side as we go along
okay I'm Paul King I'm going to talk a
little bit about using some of Groovy's
features for dsls in the previous talks
I've been doing most people are familiar
with groovy but not everyone so I'm just
going to a little tiny intro to groovy
and then dive into some of the DSL
matters in fact given the way this
resolution is I might even switch to a
slightly different talk I think so these
slides I often do this side talk with
Gilmer force the project leader of the
groovy project works for pivotal these
days both he and myself have had a lot
of experience with different customers
who are using groovy to write their
domain-specific languages so let's just
dive in and get started this is some
Java code for manipulating a list don't
really want to dive into the detail on
this code I should do a Java rate lambda
version to be a bit fairer on Java it
would shrink down to almost groovy size
these days not quite but groovy would
sort of say well if I want to I can just
rename that Java file to a doc groovy
file and I can just run it that's one
level I can just cut and paste the code
for most things not it not everything
but nearly everything alternatively
groovy would say well it's a little bit
of boilerplate in here so we can remove
some of the semicolons the list notation
your s types may or may not be required
depending on your particular
circumstances so we can get rid of some
of that and what we're left with can
still have a bit of boilerplate so we
might get rid of a bit more and that
will be the equivalent groovy code to
what we previously saw the Java rate
lambda code wouldn't be much worse than
this it'll certainly read a lot better
than what we've previously saw but what
we really want to do is actually take
this further and groovy and potentially
if I want to show this to a
system err in fact just so than this
which is looks like it's English text
that's actually groovy code I well by
the end of the talk you'll be able to
convert between the previous slide and
this slide there's in great very faint
code because I don't want to get
distracted whether from it is the the
code that would actually be the DSL
implementation if you like that lets you
run what you see up here and it
basically ends up running the code that
we saw in the previous slide so we want
to talk about the features of groovy and
the techniques and tricks in groovy that
you can use to get code that'll look
like this and it's not showing you the
slides of hidden most of the slides in
this presentation but because I'm not in
display mode and it won't let me go in
display mode it's showing up all my
hidden slides I have to probably switch
to a different form of this okay so this
is a two hundred deck set of slides and
you meant to see about sixty of them for
this talk so I turn on and off the bits
that are required and because I can't go
into display mode it's not going to let
me do it so it'll be annoying for you if
I continue I'll just do one or two
slides and then I'm going to swap to a
different thing just bear with me so
what is it domain-specific language it's
what we're trying to do is write
solutions for people but targeting very
specific domains and what we're trying
to do is actually have the have the code
okay I'm going to lose my speaker as
well as my video I'm going to lose my
audio so as well as we're targeting a
particular domain of people so we would
like the constructs the verbs and nouns
that are left in our code to coincide
with what a domain expert would use so
if I'm running a Gradle build file I
want to say yeah compile this bit of
groovy code up into this jar and
and run these particular tests and so on
and that's the kind of things that if
I'm asking a developer what they would
do I am going to compile the code run
the tests I want to package it into a
jar that's the the domain that they
would use so when we write a Gradle
build file that's if you like a
domain-specific language the domain
being a build domain so it's a technical
audience and the verbs and the nouns
should be the things that someone who's
used to compiling up code and putting in
a jar it should be that the verbs and
the nouns should be the things that they
would use to describe what they're doing
similarly if we're not in a technical
domain that I might have stockbrokers
who are trying to buy and sell shares so
that the nouns should be sell share buy
share at this price or when this
particular condition happens and that
should be all that's left so what I want
to do is not have a general-purpose
language with force
you know while loops and if-then-else
statements and so on but simplify it
down to just the constructs a domain
expert in that particular domain would
expect to see when they're discussing
their domain um it may not be textual
well it could be little codes it here's
some codes for solving a Rubik's Cube it
might be graphical in nature so dsls
don't need to be limited to just the
little textual examples that I'm going
to show you groovy is particularly
suited that doing those those kind of
examples you have probably seen examples
are similar to the ones that are in here
if you've used sequel sorry little bit
the font will be a little bit small for
you but if you've used sequel code the
verbs and the nouns are things you'd
expect when you're trying to pull
information or store information into a
relational database selects star from
table where a name like whatever so they
are the verbs and the nouns that you
expect to use this is domain-specific
language for talking to a relational
database if you've ever written a
regular expression it's got little
patterns in it this says yeah I want
certain characters to appear and then
some other characters repeating and this
optional character might appear and
maybe you know group captures some of
the
that as part of my reg X and so on so
someone who knows reg X wants to write a
matching algorithm that's very very
compact that lets them be able to do
very very neat sort of matching things
so these are all domain-specific
languages of sorts if you've used piping
on your Linux or UNIX command line in
your shell that that's a little mini
language of sorts where you're passing
things between different steps so so
some of these mini DSL languages might
look not far different from textual data
and there's a spectrum from that really
really simple form is a comma separated
a set of values a DSL maybe not but
something slightly more than that might
be all the way up to a spectrum from
there all the way up to a full-blown
language DSL is the bulk of what's in
the middle so probably not straight data
not full-blown programming language but
all the things in the middle and this
has always been the sort of Holy Grail
Ardun if you ever ever remember our Star
Trek 4 so he picks up his met his mouse
this computer you know whatever it was
that he wanted he started talking to and
he's wondering why it wasn't working it
was actually a original Mac there that
actually went on sale on eBay
the day before I gave the first version
of this talk but anyway that's another
story um ok so it's always been a holy
grail to speak in the domain that we
would use to talk about a language and
lots of languages have had this sort of
aspiration all the way from sand script
Sanskrit grammars from 300 BC they would
a domain-specific language for writing
stuff down so the idea has been around
for a long period of time if you ever go
and look back at the original work on
Lisp or small talk they always talk
about in Lisp starting off with very low
level functions and keep building
functions upon functions eventually the
function that I write should be
something close to what my domain
request is something very
level some of a small talk you build up
more objects and things over time until
eventually what you end up with is a
program that's using nouns and verbs
from your domain so the concepts aren't
really new and this is going to be
annoying skipping over all these okay so
um I'm going to you'll have to bear with
the slightly different syntax here but
this might this has got the material
that I'm intending to show to you in a
slightly different form but it's got the
wrong logos on it and if you have little
things but just hopefully you'll bear
with me and if I expand this too much
it's going to I'm going to lose a little
bit but we'll see see how we go so what
I want to dive into now I'm given me
having a lot of time today is we're
going to write a little DSL for
controlling a little Mars robot and I
went off to fries and board and we know
robot after the last two weeks ago when
I bought this so a future version this
talk might have a little real robot that
we can send groovy commands to and it'll
walk around the floor that haven't had
time yet to play and my ten-year-old son
and maybe my older son will probably
want to play with me so I didn't want to
do it or didn't want to solder all up
here okay so what I want to do is build
a little Mars robot and the first thing
we might want to do is start creating
domain objects so if we were going to do
this in Java or groovy would probably
create a robot class okay and then we
might create a move method okay all very
simple so at the moment there's nothing
des le in here what we're going to do is
start expanding this a little bit to
represent the things even when I'm using
a DSL I usually have real classes normal
classes underneath the covers that get
used so they'll and then I'll have a DSL
layer that ends up talking to my domain
objects
so it'll start off looking like not not
very des le perhaps and then we'll look
at ways to do when we start controlling
this robot how we can make it look a bit
more like a DSL so ok we might want to
move the robot in a particular direction
so north south east west forward
backward up up down whatever might be
possible with their robot so we could
just take a string but if probably good
Java or groovy style might be to use
like an enum so we don't accidentally
send a miss spelt string text up to the
robot and it veers off into a cliff
because we said left than the other left
and it just went so we might use an enum
we can still do that now so what what
this is showing is that even though
we're eventually going to get back to
something that might look like
lots of textual bits of stuff we can
still have you know the kind of things
that we'd think a good practice from a
software engineering point of view can
still be under the covers so we can
still have this backed by rigorous
things that are fully type checked and
we can go to whatever degree we want
with our type checking and the DSL will
end up being a thin layer that sits
above that and we which convert from our
English looking or it doesn't have to be
English it can be other languages into
our little domain object so here we're
going to use the enums what we want to
do now is have some code that might
control it so in groovy if we were in
Java would write a public static void
main method that's going to call our
domain object create a new robot and
call it with left make sense and some of
that's a little bit noisy so probably
the way you do that in groovy is
something like that so groovy will
automatically put the if you write a
script it'll automatically put the
public static void main around it and
it'll put any code that you're writing
use inside the main method basically
it's inside a run method but that's a
detail so we can just write it like this
that removes some of the noise okay now
here we didn't need to type the robot
doesn't if we're writing a DSL
it usually the the domain experts
typically aren't interested in things
that we might feel comfortable in using
putting putting all the type parameters
in in our little DSL as if they might
disappear so some of these can go the
other thing that is a little bit of a
flaw with this particular example as
I've left it is I've got a script here
and I'd need to recompile this up and
send a new version whereas really what I
want to do is just send just these two
lines here just that this the two lines
in a little textual file that'll go up
over to Mars and it'll just be the new
commands all that other guff around it
my domain classes and so on that they
would potentially be already predefined
and sitting on the rover itself okay
so and this will be a little bit
interesting as I try to flip between
stuff you can read off to the right and
stuff that's big enough to read but
we'll keep going so what I do is use
some of Groovy's integration features so
groovy comes with the groovy shell and
that'll let me if I go and put just to
come up the piece on the previous slide
this stuff into a thing called command
or groovy then I can write some sort of
main method that'll eventually grow into
our DSL integration layer and inside
command or groovy will just be the
things that the the domain expert would
do move left you know deploy inflate
tires whatever it's going to do lift off
um and we'll have an integration layer
that allows us to mix and match between
these two things that way whenever I'm
showing my domain experts my scripts
they don't need to see all the noise all
the special stuff that I'm doing for
them can be hidden away and I can go and
do my testing on it separately and keep
what they see is as nice and clean
okay so that might be in a file
integration doc groovy so and that might
be command up groovy okay now I use the
groovy shell that's a built-in
integration point in group that comes
with groovy there are other options
there is a built-in to Java is that a
technique for hooking into any scripting
language jsr two to three so it allows
you to do a subset of the tricks that
I'm going to show you so I'm going to
show you some tricks later on like
putting things inside a binding and so
forth
the jsr to d3 allows you to do some of
those things other things that I show
you this customizes and a bunch of other
things aren't possible but one of the
nice things about the the jsr
two-to-three if you want to go and
support multiple language is not just
grooving it would let you go and have
little snippets of code in in Python or
JavaScript or whatever else you might be
interested in using so there's times in
place for the ASR two to three there's
other times when we can because we're
doing integration Groovy's built-in
integration mechanisms are just straight
to groovy there's a whole range of
richer things that we can do so we'll
use that for today
okay so what's wrong with their DSL so
far it's if you should go back and look
at the original English looking one that
I've got and compare it to this one
there's still a lot of programmer type
noise in here so I want to try to start
removing some of this noise so I'd like
to hide these imports if I can
eventually get to that turns out all my
scripts are going to be about
controlling the robot so why not just
inject that robot in there from the
start and so I'll be able to control it
and maybe even have to hop I'll hide the
fact that I've got a robot object there
whenever I do a command it'll
automatically go on to the robot there's
some of the things we might want to do
we'll have a look at what we can do to
do that so what we're really trying to
do is eventually get it to this so I'd
like to just go move left and that's the
thing that we would go up by my
satellites over to the rover that would
be the instruction that the
any expert would be typing in and that
instruction would go and it would run
inside my integration framework so let's
see how close we can get to that okay so
whenever you're using a script in groovy
so all the most of the examples that
I've shown you are scripts so if I go
and define a class at the top like in
Java I've got a file called person Java
it'll have class person and I'll have
fields inside that that'll be a normal
class and if I do that in groovy it'll
be a normal class if I go and just put
lines of code that'll be a script and
the script automatically gets the
binding other classes don't get the
binding so this is binding is something
that'll automatically happen in any
script and that's a very common thing if
you go and look at it many scripting
languages they'll have this concept of a
binding and you can go install variables
inside the bindings like a hash map but
it's a special known one that's known to
every script and I can go and store
variables values inside that binding and
it's a typical integration mechanism
because often when you write a bit of
code you want to feed in parameters to
get things going you'll feed them into
the binding call your script and it'll
do things and you can change the
parameters in the binding to get
different results we're going to use the
binding to pass in the robot object so
we'll create a new binding so that's
that's just a built-in class there's a
jsr two to three one and there's a one
in our groovy as well we'll use the
groovy one well create a new binding and
we feed in a that Amar's robot with the
key called robot okay so what that'll do
is later on we could go to the binding
and pull out the robot right but in fact
if we just try to use any property in
the script anywhere and it's not known
it'll pull it it'll automatically use
one if it's in the binding so it'll
actually save us quite a bit of work
okay so now we'll we'll do the new
groovy shell like we did before but it's
overloaded with various different
constructors and one of the constructors
is binding we'll see a few more of the
constructors a little bit later on
and now I can evaluate my script command
groovy and it'll automatically have this
robot what that means is I don't need to
import Mars robot anymore and I don't
need to create the new robot it's
already there so as soon as I've got
robot dot anything
it says R it has there been a local
definition of robot no there's not
okay I'll pull it out at the bottom I'll
assume it's in the binding I'll pull it
out yes it there it is
it happens to be an object and I can
call its move method okay and we can
leave off the braces in in groovy if
it's not ambiguous so I can call robot
move left close it's not quite what we
wanted but we've removed some of the
noise so let's keep going okay so we're
going to use another little trick now
and there's a few different ways we
could do this what we're going to try to
do is get rid of this this next import
so we're importing our enum values so if
you remember Direction was left right
and so on
so we're statically importing all of
those so that I can just use left here
so this isn't just English word left or
something else it's it's actually the
one of the enum values okay and I've
made it lowercase in the num to make it
look like what the domain expert might
expect to see but I've got options there
as well so what I'm going to do now is
like use the same trick of injecting
into the binding that we used for the
robot but now put all the enum values
into the binding left right forward
backward and so on same integration
steps as before okay this is cool this
is all good it'll work for all the
examples that I'm going to show you it's
going to work but what if we came back
and wanted to make the robot move up and
down as well okay this will be fragile
I'll have to go back in my code in
various places and add the new
up-and-down things so what we can do is
do another little trick which is called
the spread map operator what the spread
map does is if I've got a map of stuff
it spreads it inside another map so
inside my binding map which is basically
between these square brackets I could
actually remove these square brackets
and Java and Groovy's name parameters
would kick into play here but
let's not get bogged down in details so
inside my map I'm going to have robot
and then this star says I'll go get all
the the entries out of this map and just
splat them in place into here so what
what values does is returns all the enum
values I'm going to collect them as
entries by turning the name of the enum
value into a string so it'll be the the
left in arm which will end up being here
will have the left string as its key and
we'll go and do love those later on if
we do up-and-down will automatically get
up and down in the binding the next time
we run this program okay so that's
another trick if it's not all that
important but it it takes us a bit
further now I want to now try to get rid
of a few more things oh this is actually
another another way I could get rid of
that static import I could just do ugly
things if I wanted to and import static
Mars dot direction I could just go and
have that as an embedded string and go
and take your command groovy I could
pull it out of a text file or whatever
here I've just shown it on the slide
just for ease of presentation well I
could be pulling this out of the text
file and just splat it together with a
string concatenation bit ugly this is if
you've heard of sequel injections to be
prone to script injection so it's a
whole lot of things here that might not
work as I'd like and there's other
problems with it as well in my original
file if I was trying to debug this my
original file on be line one would have
the move method when I've done this
concatenation stuff it would now become
line two so I'd get this if I just on a
debugger or get a error message it'll
have the wrong line numbers and it would
be quite difficult to do so let's not do
this string concatenation let's have a
look at another way that if I didn't
want to use the binding trick we could
also get those static imports in there
and groovy in fact is tailored for this
kind of customization at these various
integration points and it has what's
called customizes now these are ways to
or I go and compile something up I give
the compiler some special customization
values and it knows to do special tricks
as it's compiling my code up okay
there's an import customizer and ast1 a
secure one we'll come back and see it
and see some of those so how do we do
this we create a new configuration now
this is the thing that I'm going to have
to pass to the compiler and we do that
through the groovy shell here we'll come
back and see that in a minute we create
one of these import customizers and we
we can tell it multiple things that we
want to customize here we running it
until it one thing what we're going to
say is we want to add a static star
import of the direction enum right so
this will be this takes Mars Direction
was where I stored my enum class or the
the enum dot name just turns it into a
string because in fact add static star
actually expects a string so this is
just the name of the doc class you'd
think of doc get class don't get name in
groovy yet would be the same thing in in
Java so I'm just passing the string Mars
dot direction in to add static star this
import customized our now knows to
automatically go and put that static
star import at the front of any script
that it compiles okay we add that into
our configuration and we pass
configuration into groovy shell so we
pass in our binding we don't need all
the directions stuff anymore we pass in
this configuration we can now evaluate
robot move and left is going to come
it's going to be automatically
statically site import now we could we
could import other things we could do
non static imports non star imports
there's a range of different methods
there we could add in specific classes
so make sense yeah
here's one of the other customizes
you've probably if you've used any of
Groovy's advanced features you've
probably used some of the ast transforms
you might have had a compile-time
metaprogramming you might have heard it
called where you use the the normal
annotation syntax that you would have
been familiar with in java you can use
that in groovy what if you want to
automatically add some of those sorts of
annotations into your script because of
a domain expert not might not expect to
you know one of the annotations that you
can use is an out log which provides if
you've ever used log4j or you know one
of those logging facilities you go and
declare a new logger and whatever if you
just go out log on one of your classes
it'll automatically inject a log log
variable for you to declare all the
appropriate classes and fill everything
in for you um you might want that in
your scripts but a domain experts not
going to be they're not going to know
what log is and they're not going to
care it might be mainly for you for
debugging purposes going to see what the
robots doing as it's moving along so
again we could use horrible tricks like
string concatenation if we wanted and we
can string concatenate the appropriate
imports of logging staff and whatever we
don't really want to do that so we're
going to use this ast transformation
customizer and that'll add the ast
transform log on to any thing that gets
compiled in our case our script so again
we create a new group of shall we pass
in our binding in our configure now we
could do locked it info and again we
might even hide that away as well it's
for ease of displaying this talk we've
just done it in line there with
concatenation okay so just step we could
also do the secure ast customizer to
limit the kind of things that you might
want to do in your robot maybe you don't
want the domain expert to type system
dot exit zero and have that go up to
Mars and then all of a sudden it
disconnects it so you know the main
program that talks back to Earth is
being turned off so maybe that's not a
good thing you might want to turn those
sorts of things off this example is um
flipping
wanting to secure something but it's not
not actually the robot it's actually
secure securing an onboard directory
calculator so we want to do some math
calculations so what we're going to do
is use the import customizer we saw
before that'll do any statics star
import of java.lang math okay and then
we're also going to use this secure ast
customizer now it's a very fancy little
customizer that allows you to clamp down
on what things the user of that script
are allowed to use out of the groovy
language so don't give them the whole
language remember the dsls were meant to
be targeted so we're not we can say oh
you're not allowed to use while
statement you're not allowed to use
if-then-else it's a whole lot of things
that we can turn off so we can have a
whitelist of imports we can have
closures allowed or not allowed method
definitions allowed or not allowed
there's a range of boolean's that you
can turn on but then if you if you're
familiar with how groovy gets tokenized
there's a parser that takes all your
groovy code and converts into this
abstract syntax tree and a whole of
other stuff if you're familiar with
groovy it down at that nitty-gritty
level you can dive right down to that
level and turn on or off any of the
features in this language so you might
decide or will allow people to have used
divide and compare or not equal but not
allow them to use other other other rum
things so yeah we can decide what
classes they can and can't use and so on
and eventually they'd be able to type in
scripts like this cos PI divided by 3
cos is going to be statically imported
PI will be statically imported we let
them use the the divide so that will
pass but if they'd start doing other
things it's just going to fail it's
going to not know about any of those
things it's just totally locked out of
the grammar so you can really lock this
sort of thing down and that's a very
very powerful feature ok so we switch
back to our robot
we've got robot move left
we want to take this a little bit
further we want to get rid of the robot
dot because as it turns out nearly every
command that's going to be in my script
is going to be robot dot this robot dot
that it's just duplication noise that
the domain expert doesn't really care
about and we don't care about so we want
to get rid of that how might we do that
a couple of different ways well we we
could do some string concatenation stuff
let's let's not do that let's look at
two nice ways we can do it we can inject
a move closure into the binding okay and
we can define a base class so these
scripts are designed to or normally
extend a special script class in groovy
but you can replace that class if you
wish so let's look at the first of these
so this is using the binding trick again
we'll bind in our robot binding our
directions will bind in move and by
going robot ampersand move that takes
the move method on the robot and turns
in door closure and links that up with
the move key word so it allows me to
call the move method just by going move
and the arguments rather than robot move
and the arguments and it funnels it
through to the robot class for us make
sense yep okay the other alternative was
to create ourselves a base class so we
might create a robot base script class
and here we've got a method called move
we inside the method will pull the robot
out of the binding okay this refers to
script because we're extending the
normal groovy script it'll know about
bindings so we'll go and get the binding
pull out the robot call its move method
passing through the direction that we
got fed make sense yeah so that's all
good the base class is one of the
configuration options on the compiler
configuration class we saw earlier we
just tell it if the script base class is
ours and we feed that through and now we
just go move left that's all we need to
put into our DSL
yep okay we're all done now we want to
tell it the speed okay so we actually
want to extend our little script now
we've got the advanced Rover model that
lets us control the the speed and how
far it's moving and so on we want to
move left at three kilometers an hour so
in fact this is this is it going to
happily turn into well as it stands
there this is move with two parameters
left is one of the parameters and this
is named parameters in groovy kicking in
and it'll be the name parameter will is
basically going to get converted to a
map underneath the covers at will be the
key in the map and this other strange
beast over here will be the value we'll
explain what this value is as we go
along okay I'll have a look at how we
can do that okay so we want to support
this look at we're going to look at how
we support this speed bit first and then
we'll look at how we glue it all
together so again remember when we did
the robot the first thing we did was
created our domain objects the robot was
their domain object then we created the
direction an enum so we probably want to
have the same sort of domain objects for
our little DSL class here so we'll
create a distance unit that'll know
about it's just metric in this case
centimeters meters and kilometers and
will be a value an abbreviation little
constructor for it more than important
and then a distance will have an amount
in a unit okay so what we'll do is we'll
pick one of these we might pick meters
and we'll have an amount that might be
three and that'll be three meters yep
we'll do the same thing for time hours
minutes and seconds
okay have a duration class and speed
then will be a distance divided by a
duration so wit for speed we're just
going to store away the distance and
store away the duration and we've got a
two-string to print that out and
obviously when you want to go and
calculate the speed you'd go and divide
those values divide the amounts inside
the your domain classes yep
okay now when you see something like 2
dot kilometers in groovy that's an
object dot a proper property access so
that's the same as get kilometer okay
groovy well if you go and declare
properties in a groovy class you'll
automatically get the getters in the
setters but if you're not using that
facility you've created your classes in
in Java or something it applies the same
sort of beam like property access
mechanism and two dot kilometers will
get converted into this sort of notation
okay we can that as it turns out there's
several ways in which we could go and so
there if you go and look at the
java.lang integer you won't find any get
kilometer method on it okay
turns out we can add methods to integers
or any java class in your groovy class
it turns out there's a few different
techniques we could use we'll just have
a look at one of those and what we can
do is if if you create a get kilometer
method we will go and just create one of
our new domain objects so we'll create
the distance delegate will be the thing
that's in front so back here two would
be the delegate so what we're going to
do is create one of our distance domain
objects feeding two and then feed in
unit kilometer which was our enum rafita
let in and off we go we can now do
depending on we've added this two number
so we can actually even do floating
points and so on we can do forty
centimeters for kilometers three point
five meters and so on there are other
tricks we could do to even get rid of
the dot but we won't
that now we're going to this goes a
little bit further now we wanted to
actually say km/h so 2 km / H so this 2
km will be the to get km we just saw and
this is just the normal devop er ater
but we're going to do though is override
the dev operator for what's what does
this get converted to this whole to get
km expression a distance object in our
domain so we're going to do now is add a
div operator onto our distance object
that takes our time unit domain class
yep so add div on distance and what we
would do this this H we're actually
going to store our time units into the
binding the same trick that we use for
our direction left and right we're going
to put hours minutes and seconds into
the binding using that same trick yep so
here's we'll just do H for the purposes
of this slide which is one time unit of
an hour okay
feed that in same sort of trick we could
do minutes and seconds as well whatever
and how do we override the the div
method so groovy supports operator
overloading so it's not it doesn't do
arbitrary operator overloading but it's
got a list this is not quite the
complete list I don't think I think
there might be a couple more I'm not
sure and if I want to use the div
operator I just make a div method in my
class so you can use the div method
inside any of your classes if you've got
a customer class or a shopping cart
class and you go and add a power method
a div method or miners or plus left
shift you'll now be able to use the the
little operator symbols with your
classes so you can take a customer left
shift and put an order in what is
something if that's an appropriate thing
you do in your domain okay that's that's
really really powerful it gets used if
you want to processes you can have sort
of process workflow type notations you
can have things that might represent
bank accounts you can put dollars into
them and all sorts of things you could
make up a class your own class that
knows about different currencies and
allow yourself to add together different
currencies and so on there's a diff
methods not not very difficult we just
create a new speed and we pass through
the distance and the duration so the
duration comes from here and the
distance is ourself it'll it'll get fed
in as this okay so when we see 2 km/h it
actually goes to get km which returns a
distance div takes our distance takes
our hour converted into a speed so this
whole thing just gets into our speed
domain object okay and when we go move
left at 3 kilometers an hour this whole
expression is now just this instance of
our speed domain object okay now a
little bit of extra information these
are just parameters two parameters
separated by a comma underneath the
covers that's the same as turns out
anything that's a name parameter and
there might be multiple of those in any
position they we happen to put the name
parameters that towards the end we
didn't necessarily need to all of the
name parameters get collected together
into a map and turned into the first
argument now that's just a convention
that groovy users under the covers you
don't need to know about the convention
unless you wanted to do integration with
Java then it's neat to know what's
happening underneath the covers okay so
that's where all our named parameters go
and our anything that's not a name
parameter will be left in the order that
we call them and they will get fed into
there okay so I don't know why the
lights are going up and down but yeah
I think this consensus that somewhere
there or thereabouts would be good yep
okay so we might want to get week we can
go and get rid of all this notation it's
obviously hooked into my video obviously
the lights so we can drop those using
our command chains okay so move left at
three kilometers an hour actually gets
converted into that in groovy so move
taking the parameter left dot so it's
method call calling the method at with
this parameter okay so this is an
alternative way to write our expressions
if we don't like the the colon and the
comma that was in the previous version
so what we need to do now is change our
little DSL integration layer to support
command change instead of supporting the
previous style okay and that's very
simple to do we just create a move
method the return this is what's called
a fluent API style we're quite a move
method that takes our direction and
it'll set the direction that we need to
remember that for later and it returns
this which is our self as our fluent API
object so we're returning the robot
which has an app method so we can then
call the second thing in the chain okay
passing in the speed okay
there's other ways in which we could we
could use little maps of closures in
order to create that if we didn't want
to go and use the fluent API approach
there's other approaches we could use if
we want it to okay now with all that we
either those two approaches in place you
can now write this expression okay
there's just a few more examples of what
it gets converted into you can still use
the name parameters with the colons even
when you're using command chains so if I
want to check the vodka tastes good or
whatever I can still use multiple
arguments to things by putting the
commas in if I want to and so on and so
forth
I don't need to have arguments if I
don't want if I don't have arguments or
will be required to put the bracket in
okay except for the case of a property
access if that's the last term and that
lets me have sort of odd numbers of
terms make sense okay so that's our
final result and we could go and get rid
of the dot too if we wanted to by
applying more and more of these
techniques okay so that's pretty much
the the guts of what I wanted to show
you there's more stuff in here about how
we could lock more stuff down right if
you've ever done multi-threaded code you
can you can you might get a thread
interrupt exception and so on so there's
a whole lot of extra layers of extra
security that groovy allows you to put
in to capture those sorts of things as
well stop your script having a infinite
loop you might purposely interrupt it to
stop your script being interrupted and
doing things you might capture these
sorts of interrupts so like we saw the
the secure customizer did a lot of
things we can we can keep adding to that
and doing strong things we can do these
timed interrupts to get lock down some
of the other weird behavior you might
get in the multi through
an environment yep
so you might have an infinite loop here
but you can abort out of the loop pins
in abnormal circumstances and so on
okay there's timed loops so you might
after ten you might be moving left but
after ten seconds you want to stop or
whatever so there's a bunch of different
things we can do okay so let's skip over
some of that okay um
two things that left for me to talk
about and we can probably talk about
them without this but I'll leave it
there tooling it's great having this
textual form for my text but if I lost
all my tools support have I gone back to
using text text after use notepad to
cradle in scripts now the exempt those
things that I showed you are groovy
programs you can run them in your
debugger step through them line by line
you can hover over things and find out
the types of things and you can make
your DSL implementation as complex or as
simple as you like so you can make the
stuff that's there fully statically
typed okay and if you put the wrong
types in in any spot the compiler won't
compile it or you can make it as
flexible and malleable as you like you
could allow when people are typing in
the direction left right they could put
uppercase left lowercase left a mixed
case left and at the different layers
underneath the integration points that
we've done we could get convert to
lowercase or whatever was appropriate so
there's Bo we can push things up or down
those layers and give ourselves either
lots of strictness or lots of
flexibility depending on the
circumstances that we have now that
brings me I'll talk more about the
tooling in a minute if you want to go to
the full the stronger side of these
things but let's come back and just
recap on building DSL some things that
you'll want to remember remember the
original robot that we had and it had a
few imports in it and a little bit of
noise and then we got rid of a bed and
it got a bit nicer and we
kept going and going and going and
pushing it to the enth degree when
you're doing dsl solutions for your
customers going be aware of you know
what's going to be best bang for buck
for your customer maybe they don't care
if there's a couple of inputs at the top
because I never they're going to look at
those first two or three lines they're
just going to look at the stuff down the
bottom so maybe it's not worth doing the
extra steps of removing those steps you
know so if you're solving a real
customers problems you know you've got
to know when to stop because you can
just keep pushing this and pushing this
when I talked about the tool and you can
make go and make IntelliJ and Eclipse be
fully aware of every single thing inside
your script really strongly typed and
everything giving you full help
completion at every single point along
the way depending on the domain objects
that you use if you've used lots of
static typing in your domain objects
they might get a lot of that right
automatically but if I haven't used a
strong domain model or in certain cases
the ID might not know what to do you can
actually feed instructions to it you can
feed eclipse or IntelliJ a little DSL
describing your types that tell it how
to autocomplete all of the words that we
saw what the help text is for each of
the words so when you hover over move
it'll come and tell you that you have to
have a direction and it can only be left
right up down or forward backward
whatever when you hover over the app so
something per hour it'll tell you or you
can have an hour or a minute or a second
here and nothing else and it'll tell you
there's an integer that has to be at the
certain spot so and you can sting will
step through all of those all of those
require putting in lots more work
depending on the circumstance and yeah
just bear that in mind when you're
solving custom problems you've got to
know when to stop okay I might um call
that quits there just just I'll just
reinforce their thing about dsls
every DSL that you define and create is
a new language right now someone who's
heavily involved in the groovy language
I know without the effort is in
designing a language maintaining it over
time
maintaining backwards-compatibility for
previous versions there's a lot of work
now for a little DSL it's not anywhere
near as much as a full language but
there is still work so you've got to
design your little deer so we were
designing on the fly and iterative
pattern getting a more complex DSL
there's a design process that that was
going on there we had to pick between Oh
am I going to use the customizer or the
binding for this am I going to use lots
of intellectual energy that needs to get
put into that when you give your
customers a version of this in the
future they might want extra things in
there so you've got to go and redesign
your DSL to support new things now are
your customers going to come and say oh
but we still want all our existing
business rules to run as is you know so
if they do you've got to think about
backwards compatibility and how can I
evolve my DSL for that backwards
compatibility oh all this tools support
that I've gone and created a DSL to tell
Eclipse how to understand my thing
you've got to go and rework that and all
of that gets brought into the
maintenance of of your DSL and if yes
you might be the guru who comes in and
delivers the DSL solution to your
customer but are they gonna have someone
on board who's going to maintain this
over time who knows all of the tricks
that you've used knows about how to tell
Eclipse and IntelliJ about these things
they might not so you might need to give
your customers a slightly dumbed down
DSL for their future benefit in case
you're not around sure you can you can
hopefully get some future consulting
work but but you may not always get that
and you don't want to leave them with
something that they're going to throw
away because they just can't understand
all the tricks that you've used so just
bear that in mind okay that's that's my
talk I'll be around for the rest of the
conference so if got any more questions
come and ask and we'll probably just
take just a couple of questions they
were on the other one oh they're not
there okay you'll already find it there
it might be under the recent year so I
mean it'll be at the same github site to
Paul Paul K underscore assert on
SlideShare and por que - assert because
github doesn't it you'd have underscores
on github and you'll find two or three
different groovy DSL ones the ones from
today will appear probably I'll finish
those when I'm on my plane trip back to
Australia and there'll be a new version
up there but you can go and look at the
previous version of this talk
in the meantime yes yes yep
so in inside eclipse when I've got move
robot at three kilometers an hour I can
hover over any bits there and it'll tell
me what can complete at any spot and
give me full help texts hmm if I don't
do tooling it'll depend on which tricks
are used when I was building my little
DSL layer if I use the maps with
closures I probably won't get much
completion if I use the domain objects
so that you know how we built the
distance unit and all of those you'll
get a fair bit of that but maybe not the
whole lot yes I question up here
yes oh that's a very good question so
the question was when so we were I focus
I did have some intro slides that
distinguish between internal and
external but with the hiccups we had
sort of brushed over a lot of those
details um there's a concept of internal
dsl x' which i was illustrating and so
here our internal DSL is i'm using
groovy as my land of language to build
my dsl alternatively I could build my
own parser no typically be called an
external DSL and there's parts of
combinatorial AV yet again that you can
do in groovy as well slightly different
beasts I guess I normally default and
maybe it's because I'm just been doing
just too much groovy I just default to
doing everything internal and when I run
into things that aren't easily satisfied
and groovy then I'll dive off to anther
and do my own grammar or whatever
doesn't happen very often
yeah no other questions well I'll let
everyone get to lunch thanks very much
thank you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>