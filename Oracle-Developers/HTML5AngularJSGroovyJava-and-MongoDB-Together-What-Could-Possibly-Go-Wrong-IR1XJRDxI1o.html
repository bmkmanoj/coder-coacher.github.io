<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>HTML5/AngularJS/Groovy/Java and MongoDB Together: What Could Possibly Go Wrong? | Coder Coacher - Coaching Coders</title><meta content="HTML5/AngularJS/Groovy/Java and MongoDB Together: What Could Possibly Go Wrong? - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>HTML5/AngularJS/Groovy/Java and MongoDB Together: What Could Possibly Go Wrong?</b></h2><h5 class="post__date">2015-06-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/IR1XJRDxI1o" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">and I'm Tricia gee I'm a Java engineer
for mongodb and and what I really wanted
to show here is a real life working
application with real code in real time
more or less in less than an hour which
one I thought about the idea of this
presentation seems like a really
exciting thing to do and it was going to
be technical and you're all developers
and you want to see code you don't want
to see slides and it seemed like a
fantastic idea and but with more thought
I realized it's terrifying and
definitely going to go wrong at some
point in time so firstly I actually
started up with a go away I started with
a doodle poll to find out what people
thought were going to go wrong in this
session and only five you answered it so
that was great thanks for that I'm
actually going to I'm going to cast my
vote here this is the last one and using
html5 angularjs MongoDB geolocation and
Java and write the very end that bit
always goes wrong so I'm going to vote
for that bit I need to put my name in
that would be great I can't even talk my
name this is not a good start and i have
not had enough coffee today despite what
it might seem so you can carry on and
you can carry on voting on this poll if
you want i put it on twitter somewhere
but let's get started what we're going
to do is we are going to build up a
real-time application like i said which
is going to let you the user order
coffee on your mobile phone so you can
imagine maybe you're walking down the
street you're going to meet a friend
you're going to work and you get that
desperate desire to have your a jolt of
caffeine and you don't want to waste
time cueing or figuring out where the
nearest coffee shop is so you open up
the application on your phone you and
you select the order of your preferred
type of coffee and it will send it
automatically to your nearest coffee
shop whatever that is and then you just
walk in and pick up your coffee from
that coffee shop if anyone really wants
to build this application I want fifty
percent of your royalties or more I'm
not sure so this is a fully buzzword
compliant application on the front end
we're going to be using angular
html5 obviously angularjs is a
JavaScript framework and so this is what
all the hip kids apparently are using so
I thought I better learn that for this
for this application and we're going to
be using bootstrap to make the UI look
pretty and to make it usable on mobile
phones we're using UI bootstrap to
provide some common widgets so that you
don't have to code the whole UI from
scratch yourself on the back end and the
Java side we use in drop wizard which is
this lightweight framework for getting
up and running it supports a lot of
standards including you know Jackson
Jersey jetty and other libraries
beginning with Jay and because i work
for mongodb obviously we're going to
have MongoDB on the back end we're going
to talk to MongoDB via two mechanisms
one is a library called mafia which is
an odm it's a bit like a no RM but with
documents and then underlying mafia is
the Java driver which is the bit that I
work on and we're going to be using some
of the underlying Java driver as well
making special guest appearances in the
form of grade and some groovy stuff
groovy language not just groovy in the
form of Gradle Spock and some groovy
scripting and these are just tools that
I actually use day to day that I find
that really enhance my productivity so
I'm going to use in those throughout the
course of this application and Eileen
very heavily on IntelliJ IDEA partly for
its normal and I mean it's extremely
helpful for auto complete and things
like that but I'm also using some live
templates so that you don't have to sit
there and watch me typing absolutely
everything it's not cheating it's
efficient so hopefully you will learn
hopefully was my favorite word
throughout this presentation there's a
lots of hopeful ease and theoretically
and maybe hopefully you will learn if
your job a person you're going to see
some modern UI stuff like angularjs for
example and the fact that modern web web
you eyes are a bit different to work
with than there were a few years ago I
mean I don't know about you guys who's
using angular or javascript stuff at the
moment all right well you lot will know
this so just ignore this stuff but for
me I hadn't done any web development
stuff probably four or five years
I've been using GWT in a bit of other
bits and pieces so the modern web
development stuff was quite a pleasant
surprise for me so I kind of want to
showcase some of that stuff and there
are probably hopefully aren't that many
non Java people in the room but what am
I really want to showcase here is how
simple it is to get up and running with
a prototype with a small real life not
toy application in Java because one of
the objections were here is that Java is
heavy and boilerplate and difficult and
you have to have like a j2ee back-end
thing and that's just really not true
these days so I want to show and
basically I work with a lot of people
from other languages like Ruby and so
forth and I kind of wanted to show those
guys that we don't have to do everything
in Ruby to get up and running quick we
can use Java obviously there's going to
be some MongoDB in here and but also I
really hope the takeaway point is that
if you know your tools if you know the
library is if you know how to work with
them and where their sweet spot is it
will make you a more productive
developer right so let's just get
straight on I'm going to do this in the
form of user stories so I've broken down
the functionality into seven different
user stories we're going to do this
iteratively because they're all that gel
these days right or a large l know
people are like what's a joe though so
we're going to do user stories and we're
going to help to use this to drive the
functionality of the of the application
we have 55 minutes so we've got good
chance of actually getting this complete
end-to-end I gave this talk at oscon and
basically I spoke so fast and typed so
fast that the end of it the whole
audience is like whoa so but you guys
have got a bit more time to to kind of
hopefully absorb what's going on see
hopefully my favorite word and there
should be time for questions at the end
but I don't want to take questions in
the middle because we'll never get to
the end if we take questions in the
middle right so let's get on a story 0
as a user of this amazing application I
need to be able to see it now this is
not code for create the whole
application story 0 right the
application no no what I meant was and
this as a developer what I want is a
framework and architecture to work
within so the idea behind this
is setting up drop Wizards so that we
have a web server and we have the kind
of architecture of the Java backhand and
the HTML front end without any real
working functionality just as of
skeleton and architecture so let's get
going firstly so this is this is pretty
much all i'm going to show you of Gradle
but i'm using Gradle as my build tool
they've been quite a few talks about
Gradle throughout this conference there
was some really good introductory talks
and Gradle has a similar life cycle to
maven but a lot less angle brackets and
your build file is written in a
scripting language which makes it a lot
easier for you to you know script your
build it's quite good I'm using a lot of
the defaults with that come with a Java
plug-in so I don't have to do much other
than set up my dependencies as i
mentioned i'm using drop wizard as the
sort of back-end main backhand
dependency i'm using more fear to talk
to MongoDB and there are s to just test
dependencies for writing tests because
they all we all right automated tests
right I got some nods that's good that's
good okay so that's all we're going to
say about Gradle but the point is you
have this tiny little file and your
Gradle build file just worked and it
pulls in IntelliJ plays really nicely
with Gradle so it just pulls in all mine
dependencies for me and I don't have to
worry about that anymore so firstly
let's create our back-end service
everyone can see most of the code at the
back right I know this bit on the left
is a bit small but this bit is readable
great ok so we're going to create a new
class we're going to call it coffee shop
service I type coffee a lot throughout
this and I miss Stella every single time
so yes of course we'll add it to get
we're not going to do that yet so we're
going to extend a service class this
comes with drop wizard so this is our
drop wizard service this needs to take a
configuration which allows us to
configure our application we're not
going to do much with this at the moment
but we need to have it there i'm going
to use IntelliJ to basically do all my
typing for me because that's the sort of
person I am let's make that full screen
will come to this method in a minute
we'll come to this method in a minute
this is our main service class so this
thing needs a public static void main
method and that's a default thing that
comes with IntelliJ to do on my typing
for me
new coffee shop service run with the
arguments that come on a command line
get IntelliJ to just deal with
exceptions in a really graceful way by
throwing them again and then in the run
method what we need is we need a
resource let's try and put that there so
we can see everything so environment add
resource this is going to be a new
coffee shop resource will get will
create this class I've got a quick
shortcut not a cheat to add all the the
annotations I need for web resource I
want to put this a URL of coffee shop
I'm not going to do much with this for
the time being we we need this to get
dropped wizard up and running but we're
not going to provide any services at the
back end just yet so we will come back
to this class then when we go back to
our service if i run this it should fail
for the correct reason I'm all about
correct failures okay so drop was it
tells me what it's expecting I'm
expecting this to be a server so I need
you to give me server arguments so what
we'll do is we'll edit our configuration
will put our server argument on there
I'm also going to give it a
configuration file which is surprisingly
called coffee dot yeah mon let's create
this file
and I've got a shortcut to configure
this what I want from this particular
piece of configuration is you can see
I've got java stuff here this is kind of
my java back end it's going to deal with
all my restful stuff and i also have a
SATA HTML file and that's going to have
you know my angular and client-side type
stuff on there what i want to do is I
want to tell drop wizard where to serve
the static content from and where to
serve the the java stuff from so my java
is going to be under / service and my
static star my java stuff is going to be
from yeah my static HTML is going to be
from here / HTML ok and I'm going to
serve that at / so now when I run this
server it starts up a jetty web server
which is nice and lightweight and
doesn't take too long to start let's
have a quick look at this coffee HTML
file and give it a title Tricia's
awesome coffee yeah if I tell you it's
awesome you have to believe me it's
awesome right if I reload this now I
actually I'm serving the HTML I've got
the backend server running let me show
you that so I've got the server running
so I have the architecture in place to
start writing some java backend staff
and some angular front end stuff so
that's kind of story 0 get the
architecture in place not terribly
exciting but in the in my previous
attempts at trying to get some java
projects up and running once you know
you're installing tomcat and you create
this you can figure that and it takes a
little while we're with drop wizard it's
sort of fairly straightforward and
that's all you need to get running story
one as a coffee drinker I would like to
be able to select the coffee I want to
order and its size this is kind of the
important bit right this is what I want
to do I want to order coffee so let's go
back to our HTML and start building up
our our application so like I said we're
using angular so we'll put our magic
incantation to
get it to use angular I need to include
the angular JavaScript that's a shortcut
that comes with IntelliJ as well I don't
work for IntelliJ but it is amazing what
was ur doing angular so I need to
include my angular one of the things I
thought was really nice about this is
that ideas have come a long ways since I
was last doing HTML stuff and you get
auto complete the same way you'd expect
to you from Java and it just makes life
a lot easier you get a lot a lot fewer
typing errors so let's include angular
let's create our own cut our own
javascript file we're going to call this
you'll be really shocked coffee is and
get angular get IntelliJ to create that
for us and and GM and so IntelliJ has
plugins that supports angular as well
i'm not sure if they're parts the free
version of IntelliJ or the paid one but
it they're kind of built in its cool
coffee sorry the paid one okay fair
enough i have paid one
because because again and at our Java
user group actually we give out a paid
license paid license for IntelliJ every
month and and that's quite popular it
bribes people to come along to our use
group what was it doing right I don't
have any more just right now I'm going
to create coffee up i'm going to create
controller and by the way one of the
caveats is although i'm using angular
and I'm trying to do this like nicely
and neatly I'm not an angular expert so
if you want to learn loads more about
angular find someone who really knows
his stuff but what I found nice about it
is it didn't take very long to get up
and running with it fairly quickly and
to become proficient with it very
quickly this is going to be an order
controller spelt correctly trololo have
you ever tried does any one pair program
no 11 and a half people that's not a
pair I him have you ever tried coding
with someone looking over your shoulder
yet try doing with 300 people if I do
something really stupid and wrong I'm
expecting my pair which is you lot to
tell me what's stupid and wrong and I'm
okay with that that's fine what was I
doing drink types I want to be able to
select from a drop-down the sort of
drink that I want to order so I here's
one I prepared earlier this is a
JavaScript array of JavaScript objects
and so there's a fairly simple object
has just got a name and it has a family
type if you like and we want to display
this in a drop down so we need to put
this on screen so I'm going to use my
angular controller here I'm going to put
it inside a form element so my label is
drink and I want to drop down so i'm
going to call this i'm going to put it
in a drink object i'm going to call it
type not surprisingly if we look back at
the javascript we have this thing called
we've already called types and what I
want is I want to display the type name
for every type in types
let's put that down there so you can see
it and now when I reload my page you
should hopefully see a drop-down of
drink types so about drink and have my
tights and with angular like you'd
expect you can do client-side stuff with
your data so for example I can reorder
this if I want to display alphabetically
I can say order by name we loaded it too
soon a CLT so it's reordered it by name
now you can imagine that this this
drop-down I've obviously hard coded it
for simplicity but you can imagine
getting that from with from a rest
endpoint or from your database or
whatever so that's the types we also
want to include sizes because the sizes
is failing is more or less the same
thing i'm just going to cheat with a lot
of pre-built scripts here so it's more
or less the same thing so again I've got
a form group of size I've got to select
I'm going to iterate over each of the
sizes each the size array was just an
array of strings not of objects so I can
quite simply just say size for size and
sizes and it will display that a rate
there and I also want to be able to add
my name so that the actual drink comes
to me when I order it drink drinker not
the sort of drink you're thinking of and
when I reload this I get my drink drop
down my size drop-down and my name so
that's great I actually have a
rudimentary web app where I can take
your order but what you're thinking is
you promised as modern web development I
could have done that in 1999 and this is
where bootstrap comes in so if we if I
go to the right place if we add
bootstrap CSS
then we get hopefully a much prettier
looking at you I now I did cheat a
little bit because I already used the
bootstrap CSS classes on my object so I
kind of knew what I wanted to put there
but you'll notice that the bootstrap
ones are fairly they're kind of well
named they explain what it's for not
what it looks like so this is a div
container this is going to contain
something with a form my form elements
have a class of form control so I can
just annotate my HTML with those things
and it comes out looking like a fairly
sane application and I said this is
going to be a mobile app so I'm going to
use a magic incantation to make it look
okay on the phone and then what I can do
in chrome people use developer tools in
chrome okay good a lot of you good so if
I bring up the developer tools there's
actually a magic mobile button here and
then if i say Nexus 5 and reload this it
shows me more or less see if I can get
rid of this ah rubbish to people said
the mobile emulation was going to go
wrong and it doesn't normally look like
this it normally looks better but the
point is it gives you an idea of what it
would look like on Iran a mobile screen
so that's the Nexus 5 and if I say the
nexus 7 you get the idea of what it
would look like on on a tablet rather
than just a phone it's kind of
rudimentary and crude but but it does
work and it's quite nice quite a nice
way of quickly figuring out if you did
something that's going to be really
stupid on the phone so that's all I
needed to do to make it some fairly
modern looking you have to kill yourself
creating new CSS styles or messing
around with divs it just kind of works
fine so I've let you select your drink
but you haven't done anything with it it
just kind of sits there on a web page so
what you really want to do is send this
order obviously to the back end to the
server and that's the kind of
interesting bit where we start to tie up
the front end with the back end we start
getting them talking to each other so
firstly
let's take a look at the angular side of
this while we were doing this we were
building up a drink object this puts it
in ng model of drink type drink sighs
drink drinker so let's take a quick look
at what that drink object looks like
this is just for debug purposes really
now as I select my things you can see
this JSON object being created with the
values that I put into the form and this
is what I want to send to the back end
this is my order object that I want to
send to the back end I'm going to copy
that because I'm going to need those
values later obviously this needs to be
inside a form otherwise it can't go
anywhere I'm going to have a function
called give me coffee smooth this down
here and we need a submit button give me
coffee I've only had one today so I need
lots of exclamation marks on the end of
that and these are just bootstrap
classes just to make things look pretty
so let's have a look at what that looks
like that's my big button now we created
this give me coffee function so we
actually need to create the body of that
function so here back when our
JavaScript we've got scoped dot give me
coffee and what we're going to do is try
and remember what when you sue firstly
our drink object scope dot drink and I
want to add a coffee shop ID to this
we'll come back to this later but
obviously we're going to need to send
this order to a particular coffee shop
for now we're going to hard code that as
one clickers right it's a good place
holder to remind me that I need to do
this stuff and then what we need to do
is we need a coffee order probably and
and I'm going to send this order to this
uri now this your awry this comes from
if you remember in our yamo we said we
want the java stuff to be at / service
and start / service this coffee shop
this comes from in our resource we said
we want to serve it at / coffee shop and
we're going to create the order bit in a
minute that's the Java side of things so
now what we want to do is we want to say
coffee order save and drink scope dot
drink and because we're using this
resource thing we need to start using
angular resources so this is resource I
can't spell it resource we need to add
this module ng resource we need to pull
it in no on the HTML we need to include
that file then hopefully what we should
do obviously we've just done the
client-side stuff of this what we should
find if we look at our let's get rid of
that network calls using our developer
tools when I select this drink put these
details in you can see this is my order
object which I'm going to copy again
want to press this button it gives me my
coffee shop ID which I hard-coded to one
but also you can see that it's made this
call order service coffee shop I'm
getting a 404 of not found because we
haven't created it yet so I know I'm
getting the right or the right error for
this particular problem so that's great
that bit usually goes wrong very excited
I'm easily pleased I like coding because
it when it goes right it's fantastic
alright so that's the client side of
stuff we want to go on to the the Java
side of things so here's where we go
back to our coffee shop resource because
we're doing a save we're doing a post
we're posting that object to the back
end so let's create our post method we
said it was going to be called order it
takes JSON
it's going to be called save order it's
going to take an order object this is a
template I created in IntelliJ but it's
you can see it's kind of reusable
template I could use again and again
every time I want to create a post
method and so I'm taking an order in the
response what I want to do is when I
successfully save the order I need to
return a responsive creative because I
will have created an order and I'm going
to put on that response i'm going to put
the order ID because that will be
generated when I save the order into
MongoDB and the body of that order
object so the client can then do
whatever they want with that updated
order object so let's create this order
object let's go and create the getter
for the ID now this order object this is
the idea that gets generated for mongodb
I'm going to need to annotate this with
a more for your annotation so you can
see it's more your annotation so this is
going to be the eid the identifier for
this object what else did we say we
wanted we said we wanted all of these
things so we also need a private string
drinker private string sighs i'm going
to add on to hear something which we
might need later and just because it's
faster as selected options this is
useful for testing as well and and we
need the private long coffee shop ID and
finally remember that this type is
actually an object in its own right so
we're going to create an object for that
oops
our drink type has a name and a family
so a nice little tiny javabean type
thing I need to have getters for these
fields because that's how Jackson knows
how to turn the JSON into java objects
it looks at the getters to find out
which of the fields that it cares about
and what's also useful will be a equals
and hashcode this is useful for testing
and a two-string because again if
something goes wrong in the test then I
want to be able to see that so to string
fine so I really don't know why people
think Java is verbose because I think
that this to field object is perfectly
fine at 51 lines of code but that's okay
we can just ignore this it's totally
fine let's go back to our order we need
the getters on the order as well we're
not going to add the equals and hashcode
because not get us and such as just a
baguette errs and that's all we need for
the application to work properly so
let's go back to our resource now we
have the order object which will
magically turned from the JSON into our
order object and what we need to do is
we need to save it into MongoDB so we're
going to have a more for your datastore
and create this field data store and put
that create a magic constructor now we
don't need any values in there so we
need to create this so we'll have a new
more fear or fear our can't spell and
create data store what we need to do is
we need to pass in a Mongo client this
is the thing that knows how to connect
to your mongo DB server and we need to
give it the database name so the
database name is the application name
it's called calf Alito because it's like
cross between spanish and english i live
in spain at the moment so my Spanish is
really bad and let's add this manga
client on to the constructor parameter
for this I can use the default Mongo
client that doesn't take any arguments
because i'm running MongoDB or
be running MongoDB in its default
configuration on localhost and its
default port number but you can see that
I can configure it by adding a host or a
bunch of options or a port or whatever
there's a loads of different ways of
configuring your connection to MongoDB
for the cases this example I don't
really need to do very much so that just
works which means now I have my data
store working I can just save the order
into that and then that's all I need to
do more fear will turn our order object
into something MongoDB shaped magic so
let's see what that looks like i have
written a test before i wrote the code
because i'm good like that it is it's a
spot test anyone using Spock one and a
half people what's wrong with half
people at the moment are i'm not sure i
don't know if anyone go chance to sort
see Ken's talk about spoke earlier on in
the conference if you didn't and you're
interested in testing do take a look at
it because I saw him talk about spot a
while ago and I'm totally sold on it now
we use it everywhere so Spock is a
groovy testing framework it allows you
to do stuff in a BDD type way so it's a
given when then and and it's just a
really nice way of working with but
particularly things like MongoDB because
groovy works really nicely for maps and
mongo DB is documents and documents
little bit like maps and so let's run
this test we've got a functional test
I'm not going to go through it in detail
the code is available github so if
you're interested you can have a look at
it but this functional test is going to
call my new save order method with an
order I created up here with various
values and then I want to make sure it
made it into MongoDB so it will be
useful if I started MongoDB to begin
with there we go so I'm up and running
let's connect so let's have a look at
what's there at the moment I have show
db's I have zero databases in there at
the moment because I haven't done
anything with it yet so once I run this
test
please go green please go green yes and
when i run this i should see a coffee
order which looks like this in my
MongoDB database so let's have a look so
now i have my database called Carlito I
didn't have to create that by the way
all I did was try to connect to it and
if it's not there munger to be just
creates it for you so now I can use that
database and have a look at what's in
there I have a collection of order you
can see that okay right and so my order
collection morphia put my order object
into a collection called order because
it was a class called order you can
configure that but for my purposes that
seems perfectly fine so if I say DB
order find oops show me everything
that's in that collection I have one
object in that collection it tells me
which class that belonged to and then I
have these values which were in the test
so the test work correctly and my new
order is in MongoDB so now I have the
safety of knowing that my my back-end
functionality works the way I expected
to I can we start my coffee shop service
and call it from the front end without
getting an error from the front end and
figuring out what happened so that's up
and running let's try and post this
order to the back end oh I need that I
need my network so now I post it not
very clear but you can see instead of a
404 I've got a 2 0 1 i've got a creative
response and if i look at the response
it's got the ID which was the generated
MongoDB identifier and I've got the I've
got all the details of that order object
as well so I've now got the end-to-end
stuff working i have and i have
angularjs creating this order object
I've got angular JS posting it to the
back end and then I've got the backend
person
seeing that into MongoDB if I have a
quick look at MongoDB now I have another
I have another order object now this one
doesn't have selected options because I
haven't created the UI to add selected
options but no going to be is totally
fine with this if you've got fields
which are there and some objects and not
in others it's like totally fine with
that which is why it makes quite good
prototyping and database because you can
chuck stuff in there and evolve your
schema over time and and it doesn't
freak out too much if you've got nulls
or missing feels so yes so I've now got
my orders being sent to the back end
before we move on to the obvious thing I
want to be a responsible developer a
systems admin I need to know the
connection to MongoDB is closed when the
service stops so there's some nice
things you can do within drop wizard to
help you clean up after yourself so we
need to close the connections to MongoDB
just to release our resources and be
nice when our application finishes and
we could do that fairly easily and drop
wizard so if we go back to our coffee
shop service you remember i just created
this default Mongo client let's pull
this into a variable let's say
environment manage you Mongo client
manager I'm going to pass in the Mongo
client into this and this just needs to
be a manager yes yes yes yes I want this
to implement managed because that's all
I really care about for this particular
case i'm going to create a field for
this Mongo client object and implement
all the methods are managed now for our
case we don't need to do anything on
start but you can imagine maybe you
might want to test the connection you
might want to make sure the database is
there and up and running or whatever we
don't need to do anything with that and
but on stop what we do want to do is we
want to make sure that we close our
connections that's all and so all I have
to do is a restart my server for those
changes to take effect and that's it I
mean it's it's not exciting sexy
functionality but it means that you
probably won't get phone calls at two
o'clock in the morning when you start
when your app server starts freaking out
so that's all we needed to do for that
now what you will have noticed
is that in order to figure out whether
our order made it to the back end I had
to use google developer chrome tool
things all right we don't want to say to
our users open the chrome tools in order
to figure out whether your whether your
auto made it to the back end or not so I
need to display some sort of useful
thing to you to show you that your
automated to the backend and this is
where we're going to start using UI
bootstrap with their reusable widgets so
let's go back to the front end we are
going to go to the JavaScript now when I
save something I can actually provide a
success callback I'm going to implement
success this is going to the order is
the payload that comes back from saving
the order I'm going to push a message a
success message on to an array and that
message is going to be Auto sent so
let's create that array skype messages
and I need a way of dismissing the
alerts when they're up close alert yeah
it's as far as I'm concerned it's just
magic it works and this is going to be
using UI bootstrap so I need to add the
you are boot strap module onto here
which means of course and I need to
import that as well
and we're going to display this on the
screen up here remember my array was
called messages so for every message in
the messages array i'm going to use i'm
going to display that message and that
was my clothes alert which tells it how
to go away so this alert this is a UI
bootstrap widget which I can just
display on the screen and then when we
reload our page let's try again when I
place my order and I get successful
order from the server I get a nice
widget which just says yes your order
was sent and I can do what I want with
this so I can date I can say for example
I might want to display the order ID
it's not very pretty but maybe I want to
do that and I can get that from this
order object here so now when i send the
order i will get oops my order ID and
you can imagine i can put something like
a link to track the status of my order
and things like that so you can do what
you want on there so that's all I needed
to do to be able to give the user some
decent feedback in a kind of fairly
pretty way i doing okay for time mrs.
this is good we're doing okay for time
but I'm going to skip the story and come
back to it if we have plenty of time I'd
rather get the opportunity to take some
questions and this particular story kind
of just shows some of the same stuff
we've seen in a slightly different order
it's kind of pretty but not so important
right now this is the important thing
now I've sent my order to the backend
I've configured my older on there you i
sent my older to the back end it's been
persisted into MongoDB but i have no
idea where my coffee shop is I tell know
where the orders gone too so now we're
going to use some of the geolocation
staff from html5 and from MongoDB to
figure out where you are and where your
nearest coffee shop is so firstly we're
going to need to populate our MongoDB
collection with a series of coffee shops
because otherwise there are no coffee
shops to send things to this is where
we're going to use
and groovy a nice groovy script so we
have this groovy script here anyone
using groovy i'll call quite a few
people and so groovy the reason i picked
groovy here is it's great for scripting
it's great for XML parsing because it's
just kind of built into the language
it's really nice for dealing with maps
and mongodb documents are a little bit
like Maps so it seems like a really good
fit to take XML to turn it into
something MongoDB shaped so let me show
you what the XML looks like first which
might take a while because it's quite
big and my machine will freak out
probably it's thinking about it oh
that's okay it's not too bad so what I
did is I got some OpenStreetMap data
there's a there's an API you can call to
get various OpenStreetMap data and right
in the middle of writing a blog post
about this stuff so that people can look
at it but haven't quite finished it yet
and then you can see what I've done is
I've picked up things which are
amenities of cafe at a cafe with a
cuisine of type coffee shop and this is
XML with sort of key value pairs and a
latitude and longitude stored as the
attribute but what I really want is I
want to turn this into geo Jason which
is what MongoDB understands for querying
for geolocation stuff and so I need to
take this ID this latitude and this
longitude and and then all the other
keys and turn them into a MongoDB object
am I going to do that with groovy we're
going to do that with groovy by looking
at the right place okay so here I'm
using the just the MongoDB Java driver
there's nothing special about getting
groovy to connect to MongoDB just use
the Java driver it's fine i'm going to
talk to the database we created this
calf Alito I'm going to create a new
collection called coffee shop and then
I'm going to go through this XML file
and use XML slurper which sounds
terrible to go through each of the XML
nodes I'm going to find out I need to
take this ID attribute this longitude
attribute and there's latitude attribute
and put them on to
a map among we divvy document in the
shape I want so I want to associate this
ID with a field called openstreetmap ID
my location will be an array of points
of rolana tude latitude type point and
then I'm going to go through all the
other nodes and chuck them onto the map
and do some basic validation to make
sure that that I don't put something
really wrong into the database and
that's all I need to do to turn that XML
into something MongoDB shaped so if we
run this we should see one or two global
coffee shops going into our MongoDB
database so the total imported 8734 if
we go back to MongoDB show collections
we now have a coffee shop collection so
if we do DB coffee shop find let's say
let's just find 5 because well let's
count them first what would be a good
start so we have the same number 8730
cool that's a good start and then if we
do let's just have a look at them see
what they look like let's find five of
them and have a look at them so you can
see we've got the idea is the MongoDB
generators idea we've got the oven
street map ID which we pulled off the
attribute we have our location which is
stored as a sub document and then we
have all the other all the other fields
which were associated with these cafes
and you can see that these are kind of
each of the cafes has a different number
of fields and stuff and that's totally
fine for mongodb just throw it in there
and it's fine with it so now we have a
series of coffee shops with associated
locations in our database we can write a
Java method to query MongoDB to find out
the nearest one of these to you given
your latitude and longitude so let's go
back to our resource and this is going
to be a get method because I'm just
trying to get some information I've
created a helper to to create this
so this is what we're going to call this
nearest it's going to take a latitude
longitude get nearest we're just going
to return any old objects I'm not going
to turn this into a coffee shop object
because at this point I don't need that
it comes back from MongoDB is this kind
of JSON ish map so actually we can just
convert that straight into JSON and send
it to the front end without doing
anything else with it let's put that
down there so you can see that now we
have only a slightly massive hack just
so that I don't have to type everything
here yeah that comes built into IntelliJ
no it doesn't so here we are getting the
right collection which was coffee shop
if you remember that's what we had in
our groovy script and we're going to
build up a query to query the coffee
shop not surprisingly let's move this
down here I only want to find one
because i only want one coffee shop
right i don't need all the coffee shops
in the area I'm going to send my order
to just my nearest coffee shop and then
my query I'm going to use this query
builder let's pull this back here so you
can see it the field name was location
we go back to MongoDB you can see I've
got to feel them with location so we're
querying the location field and we want
to find we want to find the nearest
coffee shop to this latitude and
longitude so this is going to be your
latitude and longitude so I want to find
the nearest coffee shop and that's all I
need to do to get MongoDB to do that
query for me if I can't find one then I
get a 404 that seems sensible and I'm
going to run my tests to make sure that
this works the way I expect it to so
let's have a look at the test I have
some example I know that for this
latitude and longitude that this is my
nearest coffee shop so let's just run
this make sure it's working
I love it when my tests go green it
makes me so happy and so that means that
our java method to query the MongoDB
database for the nearest coffee shop is
working the way I expect it to and
because that was a because that was a
new method that i added to the back end
I just need to quickly restart my server
so let's restart that now obviously I
need to write some front-end code to
call that query with the current
latitude and longitude of the user so
let's go to our JavaScript we're going
to turn this into a new controller
because this is not a controller to do
with ordering this is a controller to do
with the coffee shop and which I might
have already done before just saves me a
lot of typing so this coffee shop
controller we're using similar sorts of
things that i already showed in the
earlier controller we have a coffee shop
locator which uses the resource it goes
to this this method we just created
within with the latitude longitude it
gets this latitude and longitude from
the window object so from like an html5
thing so I can get my and get the
browser's current latitude and longitude
using this and then once i have posted
that position off to this uri i'm going
to get the response the response is
going to be my nearest coffee shop an
object which represents my nearest
coffee shop so i'm going to set this on
this this variable here and i also need
to set it on this local coffee shop
object which i'll come back to in a
minute which i might have also slightly
cheated to create but for the time being
when we get our coffee shop back we're
going to set it on here and on here and
we're going to call this method
immediately so as soon as you load the
page and i'm going to go and find your
nearest coffee shop before you start
doing anything else because i know i
need to post the order to your nearest
coffee shop and but i need to show you
what that coffee shop is otherwise you
don't know where to pick your copy of
coffee up from so
find my coffee so this is using the
coffee shop controller and then I'm just
going to display where your nearest
coffee shop is right this is the bit
which never works first time it's going
to be totally fine right reload the page
and wait yes worked I'm amazed so not
surprisingly the nearest coffee shop is
starbucks because you know that's the
world we live in and I've added a really
crude link to the location because
obviously I got the location back so I
can kind of just put the coordinates
into google maps and show that i'm not i
really wanted to do like a really nice
little embedded google maps thing to
show you where it is but i'm just
putting a very crude link in there so
you know where it is so so that's great
so now you know what your nearest coffee
shop is where your order has been sent
to how to get there except that that's
not what happens is it because when we
put in our order if we look at our order
thing down here we are sending it to the
coffee shop idea of one we hard-coded
our value odd coding is bad so we just
need to pass in the real coffee shop ID
to that and that's where this local
coffee shop object comes in so we can
use this it's like a little bean I guess
we can use this to to pass data between
the different controllers so here we
passed it in there let's just take that
we need that on here as well so that's
my local coffee shop and instead of one
i'm going to do a local coffee shop get
shop dot up in street map so I capital M
or not what's it called openstreetmap ID
capital m
so now when I post my order to the back
end I can select these wallets going off
to find out starbucks put this in here
and when I press that I get the real
coffee shop ID of the coffee shop the
order went to and so now we have a
working application you can place your
order select all your staff send it to
your local coffee shop find out where
your local coffee shop is and walk in
there and pick up your coffee it all
works and in less than 50 minutes
amazing
I can actually sense the disappointment
in the room that not more stuff went
wrong I mean that's just not nice guys
that's not nice but this is good i've
got 10 minutes to kind of go over some
of the caveat some of the resources and
so on and so forth and the caveats are
yes i did it in less than 50 minutes yes
i have done this before it did take me a
little bit longer than 50 minutes to
create the original app the original app
took me about a week to put together
most of which was learning angularjs
what what i have done though is used
exactly the same stack to put together
something for one among ODB's and hack
day things and it took about five hours
to create an application from scratch
using the stack completely different
application but using the same
technologies so it is a good technology
stack to get started with JVM you don't
have to like write stuff in Ruby and
then brought it to the JVM later you can
just use this to get up and running
straight away and yet most of that was
learning angularjs I did cheat a tiny
bit with IntelliJ there were a few tiny
cheats in there but like I said I could
get something up and running in five
hours from scratch and obviously I
haven't covered anything in any great
depth the aim of this was to show the
different technologies show their place
in the stack how they talk to each other
and what they're supposed to be used for
you know in more or less well I suppose
be useful and there's loads of
additional resources for more in-depth
things so all the rest staff that gets
in the sets and what you should be doing
with resources and staff that's all in
the rest in practice book which is an
excellent book if you're doing anything
even vaguely rusty it's really good it's
got examples in Java and.net and all
sorts of things the angular stuff I
learned mostly using this angularjs in
60 minutes video which is all just the
client-side angular stuff the the last
one the angularjs meets Java EE was a
good way of giving me the idea of how to
actually get angular JS to talk to the
Java back end so that was good for that
these slides are on SlideShare by the
way so feel free to take the pictures
but if you miss the opportunity they are
on SlideShare I'll just wait for you is
fine
all of the technologies all actually
have pretty good documentation certainly
for getting up and running and getting
started all the bootstrap stuff
bootstrap I learned in like half a day I
thought it was going to be quite
complicated it's not it's easy it's nice
and the angular UI bootstrap widgets are
really awesome too and obviously go to
MongoDB org and download MongoDB and
read all the documentation and put it in
production that would be great and it is
free by the way it's not a paid for
database you can pay for if you want to
but it is free to get started and more
fear is the obviously adjustable we were
using to talk to MongoDB both me and
Justin over there we help support
morphia and the Java driver and finally
calf Alito is the name of the
application so you can look at the code
on github there are actually a number of
branches there so there will be a Java
one branch there which will be this
exact demo I've given the demo a few
times before with slightly different
versions of things and so if you look at
the other branches you can see slightly
different versions of it everybody don't
finish taking the pictures right and now
we actually have time for questions for
the first time since I've ever given
this demo questions yes yeah right
obviously I didn't do any money side of
things because that's probably going to
take quite a lot longer and any more
questions yes
sorry I couldn't hear that all I still
couldn't hear that he'll do he'll check
right so drop as it has support for like
health checks and stuff for and the
servers at the back end which I didn't
look into but it's all there it's part
of the job wizard stuff is that answer
your question or not not really come and
talk to me up to us and any more
questions no that's it great thank you
very much everyone</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>