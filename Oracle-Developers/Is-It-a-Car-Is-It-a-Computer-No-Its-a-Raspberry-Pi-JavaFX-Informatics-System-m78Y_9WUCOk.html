<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Is It a Car? Is It a Computer? No, It’s a Raspberry Pi JavaFX Informatics System | Coder Coacher - Coaching Coders</title><meta content="Is It a Car? Is It a Computer? No, It’s a Raspberry Pi JavaFX Informatics System - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Is It a Car? Is It a Computer? No, It’s a Raspberry Pi JavaFX Informatics System</b></h2><h5 class="post__date">2015-06-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/m78Y_9WUCOk" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so good morning and welcome to the catch
early titled is it a car is it a
computer no it's the Raspberry Pi javafx
informatics system easy to remember
title what I'm going to do this morning
is to talk about how you can integrate
computers into your car and do some
potentially interesting potentially very
dangerous things with a computer in your
car I hope it's going to be an
entertaining session because I've got to
admit I've had a lot of fun putting
together the demos and actually building
this system I am a geek I love things
electronic I love computers I love
programming and I'm also a petrol head I
love cars and I love finding out how
they work and reading up on all the
latest things so I combine these two
passions into one thing now of course
being an Oracle employee I have to put
up the obligatory illegal slide which
says that this is not intended to
outline our general product direction I
certainly think this is nothing to do
with our product direction at the moment
so you've had enough time to read that
so we'll move on now in terms of the
agenda are broken it up into number of
different sections so that we can cover
different aspects of the project first
of all I want to talk a bit about cars
and computers because things the way
that computers or the way the cars work
nowadays relies a lot on computers
probably more so than you even realize
then we'll talk a little bit about the
Raspberry Pi and where that came from
why it's a good choice for the kind of
system that I built that goes in a car
we'll talk a little bit about embedded
Java or took about embedded javafx how
those work in relation to the Raspberry
Pi again why they're good choices for
developing this kind of application and
then I'll spend probably most of the
time talking about what I've done in
terms of building this system the
software what it does how
works and so on and then at the end i
will give you some demonstrations now
you may have noticed there is no car at
the front of the stage now much as i
would have loved to have brought my car
with me I live in London and so the cost
of bringing my car all the way here just
to put it in front of you and show you
the system working is beyond the the
bounds of what we can do so what I've
done is I've actually made a video of
the system in action there's a little
three minute video that I'll show you at
the end I will apologize for the quality
of the video beforehand because it is
difficult to drive and film at the same
time so I didn't do that I got a friend
of mine sit in the car but it's still
difficult to actually make a
professional looking video but I think
you'll get the gist of it and then I'll
show you a couple of other things as we
go through so let's start with talking
about cars and computers and what I want
to do first of all is it a little bit of
a little bit of history so here is a
picture of my very first car a mini
clubman 1000 now does anybody remember
the the original Mini anybody have had a
original Mini okay one or two people
very good this was a lovely car in many
respects it's such a simple car from the
point of engineering and so as a 17 year
old as I was when I first got this it's
actually great because you can actually
tinker with it you can actually get your
spanners out you can take things apart
you can put them back together again so
I actually have the cylinder head off
twice I think and not for any
particularly good reason other than I
want to see what was inside the engine
and from a point of view of the
electronics of this thing it actually
had no electronics whatsoever well as I
say it had a radio that was as close as
you got to solid-state electronics in
this vehicle and so for those of you who
can remember old cars this had points
anyone remember the feeler gauge yes
setting your points yep okay it had a
distributor it had a carburetor so there
was no electronic fuel injection nothing
like that it had a manual choke who
remembers a manual choke yes the
umbrella stand
hang your umbrella rain it had drum
brakes which meant it didn't really
break that well it didn't even have an
alternator it had a dynamo and then in
terms of luxury items it had lights it
had a horn it had wipers that sometimes
worked it had a fan that again sometimes
worked if you stuck your hand around the
back and spun it a bit as you were
switching it on and it had an ignition
switch and that was about all you have
in terms of the electronics or electrics
I should say so I still have the haynes
manual who remembers who's got Kane's
map yes good I still have the haynes
manual for my mini and so I actually
copied the wiring diagram for my my car
and this is the wiring diagram from the
1970s now it looks fairly complicated
but obviously that's with a very small
number of components in the the actual
machine so it's quite a complicated
wiring diagram in terms of linking all
the different bits together that need to
be linked together so that's that's the
history here is my current car it's a
little bit different thankfully I've
dreaded still driving the mini this is
an Audi s3 and unlike the the mini it
has lots of electronics in it because
it's a modern car I mean you can't buy a
car now which doesn't have lots of
electronics in it so this has an engine
control unit this is a very nice little
piece of technology which is basically a
computer that controls the amount of
fuel that goes into the engine and
controls things like the timing and so
on and it's actually possible to remap
your engine so anybody remaps their
engine few people good yes I've had
three of these ODS threes in the last
few years and that the two that I had
before this one with the older style one
and I have both of those remaps so you
could take the engine power from I was
about 225 bhp up to about 265 bhp
without doing anything mechanical so
literally just change the electronics
and you can get 40 more bhp out of it
that's the kind of impact that you can
have with the computers sadly with this
one how do you have kind of cottoned on
to the fact
that people like to change the mapping
so it now has like a checksum in it so
you can't change it I think that's
really unfair because i bought the
cutoff it's mine if i want to change it
i should be able to but you actually
have to put in a new ECU if you want to
remap it it has fuel injection it has
electronic timings there's nothing
mechanical in terms of that exactly it
has a fly-by-wire throttle so when you
put your foot on the accelerator it's
not actually mechanically linked to the
engine it's just a potentiometer that
detects the position that you've got the
throttle pedal app and sends that to
these you to actually determine how much
fuel and so on gets pumped into the
engine it has ABS I had pretty much
every in fact in Europe every car now
has to have abs by law so you have an
anti-lock braking system where the
wheels have sensors on them that can
detect the rotation speed of the wheels
and then it can compare the front wheels
to the back wheels if the front wheels
stop and the back wheels are still
turning the brakes are released for a
little bit and so you get this juddering
effect which allows you to steer as well
as break very hard at the same time it
has an electronic stability program
which allows you to do interesting
things in terms of applying brakes on
particular wheels if you get to the
situation where your car is under
steering or oversteering and that relies
on both the abs sensors and also an
accelerometer and sensors that detect
how far you've got the wheel turned so
that it can decide whether you're
actually out of control one of my
favorite things from friend of mines got
a BMW and he was showing me the manual
for it it says the ESP system is very
sophisticated and will correct under
steering and oversteering be aware that
it cannot defy the laws of physics which
is quite true it can't it this
particular car has what's called
magnetorheological suspension this is a
really kind of interesting piece of
technology so your car has shock
absorbers or as the Americans call and
dampers I think and which is basically a
piston which has oil in it and the ideas
of this irons out the bumps on the road
and in this one
you have a fluid in there which has lots
of like iron filings in it so it's
magnetic and then you have an
electromagnet around the shock absorber
so that you can switch between different
settings and you can actually make the
viscosity of the liquid holler or lower
depending on whether you want the
damping to be higher or lower what that
effectively equates to in my car is you
have a button which says comfortable or
uncomfortable so most of the time I
leave it in the comfortable mode but you
can actually do a lot more with that
kind of technology so for example if you
if you take higher end cars things like
Ferraris Ferraris have the same kind of
suspension system but they can
individually change the shock absorbers
not just all at the same time so for
example in the I think it's the 575 was
the first one to introduce this when you
change gear if you're changing down and
you're accelerating the computer will
actually say are more power is going to
go to the rear wheels so we'll actually
set the suspension to be harder in
advance of that so that as you
accelerate you get you don't pitch so
you don't actually get the back of the
car dipping as you accelerate and people
at Porsche now use what are called
adaptive engine mounts so they have in
an engine you typically have rubber
bushes which mount the engine to the car
so it absorbs the vibration now when
you're going around a corner very fast
that will allow the engine to move very
slightly which disturbs the handling of
the car so what portion do is they put
these flames sort of shock absorbers in
there so that when you're cornering very
fast they actually harden up the engine
mount so the engine won't move as much
so there's a lot of things you can do in
terms of changing the way a car works
through not just mechanics but also
computing in terms of comfort systems
it's got satellite navigation it's got
Auto sensing wipers and lights and
things like that so this obviously needs
to a lot more wiring now if you took the
the wiring diagram that we have before
you trying to expand that to a car which
had lots and lots of different things in
it it will become unreasonable in terms
of warring up all the individual
switches and sensors and things like
that so what
all the manufacturers do now is they use
a bus architecture and so this is a
picture of basically the system that's
in my car now and it has three different
buses because the way it works is that
for all the different devices connected
to a bus they send messages to each
other so when you press a button
actually sends a message on the bus to
the thing that you're trying to control
now clearly if you if you've got lots of
different things you want to isolate
some of those messages because in the
case of like the powertrain you don't
want messages from the radio interfering
with messages that are going to the
throttle or something like that so they
have different buses and they have
gateways between them if you need to
send different messages so in the Audi
you've got a convenience bus which is
things like wipers lights horn all that
sort of thing infotainment bus which is
your radio CD player if you still have a
CD player things like that and then the
power train bus which is the actual
engine control and then you'll see that
there's actually a diagnostic port there
which is on all vehicles that you get
now literally every car that's been sold
since about 2,000 certainly in Europe by
law they have to have this I know in the
US as well I think it's it was a little
bit later it's like 2004-2005 all cars
now have this so if you look under the
dashboard you will find somewhere
there's this little socket that you can
plug things into which is when things
get interesting so the socket that you
plug into it allows you to access
information for the car and typically
what this is used for is when you take
your car in for service if there's a
warning light on what the garage can do
is they can plug in a Diagnostics
machine and it will actually read error
codes and say okay that the fault is
with maybe like a lambda sensor which is
what measures the air pressure coming
into your engine at something that
typically goes wrong a lot of cars and
so they can plug that in they can read
information from that it's also used for
monitoring the performance of the car in
terms of emission control so that's one
of the things that's very important for
a lot of governments so they they
mandate this so that you can
pick up all the information you need in
terms of measuring the way that
emissions are being produced by the car
and there's all sorts of different
protocols that get used for this the
main thing is is what's called obd2 the
on-board diagnostics version 2 and in
Europe it's the eobd but there are
different sort of protocols in terms of
the way that you talk to the different
partisan system and then one of the main
ones that's used with this is what's
called the can bus the controller area
network and this is a sort of automation
control system that allows you to send
messages around the different buses and
have the different devices communicate
so it's talked about the Raspberry Pi
and why we won't use that in our car so
who served the Raspberry Pi good almost
everybody the rostra prize is a very
interesting little project it was
started back in 2006 and the reason it
was started was because in the UK where
I live people were getting upset by the
way we were teaching computer science at
school because what we were teaching was
not computer science so we have this
thing called ICT I can never remember
what I see T stands for that we have
this subject called ICT and what they
basically teach children is how to use
word how to use powerpoint and if you're
really lucky you get to learn how to do
HTML now I don't know about you but
that's not computer science to me so
there a lot of people at universities
were complaining because as the students
were coming up from sick fallen from
high school they didn't really know
anything about computing and so having
to teach them a lot of the basics very
early on and they should really know
more about this kind of thing so the
Raspberry Pi was started with the idea
of getting schoolchildren more
interested in basic computing and
understanding a lot more about how to
program how computers work and so on and
this really came about as a sort of
follow on from a project which is way
back in the 1980s a BBC micro project
anybody have a BBC micro had a BBC micro
okay
yes a couple of people this was a lovely
machine it was a 6502 processor 8-bit
processor it had 6th note 32 kilobytes
of memory and it could do color graphics
which was like wow so what they want to
do is to create something like that
something cheap something that you could
give to children it didn't matter too
much if they damaged it because you
could replace it easily and so the
Raspberry Pi came about as part of that
it's a very cheap easy to use computer
and so they started the project back in
2006 launched it last year in February
and they've shipped well over 1 million
of these things since then I think it's
probably closer to two million now from
the point of view of the architecture of
the Raspberry Pi what you get is an ARM
processor it's an arm 11 which is an arm
v6 core running 700 megahertz now what
they have done since they launched it is
allow you to overclock it so you can now
actually overclock it up to 1 gigahertz
without breaking the warranty it comes
in a broadcom system on chip package so
it's all kind of in one particular lump
it has 512 megabytes memory which might
not seem like a lot but it actually
means you know you can do quite a lot
with it and in terms of i/o you've got
the the usual things you'd expect if you
want to connect a monitor to it you've
got HDMI composite video there's an
audio out through a 3.5 mil plug there's
no audio in there's two USB ports
there's an Ethernet port and then
there's some nice header pins that allow
you to connect things like gpio
general-purpose i/o things like you arts
for serial communication SPI i squared C
which are low level protocols that a lot
of sensors use so there's a lot of
capabilities that you can have with a
raspberry pi now from the point of view
of using this in a car it has a number
of advantages well firstly it actually
has plenty of computing power running at
700 megahertz or I tend to run about 900
megahertz is playing
in terms of doing the kind of data
processing that this requires it also
has very low power consumption so it
needs less than one amp but five volts
and that's easy to to provide in a car
so you don't have to worry about having
a big separate power system with five
volts and 12 volts and and plugging into
the mains so you can't run it very
happily off the cigarette lighter
without any problem persistent storage
is provided by an SD card so there's no
hard disk in there if you're in an
environment where things are moving
around there's a lot of vibration having
a spinning disk doesn't tend to work too
well so having an SD card means it's
easy to actually have in that kind of
environment and then in terms of its
support for like Java and so on there's
hot wet floating point is now supported
so we've got the ability to do some of
the graphics side of things which I'll
talk about in a bit java SE embedded
Java ME embedded are both supported on
the Raspberry Pi in fact we use this as
one of our reference platforms so we
specifically targeted it we've tuned
things specifically for the Raspberry Pi
and the same with JavaFX the prism
graphics engine has been ported to that
it takes advantage of the GPU that
you've got in the Raspberry Pi which is
actually very powerful if you remember
the talk that the keynote and Jasper was
talking about the the processing power
of the Raspberry Pi and the graphics
processing although the processor sounds
like it's quite slow it's got a very
powerful GPU in it talk a little bit
about embedded Java and Java FX move
over this fairly quickly what we try to
do with Java is to target it at specific
types of device so we're familiar with
the ideas of java SE it's being desktop
as being the underpinnings of java ee
and then as you move down the scale in
terms of the amount of processing power
and the amount of memory that you've got
in your system then you get into Java ME
so we have Java ME embedded there's what
we call the small version that's medium
version there's large version so we can
tailor the type of
libraries that you have the way the
virtual machine works specifically to
smaller and smaller sizes of memory and
then right at the very bottom you've got
Java card which works in the sort of
right down into the kilobyte level
rather than being megabytes so we cover
a wide range of different types of
device we also deal with different types
of processors so it's not just in tell
obviously arm it's very big in this kind
of space there's also support for things
like the the mixed processor powerpc
things like that from point of view of
what you get in Java ME embedded 3.3
which as I say is supporting on the
Raspberry Pi it uses the CLD c 1 dot 1
sadly that the slides i put together i
didn't realize we were going to announce
that Java ME 8 embedded was going to be
available in early access so this is the
sort of current version that's generally
available has reduced footprint for both
our JV m and the core libraries so it's
designed to work in a smaller footprint
has a very nice device access API this
is something that is very useful if
you're doing this kind of programming
because if you want to talk to the GPIO
pins or sbir i squared C then you need
some way of doing that from Java now you
can do that in number of different ways
you can do it using J&amp;amp;I you can use some
libraries third-party libraries with
Java ME we've actually provided a
standard library as part of the the
platform so you have the the libraries
you can use it makes it very simple to
actually access these kinds of things
and then they've got additional profiles
that apply to different types of devices
for java SE 8 embedded this is what i've
used for my project simply because you
have enough memory on the Raspberry Pi
so we don't have to think about using a
smaller footprint again the early access
has been tuned for the Raspberry Pi so
what we've done primarily is to support
the floating the hard floating-point
processor which is part of the broadcom
package because it's a v6 implementation
it doesn't have to support a floating
point processor
the one in the Raspberry Pi does so
we've done a special build of java SE
for that so that works includes javafx
as I said it's got the compact profiles
if you wanted to reduce the footprint of
the Java environment on the Raspberry Pi
than you can based on the profiles and
then what we've just recently done is
we've added the ARM version the
Raspberry Pi build to the standard list
of builds so when we come out on the new
build for the other platforms we also
come out with a new build for the
Raspberry Pi and that actually it's very
nice because it means you get the bug
fixes quicker than having to wait for a
special build for that a couple of
things about javafx on embedded devices
so one of the things you first have to
understand is that it doesn't support
all of the facilities that are available
in the desktop version of javafx the two
main things are that there's no webview
component so you can't render an HTML
page in your embedded application I
don't think that's a problem for my
carputer because we don't really need to
render web pages as part of our
application there's no direct media
playback support there are ways of
getting around that but it's a bit more
complicated than simply creating a media
view and putting it as part of your
application so there is a workaround for
that again I've not found that to be an
issue because I didn't need to include
video in my application one of the
things to remember about javafx is that
it uses a scene graph and the more nodes
you put in your scene graph the more
processing power of the memory it's
going to require so you do need to think
a little bit about how complex you make
the UI because you start going for very
flashy looking you I it's not going to
run very fast because the scene graph
gets very big it's very heavy so you do
need to think about how to make the the
scene graph as simple as possible in
terms of the number of nodes and we'll
come back to to talking about that as we
go through the the design of this so
let's talk about how to build a Java
powered carputer
now when I sat down to do this I had I
thought to myself right what are the
sort of goals of this particular project
I thought well what I really want to be
able to do is to put up more information
than I have at the moment because if you
think about it you sit in the car and
you have information displayed to you
there is a speedometer so you can tell
how fast you're going there's a
tachometer that growing most cars that
will tell you how fast the engine is
going there's a temperature gauge that
shows you roughly what the temperature
of the coolant in the engine is but
other than that that's about all the
information you're getting about what's
happening the engine some cars will give
you a bit more information so you can
see you know what is the oil temperature
for example some cars have a turbo boost
gauge so you can see what the pressure
in the turbo is my car very irritating
Lee tells me when I should change gear I
bought car with a manual gearbox so that
I could change gear I don't want to be
told when to change gear that's for an
automatic gearbox so I thought okay what
can we do in terms of adding more
information so I thought well it'd be
useful to display more complex
information things like how much power
the engines generating what talk am I
getting from the engine at a particular
time more sort of telemetry kind of
information so what's the position and
throttle steering angle in my axe what
braking force am I using that kind of
thing so I could do more of a Formula
One style display in terms of the
inflation so the other thing I want to
see was like what are the g-forces on
the car usually accelerometer find out
how fast you're accelerating in a
particular direction and then I also
excuse me I also wanted to record the
data so that I could analyze it
afterwards and see you know was I doing
a good job in terms of my driving could
I do better again sort of Formula One
start I mean who follows Formula One so
you know that the way they have the
masses of telemetry that they get from
the cars and they can see exactly how
the driver is is doing and tell them how
to improve in different places
now to actually get the information like
I say there is this service port that
you have in the car and that allows the
garage to plug in a machine which will
get either Diagnostics about what what
faults are on the machine and what
different things you've got and you can
buy this thing which isn't it scalding
elm327 it's a little box you can get it
from ebay ebay is a great place and
there's two different versions of it
that you can buy the elm327 really
refers to the chip that goes into it and
that's the one that communicates through
the service port in the right protocols
so you don't have to worry about the low
level protocol it just gives you a high
level abstraction of the the messages
that you're interested in so there's two
versions of it that one at the top is
the Wi-Fi version one at the bottom is
the bluetooth version bluetooth version
is like dirt cheap it's like less than
ten dollars the Wi-Fi version is a
little bit more expensive is like twenty
dollars but for a thing to play around
with it it's really very affordable I
use the the Wi-Fi one simply because
that seemed to be an easy way of doing
things so what you get is a fixed IP
address and it uses ad hoc networking so
you don't have to have a Rooter you
could just say point-to-point my devices
at this address the obd connectors at
this address and then you just talk over
Wi-Fi it's it's fairly easy to set up so
on the Raspberry Pi you have to change
the etc network interfaces file and you
set it to do ad hoc networking and you
set it for a particular IP address I had
some issues with that because it was
easy enough to get it to do ad hoc
networking but no matter what I did it
wouldn't pick up the IP address that I
was setting in that file so what i did
was i used the the Zen approach to
programming and i let the water flow
around the rock and so I just put a
script in my light startup script which
just did an ifconfig explicitly when the
Machine started up and that seemed to
work I don't know why but it works what
you get in terms of communicating with
it is 80 style commands
for those who are only must remember
modems you have 80 * commands to
communicate in terms of saying this is
what I want it to do so you can do
things like turn off line feeds you can
turn off spaces different configurations
for the device itself anything that's
not an 80 command is assumed to be obd2
or therefore can bus type of command and
it's a very simple request response type
of thing you send a request saying i
want this particular piece of data it
gives you back that data in the form of
a string and so you just have to pass
that send the right command par as a
result and you end up with a fairly
simple java library that will
communicate with the the obd2 interface
over Wi-Fi so the next thing i want to
do was to put some kind of screen to
display the information and again onto
ebay and i found that there was this
display that was available and they
specifically sold it as a device that
could connect to a raspberry pi because
that an hdmi input on it and it also had
a touch screen so the touch screen was
USB so you could just plug back into the
USB port plug the hdmi into the
Raspberry Pi and as you can see I've got
the the box there which is got the
screen mounted on it I think so oh yes
so it was specifically designed as an
in-car system so it's what's called a to
din fitting which means that it takes up
two slots in terms of the size of a
normal CD player or radio I say normal
it's like normal from 20 years ago now
in terms of touchscreen i again had a
few issues in terms of getting that to
to work exactly the way that I wanted it
to so the first thing was when I plugged
it in the linux raspbian distribution
recognized it so that was good it saw it
had a device driver for it it said yep
we got an eagle extinct touchscreen so
that's all good it created two devices
in / dev / input event 0 and invent one
so I thought great I'm doing really well
so then I tried to use Java effects on
it and it wouldn't recognize any input
which seemed a little strange to me
because if I use the X environment i
started up a desktop I could use the
touchscreen without any prob
so I had some discussions with the
JavaFX embedded engineering people and
they sent me some diagnostic stuff and
they got me to print out different
things about what javafx is doing and it
turned out the problem was that most
touchscreens only create one input
device so you get event 0 and that's
what jar FX uses this was creating two
devices event 0 an event one and all the
events were going to event one not event
0 so again no idea why don't really need
to know why and again we use the Zen
approach to solving the problem and so I
thought ok do we need a special builder
driver effects because that was what the
first suggestion from the team was I
mean and then I figured out well if i
delete event 0 and i do a muck nod and
create the same device as event one as
event 0 using the same major and minor
device number then it works so I my
little startup script now has ifconfig
to set the IP address and now has a muck
nod to set up the device for me and
everything works so at least you know I
got to the point where I could make the
thing do what I wanted it to do so this
is the the sort of hardware architecture
of what I built so we've got the
Raspberry Pi bear and that's connected
via HDMI to the screen the touch screen
part is connected via USB to the USB
connector also put a Wi-Fi dongle in the
Raspberry Pi so I could talk the Wi-Fi
connection to the arm 327 power came
from the the 12 car system so i just
actually plug it into the cigarette
lighter using one of these USB
converters which is very easy and then
i've got an accelerometer you witchy
i'll talk about in a moment which is
connected via i squared C so we can see
the acceleration that's happening in
terms of the vehicle so that's the sort
of basic hardware architecture and this
is what I ended up with in terms of the
inside of my my box that you can see
there so they're a couple of things one
was having to mount the Raspberry Pi on
the back of the screen I found there
were a couple of sort of holes with
threads in so i was able to mount the
beep I using that the hdmi cable I
couldn't find a short hdmi cable so I
got one meter hdmi cable that needs to
go that far as I had to wind it round a
few times and kind of wedge it in I'm a
firm believer that any good software
project should involve would work so I
made sure there were some wood in there
to mount the screen and the in the box
and so this is what I ended up with and
we'll talk a little bit more about the
box later on now in terms of the
accelerometer this is a nice little
device that's available from sparkfun
I'm sure a lot of people have heard of
sparkfun and bought stuff from sparkfun
and its uses a particular chip that
gives you nine degrees of freedom so
what that does is it allows you to have
acceleration in all three axis x y&amp;amp;z it
gives you a gyroscope in all three axis
and it also gives you a compass in all
three axis so that you can do and it's
even got a motion processing part of it
that will take the input from the
different sensors and give you some sort
of well processed output i spose what I
did with this was connected up to the
Raspberry Pi using the I squared C
interface you have to a couple of things
to get it configured so you have to make
sure the things are in etc modules so
you configure the BCM 2708 and the ice
too i suppose e dev devices and then you
just do an I squared C detect minus y1
and that gives you the address that you
need to talk to the actual device on the
I squared C bus so I could get the
accelerometer data and I could get the
gyroscope data I haven't managed to get
the compass data yet because there seems
to be something about a second i squared
C bus and I just didn't have enough time
before javaone because of so many other
things to do and I figured well I don't
actually need the compass data at the
moment so I won't spend a lot of time
trying to get that to work if I don't
actually need the data but I would like
to do that at some point so but a code
this is how you use a library there's a
thing called PI for j there's a very
useful library which does the same thing
as the device access api that you're
getting Java ME embedded
so what it allows you to do is talk to
the Icicle NC bus so you can use the I
squared T factory get an instance of the
bus then use a bus get device Oh x 68
that's the number you get from doing the
I squared C detect it tells you where
the devices on the bus and so you get an
address you need the documentation for
the sensor so you know which different
bites and things to write to it to set
up the different capabilities of the
thing so you can set the accelerometers
start sensing you can set the gyroscope
start sensing and then you can configure
them both because the accelerometer will
measure acceleration in a scale of 2g 4g
or 8g and I figured well I don't think
my car's going to do 8g not let's drop
it off a cliff when I even if Oakland no
but if it would be 1g so I'm not going
to get 8g out of my car so I went for 2g
is the scale that I set for that and
then that allows you to read the data
from there now one of the things you
have to do obviously is compensate for
gravity because as it says here the
earth sucks the problem with this is
that with an accelerometer it is subject
to gravity so whatever orientation you
have it in there's going to be a
measurement of gravity so if you have it
lined up perpendicular to well if you
have it so that one axis is in line with
gravity then you will measure 1g all the
time on that axis what that meant is
that we needed to filter that out in
order to get the dynamic acceleration
rather than the static acceleration so
what I did was effectively just to mount
the accelerometer in a particular axis
so that I could ignore the up-and-down
gravitational effect and then just
measure gravity measure acceleration
either forward backwards or side to side
what I had to do with that has had to
assume there was not going to be any
rotation of the sensor so that's not
strictly speaking true because as you
break up as the car pitches forward as
you accelerate it to get a picture up a
little bit as you go around corners it's
going to roll so you will get some very
asian against gravity what you could do
is if you wanted to increase the
accuracy of that you could use the
gyroscopic data to measure the amount of
roll and then filter that out based on
using that and there's a thing called a
Kalman filter which will allow you to to
figure out what the real acceleration is
but again I didn't have time to do all
the maths for that calculating power and
talk a little search on Google bit of
Wikipedia type stuff and you find that
in terms of measuring the talk if you
know the mass of the car and the wheel
radius and the acceleration in G you
just multiply the three together and as
long as you're using SI units then
you'll get newton meters of torque and
terms of converting that into the more
familiar imperial units of pound-feet of
torque then you just calculate multiply
that taught by a scaling factor and you
get pound-feet to talk power in bhp is
your talk in pound-feet times the engine
speed in RPM / some magic number now the
results for that are not going to be
fantastically accurate so the problem is
what's the mass of your car yes you can
get the mass of the car from the
manufacturers data but then you've got
to add in the fact that you've got you
in the car you've got however much fuel
in the car and you've got half of any
bits and pieces that you get in the car
because you've got children and stuff
like that so your mass is going to be a
fairly accurate but not maybe a hundred
percent we all radius you could measure
that but of course tires are not
completely circular so they tend to be a
bit flat at the bottom as they you know
compress and the acceleration because as
I've said you know we've got the issues
of the the role and the pitch that we
need to account for so we're not going
to get fantastically accurate results
dinama dynamometer is the only way
you're really going to get proper
readings but it's it's fun to see what
you get in terms of comparing it to the
manufacturers data for a software
architecture what i thought was use a
screen based approach so let's have a
screen for different sets of data and
then we'll switch between the screens to
show
from types of data and I thought okay
we'll have a splash screen start with
we'll have some basic some advanced data
g-forces graphs those types of things
and then what kind of work from there
really need a simple UI because having
lots of numbers on the display probably
not a good idea when you're trying to
drive the car and using the touchscreen
to switch the displays is a better idea
yeah one of the things I thought about
was using some of the buttons that you
have like on the steering wheel and
intercepting the signals on the bus to
see if you can use that as well so from
a UI design I thought well let's look at
what other people have done and see what
ideas we can come up with so this is
from a Renault Megane sport anybody seen
no bremen began sport a few people the
older version had this nice little sort
of bar chart that gave me the boost
verte value the throttle talk power and
then the newer version gives you a you
know a nice little g force diagram so
you can see the envelope of where you've
been in terms of how fast you've
accelerated and decelerated how far
you've gone round corners then this is
from the Tesla now I was lucky enough to
actually go for a ride in a Tesla a
couple of months ago and it's just
beautiful it's got like the 17 inch
screen in the middle of the the car it's
like having a macbook pro turned on its
side in the car and so you get all these
like fancy diagrams and you can you know
you can surf the web at the same time
and all sorts of things like that so
that's probably gonna be a bit difficult
because obviously we using roars beep on
a like I said we need to keep the senior
are fairly simple and if we want take
things to the extreme this is the
Lamborghini revit on and this is the
kind of thing you expect to see in like
a you know Battlestar Galactica Viper so
it's got this really kind of funky thing
on the left which is where the
tachometer is these two lines which sort
of gradually go up to show you what the
engine speed is and it all shows also
shows you in the middle what gear you're
in so that the lines sort of flip up as
it changes gear and then you've got the
sort of conventional gauges that tell
you things about like oil pressure and
stuff like that I don't know what the
display on the right does
like some kind of weird display and
they've kind of got this a steering
wheel thing that's like some sort of
driving game at the top so I didn't
really get a lot of inspiration from
that one so what I came up with was ok
let's start with a simple kind of way of
representing data and this is what I did
simple bar chart which just shows you a
value so you can quickly glanced at it
and see roughly what the value is and
this is this is nice because it's only
three polygons or three nodes in your
scene graph so you have a polygon that
represents the rectangle round the
outside you've got a rectangle that
fills the the value in the current value
and then you've got a line which you can
use to show where the maximum is that
you've got to on a particular run labels
are optional so clearly if you want to
put labels on that's another two nodes
but you can see that it's a nice simple
design it's clean enough that you can
read it quickly so you don't have to
worry about trying to see complex
interactions and so on and so that was
what I came up as a basic sort of idea
and then from the user interaction point
of view it's like okay we don't want as
I said a complicated way of doing things
if you've ever tried programming your
satellite navigation system while you're
driving that's really difficult because
you're trying to concentrate on two
different things at the same time I
wanted to make it as simple as possible
so I came up this idea let's just use a
sequence of screens let's not even
bother having a menu because menu go to
sign kind of look which one you want
you've got to try and figure out where
to put your finger on the menu so let's
just go for a set of screens and we'll
loop through those screens so every time
you touch the screen it changes the next
one next one next one and then I guess
the only goes back to the beginning that
way you don't have to think where to put
your finger or you could do is just
touch the screen anywhere and you change
to the next screen as long as you keep
the number of screens fairly small it's
a nice straightforward way of
interacting one thing you do have to
remember is that for all of the
components that you're using you have to
set the mouse to be transparent so you
set up the mouse handle it to use a
rectangle which is your background
and then all of the components you put
on it you make the mouse transparent so
the mouse events go straight to the
background and they can be processed
there so you're not having to worry
about handling Mouse events in all the
different components so this is the kind
of screens that I came up with so this
is my splash screen and I had some fun
with this because I what I did was I
photograph the the splash screen that
you get on the infotainment system in
the the Audi at the moment and then i
photoshopped in duke with a raspberry
and the java logo not sure what he would
think of this but it's you know it's not
a commercial product so I don't really
care then I felt right let's have some
basic data which is the kind of stuff
that you can read directly from the obd2
interface and so I thought right let's
have five different values you know some
some interesting things that you can see
so we've got on the left engine load
we've got the temperature the air intake
temperature you've got the catalyst
temperature so you can see how what
temperature's going in what temperatures
coming out the throttle position and
then the fuel pressure so you can see
how much fuel is being injected into the
engine at any given time then I thought
okay we'll have some advanced data where
will repeat the throttle position will
also include the engine speed a game and
you can see that on the tachometer but I
thought it'd be interesting to see that
as well and then we'll put the talk and
the power output so that you can see
what that's doing at the same time so
you get a kind of feel for how the
engines progressing and then I came up
with this sort of display for the
g-forces we're basically are you set of
concentric circles each one represents
half a G in a given direction so up and
down is forward and back left and right
I'll fell enough left and right and then
the one on the right gives you the
vertical acceleration so as you go over
bumps you can actually see it moving
around and so you've got a yellow dot
that represents the current acceleration
at a given point blue dot on the right
hand side and then the green dots give
you the maximum that you've got to in
that particular direction for a given
run so you can see I made this data up
so you can see that I'm
as you get was that one and a half just
over one and a half g in acceleration
that's actually a little bit optimistic
I think so then I thought right let's
put some graphing data in there so we
use the charts that you get in javafx
and so I just had there's two graphs I
created one for throttle position one
for power and then you can see over time
how your have the values vary and
clearly that gives you a really
interesting picture of what what
actually happens time a couple of one
thing to mention about javafx charts a
lot of things you might want to change
actually you have to do through CSS
style through CSS you can't do it
through method calls so for if you want
to use a black background you need to
change number of things so that they
look correct so it's things like the
axis the tick marks the minor tick marks
the background alternative row fill and
things like that so you just have to set
these colors so that you actually get
something you can see on the screen from
a design point of view I figured okay we
use the classic model view controller
approach so in terms of the model we've
got a sensor which represents a source
of our data that has two subclasses that
we've got an acceleration sensor and
we've got an obd2 sensor and then from
that we can create instances of the type
of sense that we want so if we're using
the real information then we'll use
elm327 to represent the obd2 sensor we
use an mpu 9150 to represent the
acceleration sensor but if you want to
do things like simulation then what we
do is we just created a different
implementation of that sensor class and
that makes it very simple to change to a
different source of data input versus
using the real one so that was the thing
i came up with for that I mean engine
performance is where you just combine
the data from the accelerometer and the
obd2 sensor to give you talk and power
the view design again just using the
standard sort of sub classing so I came
up the idea of display superclass which
just puts a title and a bot
around the edge and then lets the the
subclasses do everything else so you've
got your basic display advanced display
and geforce display and then for the
graph display that does a little bit
more sort of super classing and then you
have your throttle graph display and
power graph display subclass from that
and then in terms of the controller
basically you've just got a one class
acts as a central controller each of the
displays registers for events coming
from the different sensors so you say
okay I need the date in my basic display
I just need the information from the
obd2 sensor from the advanced display I
need both information from the engine
performance and the out the obd2 sensor
g-force display uses accelerometer and
so on so it's a nice simple way of
organizing things so you get a sort of
good structure for your application code
just briefly mention about the idea of
using other buttons and things in the
car I didn't really get very far with
that I had wanted to do more with that
and certainly going to try and do more
with that when i get home but one of the
big problems is that funnily enough car
manufacturers are not keen on letting
you know all of the secrets of how their
systems work because you know you might
do things which are considered bad so
you can't find a nice definitive list of
these are the canvas ids these are the
messages that get sent you basically got
a reverse engineer everything from the
information you can get from the the
obd2 interface so the own 327 has a what
it's an ATM a command which literally
just dumps all of the can bus
information as it's flowing across the
bus and then you've got to try and
figure out from that if you press a
button what's the one message that's
different that represents the button you
just pressed from a bunch of numbers so
it is possible but it takes a lot of
time and a lot of effort so there's
different ways of doing that in terms
once you've got the information you need
so just before we get into the demo a
few things about future ideas some
conclusions and some resources I've got
a bunch of ideas for what to do next so
one of the things I think would be quite
fun is to actually link heart rate
monitor
to the system so you can see as you're
driving you know what does your pulse
rate do and see you know how much
adrenaline is going through your system
it would also be really useful to
integrate some kind of gps receiver so
you could track the plot the path of
your driving and then map that to you
know the g-forces so you can see ok I
went around this roundabout and that's
how much g-force I pulled game around
that roundabout I also have the idea of
doing a heads-up display because some of
the more modern cars now you actually
get a heads-up display we project things
like the the speed of the vehicle onto
the the windscreen and so I've got some
ideas about doing some things with that
definitely like I say I want to
investigate more the can bus signals get
more interesting information like brake
pressure steering position something's
like that maybe even send commands on to
the can bus it seems very scary one
other thing that I found fairly recently
this is a little bore that you can get
which plugs into the GPIO pins on the
Raspberry Pi and essentially allows you
to talk directly to the can bus so you
can you don't have to use the elm327
interface you can just use this and
comment directly into the the can bus on
the car and again it handles all the
protocol at the low level and does that
kind of work for you one of the things i
need to check is whether i can still get
the i squared C to work so I can get the
accelerometer and this working at the
same time so there's a few things to
check with that resources obviously audi
calm good place to go if you're
interested now he's raspberry pi dot org
javafx oracle com and i've been writing
some blog entries about this on my blog
blogs oracle com / beat java i haven't
had a chance to write up all i've done
since in preparation for this but i will
be doing some more entries when i get
back i have time to to actually write up
the work that I've done to get this
finished for java one so let's just have
a quick demo because young got a few
minutes that's good so what i'm going to
do is
so long as I apologize for the hit the
poor camera work I couldn't afford a
professional cameraman what it's just a
sort of it's about three minutes and it
really just shows the box in action in
the car and so I'll kind of talk you
through what what happens as it goes
through so that's going to put that into
screen and see if that'll work good way
okay yeah so basically we just sort of
starting off this is in the car park at
our office at Oracle and you can see
that this is the basic data as we sort
of pull away you've got the the
different values changing obviously
things like the air intake temperature
is not going to really vary that much
catalyst temperatures not going to vary
that much although you find that does
drop because the cars been sitting for a
while so the the air under the bonnet
had actually got quite warm it's going
just off around about here and then
we'll switch to the more advanced
display there you can see the tower
talking the power only as you accelerate
because obviously if you start breaking
you won't get values for that then we're
looking at the g-forces on the car so
what would do now is will actually come
up to a roundabout and then we'll go
round the roundabout fortunately this is
in an industrial park so you don't have
to worry about the police so there we go
so you can see the accelerometer like
swinging off to the left as we pull
almost 1g on the on the left-hand curve
and then I'm pulling try to pull away
reasonably sharply there so we've got a
little bit of acceleration and then
that's the the throttle position graph
now anybody spot the deliberate bug in
my code see that a bit where it dips
down that's supposed to be actually a
lot more positive and I have no idea why
there's something to do with I haven't
quite figured it out yet something do is
signed and unsigned numbers happening in
the the protocol and once it goes over
50 it goes negative and I just haven't
figured out what that is yet this is
where I we go for a bit of an
acceleration run so is a little bit
blurred I'm afraid but so now we're
trying to see how how fast we can
accelerate so that's sort of what was
that about half a gee I think and then
again just looking at the
the basic data or that's the advanced
data again so as we pull away you get a
bit of changing the power and the talk I
still need to go back and check the
values that I'm getting from the power
and talk to see what kind of whether
they are realistic or not they're going
what about power coming out of that and
reason about engine rpm as well I'll
think that's probably yeah yeah and then
that's just under braking so we get
about half a G under braking and I think
we're almost at the end of this now so
it gives you an idea of that so we go
around corner again and I think that's
probably about it yeah ok yeah there we
go don't use anything else or are we
yeah oh yeah nice little spike on the
power graph there ok so the other thing
just to show you one more thing or two
more things actually so as we were doing
that run i also got it to write all the
values from the sensors out to a file on
the SD card so then what we can do is
obviously we can say ok well let's take
that information and then play it back
so we use the simulator as a data source
rather than the actual sensors
themselves so if i run that if i run the
the server and then run my application
on here hopefully this is going to work
so i've been having all sorts of goodies
object input streams drive me mad you've
class not found errors so what this is
doing now is it's basically just playing
back the information but i recorded on
the on the run so we can see that we've
got the same kind of data that you saw
earlier obviously as we go through we
can see different values changing that's
the advanced data we've got the
accelerometer that's sort of bouncing
all over the place as we go through the
different things got the throttle graph
well this actually was really
interesting to me
it turns out use the throttle a lot less
than you think I thought it would be a
much higher than that because but I tend
to only driving around town expose on a
race track it would be different but
driving around town you don't tend to
use the throttle a lot so it tends to
stay quite low in terms of the position
and then you've got power graph here so
you can see I think I've got the scale
wrong on that one i hope i've got the
scale rock on that one and then to make
it simpler to get out of the application
i just put a whopping great button in
the middle because i found that if i
didn't do that i couldn't actually get
out of the application and then i
couldn't shut the raspberry pi down
cleanly so i had to put that so then
just the last thing I'll show you if I
just run this again what we should be
able to do you know you should move that
it's not showing something yes okay so
of course the way that I've designed the
the simulator is just use a network
connection so on my laptop is just using
a loopback driver to send the data from
the server to the the application is
running on there but because I'm running
the application on here I've just got a
network connection to there and then I
can just use my laptop as the server for
the data and then project and use the
application on on the on the screen so
if i run this it will just take a few
seconds to start up
there's a few different bits and pieces
it needs to start up so yeah simulation
game good that's good so far so good
what do we got anything you hold it up a
little bit yep there we go so that's the
splash screen and then hopefully yeah
there we go we start to see the values
change and then if I wish ignores the
first click of the button of the mouse
so you can see that i can change the
display there with my finger and
hopefully that will change yep there we
go get the g-forces and we get the graph
and okay look nice power speak spike
there and then exit okay so I hope
that's been entertaining I hope that's
been interesting about how you can use a
Raspberry Pi in your car we've got like
maybe 30 seconds for questions anyway a
question</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>