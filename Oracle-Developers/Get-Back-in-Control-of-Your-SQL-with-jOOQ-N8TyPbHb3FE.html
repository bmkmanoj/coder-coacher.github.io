<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Get Back in Control of Your SQL with jOOQ | Coder Coacher - Coaching Coders</title><meta content="Get Back in Control of Your SQL with jOOQ - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Get Back in Control of Your SQL with jOOQ</b></h2><h5 class="post__date">2015-06-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/N8TyPbHb3FE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay welcome everybody to my talk about
getting back in control of your sequel
with Duke
I'm afraid this room is a little bit
cool so I get I hope you're warm and
cozy still nonetheless okay let's get
started so a little bit of a myself
first
this is meet Lucas I'm the founder and
CEO its data geekery the company behind
Duke and I'm personally very much of an
SQL at fiction Otto and a Java ethics
UNIDO and I personally believe that
sequel is a device whose mystery is only
exceeded by its power so most of you
people probably agree with that one so
today we're going to really talk about
sequel and this is a kind of an
exceptional talk and at JavaOne so I've
also attended at Oracle OpenWorld where
pretty much everything is about sequel
this is one of the only people talks of
jawans from what i've seen so sequel is
a very corporate topic you know and
because it's a corporate topic I want
you to read this legal disclaimer the
safe harbor statement from our company
please read through it we throw it
carefully
yeah we take this business very
seriously as well all right so if you're
missing anything I put the slides in
slide share you can look it up no
worries on so secret Java have a long
history and in theory this is what the
history should be like and I'm gonna use
this metaphor throughout the talk of
today you can think of Java as the
consumer of sequel and sequel is the
data kind of like the plug so you you
can put the jack into the plug and the
electricity is the data right so I'm
today I'm gonna kind of show you this
metaphor and in my talk and how it
should be these are European checks so
typical German Jack's I'm from
Switzerland I'm facing this problem here
because Switzerland is not in the
European Union it is not part of this
whole community who is using the German
check or the standard Jack in Europe and
you in the u.s. have very different
Jack's as well so this is practice not
theory right and this has also been
displayed in Java so Java from the very
beginning started out with us with a
standard called JDBC which was derived
from ODBC and it was a wonderful
standard it was a wonderful standard in
way that if you if you thinking if you
put your mind in back into the time when
when when this was conceived in in the
90s and Judy gave one point one their
work millions of data bases or maybe of
dozens but there's so many databases and
they all work very differently sequel
was only just standardized so sequel as
the language itself wasn't well adopted
at the time and those people actually
conceived an API that works with all of
those databases so this is a typical
JDBC statement where we have a
connection and we'll create a prepared
statement from that connection it's a
very easy sequel string and we can bind
variables to it and then execute it this
will give us back a result set right and
we can iterate over the result set and
display the results so this is a very
easy and clean API who in here loves
this easy and clean API lovers couples
them yeah all right it works ok that's
the right answer it does work the naked
truth and I'm always going to use this
naked truth metaphor as well is this one
here and I'm gonna zoom in on that one
because it's a little bit small this is
how real-world JDBC usage might look
like and I want you to participate today
in this talk so there are a couple of
bucks in this example notably it's six
bucks I want you to discover the six box
for me and don't put your mind too far
away it's very obvious everyday six
bucks that are appear when you're using
JDBC there is a space missing from the
first one so which line do you think
this is zero for should have a space in
front of the front can still see this
that's kind of I'm playing around with
this PowerPoint I'm supposed to be able
to zoom and type at the same time it
isn't work so let's just continue with
the latest laser pointer so I'm here as
you said correctly there is a space
missing why is the space missing because
depending on the value of is account we
might have this space or might not have
it
exactly so there is a syntax error
supple that you only run into in
production or when you run this code
very good
if the indexes are one based or zero
based so a good point there is something
about indexes but that's not the problem
so in JDBC indexes are one base this is
a very weird thing actually it's a bad
it's not a bug it's a feature if the
value is null then the first one doesn't
exist so exactly so if if the value is
false here if is account is false then
we don't have this bind variable but we
don't take into account that that one of
the binding my variables might be
missing from the sequel statement
correct very good okay that is correct
that is correct third part we have here
a bind variable that is inlined into SQL
and this is completely wrong in two ways
first off sequel and Jack is incorrect
so we were execute injection if this is
user input well we can't trust it
actually we can't trust any input we
should always sanitize our input and use
bind variables the second issue is just
random syntax error that's not as bad as
a sequel injection vulnerability but
this should not be done like that very
good so we have four bucks so far two
more anyone there are less obvious I
have to say
the account of our quotation marks you
mean as in string the limiters like here
that one this one here the double no
they're correct actually but it's a good
point because this is also why gdb more
people don't like JDBC you have so many
strings all over the place you never
know if this string is actually Java
string or a sequel string or whatever
kind of embedded string in something
else exactly but it's not about here
there's no bug in this code line 10 what
we have in like them on line 10 set null
why would you do set no no it's a zero
it's the value zero no that's what about
right I don't know it's close to results
that are stupid so do we have resource
leaks here this is a kind of the kind of
code that you would write prior to Java
7 or JDBC 4.1 so with Java 7 we have to
try with resources statement so this
problem is probably a problem of the
past but I've been working on legacy
code Java 6 so this is already legacy
but people obviously still use Java 4 as
well so I'm surprised to hear that but
then in that case you have to do all
those try finally and close and null
checks and everything and this is not
being done here so this is indeed about
not just me being lazy for presentation
question marks
they are they are question marks are
parameters that's correct line 14
exactly few people actually catch this
one this is very supplamine 14 we have a
variable well a column named text but it
is renamed in lines in line to two txt
some junior probably thought oh come on
this is better name right I call it txt
and the loop breaks this happens all the
time right I'm going to resolve the last
one few people have ever known this I've
had to talk a couple of times and I
actually ran into this bug in production
once there is a memory leak in this code
and you don't see it because it was
introduced kind of with j-b c40 and java
six Phillips Phillips arrays and these
types have to be freed explicitly so in
this code here it might not happen but
when you allocate a bill of in a
transaction it's out listed transaction
depending on your database configuration
so lops they have their lives of their
own and funny enough the free method is
called free and are closed so they're
not auto closeable and anything so this
is a new method in Java six that you
should call always when you really fetch
a seal off or we love if you fetch this
as a string some JDBC drivers support
this they just give it a string and then
they do this internally this happen with
Oracle database actually so let's
continue these are the six parts I think
you get the point
JDBC is very hard and what most JDBC
developers think of it is kind of like
this so I'm going back to the
electricity metaphor this is much more
or less what you're actually doing when
you working with JDBC it works but to
make it work you have to kind of plug
all those cables somehow and tweak them
and all the time it's error erroneous
and the dangerous and everything and
inefficient but people try to hide JDBC
so this goes on in the history of
Sakhalin Java people try too hard to DBC
and they invented a lot of interesting
things though
this is the technology I personally also
had the pleasure to work with so who in
here knows this technology and
appreciates it
yes couple of you I'm looking at the
version number here right so yeah
sarcastically so you can raise your hand
then as well the idea here was most of
the work is actually boring right Waseca
most of the work is insert update delete
and you always type all those sequel
statements and they're all the same
right do you fetch by ID you modify you
update you don't want to actually do
this work all the time so the idea
behind entity beans from the very
beginning was you don't have to do this
you just magically set the text on this
customer request object and somehow
declaratively depending on how you mark
model your entity beans and your your
session bean contacts and your container
and everything they're persistent and
that's wonderful once you're using this
API that's wonderful
implementing this API has have been
harder because of various things like
for instance the implementation not even
implementing the API I don't know if you
guys remember this but if we worked with
that but usually Java classes implement
interfaces not here they're not allowed
to implement them they're actually
implemented by proxies and everything
though this is very hard stuff and one
of the the real naked truth here is this
one so I don't know if you guys know how
to configure something like that I'm
assuming in here a little bit and this
was an actual project I was working at
in a previous employer so this was an
entity bean configuration in a WebLogic
server and I'm gonna bet with you that
all these numbers were wrong I actually
wrote this and I copy pasted from some
other entity bean I thought what is this
max please and free pool right okay so
okay do I need 100 for this work I don't
know should I use 2,000 this will create
a memory leak or something huh you know
I don't have enough I have a bottleneck
because only 100 users might actually be
able to access this database at the same
time so I don't know how this works this
is so complex and this is only a little
part of the health old story so in the
end
I was kind of like this right so I'm
just trying to do it and get it to work
but the history continues entity being
solved the problem that was actually a
problem I don't want to type all that
stuff all that Seco when it's about crud
and Egypt b3 came along and JPA so I
skipped the history that came before was
hibernate and toppling and all those who
are ramps that got fusion into the
standard in the end we got the standard
which is called JPA and we have now this
very easy way to interact with the
database so we just create objects in
Java like these events and we persist
them directly on some entity manager
within a transaction and then we can
fetch them again with a simple query
language so we have these jpq our query
language here we can fetch them and add
access properties from them so we don't
even know what's going on under the hood
so we have all those queries that
actually are executed to implement this
logic here the naked truth from my
perspective here is going in this
direction and what we have here is a
couple of annotations so these
annotations actually declare out the
implementation that is behind generating
those queries that we need to actually
do the implementation of the logic that
we've seen before
so what we have here is very simple
example and with a couple of annotations
already that are needed but annotations
they go on so here we have more general
use case of what we're actually doing
with JPA so who has seen this and used
this join table chong kham inverse
whatever this is almost writing sequel
right but it's not sequel it's
annotations you're actually writing the
joins like this and you have whole
graphs and they're hard cord it onto
your this is from a stack overflow
questions so this hardcores on this
collection dealers and you can never
change that easily because you don't
know what's going to happen if I don't
know 50 consumers of this collection
will actually run these queries and
what's gonna happen to them and lucky
enough I've been in touch with the with
the expert groups for JP a3 so I can
provide you with a preview of where this
will actually evolve so the preview for
each of e3 I'm going to show it to you
exclusively today this is an example of
the documentation I'm gonna spare you
either before yeah I mean JP a for now
this is probably not not exactly true
but I'm still at the same fork right I'm
I'm a sequel person I love databases I
love relational mo I'm sorry about this
this is I love the relational model I
have no clue what all these annotations
are doing right your mileage may vary
but mine is like this and what JP really
means for developers to go back to the
electricity a metaphor is this and it's
super powerful I mean it can solve a lot
of problems so if you're really if your
problem is really loading this object
graph with 50,000 different entity types
and then changing them all in memory and
then you don't care about the order of
insert update delete you probably don't
care then you can just persist this and
this is wonderful but most of the time
your problem is actually this right most
of the time that's all you wanted to be
solved and you remember from the history
you don't want to work with JDBC and one
interesting aspect in all of this is
this is Gary King and I once chatted
with him on Google+ in this case here
and he came up with this sentence so I
don't know if you know a Gary King is
just in case he was the creator of
hibernate but apparently people never
listen to him they thought okay we have
now Harbor net forget about all the rest
we're just going to use hibernate for
everything but that's not the point that
was not his point and it's not going to
be my point today either I mean the
other way around is wrong as well
so but what did people think after they
thought okay now if you guys I don't
know if you guys agree with this or not
but people started thinking Oren's are
bad and one of the movements in recent
days was actually okay maybe this is
because signal is bad right so we go do
no cycle
so should we do no sequel and this is
also all about scalability and
everything so these are all these whole
terms these buzzwords
we're here at JavaOne
if you've been at Oracle OpenWorld you
hear all about big data and IOT and
whatever so should we actually do no
Seco to scale
who said this please read this quote
this is about scaling anyone knows who
said this this is from mark Daniel he's
the creator of Salesforce he runs more
than 200 million transactions per day
and that was in 2009 so Salesforce has
grown a lot
in that time and he says that about his
using Oracle database and if you've
heard Larry's Larry's keynote he's
actually very proud of Salesforce being
competitor and everything but they're
using Oracle database right so they're
using Oracle database to scale and mark
when you've actually invented the cloud
and he is still using this old
technology I'm gonna show you another
example so this is about a customer from
some database vendor and they produce
tons and tons of data in various
parallel databases backups distributed
everything I don't know if you have
these kind of data problems probably you
don't I have never had them so who dis
this refer to who does this refer to
anyone knows this is CERN and CERN is
one of our higher greatest custom so
today I'm not doing an Oracle sales
presentation other databases are crazy
as well they can do the fancy stuff as
well these are just two examples of
really really big data usage with a
relational database so what if the
aspects when you always hear people rant
about no SQL like the life like me
people are in favor of SQL rant about no
I scare you see all these arguments not
asked it not typesafe no standards no
tool in guava and these always the same
stuff but I want to tell you one thing
today from my experience that you might
not have thought about there is this
aspect here have you asked operations
when he chose to switch to no ask
because operations are first they know
we're still they have known as go
forever
ESCO was designed for operations I mean
you just have to select from where how
hard can it be no one touched these
really fancy sequel queries I mean these
people don't type those fancy words but
they type the simple queries and they
can actually tweak the productive data
or the sequel they can tweak it directly
on productive systems because they know
how to update you know what Italy and
you know how to maintain your system the
system that you develop design so when
you're switching these databases to the
proprietary format like something like
MongoDB or new 4j they all sit at the
oil filter purpose but they're all very
proprietary and people don't know how to
operate them I mean it's very easy for
you to develop with them you understand
them immediately and it suits your case
but the application might live about 10
years and you only see one year of that
and they will suffer so the big cost is
in operation is not in development so
you have to keep you know this into
account and to finish this up this no
SQL rant a little bit of history of no
SQL right uh-huh
so this was seen at O'Reilly strata
Kampf this was Mark Madison who said
this and it was actually about sickle
and Hadoop so this is also a very bright
buzzword at Oracle OpenWorld Sequoia
Duke sequel so we're going back into the
topic of sequel now all these storage
stuff and how it operates let's forget
about that let's focus on the language
again the language is actually really
good no matter how you store your data
and we're gonna show you a little
example of how to use sequel
let's calculate a running total a
running total might be in this example
we have a couple of transactions in your
database where we keep accounts
transactions so we have a couple of
accounts transactions in your bank
account and we might not have the
balance so this is the balance but we
might not have stored the balance in the
database so we need to calculate it and
how we do we do calculate this we
calculate it with a running total
so ironic total is actually a toll that
is just generated on each row running
down the road more or less so you can
imagine the first balance is equal to
the balance below it plus the amount a
side to it right and the next balance is
the same this whole operations just runs
through your result set and in the end
it's actually like an Excel spreadsheet
more or less so you have a function
balance row of n equal to balance row n
plus 1 plus amount of Rove and this is
when you go downwards you can also go
upwards with the second formula
depending on you whether you know the
current balance or not you can go
downwards or upwards depending on what
is faster and how would you calculate
this window functions yes very good very
good few people say window function when
I see this but this is the absolutely
correct answer don't pull the result in
Java they calculate it there you have a
lot of network traffic just to calculate
something that Davis can calculate very
easily like this you see who knows this
syntax in here a couple of you so please
regardless of the rest of the talk this
is really something I want you to keep
in mind window functions sometimes also
called ranking functions or analytic
functions in Oracle are something really
exciting SQL so they were introduced in
SQL 2003 in the standard and they're
implemented in pretty much every
commercial database and Postgres and I
think Firebird as well so if you're
using a commercial database or Postgres
you have all this tremendous
functionality that you can use and if
you look at it more closely how it works
it's actually very simple
it uses all these keywords right
wonderful as well as all of our keywords
so let's discuss how it works in detail
first off we partition the result that
we have from the from clause so before
we had a query we run all this let's go
back to the query itself
we have this front class in the where
clause this
gives us a result set in memory more or
less let's pretend it is already memory
database might optimize as it wishes but
let's pretend into memory so we have
this data source in memory and now we
partition it by a counter D because we
want to calculate the running total for
each account we don't want to mix
amounts between accounts right we don't
want to see what the neighbor earns so
then within this result set in memory we
order it we can order it again in this
window function outside of the select
from where order by clause so we ordered
differently in this case it's ordered
the same way as the query so we ordered
by validate and within the date we
ordered by ID to have unique ordering
and then we just say ok given this order
and the partition we're going to take
only the rows between unlimited rows
backwards and the preceding row and then
what we're doing is summing this all up
so essentially we're doing this if you
take the balance that is white here at
the bottom we take that one that is
calculated by the top balance minus the
sum of all the better amounts that are
on top of this row given the ordering so
this is actually very easy to understand
if you think of it conceptually you need
a couple of keywords as a set so all
these keywords we have a why I
personally am started to call this
Stockholm Syndrome
they chose actually to use some weird
language syntax some people prefer C's
there have a lot of keywords in C cool
but actually it's the same as method so
you can think of keywords as methods if
you have an API it's very clean other
people probably think the syntax is not
as good but I'm giving you a quote by
Winston Churchill you're stuck anyway so
better use sequel right so this is a
sequel and well more sequel calculations
this is an example I always show as well
so we have
the most popular database abstraction
framers this is a fictional quote pole
and we have a ranking so we calculate
again the yellow columns are again
calculations we calculate the rank of
each database abstraction framer
and the percent of people that voted for
it so the rank is very easy to imagine
we just order all rows and give assign
them a rank and the percentage is
actually also very easy we just take the
number of votes divided by the sum of
all the votes in the whole result times
100 and then sequel we would write it
like this so this is dense rank I'm
using dense rank here or rank they're
both very similar this is a ranking
function and are really again I've
stressed this look this up after the
talk go download Postgres and use all of
this for free try around play around
with these window and ranking functions
analytic functions they're really
wonderful and you don't you see a group
I here you can aggregate all sorts of
data without group I so we have this
ranking function we ordered by the
number of votes and then we get direct
that's straightforward right and then
for the percentage it's a little bit
more complicated here I did some string
concatenation to have two percent value
as well so if you remember I'll have a
percent sign in each column you can
argue if formatting should be done in
the database or not but for the matter
of the example I did it in the database
and I take the number of votes of the
current row I multiplied by 100 and
divided by the sum of votes and then you
see this over without any partition by
order by whatever so you can also leave
over empty and the syntax cloth and then
it will just sum up all the votes over
the whole result set so when you see the
from and to where here that produces
this result set and if over is left
empty then I'll just take the whole
result set and take that some kind of
like when I group aggregate so today we
want to talk about equal and dukes well
so Duke the idea behind Duke is really
you have now understood how you want to
express your query so you have your
query your question to the database and
now you want to tie
right you want to execute this in your
Java code and there should be no limits
to you typing this right away in terms
of productivity this is why Duke looks
like this
so Juke is an internal domain specific
language in Java this means we've
modeled all key words of the Seco
language as methods so every keyword as
your encounter is one-to-one a method in
Duke also all the functions are methods
and when you have tables like let's zoom
in a little bit to the details when you
have tables like this pull options table
it's an object it has methods as well so
all the keywords that come aft after a
table are methods on the table object
and if you look at this peephole RDP is
also a table I Elias the table not in
this example it's outside but I enlisted
and I can do reference columns from this
object columns are also objects and it's
domain-specific language so to really
understand the point of this API is we
can go back and forth and see you
started with this you have this in your
mind and you want to just type it and
it's exactly the same almost if you see
if you've watched closely concat
obviously can't be modeled directly with
the double pipes so if you have sequel
comp head here this is not possible in
Java but it is in other languages like
Scala who in here is using Scala some of
you in Scala
we have symbolic method names so we can
actually model multiplication division
everything with the actual operators you
don't even know that this is a method so
you can model the sequel statements
directly in Scala with Duke if you go
back to the original one that looks
almost the same
right so Juke really if you go back to
this electricity metaphor it's just this
little piece of glue that you just need
I mean if you've traveled you probably
bought one of those adapters right and
between Java on sequel all we need is
this adapter so just to be sure you get
the message a little shameless plug here
okay
if there are no question right now I
would like to show you a couple of
examples this is probably best all shown
by example unless you have questions
right now exactly so the questions about
the aliasing and I'm going to show it
right by example okay it's but it's
probably also best shown by example this
one yeah you have to extend I think I'm
gonna show it but yeah okay it's
actually a bad idea to ask a question
before it sounds because usually all the
examples are going right away so let's
start with the examples but it's a good
question of course and I'm glad that
you're so curious about that so here we
haven't oh yeah only I see the examples
that doesn't work better okay so I'm
using eclipse here you can use IntelliJ
or NetBeans or whatever if you using VI
then you're only getting half of the
value of Duke so better use an IDE and
you'll see why immediately so here we
have this I'm using here an unit test to
actually show this okay so we have this
actor object here and the actor is a
table in the circular database so so
Kela is a freely available database from
mysql with the GPL license test database
you can operate on it it is very simple
to use I have it I have a ported version
to Oracle here it has tables like actor
and films and Association tables film
actor it's very easy to use and to
understand it has
all sorts of relational concepts already
built-in so you can really just try
around play around with your database of
skills and what actor is here actor is a
table so I have this whole list of
tables in this table class so I have the
whole set of tables from the database
generated it's Java objects so there's a
code generator that goes to your
database it connects to your database
and reads out all the meta information
and generates objects from that it does
that for you because this is really the
tedious part that you don't want to do
by hand and you'll see right afterwards
what the advantage of this is so here we
have an actor object so this is just
listing or referencing all the tables
which are actually classes and if you
look at the actual table class when we
have here on the right hand side is
actor ID first name last name and last
update so all columns are actually
members of this table object and if you
see closely if you watch closely this
first name for instance it has already
the string class associated with it or
the last update column it has the
timestamp property associated with it if
I manage to move over here so you
already have all the type information
associated with all the tables and
object and columns as well there are
other types of objects that are being
generated for instance I'm using
Oracle's so I also have stored
procedures support here and usually
defined types and many more so we'll get
into that in a bit let's get back to
this example and I'm showing afterwards
right afterwards the aliasing first I'm
going to show an example without
aliasing what I'm doing here is just a
type actor first name actor last name
select this from actor and fetch when I
execute this it's very simple I can just
run this and what I get here in the
console is the standard debug output
because this is something we've always
thought JDBC should do better with this
but it's a JDBC driver implementation
detail which they actually
anything or not and some JDBC drivers
have advanced logging features but
mostly they don't then you have to pull
some external dependencies we thought we
want to actually have everything
included automatically with with
standard logging you should get started
very quickly so this the user that the
defaults if such a library should be
well designed enough to get you started
very quickly so when you start using
Juke you want to see immediately what
acts what what am i executing so the
first log output here is the actual
sequel statement and it is rendered in
an formatted way so you can really more
easily right so in the log output
sometimes you want to have formatted
sequel statements how much time did it
take so it took a long time because also
I'm starting the whole application that
will take a little bit less and
afterwards you get the whole set of
records that we fetched and we display
the first five records that seemed an
immensely useful for debugging so when
you start debugging your your
application you want to see what's going
on in your database of course you cannot
turn this all off because productively
you don't want to have that so we have
all these information and as we've seen
before now we have this query here and
it's very easy to continue typing this
query we just type of join maybe we want
to have the number of films per actor so
our top film actor and I can use all the
completion here why can I use auto
completion it's very simple I just
static import all sorts of stuff so with
these static imports it's also the Juke
tutorial that you should always start
out with the static imports then you can
just start typing stuff as if it was
actual sequel film actors so III joins
this table and now I get a compilation
error because I'm missing a clause right
so I'm missing this on class which I
have to provide to the join clause after
ID equal actor ID and now it compiles
again I can execute it no I wanted to
have to count right so count is just
count
and obviously to get a count I need a
group buy as well I'm just gonna copy
paste these two columns for now as you
see with all the German language
features like VAR arc parameters and
everything I can just type this as if it
were sequel so here I can just come and
separate the list of columns that I'm
needing and this works right off out of
the box so if I execute this count is a
function in one of the static imported
classes I will show afterwards I will
get this result here so select count and
group by as you can see and you see the
number of films a mu an actor has played
in immediately also in the debug result
so aliasing is an important topic if you
do advanced sequel you probably have
self joins or you have to join the same
table various times where you want to
model them in a different way so what I
do is just I are rename it with this as
method I can also inline this so I can
this is just another actor reference
it's an alias actor reference I can
reference it from a local variable or
not so I can inline it if I want what
I'm doing now is I'm just going to
replace all the actor references by a
references to renamed once and this all
still compiles the reason is when I
Elias the table I'll just get a new
reference the same table object but it
has all the members as well and the
members are going to be renamed already
so if I execute this now if I execute
this query what I'm gonna see in the
debug log output is in fact I have
renamed after table to a so if you can
see here I get a first name a last name
from actor a the joint predicate is also
renamed obviously you can't expect Duke
to actually detect all sorts of semantic
errors so jus can only or Java compiler
can only detect syntax errors obviously
so if you forget to rename one of the
tables if you have actor here that's not
gonna work at run
so this is only there a couple of errors
that still are runtime errors also in
sequel so if you type this kind of query
in the sequel developer probably it
won't notice either but it's pretty far
so you can go pretty far with the stuff
that you can discover for you so I'm
gonna show first off a couple of more
advanced examples here one example is a
union so I already did this some example
here we have actors customers and other
tables that have first and last name
objects to them first last name columns
and this actor table I want to join this
actor table to the customer table to
find all the people in my database let's
just say that this is a useful query so
I select active first name actor last
name from actor and I union this to
another select and the nice thing about
all this type safety and this is really
the essence of the of the talks de Cicco
is a very type safe language but when
you use JDBC you don't notice this if
you're using sequel developer to design
views and store procedures they will
compile and Oracle will tell you or
whatever you use in the sequel server or
some other database product will tell
you this doesn't work and I think Chavez
should tell you as well so if I add this
query here it doesn't compile
I remove the column so now I have a sub
select with two columns and the second
sub select with one and that's wrong
that it's not correct sequel obviously
compile-time at the Kabala message is
something about generics but at least it
said it tells you so also if I'm joining
if I'm adding the wrong column here
customer address ID or active header
study it still doesn't compile what
isn't it compiled I have in the first
stop select I have to string columns in
the second sub select I have a string
and a big decimal column now there are
some databases that don't care about
these things they do some type coercion
but frankly type coercion is always a
bad thing
because you never know what you're gonna
get in the end and this prevents
indexing from being applied so if you
have implicit type coercion it might
just be that your index
is actually converted to something else
and your predicates going on that table
won't work anymore because you don't
have that functional index function
based index there's a question yeah well
you can perfectly do that I mean oh yeah
I see what you mean
so if you do first name two times here
well let's put it this way so um the
database doesn't know if you're writing
a silly query right so this can know it
I I mean that doesn't that doesn't make
sense maybe that makes sense in your
domain I don't know in your business why
not oh it depends yeah some database I
know I know what you mean so the
question is can I have in subselect two
times the same column name and
specifically in sub select often it's
not possible but actually in sub queries
it's not possible when sub selects I
believe it is possible from a union but
I know what you mean so if you have
something like an impetus
or in it or a derived table then you
have to be careful that's correct but as
I said before I mean all the semantic
stuff can't be validated by your java
compiler for that we would need a Java
compiler plugin but this is not possible
this is only about types all right there
was another question over there I
believe no I'll just continue with
another example here so this was Union
and now I'm gonna show you something
that few people know this is a really
awesome sequel feature and it's called
who knows what this is called so this is
the sequel statement as it will be
rendered the whole statement what I'm
trying to find this give me our
customers who's first and last name
also in the actor table now many people
would probably write this with exists
but actually you can write this with an
in predicate yeah it's kind of a
subselect a sub-query but the
interesting part is and few people know
you can have and as many columns as you
want for you in predicate and this was
standardized in sequel 92 and I believe
it was not available in sickle not 86
but in 92 it was standardized a few
databases actually implement this but a
couple of databases implemented for
instance Postgres so you can write a
query like this with two columns and
then you compare the two columns or two
values with all the tuples of your stop
select but they also have to have two
columns so that makes sense it's
perfectly it's perfectly intuitive how
how this works and if your database
supports this you can just write row
customer first name obviously in Java
can't just type parenthesis it doesn't
have any meaning but I can't I borrow
customer first name customer last name
and row by the way is an optional
keyword for all value expressions so
this is why row was chosen and I can use
all sorts of predicate building objects
here so I can use this in predicate here
and create a sub select like actor first
name I'll get you right afterwards I now
mistyped it last name and then from
actor and this will compiler know if I
had forgotten about one of these columns
I would get compiled compilation errors
again so this will tell me you're in
predicate needs a sub select that also
has two columns of type string string
and this goes on and on the whole are
type safety is actually really baked
into this framework you had one
condition
about
good question so the first question was
what is the result the result is
actually a Juke object it's a result
object which extends list standard
dedicated list API so you can with Java
8 convert this to a stream and do some
for each or whatever so this is very
convenient and the second question was
what is happening internally internally
I prepared statement is created and
variables are bound and the results that
is open and with fetch the whole result
that is consumed because that's the
default what you want most of the time
you don't want to lazy iterate you want
to fetch everything at once you have you
disconnect from the database again and
have a cache but you can also might make
a run fetch lazy and then you get a
cursor which keeps an open result set
and you can kind of a lock with Java
eight make an actual stream of records
and and consume that lazily so I believe
we were close to running out of time is
that correct yeah I would then like to
wrap it up you've seen a couple of
examples I'm going to make this point
again once more who said this cannot I
will take the question of words okay um
who said this it's very something that I
want to help you keep in mind so all
companies benefit when they can afford
to focus on innovation rather than
infrastructure so if you've seen the
whole talk from the beginning you see
all of these caveats that you have when
you use those technologies that are not
helping you be productive with your
business domain you actually want to
write bank systems you want to write
insurance systems you want to write HR
systems you want to focus on your
business domain not on technology like
this so once you have all the technology
choices made you just want to write to
work and existing Java technology and
that the sequel interface keeps you from
being productive and who's that
this was a once again I'm really fan of
this book so I really can recommend it
again by Marc Benioff behind the cloud
and this is one of the ideas why he
invented the cloud you don't want to do
all this infrastructure work you want
infrastructure just to run this might
not apply to you but often it does and
if you don't have to worry about
infrastructure you can be much more
productive and this is also a point
where I recommend the second book I
really recommend this book to everyone
working with sequel so this is sequel
performance explained by a partner of
ours it's a very good book to learn
about indexing so there's actually only
one thing you need to know when you want
to have performing sequel that's in Xing
and this book actually has a couple of
very useful tricks and helps you
understand how they really work those
indexes and the book is only 10 euros on
the online and with the discount code
you get even 10% and it's really the
return on investment is huge so everyone
who reads this book I immediately
understand so if I knew this three years
ago I wouldn't have been bothering to
solve these problems for days so a
little bit more about the whole tool
chain about jook your question might as
well be how is Judas Trivedi seen before
there was a free trial version comment
in the sequel statements so joke is
actually an open source product so we
support Dube for free for free and open
source databases we also have commercial
licenses for commercial databases and
that's how it works essentially so you
can download tube for free and work with
it with the free Postgres database and
have set before and play around with it
and it will be apache license
yeah and that's pretty much it so i
invite you to follow the Juke blog and
Duke on Twitter and our newsletter so on
Twitter we are publishing a lot of
interesting insights in Java and C core
blogging from our partners from from
various different blogs in our own blog
we also publish all our findings so when
we develop Duke we have a lot of insight
in the sequel a lot of lying nice little
tricks we publish all of those we
publish all the tricks that we discover
with the Java API because the whole joke
API is quite complex
as a domain-specific language we also
discovered a couple of charcoal palette
bucks under way to generate them - we're
using all the features that are really
possible to actually implement Seco in
Java so so that's that and there's also
my personal Twitter account if you found
my jokes funny there's more jokes like
that lame puns and on the Twitter
account every day and a couple of rants
so that's it thank you very much for
your attention</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>