<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Unit Tests Don’t Break: Stress-Testing Java EE Applications | Coder Coacher - Coaching Coders</title><meta content="Unit Tests Don’t Break: Stress-Testing Java EE Applications - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">⤵</li></ol></div></div><h2 class="post__title"><b>Unit Tests Don’t Break: Stress-Testing Java EE Applications</b></h2><h5 class="post__date">2015-06-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/_l7OH7dxxy8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so welcome back some of you asked me you
are speaking all the time why and this
was actually accident so the whole
histories was I submitted my talks from
2002 2007 like crazy nothing happened in
2007 I submitted 10 talks one was picked
and this was at work twelves or three
years and last year I submitted for
talks and all were picked so it is
actually the reason why I'm speaking
here all the time right I will rather
attend sessions because the content is
great if I speak I don't learn anything
new except from your question so if you
ask me a question you get a t-shirt I
still have some tissues left but today
is my absolutely last talk so i have to
give them away because they are crazy
heavy as long really heavy and yeah so
um background to the session it is
nothing sophisticated actuary i will
show you basic things but what is
amazing these basic things are rarely
done in enterprise projects what I don't
absolutely don't get and at least for my
European experience it works like yeah
we have lots of how it's called HR
consultants I would say and they and
they and they care about code coverage
unit tests integration tests sometimes
what unit tests are the most important
test driven development or whatever and
what we all forget is that the software
runs on application server so what it
actually means unit tests tests the
application in a single threat but the
application will never ever run in a
single threat again so from my
perspective unit tests are rather boring
because all the problems which you find
with unit tests they're actually trivial
business logic doesn't work or some
regression if you if you encounter a
memory problem or or deadlock is a lot
harder to find such problems so it's
strange in my eyes then we've write a
lots of unit tests and we don't test
don't test why I call that stress
testing and not load testing so there
was a different term load load tests in
my projects were defined mostly by the
customers they say okay we have to serve
I don't know
100 take 100 customers or whatever and
the the load tests are realistic
realistic means they have they have
think time and all the stuff and what it
actually means you have basically almost
no concurrency because you're a think
time the G chances are very low that you
will hit one piece of code concurrently
and what stress tests actually are is
the attempt to break the application
server with heavy load which is
unrealistic so and the purpose of stress
tests is just to find out how it looks
when the application server is
overloading and we just increasing the
probability that we will find our back
with the increasing load this is the
whole idea of stress testing also a nice
story of actually funny some of my
clients they have your annually releases
of the software and the funny thing is I
get hired so once a year to help with
the performance problems and then they
have so called lessons learned meeting
so in the lessons learned meeting we say
okay what we can do and say okay could
you please test before a little bit
stress testing continuously with
ultimate everything yeah great idea and
we see an XE again what happens the
software is is successfully in
production they forgot about lessons
learned it happens three times in a row
really is a no kidding and if something
works they don't care and then testing a
unit test again and unhappy about code
coverage and forget again that we
actually have application server
everyone agreed so stress testing unit
tests are boring is a nice for green bar
what do you need we would like to see
what happens under heavy load the next
the next edit value' of stressed assists
in all of my project the discussions
stateless versus stateful we have to
avoid HTTP session so and I ask always
the question how big is your session no
idea they have no idea how big the
session is and I've asked the question
how many sessions we can handle so I get
answers like 20-30 300 something after
three hours meetings of course
they have to discuss the things and then
and our number act 42 comes out and and
so we stress test is incredible easy to
find it out just start you know 100k
sessions whatever make a heap dump lunch
a memory analyzer and you will exactly
see how big that the the the decision is
so the idea is again like in opinionated
Gervais seven avoid meetings proof of
concepts and measure measure before
premature optimization root of all evil
measure before optimize got it idea so
I'm forgot to introduce myself still
fool answer singleton German singleton
and I'm broken with Chavez 1995-1996 my
first tablet I brought in 1997 which
java web server and i still like java
are we like java the only problem I have
I only see problems in my projects
because I if I get high as usually
problems or so my my my my my stories
are rather dramatic but this is what I
see right so um and both books I
actually I think in this book i kiii I
performed a stress test and this is not
at all about stressors rather than how
to be pragmatic and three times a year I
do airborne workshops and munich airport
why because i would like to spend my
time in projects and not travel and in
give workshops or they come to me and we
do a nice workshops one day about
various topics so unit tests we cover
that absolutely boring but sometimes you
can do something with unit tests rather
than misuse j unit for integration tests
what we did in one project just just as
an idea we we wrote our our our own GRE
test runner and what it only did is it
measured the heap before and after this
the tests and printed it out in the IDE
so we used for integration tests not
unit tests in unit test everything is
mock out right for integration tests we
were able for some algorithm to see
whether we need more memory or not
whether it increases or decreases
actually a nice heck it was useful only
once but justice sandhya it is very easy
to write your own unit test runner
that's actually what Arcadian did as
well so why unit tests are interesting
because unit tests are usually not
written how they are intended in an pure
istic point of view a unit test has to
have just one assert I never did that
but this would be the perfect unit s so
my unit tests are very pragmatic but the
pragmatic unit tests can be used as test
driver for stress test this is the first
idea even better integration tests so
what is how to perform stress tests or
load test yeah if you if you start with
jsf you will probably achieve about 300
to 500 transactions per second own
machine if you hit an ejb you will be
ten times faster so if you if you if you
communicate directly with the back end
without the UI you will be able to have
I would say 5k transaction per second so
what I try to do is to skip the UI and
communicate the arrest with the back end
the problem is sometimes we just have to
you I and we don't have the restful web
services or whatever what you can do is
this is the first tag we learn today
create a servlet inject to the servlet a
test driver or your EG be a boundary or
whatever and right in the doget method
copy the unit S or integration test and
there this is your starting point of the
test driver okay it works perfectly and
then you have a very nice URI which is
simple and you can invoke the only from
outside I do it all the time okay one
problem is you would have to change the
contents of the war right because you
will have to put the servlet in a
production where is a very bad idea so
Anderson the next take is if you have
the war plugin there is one tank code
called attached attached attachment
something like attachment and what it
does is it deploys the war twice once as
a war
and the second time as a jar so what it
could do now is now you can create an
almost empty war with a single servlet
which refers to the jar okay you got it
and then this is all trivial so we don't
need lights for that right so
integration tests what integration tests
are is something like you you test more
than just unit in single unit you tests
more classes so there are even more more
interesting 4444 stress testing and like
aliens right though so a stress test or
there's another another level of testing
some called the integration tests what I
do in addition usually my java eight
projects i create system tests i think a
better name would be acceptance tests
but for some reason system is what it
means there is one maven jar project a
very simple maven jar project with only
consists of unit tests and the unit or
of j unit is not unit as Jared tests and
the junior tests are accessing an
application server remotely this are my
system tests and this is the ultimate
actually a candidate for stress testing
as a test driver right so why I have the
system test at all because i don't
believe that the embedded containers
behave the same as a stand-alone
container so I always try to test as
much as possible no realistic solution
if you are launching a bedded server
embedded container for instance they
have totally different class path and
and the configuration this is not the
production server got it so unstressed s
is just i would say out ok the next
usually I get the Getty response to to
my thoughts about stress testing yeah
you need a lots of planning and so forth
and what I do know planning the bestest
if you if you find a student which is
let's say to the student okay we have
here the hot via just take the hardware
and break the server
this is your mission just hectare server
this is the mission and it works really
that way and you will be surprised how
easy it is to break a server okay but it
shouldn't happen so what do you probably
will able to do in short this amount of
time to provoke some out of memory
errors because there is no pulling set
up north rhett pools in the max boo
sighs nothing yeah and agreed so and
what i would do i will start with the
login page or blogging system if it
works go further so not start with
everything just one use case per night
or something and the stress test is just
incremental okay if you have any
questions ask yesterday I will ask a lot
today it's not everyone agreed right
yeah no questions no t-shirts so why do
we need application service so this is
actually fan funny from my perspective
JT are tomcat or similar things are a
blight blind flight if you have web
tomcat or jet in production do nothing
just working with pojos you don't see a
lot actually nothing as well you are on
your own able to monitor the amount of
sessions the amount of do get to posts
and then nothing not even transactions
connection pool sometimes but you don't
actually you you don't know what your
application server is doing it's an
interesting part of java ee is starting
with j2ee 14 this is like nine in the
60s right so um 94 there was a GSR 77
application management and monitoring
and it is still there what it basically
says is all j2ee components have to
expose monitoring data and this is true
for jboss i think 44 glassfish two and
three and i think one as well be a
weblogic forever website forever it's
just how it is so and it looks like if
you have a gps they expose the data data
sources queues and all the things
exposing the data and this was even true
in jboss who's this trench the back
tation of the gemach sconce all from
from jboss which looks like and and
and set of links the first admin console
from Jabba's even even then you were
able to do to get the data so the whole
point of application service for me
yesterday I explained its simplicity and
today is operations I was in task force
of this Tomcat and and jetty there was
nothing nothing to no no data basically
there was actually no blind flight we
only saw the a number of HTTP session to
get the post was an application server
you would see number of transactions
number of robux number of the the
connection pulls matrix the depth of the
queue incoming queue thread pulls number
of a pair of ejbs min pull sighs max
full-size current size slow as method
average methods and and the fastest
methods this is actually basically and
monitoring of an e gb and what I what I
did is do this actually all applications
of F to provide us I I created a custom
solution perfect customer to access the
data and what we did we store the data
in a database in a table the idea is the
problem is if you are using something
like visual vm you get a chart but a
chart is transient so if you if you run
the test the whole night in the morning
you see nothing right because the charge
gets gets compressed and you see
basically nothing so the first idea was
to store as much as possible to a
database and the next morning we create
a very basic report which jasperreports
Burt depend on your customer and you get
nice charts which are really really
interesting ok so this was the basic
idea so how it looks like with glassfish
so on glassfish it has 48 48 is the
admin console but there is also here we
have domain server applications little
bit bigger and the nice story is this is
content negotiations restful service you
can go there and say I would like to
have Jason
you have to data as Jason or you can say
I would like to have it as XML so you
get xml and I deployed the application
light fish it could now say okay show me
the configuration store you see there is
only one active instance what it
basically means there is no no no
parallel communication with the instance
so there's only single threaded access
to configuration store it says induce
remove Congo's never you never removed
what it actually means no
systemexception happened what you see
was this stupid I would say was the
super data you can already get a lot of
information out so for me actually with
any application server since the 60s I
get real interesting data and it
provides a lot of information and for
stress test it actually means are we
testing the proper thing right is to EG
be was it ever involved right questions
regarding this in jboss the same and
Tommy has jay Meeks and Tommy will
expose rest as well soon and IBM and and
weblogic are the best so they have the
most performance data and IBM has even
integrated in the portal so are no
excuses there yes yes
yes and not on application server but I
build something i will show you about is
very easy to do Mustafa is very easy
with other technologies little bit
harder but very easy so um there are
bean poles so I can see the methods
which method are invoked pools
high-water mark is interesting there was
never actually load for the bean and
this is very very interesting for stress
testing and operations later for back
fixing and arrow hunting other questions
even better with websphere i think that
the name is performance pot or something
like this it's just crazy what do it
exposes so i would say websphere and
weblogic are the best I never used SI p
so i cannot tell you any more but they
are the best and glassfish jboss and
Tommy are okay but there's a but regalis
what you are using it's always ignoring
my projects no one cares so and the
reason for that is everyone is talking
about dev dev ops and the reality is one
team is taking the software and the
other team is operating even if the
developer are ready to go that they
throw over the ddd wall the ear and the
operators in one big company they
monitor the server with stop right so
top unix command always running so go
perfect all right let me spend five
millions and now you do to find out that
is running right so so this is very
basic thing and at the point is what is
not standardized is how it looks like
what standardized is that it has to be
in gemacht and what rats which does it
exposes v arrest Tommy does that and
jabo status as well and the new age a
bus and an epic and the glass which they
exposes via command-line interface as
well perfect question other questions
this is dis light not with us feel
spring but in one project this was
actually interesting story does not fold
of spring but what happened was they
built with spring and tomcat application
and they used data access object pattern
down and what they develop it didn't
knew that if you do nothing in spring
everything is a singleton and they're
dows what they did they access some
files and they started to synchronize
the excess so synchronized on methods
and and and and the interesting part is
the project was a little bit older so it
was successful for five years and it is
60 year a lot increased and I got the
task to help them because they the
applications Penn gathered too much
money to too much memory so and and end
up with out of memory error so and after
I would say two hours it was pretty
clear that the problem are threats so
there are several thousand threads
started and all these threads waited at
this method and terrors of course no
monitoring because spring cudas with Jay
mix but no one cared so we had we had
actually 22 we built with spring and
tomcat our own application server
because was too risky to migrate away
from spring and so we had actually what
application server does we replicated
that so we monitor DQ the threads
everything was exposed and done we saw
what happens there was one of the most
interesting project for me but the
customer is like you know yeah another
application server right which is
absolutely proprietary so if you do it
right is the thing that is called T
server from from from vm via they have
our own small application server tc
Server they expose a statistic but it's
never used so if you are using spring I
will use the spring application server
then it's very similar to java on tomcat
i would say it's everyone talks about
DevOps but you don't even know how many
sessions are active or a sessions are
you know how many s but you don't even
know whether in the last two hours a
transaction was committed this is the
sad reality as a stupid to talking about
that
or clouds right the blind flight agreed
so in my projects tom kitten jetty is no
go why I mean what was the problem this
is one one of the problems is this so
what also went wrong was interesting
part it's in one project it was like an
ejb now is not spring but just pure pure
java ee 5 and java 6 project was an
interesting story one EG be invoked
arrest service and the rest service was
deployed in the same war as the egb and
what happened after after some load not
heavy load some load I don't know it's
called it was a kind of deadlock but
there was actually no cpu utilization
and the server was dead absolutely dead
you know what happiness every gb call
generated another transaction which end
up in the same incoming queue if the
queue is bounded which is not usually is
on application server you will end up
with deadlock because at some point of
time you will try to create a new
transaction when you cannot because the
queue is full so we sought it
immediately with application server
monitoring and all we did is we create
another Q incoming queue associated the
rest service was the different queue and
the problem was solved but imagine to
find such a problem without an observer
okay interesting things but it was never
tested the the the the the the project
was never tested never and what also
happens just look for my handles a beam
in glassfish on sometimes jboss we found
include incredible amount of
applications of a box just by stress
testing them yeah and so I just can very
important so war stories later right so
believe me there are lots of them but
you don't learn anything except
application servers are good in this
session because they expose monitoring
data and monitor monitor data is very
important for bug fixing and and
scalability elasticity for for
everything agreed and I think
from my perspective perspective one of
the biggest feature for java eh should
be standardization of such restful web
service so the application service
should expose even more and so that we
can build tools which are java ee
vendor-independent so or this is let's
say here so what how to perform such a
stress test so first there are tools
like jmeter i will create one soon so
jmeter or Apache benchmark Apache a B is
on mac and linux but not on Windows but
Jamie tells everywhere this is a patchy
tool this is very very simple one
it's a good starting point but with
Jamie to you cannot generate a lot of
load I would say a view clients per
machine or you view a no transfer
machine so you cannot you need more load
generators what is probably not that
obvious you can also start several
geometers and coordinate the attack
right what we do is nothing else than
the yellow service attacks okay so
question so far so now jmeter it's a
good tool muslim project I using jmeter
so now the first idea is if you if you
start something if you create a test you
can save the test as a Jay mix jmeter
xml so what's not obvious probably as
the following
this jmeter minnows n what it means us
no you I minutes n no dash and no UI
minus C is the configuration file so now
what you have to do is to create a
Jenkins build a job which executes exact
this line of code oh good and this is
the only Jenkins job we perform time
based so time driven time trigit all
other Jenkins job uh performed / push or
if you have subversion commit this is
the only job which checks out their code
at night and runs the performance tests
and in the morning the server should at
least survive if not we look at the
database and see what happened it seems
sophisticated but I try to show you how
easy it actually is it is really
criminal not to doing this that I should
no excuse no excuse okay comparing who
is the evil with the effort for unit
test this is nothing ok so I have to say
regardless how trivial the application
was it never survived I built several
simple application it never survive
tonight and one almost survived and then
was on linux and there were the open
file descriptors which killed us so this
was almost once yeah we build something
and then we forgot about the file
descriptors only on linux agreed so even
if the application survives and works
perfectly you would what you learn the
first time how deluxe looks like when
the application servers on a heavy load
how it looks like yeah
at louder yeah it replicated the first
not okay so what about the environment
is the question so usually we don't get
a dedicated environment from stress
testing this is how it is in my projects
so what we do this this is i would say
guerrilla stress testing we start
glassfish usually glassfish from Jenkins
so on the jinc on the same machine as
Jenkins we start from the batch before
we create a glassfish from scratch from
the configuration we started deploy it
and then we attack our own glassfish
which runs on the same machine as
Jenkins and this is good enough first it
doesn't have to be realistic with load
balances everything the load if if the
application survives that then you can
go further with with voice clustering
but you're right at some point of time
you will have you should also test load
balancers on was what is my point dude
do I care about the application or the
environment right this was first first
the application I would say but to your
point regarding clustering only find out
in one project for instance at some
point of load we get a lots of
optimistic locking exceptions what
happens with clustered environment and
the end the cash was dirtied the whole
time right so what we had to do is at
certain amount of load I forgot it to
either replicated cash or even better
invalidate the cash this was actually
what you will find out only with stress
test if you put it in production this
terrible there's a verse performance
okay so at some point of time you should
do this but before you do this you can
solve millions problem before this
agreed
yes what it means is valued at the cash
because it was a glassfish project in
this case eclipsing at some thumbs on
something called GMS cash coordination
you can send an event over over the wire
and you can decide what happens on the
other side and what we decided is that
the entity was the primary key one
should disappear from the cash not it's
not periodically you have try not a try
is German to you have two nodes you have
two nodes you go to the first and and
you change the state of a customer then
I synchronously as a small message is
sent to the other node and the customer
disappears from the cash and this is in
production right now yeah it has to be
okay if you replicate nothing changes if
you replicate asynchronously have the
problem that the other is can be stale
okay this was just a response to his
answer because verdad response to his
answer to his question because those
very good question about the clustering
so whether we test it later so we start
with that if it this works well you can
do the next next step okay this is the
next slide which went wrong so if
everything goes good goes well what do
we do then we try to miss configure the
application server what I start with is
is to attempt to minimize the deep deep
pool size of the data source for
instance just set it to load and see
what happens so how the exception looks
like and if you know how the exception
looks like we will do next we make it
testable it is not a bad idea to write
then regular expression whatever to find
such problems in all my task forces the
customers were not sometimes not really
not even capable to open the files in
the most funnier project isn't no funny
as well actually it's not funny for me
was funny the for customer the
applications ever run on windows and the
log fire was so big that they couldn't
open that can you imagine us they never
they never tested this right so hours a
day there was a like open tail or
something and
I couldn't buy the license because
there's a the whole process so that we
could only lonely look at the log files
for five minutes and then because we
they know licensed it just closed as a
just and the company was huge if you
would never expect that this actually
happens within the company right so it
means so the couch monkey means we miss
configure the application server on
purpose so for instance GMS pool size
our candidates a number of threads
number of sessions and out start and in
the back end for instance number of jdbc
connections set it to two and generate
go with 20 clients to the application
server what you should expect first
exceptions in the log files that the
GlassFish cannot or jealous or whatever
cannot cannot acquire more connections I
would expect that first so the next one
I would expect that at some point of
time the incoming queue growth and fills
and this should stop if it doesn't you
get out of memory arrow and a service
dead ok and after playing with that you
will find out parameters which are
stable so it means after the load we say
ok our application server can sustain I
don't know 20 parallel connections or
500 minus twenty percent we set
everything max and then you cannot hack
the applications of anymore so the
clients will time out but application
server won't break and this is actually
only possible with application server
got it
so what I like to do is now to stress
the applications event show you how it
looks like it's fun what you do want to
learn anything so if you have questions
just ask me yeah how often they are
stress test the application server oh I
don't have any best practice I just play
with the with the settings and see what
happens this is just and one on a point
of time you can stop that but at the
beginning is actually very very very
able to do this and how often how often
all parameters from if you have a JMS at
least a JMS pool jdbc jdbc pool then all
application server has has something
like accept or threats HTTP then the
queue then the pool which worker thread
pool this is at least this thing's I try
to miss configuration most direction too
large and see how the out of memory
looks like and too low to see how the
application server reacts to overloading
my understanding the question was this
is minus twenty percent calculation yeah
you recalculate that every time you
redeploy
I know at some point of time there i
would say this is like max blue size
from EG bees well if you say that you
can under sustained 30 parallel
transactions or 50 this is pretty stable
actually if you have then if you have 50
for instance ejbs in the pool size you
should also have 50 connections in the
in the pool in lost production systems
even not the case you have in the pool
like three and in the beginning 50 this
is actually crazy so the whole pipe
should be parallel right you have you
know 50 threads 50 transactions let's
say there's an arrow striction and 50 50
50 connections to database I agreed how
to do is tom cat I was interesting right
no one cares is the answer yeah
developers look would like to do hack
application fast and did operations say
I don't care so the term is actually
stolen from from from from netflix you
know probably the company so they do it
actually full automatically so they have
a cow's monkey which kills actually
process in production or integration and
they stay they monitor with water but
what happened so on and i don't go too
far but what i do is they forgot to
mention that on this had nothing to do
with the talk but all my application
servers i'm using in integration tests
and production are created from scratch
with Jenkins always so it's not like i
go to the admin console change a
parameter I have a configuration
somewhere this is checked in on the next
commit the application server uses this
configuration very easy with jboss very
easy with glassfish and very easy even
even easier with websphere and weblogic
there's even a book for websphere about
this administering web service jason and
is a also i don't know whether there's a
book from oracle property yes for
weblogic as well but there are no
excuses got it
so questions no questions
ah dig it ok this is this absolutely so
what you are saying is like stay away
test right so you are every if every 30
seconds there is a new new client it
started and try to over text application
server very important on that note you
should do this to find out how many load
your application server can sustain at
all automatically and then if you find
it out what is also interesting to
decrease the load then and see whether
the application servers actually able to
recover from this
yeah but it is very very good point it's
ddd I don't know it's called this is
like you say you create a new client
every 15 seconds oh you should only very
of one thing at a time so 111 nope at
night in my case really and then write
everything to an excel sheet table
whatever and then you can compare it
with the with nights before this is what
always happens yeah forgot to mention it
but I think we are all developers right
no one from us would actually change
everything and then expect it works
right right okay other questions good
point so then what i did is or dis dis
aureus i'll show you a tool abilities
apache license to lie you can you can
use it to do whatever you want with that
and why I build it because I had to
build it for every customer because a
good idea and then I created scripts for
every customers okay now it was boring
right from in the train between
frankfurt and munich so and I hacked a
tool from scratch and now it's open
source and the least works with light
fish it will work with Tommy soon and
IBM guys contacted me whether it would
work with IBM as well and yeah why not
right so you can just clone it and and
is by chance someone here from from
Canada who extended the tool Rob
something is the guy here was actually
nice nice a delivered a talk last year
and after that someone contributed a
lots of code because they use it in
production what tool what I will show
you so this is actually history after
the session last year so so what the
tool does is it is Java is six and Java
is seven application and what it just
does is very very simple it it fetches
the Jason and stores in the database
period so this is actually nothing right
so and we have a broad table and we see
every five seconds 50 no he put sighs
threats and whatever is interesting is
in the table very simple and it's
amazing what you can do with that so i
will show you this is very
what I what I told you what I show is
simplistic next year you can do
something more systematic but what I
show you right now is really really
simplistic so um the tool is if you
start a tool these are war you can drop
it to glassfish you will see you can
start monitoring here and every two
seconds it causes the data and stores
the data to a database this is a java 6
and now java 7 application and it works
this time it's very very simple and you
basically uses the same Jason would I
would I would I show you before so it's
actually simplistic jpa JP at no time 33
hours time for the back end that it took
more for this what back end was this was
the prototype was done really in three
hours 30 or something so no excuses we
could do every project like right so and
it starts data in a database because you
would like to see what happens in the
next morning if the application server
crashes this is the whole idea but at
the same time it was interesting to see
in the real time what what the
application server does and
yeah build and start it starts maven
build because this is my my test script
so it takes longer as it should just
blitz everything and it starts the
application and this is a java fix
application and what you see right now
every 10 seconds you see heap size
thread count and pic thread count your
pics thread count is already interesting
right what the changes under load or or
not for instance then more interesting
is transactions this is actually normal
no more provided by tom cat you will
have to do something so and you see here
there is a number of commits and even
more interesting from stress that's
number of rollbacks with dear old bags
we found out that a given value of load
there were optimistic lock exceptions
which caused rollbacks for instance okay
very interesting so then paranormal
activity it was just the next step is
grace a good thing but in the load tests
you see here cute connections cute
connections means an application server
update we're actually all applicative I
know there's an incoming queue of
requests and there's a thread pool and
then the worker threads are consuming
the task from the queue if the queue is
full it means this application server is
overloaded if it gets too full you get
out of memory error which actually
happened recently in one of my projects
okay questions are far so then errors of
course and busy thread count is if sweet
threads abilities okay in this case the
application server has nothing to do
performance commits per seconds this is
one one commits per second and Rob x per
second is Robert per second is also
interesting right then web what you can
see is HTTP session and expired sessions
so also interesting for right where they
expire or not and you can monitor here
resources and there with what's new so I
hecht that I think a few weeks ago I
can now you see there is an internal
application called default web light
fish and a gb timer service if I click
on the light fish I have a good list of
all components deploy to the application
server and the light fish is the
monitoring tool itself so I meet a
monitoring right now but isn't good
enough right so I'm there is and here
where we had the configuration store you
see here one beam is created one beam
was destroyed for what reasons total
threads why I think nothing total
threads waiting hi also nothing and here
is interesting for free what is the
slowest method there is a method create
default retrieve configuration and you
see execution time again sorted here
this is a job of X application without
any skinning is out of the box the
simplest possible Djokovic's application
without anything is included so because
this was the reason why I use that and
more important this is basic data
without any plugins no aop nothing it's
just what the applications have exposes
to you there is no plugin no
interceptors nothing no no
instrumentation you did you wanted to
ask a question yeah
so how it works is so we have the
application server it was built for
glass fish because add lots of glass
which project but doesn't matter
actually so and it was the idea is you
have another application server which
can and you install here the the
monitoring tool this year and this
monitoring tool communicates via
proprietary protocol with the
application server it happens to be in
the in the glass fisher jason but I'm
properly interesting i would say in 50
different Zander's right sensor data and
my light view here talks with that via
rest and there is a nice night nice json
api and this is normalized would mean if
you would like to make it work with
jboss you only have to change two
classes here I don't have to change
anything else and because all
application servers are standardized
they all have provides similar data ok
you got it so and in this case the I'm
just monitoring the applications of
itself so it connects to itself right
not to D to do to real application
server and it happens every two seconds
so every two seconds you would see a
peak because it gathers 50 JSON objects
but you can do it 100 every one minute
every hour or whatever you want and
every two seconds everything is
persisted to a to a broad database and
there is no tool to our 222 for the
reports because there are a lot of tools
like jasperreports bird you can do
whatever I want but what's interesting
then with the database in all my
projects they create custom reports it
was every project was different than to
create today charts right you got the
idea and this is very simplistic what we
did is we r in the first in the first
iteration you just rename the tables per
day so in the next day or the next table
you know we will rename the old one with
Derby so just be creating pragmatic
don't build a perfect tool but what the
session is about you can create in one
day a tool for stress testing so there's
no excuses agreed questions
it means if you have max full size of
max ejb pool size of five and six
incoming requests that you have five
busy threats and then you get the queue
filled up because one thread cannot
cannot get the insta the dia de beam and
this is the reason also why i like-- EG
bees so if if we start with an e gb as
an entry point to the application you
can set up the pool you can you can say
hey ejb just five of you if you set it
up five stateless session bean at the
same time or that actually means is that
could be never more than five
transaction at the same time so it
prevents the in out of service attacks
we see the I impossible with Pujols
impossible set it up right and we had a
lot of requirements one project which i
remembers we had a proprietary unique
system which just I don't know for
license issues or whatever we only be
able to do to use twenty connections or
something it was very easy to set up
with eg bees got it no questions then I
will create a very small applications
with a stretch and stresses that whether
it's useful to measure this in
production yeah of course because if you
would do this you will you will find the
errors before probably pattern
yeah of course most companies don't care
about average area the unix
administrator which looks a nun java
process and if it runs they are happy
you're really the set but is crazy but
it spent two millions before to get a
license of an application server right
sorry your first
a little bit a little bit because every
two seconds address to connection and
fetches the rest data but it's not a lot
this is you will see us spike so if it's
completely overloaded I wouldn't do this
but yeah
what what with what it works with jmax
oh no secret of aces this is why I like
Cassandra lots of gem eeks Cassandra
expose everything with jen weeks but if
you get Mongo is not javed as much a mix
of course other questions okay
our commercial tools yeah you could use
commercial tools the problem is in my
projects if my budget gets approved the
project is over if it's something out
there i would use it but if we really
order such a tool in a bigger company we
needed something from the beginning and
this is zul trivial to build and you
have to integrate this in the whole you
know life cycle so that it's actually
you can achieve with such our hacks
eighty percent of you can you can find
eighty percent of problems there's no
generators are interesting because Jimmy
does not as good they are has called not
winner honor the other one from
roadrunner for it there are amazing
Rodian load tools because what the load
runner does is it not only generates the
the load it can show you know hard disk
performance network performance and
correlate everything from the client
perspective is even better but this is a
good starting point this is so my
argument is you know you don't need any
budget we don't need we probably need
two days and we can achieve a lot and
this is more important than unit if you
have commercial tool even better okay
and the point was all applications ever
have to do this so there's a nice cous
this is actually which is there yes I
support it's just not like I true I
built a tool for myself and just publish
it to github and the community build
HTML clients and in the extended a
little bit i would probably hacked Tommy
because it interested me and if someone
would like to extend it to jail Buster's
really not much to do except fetch Jason
and then transform to my own my class
this is actually very simple but there
is no support nothing to sell so as
Apache License just clone it and do it
this was just the idea and I was sick to
do it over and over again right in my
next jboss project i will i will port it
by myself yes for batch testing
for batch testing is actually a lot
easier because you don't need any load
generator right we could just start the
job and monitor the server the problem
is the batch data is another problem how
to how to make it more realistic but for
four batches actually even easier the
problem is he has request response so i
have to generate something right okay
got it so oh yeah five minutes is the
right so on you so what do what I could
do I can create oh this is this from the
keynote the same problem I could not
kill my glass wish I could create a
small application and show you and
stressed as that but it is trivial I
would just put it to jmeter the Ori and
just create the total owed and you will
see and you will see the changes in the
charts and recorded a screencast with
exactly the same so the information is
out there and other questions questions
if not the Nevel hacked the application
if you would like to ask me something
then ask me if not I'm hacking here so I
web application i would say heavy load
and how could i have to use this glass
fish and the heavy load has a let's say
an ejb loader
and this is an ejb stateless and they
method any questions just ask me
information what debug what what do you
have to increase ah okay okay what I
forgot to show you is the following
because doesn't work so um this new
script probably open the window
somewhere else there are actually what
you can do every two seconds a snapshot
is taken and stored in a database what I
only did the snapshot is a java object
right imagine a java object so what did
you do can do is the following you have
one object which is the current and it
just remember the last one and then you
can store javascript job because this
comes with java a store a script in a
database and what i can do the script is
loaded and compares both objects and you
can say if Heep increases number of
threads increases then it creates an
rest channel and you can subscribe to
the channel and get pushed proactively
that something happens extremely trivial
two classes one scripting environment
that is done okay good point
questions no questions very good
questions so heavy load I would say
let's say a servlet it's nice gate load
gate next finish and the loader gets
injected loader with at inject and of
course we would like to see here
something this is Lola get message
javaone is almost over right it was
so let's see
so this was wonderful and load gate so
this seems to work so heavy load is here
Lhota is here it was invoked once right
so now I can go to my light fish and say
threads a thread group number of threats
let's say five ramp-up period one second
and forever why not and what someone
asked the question twice what you could
do i can say ramp-up period i don't know
two days and number of threads 20,000
and then it will never stop create new
users this was actually a point to get
you know so step test and then what I
always do here I create a new I think
the name is sampler yeah sampler HTTP
request and the path is here local host
the number is a DAT the path was what it
was heavy load this was the path
and then create here a think summary
report because I only interesting in the
arrows so if I save that I would get a
Jay mix file which can be used for
continuous integration on Jenkins so now
hopefully if I start that start no
saving you will see thousand
transactions per second threads in
memory something happens transactions
okay paranormal no q this is not much ah
I don't know because
it disconnected men JVM crashed so I
just have to deploy this as well but
what you already see is i'm generating
3000 almost three thousand transactions
per seconds we sign servlet an 80gb it
creates new date and in my project like
Egypt is a way to slow we need to know
several transactions per second I mean
this is almost no aware right so now the
gas which is not of its overloaded that
won't be able to deploy it so you don't
it didn't see the charts but this would
go out of time anyway so any other
questions left we have any questions no
because in my light fish i'm using jpa
transactions it is simpler we stunk with
i would have to use user transactions
and whatever i was too lazy i actually
the nice stories is actually i wanted to
build a java SE application and then i
started with that like i am I crazy Java
you two timers and all the jdbc stuff
and let us throw everything away and
started Moose Jaw basics so just
actually the whole story okay then thank
you for attending</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>