<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Top 10 Web Application Defenses for Java Developers | Coder Coacher - Coaching Coders</title><meta content="Top 10 Web Application Defenses for Java Developers - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Top 10 Web Application Defenses for Java Developers</b></h2><h5 class="post__date">2015-06-08</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/VTUnrfpfaA4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">let's talk about using the Java
programming language to build websites
and let's do it in a way that's very
secure this is a very difficult problem
make no mistake very often companies
will build software build some fancy
high-end java web software for a web
application or web service or some
mobile app and then like a few weeks
before it needs to go live let's do a
quick pen test this is a strategy for
failure we want to build security in
from day one let me give you a like a
one-hour presentation to give you some
practical advice as possible to begin
the approach of building a secure web
application with the java programming
language my name is Jim Manukau I am a
volunteer for the Olas Foundation I'm
one of the elected global board members
it's a nonprofit organization that's
focused on giving free material to help
people build secure web applications in
some way one of my projects that I I
manage and contribute is the OWASP cheat
sheet series project what happens when
you give a developer a 300 page guide on
secure coding you're gonna read this
what do you do with it
you stop what you're doing you read the
whole thing right know you prop your
monitor up with it use it to make
airplanes throw it at people but my
opinion is most developers I've met in
my career are very a DD
attention-deficit scroll disorder so we
need something that's brief concise to
the point that's what the OAuth
cheatsheet series is this is a Creative
Commons open source open source project
to help you build secure code
professionally on the VP of security
architecture for white hat security this
is a vendor neutral informative talk I'm
not gonna shell or sell anything to you
today and I was like should I wear a
suit should I put a tie on I have nice
matching tie and cufflinks and I'm like
I am from Hawaii so I'm gonna go
Hawaiian style
Aloha happy to be here and we have
planes standing by after the talk we can
all go and cruise on my pet in Hawaii
I'm lying but come visit alright let's
get to work
if I want to talk about 10 of the most
important controls to build a web
application in some kind of Java stack
what control am I going to talk about
first
and before we get there look I'm a very
as you can see by my picture here I'm a
very informal person I encourage you to
stop me at any time
ask questions mid-flow throw something
at me I don't care what you throw at me
you can throw me your books you can
throw your undergarments if you want I'm
a happily married man it's not only I
don't have that need but if you have
that need I want to support you in this
room so please let's be informal at any
time just jump in and ask a question
that always contributes to a talk of
this nature let's do it let's do it so
if we're going to talk about defensive
coding what's the very first control
that we should be informing developers
about what do you think I politely
disagree I think input validation is one
of the least important controls every
book talks about this every framework
talks about this but especially when
you're dealing with open text like a
blog post or a comment on a news article
any social media post inputs annotation
breaks down you're doing in an
internationalization of input validation
breaks down and for especially in the
era of open text or HTML input from tiny
MCE validation breaks down it's not
gonna stop also the first risk I talked
about the sequel injection how do we
absolutely stop sequel injection the
answer is not inputs annotation what's
the answer
parameterize queries you can skip all
validation and just do good query
parameterization and your apps are now
bulletproof from sequel injection let's
look at that a lot of people talk about
sequel injection as if it's this big
dangerous risk that ninja hackers drop
in and take over your your database and
web application and this is not a
database vendor issue this is nothing a
database vendor can do to protect you
this is a code level issue by the time
your app has been sequel injected the
database is just taking a query that
your app legally gave it to it so we
can't blame a database vendor of any
kind because of sequel injection it's a
coding problem so I watched a top 100
website go down from these two
characters because of sequel injection
let's look at that quickly here we have
a basic account feature
we're gonna enter in a new email address
and hit edit and you have to allow a
legal email address to go through
especially in an internationalized
context you need to let a lot of
characters go through that input
validation layer two of those are going
to be single quote and semicolon so the
user types in this is pseudocode the
user types in a new email address and
then we take that email address and
inject it into the query everything in
black is from the developer or trusted
from the session it's that new email
that comes from input that's untrusted
in some way and so apt elite hackers
come in and do single quotes semicolon
that's their big hack we take that
single quote semicolon inject it into
the query while we're the new email
should be and this is what the backend
database sees what is the semicolon do
an SQL by the way it terminates the
query so that's what the backend
database sees what's that gonna do that
basically takes every email address in
your database and turns it to an empty
string and this is again two characters
that you legally accept it to an input
validation layer bang you're injected
and how that can affect your day if
you're running a major website it's
gonna really injure your day this is a
major basically denial-of-service
website needs to go down to be fixed so
how do you fix this problem some input
validation will help you if you're
validating numerix you've stopped
injection if you have like a username
that's lowercase letters only and you
validate that's actually an effective
strategy but what about open text open
comments a blog post something that's
allows punctuation as soon as you give
me upper and lowercase letters spaces
and punctuation that's all I need to
inject and those are legal characters so
the point I'm trying to make is network
security web application firewalls
they're all about building reg X's and
blocking preferably bad traffic or are
actually preferably defining what good
data is and rejecting everything else
and it's a weak layer when you're
talking about absolute defense when you
want to stop sequel injection by far the
number one risk to your web apps it's
all about query parameterization now why
this control
was so awesome not only does it
completely stop injection it also gives
you a significant performance boost in
terms of how fast your query is running
because you're essentially pre compiling
the query we take our untrusted data we
dump it in the middle of a prepared
statement with question marks as our
placeholders and then we bind our
untrusted data in an injection goes away
now how does this work anybody know what
happens underneath the hood of a
parameterised query it's not encoding
it's not escaping it's not validation
it's using the database to defend
basically the query structure goes in
past one and now your database pre
compiles that query it builds a query
plan to accomplish the goals of that
query and then pass two they send the
untrusted data in the query plan is
built already the databases traversal
structure is done and nothing from the
input that's untrusted we'll change that
this has been a successful technique to
stop sequel injection for almost 20
years
see it's the most absolute way to stop
it we're leveraging what the database
does best process queries build a query
plan and then we send the untrusted data
and and even the world of no sequel and
object query languages we have the same
problem so when you're building oql
statements you want your placeholder and
you want to bind your untrusted data
into that placeholder the query gets
precompiled injection goes away and your
queries run faster especially when the
same query is run over and over again
this is wonderful because it gives you
that performance boost that we're all
looking for in our applications so I saw
quiz question on a very big test to test
if if you're a secure coder or not and
they said just use the preparedstatement
class in Java and you are immune to
sequel injection and I said that's false
and I got graded wrong so I challenged
the testing question explained I can
just build a query with string building
put it into the preparedstatement class
skip my ID step and i'm injectable so
it's not just using preparedstatement or
similar api's you must also have your
placeholders and do your binding and
injection goes away
whoo-hoo defense number one number two
let's talk about password storage how do
you think we should store a password
what's the worst way to do it
plaintext criminally negligent at that
point we've seen some major sites go
down to sequel injection data is stolen
and then by the way this whole deck is
up on SlideShare as an open source deck
so I'll give you that address the end
you don't take pictures if you want to
go for it
but I'll publish this so plain text is
near criminally negligent what were we
told in 1994 to do to store passwords
use a hashing algorithm what do you
think survey says what do you think
about using a straight-up hashing
algorithm to store a password survey
says it is basically plain text one of
the largest social media sites for
business was hit with sequel injection
recently and all their hash is dumped to
paste in a public website how long do
you think it took hackers to reverse
like half the passwords of this giant
social media site like an hour so this
is the attack called a rainbow table
attack most attackers don't use this
attack anymore but it's interesting to
note that we can basically write a
little piece of code that loops through
every single possible password up to
nine ten characters and then call a hash
on it now we can also store that in a
day like a ten terabyte abase and now we
have a database with the hash values of
every possible password up to like eight
nine characters and boom if you're
storing it as a hash it becomes trivial
to reverse it so one defense we'll use
and so let's let me just get into my
defensive strategy here this is
relatively recent research from John
Stephen this is something very heavily
debated in the crypto community I find
that this section is as bad as
real-world as I can get in terms of
providing you with scalable highly
performant applications yet still give
you good crypto in terms of storing a
password and the goals here are the
whole point of good password storage is
if you can it with sequel injection if
your database is stolen if your database
falls off a truck if some insider looks
at your database they should have no
idea what the password
Czar of your users until the Sun stops
working and the the other the flipside
is if I'm a user logging in you should
tell me if that password is good or not
within a couple seconds that's a very
difficult cryptographic goal and here's
my suggestion number one do not limit
the type of characters or the length of
a user password have you ever gone to a
bank you know the people that protect
your money and you give them a long
password because you're a security geek
and the bank says whoa wait wait a
second here can you please give me a
shorter password it's a bit too long
that kind of that kind of weirds me off
so you give them a shorter password then
they go wait a second dude you gave me
some funky characters in your password
can you please simplify that policy
please this is insane these are people
who are protecting our money yet they're
asking us to give them a weaker and
weaker password the trend is actually
opposite where some of the most secure
websites and secure banking institutions
are now requiring not just a complex
password but a complex username as well
just because of the ease of username
harvesting attacks against websites so
number one let the user use a a password
manager and give you a 30 40 50
character password something interesting
though is UD you do need to set large
password limits de Django was recently
Django has recently hit because the
attacker would throw like a 1 megabyte
password at Django and it would take
like a minute to process it so it's a
dump dial of service vector so long
passwords are good but anything beyond
like 160 you lose cryptographic benefits
and it becomes a denial-of-service
vector okay number one limit the size do
not limit the size or type of characters
of a password within reasonable limits
number two use a cryptographically
strong credential or user specific salt
the whole purpose of a salt is for
deduplication purposes of your cipher of
your of your password storage mechanism
and all that assault is when the user
first registers for your system or when
the user first when you first create an
account for that user you generate like
a 32 to 64 a random character string and
stick it in the user table and then when
the user gives you a password before you
protect it pop the salt on it and then
call your protection algorithm
the purpose of this protection primarily
is if you and I have the exact same
password and we're using the same
protection technique our cipher texts
will look the same that's a bad thing so
I wanted to in my good crypto password
storage system
I want it when even you and I have the
exact same password that our ciphertext
our hash value is going to be different
so that's the point of assault
deduplication and like 32 to 64
characters it also gives you some
resistance from rainbow tables
precomputed list of hashes that's
defense number 2 the next two are the
most important soaps will buckle up I'm
gonna give you two different strategies
so number one if you're building here
this is my favorite strategy if you're
building a website that has to handle
hundreds of thousands of concurrent
logins you're talking like a Google or a
are some kind of rest web service that
the user authenticates every request or
just a very highly hit social media or
any kind of website that has that
handles literally hundreds of thousands
of concurrent logins at any one point in
time banks face this if you're a big
bank you're looking at two plus million
logins concurrently at any one point in
time because of the service mint alone
which logs in to your account
automatically throughout the day so a
lot of the advice we used to give
developers about password storage that
was good was slow and it doesn't scale
so here's a here's a strategy that's not
only cryptographically sound it scales
to the most highly hit web site on the
planet and that's using an authenticated
hash an H Mac there's nothing fancy
about an H Mac it's a it's an off it's a
cryptographic primitive it takes a
private key
it's basically running your hash twice
in the second time it throws the the
private key in it's that simple so we
had it's the speed of a hash which is
super fast it takes a private key and
then you give it to salt plus the
password the salt in your user table
unique for every user and the password
the credentials are logging in as this
and the in order for this scheme to work
you must protect the private key how do
you do that
stick it in hard code in your code base
fail put in the file system somewhere
fail put it in
in a the keystore on your application
server fail I usually recommend you have
an isolated web service with an HSM so
the private key is never accessible by
the application in any way then you have
like a web service right next to your
web server internet access only or you
know web server access only have
certificate authentication and then you
basically you give me a password insult
and I'll do the H Mac get the private
key from the hsm and spit you back a
hash and then your database you want to
store the salt for every user and the hm
a cache for every user and as long as
that private key is kept in secret which
is the whole purpose of any crypto
system anyways this is going to scale
super fast can handle hundreds of
thousands of concurrent logins even on a
modest server and it's gonna be
impossible to crack as long as that
private key is kept in secret this is
not going to be cracked until the Sun
stops working as long as your key is
long enough this is what big banks do
for for password storage and the servers
or service you want to build to do this
is not that heavy-duty code it's a H max
or native in Java it's something we can
build in a relatively short amount of
time that's hardcore scalable industrial
isolated password storage now what if
you're getting started what if you don't
have the luxury of an HSM or you're
doing remediation you don't have to
build a separate service and you want a
more quick and dirty answer for a modest
scalability type of need in that case
I'm gonna recommend either pbkdf2 or s
crypt pbkdf2 is a KDF it's a key
derivation function it takes a password
and it takes a looping factor to
purposely slow it down and then it gives
you a key it's a key generation
algorithm this works great for password
storage the looping factor why do we
slow and why why do we slow this down
how many times in your career as a
programmer have you been told look I
need you to do me a favor I'm checking
out your code and that that function
runs really fast you please slow that
down for us
if you don't hear that that much ever
but it comes to password storage
especially hash based password storage
the slower we can tolerate the better
why because
when attacker steal data from your
database that's the risk we're trying to
protect against what are they used to
crack the password they use
supercomputers they go buy a video game
machine they slap in like ten video
cards use open source software and for a
couple thousand dollars they're doing
three to five hundred billion hashes per
day three to five hundred billion hashes
per hour
no no per second for a couple grand
that's what you're going up against so
if you're doing like hashing they're
gonna brute force the whole key space
for all passwords in seconds so we need
so the whole point of this is we have
the salt and password we purposely make
this algorithm slow so when this key
value was stolen it's gonna take years
and years to crack the system because of
how slow you've configured pbkdf2 to be
the other choice I recommend is s crypt
s crypt is just like pbkdf2 if you make
its one-way algorithm you can make it
slow on purpose but you can honestly
also make it memory hardened what that
means is you can make s crypt so it
takes up a gig of ram while it's
computing now this is really good for
like single user systems like I built
like a credit card vault we only need it
like one or two admins to log into it at
any one point in time to administer it
because it was a low number of user
system I made s crypt take up two gigs
of RAM to compute and it took like 10
seconds to log the user in but no one's
cracking my s crypt in it before the Sun
stops working so these are some
strategies for really robust password
storage to sum up let you just give you
big passwords number two use a salt to
deduplicate similar the same passwords
if use pbkdf2 or s crypt if you don't
have a lot of concurrent users logging
in or for industrial systems use an H
Mac and isolate that to a separate web
service for more high end scalable
password storage needs with respect
every crypto library that I've looked at
it gets this wrong to some degree
because these GPU crackers snuck up on
us just in the last couple of years what
what used to cost billions of dollars
in terms of supercomputer computation is
now a matter of a couple thousand
dollars in video game machines so this
is why I'm recommending this is
relatively new information but this is
the heart of these recommendations yes
sir mathematically yes but here's where
it's not the case so when when LinkedIn
was hacked
no and no offense to LinkedIn great
service when LinkedIn was hacked
they used a single hashing algorithm to
store the store the password a 32
character password was cracked off of
that hash and there's no rainbow table
pre computed list of hashes in the world
if we pooled all databases or all of
hard drives we couldn't store all all
passwords up to 32 characters some
Russian cracker took the you took the
King James Bible and took every
iteration of every Bible quote and made
a hash table entry for it and they used
that to pop LinkedIn some guy had a 32
character Bible quote as his password
and you know no offense his religion but
when you use predictable words in a
password even the almighty cannot
protect you so sorry about that
your best bet today sincerely is not to
use a long password is to use a password
generator to use like a password like a
like the key passes some the password
manager they'll spit out 30 true random
passwords that's usually your best bet
but long passwords that are that are
nones words and sentences that the you
know the the article what's that what's
the comic little physics guy who has a
has a comic that he spits out KD
something or other yeah he had a real
famous he had two famous application
security comics and got him both wrong
first he said just use implicit ization
for to stop to stop sequel injection
little Bobbie tables that's wrong you
want to use query parameterization
number two he said use use long
passwords with English words to make a
long sentence that's also wrong because
there are now hash tables and attack
software that just uses words and puts
them together as if they were letters to
try to crack these systems charge cool
all right what's the next topic we'll
talk about cross-site scripting
now Java is unique in this world because
in the Java core java core is meant to
be for all java developers not just for
web developers even though we're much
more important than anyone else in the
world okay so okay we're I'm sure a
tough crowd today no so so there's never
we're never going to see web specific
defense libraries in the Java core like
an output encoding library this is
really specific to web applications well
let's talk about what cross-site
scripting is with some real-world
examples suppose we're on a website
together we're both logged in and we're
I'm chatting back and forth to you or
even better I go and edit my own profile
and I make this my own profile data and
I say hello and dump that script in then
I go and say contact the administrator
and say hey admin there's something
wrong with my user account can you look
at this please so the admin goes and
looks at my account and they run across
this script so this script then does
window dot location it redirects it
redirects the admin to a different page
it goes to some evil website which as
the attacker I control I have the log
files in real time and I grab document
dot cookie now remember the
administrator runs across this code so
who's cooked and the administrator
renders this script on their browser so
what's what's a cookie what what's
important in a cookie as an attacker I
want to get my paws on the session ID so
that's the administrator session ID
attached to a URL evil evil Jim calm
that I control and I read and I look and
I redirect him to that page
your your session ID is sitting in my
log file and I can do this stealthy I'll
just use JavaScript to say images new
image image source equals this location
and it will prefetch the image and even
though it's not an image it will still
make the get request and still leak the
session ID so this is a lot of us don't
take cross-site scripting seriously
because it pops up so much it's
difficult to fix that scale
but believe me this is a radically
important risk you can do all kinds of
crazy damage with it or here's a fun one
I'll just rewrite the whole page
document.body inner HTML blank the only
Tagg cyber is cool whatever I control
the whole page at this point and what
else can I do with cross-site scripting
you know session hijacking to face the
website do network scanning port
scanning from inside your network
undermine any cross-site request forgery
token defense redirect the user load
scripts from a third party site steal
any data from the page trap all
keystrokes with mouse up and mouse down
events in JavaScript I own the whole
page we have to take this seriously and
tackers are using the stuff more and
more frequently we can't just slap up
content security policy it's gonna take
years before that standard is
established so what do we do today how
do you stop cross-site scripting what's
the main defense there partly it's
escaping it's using that's the main
defense I'm gonna give you a
multi-pronged strategy I'm gonna geek
out on XSS and web technology so bear
with me it's actually quite complex
based on what kind of data you have and
where you're placing it in a web
application you're going to need to do
something different if it's if it lands
in the HTML body attribute get parameter
URL we'll do some kind of encoding if
it's a big chunk of HTML we want to do
specialized HTML validation let's just
get to it what does the body of the
browser do it sees this character you
pretend you're a browser you're
rendering a body and what's that but
that's the point the when the browser
sees this character it doesn't think of
it as display data it thinks of it as
code what are we trying to do here with
this character we're trying to start a
new tag so the browser doesn't think of
this as as data it thinks of this as
code but what if you want to display
this on the page how do you display this
character as data display data and not
as HTML code what do we do
ampersand LT semicolon the HTML entity
for the less than symbol so where do we
do XSS defense do we build regular
expressions and trap it and try to trap
attacks on input that's doomed to
failure now you should still do it too
some degree but it's not gonna stand the
test of time a tax will slip through or
you'll be blocking good traffic and you
have to get those Reg X's just perfectly
and it's incredibly difficult to pull
that off so again this is the difference
between network and application security
when I'm building my user interface and
I have all these variables I want to
render I assume all of them are tainted
I assume every variable has a good
attack in it so as that untrusted data
lands in my user interface I escape it
to convert it to a format that's display
only and not executable in any way there
is no good encoder in Java I daresay
there's the isapi project at Olas which
has way too much baggage with it there's
a reformed project which is not updated
in about a decade
so Jeff I can now ski a compiler theory
student and a PhD computer science
experts went in and studied how every
browser renders HTML he downloaded
WebKit he's a very autistic brilliant
person to his own admission good friend
of mine he spit this spit this library
out as one of his companies was getting
acquired and he's like Jim we have
120,000 XSS but they're offering me five
billion dollars to buy my company and
I'm like that's motivation that we can
work with right a lot of people tell me
you can't stop all XSS what if I give
you five bill to work on the problem
it's weak we can we can try at least
right so so he wrote this library and
literally in a matter of six weeks went
from 120,000 XSS to zero or the comfort
with the auditors on the other side of
the fence we're screaming at us saying
we were cheating and we were we were
using a good encoding library here this
is for use not an input not your
controller in your user interface that's
the boundary between your untrusted data
and your parser the last chance you have
at least in standard web 2.0 code we
have all these different encoders
encoding for CSS encoding for CSS URL
encoding for different JavaScript
contexts encoding for different HTML
context encoding for a dynamic
construction of XML this is the most
complete library period not just in the
world of Java but
world of any output encoding library so
here's an example of what the use of
this library will look like in your user
interface we're building a simple text
field
we're taking this untrusted data value
we don't even think about it as good or
bad data we assume it's attack data so I
say encode for an HTML attribute because
I'm in a value I'm in an HTML attribute
regardless of what attack Slits through
i have neutralized it to not execute as
javascript here I'm taking untrusted
data and dropping it in a text area here
I'm taking untrusted data and dropping
it in an event handler because you're
not in lining your JavaScript I'm
watching so so there that was a
JavaScript inline joke anyone okay
moving on so button onclick alert single
quote quoted JavaScript space input
encode for JavaScript attribute
regardless of what attack gets here
we've neutralized it this is what you
this is a pain make no mistake but if
you want apps that are bulletproof from
XSS you have to do this
so in my user interface I just wrap the
encoders around every variable whether
it's from a static context whether it's
input from a user whether it's something
I hard-coded I don't care I just do it
everywhere go ahead and XSS me that's
the point I want to be bulletproof from
this stuff here we have a javascript
block where we have a message the
untrusted message might be user driven
maybe not we encode it it's a JavaScript
block context regardless of what attack
gets there it's fully neutralized I'm
sorry the the performance overhead is
it's almost negligible this particular
library was written with performance in
mind one of the competing libraries that
does encoding is the OSP sappy project
and so this is about 10 times faster
isapi was writing building a new object
for every character it wanted to encode
this is written with more high
performance string manipulation api's
that don't just build a new string every
time so we we use this at a company
called SuccessFactors acquired my
another larger company and we could
barely even
notice the difference when we profiled
the app things like database connections
basic string manipulation where were
thousands of times more of a performance
problem than the encoding so this will
not hurt this specific library I can
vouch will not harm you in an encoding
format it was built but not built by a
team of people this is a debate it was
it was built by one expert in Java
compiler Theory level string
manipulation it was built for high
availability high performance encoding
from the ground up again I think I want
to suggest to you is security by itself
I want to put security performance and
functionality on the same bucket if you
can take one away you're missing the
point security for the sake of security
is a bad thing security and considering
performance and making sure it will
scale that's where it's at that's the
real answer I feel to these problems and
this library specifically even though
it's not marketed really well it is
production quality and it will satisfy
those performance requirements of the
most brutally hit web application that's
why I endorse these projects and so let
me let's talk about an edge case where
you can't do encoding so there's a very
often we want to do HTML sanitization in
a java application let me explain why
and you can't really encode anybody have
anybody here ever use tiny MCE or CK
editor before what would it what are
those widgets sir exactly it's a it's a
JavaScript library it converts your text
area to a rich text editor now we can do
bold highlight numbered list colors
whatever you want and how does that text
area submit all of this rich text Wow
how do they submit that representation
that this is bold and this is not and
this is a numbered list what do they use
for the most part they use HTML so what
so I get this HTML that came off of that
submission what if I output in code this
HTML what's it gonna look like they look
like that you'll see all this code on
screen so here's a use case we're
outputting
loading is no good we need something
else and I want to recommend this
library the owest
HTML sanitizer project this is a project
I'm gonna recommend non Olas projects
here I'm not an OAuth shell I am a board
member I only want to recommend projects
that will stand up in production or I
will not recommend them so there's a lot
of OS projects I don't recommend because
they are emerging in terms of their
production quality this was donated to
oauth by Michael Samuelle from Google
they use this at Google to satisfy HTML
sanitization it is met it is built from
the ground up with with performance in
mind and I'm reading the code and I
called Mike Sami unlike Mike you wrote
your own parser from scratch yes I did
Jim I'm like dude this is insanity
there's a million HTML parsers out there
I know that Jim I'm like what do you
have like a PhD in computer science and
physics there's something he's like as a
matter of fact I have those and a few
more I'm like all right dude
okay all right all right so for these
particular libraries I want one uber
magical expert to write it and maintain
it that's always gonna beat the team of
of non security experts and performance
experts why I'm picking these projects
and their configuration is trivial I'll
show you this one first so actually let
me do that one first so here we are
building a new HTML policy we're
allowing an a tag HTTPS href and a
attributes only no relative links build
now we send it a big chunk of untrusted
HTML whatever comes out of the policy
will obey this policy and be safe to
render to other users as you're building
more complex policies we can do
something like I'm gonna allow all the H
tags only I'm gonna allow a list of
different classes for style and
everything else is stripped out so you
can build your own configurable policy
there's another project which is also
good from a security point of view
called anti Sammy in common use they
choose XML configuration as a Java guy
I've just been like beaten to death by
so much XML I prefer more with me I
prefer more programmatic configuration
of things like this it's just a
preference there use cases for both so
there's my there is my strategy for XSS
defense using really hard
production quality libraries one of the
big benefits of Java is it's huge
third-party ecosystem and we do need to
pull into the third-party world to get
the controls we need for good website
defense let's let's charge on so far so
good everyone this is just I'm curious
is this this is good new information
this is okay this is stuff I've heard
ten times before I'm curious so new so
good or so so or I've heard this before
lots of thumbs up some in the middle you
with a thumbs down the bat you can get
out get out here no no I'm just getting
just go I'm just kidding I'm just
kidding let's talk about cross-site
request forgery next and I'll I'm sorry
yes they all are go go - I will put this
up on SlideShare today or tomorrow and
it has all the references in there as
well so cross request forgery let's look
at a real world example so put and this
is this was vulnerable in 2008 it's been
fixed or I wouldn't even show it I'm not
trying to attack any particular vendor
there's one of the earliest forms of
cross-site request forgery it's best
explained by example so suppose you're
logged into Netflix you go to Netflix
you or even better suppose you log into
Netflix and say remember me let's just
remember me do a Netflix it keeps a
cookie on in your browser that keeps you
logged in for months if not years at a
time so suppose you're remembered on
Netflix then you open up your browser
and go to some movie review website that
was hacked and had this code dumped on
it let's review so this is an evil
website you need to be logged into
Netflix let's render the body first the
body does an image the image is one
pixel by one pixel so what is it going
to look like one pixel and then it's
gonna make a request
Netflix calm day Sun and two Q movie 701
106 72 so what does that do does that is
that an actual image no but what kind of
request does this image make it makes it
goo said that who said get yeah it makes
them not a standard get request an image
loading an image is no different than
you're typing in a URL in the URL bar so
that request gets sent the image doesn't
render but you
just added movies seven 100 701 106
seven - into your movie queue and this
is the most inappropriate movie for
children in Netflix is category oh you
know what it is I thought so I thought I
thought so alright alright so now we now
we've added this movie to the bottom of
your queue that we call load image -
which is predefined up here first we
call set timeout wait two seconds and
call load image - which loads an image
and JavaScript doesn't render it just
loads an image in JavaScript then
prefetches the source which is Netflix
com - top movie 701 106 seven - so you
didn't you didn't even click on the link
in Netflix you were logged in from last
week you visit some evil website and
they make requests that are forged to a
different site that's why it's called
cross-site request forgery
we even see situations where a
cross-site scripting vulnerability was
used to make a worm here's Twitter
called the goat love worm we do have a
theme here today I apologize we have the
goat love worm where this was that this
attack was built into a tweet it was a
script that would load a third party
script and it would rip the token out of
the homepage and take that token and
then resubmit a status update that
expressed your love of goats this is
exactly and all of a sudden and anybody
reading that specific tweet would run
this code and hit an had the same thing
happen to them automatically so you hit
you got hit with this then I'd read your
tweets and I get infected with it then
anyone hooks anyone who looks at either
of our tweet threads will get hit with
the same attack a lot of people began
tweeting about goats back in 2010 this
has been fixed a long time ago I
apologize if I'm offending you if your
if you do love goats I respect that too
so so we even see cross-site request
forgery attacks against your home router
if this doesn't scare you I don't mean
to try to scare you
let me put it this way this scares me so
it's not fun it's a this is it so bad of
a problem if you have an older router
again suppose I'm on the outside and you
have your home router perfectly
configured can I even make a request
to your router's admin panel no way but
suppose I get you to visit my evil web
page and that web page loads in your
browser while you're at home behind your
home router and then it makes this
submission it says let's make a forum
post to 192 168 1.1 your home router
let's call change password and set the
password to a password known by the
attacker then the next request could be
change your DNS entry so Bank of Brazil
goes to a different IP address that's
just a phishing site this is exactly
what happened in Brazil last year some
30 million home routers were hit by this
because they have a they all used the
same basic home router how do you stop
cross-site request forgery now some of
your frameworks deal with this but let
me talk about it from a primitive point
of view I use a three Pung three-pronged
strategy number one the synchronizer
token pattern number two a bulletproof
cross-site scripting defense strategy
and number three Rio in front of
sensitive features so number one the
synchronizer token pattern all that this
means is when a user first logs into
your website and you start a new session
generate a random value for that user
and stick it in the session so that's a
unique random value for every unique
session then when you render a sensitive
feature like change password or
something you add a hidden variable with
that token while you're building the UI
so when anyone submits a sensitive
feature back to your server they change
password at an email address transfer
money whatever is important to you you
look at the token that was in the hidden
variable of that form submission compare
it to what you put in the session and if
they're not equal reject the request
this is called the token synchronizer
pattern we've used it in banking for
decades even before the web and any
cross-site scripting defense can be used
to circumvent it if I get cross by
scripting on your site I'll just use
Ajax to request another form with the
token in it and rip it out and replay it
and I've circumvented your system so to
really be good in terms of defending
against CSRF you
be bulletproof from cross-site scripting
number three re-authentication very few
websites do this it's a very important
control so when you're trying to change
your password here at Amazon they want
not just your new password but your
current password that's basically real
authentic ation or how about this when
your user is trying to change their
email address very few people do this so
meetup I'm trying to change my email
address they want my password Facebook
the pillar of great security I'm just
kidding
I Love You Facebook just kidding so uh
fate I'm trying to change my email
address and they want my password I'm
trying to change it over here at Twitter
they want my password Amazon same thing
why would all these websites protect go
through this additional protection to
protect the change email feature why do
you think because password resets mostly
written with an email password reset
link which is a bad idea we'll talk
about a better strategy later within the
next 18 minutes so reoffend ocation will
help ad IIIi think three places it's
fundamental change password change email
address and any financial transaction
use a European bank transfer money
they're gonna make you really with
multi-factor every single transaction
because banks are under attack that much
let's talk about cryptographic storage
next this is a huge difficult complex
problem how do you get cryptographic
storage right just use Javas default AES
right so here's how you get
cryptographic storage right bear with me
you do want to use AES it's the best
algorithm out there today by default
Java uses AES ECB mode which is
basically plaintext so don't do that we
want to use glossy encounter mode for
AES but it's not widely supported so
you're probably stuck using AES CBC make
sure you have a unique initialization
vector for every message use the right
padding get your key storage and
management correct and we still only are
doing confidentiality so be sure to H
Mak your ciphertext for integrity and
make sure you're deriving your integrity
and confidentiality z' from the same
master key with proper labeling using
pbkdf2 and don't forget to generate your
master key from a good random source
got it so the raw JC the rod Java
cryptographic libraries are very verbose
but you have to do all this by hand
yourself so I think if you're doing
crypto by yourself unless you're one of
like 20 people in the world you're
probably getting it wrong that goes that
goes for me as well so I recommend you
use the keys our project this is a
Google project that Google uses to do
all their own crypto and it takes the
padding the initialization vector the
key rotation the what proper mode to use
an Aes they get it all right and
encapsulate it excuse me in an
easy-to-use API this is how I want to do
crypto here's my key encrypt the message
and now decrypt the message that's the
API I want my developers to use and the
work that goes on behind this is off the
chart so these are as an open-source
cryptographic toolkit for Java it's
designed to make it easier for
developers to use crypto and that stored
crypto in their applications it does not
replace the jce it in fact uses the jce
uses Java's raw crypto algorithms to
pull this off it's simple it's got key
rotation versioning built in all the
crypto has safe strong defaults
automated generation of initialization
vectors and ciphertext signatures proper
padding it's pure Java they also support
the inferior Python and C++ support
languages because Java is way cooler
that's why it's inferior but it is that
was supposed to be a joke that I thought
was hilarious sorry moving on
so for crypto I'm gonna punt here it is
incredibly content complex to do both
integrity and confidentiality when
you're trying to encrypt sensitive data
with AES the there's have been so many
attacks against AES we have a lot of
Hoops to go through don't go through
those hoops yourself unless you're one
of the top 20 crypto guys in the world
who's part of NIST and all that fun
stuff and I recommend you use two keys
are it's one of the best encapsulation
of the difficulties of AES so many
people appeared we viewed it it's a
quick and dirty way to get this stuff
right
cool about what it's decent I think that
keys are it's my go to library um it
tends to have a lot more scrutiny on it
j6 has got their password storage it's a
bit weak for my tastes I tend to use h
max or the pbkdf2 bcrypt s crypt type of
algorithms they're using hashing with
lots of rotations it's not bad it's not
my preference though I'd rather use keys
are it's a bit more academically sound
and then jacent but if you're using if
you're using that you're at least in the
it's reasonable at least next up charge
good to go let's just talk about
clickjacking next so suppose you go
visit this website this is an evil
website I need someone to really be a
show for me here like full-on show what
do you think when you first hit this
website yeah you're out I'm sorry so
work work with me here something's can
you work with me here
some what you're thinking let me guess
you're thinking Jim I have got to play
me some super fun games right now am i
right thank you
are you with me anyone so we're gonna
play some super fun games we're gonna
press one player and start game super
fun games now here's the problems who
here is currently logged into Gmail in
their browser right now confessions okay
good 20% 10% so I can now take your
Gmail again you're visiting evil calm
you logged into Gmail and said remember
me so you're logged into Gmail four days
at a time or 30 days at a time
so now I pop an iframe on my evil
website and I load mail.google.com over
HTTP and load your inbox into frame
now my evil website can't see your
cookies my evil website can't read your
email but my evil website can pop your
inbox in an iframe then I'll take the
iframe and I'll give it a specific width
and height absolute position push it up
front in front of the super fun games
I'll make the opacity zero what does
opacity zero do to a webpage to a frame
this frame it you can't see it but is it
hidden can you click an Ohio pasty frame
so
the problem here is by doing this
clickjacking attack I just made this
frame invisible but still clickable
let's go back to some super fun games
here let's play some hacker edition
super fun games let's hit one player you
ready one two three
one player click oops select all let's
try that again let's start game one two
three start game oops
Wow bad choreography delete so one
player select all two player start game
that's clickjacking I opened up a
website that you're logged into I made
it invisible gate a specific position
pushed it up front and again made it
invisible you think you're clicking on
super fun games but you're really
clicking on your inbox swiping it out
that's clickjacking how do you stop this
problem easy in Java
what's that X the X frame option
response header this is a header that
most browsers support today and I don't
recommend X frame option deny that tends
to break websites a lot of us use frames
in our website so X frame options
same-origin says only my domain can load
this page in a frame but nobody else can
alright this is not widely supported yet
so X frame option same origin this is a
response header you add to your web page
so when some evil website loads your web
page and their frame because the browser
sees this X frame option header it will
say ant it disallows the frame to load
your site it's a frame busting technique
it's not perfect but it's it works
fairly well there are ways to evade it
but they're very esoteric if you really
want to stop clickjacking even on
third-party older browsers we have a
manual way to do it in pure JavaScript
and I'm gonna move on we'll talk about
that editor at a different time
next access control how do most of us do
access control today when you look when
you think access control what do you see
in your code that does access control
pardon me
hide things in the user interface that's
completely not access control that's
obscurity that's
to circumvent but on the server side
what kind of checks do we usually do we
usually do this right role based access
control our back pirate based access
control if that was a that thank you for
the one person who laughed yeah you have
a bad sense of humor like I do I
appreciate it so our back if the user
this is actually the home the home page
of a large social media network from a
few years ago which I can't mention that
would be inappropriate it's MySpace and
uh if the user is a manager so during
the acquisition the managers like oh we
got it we got a we got I want to change
how the front page looks so he was like
changing the raw he was changing the raw
ap news articles and changing the
political bent of it and I'm like dude
this if you want to put your articles up
there no problem but if you're gonna put
like like change the raw off feed from
Reuters in the AP we're gonna get in
trouble
so I went it and he's like hey you do
what I say this is my website now so I
went to his boss I'm like mr. Murdoch
what do I do here I want to support your
acquisition and he's like you got to
leave them as a manager but be creative
Jim I'm like you got it you got it
Robert I'm with you so if the user is a
manager or if the user is an
administrator or if the user is an
editor and the user is not my crazy
manager Joe then let them edit the
homepage and so he caught me doing this
a few days later so I just made a new
page like homepage Joe that only he
would see when he hit the home page and
that kept him busy for six months so all
right laughing at someone's pain shame
on you all right
but this is an anti-pattern what if you
want to change the policy of this code
what do you have to do you have to push
new code we get to hand code this on
every page and by default if you forget
to add this logic it's open by default
when you code these kind of rules on a
page-by-page basis you've pretty much
broken every single rule of good access
control not to mention that this only
addresses vertical access control in a
hierarchy what if you and I are the same
role should I be able to edit your
password or see your reports or edit the
employees in your department no or we
may have different companies we manage
within a multi-tenant system so role
based access control is a complete
failure in the era of multi ten
see and I'm gonna recommend the Apache
Shiro product that a project is an all
these are open-source this is an open
source Apache quality access control and
authentication library that's not role
based its capabilities based which is
the way to go
I will never hard code a role ever again
everything I do is now capabilities base
and let me give you an example using the
metaphor of Star Wars suppose we're
building a Star Wars videogame and over
time we have these different characters
and I want to check if this user can
wield a lightsaber are you with me is
everyone here seen who here has not seen
Star Wars you're excused so we've all
seen Star Wars and we're breaking at
least a couple intellectual property
rules here but let's move on so if if I
was going to do hard-coded roles here
over time I would be like alright if the
user is a Jedi let them wield a
lightsaber then this guy shows up okay
if the user is a Jedi or if they're a
Padawan
let them wield a lightsaber oh shoot new
character if the users Jedi or if the
user is a part of one or if the user is
a SIF let them build a lightsaber and
then this dude shows up he's no Sith
he's a cyborg trained by a cyst but he's
just a guy in a cyborg outfit with a lot
of lightsabers so if the user is a Jedi
or if the user zapato on or if the user
desist or if the user is General
Grievous the Jedi killing cyborgs
trained by his tooth but not really
assists then let them wield a lightsaber
and this goes on and on and on han Solo
gets to use it at one point and we need
to change these rules for every class of
user and we're doomed to fail
we'll always be chasing the dragon to
fix that logic or how about this this is
how Apache Shiro does it this is called
a capability based access control check
if the user is permitted to wield a
lightsaber let him do it and now behind
the scene of this permit there might be
some database of roles and permissions
and data contextual checks not that hard
to build but we'll never have to change
its code ever again even as our policy
changes because we're again we're coding
to the activity we're coding to the
capability we're coding to the data
being accessed not the person and who
they are it's a much stronger way to do
access control and here's a data
contextual check
Spaceballs it also is everyone here
seeing Spaceballs use the Schwartz Luke
right so um if if so there in this case
the user is trying to drive a Winnebago
which is the spaceship of the space vol
universe right so we have the Winnebago
ided they're trying to edit some
pseudocode we now have the Winnebago ID
that's being operated on if the user is
permitted to drive Winnebago of that
number then let them do it this will now
give me logic to check the access
control for every single Winnebago
without having to ever change that code
ever again regardless of how my policy
changes gotcha
so I highly recommend you shift to a
more capability based model even for the
simplest of websites because guess what
the simplest of websites always turn
into complicated websites that's the
rule of website building so real quick
intrusion that I only have five minutes
I'm gonna punch fast here so intrusion
detection this is building detection two
points deep in code so if you haven't if
you have say a checkbox in the form what
should that checkbox be submitted as
what is it what are the only possible
values a checkbox in a form may be
submitted as checked or an empty string
no no no means that that was removed the
whole input it's only an empty string
for not checked or checked or your value
if it's checked what if it what if all
sudden you get single quotes semicolon
shut down semicolon could a normal user
ever do that no way only someone who's
intercepting traffic and modifying it or
who's saving your HTML and modifying it
only an attacker doing things a normal
user could never do so when I see a
checkbox being manipulated I know I'm
under attack or a drop-down select list
of country codes and also I get an I get
I have two digit country codes and also
gonna get like a ten digit JavaScript
string I know I'm under attack someone
is manipulating my request data so
there's these real easy detection points
sometimes I'll put things like a I'll
put a entry in robots.txt to like admin
secret login that doesn't exist on my
site doesn't actually
anything I'll just put this up there as
a honey token no normal user will ever
see that URL but it's listed in my
robots.txt to track to trap attackers to
hitting this to give me detection that
I'm under attack so there's a project
called the OWASP app Center project I
tend to not use this I tend to write
that intrusion detection code by hand
it's easy but there's the App Center
project that does much of this for you
I'm sorry
so all of HTTP is pretty much broken at
this point if you if you're using it and
depending on it it's basically a grand
illusion we've had different certificate
authorities who've taken their private
certificate sold it to private companies
who put it in a proxy server they can
now man the middle all of us in real
time so the only thing I know of to
really lock down HTTPS in in a in an
environment where I don't trust any of
the CAS which I don't
it's called certificate pinning I
basically take the public certificate of
my website and hard-coded in my mobile
app or my thick client or certain
browsers so when a man the middle rogue
see a certificate intercepts my traffic
and gives me a fake but see a signed
certificate I'm gonna detect that in my
client and block it I don't have time to
talk about this in detail but go look up
the certificate pinning cheat sheet
written by Jeffrey Walton one of the
main SS open SSL programmers and really
fascinating read in terms of how to lock
down the most secure clients even in the
face of low integrity CAS so last I have
two minutes last but not least
multi-factor authentication the era of
the password is dead folks passwords are
dead you do you agree with me when I say
that pardon me No who here agrees that
passwords as a credential by itself that
air is dead so can I get a video from
you I'm sorry I know that you came here
to listen and I'm making you do work so
can I get a the era of the passwords is
dead be with me on this you ready so
who's with me ready in the count of
three one two three
whoa thank you for that I appreciate
that I'm gonna watch that every night
now when I'm having tough so
multi-factor we're in an era where
multi-factor is a minimum you need to
build these days and look I'm not trying
to show for PayPal PayPal will give you
a multi-factor dedicated token that's a
credit card with a mini-computer in it
you press a button you get a tote you
get the token so we can spit out
dedicated tokens that are almost free
now how do you send the token you want
to either use email it's the worst way
to send your token but it's better than
passwords alone SMS is easy just to
sniff it's better than passwords alone I
prefer a mobile native app Twitter does
it with push the Beth consumer
multi-factor ever built
even if Twitter's core servers or hacked
their multi-factor system will not be
compromised the client generates the
private key and the server at login time
will push the code to the client instead
of having instead of doing it over SMS a
dedicated token is best a dedicated
physical token and printed tokens for
backup are are pretty common as well and
and your forgot last note forgot
password should essentially be a
multi-factor workflow go to any bank
they'll ask for your user name upfront
your account number they'll have you
answer a security question then they'll
email or SMS you a token then you enter
the token in now you can reset the
password this is much better than much
better than password reset links email
can be easily compromised so this
presentation will be up on SlideShare
later today any questions I'm Jim at a
loss org I hope this was a good use of
your time
shaaka Aloha a Hui ho thank you so much
for showing up everyone have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>