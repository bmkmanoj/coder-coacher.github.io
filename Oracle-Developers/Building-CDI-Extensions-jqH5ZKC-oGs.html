<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Building CDI Extensions | Coder Coacher - Coaching Coders</title><meta content="Building CDI Extensions - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Oracle-Developers/">Oracle Developers</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Building CDI Extensions</b></h2><h5 class="post__date">2015-06-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/jqH5ZKC-oGs" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">well for those of you that didn't check
the the bio or you missed it or whatever
I'm Jason Porter I worked for red hat
among other things that I do over there
I helped out on scene 3 for those that
you seem three I've done a little bit
with the CDI specification guys Pete
mirror max treuburg or marks treuburg
some of the other guys that are on there
as well i'm also a committer on apache
delta spike again those that were using
either Cody or seem three kind of know
the history behind that one what else
I'm based based out of Salt Lake so it's
nice to be over here in California a
little bit warmer than back home right
now I think that should do it twitter
handle email if you've got questions
afterward or whatever we don't get to it
feel free to send me tweets send me
email whatever so we're all good now
just to start off just a little caveat
what I'm not talking about on on this
talk for for those that were interested
in maybe some of the the base
fundamentals of cedia I'm not talking
about those so anything relating to jsr
299 346 which is j CDI to point their
1.1 or any of the standard CD I stuff
I'm not talking about those so if that's
what you were looking for I'm sorry this
isn't the the session for you and I will
not be offended if you walk up and leave
that's okay but what I am talking about
is portable extensions since the name of
the talk obviously now what what exactly
is a portable extension how do we do it
why do we have them all that kind of
stuff that and also testing and some
examples all of the examples that I've
got today come from Apache Delta spike
that's all up on Zhaan get we've got to
get hub mirror so you can check all
those out i'm also using some of the api
reference guides so I've got got some
links in the slides that you can take a
look at afterward the slides I do not
have up yet i'll be posting those i was
making some few last-minute tweaks but
i'll be posting those up and they'll
also be in my github
area as well so you can take a look at
those portable extension for CDI really
really what it allows you to do is it
allows you to extend the Java Enterprise
Edition platform beyond what is there in
the specification maybe it's something
that you need that they haven't done yet
or maybe there's something specific in
your particular application or your
business that isn't really covered all
that well or you've got one little
one-off deal it that you need to do
those kinds of things are what is
capable in CDI portable extensions like
I said we'll take a look at some of the
examples also if if you've got
extensions like like we didn't seem
three we're also in Delta spike that
look like they they might be good
candidates let us now let the CD i spec
leads know we'll see if we can get those
in we've seen some of those things from
from the same project from from cody as
well notably a lot of the things that
have gone into jameis two point oh who's
who's looked at that who's familiar with
that one okay so a lot of the stuff that
happened in JMS 2 point 0 actually came
from some of some of the guys helped
write the the same JMS project so being
able to do some of the CDI events I
don't remember exactly what went into
into the spec but ideas around listening
to events via JMS or publishing events
like that if those made it into the spec
like I said I haven't read it but if
those made it into the spec a lot of
those ideas came from some portable
extensions that that we wrote if they're
not then we've got them in Delta spike
great stuff to look at really helpful
just add some more ease of you stuff now
the the idea that they're portable and
not just plain old extensions means that
you can write them once and run them on
all of the CDE I containers to my
knowledge we have three right now so
we've got the reference implementation
done by red hat that's weld that's used
in most of the
most of the servers there's open web
beans from the Apache project that's
running in websphere i believe yep and
it's also in Geronimo Tommy's also using
it there might be a couple others but I
think that's about it and then candy
who's heard of candy Oh awesome few
people that is the CDI implementation
that the couch show guys done so if
you've heard of couch oh that's that's
what their date they're using they
brought some really interesting ideas to
to the specification mainly because they
rebuilt their entire application server
on top of CDI so everything is done with
CDI injections and observers and all
that kind of stuff are all done on top
of CDI so that's some interesting stuff
hopefully we'll take some of their
expertise in a future version of spec
and get some more se ideas into the
specification so what makes up a
portable extension they're really
actually fairly easy you know you say
portable extension and some people
coming to kind of get a little bit
queasy about what exactly the there is
there what I need to do is it difficult
part so part of kind of demystifying
that is what I'm hoping to do with this
talk as well they're very easy there's
only really three things that you need
to do not all that bad so those three
things are beans XML and of course if
you're familiar with java ee 7 that's
fairly optional in java ee 7 you need a
services file if you're not familiar
with that that's a actually txt file in
your meta f directory that trying to
remember the name what is it java x dot
enterprise dot context extension or
something like that and it's just a text
file line separated as far as what your
your classes are named that that
actually are listening to your life
cycle events and then of course that the
all-important java class
that POJO that's observing one of those
CGI lifecycle events that that will talk
to and as I was going back over this I
realized that if you're running on java
ee 7 there's actually only two things
that you need so it said that services
file and then your pojo so really that
they're not all that difficult to do
they're pretty easy to get up and
running and they're actually fairly easy
to test using some some of the stuff
we'll talk about towards the end so I
mentioned this idea of a life cycle and
I know we've got ed here and a couple
other people who's familiar with JSF so
light life cycles are fairly not not
really a new idea the cbi life cycle is
actually fairly fine grained and it has
a lot of extension points that you can
make use of so we'll take a look real
quick now it's it's actually somewhat
color-coded so this color over here are
things the server does for you the blue
ones are all of the all of the life
cycle events and then kind of this
orange color over here these are new to
CDI 1.1 now it's looking to me like the
fonts kind of not readable up here how
is it in the back alright well we'll get
into it but I'd like I said you can see
it's fairly fine grain it all starts as
soon as you deploy your application and
then server you know runs through all
its deployment stuff and then when it
when it starts kicking off the CDI
events then then it starts by finding
extensions so it looks for that services
file that that you've got over there and
it loads that up let's the the CDI
container know that we've got something
that's listening for life cycle events
sets up all the listeners and your
observers and then we go into our first
one over here before being discovery
right there so any anything you're going
to be adding to to your CD I deployment
runs in there then we've got actually
thats can archive so that that's going
to cover anything that is in your
archive itself so any of your
annotations
your qualifiers that that you've done
via via java files interceptors
alternatives scopes kind of kind of all
that stuff that's in there then then we
go through and we run through all the
the rest of the life cycle blah blah
blah blah blah like I said I'm we're
doing a deep dive so we'll get into all
this this part obviously the application
runs that cycles for a while depending
on how long your application actually
does run hopefully you don't bomb out
somewhere here and go straight down here
but that's you know that's all part of
building and testing extensions and then
eventually at some point in time your
application shuts down then we have a
another CD I event which is really kind
of for cleanup if you've got some
cleanup that the server itself isn't
isn't going to be doing we'll take a
take a look at an extension from Delta
spike that does some of that and then of
course we've got the application
terminates and eventually we start the
whole process all over again again I've
got time at the end for questions but if
you've got questions throughout the
presentation feel free to raise your
hand and I will do them my best to get
to him ok now doc the docs i mentioned
i'm doing docs so take take a look at
this if you're interested in the docs
the there is one little caveat if you're
looking for them via google so if you
look for CDI 1.1 api in google the first
result is actually the early draft
specification api docs go fig so you
won't want that one that is 1.1 EDR one
is what that is the specification
changed a little bit after that was
released so you'll have things that
won't be there in the final and you'll
be scratching your head going I thought
this was in there but definitely use use
that URL if you're interested in looking
looking at more about what's actually
there as far as Java Docs go so that's
this first one that I mentioned that we
we kick everything off and we start off
with the before being discovery now as
far as interesting things that are here
honestly unless you're going to be doing
anything with third-party jars so jars
that you're not going to crack open and
and mess with change whatever most of
these you don't really care about except
for ad scopes that one's fairly
important but definitely the Interceptor
bindings qualifiers stereotypes if
you're going to actually be adding some
of those from a third-party library that
maybe was written before CDI came along
but they've got some annotations are
using and you'd actually to make them
part of the cbi lifecycle part of part
of your application then you're going to
be looking at some of these there's not
really a whole lot to them adding
classes is really pretty much it like
like I said scopes scopes are a big one
if you're going to be adding scopes
scopes are kind of a two part because
usually you have a context that backs
your scopes also as far as scopes go
there there are two kind of scopes in in
CDI so you have normal scopes which are
actually most of them and you have
pseudo scopes now the big difference
between the two of them is that a normal
scope requires proxies so if if you're
building a scope that is going to be
proxying events maybe they span over
multiple threads or have a longer life
cycle then you'll want to do what's
called a normal scope otherwise it'll be
a pseudo scope now the the one pseudo
scope that we've got in CDI the least
that I know of out of the box is the
dependent scope which comes across
actually if you don't aclara scope
things are dependent in and of itself so
it doesn't require a proxy the container
goes and actually calls your constructor
and you essentially get a new instance
as if you did my class dot or new my
class just calling the constructor so
that's that's one of those things to be
aware of okay now here's the question
for the back how bad is that in the back
okay now I know we've got seats up in
the front so if you're interested in
seeing some of the examples move forward
like I said the these are all actually
out of Apache Delta spike so I do have
the name of the Java class over here you
can take a look at those the the one
that I'm showing over here they're
really we've got the the scope over here
now as far as Delta spike goes you'll
see this little activation thing in all
of the all of the extensions that we
have in Delta spike and what that what
that allows you to do is essentially
short-circuit your extension as early as
possible the more extensions you end up
getting in your in your application then
the longer it takes to start up because
you know it has to call all these
extensions and make sure it runs through
all the classes and all of that kind of
stuff so it can take some time so the
idea is that you can actually deactivate
classes in or extensions in Delta spike
well essentially with a properties file
and you we just make sure that we're
active otherwise we're going to bail as
early as we can so this one this one's
coming from the the view scoped this is
more reminiscent of cbi one point 0
where you had jsf wasn't fully
integrated with CDI so the view scope
wasn't there in jsf 2.0 and 2.1 it's
actually there now in 2.2 I don't
remember what you called it though head
okay it was a different package though
job back space you right
awesome alright so ed edd was just
letting us know that the the package
name changed in jsf 2.2 that's in java
ee 7 i've actually seen quite a few
things on Stack Overflow where that's
all that's been one of those ones make
sure your package names are correct
because the classes are named the same
so if you're doing any of that make sure
your double checking your package names
so what we're doing over here we're
adding a scope we've got a view scope
class over here and this first billion
over here is whether or not this is a
normal scope or if we're requiring
proxies and this other one over here is
if it's passivation cap capable so if
you're planning on passivating any of
those beans that are in your in your
scope or your context be sure to mark
that to true otherwise there you know as
soon as yours your scope is gone then
there could put if you have to change
servers or you know if you're doing
round robin or whatever they're gone
unless you're going to be passivating
those that's a flag also for CDI to make
sure that it runs through that
passivating in serialization information
the the next one that we go to after
after this is the process annotated type
and in in CDI 1.1 we we already have a
veto annotation it was something that
lots of people found useful and we
didn't include it in CDI 1 point 0 so we
included it in 1.1 but if you're going
through and you have classes especially
in CDI if you're using Java EE 6 and you
need to veto some of those most notably
I've especially told people to veto your
jpa entities and make sure you're doing
those with a producer otherwise you get
into some weirdness depending on your CD
I implementation your jpa implementation
whether or not they're doing some by
code manipulation and who's really
starting up the object whether or not it
can be persistent to the database yet
hey that's I've just found it better to
beat oh those those jpa entities just
right from the start one of the other
things you can do you can replace an
annotated type
again for for most of the CDI extensions
that you'll be writing you may or may
not find a use for it it's actually a
fairly in-depth idea where you're
placing replacing some of the metadata
again and let if it's stuff that you've
written yourself and you're probably
going to have the right metadata anyway
if it's a third party jar then you can
switch some of that stuff around i'll
definitely be careful when you're
replacing metadata so you don't override
something that was actually useful and
needed and we actually do have an
example of that one from from delta
spike this this one's actually kind of
trivial it comes from an example but
what for those in the back that may not
be able to see what we're doing over
here we come in and we're looking for
the named annotation to add it into al
there then we're going to go through and
if the if the first letter of that value
in the named annotation is uppercase or
actually going to go through replace
that with the lower cased version over
here now this builder right here this is
coming from delta spike for extension
authors it's actually really useful you
can actually pass it a a bean class and
it will read all the metadata from that
bean class and give you something that
you can actually modify most most of the
time things that come in that are
metadata on the classes you're really
not going to be able to mess with them
and have to build a new one and replace
it hence the the Builder from that one
and down here we're removing the the
actual annotation from the metadata so
we're removing the named annotation
which has the old al name in there and
then we're going to add a new one with
our new lower cased being named yet if
you can see it I know it's kind of dark
this one right here says named literal
what that is it's actually an instance
of the annotation that has the the new
the new setting on there literals were
introduced in CDI one point oh we have a
litter
builder in Delta spike that helps you do
some of that so you don't have to
actually write your own classes to
instantiate the the annotations so that
that comes in a little bit helpful and
then down there at the bottom we're
setting the annotated type so we're just
going through and replacing replacing
that this this next one as as it shows
up is new in CDI one point 0 in your
sorry 1.1 and one point the beam
interface in 1.1 they added a super
interface to that one called actually
it's a few slides letter but that that
one's called the beam attributes little
bit that one my bad if any of these
these ones conflict with previous
previous ideas then the the old ones in
CDI 1 point 0 are deprecated and they
want you to use the the new ones
obviously because c delta spike is
actually targeting CDI one point oh we
haven't done any 1.1 stuff yet I don't
have any examples but you you know you
can imagine what you're doing over here
removing removing some things from a
third-party jar that that you don't want
a injection an injection point I haven't
really found this to be all that useful
but if you're going to be integrating
with some other jsr 330 idea like spring
or juice trying to think what's and the
other ones are I know there's some on
Android but spring and juice are
definitely two of the big ones on java
SE and java ee then you can you can
change some of the some of the metadata
on an injection point and then one of
these you'll see adding a definition
error on a lot of these and what that's
going to allow you to do is specify an
extension or sorry an exception that you
can add and then at some point in the
the life cycle if you have any of those
exceptions that you've created and
registered then
the deployment will will bail and you'll
get that exception in your logs the
process injection target again you can
modify some of the metadata on an
injection target I I found this one to
be even less useful but it is there if
you need to interoperate with some of
the other third party stuff that's other
modifying a producer this one actually
has some interesting ideas that you can
do with it we'll take a look at an
example from Delta spike where you can
actually change a producer change some
of the metadata and of course add errors
so the the one that I've got over here
I'm going to pull this up I can remember
where my mouse is
you're going to find it new there we go
I'm guessing that's probably still too
small let's see if we can all right how
are you looking good okay get through
all the boilerplate bah blah blah like I
said earlier you can see that that check
in Delta spiked to see if this
extensions active bail otherwise got a
process annotated type over here this
this one this one is called the message
bundle extent extension and what that's
going to allow you to do is do type-safe
messages which is kind of an interesting
idea you know before if you're going to
localize your your application you've
got properties files that they're all
there and you end up calling the the big
long boilerplate java stuff to actually
do your messages obviously on the
front-end jsf and some of the other ones
have a shortcut for doing some of that
but if you're doing it inside your Java
code you know you've got a bunch of
stuff to actually go find the properties
file go load it up find what you're
looking for or find the key printed out
blah blah blah the idea here is that you
can actually create that we've got
examples but I'll just go over briefly
you can create a an interface for it and
annotate it with the message bundle and
actually the key or the value and then
when you when you want to output any of
that in your program you just do your
interface dot method and it returns you
a string you can do some replacement in
that string can do some message
formatting all that stuff so it's it's
all types safe and you get a little bit
better semantic idea on what it is it
that you're doing so with we're going
through and we're actually linking all
of those up inside this process entity
annotated type idea there's a lot of
code behind this to make it possible
that it it actually is pretty doable and
it's not too bad let's see if I can find
an example real quick
to show you what what it is that we're
doing and I am on the wrong browser
still wrong browser
there we go
really okay over here and it's not going
to do it for me awesome yeah you can
check it out on the on the delta spike
documentation I know we're lacking in
documentation but it is there and you
can check it out you can also take a
look at the the extensions the tests
that are there that are running process
beam attributes I mentioned that one
earlier so in the before we get to a
beam we've got a beam attributes which
has they pulled some of the metadata out
of the beam class and put it into the
the beam attributes veto whoops there we
go Vito got redefined over here on this
one so if you're in CDI 1.1 use this
veto if if you need to if you're working
in your own classes or a jar that you
don't mind breaking open and recompiling
then use the vetoed extension instead
that'll work out better for you and
there's that one there the the process
being you can get information from the
beam itself and be before we were
looking at ideas within the beam so an
injection point a target a producer will
look at it servers in just a minute but
this one is actually just for the the
beam itself so you can take a look at
any scope sidered find on it any
interceptors that it might have
stereotypes that that kind of stuff this
one this one's actually a little bit
near and dear to my heart the this one's
one that I wrote
and that's kind of actually how I got
started with with CDI is this extension
the exception stuff process beam okay
what what what we're doing over here go
away what we're doing over here is where
we're going to define a new way to do
exception handling in inside Java EE
it's all based on exception handlers
which are not really a new idea in Java
EE but it's a way to consolidate all
them into kind of one file or one
location and then you can do all of your
exception handling just with one little
bit we've got in integrations with JSF
with rest I know those two for sure
they're there might be some other
integrations that we've got you can also
integrate it yourself in your catch
block it actually works off of events so
you fire an event the payload is
actually the exception type and you go
through and do all that now we going
through it that we're actually looking
for a few annotations so we've got down
here if your class so the Java class
itself is annotated with exception
handler then we're going to go through
run through all all this stuff I
understand it may not be the most
performant code but I did go through
quite a few interation sovereignty this
is kind of the best I've out so we're
going to go through make sure that we've
got all that stuff and then we're going
to register a handler method which is a
method that itself has some annotations
on the the parameters so we're looking
for some of that setting stuff up that
kind of stuff but here you've definitely
got the idea that querying I querying
metadata from the Java class itself is
coming coming through from from CD I
process the observer method
going back to the i think i'm at a sink
yep I'm pretty sure I'm not a sink sweet
so you're you're going to be getting
information about an observer itself any
any of the metadata from the observer
parameters on that method ideas about
transactions so when it's going to run
as far as before after a transaction is
committed or rolled back and then of
course definition errors after being
discovering so after you've run through
all that kind of stuff we finally hit
this this point where we believe we
found all of the all of the beans at
least all of beans that are defined in
the class if for whatever reason you
have a new beam that you're going to be
adding you can do that here in CDI 1
point 0 1 point 1 has that that beam
attributes one that they'd prefer you to
use and then the the other one we
mentioned early on about adding scopes
this is kind of that second part adding
you scope is adding a context that
that's a little bit more in depth than
adding a scope so you've got to set up
your kind of your your secondary storage
for your your context where it's going
to live how you're going to find those
beans when they're going to be destroyed
when they're passivating all that all
that information so that's that's kind
of the the big one here and of course
you can create observer methods yourself
in an early version of the CDI one point
0 spec there was an XML configuration we
also had that in scene 3 honestly we
haven't had a whole lot of people asking
for it so we haven't done one in Delta
spike but that that would be one of
those ones where you're going to create
a new observer method say you instead of
defining all this stuff programmatically
if you'd like to have an XML
configuration or the animal or text file
or something in the database that has
all this information there you can
actually create kind of synthetic
observer methods off of like proxies
that you create or something like that
so you
you'd be registering those there one one
of the important things to note if
you're going to be adding a beam or a
few slides back of being attribute what
that does as soon as you've called that
and that method has executed then for
that being it's going to go back to
where where we were before and it will
fire all of those events that are
applicable for that beam if you've added
observers or producers all that it'll
run through that that whole life cycle
for that being again so you'll be able
to make any changes off off those this
this one predates the the new JTA spec
so in in Delta spike we we had the idea
of doing declarative transactions and
this this one is adding the the
transaction context so just just like
you can do in java ee 7 you can declare
you can declare beans as being
transaction scoped so they're going to
be around for the duration of that
transaction and as soon as that
transactions committed or rolled back
they go away there's quite a few things
that go in here because you know we
wanted in Delta spike we wanted to
support both GTA transactions and also
the idea of the entitymanager
transaction itself so there's a lot to
to go into that to be able to straddle
both both of those fences and the the
context is actually fairly in-depth in
that particular instance although the
the context itself has four or five
methods that you need to implement so
it's not overly complicated in CDI 1.1
there is a a new method and I had it in
my notes if i were to resync yeah
there we go in n CI 1.1 the the new one
is called alterable context that's just
a sub interface of context that has a
few things that are built into it oh no
sorry actually all that one declares is
the destroy so the idea that you can
destroy beans itself from the context a
little bit easier than going through and
actually destroying the whole context
that turned out to be something that was
a little bit problematic in CDI 1 point
0 so we made it easier in 1.1 after
deployment validation so after you've
gone through you've found all your beans
all this kind of stuff you want to make
sure that you don't have any exceptions
that everything's good to go and the
only thing you can really do here is
just verify like I said verify
everything's good if not add an
exception to the list and go with that
back to that to extension one there the
the exception one that I've got over
here and as soon as we find it yeah
after deployment validation like I said
it's not the best code I've got three
four loops that are all nested right
here so it has a possibility of being
very slow but we're going through and
we're actually making making sure that
we have all of the all the injection
points all of that information is
available from the bean manager and if
none of those validate then we're going
to go through an ad add an exception
over here and as soon as this lifecycle
event terminates then we'll have an
exception and it'll stop the stop the
deployment so that that one's just one
of those housekeeping things just make
sure that everything in your extension
is the way that you expected to be
inside the beam manager and you're
you're ready to go
now before shutdown I if you remember
look back back to that life cycle so
this is after your application has been
running for a while you've gone through
some some requests and you're ready to
terminate your application you have one
of these other housekeeping ones that CD
I fires so you can you can clean up
anything that the container doesn't
clean up by terminating the the context
so if you've got some beans floating
around or you added some stuff to the
database or whatever you can go through
and clean clean all that up the the
example we've got over here oddly enough
isn't documented in Delta spike so it's
actually somewhat unknown but it's
actually really cool who's familiar with
jmx okay we've got a few people now in
Delta spike we've got an extension that
will allow you to add a CDI beam as an
MB so you can listen to all of the the
CBI events and you can fire up
notifications via jmx and all that kind
of stuff in the before shutdown we
actually want to remove all those mbeans
so we go through and talk to the server
and unregister the the mbean that that
we defined earlier in this class when
when the life cycle was going through I
go through unregister all of those we're
actually spitting out some log info
clear out all the maps so that there's
nothing laying around if you've got
other applications running in your
server you know you want to clean up
memory as best as possible can being a
good citizen so that that one's there
for those that are interested in jmx
definitely take a look at this hopefully
it makes it into a later revision of the
jmx spec if that happens if not then
delta spike will be your way to go now
we've been talking a lot about Delta
spike so the questions you may have is
where is it how easy is it to use how do
I pull it down all that information so
Delta spike org that will actually
redirect to Delta spike that Apache org
but that's an easy easy or URL to
remember take a look at that it's all
based up and get like I said we have a
get mirror
you've seen a lot of these examples as
far as extensions that we have inside
dealt spike and you've seen a couple of
the helpers that we have as well so
among those other ideas now everyone
that's working in delta spike is either
a spec part of the spec for CDI or
people that have worked on other
well-known CDI extensions cody seem
three some other people out out in in
the community so if you're looking for
examples on how to create your own
extensions you can find a lot of ideas
here in delta spike from the people that
either wrote the spec or have a lot of
some of that knowledge on how to do it
in some of those best practices another
another helpful one as i mentioned
before a lot of that metod the metadata
classes that are in the life cycle
you're not going to be able to modify
very easily a lot of those are immutable
so we have some default implementations
for you that you can use that are
mutable we also have some immutable ones
as well that you can use from from those
builders so that should help get you
started on creating some of those new
metadata classes if if you need them and
then we also have some additional
helpers you saw the the beam builder we
do have some other ones so being utils
really just information working with
Java classes and some of the metadata
the the hierarchy discovery which is
actually really helpful especially in
CDI we're not only are the qualifiers
taken into consideration but also the
whole hierarchy of the class is really
what makes up the the resolution for
your your class itself for your beam so
we have some methods there to help out
find you know find the nearest parent
find find out whether or not this is
actually one of those times of kinds of
classes traverse the whole hierarchy all
that kind of stuff that you end up doing
through reflection which gets all kind
of nitty-gritty and lots of boilerplate
as we've got some stuff to kind of
abstract that away annotated you're
working with annotations a lot in CDI
obviously so some ideas on how to
traverse those create them
do doing some comparisons with them all
that kinda stuff is in Delta spike I
mentioned some of the Amidah bowl bean
wrappers that we have this this one's
actually really helpful I know from
experience some of the people that have
talked to me and some of the scopes that
I've created myself in contexts it can
be a little bit dicey going in and
creating some of those or you're going
through google or finding someone go
okay what do I do that looks good copy
paste dump it in Delta spike has a basic
context and some of the other
implementations that are that are there
to help get you started so you can take
a look at those you can use them if it
helps get you know kind of get you off
the ground getting some of those
technical details out of the way I did
mention the the idea of literals so
annotation literals this is what helps
you do that yourself so you can actually
pass it a an in-store a class and any of
the other values that you need to set on
there and it'll give you an actual
instance of your annotation so that you
can add it for example to two events
that you're firing off or two new
metadata that that you're going to be
adding the wrapping beam builder is
helpful if you already have a start that
you're looking at so a beam that you
want to modify you can pass that in and
use all the metadata from that instead
of building it all up from scratch and
then modifying what you need again those
that are interested in either looking at
the source or if you're interested in
helping out so that they're the get the
repos the the one up on github is
read-only mirror I'd love it if we'd be
able to take pull requests oh that's not
quite the Apache way unfortunately but
if you want the canonical repo it's
really ugly
but there it is as far as submitting
patches go through the standard Apache
way open up open up a jira attach a git
diff go go on that way and testing is
kind of this last idea that I have to
wrap us up so you've gone through you
built your portable extension you're
pretty happy about it although of course
you want to know that it actually works
and what the the best way that we have
right now to test CDI extensions and CDI
itself is true our Killian who's
familiar with arquillian I know we've
got it okay got more people in what I
was thinking one of the great things
about using our achillion tests with it
is that the CDI TCK in 1.1 is actually
built on top of our Killian so if you're
looking for information about it you can
take a look there if you're not quite
sure whether or not your container
supports it if it supports CDI 1.1 I can
guarantee you they have in our killing
an adapter for it because they have to
so they can test it all of the the
integration tests and actually a fair
amount of even some of the easier tests
that we have in Delta spike are all done
with our Killian so you can take a look
at those see how to do those tommy has
quite a few arquillian tests as well if
you're looking at some of the older
stuff seemed three has a lot arquillian
came out after cody was really kind of
established i don't think they have any
in there but definitely a lot of the
other places are starting to look at
arquillian and doing tests that way for
those i know we had a few that aren't
familiar with our Killian you can go
through and run your tests actually
inside the container so as far as CDI
goes you don't have to worry about
mocking out a beam manager or the life
cycle or any of that stuff actually
packaged up your tests do a little micro
deployment send it off to the server and
you will get those actual events the
full metadata with what your
expecting to run inside your container
during production so we'll be running
with that same same idea you don't have
to worry about mocks or stubs or trying
to spin up an embedded container I know
that's easier than what it used to be
although actually running in the
full-blown container has does have its
benefits I mentioned micro deployments
with with our Killian you can set things
up so that you you package up inside
your tests as much or as little of your
application as you need to you send that
crosswire and run your tests in inside
the inside the container now I do have a
couple of examples again through through
delta spike no tests for that one at
least not under that name so let's see
what comes up first that one looks like
nope I want you to come back
over here what we've got going on over
here this is a beam manager provider
test and it is not going to go anywhere
for me is it I think that's actually the
end of the file so only we've got one
test on this one the idea behind this
one if if you're running in in an area I
especially early on in Java EE 6 for
example in with JSF if you had a
validator or a converter then those were
not fully integrated with with JSF and
if you wanted to get ahold of a beam
manager that can be a little bit
difficult because you're actually in a
section that CD I wasn't available in in
Delta spike we made it a little bit
easier to actually get a hold of a beam
manager so we've got this beam manager
provider those in the back you may not
be able to see that but beam manager
provider get instance and that will
actually give you a handle on the
current beam manager so you can take
that query it do do what you need to
that that idea so if again those that
are familiar with arquillian this isn't
anything new we do have some some helper
classes that we've created and delta
spike to make these deployments a little
bit easier but you add any libraries you
need to any classes the the beans xml
file again this with CDI 1.1 add that
all up call it a deployment ad and
you're-- are killing and stuff over
there and then you run your tests make
sure all of your assertions are good
they're green and they pass but nothing
again nothing too special as far as our
killing goes for testing your CD I
extensions they're really nice and easy
complete fairly concrete examples that
that you can take a look at
no clothes now okay so just just to
recap again we should have plenty of
time for questions si si di portable
extensions they'll allow you to
customize the platform the specs that
are not the specs but kind of the
implementations themselves to any little
one-off or ideas that you need
personally for your application or for
your business great great addition that
we had in Java EE 6 it continues forward
in java ee 7 with some of these extra
ideas and i'm sure it will only get
better through later versions of the
spec we went through the the lifecycle
callbacks we actually spent quite a
quite a bit of time going through that
so that you you have an idea for your
own extensions what you need to do where
where you're going to tie in with any of
those lifecycle events those hooks that
CD i gives you and we did cover a fair
amount of ideas from delta spike if
you're interested in any any further
ideas or extensions at delta spike
hasn't it feel free to contact me
afterward or you know as you see me
throughout the the rest of the prison or
throughout the rest of the week i'll be
here you can use delta spike for ideas
for examples copy and paste code and
we're also very approachable on the
mailing lists the mailing list links are
there from delta spike apache org send
us an email if you've got questions and
then of course we briefly went over
testing their killing and how to make
sure that your extensions are working
properly in the way the way that you
expect them to so I've got two looks
like I've got about ten minutes or so
for questions it will be i don't have it
yet but it will be yeah and I'll have a
PDF available through java one that
you'll be able to get i will be putting
these up on my github repo so you can
see those as well uh-huh
ok
the there are some things in CDM one
point out repeat the question so the
question that we had is going back and
looking for metadata can be a little bit
difficult sometimes and your do you end
up doing very similar things to to
reflection some of it actually does come
down to reflection the question was in
CBI 2 point 0 or in future versions of
the spec but we have some of those ideas
that are available to us actually in CGI
1.1 we do have a few things that that
are helpful trying to think exactly the
names of classes I know there is a CDI
wow what they call it the name is xscape
in me but I definitely foresee some of
those things coming in future versions
if they're not already there in CDI 1.1
is that is definitely a pain point sorry
an archetype for CDI I know there was
one early you're with CDI one point oh I
don't know if there's a new one now or
not if there's not we'll take
submissions though other questions huh
and I'll create just fake data with some
application scope beans and one of one
of the problems are run into is I need I
need that to go out of scope and then
come back and so basically to leave
applications come back is that something
into I also use J rebel four is that
something I would create a CDI extension
for is there something in the CDI API
where I can tell the beam manager make
this thing go away okay so the question
and correct me if I'm wrong one we're
staying but creating demos and you've
got some data or some classes that are
application scoped that you need to live
for a certain amount of time then go
away then come back as the demo
progresses dorant okay during
development you could do that with with
an extension although if you're using
the application scope itself that's
going to be a little bit problematic you
could you create your own scope that
that you can do it that way
I it is early on your application scope
beans will start up pretty pretty much
after that verify verify deployment is
done so as soon as that's done as far as
CDI goes then everything that CD I does
in the life cycle is complete so you
should be able to use any of your beans
any of the beam manager information from
that I don't know of a portable way back
to your first question a portable way of
doing that as of right now if you want
something that that'll work you're
probably going to end up going deep down
into some of the implementation code and
doing that it's just bit of a
development right
right did we have one back here
stuff
mm-hmm
interceptors
ok the question wasn't really directly
tied to two CDI but more of a testing
question with our killing and shrink
wrap building building up some of those
micro deployments in arquillian can can
be difficult can be time-consuming I
feel your pain I have some some of the
same issues unfortunately I don't have
an answer for you I know Andy Rubin gers
or Rubin jurors here talk to him he's
going to be the best man you let's see
they have a talk I don't think it's
today but I know they've got another
talk later they're also down in the
exhibition hall at the the Red Hat booth
yeah they've got a mini talk that you
can take a look at there uh-huh other
questions okay we've got one up from I
observe that when writing my own custom
scopes for jsf I had to make sure to
fire the initialized and destroyed
events so there's a new CD I events and
one not one so I'd like to tell people
that they're doing custom scopes make
sure you do that right we had Ed Burns
here talking about creating your own
your own scopes and context so make sure
that in order to make sure that all of
your your beans are cleaned up well
while your context is being destroyed
make sure to fire off those those
lifecycle events for your context so
your app destroyed definitely and what
was the other one had initialize when
you're creating those make sure those
are done that that tells the the beam
manager and the CDI implementation
itself to make sure that that all
happens the way that it should also
because they are events it allows other
people to tie into it so you can modify
some some of that stuff yourself that's
definitely one of the one of the pluses
with CDI and doing things using the you
know kind of the event model so you're
firing these off and for the most part
you know their global so you can take a
look at them tie in as needed change
things a little a little bit here and
there but definitely definitely a pro
tip coming from Ed Burns
well if there's no further questions
which I'm not seeing any thank you all
for coming be sure to fill out the
evaluation evaluation forms lets us know
how we're doing hopefully if you enjoyed
it we can come back next year do all
that fun stuff again thank you very much
and those of you that are interested to
follow me on Twitter I've got my twitter
handle over here take a look and let us
know thanks everyone</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>