<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Analyser Bars Animation HTML5 Audio API JavaScript Tutorial | Coder Coacher - Coaching Coders</title><meta content="Analyser Bars Animation HTML5 Audio API JavaScript Tutorial - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Adam-Khoury/">Adam Khoury</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Analyser Bars Animation HTML5 Audio API JavaScript Tutorial</b></h2><h5 class="post__date">2013-07-16</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/IBHpSkGZtNM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in this programming lesson you can learn
to create custom html5 audio analyzer
bar graphics that move to the frequency
of the sound that is playing by using
aspects of the new JavaScript html5
audio API you can customize this tiny
script that I'm going to offer any way
you like once you grasp the concept
before we begin the lesson let's take a
look at our finished product so that you
can evaluate whether or not you want to
stick around for the whole video and get
deeper insight about the script and keep
in mind that any animations that you see
in my video are going to be slightly
more choppy than they are in actual
browser software because of my video
frame rate so you would see much more
fluid effects when you run this in your
environment okay we're going to start
with the bare bones of an html5 web
document this way everybody can see the
production from the ground up I'm going
to put any CSS from my little
application up here in my style element
any JavaScript is going to go here in my
script element and I can always
externalize the JavaScript by including
it if so if you want to externalize this
JavaScript at any point you can do so
and the same with your CSS and then
we're going to put a little bit of HTML
that our application will have right
here in the body element so let's do
that first let's create a div let's go
down a couple of lines and close that
div let's give that div an ID that's
equal to mp3 underscore player and then
inside of that div we're going to have a
child div I'm going to give that an ID
equal to audio box and this is where
we're going to programmatically add the
html5 audio element right here inside of
this audio box now underneath the audio
box inside of the mp3 player
we're also going to put a canvas element
I'm going to give that an ID that's
equal to analyzer this is where our
little animated bars are going to render
inside of this canvas element and let's
make sure we close this canvas element
and that is all of the HTML for the
application now I'm going to pop in some
CSS into my style element up top so you
can see the first rule is affecting a
div with an ID of mp3 player that's this
guy right here and we're giving it the
following CSS properties simple enough
then we're going into mp3 player
accessing its child div and then the
child audio element that's going to be
programmatically placed there using our
JavaScript so we're affecting that audio
element the html5 audio element that
will be placed right here in this audio
box and we're giving it these properties
then we're going into the mp3 player
container and affecting any canvas
elements that are within it that would
be this little guy right here and we're
giving it these properties very simple
now if we take a look at what this
simple HTML and CSS gives us you'll see
something like that and it's a centered
mp3 player container you'll see there's
no audio element that's all going to be
applied through our JavaScript here so
the first thing in JavaScript is we're
going to place a comment in that says
create a new instance of an audio object
and adjust some of its properties so
here we're going to show a programmatic
approach to creating an html5 audio
element which is creating a new audio
object so we save our audio is equal to
new audio object so this audio variable
is a new instance of an audio object
then we adjust some of its properties by
saying audio source is equal to track
one mp3 that's the sound file that you
want to play and we say audio controls
is equal to true because we want to see
the default audio controls audio loop is
equal to true this way the sound will
play over and over again when it reaches
the end it will restart all by itself
if you don't want that functionality
just turn true to false then audio
autoplay we set to false because we
don't want our player to play by itself
when the page loads if you do then you
just put true so if we have properties
like this and we render this in our
Chrome browser and you guys will want to
test this in Chrome because a lot of the
JavaScript that we're going to be
writing is going to be chrome specific
for now because a lot of html5 and new
JavaScript API s
and a lot of css3 for that matter is not
yet standardized until 2014 so I
recommend that you guys test in Google
Chrome for now and then when html5 is
standardized in all browsers then you
can just adjust your code to not have
any Chrome prefixes so if we render this
in our browser you can see we have a
sound our file is playing so really this
is a way you could just put background
music playing on any any webpage those
four lines five lines right there now
the next thing we're going to do in our
JavaScript is write another comment that
says establish all variables that your
analyzer will use so I'm going to
establish all of these variables that
you see here all these variable names
and my script is going to use those for
various things now under that line we're
going to write ourselves another comment
that says initialize the mp3 player
after the page loads all of its HTML
into the window so to do that we simply
type in Windows add event listener the
load event is what we're listening for
so when the window is fully loaded with
all this HTML we're going to run the
function called init mp3 player which is
short for initialize mp3 player and then
we use false as the capture state so now
we need a function called init mp3
player which initializes our mp3 player
so let's pop that function in right now
you can see it's sitting right here and
I'm going to explain every line within
it so when the window is finished
loading all of its HTML this function
called init mp3 player is going to run
and the first line within it we're going
to add the audio LM
that we programmatically create adhere
to the audio box div sitting on the page
so we're saying document I get element
by ID audio box dot appendchild the
audio element so basically an html5
audio element is programmatically going
to be placed in this audio box div then
the next line we're assigning our
context variable and we just make
context equal to a new audio context
object instance so we're creating a new
audio context object instance and that's
part of the new JavaScript html5 audio
API so if you want to really research
the new JavaScript Audio API you could
probably google the term JavaScript
audio api or html5 audio api and you'll
see all kind of information and you'll
also find the audio context object
information and we're using that to
create our analyzer so the next line we
take our analyzer variable and we run
the create analyzer method on the
context instance and the create analyzer
method is an analyzer node then the next
line we assign our canvas variable to
reference the equal actually we named it
analyzer instead of equalizer I was
going to name it equalizer but it
doesn't make any sense because it's not
an equalizer it represents Equalization
but or frequency but it's it should be
called an analyzer so we say the canvas
is equal to this element down here the
canvas with an ID of analyzer that way
our script knows where to render all of
these cool animated bars then we assign
the CTX variable to represent the canvas
get context method and we pass an
argument of 2d or the parameter that we
pass is 2d through the get context
method for the canvas now the last thing
we do when we're initializing the mp3
player in order for it to have these
cool animated analyzer bars we're going
to reroute the audio playback into the
processing graph of the audio
next and up here is where we assigned
our audio context object so for our
source variable we're going to say
context instance object and we use the
create media element source method for
the context object and we pass an
argument of our audio object so your
audio object gets passed through the
create media element source method and
like I said if any of these methods are
boggling your mind you guys can simply
go and research the html5 audio API
which is all still experimental
technology until 2014 you can see I'm
using WebKit references here that means
you should be testing this in Chrome
this won't work for you in Firefox or
Internet Explorer
until 2014 so when those other browsers
are respecting the audio API you can
then remove this WebKit prefix and just
call a new audio context object instance
so you see I have WebKit there just so
this works in Chrome for my experiments
and you can't complain if it doesn't
work in Firefox and Internet Explorer
yet because html5 and css3 and a lot of
new JavaScript is not even standardized
yet in all the browsers it will be in
sometime in 2014 I think and so far the
only thing in this script that we're
using a browser specific prefix for is
this one line right here so just
remember that in the future you won't
need any WebKit prefix there you won't
need a moze prefix or an MS prefix
either you'll just use the standardized
syntax which is audio context
okay so let's finish explaining what the
source variable is getting applied to it
so after the source variable is assigned
the context that create media element
source method then we run the connect
method on the source and actually let's
change this elements ID so we don't get
confused let's call it analyzer render
in the canvas so that canvas element
let's give it an idea of analyzer render
and we'll pass that through right here
for the canvas that way we don't get
confused about this analyzer word being
here and here as a variable name as well
we'll keep those separate so in the
connect method for the source we're
going to pass the analyzer variable
which is the analyzer node method then
after that we use the connect method
again on the analyzer variable and the
argument we pass through that connect
method is context destination and then
the last thing in the initialize
mp3-player function is we are executing
the frame looper function and that
function has not been written into our
code yet we're going to put it right
here under the initialize mp3 of play a
function okay now before we put in our
frame looper function let's write a
couple of comments into ourselves the
frame looper function animates any style
of graphics that you wish to the audio
frequency so any style of graphics or
whatever you want to animate to the
audio frequency can be done within this
frame looper function that we're about
to put into place now this frame looper
function is going to be looping at the
default frame rate that the browser
provides which will be approximately 60
frames per second or 60 times per second
now let's go ahead and pop in our frame
looper function and I'll explain every
line within it now remember that every
line within this frame looper function
it's going to be running many many many
many many times per second very very
fast and the reason why it does that is
because we're running the request
animation frame method on the window
object so this little bit of JavaScript
pretty much gives you a looping function
and in the past we used to use set
timeout and set interval to have looping
functions for animation purposes but now
it's recommended that we use the request
animation frame method instead of set
interval and set timeout when we want to
animate things on a web page if we need
a looping function but a lot of
animations can now be rendered through
css3 transition so you wouldn't even
need a looping function for
a lot of animations but for this
particular animation and the sound
programming that we're doing requires
that we have a looping function so I
just named it frame looper and this line
here is what's responsible for making it
loop over and over and over and over
again now the next line here is we're
acquiring an array that's a new instance
of the u int eight array object and
we're passing as an argument through
that analyzer dot frequency bin count so
basically you'll get an array that is a
representation of the data the sound
frequency then we take our analyzer
variable again and we run the get byte
frequency data method on it and we're
passing the FBC array through that
method now these two lines deal with
clearing your canvas every time this
function loops and setting the color of
your bars so if you want to change your
bars to yellow or red or whatever color
you want you do it right there it's very
simple this line like I said it pretty
much just clears the whole canvas and
then this variable bars is set to 100
because I wanted 100 bars to render now
this little loop will render those 100
bars at different little heights many
many many times per second every time
this function loops on itself so every
time frame loop or function runs which
is many many many many many times per
second is going to be a hundred bars
rendered at different heights many many
many many times per second so basically
this for loop is going to run 100 times
and that happens so many times per
second that it's mind boggling that's
how you get the nice dancing animated
effect so for each bar that's being
rendered in this loop you want to give
each one a different X position within
the canvas because otherwise they'll be
all stacked on top of each other along
the horizontal plane so what we do is we
take the I variable and you can see that
the first time this loop runs I is going
to be equal to zero so basically this
equation will say bar X is equal to zero
times three then the next time this loop
runs this will be a 1 this I and
basically the last time it runs it'll be
a 99 the
this equation will say bar X is equal to
99 times 3 and that just allows you to
space your bars so they're not sitting
on top of each other and you can change
these numbers play with these things and
see what effect you get now the bar with
each bar is going to be two pixels in
width and the bar height is really what
makes those bars dance up and down so
what we do is we take the frequency data
for this particular index in the FBC
array and we divide it by two and we
want that to be a negative number the
outcome of that equation to be a
negative number so we put a minus before
that equation and then we run the fill
rect method in the canvas and basically
that draws all of your bars it draws
each bar so each of the 100 bars is
drawn by this fill rect method and I put
a little comment in here for you that
says fill rect takes these four
parameters you put the bars exposition
basically the rectangle that you're
drawing it's x position it's Y position
its width and its height and you can see
the variables that were setting in place
for those four parameters right there
and since we're using WebKit prefixes
for now and it's not 2014 yet we're
going to test this in the Google Chrome
browser so let's render this in Google
Chrome
we get nice results yours would run a
lot smoother in your browser environment
mine my animation might look a little
choppy just in my video tutorial because
of the frame rate so when you basically
you run all of this in your browser
you're gonna see how smooth it is okay
so I hope that helps you guys get some
insight into how you can create cool
little analyzer bar graphics and I'm
going to show different kind of graphics
that can be created in different styles
of sound analyzers that you can connect
to your mp3 players and there's going to
be a lot more tutorials coming from my
channel about audio programming for
html5 and JavaScript because there's
really so much you can do this so much
software you can create that will run
online DJ software drum machines
tracking software like audacity that
kind of software could be made using
html5 and JavaScript and run online
people can record music directly online
your server can suck it right up</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>