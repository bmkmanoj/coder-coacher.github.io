<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>6. Web Intersect Forum Tutorial : Parsing the forum posts with PHP scripting | Coder Coacher - Coaching Coders</title><meta content="6. Web Intersect Forum Tutorial : Parsing the forum posts with PHP scripting - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Adam-Khoury/">Adam Khoury</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>6. Web Intersect Forum Tutorial : Parsing the forum posts with PHP scripting</b></h2><h5 class="post__date">2011-02-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/L5df4lAApmE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">all right moment okay when we last left
off we were discussing the new topic
page that's the page in the forums that
lets you create the new topic into
whatever section you want to put it in
we said in this video we're going to
discuss parse post dot PHP which is a
script which I wrote to accommodate for
parsing this page and the reply form so
if your a--they in the forum's you're
looking around you see somebody's post
you reply to it this when they submit
gets parsed by parse post.php and also
the new topic section right here this
this form both of the forms this one and
the reply form both get parsed by the
same script I'll show you how to make
your script aware of the differences in
those forms but it could be the same
script so you can save yourself a little
bit of work so let's go open that one
now pars post PHP I've already set mine
up and here I in the top I just had I
was echoing out values that was coming
from the forms that way I can see if
everything was posting right when I was
testing to build it that's what that
looks like right there but I'm going to
be removing that right now if you want
to put that in place while you're
testing that's cool it's a good way to
know that things are going right for you
create an SQL query to the database to
insert these things or before you start
writing conditional code to check them
so I'm just going to remove that if
you're listening to me describe
everything and I tried to put code
comments above everything the best I
could so you guys know what's going on
when you're reading the script so let's
get a general rundown of the file and
then we'll go in-depth on it so the
first thing is to start session next
thing is include your connect to my SQL
file this one is checked the HTTP
referer for light level security the
next one is be sure the user session
bars are all set next one is to be sure
all forum variables are present in order
to proceed filter all of the common
variables be sure the posted variables
match the user's session variables and
be sure they exist within your system
check the database to be sure that their
ID password and email session variables
all match in the database these are all
for security and these are checks that
you want to run just to make sure that
your system is going to be somewhat
stable and people aren't going to be
able to play games in it then you want
to check the database to be sure that
this form section actually exists
prevent this member from posting more
than 30 times in one day that'll help
you with spam injection add this post to
the database now the query depends on
the post type value here only if the
post type is a you run this code here
only if the post type is B you run this
code and this is we don't need that all
right now let's explain the fire section
by section in grueling detail and
remember you'll have your hands on all
this code soon enough once I release it
at web intersect it's going to be web
intersect version 1.3 for and it's not
going to be ready until it's ready so I
hope nobody is on these videos
commenting like Odom where's the code I
went to code give me the code Shh
just let me put it up and you'll go and
download it free some of you guys are
goober nuts okay check HTTP referer for
light level security what you're doing
here is you're using this variable as a
container to hold the server HTTP
referer variable which has been passed
through the parts URL function in PHP
PHP sports about 700 built-in functions
parts URL is one of them what it does is
it kind of sections out the URL it will
output an array to you and it sections
out different parts of the URL so you
feed it a URL string in this case I'm
feeding it HTTP referer and parse URL
will section it out and pump out an
array you can gather values for the
different sections of the array so what
I'm doing I'm gathering the host section
out of that array so I'm targeting the
host index in that ref variable because
this variable is going to be holding an
array that part
URL spit out you can access the hosts
index and get that value here into this
variable then you just simply say if
host is not equal to WWE web intersect
comm this you change to your website if
you leave this saying WWE better sector
comm is not going to work then I'm going
to echo out if it's not web intersect
comm I'm going to echo out poopoo on you
weenus and then exit the script because
it should always be posting from my site
anything that's coming to this script
should be posted from my site now there
are some slick people out there that
know how to forge or spoof the headers
the referrer and all that but this will
block most people doing stupid things
when they're trying to forge submissions
from their site into your forms because
what some people will do is try and buy
pass your new topic form and your reply
form and they'll parse straight the
parse request straight to your parts
post up PHP script without using your
forms or anything they'll just send
variables to it these pranksters okay so
that's that section now you know I
explained in depth I hope you know now
the next one is be sure the user session
variables are all set let's take a look
at that if it's not set the session ID
or if it's not set the session username
or if it's not set the session user
email or if it's not set such an user
pass let go out your session has timed
out weenus exit now let's discuss that
what do you mean Adam your session has
timed out how can I tell somebody the
session is time - how do I know what
happens is sometimes when people logged
in to your site if you use in session
variables and not cookies together which
this basic forum system that I'm showing
in tutorial here does not use cookies at
all it's just session based if you want
to add cookies instead of sessions to
your system then you'll have something
to where nobody's session will ever
timeout of them but there is some
occasions where some people they're
typing in for 20 minutes or 15 minutes
into the forum and sitting there idle on
the page their session will expire
they'll press submit phone they just
lost everything and the system doesn't
even see them as logged in anymore
that's why you want to use cookies maybe
but I'm just handling these things very
roughly right now just for the just for
the sake of I want to get done with this
tutorial series but you might want to
handle this more smoothly I don't know
maybe you want to use cookies so this
never occurs but no but just be aware
the sessions do timeout and here's
another hint for you guys that are
paying attention on your server in a PHP
dot ini' file for the configuration of
PHP you can make it to where sessions
last much longer
nobody will timeout extend your sessions
in your PHP dot ini' file you'll see
what I'm talking about
nobody will timeout nobody session will
expire if they're sitting there even for
20 minutes on a page not doing nothing
they can sit there on the page go make a
sandwich take a dump come back the
session will still be in place so all
I'm telling you is that you can go if
you have PHP that any privileges on your
server you can go into PHP dot ini' and
set the session file length all right
the next one be sure all form variables
are present in order to proceed let's
look at that if it's not set the post
variable of post type or if all of these
others aren't posted as well to this
form I'm going to echo out important
variables from the form or missing
weenus and then exit these things should
never happen every time you see
something that says the weenus and then
exit those are things that you just want
to account for but should really never
happen but if they do is somebody's
being retard too playing around trying
to mess with your system you know you
can echo these things out you don't have
to worry about insulting somebody just
remove the word weenus and you'll be
fine I just threw it in there to be
funny but really that to a normal user
who's using your system right some of
these things should never occur all
right filter all the common variables
basically all you're doing here is
filtering all the variables so it's safe
to place them into a database when it
comes time to and you can use MySQL real
escape string on this user pass put the
MySQL real escape string PHP function
wrapped around this that way you can
make sure that one's but all of these
other ones are using preg replace and oh
yeah this one's very important and Poe
type you don't have to worry about
filtering that one because the script is
going to take care of that in a second
and your post body you don't really have
to worry about filtering that one out if
you're going to use HTML special chars
the way I'm using it here and you can
run MySQL real escape string on that
after you do this but let me explain
what's happening here because this is
very important this line right here is
taking there the text area post whatever
there is for their post the whole body
section of their post has taken that
text areas value and it's running the
HTML special chars and nl2br functions
on that on that string data and what's
that what that's going to do is say
somebody types in script tags into your
system or maybe they just type in HTML
they want to show somebody some code if
they're helping them out in the forums
or whatever if they type this in you
don't want these characters to be
inserted raw like that so you use HTML
special chars to convert these to
convert these to their HTML code
equivalent that way script tags won't
run HTML tags image tags won't run links
won't run but they'll display and in a
forum like web intersect where we're
going to be talking cold most of the
time I got to make sure that tags on
process they only display so I'm using
HTML special chars to make them convert
them to HTML special characters
now the nl2br what that does that'll
find every every line break within the
string and it will place a break tag an
actual BR tag where it finds that line
that new line okay so now you know
exactly what's going on with my post
body now when you're using a WYSIWYG
rich text editor those that
functionality might already be taken
care of for you within the WYSIWYG but
still you want to be aware of what's
getting inserted into your database so
like I said on post body you might even
want to take this variable here post
body equal to MySQL real escape string
in parentheses there
you place the post body variable so that
way you're making sure you're running
MySQL real escape string on that after
those things occur well make sure we get
a dollar sign here there that should
work and there you go so let's filter
all of the common variables and you guys
know what preg replace is doing by now
preg replaces solid that there's nothing
better for filtering our unwanted
character system preg replace when you
know that there's only certain kind of
characters that that form variable
should have in it it's very safe to use
preg replace to just remove everything
that could be a danger to your system
but in when there's situations where you
can't just strip things out of the
string like that you can use HTML
special chars you can use MySQL real
escape string to make sure that the data
is secured before it goes into the
database and things like that so let's
collapse that backup and the next one is
be sure the posted variables match the
user's session variables and be sure
they exist in your system this is very
important too because you don't want one
member to impersonate another member so
let me open up this one again filter all
the common variables show you where
we're acquiring member ID there that's
from the posted form variable of UID and
that goes into a variable called member
ID so whoever is posting the form
whenever the typing it in the other that
they press submit that UID is coming
along with all what they typed in and
everything the name you can scoop it up
so what you do here is you say if
there's session variable of ID which is
a another independent variable that you
can cross-reference against that member
ID so this one is a really it's like a
little cookie file in their browser and
this one is the one that came posted
from the forum so you just make sure
that those match so if session ID is not
equal to member ID or session user pass
is not equal to member password then you
know that this person is trying to
impersonate somebody else
so you echo out your ID and or your
password is amiss
- and exit okay so let's collapse those
variables back up now the next one is
check the database to be sure that their
ID password and email session variables
all match in the database which you
don't really have to check if they're
right here I said be sure they exist in
your system that's being done right here
nevermind you're seeing right here
basically you're checking the database
to make sure that they are who they say
they are and make sure that they exist
in your system so you really you don't
have to code that into the section above
because it's right there so that takes
the member ID and it makes all make sure
all the session variables match that in
the database and you're checking to make
sure that that person actually exists
then you check the database to be sure
this forum section exists because you
don't want somebody you know playing
around and posting to some forum that
doesn't even exist in your system that's
all that code is doing right there you
select all from forum posts where the ID
equals forum section ID and the title
equals form section title so you're just
pretty much checking that the ID is
there and the title that sections title
is there before you process things now
prevent this member from posting more
than 30 times in one day
so you make a query to see how many
times they posted within this day limit
32 because you don't have to have a huge
query on that and you get the number
rows from that query and if the numbers
is greater than 30 then you just echo
out you can only push post 30 times day
your maximum has been reached takes it
now you might not want to run that you
might want to let people post a thousand
times a day within your system
I don't thirty is more than enough I
should make that twenty and this will
help you a little bit with spam
injection as well now add this post to
the database now the query depends on
the post type value only if the post
type is a we run this code only if the
post type is B we run this code so let's
take a look at the a first and a is when
they go to create a new topic if they're
on your new topic poem when they press
submit
that's when a comes into play so let's
talk about that if post type equals a
we're going to
strip everything off of the post title
except the allowed characters that we
want using the preg replace function
then we say if the post title is equal
to nothing it's blank
you echo out the topic title is missing
weenus and exit if the string length of
the post title is less than 10 which
we're checking for in JavaScript before
it even gets to the PHP but this is just
like a double block against people who
are trying to put in small little titles
to the forum thread if it's if the
character count in that variable is less
than 10 you go out you topic titles
listen to 10 characters witness and you
exit then then we run a MySQL query
function insert into forum posts that's
the table forum posts targeting the
fields of posts author posts author ID
day time type section title section ID
thread title and post party we're
targeting those fields and we're putting
in these values the variable for post
author variable for the member ID now
which is a way to put the current time
and date down to the second then the
value of a for the type form section
title ba-ba-ba-ba-ba all the variables
that corresponds with these fields and
you have access to all these variables
already if anything is wrong with that
query you'll get the dive function to
tell you what's going on with the MySQL
error but there should be no problem
with that query and I've already tested
it extensively then we create a variable
called this ID and it's going to hold
the value of the my SQL insert ID and
what the my SQL insert ID function does
in PHP is it will attain or gather or
find out what is the inserted ID from
this query so whatever the last query
was that's an insert type query this
function will gather what the ID was for
that thing that was just inserted isn't
that cool cool so we take that variable
and we can put it on to the header
function where we send the person to
view thread dot PHP with an ID variable
of this ID it's beautiful so once it
gets put into the database
you uh sure them directly to view it
live we're going to view the thread live
right after they post
and that's how you get them to that page
now view thread dot PHP you have not a
main scenes yet and I'm going to show
you that right now I mean now before I
show you that we're going to discuss the
last little bit of this script which is
if the post type equals B so if the post
type is equal to B then we have to get
this ID which is a different variable
that has to be sent using the reply form
because how else is your script going to
know what topic what thread that the
person is replying to you got to send
that thread ID or the topic ID to this
script if the post type is B so what
we're doing is running preg replace to
filter everything out of that variable
except numbers so we run a little if
condition here to say if this ID is
blank the thread ID is missing witness
exit then you SQL query and put
everything into the forum post table
just like we did above in the a section
but this one's a little bit different
this time we're going to put the
original topic ID the original topic ID
has to be set for this B type of post
and that gets this ID which is right
here that's the one you post I'm going
to show you that I'm going to show you
the reply form in just a second and the
reply form is on view thread PHP because
that's where if you want to use jQuery
and be cool like that you can write
where the person's reading the form
thread is where they can reply which is
a cool way to do it and that's that Jack
now what you do here is at the end since
we're using jQuery and it's Ajax
mechanisms we just strip the splat
strips lashes of what the post is body
was with the person typed in and echo it
straight back to jQuery because jQuery
is waiting if the post type is B that
means they're replying you know the
reply form uses jQuery and Ajax
mechanism so basically it's waiting for
this script to finish running insert
things into the database and it's going
to gather back it's going to get echoed
back the post body that way you script
in real time and it all happens in a
split second your script in real time
will get the post body back and be able
to display what the person just typed in
pretty much the way Facebook does it
when you type in something on your wall
or somebody else's wall it's basically
just J
query and Ajax mechanisms okay so I've
explained the crap out of that file in
great detail you should have no problems
with what's going on in this script so
I'll just put out one last video the
next video is going to discuss the last
page that you haven't seen yet which is
view thread so if you click on any
thread this is view thread PHP and you
can see that my session expired so it
says you must log in to respond and
click that takes you to the login page
but now my cookies should have jumped in
now that I'm on the regular directory
that's what I'm saying you might want to
use cookies in your system because watch
if I go back to the forums now and I go
back and look at a thread see the
buttons there it says post a response
even though I didn't log back in what
happened was when I go to web in a sec
home page
it's logged me and automatically with my
cookies so you might want to add cookies
to your forum system to the way nobody's
session ever expires now let's take a
look at what this guy's saying great
forums you should seriously think of
allowing bbcode you should think of
allowing bbcode or just add a WYSIWYG
rich text editor and keep everything
super simple BB code is a lot more
complicated for folks to figure out then
a WYSIWYG WYSIWYG JavaScript WYSIWYG
rich text editor would be the best thing
that you can implement all right so stay
tuned if you're interested to hear how
beauty HP works that's the one that has
the jQuery and the Java Script all
involved in it to shoot the information
to PHP and MySQL using Ajax
functionality and that one will be the
last video of the series and then I'm
going to put the source code into
version 1.3 for I'm going to test
everything make sure the system installs
and runs correctly and then when it does
I'm going to put out the source code so
you guys can get at it if you happen to
miss anything in the videos all right so
this is one more part that's going to
discuss one more file</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>