<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>13. User Profile Photo File Upload HTML Form Tutorial PHP Parse Script MySQL | Coder Coacher - Coaching Coders</title><meta content="13. User Profile Photo File Upload HTML Form Tutorial PHP Parse Script MySQL - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Adam-Khoury/">Adam Khoury</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>13. User Profile Photo File Upload HTML Form Tutorial PHP Parse Script MySQL</b></h2><h5 class="post__date">2013-02-11</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/NJZBl5KXdXc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">in this part of the series you can learn
to allow your users to change their
profile photo this lesson will help you
get comfortable with the PHP and MySQL
side of creating image upload
applications and offer you a simple
front-end interface before we dabble in
the code let me show you the way it
works and if you like it you can use it
on your website as a temporary way to
achieve this goal until you enhance it
or change it to your liking
I've had a few people ask me how I got
this output on the index page just this
temporary output that I'm showing in the
index page and I'll also show you that
code put onto the Avatar code so if the
user goes to their profile and they're
logged in when they hover their mouse
over their profile picture they're going
to see a little button pop up it says
toggle avatar form and when they click
that the avatar form is going to appear
with a little opacity set to it over
their profile picture and they can
toggle that on and off because they want
to change their avatar all they have to
do is choose a file so you can see I
chose one pirate that jpg from my
computer and I'm going to upload it now
you see and it changed my picture and I
can go ahead and change it again if I
want as many times as I want and that
picture does not get saved or stored in
any sort of gallery within the system
but later on I'll show you guys how to
produce galleries for your system so
that's going to be pretty much the meat
of this lesson is showing you how to
allow your users to change their profile
photograph or their avatar for their
main profile picture and it will always
be the newest version of that picture
that people see you won't have any
browser cache issues for instance if
somebody goes to your friend's profile
and they see a certain picture it's
always going to have a new name when
they upload and change their avatar and
we can save that in a MySQL database and
that serves as a way to cache bust that
picture every time they upload the
picture gets a new name so that way it
will never show the old picture that
might be cached in the user's browser
software or their friend's browser
software now even though what you just
witnessed appeared to be very seamless
without page refresh it's not Ajax
that's used to post this image and
there's probably about a million
examples different types and different
flavors for using Ajax to upload photos
and upload files to the server you don't
have to do it in the traditional way
that I was doing it here you can use any
approach that you want to upload images
to your server I'm just going to show
you this basic method that you see in
place on the site right now you can use
any framework you want some frameworks
use
i frames in flash for backwards
compatibility with older browser
software and there's also a lot of new
Ajax functionality
it's called xml httprequest - basically
it's just ajax level 2 which added some
new methods and event handling so it's
now possible with html5 and javascript
alone to upload images to the server
using Ajax without too many hacks and
workarounds
but for backward compatibility you'd
want to use some older examples in older
code you don't have to use a framework
for it you can create the code from
scratch but you'd have to set your
content type up just right and the
boundaries for hosting a multi-part form
data - Ajax or through Ajax so posting
multi-part form data through Ajax means
that you have to change your content
types in the whole way that the header
request is created to be a cross-browser
and backward compatible way to use Ajax
to upload images to your server or any
files video files or whatever and I'm
going to do a standalone series on Ajax
that will take you guys way in depth
about all the new features of XML HTTP
request level - ok and now before we
show that code I'm going to show you the
code that renders what's here
temporarily on my home page because a
few people have asked to see that code
so here's my index dot PHP page you can
see the first line I'm including my
check login status dot PHP script and
then the first SQL syntax is select
username avatar from the users table
where avatar is not know and is not no
means if it is not empty so if their
avatar field is not empty that means
they have uploaded an avatar image to
their profile and they're activated
field is equal to one then I order them
by random limit 32 that's how I get 32
random people to show up on the home
page only if they're activated and only
if their avatar is not empty their
avatar field is not empty because a lot
of people won't bother to upload an
avatar maybe you don't want to show
those kind of people because they're not
active on your site or whatever so
that's good query logic to get the
result you want in that case then you
simply run that query then you
initialize your user list variable
because the user list variable is where
all of the users will get appended to so
within this while loop all of those
people come pouring out and their
specific variables come out one at a
time so you can grab their user name
their avatar and set up their profile
picture link which is simply a link to
or they pass to the user folder and in
the user folder you'll have a folder
with their name and in that folder is
going to be stored the JPEG GIF or PNG
whatever kind of file the uploaded as
their profile picture and since you know
that each of these people coming out of
this loop definitely have an avatar that
they uploaded to the site already and
you don't have to do any condition logic
to show the default avatar for your site
and then you just pack them all into the
user list you put a link around them so
people can click and go to their profile
and then within that link you have an
image tag which shows their picture and
you just put their profile pic path
variable right there see profile pic is
the path to their image and you simply
put that in the source attribute of your
image tag and then you can put the alt
tag of their user name or whatever you
want there and you can see the style
that I have in place for each of the
images and you can put that in your CSS
down here in your head tag and remove it
here but I just threw it in line because
this is all temporary stuff anyway so
that's how I get this randomized list
you see every time i refresh the list
randomizes so that's how we get a
randomized list of 32 people only the
people that have uploaded their avatars
you can see on my profile there's still
a lot of people that are using the
default avatar they have not uploaded
their profile picture yet now to get
this count is very simple the total
users within your system you can use
this kind of syntax select count ID from
users where activated equals one and
there's no limit set on that then you
run that query gather the roll out by
using MySQL fetch row on that query and
you really didn't even select a field
what you're doing here is your count
the ID field to see how many there are
so you'll only get one array item and
you can access that array item in the
row by saying zero index on that row
variable pack that into a variable
called user count and then you just echo
that down in the page wherever you want
see I have an echoing heel and my user
list that goes here okay so this is the
files that you're going to be getting
within this lesson it's going to live
all the source code is going to live
under the video at the Bela PHP comm I'm
going to give you the whole user dot PHP
script over again because I added some
variables to initialize here like avatar
form and in that condition where we were
checking to see if the viewer is the
account owner I put some more logic so
we have that profile pick button and
that's the button that appears when the
user hovers their mouse over their
avatar an avatar form variable that gets
this little form put into it and that's
the form that you saw that appeared over
there avatar that allowed them to change
their avatar or they photograph and this
only appears on the profile if the user
happens to be the account owner then
there's also CSS that's been added for
the div that is the profile pic box and
the profile pic box form that's within
it and the profile pic box link that
little green button so this is how you
style that little green button this is
how you style your form and this is how
you're styling your profile pic box and
then the image that's within it now if
you guys really want to see an in-depth
tutorial about this code I just made a
video on that to the CSS video I put out
right before this one see right here on
my channel the CSS tutorial CMS hover
options and this video discusses the
inner workings of that functionality so
if I'm at my profile you see when I
hover I get the little button that's
what that tutorial is all about so you
can understand the CSS a little bit
better if you go and you watch that
tutorial if you like it now I also had
to add one function into main j/s so you
can see this friend to toggle function
that was here for your friending
mechanism your block toggle phone
let me just collapse those because we
cover those in earlier lessons so I
don't want that getting in your way and
actually this should not be here at all
and all I did was I change this function
name to friend to toggle so you can see
everywhere it's referenced its friend to
toggle now and you don't even have to do
that
that could remain friend tile hey let me
just make it friend toggle again and
then up in the HTML where that button is
created where is that right here friend
to toggle I was just testing with things
so I renamed that function temporarily
but I'm going to name it back to friend
toggle now so it's friend toggle they're
there and these two places up here where
it needs to be so everything is
hunky-dory okay so the important part is
really understanding this form that's
going to appear and you can see it's
posting or its action is PHP parsers
folder photo system dot PHP I'm going to
give you a file called photosystem PHP
and it'll be under the video and you can
copy all of the code but you want to
make sure you put it into your PHP
parsers folder along with your block
system in your friend system parsers
okay so let me show you photo system
really quick now this will handle
uploading the picture to your server and
even if you use Ajax for posting the pic
to the server you'll still need this
sort of PHP in place to handle the
upload so the first thing you do in that
file is you include the check login
status type PHP and you're checking here
to see if the user is okay in the log
username actually has a value and if it
doesn't then you exit so here's the full
extent of the code here it's not that
much and here is what happens we say if
is set the files array avatar name and
the files array avatar temp name you can
see in our form the file field is named
avatar so you can scoop up the files
array with the name of Avatar and you
have access to the avatar name the temp
name is where it's stored in your PHP
temp folder on your server before it
actually gets moved using the move
uploaded file function in PHP you also
have access to the file type the file
size and the error code and actually if
you want to see all of this code really
in-depth explained very in-depth I have
a PHP series on PHP image processing for
uploading images to the server resizing
them cropping them putting watermarks on
them and all kind of tutorials along
those lines at develop PHP com in the
PHP and MySQL video section is there is
where you can find that PHP image
processing series so if you really want
to go in-depth about PHP image
processing you can do so there this next
line gets the file extension or
basically it explodes the file name into
an array and then you can grab the last
element off of that array the end
function will grab the last element off
of an array and you know that the last
element in that array since you're
exploding that string by the dot the
last element will be the files extension
so you can put that in a variable called
file extension then we list the width
and height by using the get image size
function on the file at its temp
location on your PHP temp folder that's
how you can get the width and height of
the image that the person is trying to
upload and you can say if the width is
less than 10 or the height is less than
10 that means the image has no
dimensions or is a weird crazy thin
shape that you don't want so you can
just header them to the message PHP page
with an error of saying that image has
no dimensions and then you exit the
script if the image does have dimensions
then you're going to set up a database
file name for that image using the rand
function which will just basically give
you a random set of numbers so you'll
have I think it's 12 you'll have a 12
digit random number created and it'll
say those 12 digits JPEG or gif or dot
PNG whatever file type the user is
putting up so that's what you store the
name as in their database field for
their avatar and you're also going to
name the file that on the server that
way in your database
you just have a string that refers to
that name of that file and then on your
server in the folder system is where you
actually store the media and it will
have the same name on file in your
folder as it is referenced in your
database and that's how you can store
strings for image names in your database
but not have to store any binary data in
your database itself you can store all
that binary data and media files in your
folder system on your website not
directly in your database so then you
run a condition that says if the file
size is greater than one megabyte and
you can change that to whatever you want
if the file size is greater than one
megabyte then you give them an error
message saying your file was larger than
one megabyte exit script else if the
file is not gif jpg or PNG type then
you're going to give them an error
message of your image file is not JPEG
GIF or PNG type else if the file error
message from the file upload here file
error message is equal to one that means
some error occurred with the file then
you give them a message of ever and
unknown ever occurred and you exit
script then what you're going to do is
pretty much delete this little bit of
code here deletes their current avatar
picture out of their folder so you
select avatar field just the string of
their picture from the users table where
username equals this login user limit
one then you run that query then you get
the fetched row from that query into a
variable called row and then you can
simply access the avatar by saying row
index one and that will give you the
first item in that row and there's only
one item in that row because you're only
selecting one field select avatar from
users you see so you're only going to
have one item anyway which is the avatar
then you say if the avatar for that user
is not equal to nothing that means they
have already uploaded an avatar and they
actually have a file sitting in their
folder for their avatar then you set up
a link to that file and then you say if
that file exists unlink it and basically
unlink is deleting it out of their
folder then we're going to use the move
uploaded file phone
to actually upload their file to the
destination directory we wanted to live
because temporarily lives in the PHP
temp folder and we pack the move
uploaded file function into a variable
called move result so that way we can
evaluate it so basically you're taking
the file from its PHP temple okay ssin
you see this file temple oak variable is
created right here and that is the files
avatar temp name the temp name refers to
the file where it lives
in your PHP temporary directory your
temporary uploads directory which is not
a folder that you ever created it's just
at play on your server but it's not a
file that you have to go and create your
PHP 10 folder is just there and it works
and that's where things are temporarily
stored until you move them upon upload
and that temporary folder is flushed
frequently and that's also something you
don't have to do your server does it
automatically so I just wanted to
explain that is your first parameter so
you take it from its temp location and
you put it where you want it to live
that's the path and the file name of
where you want it to live and you say if
the move result is not equal to true
that means some kind of problem happens
with the move uploaded file function you
can ever message to them file upload
failed and exit script so if the move
uploaded file function happened
correctly this code would get bypassed
and skipped over then you include once
from your PHP includes folder the new
file that I'm going to give you today
called image resize dot PHP now image
resize that PHP is a file that you can
include into all of your upload
processing scripts if you ever want to
resize an image because some people
might upload really giant pictures from
their computer to your to your website
system and you don't want to just upload
that giant picture it might be a
megabyte what you do is resize it and
get it down to you know 20 kilobytes
something really small so instead of
2,000 by 2,000 pixels it'll be 200 by
200 in Lybia and actually reduced remade
file using the original file that they
upload you can just ditch
their original vial it actually gets
overwritten
so they upload that whatever big giant
file they want to upload but what your
system does is it resizes that original
picture and then replaces so after the
image is resized and I'm going to show
you that script in a second here it is
right here
image resize that PHP and you're going
to be getting this code too and that
needs to live in your PHP includes
folder ok don't forget image resize dot
PHP needs to live in your PHP includes
folder and then these next variables are
the variables that you need to send to
that image resizing script and you can
see here is where the image resize
function gets called that's living
within image resize that PHP so you're
calling that function you're sending it
one two three four five parameters image
resize that PHP is scooping up one two
three four five parameters processes
things and basically what this script
does is it takes the user's original
upload the maybe a big giant file that
they uploaded and it replaces it with a
smaller copy and like I said a develop
PHP there's this you can learn how to
create this image resize function is the
crop function watermarking function and
all kinds of things that you can include
into your system as external modules
alrighty so that takes care of all of
the PHP now in main js2 toggle that form
here let's see let me click toggle
Avatar form you see that that toggle
functionality is in main j/s so in main
jas you have to update that with this
new function called toggle element now
within your site anywhere on your site
on any page if you ever want an element
to appear and disappear upon clicking or
hover or whatever you want you can make
things disappear and appear give users
that control by using that function and
all you have to do is send whatever
element that you want to make appear and
disappear through this toggle element
function so that's all the code
going to beginning you'll be getting
users on PHP the new updated version of
that you'll also get photo system dot
PHP which needs to live in your PHP
parsers folder you'll get image resize
dot PHP which needs to live in your PHP
includes folder and you'll also get the
updated main js' which used to have only
this one little function in it but now
we have this function as well all right
so now you see the inner workings of how
this works here let me try this again
and upload is a beautiful upload works
great ok you can see you'll have all the
updated code from the home page - I'm
not going to give you that code I just
basically let you peek in my index file
at the beginning of this video I'm not
going to have that code for copy/paste</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>