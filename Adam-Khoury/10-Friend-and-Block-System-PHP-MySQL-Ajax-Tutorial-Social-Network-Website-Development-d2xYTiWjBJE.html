<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>10. Friend and Block System PHP MySQL Ajax Tutorial Social Network Website Development | Coder Coacher - Coaching Coders</title><meta content="10. Friend and Block System PHP MySQL Ajax Tutorial Social Network Website Development - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Adam-Khoury/">Adam Khoury</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>10. Friend and Block System PHP MySQL Ajax Tutorial Social Network Website Development</b></h2><h5 class="post__date">2013-02-05</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/d2xYTiWjBJE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">are you ready to continue good me too
because I'm about sick of this mother
effing lesson series and I think I might
vomit while making this video you think
you guys are tired of it I want to punch
myself in the face for even thinking of
making the whole series all right let's
rock and roll in this last little bit of
garbage that I have to offer here we're
going to be focusing on the friend
system and then you also have a block
system because a lot of people will be
annoying like I'm annoying on Facebook
if you guys ever wanted to see somebody
be annoying on Facebook you have to
friend me on Facebook because I can show
you what it is like to do Facebook right
okay so my point is if you have people
that are really annoying you'd want to
block system in place that way you could
just silence them and that's what we'll
work on here giving you a friend system
for your social network and a block
system that you can expand upon okay
let's rock and roll
you already have the database tables in
your system for your rent system and
your block system so those tables are
already in place if you follow the one
of the first tutorials where we created
all the database tables with that nice
easy script so you don't have to worry
about going into phpMyAdmin or messing
with the database it's already in place
I'm just going to give you the scripts
first I'll show you how it works live
here on web intersect and then I'll give
you the scripts and I'll explain just a
little bit I'm not going to explain much
because like I said I'm ready to vomit
and punch myself in the face it's going
to be up to you to decipher my script
from what I taught you so far and it's
going to be a similar type setup from
the other things just ajax.request
looking for data from PHP getting some
return response and then processing on
the page very simple things you guys are
already familiar with from the earlier
lesson okay let's see the block system
first I'll go here to will and I'll
click on his account and look at his
profile and if I'm logged in I'll have
buttons here that alive if I'm not
logged in those buttons will be
deactivated
there will be no clicking action upon
them but since I am a member and on the
logged in actually let me show you my
profile if I go to my profile they're
deactivated as well because I don't want
to friend myself and I want to block
myself they'd be retarded so let's go
back to will and let's click request
this friend press ok to confirm the
friend action for user will ok it says
ok friend request sent and then if you
check your database table you'll see
that you have a friend request sent from
atom to wheel and that's how it goes and
then when we'll checks his notifications
all he has to do is accept that friend
request or deny it if he accepts that
friend request and you change the 0 to a
1 in the database table for that
friendship row ok and then if he denies
that friendship if we'll denies my
friendship request that I sent him then
you simply take that database row out of
the table altogether that's the logic
behind the whole friending system now
I'm going to show you how to blocking
system is set up so let me go here to
Ally and
I'm going to block Ali says press ok to
confirm the block action on user Ali ok
instead please wait for a second and
then the button unblock user comes up
because he's blocked to me now so if
even if I go back to the home page then
back to Ali see unblock is there instead
of the block button now so if you look
in your database table you'll see that
in your block table you'll have one row
a new row for the user atom blocking Ali
and since it's set up that way when I go
to Ali's profile it says unblock I'll
announce so i'll unblock user says press
ok to confirm the unblock action on user
Ali ok so now he's unblocked and you
would use that for places where say I
write an article on the website or I put
up a video or some kind of picture a
piece of content that everybody can
publicly comment on all members of the
site can publicly comment on it or if
there was a forums for instance and I
didn't want Ali to be able to speak
within my forum topics that I create I
can block him so that's what it's for
you simply use that logic to check the
database and make sure that Ali or
whoever's looking at the page isn't
blocked to commenting on it and then you
give them a comment button but if
they're blocked to commenting on that
page you want to make sure they can't
have any means of commenting ok so that
is your friend system and your blog
system logic and in maybe the last
tutorial I'll show you how to actually
apply the logic to your front-end
applications but first let me give you
the scripts that will get you to where
this system is right now and here on the
home page
I'm simply querying all the people who
are helping me test who have joined so
far I'm just querying all from the
database with no limit that way they all
come pouring out and I can click on them
and go to their profile and interact
all right so you're going to be getting
the new updated user dot PHP script that
now has a little bit more PHP logic in
place and the JavaScript for those
buttons when they're click and you can
see in the PHP we're evaluating a little
bit of logic to see what buttons we
should offer people according to who
they are whether they're logged in or
not yada yada and I'll explain that very
quickly but I just wanted you see that
here we have the friend toggle function
in JavaScript and the block toggle
function in JavaScript and they're
basically the only thing you don't know
from the previous tutorials and you most
of you probably know how to use
javascript confirm boxes so that's where
those boxes that were popping up to say
press ok to confirm this action for the
use of rap guy and that's how if they
don't confirm it they press cancel you
just return false on this function and
it won't process down any further but if
they press ok then all of this code runs
and all you're doing is simply sending
an ajax request to a folder called PHP
parsers friend system PHP file so you
have to create a Boulder right now on
your live server named PHP parsers and
that folder would live right next to
your PHP includes folder and all that
junk and then inside of it you have a
friend system dot PHP script and
actually you're also going to have your
block system dot PHP script and I'm
going to give you that I'm going to give
you friend system PHP and block system
dot PHP and you're also going to get all
of this updated code within user dot PHP
so you won't be without anything that
the system is using to power itself so
far you'll have everything I have okay
so I'm not going to explain the
JavaScript functions any more in-depth
than that because if you've been paying
attention since the beginning of the
lesson series you are very well aware of
how to assemble custom functions in
JavaScript how to pass arguments through
those functions and then how to use
those values to send Ajax requests I
went over that so in-depth so I'm not
going to do it again basically you're
just calling out to PHP with these
functions using Ajax you're sending
certain data and then your way
for response.data to come back that way
you can process things on the page and
give response to the user that's all it
is okay so down in the HTML I simply
have two more paragraph tags so if I go
to my profile you'll see those new lines
right there friend button and block
button and they're in these paragraph
tags here you can see that the buttons
are actually wrapped in a span one is
called ID friend button and the other
one has an ID of block button and that's
how I target them with the JavaScript to
change them from being a certain HTML
arrangement to a different HTML
arrangement for instance for making
issues to make this deactivated you have
to have different logic because if the
user is the person that owns the profile
you don't want to have those buttons
active so that's why you see there's the
buttons being echoed by PHP and there's
also a span around it for JavaScript
purposes
so when Ajax response gets back you can
change the inner HTML of that span to
make it whatever you want make a new
button with new functionality new words
on it whatever and this friend button
and block button are created the HTML
for them are created up in the PHP and
I'm going to show you that right now
so when you left off you had all of this
PHP already in your user dot PHP script
so all I added these two more blocks now
this first block is for evaluating to
see if the person viewing the profile is
logged in and if they see if their
friends are ready with that person with
the person that they're viewing the
profile of you want to see if they're
that person's friend and that's what
this little bit of code does it also
checks to see if the owner of the
profile that the viewer is looking at
has blocked this viewer and you also
want to check to see if the viewer that
is viewing that profile has blocked the
owner of that profile so that's what the
logic is of the code in the queries that
you see right here and these variables
that start off with a value of false get
turned to true if certain things meet up
and then I'm evaluating those things
here
so the first thing I did was made a
friend button a disabled friend button
and a disabled block button now a person
who's not logged in and or a member of
your site they're going to see these
disabled buttons and if the person is
the profile owner like I was looking at
my profile a minute ago I saw a disabled
buttons so the owner and somebody who's
not logged in will see these disabled
buttons and those are the defaults you
change those buttons here in your logic
you say if is friend equals true then
you give them a different button this
first button is for the unfriend
mechanism and then you say else if user
ok equals true that means if the user is
logged in and verified and the user
owner of the profile that the person is
looking at is not equal to the person
who's viewing the profile and if the
owner block viewer equals false then we
want to let them request this friend
because if they if the owner is blocking
the viewer you don't want to let them
request this brand so there's a good bit
of logic going on in this if condition
but if you really study it you'll see
exactly what it's doing pretty much the
same logic for the block button you say
if the viewer block owner equals true
that means if person looking at the page
has blocked the owner of the page you
want to give them the unblock button so
they can then unblock that user whenever
they want to that they have previously
blocked then you say else if the user ok
equals true that means if they're logged
in and verified in your database and the
owner of the profile is not the person
viewing it then you want to give them
the block button ok so that is the whole
updated user dot PHP script I'm going to
quickly blast over block system PHP and
friend system PHP since they're so
similar to the parsing mechanisms that
we've been used to so far within the
system the only difference is that these
are separated out as their own module
rules for your software so each type of
system you create you can create a
parser so these both of these files
friend system and blog system they're
both living in the folder called PHP
parsers and that
really all they do is they parse Ajax
requests and your user dot PHP script is
going to have a whole lot of
functionality on it regarding JavaScript
and PHP and Ajax so you're going to want
to separate out your parsers you could
put all of your parsing mechanisms right
here in the top of user dot PHP as long
as you don't get any of the code
confused but I would recommend just to
separate out the systems or user dot PHP
that way you don't get it really clogged
up with code everything stays modular
and separate you can always find the
parts of the systems that you want to
tweak real easy so really it doesn't
matter if this code is living within
user dot PHP or not and if you are going
to have for instance other places where
users can be blocked for instance if you
don't want it to be just on the profile
page where a user can block somebody
else maybe you want it all over the site
these little block links and you
definitely wouldn't want to have that
inside of user dot PHP you would want to
have it as its own little standalone
parsing script ok so let me explain
block system dot PHP first and the first
thing we do is include once one folder
up in the PHP includes folder the check
login status dot PHP because people can
bypass all of your forms and your
JavaScript if they're smart and they can
post directly to your parsing scripts
even if you put it up one folder from
your public HTML in your root directory
of your web server where nobody can
navigate directly to it people smart
people can still post with headers
directly straight to that script no
matter where it lives so you want to
make your barsoom scripts have the logic
in them to make sure that no funny
business is going on you basically want
to assume that everybody is going to
post directly to this and bypass all
their forms so that's what I do when I
script I just assume that nobody's going
to use my forms everybody is a hacker
and they're going to try and post
information directly to my script here
to try to hack my system whatever and
all of the information is well filtered
with that in mind so the first thing we
do is include once the check login
status just to verify the user and we
say if the user okay is not equal true
or blog username is equal to nothing
then we're just going to exit the script
then the next little bit of logic is if
is set the post type that means which
post type it is if these is either going
to be block or unblock that's the only
two values that can be and then you want
to have the blocky being posted the
person who the viewer is attempting to
block so those are posted the only two
posted variables to this script and they
have to be set in order for your script
to run so the first thing you do inside
of that script is you create a clean
variable from the posted blocky variable
you just sanitize that with preg replace
and that'll make sure it removes
everything except alphanumeric
characters then you create SQL syntax
that reads select the count how many
rows are selected from the users table
where username equals blah key and
remember the users table is your main
table for your users where the username
equals the person being blocked and
activated equals one limit one now what
you're doing there is just making sure
that the person who the viewer is trying
to block is actually a member so you're
checking the database to for the count
to see if that member actually exists
with that user name and if exists count
is less than one you know they don't
exist so then you my SQL close the
database connection and I didn't put
this in any other files because I'm not
doing all your work for you but my SQL
close really should go in every part of
your application where you're done
communicating with the database when you
open a database connection and then your
script your PHP script is finished
communicating with that database and has
all the results that it needs you want
to close that MySQL database and there's
some controversy on using MySQL close or
MySQL I closed some people say that
script when the script ends it
automatically closes the database and
then some argue that for MySQL I closed
that's not the case that you have to
explicitly call MySQL I close to in fact
close the connection to the database all
right so that's something that you're
going to want to research on your own
just check out my sqli close see the
documentation for it but the way I'm
using it within the system here
surely clothes open connections to your
database now whether it fully closes all
of the sockets side that I do not know
of and that's something that is
debatable all right so that they don't
exist in close the database connection
and you echo the blocky
does not exist and you exit and that's
the response they'll see in the Ajax or
whoever is posting to this script if
they're messing around they'll see that
response then you're going to evaluate
to see if the user is already blocked by
the viewer and you get that number rose
from the query and you say if post type
from Ajax is block and if numrows is
greater than zero that means that person
is not blocked by the viewer yet and if
numrows is greater than zero that means
this person is already blocked by the
viewer who is attempting to block them
so you just close the connection you
echo back you have already blocked this
member and then you exit script else the
person is not already blocked by the
person trying to block them and then you
can just go ahead and insert the row
that would create the block mechanism
you insert into blocked users table into
the blocker field the block e field and
block date fields these corresponding
values log user name blocky and now it's
that simple man and then you run that
query and then you close the MySQL
database connection you echo back
blocked okay to your Ajax waiting and
then you exit the script and the script
is also set up to do the unblocking
mechanism so else if post type is
unblocked and if num rows is equal to
zero meaning that the user is not
blocked by the viewer you want to echo
to them you do not have this user block
therefore we cannot unblock them for you
you close the connection your exit
script else if they are blocked and the
viewers trying to unblock them and you
want to go ahead and delete that row
that you inserted earlier to create the
block mechanism in the database all it
does is basically removes that row
altogether that created the block
mechanism you run that query you close
the database connection you echo back
unblocked okay - you're waiting
JavaScript and then you exit the script
and that's the end now the friends
system dot PHP script
is a little more lengthy because there's
a little more checking that we want to
do just to make sure things are on the
up-and-up like I said if people try to
post weird things directly to the script
you want to have logic in place to stop
any kind of craziness that might occur
okay so we do pretty much the same thing
we include check logging status just to
have that variable user okay ready for
us to evaluate just to make sure that it
is a logged in member that's making this
script execute and that they verify in
the database and the first thing we do
is say if post type which would either
be in this case it'll be friend or
unfriend so those would be the two
values that could possibly be his friend
or unfriend you can see how I'm
evaluating down here if post type equals
friend I do this certain set of stuff
else of post type equals unfriend I do
this certain set of stuff that's how it
works okay so we've basically inside
make sure we pick up the user variable
to know which user that the viewer is
trying to friend so we have that cleaned
using preg replace from the posted user
variable then we can use that in our
query to make sure that user exists so
you want to make sure the person they're
trying to friend actually exists in
database and if exists count is less
than one the user does not exist so you
close the database connection your echo
back users does not exist and you exit
now we hit this else condition say if
post type equals friend now you want to
do a bunch of queries here to evaluate
certain things independently separate
from one another so you're basically
gaining a friend count from this SQL
syntax and corresponding query you're
gaining a friend count to see how many
total friends did that user already has
and if they already have too many
friends we won't accept more but you can
remove that from your script see down
here in this condition if Brent count is
greater than 99 so I'm not letting my
system have any more than 100 friends
nobody in my system can have any more
than 100 friends you can do that if you
want friendships to be more genuine
within your social network or whatever
people can't be friend whores so you can
limit it
by just removing all that if condition
right there and starting with if block
count okay oh I know a lot of you guys
will would want your members to be
friend whores and it'd be as active as
they can possibly be on your site so you
would probably want to remove that else
or that if condition and this query you
don't need it to see how many total
friends that that user has then the next
query is to see if there if either the
user being requested is blocking the
viewer and then the next one to see is
if the viewer or if the user is blocking
the viewer and this first one is to see
if the viewer is blocking the user
either way if anybody's blocking anybody
in this equation either one and you
don't want the friendship to actually
occur until somebody unblocks or lets
people back into their life or whatever
basically you don't want to block
mechanism in place when people are
trying to become friends it doesn't make
sense for two people who are friends on
the site but one to block the other one
they should just unfriend that person so
that's why I put all this logic in place
and you don't even have to have it in
place but that's what it does then I
have row count one being created instead
of explaining those queries let me just
show you what they do in the evaluation
so I say if the friend count is greater
than ninety nine then I'm going to exit
the script and say user currently has
the maximum number of friends cannot
accept more else if the block count is
greater than zero then the user has you
blocked we can't make friendship from
the two users here because the person
you're trying to request friendship from
as has you blocked so we exit in that
case we give them that message then if
you the person view requesting
friendship has the user block that
you're requesting friendship from you
don't want to allow that to happen
either so you echo back you must first
unblock user in order to friend with
them then the next condition checks to
see if the row count for the first check
to see if people are already friends if
there's a friendship already in place
for those two users then you echo back
you already friends with this user and
you can see row count one and row count
to get their logic
right here is row count one row count
two row count one is corresponding to
this SQL syntax so read it then if the
next query is greater than zero you want
to echo back you have a pending request
already sent to this user
so basically row count three is up here
and it checks to see if there is already
a pending request sitting there or a
friendship row but it's accepted is zero
that means the person did not accept it
yet so then you echo back you have a
pending request already sent to this
user and then the last check to see if
the user that you are requesting
friendship from already requested
friendship from you and in that case you
want to echo back the user has requested
to friend with you first so check your
friend request and accept it so that's
how that query works and you go up top
and you read how it reads right here to
gain the knowledge of how the logic
works okay not explaining everything
like I told you I'm sick it is somebody
to kick myself in the teeth I'm losing a
lot of people here because this is so
boring
okay so after all of those conditions
when you're checking to see if their
friends ready or if somebody has
somebody blocked a blablabla after all
of that passes then you insert into the
friends table actually this friendship
or this Union you create that row and
you don't want to make it accepted one
until you make the script or the page
where you let people check all of their
friend requests that are in the database
and I'm going to be showing you that on
a notifications page so I'll show you
how to tap into all that line all of
that stored information to create lists
so you insert into the friends table the
Union but you don't make it an accepted
Union until the user who's being
requested accepts that friendship by
clicking a button and then after the
insert you close your database
connection and echo back to Ajax friend
request sent and then you exit script
now here is the logic board else if type
equals unfriend so this is the
unfriending logic I'm not going to
explain any of that to you
it's
all the same simple crap we've been
doing I'm not explaining it it's same
simple query crap and if-else condition
logic we've been doing the whole time
all right all right so remember you have
to grab from under the video or develop
PHP l have this updated users that PHP
script I'll have friend system PHP I'll
have block system dot PHP that you can
just copy in place and run and if yours
breaks you don't do something right
maybe you didn't make your PHP parsers
folder and put blog system and print
system in it so use your PHP can't even
find it maybe you did something wrong
these are the exact scripts I'm using on
my site and I showed you guys that
working okay so if yours breaks that
means you did something wrong I'll go
back and fix it debug take a whole thing
apart again and start over now you're
only getting I think I'm only going to
do one more video</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>