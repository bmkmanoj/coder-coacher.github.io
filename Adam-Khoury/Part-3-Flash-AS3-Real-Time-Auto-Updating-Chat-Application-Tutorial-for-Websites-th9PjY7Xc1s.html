<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Part 3: Flash AS3 Real Time Auto Updating Chat Application Tutorial for Websites | Coder Coacher - Coaching Coders</title><meta content="Part 3: Flash AS3 Real Time Auto Updating Chat Application Tutorial for Websites - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Adam-Khoury/">Adam Khoury</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Part 3: Flash AS3 Real Time Auto Updating Chat Application Tutorial for Websites</b></h2><h5 class="post__date">2009-11-28</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/th9PjY7Xc1s" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hola todos Alana flash building aqui
nosotros ahora Amazon Mo's lopata tres
de nuestra application the chat in
ActionScript 3 sientate por favor
tiene cuidado de la cabeza when we last
left off in part 2 we created all the
interfacing that we need in flash and we
placed in our flash script that's going
to handle all the calling to PHP that
needs to occur so now in PHP we've
created a file called Chat dot PHP
because all three sections of the flash
ActionScript 3 code they call out to a
flash PHP file called chat PHP so now
we've created that vial and Dreamweaver
and let's talk about it real quick first
thing we do is connect to our database
and we already discussed how to sync in
your database connection script or you
can just put in your database connection
code right here on the top of this file
if you if you'd rather do that not user
and include file
ok so part 1 or section 1 corresponds
with section 1 and flash you'll see
section 1 in the ActionScript 3 code is
right here section 1 so in PHP section 1
corresponds with that section so we pick
up the posted variable of initial
request which flash sends out right here
so we know in the PHP file in each
section the PHP file knows which section
needs to be run within it by or
according to what posted variable comes
from Flash if the posted requester
variable is chat check we know to run
part two in the PHP script here if the
requester variable is has a value of new
chat then we know to run this part of
the script part 3 or section 3 so
section 1 corresponds with initial chat
body request we just want to load the
whole chat body into the chat window and
flash
so that's what we do we say status line
equals initial load so that's what it'll
stay say in flash in the status text
field on stage and then the body will be
empty we'll just create the variable set
it as empty right here then we create an
SQL query that is selecting all from
chats and ordering them by the date/time
in descending order so we run the mayest
well fetch array function on that SQL
query and we come up with all of these
rows out of the database so on the chat
body we strip the slashes on it or else
slashes may show up where you don't want
them to and then we replace all of the
single quotes with their HTML entity and
then we see it set up the body variable
that's gonna get sent back to flash here
so what gets sent back to flash is in
this line here so within the while loop
we've requested all of the chats so the
while loop will keep compounding each
chat so if there's 1,000 chats in your
database all of them are gonna come out
in this loop and be rendered and be sent
into flash to be rendered
now this last little query here it runs
to grab the last ID the one the ID with
the greatest value which is to be the
last one posted we want to get that
stored ID or we want to get that idea
out and send it into flash as the stored
ID and I'll show you why we do that in a
second in part two okay so at the end
after this query this query right here
this section pretty much is all set up
only just to grab this store tidy that's
what we want and hear this loop is set
up to grab all of the chats and sync
them into a variable called body so here
at the end of this
we set up an echo statement or an echo
function whatever you want to call it
back to flash so you can either print or
echo back to flash this data this
variable called stored ID and has a
variable of this stored ID we attained
right here then the status line equals
status line variable which equals
initial load then the return body equals
body which I already told you what that
is it's all of the chats compounded with
everybody's username here the day time
that the chat occurred and then the chat
body now it's important to note that you
can sync HTML custom HTML straight in
there and flash will render it out as
long as the text field is set to display
HTML okay set to render HTML rather so
that's pretty much it for section 1
section 1 just pretty much loads
everything up into compounds everything
into a variable called body and gets
ready to send it back to flash and
before we send it back to flash we grab
the stored ID which is the last ID in
the database you can see this query is
select ID from chats order by ID
descending that means it's going to grab
the last one placed and we say limit 1
because we only want that one and that
everything gets sent back in the flash
so flash is holding the stored ID which
is the last ID status line and the
return body gets sent in that's when the
person first comes to the application
that's what happens so since we
connected a MySQL way up top here we can
use it in all three of our sections here
so let's talk about section number two
now section two of our chat dot PHP file
corresponds with the section 2 of our
ActionScript 3 code and that is the
requestor chat check so when flash sends
out the requested chat check in section
2 we run all this code
the status line it gets a an initial
value of not new just by default up top
here and if there is a new line and we
find the new line here or a new a newer
ID than the stored ID then we change
this variable name down below here I'll
show you that so the stored ID is posted
from flash remember in part one or
section one we send the stored ID in so
the stored ID gets posted back to the
file here from flash and then we run a
MySQL query to pretty much find the
latest ID like we did here in this query
in section one so we find the latest ID
in the same method that we used up top
once we have the latest ID in a variable
here then we can use an if condition to
compare and say if the latest ID is
greater than the stored ID from flash
then we render out the new data we say
status line is equal to is new and flash
needs that to say is new to know if it
should populate new body data a new chat
body or a new full chat window and then
we set the body variable again
initialize it we've run our query we
grab all the data out we set up our back
body variable again the way we want it
and any HTML that we won in there can go
and then we do the same thing with the
echo at the end we echo out the stored
ID all that stuff just like we did
before up top and it's important to note
that you see this if condition it's
nested right here its nest closes right
here so you know what that means
nothing will echo back to flash unless
latest ID is greater than stored ID if
the latest ID is not greater than the
stored ID there's no reason to send
anything back to flash or update
anything because there's nothing new
you would be wasting transmissions and
whatever it's just not needed only if
their latest ID is greater than the
stored ID then repopulate because you
know there's a new chat that all the
tens of thousands of people watching
your chat or even if there's six people
watching your chat window
all of them will see updated data
without having to press refresh or
anything like that
okay now let's discuss section 3 section
3 corresponds with the section 3 at an
arc flash ActionScript 3 script and it's
parsing the new chats that are submitted
to this file so when the person puts in
their name and then they put in their
chat and they press submit this is the
section that runs and what we do is we
grab the user IP grab their IP address
so we can run IP blocking mechanisms if
we want in the database every role is
gonna have an IP address of whoever that
person was chatting so if they're really
annoying and you want to block them from
ever chatting again you can do that
that's what that's all about and I'm not
even gonna write the blocking mechanism
because you can just write an if-else
condition statement to say if this is
this equals this guy's annoying guy's IP
address no chats are going through for
this doofus that's how you do it now
username is what's posted from Barrett
Flash and the chat body is also posted
from flash when they press submit so we
get the user IP the username and the
chat body all stored up in variables
here and we run a little bit of
filtering to prevent SQL injection
attacks before going into the database
which is a number of different ways you
can do this and I don't know if this is
even 100% solid but it seems to work for
me so and you can also restrict what
they can type in in the flash text field
I even bet in there let's see yes it's
in here right here on number 3 section
3c restrict they can only type in
actually they put everything but the
ampersand and these two brackets but you
can put anything you want in there to
restrict or you can use this restrict
method that only lets them put letters
and numbers and spaces okay so back to
part three all right so at the end of
the filtering we run I'm going to talk
about this commented out section right
here in a second we'll get right back to
that alright so once the filtering is
done we can then insert we run the
insert SQL statement to add these values
down here to these fields up here these
are the fields in your database table
whatever is in that table that's what we
want to populate so those fields in your
database table that we made in part one
I have to get these variables placed
into them through this SQL query you see
this last one that says date time we use
the now function to populate that and
what it does is puts a timestamp in
there for the exact time that they
chatted and so what we do is we grab the
latest ID to send the stored ID back to
flash here of the latest ID that is the
latest chat the latest chats ID so we
run their MySQL ID or my SQL insert ID
function to grab the ID that was made on
this insert does that make sense okay
good so now we go and do the body
initialize the body variable again run
the query grab all the data out make the
body variable to send back in a flash to
make a new chat window display okay here
is where it gets echoed back yeah go
back the latest ID the status line and
the return body once again and this
should not say now status line should
say we don't even need a status line for
when this occurs
but we'll send it anyway you can say
poopoo I think that'll work
status line equals poopoo
we're not even listening for it back in
the flash and then we close the MySQL
connection
every time this file executes the
connection is closed okay now the last
part of this PHP control file and a very
important part of the file is this
delete any chat posts off the tail end
this little piece of script is commented
out now I'm gonna remove this here at
the bottom and this here at the top to
activate it now you can see it's not
commented out and it's active what this
will do is if I ran this right now I
won't get any more than a few posts in
my my chat table so you have to keep
this commented out like I had it there
to enable the chats to build up to maybe
around you know anyone build it up to
about 500 or a thousand whatever you
want to max limit to be of the amount of
chats that could be in there you set it
to that number by just watching your
database once it gets up to 500 you see
it's at 500 you uncomment this I'm gonna
comment it back now it has to be
commented out and not active until your
database table gets up to where you want
it once it gets to 1,000 or whatever you
enable this and it'll keep slicing one
off the tail-end each time a chat is
made so that way your database doesn't
get freaking huge and out of control
with tens and thousands and maybe
millions of little chats that you really
don't even need in there it's all crap
all you need is the last 500 or the last
thousand the last hundred would even
work okay so that's that so that
completes the application and now we're
going to test it out barb or stay tuned
for part four where I'm going to test it
out live online I'm front of everybody
so no doofuses can tell me that this
doesn't work</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>