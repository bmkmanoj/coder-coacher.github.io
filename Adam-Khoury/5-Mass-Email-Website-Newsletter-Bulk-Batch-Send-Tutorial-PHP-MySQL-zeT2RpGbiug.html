<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>5. Mass Email Website Newsletter Bulk Batch Send Tutorial PHP MySQL | Coder Coacher - Coaching Coders</title><meta content="5. Mass Email Website Newsletter Bulk Batch Send Tutorial PHP MySQL - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Adam-Khoury/">Adam Khoury</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>5. Mass Email Website Newsletter Bulk Batch Send Tutorial PHP MySQL</b></h2><h5 class="post__date">2010-01-03</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/zeT2RpGbiug" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello everybody Adam a flash building
here with part 5 of creating a PHP and
MySQL newsletter an email blast
application for your websites or your
clients websites we've covered all these
steps that are marked off with green
checkmarks here in the previous lessons
the last one we compose our newsletter
body out of HTML and CSS and now we're
going to write a PHP script that
newsletter body gets sunk into to make
it dynamic so that newsletter body that
we created in the HTML and CSS is going
into a PHP file it's going to be
rendered dynamically to send everyone
that formatted email ok no more talk we
work
okay when we last left off this is what
we created the newsletter email body you
can see it's HTML based with CSS inline
styling we're going to grab that whole
thing ctrl C now let's open a new file
that I created on my own here I'm going
to explain it real good it's called
blast script now we have the index file
the one that has the form owner which
gathers the name and email address sends
it to the database this one called blast
script is the one that's going to be
responsible for automatically sending
the email to everybody the newsletter
okay so let's open that one in
Dreamweaver okay you can see it's 26
lines here not very much going on let me
explain what it does first we open the
PHP tags then on 26 we close the PHP tag
that way we have a nice PHP code block
and the first thing inside of the block
is we include once connect to MySQL file
so we connect to our database right
there and you got to make sure you
connect to your database before you
start any queries so here we we put a
query into an SQL variable there and the
SQL query or the SQL string is select
all from the newsletter database the
newsletter table we have in our database
where received equals zero which means
this person has not received it whoever
in the database has not received this
newsletter yet because we're going to
have to stagger this thing there's a lot
of server limitations out there for most
people most websites you can only send
so many PHP mail functions which is
right here this mail function you can
only fire that off so many times within
one day sometimes it's a thousand
sometimes it's more sometimes it's less
and also there's sometimes limitations
on how many per hour so it's a good idea
when you're writing an application like
this just to make it work universally on
all environments is to stagger it and
I'm going to stagger it by limiting it
to
one T I'm only going to access 20 names
from the list in the database at a time
but this script is going to fire off on
a time-based interval because we're
going to create something called a cron
job and a lot of people don't know what
cron jobs are but it's a way to automate
scripts
it's a way to fire off scripts without
having to go to the browser and run it
in the browser
it will just fire off automatically the
server will access it and make it fire
off and I'll be discussing cron jobs a
little further in detail in the next
part of this lesson so what we do is we
run this SQL query and then we can run a
while loop on that query and inside of
this while loop is where all of we use
the MySQL fetch array function to access
all of these selections all the 20
selections that we gathered out of the
database using this string so in this
loop is when they all come pouring out
you can see this loop is nested on from
line 5 to 25 that's where it closes
right there and everything inside of
this loop will fire off pretty much 20
times for all of these 20 selections
that came out so each time it loops we
gather that person's unique ID which is
not really necessary but I gathered it
in case you want to use it I'm just
using the email and their name so each
time it loops a new individual email and
name pair comes out of the database for
each individual and then we have the
male body and I'm going to put this body
design into this variable here I'm going
to do that in just a second it's going
to make our script a little bit longer
but I don't want to complicate things
just yet so you can see clearly have a
visual idea of what's going on here so
within the loop we're going to claim the
male body
else email subject the headers for the
email which right here you put the from
however you want it to be from and I
just said newsletter at develop page P
calm and the content type which is text
slash HTML you have to claim HTML if you
want to use HTML formatted emails which
we are using here then we claim the two
variable which is the email for each
individual will be dynamic each time in
the loop and then we sync all of that
into a variable actually we sync all of
that into the mail function the PHP mail
function which is all placed into a
variable called mail result now we say
if mail result is successful this if
condition is saying if mail result is
successful if you wanted to say is not
successful you just put an exclamation
mark there and that this evaluation
reads if mail result is not set or is
not successful it's not true that means
if anything happened this mail function
was to fail this else condition fires
off if it fails and I wrote here this
else statement can be used to write into
an error log if the mail function fails
it can also just be removed if you do
not need it by going like this
but I'm going to keep it in for you it
won't hurt the script to have it in
there at all
so if mail result is true and they got
the email blasted off to them that
individual we set a new query to update
the newsletter set received filled the
newsletter table received field is equal
to one now because they have received
the email and all the other individuals
who haven't received it yet will still
have a received value of zero and then
they will be receiving on the next few
blasts because this thing will be
staggered out where email equals this
person's email address limit one because
you only want this query to fire off or
you only want this query to effect one
row so update the newsletter table
received field to one where the email
equals this person's email address
limiting to one and that's all we have
that's all for now let's put this in
let's grab all the email body from the
previous lesson and now let's place it
right there in between those single
quotes for the male body variable
control V and there you have it so this
male body let's go to the design view
will be fired off dynamically to each
person each of the 20 people in that in
that section and what we're going to do
is say hello name which is a dynamic
variable here and also there's a link
with a dynamic variable with their email
to allow them to opt out that's going to
be in the newsletter body and it's a
good idea to have in your newsletter so
they're the blast script is all set now
what this thing will do is send the
email to everybody only 20 people at a
time and it will be dynamic to where
their particular name and their
particular email will be rendered within
the body it's a very simple script and
you can also which I'm going to discuss
in the next part and I might even
program it in for you if you want to use
it
I might just throw it in because it
might be a handy thing to have I'm going
to add one more query that's going to
query the database here at the very end
of the script and it's going to check to
see if everybody received value is set
to one that means everybody got the the
email blasts when it's all done the
whole email campaign then I'm going to
email myself saying the campaign is over
you can now create a new body design and
do your next email blasts in a week or a
month or whenever it comes and so the
black script is now part of the files
that are in the news lip folder and
really the only we only have three vials
that are part of the equation here body
design is just a format it's not a
really necessary file but it's good to
lay out your design of how your
newsletter wants to look and my SQL
quick test isn't necessary but I'm going
to keep it in here so you can do your
MySQL quick test like we started off in
part one because that was part one hey I
picked up a okay now that's it so in
part six and I've already tested this
script it works great what I did was I
went to my server I put this online I
went to my server and I navigated to
this file online and what it did was it
sent out email to both members that were
in my subscription list I successfully
and it rendered their name dynamically
perfect and it rendered their email
perfect for the opt-out script so in
part 6 what we're going to do is write
the opt-out script which is to me a
couple of lines and it's a good idea to
have that little little guy and then we
might have a part 7 or maybe in part 6
we'll just finish it all off and I'll
discuss the making this thing automated
by setting up a cron job so you'll have
options you know you can just go and
fire it off man
but the way I would do it is set up a
cron job that way it's all automated and
then it gets to the under campaign
emails you say the campaign is over and
you know everything is done everybody
got it happy day bye-bye I'll see you in
part 6</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>