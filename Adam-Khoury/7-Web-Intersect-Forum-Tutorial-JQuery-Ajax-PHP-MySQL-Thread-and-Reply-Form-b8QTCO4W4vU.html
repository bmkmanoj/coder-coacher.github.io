<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>7. Web Intersect Forum Tutorial : JQuery Ajax PHP MySQL Thread and Reply Form | Coder Coacher - Coaching Coders</title><meta content="7. Web Intersect Forum Tutorial : JQuery Ajax PHP MySQL Thread and Reply Form - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Adam-Khoury/">Adam Khoury</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>7. Web Intersect Forum Tutorial : JQuery Ajax PHP MySQL Thread and Reply Form</b></h2><h5 class="post__date">2011-02-09</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/b8QTCO4W4vU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">okay so we're pretty much done with the
basic system what we have to do is
explain one more file to you and that is
the one where you go and you view a
topic view thread PHP which will show
the person's original post and all the
replies to that post so let's go over
into Dreamweaver and let's open the last
file that you guys have not seen yet see
these files this is my whole forum
system is being powered by just a few
files and a couple of those PHP region
templates so they don't even really
count so that's like four files to this
basic system very cool remain but you
would want to add more features to your
stuff my open view thread dot PHP let's
explain this one and then we'll be done
and this one is a little bit tricky
because it adds the JavaScript and the
jQuery black paper it plays some CSS and
other things but I'm going to explain it
the best I can - what I got now let's
take a look at it live on the site this
is the view thread that PHP page and
this is a thread that somebody created a
topic and no one has responded to it yet
okay let me just put in a response for
giggles there now somebody's responded
to it you can see on the top of this
file we have the dynamic breadcrumbs
thing going on I already explained how
that works here we're outputting the
title really this title should be up in
your title tag as well let's see why
it's not doing that section title form
Oh to make sure we got the section title
I had the wrong variable name there
should be section underscore title there
now the section title will be in your
title tag which will give you better
search engine indexing I'm going to
refresh this page and you'll see up in
this tab what am i doing I don't want to
show the damn section I want to show
this title where is that thread title
that's what I want
dang it what's wrong with you people now
I'm going to refresh their but what the
hell is the word for I'm doing there she
Christ let's remove that that's what I
wanted
now that'll give you better search
engine indexing when people are typing
in like say somebody typed in PHP MySQL
real escape string function that would
be in the title of the webpage which is
very good for your search engine
indexing and better spidering of your
site let me refresh now I got what I
want so now this webpage when it gets
spidered by google or whoever's spiders
that are coming to put in their search
engine and index it this will get
indexed for hi youtube pretty high
because that's the title of the web page
so somebody typed in I need help with
the MySQL real escape string function in
PHP that whole little bit of data will
index that page for that now I'm going
to show you the script in a minute where
all these things are happening but the
next thing I do after we output the
dynamic title here and we make sure the
titles in the actual web pages title tag
then we output the first post which is
the original post from the author of
this thread of this topic then after
that all you have to do is simply
display all the replies to it and you
may want to think about putting
pagination on these pages as well
because it could be that some people
might reply this thing have 100
different posts in it that would make
the page pretty dang long but I'm not
going to stick any pagination in mind
I'm cool with it being a long page I'm
fine with that and eventually in mind
I'm going to have it to where people can
close threads so things are getting too
long the conversations dragging on they
can just person who started the thread
can close it but I'm not going to show
you how to do that man you have to
figure that on your own
haha now pass that what we have is the
jQuery functionality that's going to
make a box appear that's going to be the
form the reply form so when we click
this
there's the box that appears and that's
simply a div and it has a form inside of
it
big will be nothing special and then I
type something in let's say I forget to
type something in and I press submit it
says please type something big red
letters so if I type something submit
your response okey-dokey
all right so you see how that happened
let's type in okay again watch when I
hit this button right where that button
is there's a little loader that appears
let people know something's happening
really happens so fast you don't even
have to but you might want to now you
see all these you can't see the name of
yourself but when you refresh the page
or if anybody comes to the page after
that you see your name when you use this
form you press somebody presses submit
we're using jQuery and it's Ajax
functionality to send to the PHP script
which is parse post the one we discussed
already in depth and this type value is
B for this kind of post now once it
sends all those variables there the PHP
script processes them and you can access
the information that was the last post
that somebody put up and you just throw
it into that magic div now I will
explain the code to you to the best of
my abilities now the PHP up top in this
script is pretty simple we're doing
first is restart session so we have the
ability to sense somebody's logged in
session variables then we connect to our
database now here we're connecting to
the class file for converting date/time
to the ago format so you see here we
have seven minutes ago Adam said
eighteen seconds ago Adam said we're
converting the date time to the ago
format I just think it's cooler and we
showed all about how to create that
class file and connecting to it and how
that all works in previous tutorials
were web intersected so I'm not going to
go over how that all works again just
know that it does and nicely alrighty
next thing is get the ID URL variable
and query the database for the original
post of this thread then we query any
responses out of the database and place
them into a dynamic list for display
after that happens then we
be sure the user session variables are
all set in order to show them the reply
button if they're not a logged in
session user you want to give them a
little line that says please log in to
reply if they are logged in session user
will show them the reply button now
after that we check the database to be
sure that that person's ID the password
and the email session variables all
matching the database so let's talk
about this first little block and you
can see it all right down there it is
and it's very basic we just capture the
thread ID coming in on the URL variable
to get ID and we filter it using the
preg replace function to get everything
out of it but numbers then we run a
MySQL query to select all from foreign
posts where the ID equals thread ID and
the type equals a limit one we only want
one row returned from this query and we
want it to be the original post for the
thread so we're targeting type a then
you get number rows to make sure that
that thread exists say if I go to a
thread and I type in 249 and that thread
doesn't exist I know for sure because my
forms are so new it says error that
thread does not exist stop playing with
the URLs weenus so I go back to 24 and
that exists so at this place you can see
right here error that thread does not
exist stop playing with the URLs weenus
exit that's how that works so you just
want to make sure the threads there
before you go displaying something you
don't want to display something that's
not there so after you sure it's there
and the script hasn't exited then you
run the while loop to access all the
variables for that first original post
for that thread that way you can easily
display things all right and collapse
that back up now this next little PHP
block is to query any responses out of
the database and place in a dynamic list
and you can see all of that code occurs
right here you just create an all
responses variable that's going to be
the container the dynamic list of all
the responses so we run a MySQL query to
select all from forum posts where the
original topic ID equals this threads ID
and type equals B target only responses
no limit then we run MySQL num rows to
see how many rows is returned from that
query if the number rose is less than 1
you put in all responses variable
nobody has responded to this yet you can
be the first in the list and we use the
div ID of none yet div I named it none
yet div just to make good sense to you
guys
if you go into the CSS you see I have
none yet div right here you see the
style for the div the background color
the sizing of everything in it bordered
all that crap so that gets displayed if
there's no responses yet but if there is
oh you know what I need to have an else
right here else close the else statement
and move these in a little bit because
if num rows is less than 1 we're going
to spit out nobody has responded to this
yet you can be the first else you run
the while loop ya see it displays
exactly the same but it's coded more
correctly now the way I had it just a
second ago was running just fine but
it's coded more correctly now because
all responses then becomes a dynamic
listing of all the replies to this topic
so that all responses variable has to
change within this else statement
alrighty now just collapse that all back
up
what's next be sure the user session
bars are all set in order to show them
the reply button so by default you want
the reply button variable to have the
value of you must log in to respond give
a link to your login page now if is set
that means you can give them the reply
button which is the button that opens
that little jQuery form that slides open
and closed which is on this page I'm
going to show you that form in a second
ok so that's pretty simple then we'll
check the database to be sure the ID
believe it or match so what you're doing
here is you're making sure
let's see select intervention to you
just making sure you the person is who
they say they are if they're not you
give them that you must log in to
respond
link all right so that's it for the PHP
now we get into the HTML section of the
web page here
which we're integrating JavaScript into
now and jQuery so you see I have the
link to the jQuery file so you want to
have the jQuery file on your server if
you're working with the web intersect
files you already do so you can just
jump up one directory go into the jas
folder hit the jQuery file that's all I
did there
just making sure this file is connected
to my jQuery file that way I can use
jQuery within this then the first thing
let me just put a couple of lines
between this so you can see real good
first function is simply for toggling
that little form that's in that div when
they press root submit the reply or
right here when I hit post a response
you see that div that blue div that blue
box that opens up with the four minute
that's all that's doing that javascript
function is making that open and close
using jquery slide down and slide up and
collapse that back and the next bit that
we have is for actually parsing the form
when somebody clicks this submit your
response button that's what's going on
with this javascript right here and I'll
explain that to you right now but I'm
just going to breeze over it real quick
because we already did pretty in-depth
jQuery and Ajax
discussions earlier in the web intersect
series
all right this line disables the submit
button when the person presses it now
function parse responds that's a
function that fires off
when somebody clicks that submit my
information button and what happens is
you create variables out of all of the
forms fields so whatever's in the form
fields we can create a little variable
from it by targeting that forms ID in
the form and then we just grab the value
pack it into a variable so that's what's
happening with all of those you're
getting the user password the user ID
the form section title the form section
ID whatever they post it whatever they
typed in and the threads ID because you
got to know the threads ID when this
gets parsed then we create a variable
for the URL that's going to do the
parsing of that infamy
which like you know is parsed post.php
the same one that parses the new topic
form and we run if condition here that
has an else if attach to it and then an
else condition finally in the first if
we're evaluating the see if the post
body value is empty or not if it is we
had that big red text that says please
type something else if the post body
value dot length is less than two
characters long I'm going to put out
another error it's going to say your
post must be at least two characters
long you might want to remove that if
you want to let somebody post in in a
space or a dot or one letter I don't
want that at least two letters so they
can say okay or put it in a little
smiley face character something else if
those conditions aren't met we can
actually process the form and send these
things to PHP so you hide your button
then you show the processing animated
gif that little green thing with the
dots going back and forth Facebook uses
it to that little blue bar thing that
they use you want to show that animation
that way the user knows that something's
being processed because sometimes it can
vary the time that it takes for you to
for your system to process things sorry
I'm eating a KitKat but if it takes a
little longer one time to process things
on your website you want to let the
people know if something's going on
because they could be one of the people
that it might take five five or six
seconds for it to go through might take
two seconds even with today's web if
something takes two seconds people like
what the hell's going on what appears
your suit in here so you got a little
known then the next line is the actual
post functionality which is using jQuery
AJAX functionality to post that data to
the PHP script which is URL and we saw
that is post parsed on PHP who send to
that URL all these posted variables
you see all the variables that it needs
from the form now when that data reaches
the PHP file it's going to process in
the parts post PHP and PHP is going to
echo something back that's going to be
right here see that function data that
data variable that's going to be the
data that came back you can use that
data for display or whatever now this is
so friggin tricky it took me like 20
minutes just to code out these few lines
it was so tricky but basically what this
does is it makes that instant div that
is their reply that they see instantly
and it magically creates it that's why I
call it magic div 1 and magic div and I
put the data that is that person's
response right back into the page so
they can see it without refreshing
anything but I'm not even going to try
to explain all this crap because I'll be
sitting in another 15 minutes trying to
explain all this JavaScript all right
I'm creating elements so I'm targeting a
div here I'm creating a div here you see
what I'm saying basically this is how
you get the person that just responded
this is how you get them to see their
response boom it'll be just adding new
magic gives to the page every time they
respond and that's if I take JavaScript
mning now the CSS is pretty simple
I'm just styling how this div this aqua
div looks in this one C topic div you
see that border colors aqua the
background color is a very light aqua
you can set all the text sizing and
everything that's all that's happening
there then the response top div is this
little really light gray guy here that
holds the re whatever the title is that
bullet symbol and then shows when the
person posted their name is a link and
it has the word said that's that div you
can style it up any way you like the
response div is this white box
underneath that one directly underneath
that box and that has the person's
response none yet div we already talked
about that's that's pretty much it guys
now the form itself I have on the page
let's see yeah if you go into design
view you'll actually see the main topics
Dave there a visual display
now all responses is kind of hidden
because that's a dynamic list and
dynamically made boxes now here I put it
in Nice code comments so you guys don't
miss it this is start div that contains
the form and div that contains the form
so you get that code all wrapped up nice
you see it's not much code at all but
basically this form is all you need for
sending the that JavaScript function up
top the information it's waiting for to
do the jQuery AJAX functionality okay
okay so you got it I'm putting out the
code then you guys can come and get it
and then expand it man make it awesome
because I left a lot out of this system
and what I'm gonna do is make mine a lot
more awesome put on my own I'm gonna
keep going and I'm gonna give it certain
things that are unique for me and you
should do the same
all right now like I said the code is
going to be here on web intersect
homepage if you go to the home page you
click download I am going to package all
of these scripts that I've been working
on for the forum into version 1.3 for so
please don't ask where's the code okay
so I hope you have enjoyed this series
on adding custom forums to your little
custom community or member system social
network to check going and that is the
very end I will never ever be doing a
forum tutorial ever again I will expand
this one either we've covered most of
what you need to know already within
this series but now it's on you buddy</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>