<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>2/3 Private Message System Tutorial for PHP MySQL Websites Web Intersect | Coder Coacher - Coaching Coders</title><meta content="2/3 Private Message System Tutorial for PHP MySQL Websites Web Intersect - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Adam-Khoury/">Adam Khoury</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>2/3 Private Message System Tutorial for PHP MySQL Websites Web Intersect</b></h2><h5 class="post__date">2010-10-06</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/fpUjDmOt8E8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello fellow webmasters and welcome to
part 2 of creating a private messaging
system for your PHP and MySQL based
community or social network websites
when we last left off in part one we had
created the form and the MySQL database
table that is going to hold all the
private messages right now press submit
nothing happens and that's because we
haven't actually put in the JavaScript
function that this form is connected to
and that function will be connected to
jquery's Ajax mechanisms to easily allow
sending and transmitting PHP MySQL data
within the page without refreshing the
page so let's go ahead and do that now
ok let's quickly discuss what happens in
this JavaScript function that I just
placed in here you'll see that it says n
private messaging stuff and start
private messaging stuff so between those
two commented lines there is all the
JavaScript that I just added to the
JavaScript area of the profile that PHP
page so let's discuss it real quick so
function send p.m. fires off whenever
somebody presses the submit button and
here the first thing we're doing up top
is when the PM form submit button is
pressed the function fires off to
disable it that's what's happening here
and we're doing that just to disable the
submit button so there's less of a
chance of double posting and things like
that but in our in our parsing mechanism
and the PHP side of things we're going
to be checking to make sure there's no
double posting happening so within this
JavaScript function what happens is
these variables are created from the
form hidden variables so the hidden
input that are within that form they're
all going to be accessed and they're
going to be thrown into variables so the
PM subject the text area which is the
message the sender name the sender ID
the recipient name the recipient ID and
the PM whippet those are all going to be
put into local JavaScript variables so
then we can just use those
more easily when we need to and here we
set the URL this is the script in the
scripts for profile folder called
private message parse PHP and this is
going to handle taking in new private
messages and it's also going to handle
parsing reply messages this one script
will handle it all
so we've referred to that URL right here
now the first thing we do before we
access jquery's Ajax mechanisms for
sending and receiving data without page
refresh we have to make sure that they
filled in the subject and the message if
not we're going to give them an error
message that says please type in a
subject or please type in your message
and we'll give them the nice little
round error icon which I'll show you
right now let's see if i refresh this
page and show you right now I'm at text
spectrum's profile I'm going to press
message it opens up to the private
messaging forum and if I just press
submit without putting in a subject or a
message see what happens says please
type a subject nice big red X and then
it goes away using jQuery now say I type
a subject and I leave out the message
please type in your message nice big red
X that's what you want you want to
notify the user that they have to do
something further to process the form
and that's all that's doing so those if
been elsif condition' statements right
there handle that now those two make it
bye and they have put in a subject and
they have put in a message we do this
else condition here which will be the
area where we access jQuery AJAX
mechanism for sending and receiving data
and now I'm going to apply that code and
explain it pretty good name depth for
you but this will probably be the last
time that I go into depth about jQuery
AJAX mechanisms and form sending using
jQuery and Ajax so if you're somebody
who really wants to grasp it I would
recommend really paying attention to
this lesson so let's go ahead and pop
that code in
really quick and keep in mind that I
have not tested this yet there might be
some little tiny thing that prevents it
from working but before I even finish
the video and put it up on YouTube
release any source code it'll all be
working perfectly alrighty so you'll see
here is the code that I just popped into
place this is the code that actually
posts using jQuery well you have the URL
as the first argument there then comma
will separate the URL from the variables
you can see all of the variables are
within curly brace here and the closing
curly brace is right there and all the
variables that are going to be sent to
that PHP script from this form are going
to be assembled right here so you can
see subject which in the PHP script will
pick up post subject this one will pick
up this variable will pick up as post
message so we just take the p.m. subject
value we make that equal a subject
variable we take the p.m. all of these
variables here are laid in right here
and they correspond to posted variables
that are going to the PHP script so the
PHP script is going to be picking up
subject message sender name sender ID
recipient name recipient ID this whippet
and that's it
so those variables are going to be what
sent to the PHP file on return of the
data when PHP gets all done with it
playing with it MySQL all happens within
a split second function will run and
within function there is what four lines
here the first one slides up the whole
message form using jQuery the second
line throws into the interaction results
div which is this guy down here
interaction results is sitting right
above the form and it's a hidden div
that only appears when you need it to
that's where we're showing that red X
and giving the error messages and the
data you see right here up here we're
using HTML and putting raw HTML right
into that argument right there but here
we're using the data
coming back from the PHP script so in
the PHP script is where you actually
assemble the HTML data that's going to
be showed when the message is
successfully sent or if there's an error
that PHP script happens to pick up it'll
show it here the last two lines simply
clear out the message subject area and
the text area for the message and the
input for the subject line it clears
that out so what they typed in
previously is not still sitting there if
the message successfully was sent and
that's how it works
so what we're going to do is now
assemble this private message parsed out
PHP script which I'm already working on
here and then I'm going to test it out
and see if when I send a message to
another member on the site it actually
goes into the database and all of the
appropriate variables were laid into the
database once I see that's working then
I can make the inbox freeze user the
sent box and the reply form and then
we're done okay here is the private
message parse that PHP which as we
noticed in the Java Script is the URL
that this function is set to send data
to so first thing to do is start session
then we're going to do ever handling and
low-level security checks which is all
of this right all through here until we
get to parse the message so you can see
there's a good bit of error handling and
low-level security checks going on here
and all you have to do is when you go
and download the source files or you can
put this on HD fullscreen on YouTube and
just read it all you can see what it
says above the code there's nice code
comments that I took the time and wrote
in there for you that will help you
understand what each little segment of
code is doing here ok I'm not going to
sit here and explain it again when I
already wrote out nice code comments for
you guys this prevents double posts by
checking the database to see if this
sender has sent any messages within the
last 20 seconds so basically this
prevent double post is checking the C
within 20 seconds if they have already
sent the message we don't want to let
them send again we want to make users
wait 20
seconds between all private message
sending and this one is preventing more
than 30 private messages in one day from
this member because each member
according to their ID can only post 30
messages a day and finally when you get
done with your error handling and
checking to make sure everything is the
way it should be before we parse a
message and I might change this code up
a little bit if it's not actually tight
and secure enough there's a little leak
in it where somebody can get some spam
through or impersonate somebody else's
account something like that we'll
definitely go in and fix the code and
make sure that in the next release of
web intersect that that problem is
alleviated now in the parts of the
message section this I don't know what
the hell that's doing there we don't
need that but here we pretty much
assuming everything is cool now and now
we're just going to do some filtering on
those variables when they come in we're
posting we're gathering the posted
values from the forum and putting them
into local PHP variables here then we
can check to see if any of them are
empty they do we exit the script we give
that nice round X meaning ever and we
say missing data to continue that's what
they'll see in that interaction results
container back in the profile that PHP
page if any of these variables happen to
be empty so on the subject the message
what we're doing here you'll notice
running HTML special chars function
which is a PHP function for changing
tags and things so if somebody puts in
let's say somebody puts in this for
instance opening tag script and then
let's close the opening tag what will
happen is HTML special chars will
convert this tag to an HTML equivalent
that will look something like I don't
know they usually look like right there
and lt
and and GT see it's the opening and
closing bracket and that's what HTML
special chars will convert these
brackets to so they won't actually
process
that's what we want and we also do that
to the message and the subject line both
now if happen anything happens to be
left that is malicious characters and
it's not converted by htmlspecialchars
we're running MySQL real escape string
here just to be safe so that's how the
older code works so after those are
converted we're checking to see if
anything's empty or not if it is we have
to give them an error message and shut
down the processing of this because we
need every single variable so if all of
the variables are there this else comes
into play and this code runs we're going
to delete all the messages that are over
100 now this part is a little important
because you might not want to have a
system that allows each member to sit
there and archive 5,000 10,000 or a
million messages within their inbox when
I'm making my system to where they can
only archive 100 if they're not on top
of it more than that I don't even want
them to be using my private messaging
system when I use a private messaging
like for instance the one at develop PHP
comm I keep my inbox nice and clean I
keep my outbox nice and clean that's
because I'm just an organized kind of
person you're going to have a lot of
people on your site that really don't
care they're not very organized and
they'll let their inbox swell up to
10,000 100,000 however many they don't
even care so you can set that limit here
using these numbers so if the delete
comment increment value and I named that
DC I because that's the delete comment
increment value reaches more than 99
we're going to cut delete them all from
the database this is going to cut all
except 99 of those off the tail-end so
their newest messages are still in the
box but they're old tail-end messages in
their list are going to get wiped out
that's how that works so after you clean
up delete the messages that are over 100
or however many you want to let them
archive then we insert the data so we
insert into private messages the fields
to ID from ID time sent subject and
message
these values that we just gathered up
the to the from now we post in for the
time sent field subject and the message
variable it all gets laid into the
database right there now we run a little
check to see if the minus QL query
actually was performed correctly and if
not we given them error message saying
could not send message and insertion
query error has occurred with that nice
red X and we exit the script else we're
going to email them so everything is
inserted into the database if there was
no insertion query ever and we're going
to email the people here and I have mine
commented out because at web intersect
I'm not going to run the emailing alert
thing because mine is like a sandbox
testing site for the actual software
that people can download and I think a
lot of people going to be testing things
out and I don't want all these emails
using up all my smtp limits that I have
in my server so just understand that
this script works when you uncomment
this it's going to send an email alert
to the person who is receiving that
private message telling them hey you
have a new private message at our site
you might want to come and check it out
you throw in the message subject and you
tell them this is an automated message
to let you know that the from name
variable just sent you a private message
and I'm going to change this code up a
little bit to make it a little more
dynamic for all people's websites and
then I'm going to release it into the
version 1.3 3 but now that we have the
parsing mechanism all set up so you can
see after you email them you want to
show the success message little round
icon that PNG image with the checkmark
means success agenda tall group it means
success and it's all green and we want
to say message sent successfully so
that's what happens so basically let's
summarize the script at the top start
session do ever handling make sure
everything is right for sending then you
parse the message if everything is cool
then right when the insertion query runs
you want to email them
after the email runs then you want to
give them the image success round
success PNG and all of this is going to
happen in milliseconds
I mean sometimes if your servers kind of
choking it might take one to two seconds
for all this to process and that's why
we're going to put in the profile that
PHP page that little cool graphic that
we have for showing people that there's
an ajax function happening that the
server is making calls behind the scenes
just like facebook puts that cool little
like loader animation that's what we're
going to have in place so let's see we
have the javascript function for sending
to the PHP file we have the PHP file all
ready to go now I'm going to go and make
a test and see if this actually inserts
data into my database when I send the
private message to somebody else at this
point they won't be able to reply yet
because we haven't made the Inbox
or the reply form okay now with the new
files FTP I'm going to send the message
or test it anyways I'm going to say hi
subject and the message body will say
testing p.m. system and submit message
sent successfully
nice big green arrow letting me know
everything is cool now let's go check my
SQL in PHP myadmin
and as you can see the latest message
that I just sent look at I just I just
put the script up to make this work and
somebody already sent me a message a
private message so this should let you
guys know develop PHP how much I
actually get private messages there
develop page P it's insane I can't even
check them anymore but you can see here
is testing PM system subject hi and I
just sent that a few seconds ago to
member six to six which is text spectrum
and from ID one which is me and whoever
four five one is is the person who
just sent me a private message okay so
you see the private messaging works just
fine on the initial sending so basically
all we need now is the reply form that's
going to be embedded into the Inbox
so all we need is the inbox in the sent
Box reply form is going to be embedded
into the inbox in every single message
there'll be a reply button at the bottom
of it when they hit that reply button
we're going to have jQuery pop up a new
window that is the reply form and just
to let some of you guys know that are
paying close attention on the PM form
here I change this from session ID X to
regular session ID that way in private
message parts I didn't have to break
down that that variable but if you want
to and make it a little more secure you
can break down that session ID X
variable that's encrypted which both are
really encrypted but the ID X the
session ID X variable is double
encrypted
okay the parsing mechanism is really
it's already finished
for the replied messaging also and this
little this little extra piece is a
little pre-emptive action for anybody
who might comment in and say well just
really give a little loader symbol one
the Ajax function is snapping off to let
people know that servers like a call
with little loader Adebayo
alright yeah put that in right here so I
know you guys are going to be phat me
about not putting it in beforehand so
I'm catching y'all before you have a
chance to snap at me about it all right
here we got images loading dot gif it's
in a hidden span that's ID of p.m. form
processor given so let's go into the
JavaScript and right here p.m. form
processor process Gift Show right when
all the variables are set we're going to
send to the PHP script we're going to
show that little animation when it gets
back and everything's done we're going
to hide it hid e that should do it I'll
show you what that did okay if FTP D
adjusted file and I'm going to send a
message now we're going to look right
down here
watch out for that little loader to show
up when we press submit see it and it
only took a split second but if your
servers choking oh it takes in any
amount of time that's longer than a
second or so you want to have that
loader there just in case just to let
people people know that something is
processing okay we'll see you in part 3
where we're going to quickly add the
inbox in the sent box and also build the
reply form into the inbox which is all
going to be very simple and that video
is going to go pretty quick actually</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>