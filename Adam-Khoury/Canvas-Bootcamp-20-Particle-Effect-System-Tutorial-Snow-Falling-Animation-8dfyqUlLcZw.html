<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Canvas Bootcamp 20 - Particle Effect System Tutorial Snow Falling Animation | Coder Coacher - Coaching Coders</title><meta content="Canvas Bootcamp 20 - Particle Effect System Tutorial Snow Falling Animation - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Adam-Khoury/">Adam Khoury</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Canvas Bootcamp 20 - Particle Effect System Tutorial Snow Falling Animation</b></h2><h5 class="post__date">2013-12-10</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/8dfyqUlLcZw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello ladies and gentlemen in this
exercise you can learn to program
particle systems for a snowfall effect
this will give you insight into how we
use tiny little graphics or sprites with
randomized motion to create some kind of
greater effect you can create particle
systems for smoke fire rain animated
star fields snow and a ton of other
things before we learn the code at work
let's take a look at the finished
product of the snowfall effect now when
you run this on your system it will look
a lot smoother and it might look a
little bit choppy because of the
framerate of my recorded tutorial video
now you can see what we're doing is
making a particle effect out of little
tiny shapes and I programmed it in such
a way to where the circles that are in
are closer to us or look to appear to be
closer to us or a little bit bigger and
they're flowing down faster okay you can
see I'm starting out with an empty black
canvas and there's nothing going on on
it yet and all I have is an animate
function which we discussed in earlier
lessons now the first thing I'm going to
do is add a background image for my
snowy scene so I'll save our BG is equal
to new image object instance and then
I'll make the BG source equal to the
image that I want to use and it has
dimensions of 700 by 350 the same exact
dimensions as my canvas so it fills the
entire canvas background now in my
animate function I'm just going to type
in CTX draw the image and then we'll
place the parameters that we need the
image resource which mine it's called BG
and we need the X and y so I'll put 0
and 0 since my image is the same exact
size as the canvas we'll put it starting
in the top left corner now if we run
this in our favorite browser we get our
background image for our snowy scene and
by the way if you want to know how to
make a snowy scene just like this
I have fireworks tutorials where I show
how to make really cool Christmas scenes
and stuff like that with the Stars
and Aurora lights in the moon and Santa
flying and all kind of cool stuff so
check out some of the fireworks
tutorials if you want to learn how to
create these graphics for your
backgrounds or you can programmatically
create your graphics on the canvas which
is a little more tough probably faster
and workflow just to go into a graphics
editor and make your background now
we're going to go right under where
we're getting our canvas width and
canvas height variables I'm going to put
another variable called flakes and this
is going to represent an empty array at
first but using a little bit of loop
action we're going to pack that array
with a whole bunch of little snowflake
objects so for this basic example I'm
just going to use two functions I'll
have function add flake and I also want
function snow now go down into my
animate function and right under where
I'm drawing the image I'm going to call
the snow function to execute so that's
going to execute many many many times
per second and the snow function is
actually going to call the add flake
function so what I'm going to do is
inside of the snow function every time
it executes so is the add flake function
now within the add flake function we're
going to need three variables and then
we're going to push a new little
snowflake object into the flakes array
so we'll have VAR X bar Y and bar s and
s you can think of either as speed or
size you tell me it depends on how you
want to look at it so for the exposition
for each little snowflake that's going
to fall we want to make sure that it
starts up above the canvas or it comes
in at the very top of the canvas and
it's at a random position along the
horizontal plane we don't want them all
falling from the same x position we want
them falling from random X positions so
X is going to be equal to math.random
times the canvas width now what we're
going to do is wrap that in math dot
floor to round it down math dot floor
we'll round that down so there's no
decimal resulting decimal number it'll
be a rounded number and then out here we
say plus 1 now that gives us a random
burr between 1 and the canvas with our
canvas within this case is 700 so the
little particle which is our snowflake
is going to fall at a random X position
between 1 and the canvas width between 1
and 700 then for the Y position that's
just going to be equal to 0
or you can make it equal to minus 10 if
you want them to start a little bit
above the top border of the canvas I'm
just going to start them exactly at the
top border of the canvas but you can set
that at like minus 50 or minus 10
whatever you want now for the s we can
take this value here which is the random
number between 1 and 700 in this case
and we're going to make a random number
between 1 and 3 that gives me 3 layers
if I wanted like 5 layers or even more
to my particle effect system or my
snowfall system I can raise this number
a little bit if I put this on a 2 it'll
only appear like this two layers of
depth to the particle system so I'm
going to put it on 3
so my particle system has three layers
of depth and we only need one semicolon
there now finally we're going to push a
little snowflake object into the flakes
array so we say flakes that push and the
value for the push method is going to be
a little JSON data object or some of you
guys might recognize it as an
associative array so the first property
is going to be X then we put the colon
and then the x value the X variable
which is a random number between 1 and
700 then we're going to put the Y
property for this little object colon
and then the Y variable for the value
then the last property we want is the s
and that represents speed or size
depending on how you want to look at it
and I'll show you what I mean about that
in just a moment ok so now every time
your snow function is called to run the
add flake function is also going to run
pushing a new little flake object a new
little snowflake into the flakes array
and it's going to have a lot of random
values going on so they're not all
dumping
in one place now all we have to do
within our snow function is loop over
the flakes array so we're going to set
up a loop that's going to run over the
length of the flakes array this will
make all the little snowflakes animate
down the screen well actually we're
going to be adjusting the Y value to
make them animate down the screen within
this for loop the first thing I'm going
to do in the loop is set a fill style
and I'm using RGB a that way I can have
a white shape that has some opacity to
it I made them a little bit opaque
because sometimes your snowflakes you
might want to have a little bit of
opacity in your snowflakes or
transparency so you can set that between
1 and 0 if you put it at 0.5 you'll have
half transparency on the next line I'm
going to CTX dot begin path we're going
to run the begin path method because
we're going to start a new arc shape for
each little snowflake so under begin
path we type in CTX arc and to create an
arc we need an X parameter a Y position
parameter here I'll just put a little
note to show us the parameters right
above it so arc gets XY radius start
angle and angle and anti-clockwise so we
can access each flake as it comes
pouring through the loop by the I
variable index so for the x position we
just say flake we put I in the brackets
and we say X position for that
particular flake then we give it a comma
we're going to do the same thing for the
Y position so we'll say flake dot Y then
I'm going to add to that plus equals
flakes dot s which is speed or you can
think of that as speed you can think of
that as which layer it's on or you can
think of that as size it really it's all
up to weight the way you want to wrap
your head around it
and the reason why we're going to add
the randomized s value plus equal to the
Y position is so we get the downward
animated movement now what I'm also
going to do is add times 0.5 to cut that
number in half so you take the flakes s
whatever that value is and you're going
cut it in half and that completes your
y-value now we need the radius of the
arc which is the size of it so we're
going to take this right here that same
value we're going to use that for the
size of the snowflake and remember that
the S is one of those randomized values
between 1 and 3 I put a comma we need to
start angle end angle and anti-clockwise
so the start angle is going to be 0 the
end angle is going to be math dot pi
times 2 which gives us a perfect little
circle and for the anti-clockwise
parameter I'm going to put false ok so
now we can remove this little note so
after we establish the arc then we say
CTX dot fill method to actually place
the arc to fill it to the canvas
at that point you have your snowflakes
falling but I'm going to put one more
little bit of logic which is a condition
statement that's going to remove any
snowflakes if they happen to get past
the bottom of the canvas and they're out
of visible space so we don't have to
manage them and render them anymore
hogging up memory make sure we run
flakes that splice on any flakes that
y-position
becomes greater than the canvas height
so if the flakes dot Y position is
greater than the canvas height that
flake is going to be removed by splicing
it out of the flakes array and for
developer purposes right under that I'm
just going to write into the status
element on the page the snowflake count
I'm going to keep track of how many
snowflakes are within my flakes array or
I want to see that value so if you want
to see that value you can run a line
something like this and you just have to
make sure that you have a status element
down in your page under your canvas so I
have an h1 with ID of status that's how
I get that and running all of that
together gives us this and we're not
getting any snowflakes oh this says
flake this has to say flakes sorry about
that just make sure all the references
for your flakes array says flakes and
not flake like like I put it there now
if we run this in our favorite browser
there we go so we got a little snowflake
count running down here you can see as
they leave the canvas they're getting
removed and new snowflakes keep pouring
in from the top and it just keeps
running that way
now a really simple way to make that
thicker if you want a lot more snow
coming down you can just go here where
you saying add flake and just add two
flakes at a time and then you'll see you
have a much higher density of snowflakes
what if I did it four times we get a
whole ton of snowflakes in our particle
system
alright now let's grab all the code
highlight all that code I'm going to
collapse it in the add flake and the
snow functions I'm going to collapse
those bring this animate function up a
little bit and now what I'm going to do
is go into right in between the draw
image and snow I'm going to rotate the
canvas to make it look like my snow is
coming in at an angle maybe it's a
blizzard and it's blowing in from the
side so I'll say CTX rotate I'm going to
rotate the entire perspective of the
canvas and if you put that on zero
you'll get no rotation and I'm going to
open up my CTX at save and see t x dot
restore since I'm using a method that's
going to manipulate the perspective of
the canvas I want to make sure that I
save and restore the last layer in the
animation stack so if you run that with
0 rotation you'll see that it's the same
effect that you had before they're
coming straight down but now if I change
that to something like negative 0.4 and
then I run it you'll see that I now have
a sideways motion which coming down
diagonal then what you have to do is
compensate for the skewed perspective of
all of that snow by making it fall
deeper into the canvas making it fall
further maybe another 200 pixels before
they disappear and you want to make sure
that they come out further off to the
left over here because you have a blank
spot here too so you can see that
basically there's a rectangle right
there that you can visibly see where the
snow is falling that's because I rotated
the canvas a little bit now if I didn't
see TX dot save and restore you can see
what this looks like it's just spinning
everything around and around and around
because every time this little animate
function runs we're not saving than
restoring the last layer of the
animation stack so you're going to make
sure you see TX dot save and restore if
you want to do rotate
and effects and things like that so if I
put this on point eight it'll be a
really dramatic sideways effect so
that's how you can make it look like
you're snow or you're rain or whatever
is coming in and in an angle you just
have to make sure that you tweak your
numbers about where your snow is falling
and the boundaries for where it's if
you're going to rotate it but I'll just
leave mine on zero for this quick
example because I'm not going to spend
too much time here and we'll leave it
falling straight down okay so that shows
you how to create a particle effects
system using JavaScript on the canvas
element for a snowfall effect</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>