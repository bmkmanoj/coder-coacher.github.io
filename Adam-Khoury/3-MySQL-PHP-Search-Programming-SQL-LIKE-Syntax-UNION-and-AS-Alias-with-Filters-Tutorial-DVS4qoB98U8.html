<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>3. MySQL PHP Search Programming : SQL LIKE Syntax UNION and AS Alias with Filters Tutorial | Coder Coacher - Coaching Coders</title><meta content="3. MySQL PHP Search Programming : SQL LIKE Syntax UNION and AS Alias with Filters Tutorial - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Adam-Khoury/">Adam Khoury</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>3. MySQL PHP Search Programming : SQL LIKE Syntax UNION and AS Alias with Filters Tutorial</b></h2><h5 class="post__date">2011-10-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/DVS4qoB98U8" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome to part three of MySQL PHP
search programming in this part we will
discuss and apply the SQL syntax for
searching MySQL databases and offer up
some example code we will be searching
the example tables that we all made
using that script that we had in part
one of this series before we go any
further you're going to want to
familiarize yourself with the following
my SQL syntax if you're not already
familiar with it and all of this syntax
can be studied and researched at the
MySQL the reference manual online for
MySQL documentation you know what I'm
saying like syntax is used for searching
MySQL database tables and it has similar
functionality to the regex pattern
matching of MySQL this type of search
method will give exact results where
search query is found and one can order
the rendered results by the date field
or any other field that happens to be in
that column list and the SQL syntax
would read something like like this
select all from table with your target
table where the target field in that
table is like whatever your search query
variable is you use your % on both sides
to let the query know that you want the
whole phrase matched the match and
against syntax is how we can run
full-text searches that query reads
something like this select all from the
target table where match whatever field
that you want you can have multiple
fields separated by commas here that you
want to look inside of to see if there's
a match against this target search query
or the phrase that the person is
searching for goes right there and since
we set up our database table to have a
full text index for the title and for
the body of our pages and our blog that
means we can use this method and we'll
get some results and this method is more
for having a natural language search
that can be fine-tuned by the programmer
which is you and ordered by relevancy
descending
so that means it will give you results
and the highest relevancy for the target
phrase that the person is searching for
will be on top so it will be ordered by
relevancy descending if you set up your
match and against syntax correctly for a
full-text search and this method
requires that you have full text indexes
set on the columns in the database that
you want to match within and you'll
notice in video one of this series when
we created our tables our exercise
tables for this whole little series that
they had full text index already set up
on them in the create syntax but if you
have existing tables and you want to use
this kind of syntax then you would have
to add your full text indexes after the
fact now I put Union and as syntax
together but they're not really related
but I'm using them together in this
scenario for our search
what Union does it will allow you to
take you can see here I have one select
query and it could be any kind of select
query that you want and then I have
another select query and what I'm doing
is wrapping each one in parentheses and
in between them I just put the word
Union and that allows me to combine this
query with this queries result set you
can see here I wrote Union combines
multiple queries into one large result
set now as is not directly related to
Union but it comes in handy when you're
using it because you can see in our
tables we have two tables and I
purposely didn't name them both title
for the whatever page is titled it is I
named it page title and then in the blog
table I named it blog title so I'm
showing how to use the as syntax to
select the page title as the word title
now it really adds the name title so you
can see I wrote down here as allows you
to set an alias name for any field names
so I'm creating an alias name called
title for my page title field has an
alias name now called
title and my blog title field has an
alias name now of title as well and
that's selecting from the blog table
this select is for the pages table this
select is for the blog table so in the
result set I can just target the alias
name of title for both of them okay now
enough talking let's go to the code mang
and then we'll test how it works we'll
release the code and then you guys can
mess around with it on your own okay
here we are back again with our same
search dot PHP page that we created in
part 2 of this lesson series alright
this is that same page and I added some
code to with already but it pretty much
looks the way it did when we left off in
part two because I have all the code
that I applied all packaged up into
these little blocks here which I will
expand and explain all the code then
I'll give the code to you guys to play
with if you want it and the first thing
I did was I added a little part that
forces script errors and warnings to
show during production only so you can
see that codes right there those two
lines just like we had in the first
script of this series and then we
initialize the search output variable
and this is the same code we had before
where we were seeing if the posted
search field is set and it has a value
and we discussed that in video part two
now all of the new code I applied is
wrapped up in this block right here and
everything else on the page you remember
from video two okay so now let me expand
this block right here and we'll discuss
everything that's within it okay let's
expand that out and the first thing
we're going to do inside of that if
condition is we're going to filter the
search query user input so if I open
that line up you'll see exactly what
it's doing we're using the preg replace
function in PHP to do a case insensitive
replace for everything but letters space
character numbers and the question mark
if you want to allow any other strange
characters in there this is where you
type them in you want to allow that one
that one exclamation whatever you want
but I'm doing that just to disallow
things like quote more
ARC's and any characters that I don't
want to allow like those I won't even
allow those but I will allow the
question mark and the exclamation but
you can assign any more characters that
you want to allow right here so we
replace anything but these characters
that we want to allow with nothing and
that's the second parameter of preg
replace you just claim what you want to
replace those things with in this case
we want to just remove them so we
replace with nothing and the string that
we want to target all those replacements
on is the posted variable of search
query okay so the posted variable that's
coming from and you also want to filter
this variable because the person might
put in SQL injection attacks and things
like that they might try and drop your
whole database if you allow them right
through your search form so you got to
make sure you filter this input now here
is where we're setting up the logic let
me put this down
I don't need that here's where we're
setting up the logic these if and else
if condition statements here is where
we're setting up the logic for that
filter if we go in design view
remember this filter we put in to allow
people to search only within certain
tables if they want to that's where
we're setting this up so if the post
filter one and you can see filter one is
this select field so if its whole site
you can see if post filter 1 equals
whole site then we run this code block
right here else if the post filter 1 is
equal to pages then we know they just
want to search in the pages section of
the site or the pages table of the site
and we run this code here which sets up
a different query else if the filter 1
is equal to blog then we know the user
wants to search only within the blog
section of our site so we set up a
different query here now the whole site
query is a tricky one because you have
to have a union or some kind of join
table query and search at the same time
so that's really the whole site query is
going to be the trickiest one this one's
a little bit easier and so is this one
because you're only targeting one table
in these this one is a little bit tricky
because we're targeting the pages table
and the block
table and we're combining it all into
one large result set so that's why it's
a little bit tricky
and we'll discuss it all with you don't
worry about it we Union we're using the
Union and the ads syntax if it happens
to be the whole site that they want to
search in now before I open up these
three little code blocks and explain
them let's move on down a little bit to
see what happens after we set up the
right query that we need according to
the filter to the person's wanting to
search by what happens after that after
we get the query that we want we can
connect to the database so you use your
connect to my SQL file there and then
you run your MySQL query with the SQL
command which is dynamic it's
dynamically made within these if and
else condition statements and that's how
you set up your filters and if the query
has any problems you'll get the MySQL
error and the dive function will fire
off killing the script and you get the
MySQL error and the next line is we get
the count from how many items are coming
back in the result set
for what the person searched for how
many items were found and the count you
can get that easily enough by running
MySQL num rows function on the query
variable then the last little bit is we
say if the count is greater than one
that means there is at least one result
then we're going to build some search
output for the page else we're just
going to put search output to say zero
results for the search query that you
search for Bob reply and then another HR
tag which is a horizontal rule and then
we show the SQL command it's that simple
so here's a horizontal rule that's just
a line going across the screen and then
it'll say zero results for the thing you
search for another horizontal line
across the screen and then an SQL
command and I only put the SQL command
there for development purposes so you
can see exactly what's being queried
from your database now if the count
happens to be one we're going to build
some search output so let's open that up
and show you what it consists of in the
search output the first thing we do is
the same thing as if there's zero
results we'll just say
there's zero results for the search
query and then we show the SQL command
if there are some results we're doing
the same thing with a horizontal line
but we're putting the count number here
we say count results that this will be a
number either 1 2 5 a thousand whatever
it'll be like 384 results for search
query whatever they search for will be
printed there and then for your
development purposes you can look at the
SQL command again
so whether the query gives results or
this 0 results you're going to see the
SQL command and these horizontal rules
now to get the actual results out we're
going to use the MySQL fetch array
function on the query in a while loop so
through this while loop is how we'll
access each thing that is in the result
set each item from the database we can
get the items ID right there the items
title right there and then we build the
search output compounded variable this
is a variable that keeps appending to
itself kind of using the dot equal
syntax so all of these items get
appended to that you can see there's a
break tag between each one we can output
the item ID you can build navigation
links using this item ID to various
sections of your site and yadda yadda
yadda and then the title goes right
there and you can also query out some of
the body that if you want and maybe cut
it down to maybe just 200 characters and
throw that under the title where that's
not clickable data but it's just
something for the user to read to let
them know if that's what they're looking
for but really you would want to have
like Google does it have the title
clickable and then maybe some data under
under it but have the title clickable
for that ID for that item so the person
can go read the page or whatever I'm not
going to build this whole application
for you you guys are smart and you can
figure it out okay now you know exactly
what that's doing so I'm going to pop
that back up into a little package now
all we have to do is explain these three
pieces of code blocks here that we
didn't open up and explain yet now the
first one is if the person had a desire
to search within the whole site get
all the results from the whole site all
the tables in one query now since that's
the most complicated code and is using
the Union and the as syntax I'm going to
explain that one last so let's explain
this one first
else if post-filter was four pages that
means let's say I'm right here
search for remember we had let's see
let's search for flash because I had
some topics with flash within just the
pages submit query you see two results
for flash item ID three and item ID
eight the title was flash gallery and
this title was flash website and here's
that little query the SQL command now
that little example or that little test
I just did on this little application
I made the scenario where this else if
condition statement met true so it ran
so let me open that up and you can see
it now what we did was we select the ID
and the page title use the alias of
title for page title that way we didn't
have to change too many things down here
in the output remember in the output you
can see I was just referring to the name
title and not page title and I still got
the page title that's because I'm using
the alias of title on page title so
basically I'm selecting ID and page
title but I'm using the alias of title
for page title from pages so I'm
selecting ID title from pages where page
title is like the search query so in my
case I just search for flash so flash
would have been right there so where the
page title is like flash or the page
body even all of the text within the
articles and pages where that is like
the word flash or whatever the key
phrases that the person is searching in
you pull those results out only okay
let's package that up and now you know
how to use the alias to change the name
fields and the like syntax and you saw
the results of it if I go back here and
I search for pet bird which was some of
the information in my blog I type only
blog now you have two results for pet
bird and I have item ID four and five
new pet bird and then pet bird ID those
are the two blog entries I have for my
pet bird
that is this section meeting true this
if condition so else if the filter is
equal to blog then we run this code
which is very similar to the code that
we just explained we select ID in the
blog title the blog title has an alias
of title I'm doing that just like I said
before so I don't have to have different
code down here for my output I can use
the same word title from blog where blog
title is like pet bird or blog body is
like pet bird okay now let's pop that
one back up in this little package and
now let's explain the tricky one now
this one is using let's go back here to
our little illustration this is using
Union you can see remember when I
explained how Union works you have one
select statement wrapped in parentheses
and then you have the word Union and
then you put your next select statement
wrapped in parentheses Union combines
multiple queries into one large result
set so knowing that all I did was I put
a select query that's pretty much just
like this one for pages and this one for
blog down here but it's wrapped in
parentheses you see select ID page title
as title and using alias again there
from pages where page title is like
search query or page body is like the
search query and then I Union another
select statement that's selecting the
same things but from the blog and that's
where we're using the Union syntax and
the aliases together now every title
that comes out no matter if it
is a blog title or a page title it's
going to have the name title and I can
just target that row output or that name
alias for my row output in my while loop
now I'm going to discuss I'm going to
give you guys one little suggestion or
hint I'm not going to program it in but
a lot of people are going to ask about
it I tell you what before I pass along
this little tidbit of information let's
just call this video done you can see
this application here is running live
online and let's say if I was to search
within the whole site for blablabla I
should get every result because remember
every one of the pages that I put in and
every one of the articles have blabbed a
bit out in the end
so if I submit this query you see I got
all eight pages from my pages table and
all five pages from my blog table as a
result and it's using that Union syntax
here you see but now here's what I'm
talking about in these result sets here
you're going to want to give links to
this page and you're going to want to
give links to this blog page so the
person can read the whole thing because
that's what they're looking for or
because things that they were searching
for happened to be found within these
things so since you're using a union
query and everything's coming out in one
result set your result set your while
loop is going to have no idea what
section of the site to send these people
to so your you are going to have no way
to know how if to send the person to the
blog section of the site to that page ID
or to send them to the page to the pages
section of the site or maybe you have
members section where you're leading to
somebody's profile you're going to your
query is going to have to know what
section of the site to navigate to send
these people to these pages if you're
using a whole site query so this is what
I wanted to discuss really this
as part of the tutorial is over I just
wanted to give a little bit of extra
insight and information into that if you
use this whole site type filter maybe
you should remove that if you're going
to have complications programming or and
I'll tell you how I would get it done
but if you're going to have
complications putting in your navigation
links to these all these items so the
person can click on it and go read that
page you might want to remove whole site
and it's because it's going to be really
difficult for your query to know which
table this data is coming from and what
you can do to fix that problem is you go
into your database and you go into first
you go into your pages table and in that
table you make a new field that's called
what table and make it have a default
value for every row in that table make
it say pages then you go into your and I
know I'm probably confusing the crap out
of everybody but it's going to have to
be done this way if you want to use this
type of whole site filter if you're
using a union query anything that's like
mine and your database is set up
anything like mine your queries not
going to know where to send these people
to you're going to have no way to
program the link incorrectly but I'm
giving you a fix right now and man is
taking forever to talk about it I'm
sorry what you do is you go into your
pages table you put a new column and you
call it what table for every one of
those roles that gets populated in that
table make sure that has a default value
in that column of pages then you go into
your blog table
you make a new column on that one you
call it what table in that one you make
sure the default value for each blog
entry of blog so you select ID page
title as title comma and you select what
table from pages and you also do the
same thing in this select select ID blog
title as title comma what pages from
blog where laptop</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>