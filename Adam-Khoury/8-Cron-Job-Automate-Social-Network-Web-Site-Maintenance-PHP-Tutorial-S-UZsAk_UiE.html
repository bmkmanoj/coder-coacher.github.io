<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>8. Cron Job Automate Social Network Web Site Maintenance PHP Tutorial | Coder Coacher - Coaching Coders</title><meta content="8. Cron Job Automate Social Network Web Site Maintenance PHP Tutorial - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Adam-Khoury/">Adam Khoury</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>8. Cron Job Automate Social Network Web Site Maintenance PHP Tutorial</b></h2><h5 class="post__date">2013-01-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/S-UZsAk_UiE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">welcome back to the web intersect PHP
and MySQL social network production
series in this lesson we're going to
show you how to write your first
automated site maintenance script and
we'll show you how to set a cron job to
make it execute once daily to perform
certain tasks that are social site will
require if it is to stay clean stable
and uncluttered the first scripted task
we're going to automate once a day is
clearing our database of people who have
signed up but never activated for
whatever reasons if you do not do this
your database will become heavily
clogged with non-existent people over
time
okay here's a look at all of the files
within our software system so far so
what I'll do now is create a new folder
in here and call it cron jobs now I'll
open up my scripting editor and I'm
going to create a new PHP script make
sure I'm in code view get rid of all
this crap and we'll put in a PHP code
block I'll press ctrl s to save this
file into your newly created cron jobs
folder so double click and save this
file you can name it anything you want
but I'll just name it once a day or once
daily because this script will be
commanded to by or off once daily
because I'm going to set it that way
alright so you have once daily dot PHP
okay the first thing we'll do is require
once our database connection file so you
just put forward slash to go up one
folder and then into the PHP includes
folder database connection file now you
write yourself a comment and you say
this code block deletes all accounts
that do not activate after three days
and you can set that to any interval you
want maybe you want seven days 30 days
and here is the SQL syntax and the query
for that the SQL syntax reads select ID
username fields from the users table
where their signup date is less than or
equal to the current date minus three
days so you can set that interval to any
interval you like like I said and then
you want to make sure you say and
activate it equals zero because you want
to make sure you're not picking people
who have activated one because those are
people who have activated you just want
this query to select people who have not
activated yet and it has been three days
since their signup date and then you
actually execute the query here with
your MySQL I query function then we're
going to check the numbers from that
database query result so we use MySQL
item rows on that query and pack it into
a variable called num rows and you can
just highlight that copy it and write if
open close parentheses opening curly
brace go down a couple of lines and
closing curly brace in the if condition
you want to put if num rows is greater
than zero that
means if there's at least one we're
going to execute code right here and
that code looks like this it's going to
be a while loop that loops over that
MySQL result set so if there happens to
be ten people who are in your database
that have not activated after three days
they are going to be pouring out through
this loop this while loop and we use
MySQL fetch array on the query and we
set the second parameter to be MySQL I
associate that way we can just put the
field names right here and that
associative array is put into this
variable called row then you can access
the elements within that array using
their name or their key in the array
which is the field names so let's say
the first user is found and he comes
pouring through this loop you're
selecting his ID and his username and
you're setting up reference to his user
folder that's within your file system
because you have to make sure you delete
that as well so we just say if is
directory that means if it is a folder
then you're going to use the remove
directory function on that path and that
will effectively remove that user's
folder and that folder is going to be
empty because they have not activated
yet so that means the site won't let
them do anything so their folder will be
empty so you don't have to worry about
removing the folder contents before
removing the folder because remove
directory is touchy when you have files
in a folder and you try and remove it
okay and the last two things you want to
do is delete the user from the users
table where ID equals this users ID and
username equals this user's username and
they're activated equals zero and you
just say limit one because each time
they come pouring through the loop you
just want to delete that one member so
if you have 20 members that have not
activated yet this while loop will
process 20 times for each of them
independently then you actually execute
that delete them from the users table
query then you delete them from the user
options table where username equals this
username limit one and then you actually
execute that query right there and
that's all there is to it this script
should effectively remove everybody from
your database that is
a dead soul somebody who did not
activate yet and if your site gets
popular you'll have hundreds of
thousands of these non activated members
so you want to get them out of there
now all we have to do is show you how to
set up a cron job that's going to
automate this script to buy up once a
day on your server that way you don't
have to mess with it and there's tons
and tons of site tasks that you can
automate for a PHP and MySQL website
using cron jobs I mean not you can do
way more than just deleting
non-activated members and if it's
something that's going to happen once
daily you can just stack a whole bunch
of code blocks right in here in this
once daily dot PHP file that way you can
be sure whatever code blocks you want to
run once a day execute
now login to your hosting account cPanel
and if you happen to be on some kind of
host that doesn't have cPanel maybe they
have custom control panel they'll have
the cron job so the crontab available
for you to click on somewhere within
that system
so click cron jobs down in the Advanced
tab okay so I want to set this cron job
up to fire Raw once a day and here's my
command string so I have PHP space and
then the home directory for my
particular hosting account and my
username and you can find that string
for your home directory on your cPanel
homepage down in that left column it
says it should have your username your
home directory and things like that
that's where you can find that
information if you have any trouble you
can get in touch with your hosting
account provider and they'll guide you
through the process of how to set up
cron jobs command on their particular
system so you can see how mine is
structured I go into my public HTML
folder into my cron jobs folder that we
just created and then target once-daily
PHP and the command gives me a little
check mark there okay and then click add
new cron job it says added cron job
whenever you want to delete this cron
job if you don't want it to run anymore
you simply go down to the section where
they show your cron jobs and hit delete
now it might take you some time to get
some users or maybe you want to test how
cron works right now in five minutes you
want to see it executing so let's create
another one every five minutes you want
this one to run or you can set it to
every 10 minutes whatever you want I'm
going to go every 5 minutes
and here's my command test dot PHP in my
cron jobs folder my public HTML folder
of my hosting account in PHP space is on
the front of that now that's just the
string commands from my particular
hosting account seems to work for me so
you might have to if it doesn't work for
you this test dot PHP cron job then you
can search your hosting providers help
files or you'll have to get in touch
with them to find out the exact string
that you have to put in here to make
this cron job execute so let's add that
new cron job as well every five minutes
test dot PHP now I'll show you test dot
PHP
you can put your email at your adjust
comm there and then your autoresponder
email from your web host and then just
put an autoresponder address that's from
your website and the subject can be
testing cron and the message could be
cron is working remove test cron job now
and then you simply use the mail
function to send that message to
yourself and if your test dot PHP cron
job is actually working you'll get an
email every five minutes so in three
minutes I'm going to check my email
inbox to see if it arrives because it's
847 am right now so I'm going to wait
till 850 and 850 I should have an email
and then every five minutes after that I
should get another email you don't want
to keep that test cron running it's just
to for you to evaluate
okay my email INBOX I have this message
that means my quran command is accurate
for my hosting account because
everything is working I'm going to go
back to my hosting account control panel
and delete test dot PHP cron job delete
delete and now I just have that once
daily so if you know that test dot PHP
works you'll know that once daily that
PHP is going to be called to execute
once a day and even if my script logic
is off a little bit you understand what
this script is aiming to do you want to
delete people out of your system if they
have not activated their account after
so many days whatever interval you want
to set okay so remember that cron you
can set it to run five times a day once
a day every five minutes every minute
every 30 seconds once only at Christmas
once every five years whatever you want
to do okay so that's how you can set up
cron jobs to automate site maintenance
on your website so that way you're not
working so hard and doing all of these
things manually that you could
potentially set up to be automated</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>