<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>12. Friend Lists and Social Website Notifications PHP MYSQL JavaScript Ajax Tutorial | Coder Coacher - Coaching Coders</title><meta content="12. Friend Lists and Social Website Notifications PHP MYSQL JavaScript Ajax Tutorial - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Adam-Khoury/">Adam Khoury</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>12. Friend Lists and Social Website Notifications PHP MYSQL JavaScript Ajax Tutorial</b></h2><h5 class="post__date">2013-02-07</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/zgFeh0TAW10" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello let's continue in this portion of
the series we will cover the logic
behind programming notification lists
and friends lists smash a mirror
first let's demonstrate the
functionality of the strips in this
lesson live online to prove it works do
you crazy people out there who think I'm
lying about all of this making it up see
what happens is some people run into
code trouble and then they think I made
a broken tutorial and they'll put
comments in like Oh Adam this isn't
working for me what happened to your
tutorial but in actuality it is their
brains that is broken they forgot a
pillow a little something : with
something my shoes will be working I'm
proving it right now so if you go to the
site web inertia comm and you sign up
right now on your profile you'll see all
your friends after you make it so here's
as I have 12 friends on my profile so
you're going to be getting updated user
PHP script and you're going to get this
notifications that PHP script and you're
also going to get an update to your
friend system dot PHP that lives within
your PHP parsers folder so you're going
to get update to two files user dot PHP
and friend system dot PHP you're also
going to get a whole new file called
notifications at PHP now I set these
here and bright yellow ugly columns
because I'm not pretty firing anything
for you people and I would like to for
you guys to just take these code
containers and maybe you can put them in
magic boxes when you get better at web
development later you don't have to have
these on a page called notifications
these boxes can be pulled up by links in
your header you can have a link up here
says render requests and put a number
next to that on how many friend requests
they have when the user clicks that link
when you get better at web development
all you have to do is learn to make a
magic box appear wherever you want it to
and it can have all the content that you
want in it by simple Ajax requests still
ahead so all I'm doing is throwing these
things on this page here and you can
take the code logic from this script
that I'm about to explain to you in a
minute and put it anywhere you like
within your social network system for
now you're not going to have any
notifications in your system unless you
program that in ahead of me but for now
this will be an empty list that says you
do not have any notifications
your french request list will most
certainly be populated if you have
friend requests so coal mine has
requested friendship of me or in
February 6 so I can accept or reject now
let me show you how it works if I click
accept it says press ok to accept this
friend request and you don't have to
have these confirmed boxes I'm just
doing that for just another layer of
confirmation when people click things
but you don't have to even have those
you can have the Ajax process right when
they hit accept the button but mine's
going to process right when they hit ok
and then it said processing for a second
request accepted and I'm now friends
with coal mine and I can click here and
go to his profile and see look he has
one friend it's a dam now if I go back
to my profile he's going to be in my
list as well so now you can see I have
13 friends so back to my notifications
and Miguel has requested friendship and
I have nothing against Miguel and I'll
go re request him in a second but I'm
going to reject it just to show you what
it does
reject press ok to reject this
friendship request ok request rejected
you chose to reject friendship with this
user so if I go to his profile you can
see he has two friends but I'm not one
of them I can request friendship from
him now to make up for me rejecting him
I helped him Miguel will be my friend ok
it says ok and request sent so now
Miguel when he checks his notifications
page he's going to have a friend request
from Adam on whatever date it is today
so I'm gonna go through here and accept
all my good buddies ok I'll take up
buddy ok I got new buddies I'm gonna
have lots of friends I'm going to talk
to him hold them squeeze them and call
them George ok so now I'm down at the
end of my list you'll see I only have 3
left to accept or reject so what happens
if i refresh the page right now go to my
notifications page and boom see it's
just those three all of the other ones
that I previously handled will be gone
from the list which is what you want ok
so let me accept these last three good
buddies of mine
hmm okay so now if I click notifications
I have no friend requests and I have no
new notifications and like I said this
will not even be populated yet with the
programming that we have in the system
so far that's coming now if I go to my
profile I have a hub and Jeff I am 34
friends but there's only going to be I
think a max of like 18 showing here and
you can have a max of how many ever you
want you can show just the first 4
friends or a randomized array you can
randomize the array so it's always new
friends of that user being shown in like
a six box slot you know what I mean and
it looks like I must update a link on
this page let's see yeah the reason why
this is a blue link when it should be
just black text it's because I have a
link tag somewhere on user PHP where it
should not be or I have it closing not
closing where it should be closing you
know what I mean and I can fix that
don't worry before you get the code
that'll be fixed
see you on Jeremy it's not there because
he has no view all link and actually
that view all link is not you don't have
a page called view friends type PHP yet
but you can go ahead and create that and
this link will already navigate to it
but let me go ahead and fix that I'll
show you okay see I'll show you exactly
in the code what my retarded but did I
have an a tag opening here and I'm
closing it with a button tag so that's
why you see what you see there so let me
just change this to an A and we'll be
good to go
now if I upload that you'll see that
little mistake is gone and that's I'm
going to leave this in the video just to
show you guys that everybody messes up
little syntax errors but you have to
know where to go back and fix them
that's the key and it just took me two
seconds to narrow down in my script
where that was occurring now watch what
happens if i refresh the page watch
these this text here that says block
button see it's the way it should be now
and the link is closed here reason why
it was blue and selectable before is
because it was being considered part of
that link since I didn't
my link tag correctly haha
okay first let's blast over this friend
system dot php' update you already have
a version of friend system PHP from
earlier in the series but now we're
going to put some more code into it and
you can see that right here this PHP
block I like to connect my PHP blocks
like that so there's no white space in
between them and honestly you don't even
need PHP blocks dividing these I just
did that so you guys know how to more
visual sense of where your code blocks
were for certain logic this could all be
one giant PHP block that opens up here
and closes down at the very end here now
the code that you have previously is all
collapsed right here and I have that all
collapsed because I don't want it to get
in your way visually while we're
explaining things this new code here
that's been added I'll explain to you
right now now this whole new code
segment is for when the user who's
checking their friend requests either
clicks accept or reject so we in take a
few variables both the first variable we
in take is over checking to see if a few
variables are set before this code even
runs the action variable which is going
to be either one of two things it's
going to be accept or reject you can see
I'm checking if post action equals
except here and then if post action
equals reject this code runs in that
case if the post action is accept all of
this code runs instead so the first
thing we do within this little script
block is we get the request ID the
friend request ID which is basically the
ID that represents the row in the
database or that friendship that has not
been accepted yet then the user which is
basically the user one field from the
query on the notifications page and the
user one field is the person who is
requesting the friendship then you just
want to make sure that user actually
exists so you select the count from the
users table where username equals this
user you can see this variable name is
user here and it's created from the post
user one variable so you just check to
make sure that person exists you get the
exist count and then you have
you ate the exists count to see if it's
less than one that means they don't
exist and then you close your MySQL I
connection and you echo out users it's
not exist and exit the script completely
now if that doesn't happen then the user
actually exists which it will in most
cases so if the post action is accept
basically if the user clicks the accept
button where they're checking their
friend requests then you're going to run
this block of code and like I said if
they reject it this little block of code
runs so first let me explain that since
it's just a couple of lines we run a
MySQL I query and the first parameter
being our database connection reference
and then our SQL syntax which is delete
from the friends table where ID equals
this request ID and user 1 equals the
user and user 2 equals whoever's
checking their friend requests the
logged in user and accept it equals 0
because upon rejection that would never
be a 1 that would always be a 0 for
those fields or those rows in the
database the differential isn't accepted
yet this will still be a 0 so you can
check to see if all these things match
up just right this row will get deleted
and you close your database connection
echo back reject ok to JavaScript and
when that gets back to the Ajax request
that's where you guys saw it say you
successfully or whatever you rejected
this friendship request you can see the
Ajax spits it back right away and you
guys saw how fast those requests were
running it's super fast alright so if
the post action equals accept that means
you want to accept that friend request
or the user checking their friend
request would like to accept it so
you're going to make sure that they're
not already friends and you get the row
count one that represents the query that
checks to see if their friends are not
already and you have another row count
here which this could be a joint query
if you want but I didn't want to over
complicate and confuse anybody so I just
left it in two separate queries so
basically these two queries here will
help you evaluate to see if these two
people are friends already or not but I
just said if row count one or row count
two is greater than zero
that means there's already a friendship
of these people in the system we're
going to echo you already friends with
this user and exit the script
else if the friendship is not found
anywhere in the system then you can
update the friends table the accepted
field to one and that means true where
ID equals this request ID user 1 equals
the user requesting friendship and user
2 equals the logged in user and you
simply run that query you close your
database connection and you echo back to
Ajax accept ok and then you exit the
script so that is the update that you're
getting to friend system PHP now let's
discuss the updates you'll be getting to
user dot PHP in the HTML all I added was
a new horizontal rule and a paragraph
tag here that echoes the friends HTML
and that's the HTML list that we're
going to assemble and I also put the
amount that the user has as friend count
and their view all friends links let me
show you what I mean by that on the
profile page if you click your profile
and look at it you'll see if you have
more than I think I have 18 yeah this 18
maximum friends can be shown on my
profile even though I have 34 you can
change that to 5 4 6 however many you
want and they're randomized as well and
I just put a view all link so this is
the new code that you see here Adam has
34 friends and the view all link now we
don't have that view friends dot PHP
page made yet but I'll make a simple
version and I'll share it with you guys
but that can also be a magic box that
you pop up in the middle of the page or
something so you have a lot of creative
freedom now let me show you this list
you see how Johnny Meadows is my first
friend Muhammad the jihad Muhammad DG
Mindy is my second friend lamb strings
is my third friend let me refresh the
page you can see HT designs 90 is now my
first friend miles is now my second
friend so it's a randomized grabbing so
what I did was in the SQL syntax I just
made the query choose
order by random so instead of ordered by
ID ascending or descending I order by
random and this will allow you to have
different friends so if somebody has 500
friends you don't want to show the same
6 or 18 people in their profile all the
time to other people every time the page
is refreshed and made new you can have
that list be a whole new list of random
people from within their friend list ok
so that covers the new little HTML that
we're echoing out here now the friends
list I'll show you how that is created
and the friends count as well you know
how this variable is created because
we've been working that since with that
variable since the beginning to echo the
username who that profile belongs to so
you need to see friend count how that is
derived and the friends HTML now this
code that's collapsed here is the code
that you already are familiar with
that's already in your user dot PHP but
now here is the new code that you're
going to be adding to yours or really
you can just take my whole user dot PHP
updated file and run it on your system
alright so the first thing we do is
initialize the friends HTML variable
then we initialize a variable for the
friend's view all link because for
instance if I go to my profile and I
click one of my friends HT designs he
only has 7 friends so far he doesn't
have that 18 display maximum so I don't
have to give a view all link because
this is all of his friends sitting right
here in his profile only if they have
more friends than is allowed in the 18
maximum or yours can be set to a 6
maximum or whatever if they have more
friends if you set yours to a 6 maximum
he would have that link to view all
because he has 7 friends that's one more
than the maximum and that's why you see
that link doesn't show up there for him
but on mine it does so that's why we
initialize that variable as empty
because it's going to be echoed to the
page and if the person doesn't have that
many friends then that you can echo
empty nothing there instead of a link
now the first thing we'll do
is make a query that's going to get the
total friend count for whatever user
that is so you select the count and I'm
just counting the ID fields because I
don't want to have a heavy query so I'm
just selecting the account from the
friends table where user 1 equals this
this user and accepted equals 1 or user
2 equals this user and accept it equals
1 so you want to check if either user 1
or user 2 is this user in any of those
rows those friendship rows and then
that's how you get the full count of how
many friends they have and we pack that
into a little variable called friend
count then we say if the friend count is
less than 1 that means 0 then their
friends HTML list is going to say user
has no friends or Adam has no friends
yet else if there's at least one friend
then you can script out all the logic to
spit out that 18 maximum friend list and
you can change maximum right there you
want to yours to be 8 just put it right
there and that's all you have the change
you want yours to be 6 put it right
there told you got to change I'm going
to leave mine at 18 because I want at
least 18 friends to show on my profile
and you see this order by Rand that
allows you to get a randomized list now
what I'm doing here is I'm running two
separate queries and pushing them into
an array see how I create this all
friends array it's empty right here when
we're creating it now down in the query
in the while loop or all the results
come pouring out I'm pushing all of
these friends that are found within the
database into that array so basically
all you're doing is query to see who is
friends with this user and you're
pushing that person into their friend
array they're all friends array so you
see array push happens here and array
push happens here as well and you can
see I have a limit of max that way that
query doesn't get too heavy if they have
thousands of friends it's only going to
have a max of 18 in my case then I'm
going to get the friend array count
because if this is choosing 18 and this
is choosing 18 it could pass
maybe 36 people come pouring out in
these loops but I want to make sure it's
cut down to 18 and I wanted to have a
nice randomized list and this can also
be a joint query you can join this query
and this query together you can use
aliases but I didn't want to complexify
things for beginners but if you want you
can research making joint queries and
that will make your system a little more
efficient that's why I'm getting the
friend array count because if the friend
array count is greater than the max
which I have set to 18 then I'm going to
splice that array basically I'm going to
cut it down to the 18 maximum and if the
friend array count is greater than max
or actually that should say this view
friends all link view all friends link
should maybe be in its own separate if
condition and it won't it might make
more sense so let me take it out of
there and I'll say yeah and in this if
condition is where I'll make that link
populate it and I'm going to check the
friend count so I'm going to say control
and paste it there if the friend count
is greater than max so if their total
front count is greater than the 18 then
we're going to give them that link I
think that makes better logical sense
so this first if condition is if the
friend array count that's made from
pushing all of these people into these
randomized this little randomized array
if that array the resulting array is
greater than max then you're just going
to cut the array down to the maximum
then this one is if the friend count is
greater than max then you want to supply
a link to the view all friends button or
whatever now here is a little tricky
part this I wrote an article about how
you can make compound queries you can
see here this SQL syntax says select
user name and avatar from users where or
logic now or logic is that compound
query and I'll show you how that or
logic variable is created right now
basically this query is going to select
the username in the avatar from the
users table for all of the people in
that little randomized array that we
packed that we use the array push and
put people in and all we have to do to
make that logic is run a for each loop
over the friends array and in this for
each loop you're able to access each
user within that array and you can pack
it into SQL syntax so that's what I've
done or logic is just a variable that
compounds or appends more and more or
logic or or operators to that SQL syntax
and I know that might be hard to wrap
your head around if you're a beginner
but basically you have to select a whole
lot of friends or basically eighteen
friends and you want to get their user
name and avatar without having eighteen
different separate queries you can use
the array to assemble your SQL syntax
and just run one query that gets all of
their user names and avatars and they
all come pouring out within this while
loop
alright so this while loop is where all
the user names and avatars of that
person's friends are going to be
accessed by you so we loop over that
result set and we gather each friend's
user name in each friend avatar their
profile picture then you want to check
to see if the friend avatar is not equal
to empty that means if it has something
in the database field they have uploaded
a custom picture then you can use that
custom picture that's going to be living
within their folder in the system and
right now you don't even have any
picture upload forms if you're following
this lesson series to a tee but I'll
show you in later lessons how you can
allow your user to update their profile
picture and also create photo albums now
if they have not uploaded a custom
profile picture you're just going to use
your avatar default JPEG that's sitting
in your images folder basically you just
create a default avatar like you saw
that I had on my site or you can use
mine if you want for temporary you just
go into my images folder and grab it out
then finally I can use this while loop
to pack everybody and upend everybody
all of the friends into this friends
HTML variable so you see it's just a
simple link wrapped around a simple
image tag for that friend and you say
source equals the friend pic and then
you can have the friend user name as the
title and that way when the mouse goes
over it you see here the name pops up
and these wouldn't be all avatars
because people would put up their own
custom picture so you'd have nice
smiling faces of all your beautiful
friends there and it'll be a randomized
list okay so if you guys have any
burning questions about any of this
script or if you don't like it go ahead
and change it make it more efficient
whatever you want to do like I said this
could be a joint query up here instead
of two separate queries so I'm aware
that things can be made a lot more
efficient in this system but I'm not
doing all your work for you to give you
the ultimate social network that you can
then go out there and tell people that
you made no I want you to actually make
it awesome all right so that's all of
the updated code from user PHP okay now
we can discuss finally notifications dot
PHP which is the page you see here if I
click to check my notification say I got
a new friend request accept okay let me
click the link again and you can see
this is the page that you would see if
you have no friend requests and no
notifications so that's what we're going
to discuss right now and you can see in
the HTML there's the notes box
notifications box in the friend request
box and I have a div style clear left
here that way your footer doesn't come
up into your content that's the only
reason that's there so basically you
have a notification box and a friend
request box and I made sure to give them
bright pink outer borders you see those
bright pink borders to let you know
exactly where everything lives and how
it's set up in CSS here to be
horizontally on the page next to each
other they're both using float:left and
they have a certain specific pixel width
to them now this JavaScript that you're
going to see is
for the user requesting or rejecting so
you saw me earlier when I was accepting
or rejecting friend requests from people
this is the function that runs that
sends the Ajax request to your PHP file
that makes all the magic happen and you
remember that we just talked about the
updates to friend system PHP so what I
was just explaining to you in friend
system that PHP is the script that's
connected to this Ajax call and if
whether the users choosing to accept or
reject that friendship and it's just
like all the other Ajax calls we've been
doing from the beginning of this series
and nothing should really jump out as
mysterious to you here if you have been
paying attention that is let me collapse
that back up now we have two code blocks
first we include once the check login
status dot PHP script then if the user
is not logged in or if their log
username is empty then you can usher
them away from this page you only want
logged in users checking the
notifications then we're going to set up
the notification list the HTML that
renders down in the page and here we set
up the friends request list the list
that allows the user to accept or reject
friend requests so first we'll discuss
the notifications list let's open that
up first thing we do is select all from
the notifications table where username
like binary this user whoever the logged
in user is ordered by date time
descending you don't know what like
binary is it's just a way to more
precisely match a string to another
string I just threw it in there for
shizzle zan giggles so you guys had a
little more different code to play with
basically that could read select all
from notifications where username equals
log user name but some in some instances
you would want to use like binary to
make sure you get a more exact string
match then you actually run that query
where you selected all the notifications
for that user and you get a numbers from
that result set and you say if my sqli
num Rose is less than 1 that means
they don't have any you put in the
notifications list HTML you do not have
any notifications else you're going to
run a while loop over that result set to
get all of the little notifications out
pop them into HTML nice and tidy and
then it all appends all the HTML that
you're putting here appends into the
notification list variable and that gets
echoed down to the page here
notification list that's why you would
see a big list and the same for your
friend request list you would see a big
list because you're looping over the
result set and gathering them all and
within the while loop you're appending
to your dynamic variable if this was
being appended outside of this while
loop you would only get one so that
needs to be in the while loop to make
sure it appends and compounds all of
them together into that same variable
now the last thing you see here is a
MySQL I query to update the user set
note check so the note checks field or
the notes check field it's a daytime
field within the users table for each
user and you want to update that to now
because they are checking their
notifications page so they'll see all of
their most recent notifications so you
update that fields where username equals
this logged in user that's why we run
that update so we can always know when
the last time was that our users check
their notifications so let me collapse
that all back up here right there and
let's check out this friend's request
HTML assembly you can see that code
right there that's not too bad not too
much so the friend request variable gets
initialized here and down in the loop
once again we are appending HTML data to
that friend request variable and this
time we have to append more HTML because
we want to have a nice layout we wanted
to have divs where information lived
right next to that users picture so
that's what I set up with some divs that
flow and you put all of the data within
there
what's really important none of this is
really important except the button you
have to add the button in there to fire
off that JavaScript function that I just
explained to you guys down here that
JavaScript function has to be called to
either accept or reject so you have to
have buttons dynamically rendered in
each of the friend requests that will
allow the user to click accept or reject
now you can run this code on your system
play with it change it up experiment
with it design a different do whatever
you want and to get that list you select
all from the friends table where user to
the person being requested as friend
equals this logged in user and accept it
equals zero order by date made ascending
you can make that descending if you like
to go the other way
but I want mine to be ascending then you
run that query you get the numbers from
that result set you say if num rows is
less than one in the friends request
list output 'html you just type no
friend requests else you're going to
compound a whole lot of HTML data into
that friends requests variable that is
dynamic and is also appending to itself
within the loop that way you get way
more than one box you get all of the
boxes okay so that is everything and
that will get you guys up to the point
where I am now
so that takes care of notifications and
friend lists Oni on both sides your
friends list to accept and reject and
the friends list to show friends on the
profile and I even showed you guys some
array fun where you can randomize them
and use the array to compound query</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>