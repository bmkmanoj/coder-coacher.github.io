<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>json tutorial for beginners part 7 Ajax PHP MySQL Data Request Programming | Coder Coacher - Coaching Coders</title><meta content="json tutorial for beginners part 7 Ajax PHP MySQL Data Request Programming - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Adam-Khoury/">Adam Khoury</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>json tutorial for beginners part 7 Ajax PHP MySQL Data Request Programming</b></h2><h5 class="post__date">2012-10-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/-Bv8P5oQnFw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hello again fellow geeky people here we
are with the final JSON programming
tutorial which is number seven in this
lesson you will learn how to create
timed JSON data requests using Ajax
query your MySQL database for random
items return the mysql result set as
json data and finally create a cool
useful json driven web application and
here's the finished product of what
you'll be learning how to create what i
did was set it up for every 10 seconds
it requests or new random items out of
your database in order to repopulate
this little data box that you have here
on your own web page so every 10 seconds
when the user scanning your page you'll
see a little box is just magically
popping new data in and out of it
randomly from your database in real time
without refresh to keep everything nice
and in line we are going to begin this
lesson with the same exact files that we
left off with in Lesson number 6 if you
have not seen all the previous JSON
tutorials number 1 through 6 you'll
probably have a little bit of difficulty
fully understanding what we're about to
do in this video lesson so I'd like you
to right-click JSON tutorial number 6
HTML and open that in your favorite HTML
editor now I want you to go to file open
JSON gallery data PHP these are the two
files that we left off with in the last
lesson
now save JSON gallery data dot PHP save
as instead of JSON gallery data let's
call it JSON underscore MySQL data save
and then you can close JSON gallery data
dot PHP because you'll want to save that
one just for referencing later on and
JSON tutorial number six dot HTML you
want to save that one as JSON tutorial
seven save then you can close JSON
tutorial six HTML so what we'll do is
begin with JSON MySQL dot PHP the first
thing I'm going to do is remove
everything that we're not going to be
using so we're going to have a posted
variable coming in called limit from our
HTML file it's going to be posted to the
script so we can just call that limit
and the JSON data variable where it
begins we have to keep that in place for
the opening curly brace the dir variable
that can go away the dir handle that can
go away will keep the eye and this whole
while loop can go away but you want to
keep that line that says JSON data dot
equals where it's compounding different
little objects within the JSON data
variable keep that line but remove
everything else remove the while loop
and those two closing curly braces there
after the JSON data variable then you
can remove the closed dir you don't need
that anymore and we'll keep that little
chopped in place just to represent now
the first thing you want to do in the
script is right under the header we want
to put an if condition statement and
that if condition statement reads if is
set posted variable of limit that's
going to be posted from our application
to the script so if and only if it's
posted to the script do we want this
script to run the first thing we do is
clean we'll filter this posted limit
variable if you're going to use anything
in a MySQL query and if it's a posted
variable get variable any kind of
variable coming across headers you want
to make sure that you filter all that
information so this preg replace
function does that it uses a regular
expression to filter out everything you
don't want so you can see my regular
expression is set up to filter
everything but numbers if I wanted to
allow spaces I would put a space there I
wanted to allow letters I will put a
through Z I wanted all uppercase letters
to I would put a little I right here on
the end but since I don't want letters I
can remove that I I can remove these
letters here and remove the space
because the limit is just a number for
now don't even worry about this data
that's under your if condition because
everything that you're going to be
putting in this script is going to be
inside of this if condition statement
and we'll be grabbing this as we need it
to put it up within that if condition so
the very next line within that if
condition after you filter the limit
variable that's being posted to this
script you're going to put a require
once function which is going to be
referencing your
database connection file then we can
take this I which is our iterative
variable control X and we're going to
place it right under the require once
line then we're going to take this JSON
data variable we have here control X I'm
going to put that under the I so this is
where your JSON data variable begins in
this limit we can remove that since we
already have it being cleaned up top
here now these two last lines here at
the bottom control X we're going to put
them up in the if condition as well
those are the actual last two lines of
your script within the if condition
because you'll be closing that JSON data
object with its closing curly brace
there that's the last thing you do and
then you echo all the JSON data back to
JavaScript and right here between those
two things is where you want to query
your database and make a little while
loop that's going to pump out many items
that you want so what I'm going to do
now is put a very basic MySQL query in
place and it's resulting while loop you
can see that we have that in place right
now and let me explain those lines to
you just in case you don't know what's
going on here first thing we do is set
up a string this is just a string
variable that is our SQL syntax that's
really the SQL syntax that I'm going to
have in my query it's saying select all
from table name and you put your table
name there in place of where I have the
word table name and then we say order by
Rand which is Rand is a SQL function
that'll allow you to choose random
things out of the database random items
and we limit by the limit number and the
limit number is going to be posted from
our Ajax to this PHP script and that's
going to be an integer it could be one
two three four five six seven all the
way up to a thousand whatever you want
and I think I'm going to use the number
four when I create my script so this
will read select all from whatever table
that you want order by Rand limit for
but like I said this limit is going to
be a dynamic variable coming into the
script in the next line I actually
execute the query using the MySQL query
function and I sink in my
SQL string right here and then I just
say or Die MySQL error just in case any
syntax is wrong or any errors occur my
script will die and the MySQL error will
be printed on to the screen so my dumb
butt can see what I did wrong
then you simply use MySQL fetch array
which will give you a resulting array in
this row variable and you can while loop
over that array so you can compound this
JSON data variable with a lot of items
that come pouring out of your database
so like I said this is pretty standard
MySQL query and a very basic MySQL while
loop result set so what we'll do is take
this last line that we have here control
X and we'll put it up in place where it
needs to go right here at last line
inside the while loop so you're
compounding all of this data but we want
this to be structured a little bit
different this is structured for our
image gallery that we created in the
previous lesson so we just have to make
it say different things will say article
since this is going to be grabbing
articles in my case it can grab any
items you want from any database you
want so here I plus plus makes this I
that equals zero in the beginning of the
script I plus plus makes it increment by
one each time the loop passes so the
first pass of the loop this eye is going
to be a 1 the first pass of the loop the
first little object in the JSON data
variable is going to be article 1 second
item passes through the loop it'll be
article to article 3 and that is the
property for the object so on the right
side of our colon where we have to have
the value for that property we have a
nested object and then after that little
nested object we have to make sure that
we put a comma so I'm going to send
article and then in the nested object we
have three different properties and
their values so you have three different
key value pairs in there the first one
is going to be ID the second one is
going to be title of the article the
third one is going to be creation date
so for short I'll just make it CD
you can see my CD variable is right here
so let's just change file to the CD
variable which is the creation date
coming out of the database the title
let's make sure we replace that here and
then ID needs to go here so that'll be
the article ID the articles title and
then the articles creation date now
before your last two little lines here
the one that closes up the JSON
formatted data and your echo to echo
everything back to Ajax you want to put
one more line which you'll either want
to chop this last comma off of the last
item that comes through the loop because
you can't have a trailing comma on the
last object within your JSON formatted
data so you have to actually chop that
off so you can either do this like we
did in the last tutorial where we use
the chop function in PHP and all that
did is take just the very last comma off
of the end of the last little nested
object within the data format so you can
either do that or I'll show you
something new in this lesson we're going
to send some arbitrary data back so
along with all of those deeply nested
inter article items there we're going to
have some arbitrary data that also gets
sent within that data object but will be
separate from all of the other little
nested objects within there so in my
case I'll have four of these little
article one two three four and their ID
title and CV I'll have four sets of
those things and then I'll have one set
at the bottom because it's not inside of
the while loop I'll have one set at the
bottom with a property of barberry that
means arbitrary data you can name that
anything you want and I'll show you how
to scoop it up in your JavaScript when
this data is returned to Ajax so within
this little nested object all I did was
I put the item count which will be I so
after your while loop runs however many
items came out of that loop that's what
I will represent at the end of the
looping process so if there's ten items
come through the loop this will return
item count ten and then will also return
the get date and I'm just showing you
how to send random arbitrary crap data
that you might just want to send
along with the data requests that you
can scoop up separately from everything
that's within this loop okay so let's
take these lines we don't need them
anymore and I think that is everything
so that is what your completed PHP
script should look like
that's JSON MySQL dot PHP which the Ajax
within our HTML file is going to be
calling and we're going to use time to
request this time okay since we're done
in this side of things let's mosey on
over to JSON tutorial seven dot HTML and
we're going to change what we need to
change in here now and it's not going to
be very much at all we're going to go
quick now the first thing is we're not
going to have all this crap in here like
we had for the photo gallery because the
photo gallery needed a little more CSS
that we're going to need we're just
going to need this one rule that is div
ID data box and then we just set up the
data box any way we want now scroll down
to your HTML and where you have all of
these things just get rid of everything
until you got one div there and we'll
save that script line this div change
the data box and right before that D of
data box we're going to put this h2
heading and now we're going to change H
Ajax JSON gallery to Ajax JSON data
function and we're not going to send any
arguments through you guys already
learned how to send dynamic arguments
through your functions so Ajax JSON data
is the name of the function that should
be here in the JavaScript so change that
to Ajax JSON data and remove the folder
argument now you can remove the picture
frame reference and let's change this to
the data box reference to grab the ID of
that data box and we're going to put it
right here
var our data box get element by ID data
box then just like before we establish
our xml httprequest object as a variable
called HR then we run the open method on
that object the first parameter is post
second parameter is the script that we
want to use the PHP script that's going
to be feeding back our data and that one
is JSON MySQL data
so we change gallery to MySQL and that
is all you have to change there you go
down you can leave all of that alone and
actually we can scoop up the arbitrary
data by I think we can use arbitrary
right here let's see if that works let's
see what we need to grab inside of
arbitrary here's arbitrary it's coming
back from the PHP and inside of that
object is another nested object with
with two pieces of data in it item count
and return time so let's just get the
return time ctrl C go back into your
HTML file so you want data arbitrary dot
return time and we're going to try to
put that in a different HTML element
let's see I'll put a new element down
here in the HTML so we'll have data box
right under data box we're going to have
arbitrary arbitrary box so since we're
adding that let's go ahead and make a
reference for that right here under data
box make sure it has the proper ID right
there and right there
so when the data comes back through the
Ajax request instead of targeting the
picture frame with the data we're going
to target the arbitrary box and its
inner HTML property what we're going to
do is just pop in the value we don't
need all that stuff we're just going to
pop in the value of the return time and
that gets generated you can see here in
PHP using the PHP get date function and
remember D stands for data and that's
the data object the JSON data object
that comes back and all of this was
fully discussed in the previous lessons
I'm not going to go over things over and
over again for people who are not paying
attention to the whole series so you get
lost at your own fault now instead of
thumbnail box inner HTML we want data
box right here to always empty each time
a new request is being made and remember
I said we're going to have time to
requests so each time more data is being
requested in we're going to empty the
box out now this for loop is going to
stay just like it is it's going to have
variable object in data and then each
time you want to grab something all you
have to do is put the data object there
the object variable goes inside of the
square brackets right next to it and
then you can dig inside for title
remember in our PHP script we have in
the objects coming back each article has
ID title and CD which is creation date
so this little if condition just make
sure that it's going to be one of those
objects in the PHP and the arbitrary
data won't be accessed within this loop
because of this if condition saying that
it has to have a title property in order
for the loop to add it to the inner HTML
of data box so right here make sure this
says data box and what we'll do is just
throw in a paragraph yeah so instead of
doing all of that we're going to throw
in two paragraphs one on top of the
other so one for the title and one for
the creation date and I'll show you guys
how to format this a little bit smarter
after we run our initial test in the in
the browser live in the web server now
down here where you're sending the
dynamic folder variable in the last
lesson you can remove that dynamic
variable there and we're going to put
the name of this key value pair being
sent is limit that's the variable that
we want and the value is going to be
four and you can put any number that you
want if you want ten random items then
you put ten there I just want for each
time the request happens I want four
items now right after your HR send
method you want to make sure this says
data box because there is no more
thumbnail box remember ok now the very
last line is right under the data box
inner HTML requesting dot that we put
each time the request happens we're
going to put a new timer variable here
and actually let's initialize this
outside above let's put var my timer and
then semicolon
so that'll initialize that variable
there and then we're using it here so
the my timer variable is equal to the
set timeout method the set timeout
method allows you to execute code after
a certain amount of time and that time
in this case is 10 seconds if you wanted
that one second you would make that 1000
since I want 10 seconds it's 10,000
those are milliseconds so each 10
seconds I'm going to fire off Ajax
JSON data function which is the name of
our function here so basically this
function is now set to loop on itself
every 10 seconds and it'll execute
immediately the first time so after the
first time it executes immediately then
it will wait 10 seconds and then 10
seconds after that 10 seconds after that
and that's how the requests will just
roll on and it will keep getting random
data upon each request so when we run
this script with our other script our
PHP script we're going to have some data
come in and now just temporarily we're
going to be throwing in two paragraphs
one paragraph is going to hold each
title the next paragraph will hold each
creation date so we should have
basically eight paragraphs because I
wanted four items now down here a
function picture frame you don't need
that at all just get rid of that
completely and I think that's it let's
give this a test run okay now you want
to go to your live web server online
make sure you FTP both the PHP script
and your HTML file you go to your live
web server online and I'm going to be
tapping into the articles at world of
web crafts so you can see my articles
came flying in for each time and then
every 10 seconds it says requesting very
quickly then it brings in four new
random articles so you can see the
article titles there and the article
dates right on the room and right here
on our script we have title and creation
date within paragraph tag so you can see
how that's structured exactly and we
have an array coming back as our return
time so just for testing let's make that
say what do we have here item count
because this is giving us an array back
so I'm going to show you how to break
that down just to get the timestamp so
here instead of return time
let's put item count and we should get
four back so r EF TP JSON tutorial seven
HTML and see the results you get by
checking out item count so if i refresh
the page
see it says four so I'm successfully
getting my arbitrary data back from
within this little nested arbitrary data
object and you can see we're also able
to loop over the many objects that are
deeply nested within that JSON data
coming back so you can target it
directly like this or you can loop
through things now what I'm going to do
is make each one put out its own
paragraph so we can remove this P tag
and this closing P tag so you have
really everything is wrapped in that one
P tag you see we're going to put the
title there and in between this and this
we're going to put a link so we'll just
put a close the a then go over here to
the other side and put the closing part
of the a tag on the opening part of the
a tag we're going to put href that's
going to be equal to that articles URL
blog dot PHP put your question mark your
ID URL variable is equal to and this is
where you're going to go ahead and copy
this title data right there in between
these single quotes and pop it in right
here after your equal sign so you're
going to have ID equals and here you're
going to put in dot ID because remember
in the PHP we're getting each articles
ID and it's being passed through as well
so we can access that to make our little
link so it'll be blog dot PHP and the
URL variable will be ID is equal to
whatever dynamic ID is being passed
through the loop for that article so the
title will now be a clickable blue link
now after the a tag let's just put a
break tag to put a line break and then
you'll have your date under that and
each one of these items will be
paragraph separated which you can also
put them in divs if you want press ctrl
s and re FTP JSON tutorial seven HTML up
to your server and remember you have to
be on a live PHP enabled server to see
any of this data that PHP is going to
render back so now let's refresh the
page
and you see I now have blue links here
and the only reason some of those are
purple is because I have seen those
pages within this browser already so
that's why Google Chrome is making those
purple you can see if I have not visited
that article yet and read it the link is
blue by default so now I'm going to try
and click on one of these and see if it
takes me to the article which it does so
what you're doing is every 10 seconds
you're pulling for random items out from
your database and you're making sure
that it's JSON encoded data that's being
sent back to your application ok so
let's go back into JSON MySQL data dot
PHP script and right here before we send
our arbitrary data through the JSON data
variable we're going to get a proper
timestamp from PHP so you can use a now
variable that holds the get date so you
see here how I'm using get date that's
sending back an array now to get the
timestamp out of that array we can use
the first index within that array so you
say now get date and then the next line
is timestamp is equal to now and the
first index within that array so then
you can take timestamp and just send
that variable ctrl C instead of get date
function and it's not even a very
crucial variable that you would want to
send back but since I was trying to send
to get time function back it gave us an
array I'm just going to show you how to
break that array down to get the
timestamp out of it there's other
information that's in that array so just
press ctrl s save this FTP backup to
your server ok now let's go to our live
application online and refresh the page
arbitrary data we want return time
that's in your HTML file now FTP that up
now go to your live web server and
refresh your page and then you can see
the timestamp it's going to keep
increasing each time the requests
happens every 10 seconds
all right so that shows you how to get a
very dynamic kind of box thing and
remember in the HTML where you have
requesting dot that's where you can put
in the image tag or a dot gif animated
fan loader or just like some animated
graphic that you want to have that tells
the user that new data is being loaded
into this box and you can even Center it
in the box to where they'll be a fan
loader here every 10 seconds when that
data is being requested instead of mine
just saying requesting dot you see what
I'm saying so now when visitors come to
your site every 10 seconds they're going
to see four random information or items
whatever the kind of things you want to
pull out of your database they'll see
four or however many items you want to
put in that box you can put ten items in
that box if you want but they'll see all
new items come pouring in and this is
JSON driven data format</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>