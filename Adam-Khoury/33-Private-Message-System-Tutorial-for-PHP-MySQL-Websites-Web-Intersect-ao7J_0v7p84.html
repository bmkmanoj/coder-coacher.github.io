<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>3/3 Private Message System Tutorial for PHP MySQL Websites Web Intersect | Coder Coacher - Coaching Coders</title><meta content="3/3 Private Message System Tutorial for PHP MySQL Websites Web Intersect - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Adam-Khoury/">Adam Khoury</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>3/3 Private Message System Tutorial for PHP MySQL Websites Web Intersect</b></h2><h5 class="post__date">2010-10-07</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/ao7J_0v7p84" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">let's rock and roll okay the point where
we're at right now is click private
message on another members profile and
if you forget something there's error
messages that pop up but once you submit
let's just put test testing press submit
little loader pops up and then message
sent successfully so that's where we are
right now
now since alex is receiving some
messages we got to build a page to where
he can read his messages view them and
reply to them so on the inbox page that
we're going to build right now we're
going to embed the reply form on to that
page that way he can reply to any one of
the messages that are in his inbox and
the inbox will also allow deletion of
all the messages that he wants to delete
so since I need a page to serve as the
inbox I'm going to open the index file
for the site I'm going to use this pages
layout let's save this go to file save
as let's make a new page within our
system called PM underscore inbox PM
inbox save now all we have to do I'm
going to go inside and strip out all of
the PHP on top but you can have active
links in your message if you want by
using this class on the on the actual
message variable but I don't think I'm
going to do that so I'm going to comment
that out now in the design you can use
any page you want really but I'm just
going to start zapping stuff out of here
this thing I don't want that I think I
do want that one gray box I'll keep that
this div I don't want that this one I
don't want that div bye-bye this div I
don't want that either that's the one
that was holding the blabs so now you
can see all I have is that one thing
thing and I think I'm going to leave all
those ads like that on the side there
you can choose to put whatever you want
on this page really but you want to have
a decent wide enough
to hold all of the inbox messages along
with the checkbox on the side and all
that stuff so you can show person's name
who sent the message here the subject of
the message here and the date that it
was sent here so now I think our page is
set up well enough to be the Inbox okay
we've got our inbox all built from the
index that PHP page we took and turned
it into the PM underscore inbox page and
you can see this Inbox
I'm going to demonstrate it to you right
now and it's very complete and I kind of
modeled it off of YouTube's commenting
in inbox style I'll try to explain to
you what the code is doing as I'm
clicking things so first of all we're
digging through all of this person's
private messages which happens to be me
and I have three so far so that's all
that's showing and all that's really
missing in this script and all that's
left to put in is pagination and since I
did pagination tutorial already I'm
going to refine the pagination a little
bit that I created already I'm going to
add it to this that way we're only
showing maybe ten per page but I'm not
going to do that on video I'm going to
do that on my own since I already did
pagination tutorial most of you guys
should understand how to set up your
page a nation and if you don't have any
clue how I set it up for this go into
the source code and really dig through
it if you have any questions that are
pressing you can go into the forums of
develop PHP and ask a question or wait
till the forums or of the web intersect
when we build them okay so first of all
for allowing people to delete their
messages they can click these checkboxes
so if they wanted to delete just those
top two messages they would press Delete
right now and those would go away they
can delete them all at once by clicking
this little from checkbox here and we're
using javascript to accomplish that to
auto check all of the checkbox on the
page using this one central checkbox
we're using javascript to do that and
I'll show you exactly where that's
happening in the code and what's next we
also have now the subject line is where
when they click the subject
the message is going to slide down and
expose the body data for that message so
let me show you what I mean and take
note that when I click the subject line
it's going to go from bolded black to an
unbold
gray just like YouTube does it where
before you click the message and read it
it's really bold in the subject line and
after you have read it and you close it
up you'll see that it's not bolded
anymore
we did the same thing here we're using
JavaScript for that actually we're using
jQuery to change the class rule that's
on this subject line so watch me click
it here you see that the subject is gray
now and it's not bold anymore it's not
bold black and then here is the body of
the message keep up the great work very
nice now say I want to reply to miles I
just click this and a nice jQuery window
opens up again I can close it right here
say I want to reply to them say thanks
will do send reply to miles you see the
little loader there for a second
message sent successfully and you can be
sure that it went sunken to your
database just fine and we also made it
to where when you click your other
messages any that happen to be open will
close automatically you see that and
that's how it works it's pretty nifty
like I said if I want to remove these
from my box I can just delete them like
that I'll select them all I don't want
them all maybe I want to keep that one
delete those two those two are gone from
my inbox okay now I'm going to walk you
through the code of that p.m. underscore
inbox dot PHP page so the first thing we
do is include once the scripts check
your user log then we check here to see
you see this is a PHP block let me get
this down a little bit this PHP block
right here is independent and what
that's doing is checking to see if the
session ID X variable is not set the
echo this out and we exit script if it
is set we continue on to this code right
here we decode the session ID X variable
and extract the user's ID from it
that's what these four lines are doing
actually these three lines then we
establish the interaction token here and
what this will do is help with spam a
little bit so we're adding that as well
for each interaction then this next PHP
block here that's independent is mailbox
parsing for deleting inbox messages so
all we're saying is if is set post
delete button from the forum and I'll
show you the form in just a second so
basically all the messages that are
showing on the page are wrapped in one
form so that way you can have all of the
checkboxes all compiled into one form
when people want to delete things this
variable is not necessary all right so
this is a little bit tricky what's
happening is here we're saying for each
posted variable that means if somebody
clicks six of those checkboxes and they
want to delete six of those items out of
their inbox all six of those are going
to be posted to through that form to
this script so we're picking each of
them up so for each post as key value
the name of it and the value it contains
so then we URL in code and strips lashes
on the value right here we're checking
to see if the key is not the delete
button so if the key is not the leaf
button we can then update the private
messages to not show in this person's
list anymore it doesn't actually get
deleted here but it doesn't show in that
person's list anymore right under here
if you wanted to add a little check to
see if the person who sent the message
also deleted it from their sent box then
you can wipe it out of the system but
since I'm only archiving 100 messages
maximum for each user I'm not even going
to worry about deleting it at this point
but maybe right here I'll leave put a
little code comment check to see if
sender also
removed from sent box then it is safe to
remove completely from system make sense
good all right after that after they
delete all the ones they want to delete
that are in their box we just run the
header location PM box PM inbox dot php'
which will actually just refresh this
page and if they were to hit refresh it
won't process that form again so that's
why we're using header there which is
basically refreshing the page for them
showing them the page new again with
didn't put the items that they chose to
delete remove from their inbox okay now
we have the duck type all the regular
stuff for your webpage in the head of
the document we have JavaScript and I
have it all bundled up here but it's a
pretty good bit of JavaScript going on
right there
let me have some styling going on using
CSS and it's not much of that you can
see there's only one two three four five
lines so first before I discuss the
JavaScript with you that really controls
the forms and everything and the CSS
let's take a look at the HTML output
that we're using PHP and MySQL together
from the database in the loop
this press design view you can see the
way I set things up you can actually see
and design in design view because the
query is here if I click this PHP block
here you'll see I have a query here that
select all from private messages where
to ID equals my ID and recipient delete
equals zero that means they haven't
deleted it from their box if recipient
elite equals zero
they haven't deleted it from their inbox
yet so we're going to display it so
there's the query now there's a while
loop you see this while loop here this
while loop runs and this table is being
output within the while loop so for
however many messages we want to put per
page that's how many going to come out
in the loop and right here we close the
Loup and you might have never seen PHP
structures like this before but I'll
show you what it's like where we close
the while loop it's just it's it's in an
independent PHP block in between the
opening and closing curly braces for the
while loop you can see I'm closing off
the PHP block and I'm I'm not echoing
out I'm actually rendering raw HTML
right in-between that while loop I hope
that makes some sense because I really
can't explain it any clearer than that
within the while loop instead of echoing
out straight PHP I'm closing off the PHP
block and I'm just rendering raw HTML
which you can see right here this little
table will get rendered out forever many
messages they have like I said we'll put
pagination into the system soon enough
alrighty now form that is the reply box
is sitting down here or outside of that
while loop and below it that way it
doesn't render so many times it just
renders once so right here I put a nice
comment for you start hidden container
that holds the reply form and hidden
container that holds the reply form you
can see in this div there's your reply
form and guess what it's just like the
the private message form that we
initially created that's on the actual
profiles it does the exact same thing
and it sends to the exact same script
and the JavaScript and Ajax that our
hats happening with this form is exactly
the same way that we set it up on the
profile dot PHP page the only difference
in this one is we have p.m. final div
here instead of interaction results div
like we have in the profile page we have
a PM final which is the thing that you
saw when I demoed a little just a few
minutes ago where it shows the little
message sent successfully in a little
black box after they click Submit that's
what this is for
okay and you can see here put a code
comment in start the PM form and display
list so this is that form I was talking
about that has the delete button the
universal delete button in it and all
the little checkboxes get placed in in
the while loop and then we end the PM
form and display list here you guys have
any questions about these scripts or
what they do don't feel ashamed to go
into a form like develop PHP form or web
intersect form whenever I build it in
and ask questions if you feel lost with
this code a little bit now I'm going to
explain the JavaScript and a little bit
of the CSS and then we're done here and
the only thing I'm going to do after
this is make another page that's called
PM sent box and then that one's going to
only show they're sent messages and
they're not going to have the all the
cool stuff going on on that page like
making the subject line not bold anymore
all we'll give them is basically the
ability to delete things that are in
there sent box they won't be able to
reply to anything in there because those
are messages they sent they can't reply
to themselves that doesn't make any
sense so there's no need to put the
reply form no need to put the reply
button at the bottom of every message
there's no need to make the subject line
on bold anymore after they read the
message because they already read the
message because they wrote the message
so a lot of that stuff is not going to
be necessary but it's basically going to
be a carbon copy of this file and I'm
not going to be discussing it on video
it'll be a carbon copy of this file with
a lot less functionality a lot more
simple basically okay I'm going to fly
through this JavaScript here because I
feel like I'm losing a lot of you guys
and maybe your attention span is growing
dim me just talking about all this code
and this uber geeky crap but I feel like
some of you guys might really want an
in-depth discussion about how this stuff
works
so I'm going to explain this JavaScript
to you right now but I'm not going to go
super in-depth right here this function
this
controls toggling all checks all the
checkboxes so when you hit that when you
hit that main universal check box on top
it's going to check all of the boxes for
you that's what this function covers you
have any questions about it hit the
forums now here we say document ready
function that just means that when the
document object model is fully loaded
remember when I click a subject line it
opens up the body so I can read it
that's what this does
it opens up the next element on the page
because each subject line is followed by
a hidden div so you don't really have to
target what the divs name is you can
just say next and it will open up the
next element on the page slide it down
so that's what that's for and this one
is almost self-explanatory this is where
we mark messages as read so in the
database we update the field and I'll
show you the script so here we're
posting to a script that's in the
scripts for profile folder and it's
called markers read that PHP let me show
you that real quick and then you can see
there's a couple of variables getting
sent to that script message ID for this
unique messages ID and then owner ID
whoever owns the message the person that
received it and here's mark as read what
happens here is we require once the
connect to MySQL because we're going to
be working and updating the database
within this script we grab those two
variables that are being posted from
that JavaScript from that jQuery AJAX
mechanism message ID and owner ID we're
stripping everything but numbers from it
then we decode the session ID x variable
again on the script to make sure that
the owner ID matches the decrypted
session ID right here is that condition
if owner ID does not equal my ID then we
exit because there's either malicious
activity going on or the user's session
has expired from inactivity on the site
and by the way I don't know if you guys
know this or not but you can up yours
session limit max time in your PHP dot
ini' file if you feel like people are
getting session doubt early or they are
complaining about losing the session or
the sessions expiring quickly while
they're navigating your pages you can up
your session max time limit in your PHP
dot ini' file so that if the owner ID
does not equal my ID we exit but if it
does and everything is cool we're going
to update private messages set opened to
one where ID equals message ID this
message ID limit one that way this query
knows it's only going to run one update
on one row open gets equal to one that
way we know and our system is aware that
this person has read that message they
click the subject line message opened up
they saw it that's how mark as read
works and mark is read like I said is
living in these scripts for profile
folder
mark is read dot PHP that's how we refer
to it now when that gets finished
happening but automatically right here
this line makes the subject line not
bold anymore it makes it gives it the
message read class and I'll show you the
two classes here for that is message
read and message default you see it's
bold by default message read makes it a
light font weight so it's not bold and
it really gives it a nice light gray so
that's what that line does right there
it just changes the class without the
page having to refresh in everything
you're using jQuery actually jquery's
add class function there and we're
targeting the message ID using subject
on the score line underscore + message
ID you can see each one in the loop
right here mark as read function right
here you see ID equals and each one will
be unique subject on the score line
underscore whatever number this row ID
is so each one will have a unique ID
that we can target using jQuery here
so that's what this line does and that's
everything for the Marcus read function
now toggle reply box what's happening
here is we're having to open up the
reply box using jQuery we show it and
we're throwing values into hidden input
fields within that form then once they
press submit we process the reply right
here and in this function what's
happening is the same thing that's
happening in the profile that PHP page
where we're initially sending the
private message so I'm not going to
explain this at all because it's the
same exact thing I spread explain that
pretty in-depth so I'm not going to go
over it again and that seals up the
JavaScript that's all you need so
basically all this script needs for
refinement is a little bit of pagination
and it's beautiful you can see that it
has all the functionality that somebody
would need for a nice inbox system but
that wraps up the private messaging
system I'm done that page was very
difficult to code so now I'm going to
package everything up change the numbers
on the version and all the source files
I am going to test everything out on a
new fresh install on a brand new hosting
account that I bought for testing so
once I see that the system is running
well like I was somebody who downloaded
it and never used it before I can
install it everything works
all my member functions work all
throughout the site I'm going to release
version 1.3 3 which will have a whole
bunch of things that we've added
throughout the last five or six seven or
eight tutorials into the web editor sect
system the private messaging system the
Maps the Twitter thing all of that code
that you guys have been watching me
build into the system will be in place
in version 1.3 3 and it should be there
today sometime hopefully at on the
download page sometime later today
you'll see web intersect version 1.3 3
and we've also fixed the session
juster deprecation issue all right that
should keep you guys busy for a while
and i'll talk to you next lesson</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>