<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>9. Forgot Account Password Form Email Script Ajax PHP MySQL Tutorial | Coder Coacher - Coaching Coders</title><meta content="9. Forgot Account Password Form Email Script Ajax PHP MySQL Tutorial - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Adam-Khoury/">Adam Khoury</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>9. Forgot Account Password Form Email Script Ajax PHP MySQL Tutorial</b></h2><h5 class="post__date">2013-01-28</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/RIxLObrYn1s" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hey what's up dog easy little buddy Adam
here with another installment of the web
intersect 2.0 social network production
training series in this lesson we're
going to cover the Forgotten password
mechanism which is a mechanism that you
can give your users in case they forget
their login password
okay now what you want to do is go into
phpMyAdmin and make sure you click your
user options table go to the structure
view of that table
now after answer you want to add one
field so go down and add one at the end
of table after answer field go and we're
going to name this temp underscore pass
oops
underscore past we're going to make sure
this is varchar' 255 save okay so now
you see you have an extra field in the
user options table called temp Pass now
what's going to happen is we're going to
store their temporary password in that
field and when they click the email link
then we're going to take that password
and put it in their password here in the
users table that way they can
successfully log in with that temporary
password because their old password will
just get swapped out for the new
temporary one
all right before I discussed the code
logic let me demonstrate how the whole
thing will work and so let's say I'm
trying to log in but I forget in my
password from my account and I click the
forgot your password link which I don't
have that as a live link yet to that
forgot password page but while in
production I can just navigate straight
to that and while you're testing you can
navigate straight to any of these files
that you want if you don't happen to
have links live to them yet okay so on
this page it says generate a temporary
login password step 1 enter your email
address so I'm going to enter my email
address from my account here at web
intersect and then I'll click generate
temporary login password ok so after the
Ajax runs and everything is successful
in my email is bound to be an account in
the system it says step 2
check your email inbox in a few minutes
you can close this window or tab if you
like so I'll just close this window now
I'm in my email application and I just
got this email from web intersect it
says hello Adams is an automated message
from web intersect if you did not
recently initiate the forgot password
process please disregard this email you
indicated that you forgot your login
password we can generate a temporary
password for you to log in with then
once logged in you can change your
password to anything you like now
changing their password back to anything
they like that will come in a later
tutorial or you're going to program that
on your own way down the line when
you're creating your user account
options page or whatever you could just
stick in the ability for them to change
their password to a different password
at any time and that's a feature that
you would want to give your site users
anyway even if they don't forget their
password you want to allow them to
change the password to anything they
want at any time as many times as they
want all right so it says after you
click the link below your password to
login will be whatever see what I made
it do is cut the first four characters
off for their email address and then add
five digits onto the end of that just
five randomly generated digits and I'll
be explaining the code that generates
that in just a second so let me click
here now ok and Here I am at the web
intersect login page that means my
script worked okay so I'm going to take
the password Adam
four to seven one three which was the
temporary password that I got in that
email and I'll put my email address in
here and see if I can log in with this
new credentials okay it works and it
navigated me straight to my profile page
and it is the viewer page owner logged
in and verified yes so everything worked
out fine so in the database what
happened is the system took the
temporary password of the user options
table and put it into the actual
password field in the main users table
for that user when they click that email
to verify that it's them and they want
to go ahead and make that temporary
password their actual password so when
they click the email link that's when
the temp pass goes into their real
password field and then you just clear
out the temporary pass field from the
user options table just make it empty
after the switch occurs okay let me tell
you what I did to get to this point all
I did was took login dot PHP and I named
it forgot past PHP and I gave it a
different title and I changed the
JavaScript a little bit CSS a little bit
and the PHP a little bit and we had to
change the HTML form a little bit
because all we need in this form is an
email field and if this looks funny the
on focus event code you can see as
JavaScript I place directly in the on
focus event to clear the status element
whenever this text field is focused in
with the mouse cursor but this form is
just like the other forms that we've
been working with we have the button for
COD pass button and on click of that
button forgot passing in JavaScript up
here runs and I'll explain that to you
in just a second and so like the other
forms this form does not post like a
traditional form it posts using Ajax
okay so the user puts in their email and
then they hit the button here and this
forgot passed function fires off in
JavaScript let me show you the CSS first
CSS is very simple it's just to style
the form basic stuff you could do way
better than that okay so let's talk
about this javascript forgot past
function and if you've been paying
attention so far
this javascript function is very similar
to the ones that we've been working with
so far that deal with sending Ajax to
PHP and getting response back same stuff
so when forgot pass once in runs we're
going to scoop up the email from the
email field let me have it in a local
variable called e so then we want to
evaluate to see if e is empty if it's an
empty value then you want to put in the
status field please type in your email
address else if it's not empty that
means your email is in the field and we
can process things to see if they have
an actual account with us
so you target the form submit button and
you make the style display:none or you
make the submit button disabled or you
can use visibility:hidden whatever
procedure you want to use to remove the
button functionality until Ajax return
comes back so I'm just making the button
altogether disappear until the Ajax
process is finished I don't want the
user clicking it again while Ajax is
processing and then I target the status
element and the innerhtml property and
we put in the words please wait dot and
like I said it before a hundred times
this is where you can add your animated
image loaders you just put an image tag
right in there for your animated gifs or
whatever so you don't just have to have
the words please wait or processing or
anything like that you can have a nice
animated little loader thing just put
the image tag right there and then we
have the variable for the Ajax object
and then we have the Ajax
onreadystatechange function here and
everything inside of that is waiting for
the response really from PHP so down
here is where the Ajax send actually
makes that request happen to PHP but
this Ajax onreadystatechange function is
your kind of viewer return data listener
so if the HX return is true then we make
a local variable called response out of
the Ajax out response text and I only
did that because I was writing it in a
few lines down here and I didn't want to
keep writing
Ajax that response text so I just made
it into a smaller word called response
so I say if response is equal to success
then we're going to take the forgot pass
form it's a whole innerhtml and replace
it with this message step to check your
email inbox in a few minutes you can
close this window or tab if you like
okay so that's if the message from PHP
coming back is success LC if the message
from PHP is no exist then in the status
we're going to type in sorry that email
address is not in our system else if the
response from PHP is email send failed
then we write this message mail function
fail to execute else just some unknown
error occurred that our script did not
account for and we're getting some kind
of weird data back from PHP that we
shouldn't be then this will show okay
and that's all there is to that Java
Script buddies now the last thing we
have is the PHP first you're going to
include once PHP includes folder check
login status that PHP so you want to
include that check login status file and
then we're going to check to see if the
user ok equals true from that file then
we're going to header them to their user
profile page using their session
variables because if user 0 K equals
true that means their session is set and
they're logged in ok so you have two
code blocks here this one is just to
usher people away from the page if they
happen to be logged in these are the two
main gold blocks we're going to be
discussing now this first code block
Ajax calls this code to execute so
that's basically the code that executes
when you click the submit button in that
form that button that says generate new
password after they put their email in
they click the button this code runs
here and Ajax calls this to execute now
this code here is called to execute when
the user clicks that link inside of the
email that they get when they run the
generate password functionality so let's
talk about the first one which is when
the user first uses the form and our
system is going to create a random
temporary password for them and then
it's going to email them that's what
this script does
so the first thing is we take the email
the posted email address that they're
typing in and we filter it or sanitize
it through the MySQL I real escape
string function then we run this query
right here with this SQL syntax that
reads select ID username from the users
table where their email address equals
this users email address that they're
typing in right now and activate it
equals one so basically that's a way to
check and see if they actually exist if
that email address is actually an
account within the system and you can
also get their ID and username at the
same time pulled out so we run MySQL num
rows right here on that query that
produces a variable called num rows that
we can then evaluate we say if num rows
is greater than zero that means they do
exist because num rows is one that means
they were found we're going to run this
while loop to pull out their ID and
username information out of their
database row so once we have access to
the ID and the username we can then set
out to create their temporary password
so we take their email address and we
cut the first four characters off that's
what this line does cuts the first four
characters off the front of their email
address then we create a five digit
random number by putting one or ten
thousand here and 99999 that gives you a
five digit random number in between
those two numbers and then all I do is I
take the email cut the first four
characters and then stick that random
number on the end then I hash it using
md5 and it becomes hash temp pass then
I'm going to run a query to update the
user options table for this user and
we're going to place this hash temp
password in the temp pass field that we
just created a minute ago where username
equals this user and that syntax and
query runs right here then we simply
want to set up an email to email the
person so the to address is their email
address from is your autoresponder
at your website and then you establish
the headers here and you can see we're
using an HTML formatted email again so
that way we can put tags and design it
the way we want the subject of the email
is web intersect temporary password now
you saw in the beginning of the video
what the email look like that I was
looking at you saw how my password was
in it and everything that's what all of
this information here you see in the
messages says hello you whatever the
user name is this is an automated
message from web intersect if you did
not recently initiate the forgot
password process please disregard this
email you indicated the joopa guide your
path are valid and then here's the link
put your website there and then your
forgot past PHP script and you want the
variables URL encoded variables the
username and the password to be appended
on to the end of that URL and then to
execute the mail function you can just
you can actually put it in an if
condition and it will return true or
false it will return true if it actually
mails successfully and it will return
false if it has trouble mailing for some
reason so you can say if mail you run
your mail function and if it returns
true it'll echo success to Ajax and then
exit the script else that means mail is
false it failed then you can echo back
to Ajax email send failed and exit the
script else this else condition is for
this if condition number owes here so if
num rows is equal to zero that means
they're not found then you're going to
echo no exists and then the script exits
right here and that is the whole parsing
mechanism for sending them the email and
putting their temporary password that
you generate within their user options
table temp pass field now when they
click that link in the email that they
get sent and we collapse this so when
they click that link in the email that
they get sent this code is going to be
called to run only in that instance all
right so let's open it up and explain it
real quick so this code only runs if
they get you and the get P variables are
present in the request so that means
they have to be
in the URL string as get type variables
then we take that username and we run it
through preg replaced just to sanitize
it and we also get the P variable into a
local variable called temp pass hash
then we're going to check the string
length of the temporary password hash
just to make sure it's greater than 5 or
you can make this greater than any
number you want you can put 10 there if
you want because it's going to be a hash
anyway so you'll know it'll be more than
10 character so just put a 10 there you
just want to make sure that this isn't
empty because if people post to this
script with a username of some user in
your system and a temporary password
that's empty that would match most users
in your system so if it is empty or if
it's even less than 10 characters even
we're just going to exit the script
completely we're not going to give any
indication of what's going on either
that should never occur then what you do
is you select ID from the user options
table where the username is equal to
this user and the temp Pass is equal to
the temp pass coming in through the URL
variables then we run that query here to
select the ID and so everything has to
match up just right in order for this
num rows to give us a 1 and that's what
we want we want to make sure the user
matches up with all this information
from the user options table so we run
MySQL num rows on that query and that
gives us how many rows we're selected
and we want to make sure that there was
just one match so if num rows equals 0
that means no matches then we headed
them to the location message dot PHP
there is no match for that username with
that temporary password in the system we
cannot proceed and you exit script all
right so if num rows is equal to 1 and
there is a match this else condition
fires off and all of the code in it will
execute and we have MySQL fetch row and
I did that just so I can grab the ID
value of this users ID using the row
variable and the 0 index of the row
variable array so that allows you to get
the access of that ID that you selected
up here then we're going to run
a query right here that has the SQL
syntax of update the users table
password field to the temporary pass
hash where ID equals this users ID and
username equals you then we're going to
run another query right here to update
the user options table temp Pass field
and give it an empty value where
username equals you you're just really
you're emptying the temp pass field from
the user options table and you're
putting the value of the temp pass into
their actual password field so they can
then log in with that temporary password
and that is everything so I'll collapse
that backup and all of this code will
accompany this video so you if you
happen to not seek things clearly in the
video or you're having problems with
your syntax in your scripts you can just
happy my code and look at my code in
another file and compare it to yours or
whatever okay so that takes care of
making sure you have some kind of
mechanism in place to where if your
users forget their password they're not
lost to you forever they can still come
back to your site and log in because
you'll let them generate a temporary
password to login with</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>