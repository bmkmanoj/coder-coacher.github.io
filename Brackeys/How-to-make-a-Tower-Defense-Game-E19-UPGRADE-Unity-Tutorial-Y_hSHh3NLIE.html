<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>How to make a Tower Defense Game (E19 UPGRADE) - Unity Tutorial | Coder Coacher - Coaching Coders</title><meta content="How to make a Tower Defense Game (E19 UPGRADE) - Unity Tutorial - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Brackeys/">Brackeys</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>How to make a Tower Defense Game (E19 UPGRADE) - Unity Tutorial</b></h2><h5 class="post__date">2016-11-02</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Y_hSHh3NLIE" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">this video is brought to you by sultan
al sharif thank you so much for donating
if you want to support practice yourself
you can go to patreon.com/scishow tuning
in at brac ease hello everyone I'm look
into this video and creating a tower
defense game in unity today we are going
to be creating a upgrade system that
will allow users to upgrade their charts
for X amount of money while the game is
running so that's going to be super
awesome and let's just dig right into it
so as you can see in the last video we
created this node UI which is basically
just a canvas with two buttons that will
hover over any selected turret the first
one is the upgrade button which we will
make actually do something today and
then in the next video we can do
something with the sell button so um
yeah before we get started with this I
just want to fix a very quick little bug
that I discovered when turning off the
recording from the last video and that
is if we currently hit play and play
some turrets at the very top of a map
here so let's just play some right here
you can see if we try and place these at
the very top of some of these nodes it's
not going to give a hover animation and
nothing happens when we process it when
we press it and also if we try to select
one of these you can see that sometimes
doesn't work it does if we click down
here but not at the top so what is
happening here well it's actually our
top canvas that is currently overlaying
our map a bit and because that has a
graphic ray caster that will sometimes
block on any information about having
clicked on an object so what we want to
do is simply disable this graphic ray
caster
I believe you can just remove the
component as well I'm just going to keep
it there and that should actually fix
that bug so now if we go in here we
should see that um on everything if we
select the chart everything highlights
properly and that we can correct this
shift between the different turrets much
better awesome so what I want to begin
with here is our node script that sits
on every node object in the game oops
that's our enemy script our node group
here and you can see quite a lot is
going on in here and I actually want to
add more stuff to this because I think
the current way that we are
building charts can be made made a lot
more logical so if we have a look here
we have a function called onmousedown so
whenever we pressed in on the node we
check our we over any GUI if we are we
don't want to do anything do we really
want to select this node in in that case
then we want to do that can we build
there if we can't then we skip out and
if we pass through all of this if
statement well then we're ready to build
the chart and we do that by coding build
turret on and then passing in the node
and that function sits on the build
manager I think it would be a lot more
sensical
to have this function sit on the node
itself because we're building on the
node so we might as well have the
function on the node also we're passing
in an instance of of or a reference to
this instance of the class and then
we're changing stuff inside of our build
manager if we go into a build manager
here you can see that we are accessing
turret under the node and changing that
and there's no reason to do that using a
reference when we can just do all of it
locally so let's change this so let's go
in here and create a separate function
and we're just going to call this one
build chart and instead of on taking a
node we are going to take in a blueprint
so we are going to take in here a turret
blueprint containing the information
about the chart that we want to build
let's just call this one blueprint
whoops let me not mess up the
parentheses there awesome so this is
what we want to cold down here so we
want to go build turret and then we want
to pass in some kind of blueprint and we
will talk about where we get this from
in a moment then inside of our build
manager we can take all of this code
copy it and delete it and delete the
entire function save that and go into
our node and paste that here so now we
can use a blueprint instead of the chart
to build so in here we go blueprint that
cost we go blueprint the cost there's
there as well we go instantiate
blueprint prefab and we want to use get
build position but we don't need to
reference it through a node now so you
can see we are removing a lot of
unnecessary references here so again we
don't
want to go no turret and currently these
are both cold toward our turret up here
and the temporary turd right here so
let's just go ahead and rename this to
underscore turret and do that there as
well
so we can distinguish between the turret
we just instantiate it and our local
field variable up there then we have the
effect here and we want to instantiate a
build effect and we could either have
this sit on the blueprint as well that
would make sense because then you would
be able to have different effects for
different turrets when building them but
since we don't want to create that let's
just have this still sit on the game on
on on the build manager so in that case
we could simply go build manager dot
build effect and because this is a
public variable that's totally
accessible and again we are get build
position here is just a local function
so we don't need a reference and
everything else looks fine I also want
to remove this money left thing because
we now have a money this calendar so we
can just display chart build cool so
this function should actually work just
fine now however we still need to pass
in the correct blueprint and this of
course sits on the build management our
build manager is responsible for
figuring out what to build next so he
has a variable called chart to build and
instead of making this public which
means that we could then also change it
from outside of the script let's just
have a function called on get turret to
build so we simply go down here just
like we have a selector to build and
again this is why we don't want to make
it public publicly accessible that means
that we would be able to change it
without also deselecting nodes and we
don't want to do that we want to always
deselect our nodes when we change the
turret to build so let's just make
another public void here and actually
it's not going to be a public board it's
going to be a public tort blueprint
called get turret to build and this is
simply going to return the chart to
build there we go it's that easy so
instead of a node now we go build turret
and then we go build manager dot get
chart to build
cool so now things should be working and
we can definitely try this out so let's
just hit play and let's try building
some charts and you can see that works
just fine so now that we have our code
grouped a little more logically we can
also go ahead and add other
functionality as well so we have our
build turret let's also make a public
and this time I want it to be public
because we want this to be called from
without the class and this is going to
be a public void called
earth grade actually let's do upgrade
chart just to be very specific on what's
going on and in here we are essentially
want to do a lot of the same stuff so
let's just take off this code and then
edit it a tiny bit so if player stats
that money is less than blueprint dot
and then we want to have an upgrade cost
and if it's not well then we want to say
not enough money to upgrade that and the
return we also want to subtract our
upgrade cost and we're going to be
making this variable in a second and the
thing that we want to build is no longer
blueprint dot prefab we want to instead
build blueprint dot our upgraded prefab
and the simple position and everything
we can also have a separate effect right
now we're just using build manager build
effect we could also have a build
manager upgrade effect if you want that
to look different but I think the build
effect looks really cool and I think it
would work fine for upgrades so far but
you can definitely go in and change this
and then we want to say debug dialog
chart upgraded however remember we
currently have a turret there already so
we can't just instantiate the upgraded
turret then we're going to have two
turrets sitting there we also need to
get rid of the previous version so in
order to do that we use the fact that we
have a reference to that turret right up
here and what I also want to do is I
want to go in here and AH instead of
having this as an optional optional
variable actually want to make this non
editable I want to hide this in the
inspector
remember you can use this whenever you
need a public variable that you can
access from anywhere but that you don't
want people to add it inside the
inspector and this is one of those and
we're going to have multiple we're also
going to have a public our turf
blueprint which is going to be our
current Tory blueprint and we're also
going to have an third one which is
going to be a public boolean oops public
boolean arm saying whether or not the
turret is upgraded so we're going to
default that to false and then we're
going to switch it down here so let's
first of all set is upgraded to true
oops this is inside of the built art you
want to do that down here we want to set
is upgraded to true whenever we are done
upgrading and ok so all of that is great
and then let's see here
we also want to get rid of the old
turret and currently blueprint here um
it's actually called turret blueprint so
let's just go ahead and change that so
this is going to be turret blueprint
there we go there we go and there we go
and here before instantiate in the new
turret let's get rid of the old run so
we just go destroy turret and it's
already a game object so we can simply
go like that so get rid of the old turd
and here we are building a new one
awesome so all we really need to do now
is have some way of calling this
function because it should totally work
however we don't call it from anywhere
and one thing
we of course will run into is the fact
that we haven't up added the upgrade
cost added the upgrade cost and the
upgraded prefab variables to our chart
blueprint so let's do that first so
let's go and find our blueprint script
and let's just add two new variables
just the exact same way that we have our
two previous one we are going to have a
public game object
which is going to be the upgraded
upgraded prefab and we are going to have
a public int with the upgrade cost there
we go and you could essentially make a
system for upgrading turrets infinitely
by simply adding on to their variables
so you could just increase their damage
by a fixed amount and the range by a
fixed amount but I think that we are
going to limit ourselves to have every
turret have like two versions and non
upgraded and an upgraded you could also
create an array or a list of turrets
that you cycle through so in first step
you have the second step third step and
on every and you can adjust the cost and
edit every game object for each step and
that would of course mean a fixed amount
of upgrades but it would meaning mean
that you have more than one I think
we're going to stick to the simple
approach because well we've done that
all the way through and I think it's
worked out just fine but that is
something that you should definitely
experiment on your own I believe with
the tools that you've gotten from this
series so far that you should be able to
do that so of course if you run into
problems doing something like that you
can always visit the ombrÃ© keys forum
at formed up practice comm where people
really want to help you with that kind
of stuff so uh yeah so now we can save
this and we should get rid of those
errors in here and we have so that's
awesome
so again we just need to call this
upgrade turret function and when do we
want to do that well we want to do that
whenever you press the upgrade button so
in case we've instantiated a chart we've
selected it and we press the upgrade
button that is when we want this stuff
to happen so let's create some
functionality for this
so let's find our node UI and let's arm
double click that to open it up in
monodevelop
in facial studio I'm sorry and in here
whenever we set the target we don't want
to do anything we want to create a
public void here called
upgrade and we want to hook this up to a
button so that whenever we press a
button it will call this function right
here
this is simply going to go target dot
upgrade tired boom that's all we need to
do what we can also do in here is hide
the menu right after we do that so we
simply go build manager dot instance dot
armed deselect note so that whenever we
upgrade something the menu doesn't stay
open it's just going to close it and
we're good to go you could also just
call the hide function directly but that
will actually mess things up a bit
because the node will still be selected
but the UI will just be hidden so this
is the way you want to do it uh yeah
cool I believe that's all we need to do
so now we just need to hook things up
our node U is fine but we need to go
into our shop which is under the overlay
canvas shop here and we need to find the
place where we are setting up these
different blueprints and of course we
need to add an upgraded prefab and an
upgrade cost so um the upgrade cost here
I'm just going to set to something like
60 and of course you should definitely
try this out
turn balance it do some math on it what
makes sense here compared to just buying
new turrets and stuff like that but I'm
just pulling this number out of out of
the error and then we can see what
happens with it and then we have an
upgraded prefab and we need to go in and
create this so let's find our on
standard prefab let's duplicate this and
let's call this standard turret
underscore upgraded and we can just drag
this into the inspector so we can have a
look at it so I want to bump up the
range to 20 I want to change the fire
rate to something like 1.5 and I
definitely also want to edit the bullet
prefab so let's create a separate prefab
here for the bullet here so this is
going to be the bullet upgraded and we
can go in here and drag our bullet in
there and hit apply on that we can find
a bullet upgraded and I want to just
bump up the damage on this a bit to
something like 70 and bump up the speed
- something like 80 gone and what we can
then actually I don't want to bump up
the speed I think that's fine and
seventy um cool and then we can create
some separate materials to make this
actually pop so let's drag it up bullet
here so we can see what's going on with
it
and where is it it's it's down there so
let's just pull it over here so we can
see what's going on
awesome so let's go under our materials
and let's find our bullet material again
we want to duplicate this control do
your command D and do pull it on the
score I've created drag that onto the
bullet and then let's make this red to
really make it pop it's awesome and we
can delete that then we can edit the
materials for our standard chart
upgraded as well you can bring in a new
model here no one's saying that you
shouldn't do that you can also just have
it look the exact same but I think you
should make something different about it
you could display the upgrade level
using some kind of UI but we're just
going to be modifying the material and
making it a bit bigger so the scale here
I want to do one point two point two
point two hit apply on that and also
want to edit the material so let's go
and find our imports find the standard
turd
go our new materials and you can see
I've already created a folder here
called materials underscore upgraded and
I just want to take all these duplicate
them and drag them in there awesome so
this is going to be the turret on a
score upgraded on the score barrels this
is going to be the turd on the score
upgraded on the score main and finally
we are going to have the turret on the
score arm upgraded on the score
secondary cool and then we can edit
these so of course we need to drag them
in so let's select our standard chart
upgraded here let's find our base I know
a pot to rotate find our head here and
let's drag this in so we're going to
have our upgraded barrels our upgraded
main and our upgraded secondary and hit
apply and you can actually go in and
the base as well but I think I want the
base to stay the same and all I really
want to do here is find a secondary
color and make this red so just to note
just to show the user that there isn't a
variation on this turret I think this
combined with the scale of the turret is
going to make it very clear which
turrets are upgraded and which turrets
are not while still keeping the overall
look and feel of the chart so you can
see that this is just another version of
that turd cool so now we can select our
shop and we can drag our upgraded prefab
in there so let's find our standard
turret on the square upgraded I'm
dragging in there and we should be able
to play the missile launcher and the
laser beam er will do in the next video
I think um this one is already fairly
long and we're not completely done yet
so in the next video we'll definitely
hook those up so let's try and hit play
and let's spawn in some charts here and
you can see currently that our upgrade
cost doesn't update but it should be the
appropriate cost here you can see we're
currently on this much money I'm going
to that I hit upgrade oh of course we
need to hook up our buttons as well so
we need to go and find our node UI find
our buttons and then the upgrade button
and now we are just going to add an
on-click event on to this so let's hit
plus there and it's um dragging our node
UI and go on the node UI and then
upgrade in order to actually call that
method that we created whenever we are
we upgrade stuff so let's try that again
so now we're going to go and cure create
some turrets and I'm going to upgrade
and we have a null reference exception
so that's awesome let's find out what's
going on
alright so figure out what this mistake
was and that's just me being stupid so
of course in some fun node whenever we
are building the turret we also need to
make sure that we are setting the turret
blueprint equal to the arm blueprint
that was passed in there we go so we're
passing in the bill
blueprint of the turret that we want to
build and we need to also make sure to
save that on the node now it's done we
made the variable accessible but we
didn't actually change it in any way and
that was why we were getting that no
reference exception so let's try this
one more time so let's build three
turrets
let's try upgrading and boom there we go
awesome so that's working and it's
looking super super cool cool and you
can see the second time here I can
actually keep upgrading these and that's
a problem and also our UI is currently
not updating to show on the actual cost
of that so that's what we're going to be
editing now and that's the last thing we
are going to be doing in this video
so let's very quickly have a look at how
we can change this so if we go under and
no UI let's begin by looking at how we
can make the arm upgrade cost actually
update so let's enable our canvas and
let's also remove the rotation here
while we ated it and let's go into 2d
mode so you can see under our upgrade
button we have a text variable and this
is containing both the upgrade our title
and the our cost let's split this up
into two different variables so let's
have this one be our text and duplicate
that and this is what this one is going
to be the actual cost or amount and
let's rename that to cost then we can
simply take the text here drag that up
to something like thirty point two five
is going to be fine and drag our cost
down so we split it in half and then we
take our cost here and anchor text to
the top and we take a text and angle
that to the bottom there we go so we
have the exact same thing but now let's
split up into two different objects and
that just makes it easier to handle
inside of Visual Studio so what we can
then do is take our text here change
that to upgrade without the arm bold
tags and we can simply go in here and
now change this to Roboto bold from the
very beginning and everything else looks
good of course we want to update this on
this cell button as well so what we'll
do is simply go in here remove the sub
button do
we keep the upgrade button and we simply
go in here and change the text to cell
change the cost to I don't know let's
just do 50 here and let's change the
button name to cell cool and of course
we want to remove the on click event
there we go so what we then do is go
under I knowed you I double click that
and we create a reference to our text
object containing the cost so we go undo
up here and include unity engine dot UI
so we can make a reference to a text
object so we're going to make a public
text here which is going to be the
upgrade upgrade cost and then when we
set a new target meaning that well we've
selected a turret we're going to move it
and we're going to set the UI into
active and we're also going to go
upgrade cost text is now equal to target
dot chart blueprint dot cost and of
course we want to add on to this the
dollar sign there we go this is all we
need to do there and yeah so that should
actually update so if we just make sure
to drag in the UI element so we're
dragging our arm and we need to find
that so let's select a node UI let's
drag in not the text but the cost there
and we disabled the canvas we should see
this working already so if we go in here
and create a turret and this should say
60 now and it doesn't it says a hundred
so why does it tu then let's find out so
let's go into our shop overlay cam is
sharp and let's see the upgrade cost is
currently 60 and that's why so we are
using cost and not upgrade cost awesome
so now we should see this working and we
can also go under the canvas and rotate
this on 35Â° again just rotate it back
to where it was before and now we should
see this update here so there we go and
if we are were to spawn in a missile
launcher which currently has a default
upgrade cost of zero you can see that it
says that as well so it does update
depending on the turret awesome
so uh the final thing that I wanted to
do was just make it so that we can't
upgrade on when multiple times so we
have upgraded one time and otherwise
it's just going to disable that button
and all we really need to do here is go
in and use the fact that we now have a
variable under a target called
is upgraded so in case we are already
upgraded then we want to disable this
button and we only want to change the
upgrade text here in case we're not so
we're going to go in here create an if
statement saying if target dot is not
upgraded then we want to set the upgrade
cost text and all of that and if it is
so if it's already upgraded then we want
to do upgrade our cost text and set that
equal to um John or upgraded or maxed
out or whatever and on what we also want
to do is create a reference to the
button itself so that we can make it non
interactable so let's have a button here
and we'll just call this upgrade button
and all we need to do is go down here
and say button no upgrade button upgrade
button there we go dot interactable
equals false or true in this case and
false in the other case there we go and
that will just kind of fade the button
out a little bit and make remove any
hover animations and also make sure that
it doesn't call this function down here
um in case it's already upgraded so now
let's try actually doing that so let's
try and going in here and dragging in
our upgrade button and that should be it
are you ready I'm ready let's try it
let's hit maximize and if my system
doesn't freeze here there we go Wow
nerves I haven't saved there we go
it's maximized that's it play and let's
try this out so let's create three
turrets it's like one of them that's it
upgrade it upgrades we can select it
again it says upgrade done you can see
it's a bit faded out
click it we can still click the cell or
we can click the Upgrade and it changes
for the other one so you can see now
that we have a really really nice
upgrade system in here on and that makes
it very clear on what's going on how
much it
how much it's going to cost and allows
you to change a bunch of different
parameters from graphics to effects to
damage range and all that kind of stuff
on the different turrets so I hope you
enjoyed this video I'm looking forward
to implementing the next chart along
with some selling of stuff in the next
one so I guess there's only one thing
left to say which is upgrade complete
and I will see you in the next video
thanks to all the awesome patreon
supporters who donated in October and a
special thanks to Sultan L should've
Facebook matify and James Calhoun become
a supporter at patreon.com slash
breakfast</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>