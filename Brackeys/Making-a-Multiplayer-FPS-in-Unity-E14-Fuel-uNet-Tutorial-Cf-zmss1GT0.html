<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Making a Multiplayer FPS in Unity (E14. Fuel) - uNet Tutorial | Coder Coacher - Coaching Coders</title><meta content="Making a Multiplayer FPS in Unity (E14. Fuel) - uNet Tutorial - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Brackeys/">Brackeys</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Making a Multiplayer FPS in Unity (E14. Fuel) - uNet Tutorial</b></h2><h5 class="post__date">2016-03-27</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/Cf-zmss1GT0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">thanks for tuning in at brakus hello
everyone welcome to this video on making
a multiplayer FPS in unity today we will
be improving our flying mechanic by
first off adding a fuel thruster amount
or a thruster fuel amount so that we can
run out of fuel when flying and then it
will replenish when we are not flying
we will also be fixing the bug where
when we fly on top of obstacles or just
stuff higher than the actual ground
plane it will kind of collide with the
ground instead of using that as a new
base to hover over so that's something
that we will fix also to display the
fuel amount will have a cool graphic so
that's something we are also going to
add so today's video is going to be
super fun and super important so let's
just stick right into it and you can see
here that I'm in my web browser and
that's because I want to mention that
all of the different models we are using
right now for the environment are
placeholder
they're only temporary and I'm working
together with a cool friend of mine to
make this environment look a lot more
awesome and if you get impatient or you
just want to do some of this stuff on
your own maybe create weapons on your
own a player on your own or different
environment props you should check out
this tutorial that the same friend of
mine has made it's called introduction
to 3d modeling it's a blended tutorial
and it gives a very practical
introduction on how to model some of
this stuff out on your own and you can
see here that he models a tactical grip
for a weapon so it's very relevant for
our tutorial you should definitely check
that out so without further ado let's
jump back into unity and get started
with today's subject so you can see here
that currently on our player we have
this idea of a player controller which
has a speed it looks sensitivity and a
thruster force what I want to do is kind
of expand onto this to create a limit
for or you can kind of create a fuel
variable that will decrease whenever we
are using our thrusters and increase
when we are not using them so to do this
let's double click on the player
controller to open it up in Visual
Studio
we'll have a go at this I also want to
create some UI to display this stuff so
you can see here that I've opened up the
player controller and I think that we
should maybe start by just implementing
this limit and then in a moment actually
let's start with the UI so just keep
this open we can close the player shoot
and the actual player script will also
be editing the player setup script so I
have these two open here good so let's
start by modeling out the UI so we'll
find our prefabs play a UI remember this
is the prefab that spawns in with our
player to display UI only for that local
player and it currently only has a
crosshair let's right-click on the
diplay UI go on to UI and let's go down
to find the image here and ask the
sprite we'll just go in and select UI
sprite this is a standard sprite that is
included with the UI system and we can
go ahead and maybe angry this to the
button left cut board bottom left corner
and we can go out and maybe drag this
out like this make it a bit smaller
position it there somehow I think this
looks pretty good
we can of course always edit this later
I might want it looking a bit smaller
something like that looks pretty good
- we're out of office as a base what we
can then do is we can make this a black
and we can then change the Alpha here so
this is going to be the background of
our thruster fill so this is going to be
the fuel or thruster fuel and here we're
going to duplicate that and drag that
under using control D and then just
dragging and we are going to have this
as the thruster fuel fill and this is
going to be a much brighter color still
a bit transparent and let's make it like
a light blue thing that could look
fairly cool something like that may be a
sign color and maybe a bit less
transparent there we go
so it looks like something that we
definitely want to have a lot of and you
can see what we can do now now we can
take this and we can scale it down and
you can see kind of what effect that
gives us so that is super cool but
instead of using the height here to
scale down what we want to do is use the
scale here because that goes between
zero and one and this way we don't have
to manage any kind of start ID and
minimum height or anything we can just
scale this on the Y and to make this
even easier on ourselves we should
change the pivot point so we want it to
be halfway over on the X and we want it
to be zero on the Y this way we can
simply scale here and it will scale
downwards like we want it to so you can
see just how easy it is to regulate this
using this variable cool you could also
do a custom image type and use filled
here but the way that this sprite is set
up with the border is that's going to
look super weird so we're going to keep
that at sliced and simply use the scale
factor coal's
so next up I just want to add an icon
here to display that this is some kind
of fuel amount something that controls
whenever we can fly and I found that
unity had a pretty cool icon actually
that we can use so that's right click
here go in the UI and choose image and
you can of course make this yourself in
Photoshop if that's what you want to do
then let's go onto sprite here and
select the button accelerator up sprite
this is part of the standard assets
cross-platform input which you can of
course just right click and go on to
import package and select cross-platform
input to import if it's not already in
your project so we can take this here we
can drag it down here scale it down
something like that and we'll make sure
to anchor this to the bottom so if we
want to change the way this looks it's
going to scale just fine I think that
looks super cool I do want the thruster
fuel here to be a bit brighter maybe
and maybe change the hue just a tad I
think something like this looks super
cool and we're going to stick with this
for now I also want to not anchor this
to the are left but instead anchor it so
that it scales with the entire object
something like this cool that looks good
and we can just make sure that this
snaps to the sides all right so now when
we go into the game you can see that we
have this cool-looking bar but we still
need to animate this so we need this to
be controlled by the fuel amount that
we'll introduce in a second and to do
that I'm going to add a separate new
component you can see here it's going to
be called play UI and we're going to go
a new script c-sharp create an ad now
let's double click this to open it up in
monodevelop what we want to do here is
first off import actually we don't need
to import anything because we're just
going to be using a rect transform to do
the scaling and that's included under
unity engine so first off let's add a
reference
oops serialize field add a reference to
the arm the fill fuel fill amount so the
actual object that we just created
that's going to be it's going to be this
one first a fuel fill and this is just
going to be the thruster oops
thruster fuel amount or fill or whatever
that's going to be let's to fill and
then we want to add a public or just a
void let's just do a white board which
is going to set fuel amount on the UI
here and that's going to take in a float
which is going to be the actual amount
and what we can then do is simply say
that thruster fuel fill dot local scale
equals a new vector3 we're on the X we
want a one on the Y we want the amount
and on
z we want a12 you can also input the
current local skill here instead of just
the ones but since I don't think we're
going to be changing that and this is
going to work just fine it's going to
run a tiny bit faster good so now that
we have this we should be able to just
call with this method whenever we want
however we don't currently know what the
current fuel amount is is both because
we don't have a reference to our
playercontroller but also because we
kind of haven't made the variable yet so
let's go ahead and do that
so in our playercontroller let's go up
here where it says thruster force and
let's add another serialize field this
one is going to have a store a private
float which is going to be the thruster
fuel region speed something like that
actually let's start off by doing the
burn speed how fast we print through it
I don't know this is going to be fine
and we're going to default that to
something like 0.9 F for one F or
whatever you want to do so that means
that it will be gone after one second of
flying then we can make another
civilized field private oops
private float thruster fuel and this is
going to be the replenish speed I'm
going to call this region speed and it's
going to be set to something like 0.3 F
so we will gain back the fuel a lot
slower then we will burn it and then we
can have a private float and this is
going to be the next actual thruster
fuel amount and that's going to be
default that's going to default to 1
that means the maximum amount then we
can go down into our update method
scroll down to where we handle some of
the thruster force you can see here
calculate the thruster force based on
player input well what we want to do
here is we want to also
and I'm just going to do this up here
whoops we are going to want to say that
thruster amount thruster fuel amount
minus equals thruster fuel burn speed
times time Delta time so how much the
fuel amount decreases when we are
actually flying depends on the thrust of
fuel burn speed and of course we want to
make that frame brain frame wait frame
rate independent good I apologize to my
English there so we can take in and do
the same down here so we simply want to
say thrust refuel amount plus equals
thruster regen speed times time dot
delta x so here we will gain back thrust
thrust of fuel at the rate of the
thruster fuel regen speed and of course
again frame rate independent so that's
kind of how we do this and you can see
of course this means that we are flying
and this means that we are not flying so
that should work just fine and we don't
all only want to kind of limit this we
also want this are or I mean we don't
only want to control this variable we
also want to actually make this limit
whenever we can fly so we need to add an
ant here so we don't only want to fly if
we get the button down jump we also want
to say that thruster fuel amount needs
to be larger than zero so we need to
have some kind of some amount of thrust
to fuel in order to fly this frame good
so that's perfect
and the last thing that we want to do
here is we make want to make sure that
we clamp this value between zero and one
because right now when we are not flying
this is just going to increase and
increase and then when we actually
decide to fly we can maybe fly for hours
and that's not something we want also it
can go below zero so if we keep flying
Canada actually it might be able to go
just on this zero but then we
we'll be stopped so but still we want to
clamp this so we want to say that our
thruster fuel amount equals math dot
clamp and the number that we want to
limit is the actual thruster fuel amount
and we want to limit it between zero and
one there we go so this should work just
fine now and we can actually start to
tie this together with the actual player
UI so we have this system working we
have this system working now we just
need to tie them together and we do that
by kind of creating a link from the
player UI to the player controller so we
can call a method here that checks what
the current through fuel amount is in
the player controller so let's start by
adding a getter here get our method so
public float get thruster fuel amount
and this is simply going to return
thruster fuel amount there we go and
again the reason why we don't just make
this public is to make it more protected
so that the only thing controlling this
is the actual player control it just
makes more sense doing this doing it
this way then in the player setup or in
the play UI I should say we want to have
another public method we want here a
public void and this is going to be a
set player controller or it just may be
set controller and this is the reference
to our actual controller so we want the
private player controller and this is
just going to be the controller and then
here we can use this as an argument so
it's going to take in a player
controller on the score controller and
we are going to set controller equal to
controller perfect and now we can use
player setup tooling
these together so in the player set up
here down under the start method where
we create this player UI instance and
remember this requires that we are the
local players so we make sure that way
that this is only happening for the
local player that we want this UI to be
displayed on and what we can do here is
first we create the player UI then we
configure player UI and we do this by
saying player we create a simple
temporary variable called player UI and
this is just going to be the UI
component on that player UI object and
we set that equal to player UI instance
dot get component of type player UI and
of course we aren't certain that that is
going to be a player UI component on
that instance so we want to say that if
UI is equal to null well then something
has gone terribly wrong so we want to
say debug that log error no player UI
component on player UI prefab there we
go and if that doesn't happen what we
want to do is we want to say UI dot set
controller and we want to set that equal
to the current controller current player
controller that sits on the same object
as this player setup script they are
always going to sit on the same object
in our game if there aren't in us you
should create a reference just variable
here that you drag in the inspector but
here we're just going to require it as a
component that a player setup requires a
player controller there we go
it's that easy end this way we don't
need to do any error checking and that
was it for this I think then in the
player UI we can go ahead and make an
update method and I'm doing it this way
because we could actually go ahead and
make some kind of method Col that may
should only updates whenever the fuel
amount actually changes but since this
is a very easy check and since the fuel
amount is going to be changing a lot of
times because it's almost always going
to be either regenerating or or burning
therefore we really don't need to do
that so in the update method here we're
simply going to say that controller dot
arm get thruster force or thrust or fuel
amount there we go
so this is our current fuel amount and
we can simply say that we want this to
set fuel amount to that using our method
down there so we can simply wrap that in
as an argument and now things should
actually be working at least if we
remember to fill out our the correct
variable so in our play UI we want to
drag in the thruster fuel fill we want
to then hit apply and forget about this
object for now then under our player we
want to these variables look just fine
and nothing new under the player setup
so now everything should be working and
if we go in and hit play land host and
try and thrust here you can see that
it's actually working so that is just
perfect the only problem that we
currently have here is that when we
reach a zero amount of fuel we can still
kind of hang in the air because every
frame it replenishes just a bit of fuel
and then we spend it the next frame and
that kind of kind of gives this weird
looking behavior here which is not
really desirable so an easy fix for this
is if we go under our player controller
go down to where we check or when we
decrease this fuel faster fuel amount we
want to do that regardless if it's over
zero we want to always do this however
we only want to add thruster force if
thruster fuel amount is greater than or
equal to a very tiny amount something
like zero point
zero-one and that's just going to give a
tiny margin that will make sure that we
don't apply our thrusters unless we have
just a bit of fuel in the bank so when
we're now going to go ahead and hit play
you can see that we just fall down if we
don't have enough fuel so that's just
perfect so now our fuel engine so let's
say should be working good so the other
thing that I wanted to fix is right now
when we are fly on top of an obstacle
here I'm just going to fly on top of
this one you can see that we collide
with the ground if I go into the scene
view here find our player he sits on top
of that thing which he shouldn't he
should be floating and actually he is
floating just a bit bit but that's
because of the colliders just a tad
bigger than the actual player model you
can see that we are colliding with the
ground here and that's not what we want
so we kind of want to offset the level
at which our spring will try to reach so
in order to do this if we just actually
let's just to play here and I'll
demonstrate when we spawn our player in
we spawn him at a Y position of one then
what we can do is we can kind of move
him around on the Y which we we do and
then it will try to reach this one
precision again and you can see it gets
very very close however whenever we were
standing on top of an obstacle we want
to UM we want to keep kind of change
this ground level so we don't want him
to strive to be at one we want him to
strive to be at that obstacles top
position plus one and if we can do our
configurable joint we have something
called a target position and that is
that exact uh offset so let's say that
we jump up on top of a 1/1 cube well
then we just saw type in one here or I'm
sorry
negative one and you can see that
offsets his new ground level this way
what we can do is we can simply fire
down some rays so we can use Ray casting
to check how far above any obstacle our
ground we are and then set that position
in negative down here so that's what
we're going to do if that was very
complicated don't worry it's very easy
to do in cold and you can just write
after me and you'll see just how cool it
looks when we are actually done so let's
find our our update method here we can
just do it at the very top and this is
something that we want to be doing a
refrain so in here we can first off do a
ray cast hit and this is just going to
start information about what we hit
where we hit it and stuff like that then
we can say if physics dot ray cast and
then we want this to to give this a
bunch of variables the first off you can
see many different versions of this the
first off is going to be the origin so
we're going to be using transform dot
position then we're going to give it a
direction which is going to be vector
three dot down it's always going to
shoot directly down then we are going to
give it a out hit so we want to fill
information about what we've hit into
this variable here that's going to feed
that in there then we are going to give
a maximum distance that's going to be a
hundred and finally we can do a layer
mask which we'll do in a second so if we
actually hit something this is going to
return true and therefore this code down
here is going to be cold and if it has
well then what we want to do is we want
to say joint dot target position here
it's going to be equal to a new vector3
and it's going to be zero
because we don't want any offset on the
X then we want something on the Y and
it's going to be zero on the Z as well
and what we want on the Y here is going
to simply be the point that we hit so
the very surface that we hit that
exact point dot y and then of course we
need to inverse this because it's a
negative offset and that's all that's
all we need to do and if we haven't hit
anything we're simply going to set this
target position equal to the ground
plane so that's going to be zero zero
zero there we go
that's all I hope and if we go in and
try this now maybe we should just
comment what we're doing here so we are
setting a target position for the spring
this makes the physics act right when it
comes to applying gravity when flying
over objects good so that should be
working and we can now jump back into
unity and if we just try this out
everything should be just fine because
we don't have a problem with the raycast
hitting our actual objects all right let
at least we shouldn't have and the first
thing that you will notice here is that
this works just fine and if we go over
to this object fly on top of it you can
see that we are hovering over it and the
physics feel a lot nicer you can see
here we are actually hovering there so
that's just perfect then if we go on
jump off the ledge here and see just the
same thing happen so that's just perfect
and the last thing I want to do is just
to make sure that this is a bit more
configurable add in the layer mask
anyways just so we had can have objects
with colliders that we don't uh that we
aren't actually able to stand on top of
so a cool idea for this would be a
player can just make like it player
Tower or anything like that you can if
you want to but I don't want to so let's
go up here and under mm maybe just here
we could put this on the spring settings
but I don't really think it should be
under spring settings and this is just
going to be a serialize field it's going
to be a private layer mask and it's
going to be a cold environment mask that
will make sure we only collide with the
actual environment and we can just add
this here as the last argument in this
crazy row of parameters and then we are
going to go into our player and you can
see here we can now select any layer
that we want so I'm going to make a new
layer here I'm going to add a layer and
this is going to be collidable
environment let's do that that's going
to be stuff like obstacles ground planes
stuff like that then let's go under
environment and select all of our cubes
not the directional light and let's
change them to collidable environment
coal save that select our player and
then choose as the environment mask
remember to choose collidable
environment and you can check off any
other thing that you want this to be
able to collide with on the y-axis or I
should say able to hover on top of it
we'll still be able to collide with
everything else also now you need to of
course make sure to change the layer of
any objects that you want this to be
able to hover on top of but that should
be just fine if you remember to do that
this system is going to work so great so
now when we play we should see
absolutely no difference things should
be working but it's more stable now and
we have more control there you go so
that was basically it for this video I
hope you enjoyed it a lot and I'm
definitely looking forward to the next
one so thanks for watching and I'll see
you in the next video</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>