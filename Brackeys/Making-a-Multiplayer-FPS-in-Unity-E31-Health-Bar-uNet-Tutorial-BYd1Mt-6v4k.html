<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Making a Multiplayer FPS in Unity (E31. Health Bar) - uNet Tutorial | Coder Coacher - Coaching Coders</title><meta content="Making a Multiplayer FPS in Unity (E31. Health Bar) - uNet Tutorial - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Brackeys/">Brackeys</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Making a Multiplayer FPS in Unity (E31. Health Bar) - uNet Tutorial</b></h2><h5 class="post__date">2016-11-23</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/BYd1Mt-6v4k" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">thanks for tuning in at brakus hello
everyone and welcome to this video in
creating a multi-player fit in unity
today we are going to be creating some
UI for our game most specifically we
will be creating a health bar and some
kind of way to display ammunition that's
what most of you guys said you wanted to
see in the last video I also have plans
for some weapon switching and a lot of
you guys suggested some kind of sniper
with a scoping in mechanic I think that
sounds really fun but I won't be doing
it today today it's going to be UI but I
definitely want to do it soon so without
further ado let's just jump right into
it so as you can see I'm here in unity
and what I want to begin with is just
taking our kill feed and kill feed item
scripts and dragging them under the
scripts folder to organize things a bit
better now let's go into our prefabs
folder and find the prefab called player
UI and drag that into our hierarchy as
you can see I'm in our main level one
scene so that we can see our player you
are working on top of our regular level
let's now switch into 2d mode and focus
on this element right here called
thruster fuel remember we created this
in a previous video and basically it's
just a black image with with a bit of
transparency and on top of that we have
a thruster fuel fill which is a tinted
image that we then scale up and down
depending on our thruster and mount and
then we have this image here which is
basically just an icon which we are
going to rename it to so what I thought
we would do is maybe just scale this up
a bit so let's change the width to
something like 45 and then actually use
that to create our health bar so in case
you want to duplicate all the settings
you can go back and watch the previous
video where we implemented it or you
could just have a look at how things are
set up here here and here and you can
just pause the video to duplicate
everything so now let's duplicate this
by hitting control your command d if
you're on the Mac move it over a tiny
bit and we only have a few things that
we need to change on this object first
of all of course we need to rename it to
something like health bar and we can
just leave the background image then we
want this to not leave just a fuel
filled but health bar fill and let's
definitely tent this in a reddish color
something like that
and let's also swap out the icon so the
icon that we are using right now is what
the icon called button accelerated up
sprite and we got this from the standard
assets if you import the cross-platform
input on the sprites you can see they
have some default icons but I thought
most people probably or at least some
people aren't using the standard assets
so I thought I would provide this for
you in an easy download so if you go in
the description there's a link to where
you can download the multiplayer PS
assets and if you double click the
folder that you get when you download
that and go and do GUI you can see I've
put in three icons here the normal
thruster fuel icon from the standard
assets and also a health icon and an
ammo icon in case you want to use those
we'll be implementing those in just a
second but let's just take these three
icons so select all of them and drag
those into the GUI folder that we have
inside of unity now let's select those
three inside of unity and change the
texture type to sprite and let's also
change the format to true color to make
sure that unity doesn't do any weird
compression on us now let's find our
thruster fuel icon and let's just change
that to the thrust of fuel icon that we
just in that we just imported into unity
it's not going to change anything in the
scene but it is going to make it needed
because it's better to get it from there
than in some weird subfolder under the
standard assets let's also find our
health bar icon here and drag in the
health icon we just import it so that
you don't really make things look quite
decent and the only thing that's left to
do with this health bar now is hook it
up via script to the actual health
amount that we have so if we find our
player UI object you can see we also
have a player UI script let's double
click that to open it up in visual
studio and have a look at how we do
things using these thruster fuel because
we're going to be doing things almost
the exact same way so I can see I have a
bunch of things open here and I'm just
going to close all of it except for whoa
and we even have two versions of the
player UI let's try that one more time
there we go
so as you can see we have a reference to
a thruster fuel fill object and we want
to create one for a health bar as well
so let's create a serialized field of
type rect transform because we're going
to be scaling
it and let's call this one our health
bar Phil and um if we scroll down a bit
you can see that we are changing this
inside the update method and that's
because we want to do this every frame
so that we can update our UI as soon as
something happens and we're using the
function called set fuel amount which we
declare down here so let's just create a
new function that is just a symbol
whoops nut board called set health
amount and it's going to take in a value
between zero and one representing our
toll amount of or our current amount of
health compared to our toll so if we
just input one here that's going to be a
hundred percent health and if we scroll
down we can now implement this function
so let's go void set hill amount it's
going to take in a float with the amount
just like we do up here and it's going
to set health bar fill local scale equal
to a new vector3 with a scale of one on
the X the amount that we passed in on
the Y and one on the Z so that's going
to make sure that we scale it correctly
so now all we need to do is get a
reference to our current amount of
health and pass it in here except in
order to do that we need a reference to
our player on component sitting on the
player object and currently we only have
a reference to a player controller the
way we get this reference is by
implementing this function called set
controller that we then call through the
player setup script so when the player
is set up it's going to call the sec
controller pass in the player controller
and we're going to store it in this a
private variable I want to change how
this works a little bit let's begin by
creating a private player here and
calling it player then instead of having
this be set controller let's have this
be set player and it's going to be
passing a player which is going to be
called underscore player and then we can
set player equal to underscore player so
the on the private player component or
the private player variable is going to
be equal to the player that is passed in
then we can get a reference to the
controller by simply saying controller
fools player dot getcomponent because
remember all of these components are
sitting on the same object and so we can
just do that gate component of one of
them
to get one of the others and we'll get
the one called player controller you
could just have easily have kept the
controller thing and then just I've
gotten the player component the same way
but I think this is cleanly because the
player component is kind of central and
they get a D player controller is one of
those spin-off components that do a tiny
thing the player player itself is where
we handle stuff like health killing
dying that that sort of essential stuff
so what we can do now is simply make
sure that we also change the name of
this and the that we pass in the right
component in the player setup script so
if we go into unity now it's going to
throw an error for the player setup that
we can then just double click on and it
will take us to the right line which is
line 51 so in here we want to say set
player instead of set player controller
and we want to use get component player
instead of player controller and that
should actually be everything so um now
that we have that working we should be
able to go into a player UI and go down
here and reference the player and the
health variable does sit under the
player but it's currently private so we
can't just do dot health and we don't
want to because I'll help this akhirnya
value between zero and a hundred and we
want a value between zero and one and we
want to have that even though we change
our maximum health say we set our
maximum health to 250 so we can't just
divide by 100 we need to divide by our
maximum health in order to get a value
between zero and one so inside of our
player let's create a little helper
method for doing exactly that
so let's find our script here called
player and let's just jump in here and
create a tiny little method and this is
just going to be a public float because
it's going to return a float and we're
going to call it get health percentage
and of course um this is not percentage
deserver between Seiran whatever you get
what I'm saying and what we'll do is
just return current health divided by
maximum health and we'll need to of
course
cast this into a float so that we don't
get some weird integer we want to have
all the decimal places that we can get
so inside of play UI we can now go
player dot get arm get health percentage
and there we go now our health bar
should actually be working of course we
can't really test this on the computer
unless we make a build and damage the
player or implement some kind of test
function so what I think we should do is
just continue on create the ammunition
as well and then we can see it all
working at the end so now what we want
to do is implement a tiny bit of UI in
order to get the ammunition working and
I want to begin by going under the
health bar and thruster fuel selecting
both icons and kind of scaling them up
so let's set our width to 25 and do the
same thing with our height just to make
them a tiny bit bigger which looks a lot
better so what I want to do now is right
click on the player UI go in the UI and
then select panel in order to create
kind of a faded background for em for
displaying our ammunition let's also
make sure that this is anchored to the
bottom left corner and let's drag it
over here somewhere around there think
that looks pretty good let's drag this
down a bit to say there and let's also
change the color here to a black and we
can maybe fade it out a tiny bit more
something like that looks fine inside
the game view actually I want it to be
more clear something like that what we
want to do here is of course change the
name to ammunition and we'll definitely
want to throw in an icon so let's just
duplicate one of the icons from over
here drag it under the enemy nation
object and simply move this over on the
X something like that looks pretty good
I think we can also maybe scale this
down a tiny bit there we go and let's
snap this to the left and not to the
bottom oops
there we go awesome so I think that
already looks quite decent of course we
need to change the icon over here so
let's go on the GUI and drag in the ammo
icon instead looks just fine
and maybe even move this down a tiny bit
more maybe move this up a bit
something like that I think that looks
just fine and then what we can do is
just rename this to icon remove the one
there let's also go UI and then text and
we want this to be anchored to the right
hand side we want to definitely scale it
up let's also move it over here let's
make it white so we can actually see it
on the background change the font size
to something like 24 and change the text
to just say 20 and then what we'll do is
we'll snap the text to the right and
we'll Center it on the vertical axis and
then we'll just move it over here to
create a tiny bit of padding around it
and in the game you can see that looking
just fine and then we can take our
ammunition and maybe just move it in
there's no reason for it to be that wide
and we'll rename this one two ammo text
so we can easily see what what it's
about
when we reference it in the inspector so
I think the UI looks good so let's jump
inside of our player UI and actually
update this through script as well so
not to do that we need to create a new
function so we'll do set ammo amount and
we'll pass in that just pass in 24 now
let's implement the function that's
going to be void set ammo amount and
it's going to be an integer I will do on
the score amount the other ones were
floats but this is going to be just a
whole number on showing the amount of
bullets that we have left and all we
want to do is go and add a reference of
course to our text object so we'll do a
serialize field of type text and
whenever we do something with text we
need to be using Unity engine UI so
we'll do a text here and we'll call this
one I'll say ammo text then down here we
do ammo text dot text equals the amount
and we need to do two string here
because we are converting this into a
string for our text awesome and then all
we need to do up here is of course get a
reference to a current amount of
ammunition
and in order to do that we need a
reference to a current gun which sits or
which our weapon manager knows what is
so let's do up here another private
variable for our weapon manager not
webbing graphics weapon manager and
we'll just call this one weapon manager
and we'll set weapon manager equal to
player getcomponent weapon manager not
weapon graphics weapon manager there we
go the exact same way that we are set
the controller and then here we can go
weapon manager dot current weapon get
current weapon there we go dot and then
bullets and you can also easily display
the maximum amount of bullets but just
using that instead but for now we're
going to be displaying only the amount
of bullets that we actually have left if
you want to have multiple magazines that
can be swapped out and then you can run
out you can display that here as well
it's super easy to extend and it should
be working right away so what we can do
now is just reference our UI elements so
let's drag in our health bar Phil let's
drag in our ammo text and let's hit
apply on this and remove the player UI
from the scene and what we do then is go
and hit not hit play let's just jump
into the lobby here see if it works on
the local client then if everything is
looking good there if we can make it
both so let's do a test room and as you
can see we won't see the health updating
but we can see that when I now shoot our
ammunition does update one small issue
with this and this is something that is
not wrong with our UI but with the way
we implemented reloading is if I now
press three times one two three you can
see it says zero but it doesn't reload
until we then press again that's really
annoying so to fix this all we need to
do is find the script for reloading and
we do that under our player shoot script
so let's double click that go on to our
update method and let's find the not on
the update method no let's find the
shoot method here and you can see that
we do check if
the current amount of bullets is less
than or equal to zero but we do that
before we shoot and that means that if
we have say one bullet remaining and
shoot it's not going to reload it's just
going to shoot until you can press again
and this function is called and now it's
going to call the reload method so in
order to fix this what we want to do is
simply do a small if statement down here
as well saying if armed if current
weapon dot bullets is less than or equal
to zero well then we want to call weapon
manager weapon manager dot reload
awesome and we can't just I'll take this
down here because then you would be able
to shoot by reloading or if you are it
were to start reloading here and you
then cancel the animation if you're able
to do that at some point we can't
currently do that and then go back you
would be able to shooting in weird stuff
so we need to check both places and that
should actually fix that error but I am
going to show you another one that I
encountered right after our recording
the last video so let's create a room
here and you can see now that if we hold
this down and then click click click and
then click it's just going to reload
automatically so that's awesome and um
the issue I encountered is if we just
hold down a mouse here it's going to
work just fine you can see that it stops
to reload but if I then force a reload
by hitting R we can actually shoot while
it's reloading and that's a big big
issue so all we need to do here is
change a little thing that I completely
messed up in the last video I'm so sorry
if this has caused you headaches
I don't normally do bugs in the videos
but this one was a bad one so I don't
even know what I was thinking so you can
see here that we are checking if we're
not the local player and if we are not
then we want to return and then I put an
ants symbol here so we if we're not the
local player and we're not currently
reloading then we want to return out of
the function that doesn't make sense on
any logical level whatsoever what this
needs to say is if we're not the local
player then we want to return
or if we are reloading then we also want
to return okay so that should make
everything work much better so now when
we have play and create a room you can
see that if I force a reload I'm not
able to shoot until it comes back
awesome so now things are working just
the way that we want them to and we
should now be able to create a build
here and see this working inside the
build so let's check if our health is
working as well and I do need to have a
sip of water once in a while so that was
nice so what we'll do is just jump into
the arcane menu here and we'll do a full
play testing session here so we'll be
locked in and everything now we'll do
the same thing here test one two three
four and in here we are going to just
create a test room everything's working
in here we're going to join that test
room and that takes five seconds
normally so we should see that join now
awesome and you can see both the health
bar for the currently active player down
here and the health bar for the other
player over here and now what I can do
is shoot this guy and you can see the
health bar over there going down and
then it reaches zero of course he's
going to explode in a big fire awesome
and you can see the same thing working
here so we'll shoot this player and you
can see the health is going down until
he reaches zero in which in which case
he will die there we go awesome so that
is everything working you can also see
that when the player dies the UI does
disappear so that looks really nice and
our emanation and everything is working
just perfectly cool so that was pretty
much all I wanted to show you in this
video I hope you enjoyed it let me know
what you want to see next if it's not
something I already mentioned that I
want to do and yeah without further ado
thanks for watching and I will see you
in the next video thanks to all of the
awesome patreon supporters who donated
in October and a special thanks to
Sultan L should've faced lemare Fi and
James Calhoun become a supporter at
patreon.com slash breakfast
you</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>