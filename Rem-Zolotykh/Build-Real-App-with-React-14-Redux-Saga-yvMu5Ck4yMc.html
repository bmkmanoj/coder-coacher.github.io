<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Build Real App with React #14: Redux Saga | Coder Coacher - Coaching Coders</title><meta content="Build Real App with React #14: Redux Saga - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Rem-Zolotykh/">Rem Zolotykh</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Build Real App with React #14: Redux Saga</b></h2><h5 class="post__date">2018-01-22</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/yvMu5Ck4yMc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi my name is RAM and welcome back to
the series where we build real web
application with react Redux and no GS
so it was a long time since we saw each
other last time it was in the previous
year so happy new year everyone I wish
you very successful 2018 ok so just get
to speed with a serious and decided for
this particular episode for this coding
session to go a little bit different way
instead of continuing with our forum
we're going to learn about Riddick saga
just because I used it a lot in last
month's and it's pretty cool so it's a
great alternative for thanks and we'll
see today how to use it and what
benefits it it brains and we'll just
convert our signup form from using thunk
actions to silence okay sounds good so
let's just have a big picture what what
is this saga thing so we will not dive
in deep into the functional background
of it just to get the idea how we can
use it so imagine that you have this
Redux application that the separate
stuff and the sagas are just running in
parallel process so it's like in an
infinite loop and it listens to the
particular actions so it's connected to
our Redux application with actions
so when Redux stuff just dispatches some
action and one of the saga listens to it
and reacts to it so it makes some side
effects and when it's done it will
dispatch another action back to our
readers application so this way Redux
app B stays pure we do not have any kind
of special actions there we just
dispatch action for our saga for example
something like request and that's it
that we done our job and we just waited
for another action to be dispatched and
react to it so that makes Redux app very
nice and easy to understand another good
thing about sagas they are very testable
it's very easy to test them which
is really awesome as well okay so that's
that's what we're gonna do today so
let's get down to the code and I had
this fun exchange with Marco Marco Hey
thank you very much if you're watching
we were talking about by emails we were
talking about the demon why I don't use
it and I just said that hey I I don't
see actual benefit in using V many more
and then I launched it and I you know
remembered my setup and I had a rush of
nostalgia and now I'm using them so just
for this episode let's use them and
we'll see how turns out and if you like
it if you like vim stuff just let me
know in the comments below and I will
continue use it in in this series okay
so let's open early nice
first of all we need to of course we
need to install we dock saga so let's do
it with yarn add Redux saga you can do
in beam you can do it with like a peril
process but when I install something I
prefer to wait when it's done and just
meditate a little bit so the Redux saga
is a diversion of point 16 at the time
of the recording so now we need to go to
index dot J's file so here what are we
gonna do we're gonna create middle where
we're gonna register this middle we're
in our redox tour and then we're gonna
run this infinite loop
I like saga process so for that let's go
up here and let's import create saga
saga Mito
we're from Redux saga okay so now here
before doing something we need to create
this middleware so here I'm gonna define
constant saga saga middleware equals
equals almond equals to create saga
middleware just like that so now we have
the middleware that we can register and
let's register it right before the thunk
here so we'll have saga middleware
registered and after we've done that
we're gonna run it so we'll do some it
aware that run and this function takes
one argument that's the
salia so with the route saga I just call
the true toggle you can name it anything
you like
so now we need to import it so we'll do
route saga we put it from route saga and
of course we need to create file a route
saga GS okay so what is Santa basically
saga is the generator function
I think it's generator I always for some
reason I confuse them where the
decorators but this is the generative
function so we get an expert function
and to create generator function you
need to place this Asterix after the
function keyword and then the name of
the function is root Saga and it takes
some parameters in our case none and
then we'll have the body of the function
of the generator so two things to note
about January's we're not going to dive
into details about them but the thing
that you need to know is first of all
you can't use our functions so you need
to have this function keyword and second
what it gives us is yield keyword and
basically yield keyword makes a
synchronous code synchronous like it
looks like synchronous it's very similar
to a sinking of a wait so here we'll
have for example yield and we do
something a synchronous with right here
and execution will wait for it to finish
or to throw an error before continuing
next right so this way we can make the
request wait for the response and
dispatch actions into the redux tour
back into the redux store without
handling promises or callbacks or
something like that okay so now we have
this root salad so we need of course to
set up the disciples themselves so we're
going to change the sign up process to
use sagas instead of the thunks so let's
go to actions users and here we go here
is our sign up action that's the thunk
action it takes some data
it makes API requests sign up and passes
this user data to it and if everything's
go well we have the user model user data
we save the token into the local storage
and then we dispatch this user logged in
action so we're gonna do the same thing
basically but it will be different
because right now if you go to sign up
form so here is an hour on submit you
can see this is where we making this
this props submit function and we assume
that it returns promise and that's why
we can catch something right because we
assume that's our convention that it
will return promise and that's that's my
convention it works pretty good with
medium small to medium projects it could
also work pretty good in large project
but in a big team you will have all to
share this convention and that's not a
good convention I must you know confess
because it leaks all the way from the
thunk action so where does this promise
comes from it comes from the thunk
action so if I go back to the to the
thunk action here you can see that here
I'm return the result of API user signup
function which if you go to API sign up
right here
it returns accessed and that returns
promise so that's all the way from there
it goes to our component form component
which is arguably not really great in
our signup form here we will not be able
to catch anything we will just dispatch
regular pure Redux action so I'm gonna
just delete it from here like this so
that actually screws up our error
handling from the server but we'll fix
it now here we have this submit and this
admit we expect it as the property add
as the prop and we get it from sign up
page component so here is our submit
that we take in this sign up and yeah so
basically the sign up page had not only
the layout responsibilities but also it
it redirected
but now redirection is actually the side
of that if we think about it we just
dispatching some actions and one of the
side effects will be the redirection so
and we do not we will not have this
promise anymore
right because this sign up will be the
pure function nothing more so we need to
delete everything from here basically
what we're doing here we do not need to
have history we do not need to connect
this anymore so I'm gonna just delete it
as well this so I do not need to connect
function and basically I just converted
the signup page into the functional
component so I'm gonna have constant
signup page extends not extents equals
to the function that returns some data
let's this stuff from here ups and I'm
just gonna delete it with him here and
let's format this out nice so now this
signup form doesn't take the submit from
here you just have a just the signup
form just like that so this way we can
connect the signup form itself to the
store so let's go back to signup form so
now it's still need to have the submit
function but now there's gonna be the
pure action so we need to connect it so
let's input connect and that's here I'm
just gonna use the connect here for map
state to props I will just set up now
for now we're gonna change it and here I
will have the submit that will be the
create user request so we'll have the
create user request action and I will
create user requests from actions users
okay so this creates user requests is
just the pure action we're gonna create
it in a moment and we just map up to the
submit property submit prop in our
signup form which is right here but what
it is
create user request is just the function
action so if we go to actions users and
here let's create export const create
user
it takes some data or well that's a user
data I'm not sure we'll see
and now the type is create create user
request and we pass down user here so
now we need to add create user request
of course we need to go to types and
let's expert cons to create user request
create user request okay so just a pure
function no thanks thunk action anymore
here right so we do dispatch in this
section but our app will not you know
react in any way to that instead we will
create right now the side that will
listen to it and when this action
dispatches it will do it's synchronous
side-effects stuff okay so let's go back
to routed user route saga sorry so root
saga so here it's it is a little bit
different parallel so we'll have instead
of dispatching and sort of listen who
have taken put so we taken that means
that we taking something from our
readers application and we put in
something into that so we will use yield
and then take every or take latest so in
our case we just make the take the
latest action that will dispatched this
particular action and then we will match
it bind it to the saga that we want so
that's gonna be create user request and
that's gonna be create user saga so now
we need to import create user request
from as the route saga so I assume
that's types and we need to import
create user saga from let's say sagas
Sagas users saga users solace men okay
so now let's create sagas folder and
inside of it we'll have users sagas
sagas dot GS and here we're gonna export
function X if I learn how to type export
function this again
it's a saga so it's a generator function
create user saga and it takes user it
takes action basically and after that we
can make something out of it so this
action is is basically if you go to base
back to users here this one so this
object will take this object the create
user type and in action we'll have the
user object so and we can we can do
something with it so for example we
could make API request so we'll do yield
not yield will do constant user equals
to yield
it just means wait for it to finish to
resolve in some way in in successful way
or in era way and then we'll do the call
effect that just you can just call you
know invoke the functions right away but
with call helper with call effect it
will make much more easier to test in
the future it's just a way to do that in
the in the sagas so if you want to
invoke the function you just call it and
you pass down the function itself we're
gonna have API users sign up and then
you provide arguments to this function
in our case that's action dot user guys
so that will make the request to the
server and get back the user details and
we save it in this constant user so
after that we want to dispatch action
back to the to our Redux application so
we do it with yield put effect and we
say what we want to put so we'll have
the action here I will say create user
success and we pass down user to it okay
so that basically almost the same as
dispatch create user success action and
that's just again the convention creates
use a success create user failure and
create user request so basically for
every synchronous action every
synchronous stuff that you want to do
you will have these three actions so
your requests and stuff and you either
have success or failure sometimes you
will have more okay other thing that we
want to do if everything's go well what
we want to do we want to have the local
storage stuff so if we go back again to
users here in actions here we have the
local storage and then we dispatch
another thing we dispatch user logged in
so instead of this ya user logged in
basically we can use it right now
instead of create user success okay so
let's just copy this stuff local storage
stuff let's paste it in here so we're
using the same thing user token so we
set in local storage and instead of this
create user success we're going to use
the user logged in actually because for
net for us that actually what we wanted
to dispatch right now we could change it
later to other some kind of other name
so now we need to input a lot of stuff
right so let's go back to route saga
first so here we have this this and that
we have the take latest so we need to
import take latest and we imported from
redux saga slash effects
okay so now let's go back here and let's
import stuff from here as well so first
of all we need to have coal and put from
Redux saga slash effects and next we'll
need to import the user logged logged in
from actions of what else do we have
here and we need to have a API from API
I think that's it I'm not sure about API
that user so let's go to API API user
singular okay like this okay so
basically what's going on with
dispatching right here in route sagem we
dispatch in the create user request in
our form that's what we dispatch now
this route cycle listens to it it takes
the latest create user request and it
then it calls create user saga in its
own loop in peril process the parallel
universe so now here what we do we just
call the API user signup pass down the
action user data into it waiting for it
to resolve and when it's resolved it
will get back user data to us and we
just set the local storage and then we
dispatch user logged in action so let's
have a look in the browser how far we
went okay so in the route saga expert
default okay so let's go back to route
saga and instead of just expert function
it should be export default option so
okay that's good
in sign up page we have the prop time so
let's go to sign up page right away and
delete the prop types because we are not
using prop types anymore here and now
let's try to create something so some
tests at test comm test tests and when
you sign up okay something's going on we
have the loading loading screen that
because something's going on so to go to
Redux you'll see here that we actually
have the create user request now that
happens here but then we have the user
logged in and you can see that it
actually was dispatched and we have the
email we have the confirmed username and
token everything's good that's nice if
you go to the network you will see that
we make the request somewhere here if I
if I find it I find it oh yeah of course
users here here we're making the request
and we can we get the response with this
user created for us that's nice so the
problem with this loading screen is here
in redux you can see that we overridden
the loaded which is deleted from this
state so here in state with user there
are no load loaded and that means that
it's false and that's why we see in this
stuff here so that that's not good we
need to fix it and we can fix it by
going to the reducers user and here is
so when we have the user logged in we
just have the action user we do not do
anything with loaded so but basically we
need to do something with loaded so
let's surround it with brackets and
let's set loaded loaded to trow I'm a
something up yeah of course
we need to spread this object like this
okay so that should actually fix it so
if we just let's log out and let's try
it again test to add test comm test to
test sign up and now we good
now good we even have been redirected to
our to the dashboard page and that
happens not because we're doing
something special about the redirection
but that happens because we have these
routes that checks for user if it's if
user is signed in then we were
redirected the dashboard because we do
not want to allow signed in users to
create new accounts for example so we
even do not need to actually redirect
anywhere that's nice nice bonus to have
but there is a problem so let's log out
and let's try to create the same account
like this and of course nothing happens
if you can see here we make the user
request and we do not have the
successful resolution because because we
have the error errors from our server
but we do not display anything because
right now we have no promises and there
is no way we can get this data from the
from our request okay so now we need to
fix it so first of all now if you go to
the forum you will see that here in in
our submit yes we do not use promises
anymore so we need to store errors in
our redox state so there is no other way
right we need to to tell our forum that
hey you have errors from the server
that's the first thing so let's create
special reducer for form errors and then
we will populate it with errors
depending on the sagas result so let's
go to route reducer and let's here
create another one and we call it say
form errors now let's add it here as
well or errors and now we need to create
it in reducers
or errors da genius so now here we'll
have the reducer pretty standard one
just an object and instead of the
subjects will have the key will have the
form identifier and the value will be
the object of errors good so now when
something's go wrong when something goes
wrong that's that's the correct website
we want to populate it with errors but
first we need to catch when something
goes wrong so if you go back to our user
sagas here is what we going here's what
we do in here but that's only happens
when it's okay if everything's fine but
when when something goes wrong it throws
an error so here in yield when something
goes wrong with this cold stuff it will
throw an error and we need to catch it
catch it and to do that we use try and
just like that and after that we'll have
a catch and we catch in the error and
inside of this catch will just dispatch
another action which is put for example
create user failure hailer action and we
pass down error dot response dot theta
dot errors like we did with promises
because right now here we catch in the
error and we know that this is the throw
of the promise that's why we can do that
of course each you could actually
differentiate between different errors
for example you could have another
suicide are just the five hundred or
maybe network error so here's where you
can catch them and depending on the type
of error
dispatch different action to your
application in our case who you want
just to cover the signup error errors
from server so now we need to import
this create user failure from actions
users ok so now let's go to users
actions here and let's create another
one so there's gonna be our failure
failure
here we will have ours and I'm gonna
just change it to here as well and here
we have failure and now right here we're
gonna have create user failure now we
need to go back to the types and let's
copy and paste it and I'm just gonna use
this as they learn oops oops oops oops
oops done so now we have the just the
pure action that will be dispatched by
Sangha and it will have errors inside of
it
nice so now let's go back to route
reducer not the route use about the form
errors reducer and here let's import the
create a user failure from types and
here we can ask ace on this create
failure and we can return the state just
to just to keep all of other actions
here
other forms errors here and then we'll
have the signup form and the errors will
be action data errors just like that and
also another thing that we need to do is
to input here the request as well so
we'll have the request and we go into
case request also but in this case we're
gonna return state but for signup form
we'll just return empty ology so this
way when we have the request we just
clear out all errors and then if we get
back errors so we just populate it back
that's good so let's have a look let's
have a look right here test test test
test signup nothing happens but if you
go to Redux you can see here that hey
nothing happens what the heck okay so
and you can see that we haven't actually
dispatch the create user failure so
let's go back to editor so what's the
problem now let's go to the user sagas
here we catch an error and yeah
oh man that's embarrassing yield put
okay so let's try it again
so we have test had tested come test
test sign up and here we go so here we
have the create user failure and you can
see that in our stage we have the sign
up with errors from our server which is
exactly what we want but of course we do
not render them on the form itself so
now we need a way to take this data from
the state and use it in our fourth
component so we already connect it our
form so now we can just map a create
Maps taped to props and use it so let's
go to form not this form but this form
and here instead of now let's enter this
out here we'll have map state two props
and let us define it right here map
state two props and what we want to have
we want to have server errors errors and
that's gonna be the state form errors
sign up so basically now in the props we
have server errors now we can use them
and we could use them directly so for
example here somewhere where we have
errors email will also have another one
for server errors email like these props
so various email but also we'll need to
duplicate here as well add some other
conditionals which is not really great
instead of that we're gonna merge or
even replace the errors in component
state with errors from the server and to
do that we'll use component did mount so
this component o component one component
will receive prompts will receive props
I don't remember
so component will receive props and it
takes next props and now we can do
something with that so what are we gonna
do we're gonna set state and for errors
we can
set next props server errors okay
so let's let's have a look in the
browser so if we try to do the test add
test at calm test test
sign up and here we go it works yeah
let's cool are quite unexpected to to
work it the first time so now if I for
example make this test - it still will
not work but test 3 will work and you
can see that we clear the errors and
then they come back which is exactly
what we want so that's nice and if for
example for some reason will have
something like invalid email will still
have invalid email errors because they
are not really connected in this in this
regard p.m. works works like a charm
ok so let's take a break for a moment
just for 5 minutes I'm going to drink
some tea or water and in the second part
of this session we're just going to
create the fetch current user details by
sagas instead of thunks and also we'll
see how to create redirection so right
now we have this redirection
out-of-the-box because of the routes but
that's not the case all the time so what
are we going to do we're going to use
history object both in our sagas and in
our reactor outer so we could redirect
as a side-effect so thank you very much
for time and see you in the next one</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>