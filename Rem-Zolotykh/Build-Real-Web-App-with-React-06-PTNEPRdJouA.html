<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Build Real Web App with React #06 | Coder Coacher - Coaching Coders</title><meta content="Build Real Web App with React #06 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin, machine learning, AI, ML, tech talks, angular, javascript, js, typescript"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Rem-Zolotykh/">Rem Zolotykh</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Build Real Web App with React #06</b></h2><h5 class="post__date">2017-09-15</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/PTNEPRdJouA" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi my name is RAM and welcome to the
series where we build real web
application with reactant known GS so in
this session we're going to implement
reset password' functionality there's
gonna be very simple you know everything
you need to know so most of the time
we're just going to repeat the same
thing that we did before with only one
piece of new knowledge is about JSON web
token verification okay so I want to
thank you all for your comments for
discussion keep them coming
you know comment in the comments below
or p.m. in Twitter so if you have any
questions feel free to ask them I'll try
to get to them as fast as possible also
on this this week I haven't uploaded any
videos because of the moving to the new
apartment but now I'm settled down I got
my working place in order so
everything's pretty cool so let's get
started first of all let's go to our
github here and my mark
and you can see that that's pretty
standard stuff that we want to build so
first we will need to have two pages
basically the first one is the forgot
password page where we have form with
just email field then we're gonna
generate link with token and we're going
to send it to the user and then we'll
have another page to reset password page
where we have two states in this page
error state is when we have invalid
token and if token is valid then and now
the form with password reset and if this
form is okay this data is okay then we
reset password and redirect back to
loggin page you've done it I think
million times right with other
technologies okay so basically in all
this sixth set search and we do this
thing that we could do for example in
Ruby on Rails in ten minutes but that's
fun okay so let's get started
so first of all let's go to login page
and here let's add link link to
new route we call it forgot password'
okay
and here we'll just forgot password and
let's import it from link from react
router down ok so now we have route
let's go to Abdo JS file and here that's
the guest route so we're going to just
copy this line like this forgot password
and we'll have forgot password page so
let's import this page forgot password
page and now it's created so components
pages forgot password page dodged yes
okay so we have forgot password page by
the way today I think the sublime text
became released with version 3.0 so now
I have this license upgrade required
okay so now hearing on this password
page what do you want to do so we're
gonna have will have state here and with
just success false and when it's false
we display this form if it's true then
we display some message so let's have a
look here so we'll say if this state
success true then we'll have message and
let's say we mail has been sent
otherwise here we'll have form so we'll
have something like let's say forgot
password form okay so of course we need
to pass the submit here they submit
let's save it and here we define submit
and it
we'll take some data and it will pass
this data to this props let's call it
reset password request and we pass data
to it and if everything is okay we just
go into this sad state success true okay
so let's define prop types for this
component will need to have reset
passwords request as a function and will
need to have another thing we need to
import message from semantic UI react
and we need to import this form forgot
password form from forms of the password
form so now let's define this in forms
forgot password form that GS and here
I'm gonna use the boilerplate snippet
for this form and it's gonna be react
semantic form Bam and I call it I
already forgot forgot password form like
this and we have a template so in this
form will have only one field that's
email and in validation we need to
validate it so again if not is email
data email then we add errors email
equals invalid email so now we need to
input it so we'll have is email from
validator Lieb is email okay so now we
need to define we have errors we have
data we have load in so now we need to
define this form field again I have the
snippet for it for email email email
email unchanged without any changes
and that's it we have our form so this
form accepts submits the usual stuff
that we did before so now we need to
define in forgot password we have here
the reset password request so we need to
create this thunk action and we need to
connect this element so we do the usual
drill so we connect this element we do
not need I think to pass anything to it
so there's gonna be knob and here we'll
have the reset password request so now
we need to import it reset password
request from actions off so now let's go
to our and let's add this func action
reset password request we have data we
do not need to dispatch anything because
we're not going to react anyway in Redux
tour so all we do here is we make API
request users user and we have the reset
password request and we pass data to it
all that we have in this data is just an
email so we can even do something like
this email and pass email to it so now
let's go to the API and here we'll have
the reset password request it takes
email and we make access post request to
API of reset passwords request and we
pass email to it and that's it that's it
for the client-side part so now we go to
back-end so let's go to mouth and here
let's define new route post reset
passwords request
so what we want to do here we want to
find one user by email that we take from
request body email and then if we have
user then it means that we can actually
send email
so we'll do something like send reset
password email and we pass user to it
and after that we just responds with
Jason
everything's went fine otherwise we'll
just do we're going to respond with
status 400 and Jason is gonna be errors
global we could say that we do not have
use it with such email there is no user
with such email or we could be more not
so precise we just can say that hey
something went wrong so we do not tell
user whether we have emails we use it
with such email or not okay so now let's
go back to our reax application and here
in form let's add the check for this
error so we have errors so if error is
global present then we'll have message
negative that says that we have this
error global so and we need to add
message here okay so going back to back
and code so here what we do we find user
we send email or if we haven't found one
we respond with error so now we need to
define this reset password email
so let's import it from mailer mailer
dodgy melody yes and let's open mailer
and let's define it so it will be very
similar to this one so I'm gonna just
hit send reset password email it takes
user we have transport we have email
here we have from to the subject is
reset password and the text is to reset
passwords follow this link and we'll
have generate reset password link and
then we signed in this email
okay so now we need to go to user model
and define this method and we need to
think about how we want to implement it
the best way to do that is to actually
save this token into the database into
the user model and when we have it will
not only verify this token but we also
check that these particular token is in
the database but we will do it easier
simpler not so secure and your homework
will be to make it more secure so what
are we gonna do we're just going to
create JSON web token we encode in a
public part will encode user ID and then
we'll add also expiration date for
example for one hour so this way this
token will be valid only for one hour
and we will not save it in the database
so let's generate so we'll have schema
methods we generate a reset password
link
let's function generate reset password
link and we return like this we'll
return process that and host and then we
have the reset password and then we need
to add the token and it oops and the
token itself is going to be this
generate Jenny rate
reset password' token okay
so let's define it it will be almost the
same as this one so generate a reset
password' token january to reset
password token and we can assign it but
we can assign it with just one thing
with ID equals this ID will have the the
same secret of course but here we'll add
another option that is expires in and we
said one second so this way we can check
for invalid Ness and then we'll make it
a little bit more realistic one hour and
you can see that winter here is not
happy
because we have the rule no underscore
tangle but when we work with no JSON
MongoDB and in Monte to be the ID
attribute field is underscore so we need
to add this exception to our es lint so
let's open es land and here in rules I'm
gonna add no underscore dengle and I'm
gonna allow say allow only ID other than
that I still want to enforce this rule
so now if I reopen the user it should be
okay
yeah no errors nice okay so we generate
token we generate this link to generate
token we encoding this token ID and
expiration time and then we send it to
the user so now we can test it and
hopefully it will work so now I forgot
this password so if I try something like
my email oMG gmail.com good password
there is no such user ok that's nice but
now if I go to test test calm email has
been sent and I use my own trap mail my
own trap and here we have reset password
and here we have this token excellent so
it works we have
link now we need to create page route
and page to handle it
so let's go back to our editor to react
application going back to app and here
let's define another guest route and
this route will be reset password and he
will have reset password page so let's
copy this thing and change forgot to
reset and now we need to create one loop
reset password by H star GS and this one
also will have state and basically it
will have three states
the first one is unloading I'm checking
on validating the second one if token is
invalid error message and the third one
is everything's okay then we have form
so let's do it like this we'll have
Loudoun true by default and success
false by default so now here indeed in
random method we want to check so if we
are load in Loudoun okay so here I'm
gonna deconstruct it Loudoun and success
this state so if we load in then we'll
have message loading
I'm not gonna style it I will do it
later maybe together with you maybe off
the camera and then we'll have if not
loading and success then I will have
some kind of form now just message form
and if I not load in and not succeeded
then I have error message in this case
invalid token so now we know that we
have an amount of token so that's the
state that the message
we want to see to do that when we mount
this component we want to make a request
to the server right away so we do it
with component it mounts so we'll have
them opponent did mount and when it
mounts we this props is called to
validate token and we pass token from
the route itself so these props props
match params token in up here where we
define reset password of course we need
to provide token as well here okay so
now we have something like we need to
define this prop types and somebody
asked me do I need to define prop types
well you don't you use you freely can
just you free not to do it but you
should because if you do not use float
or you do not use typescript it's the
simplest type checking and most
importantly it's great documentation so
when you come back to this code and you
want to figure out what your components
do you just go to the prop types and you
see what kind of data it needs and
that's very very convenient so here what
we want to have we want to have all they
talking there's going to be a function
and we'll have the match that's going to
be a shape and inside of this shape will
have params with another shape and
inside of this branch will have token
that is string and we need to import
prop types and we need to import a
message from semantic UI react so now we
need to connect this component so in
import Connect here I'm going to connect
it I've said to props we do not need to
anything here but we need to have
validator and let's import it valid a
token we input from actions out so this
is this page component and we're gonna
add here instead of this message later
we're gonna add here the form I reset
reset in form but for now I want to make
sure that invalid token is actually
invalid so we check for it it expires
and we display our message to the user
so now let's go to off this is pretty
standard stuff already so we'll have fun
action will have validate token it exto
c'n we do not need to dispatch anything
and then we'll have API user validate
token and we passed open to it so now we
go to API and here also will do validate
token it takes token and we'll have
access post request to API house
validate token and we pass talking to it
good let's have a look in the browser
dum-dum-dum
so now let's copy this link from our
email and we're going to paste it here
okay so we are reload page we see that
we load in but we do not do any kind of
request let's have a load component dip
mount still of me so let's try it again
reload the page and now we can see we
have load and we have 404 validation
token and token itself good so now we
need to validate this token so let's go
to back in code to our route here and
let's define another route so we have
post validate token route so what do we
need to do here we need to validate
route so we'll have JSON web token
library and there is method verify and
it takes token itself so
request body token it takes the secret
key we store it in process and Jorge
secret and it read it has the callback
function that takes error and decoded
object the public stuff from it we do
not need to have this decoded so we'll
just have error so that's that's the
thing that we interested in so if error
then we respond with some kind of error
message in our case is going to be just
the status for a one and empty JSON
object so nothing special but if
everything is okay we responds with
empty JSON object and okay status of
course we need to import JSON web token
from JSON web token so now let's reload
the page loading and we have 401
excellent we have 401 error but in in
client I forgot in the form itself here
I need of course to have the results so
if everything is okay we have this set
state and we said load into false and
success to true success to true and in
the case of error we catch it and we'll
have this at state load in false and
success false as well so now if we go
back it loads and we have invalid token
great so it expired let's let's fix it
in in backend code here in model let's
add it back to one hour so now when we
have we have the whole hour to test the
things out so and for that let's go back
to forgot password for test
test that come email send here we have
it let's copy it and paste it here
load in form so this token is valid
great so now we can display this form
and after that we can reset the password
so let's do this pretty quickly so now
here instead of this message we want to
have reset password form and it will
take submit as usual they submit but
also it will take token and we'll take
it from here constant token equals this
props match params total okay so we pass
token to it so this way we will as we do
not store this token in the database we
need some somehow to find the user model
and this is our way so we'll have token
and we'll supply it will send it along
side with the new password so this way
this then on on the server we were
verify this token again and we have this
decoded part and from the decoded part
we'll have ID and by this idea we'll
find user and by this ID will update it
so let's do this so we have reset
password form so now we need to invert
it reset passwords form from forms reset
password form let's create one forms
reset password form touch yes using
reset password form here and we have two
fields three fields will have ID and
that's going to be not ID will have
token and that's going to be this props
token and here in
prop ties will have token as string and
two other fields is the password and
password confirmation so now in
validation here we'll check if not data
password then errors equals errors
password equals two can be blank and if
data password not equals to data
password confirmation then we'll have
our response words passwords must match
okay so now we have validation we have
our data fields so now we need to create
of our form fields here we'll set reset
and we'll add form field
the first one is password will have new
password but type is password twice
world is your new password unchanged
without any changes and the second form
field is password confirmation confirm
your new password
I'll have password here and we'll have
type it again please okay so this is our
form for resetting passwords so now in
page we need to define this submit so
we'll have submit it takes as usual some
data and here we'll have this props
reset password we'll pass data to it and
then if everything is okay we'll have
the redirection so we'll have this props
history that push and we'll go to
logging
so we introduced two new props so let's
define them first of all is reset
password there's a function and the next
one is history
and that's shape inside of it
we'll have push that is a function so
now reset password so we'll do it right
here reset passwords from mouth and we
added here as well reset password so now
let's go to mouth and let's define our
last for today
thunk action reset password it takes
data we do not need to dispatch anything
API user reset password and we pass data
to it so let's go to API and we add
reset passwords I takes data and we have
access post request to API oath or reset
password and we pass data to it so now
we need to do let's try it out first in
the browser so if you try to reset right
now we can't if we have test
tttt they doesn't match they don't match
so we'll have test now and we making a
reset password request with data inside
of this data we have passwords and we
have token great so now on to the back
end on the back end in the out here will
define your route post request reset
password so here first of all let's get
the password and token from a request
body data we're gonna use it now we're
gonna verify it again so for example if
user
spent an hour trying to reset password
this this token will not be valid
anymore so we can have verified
same token token with process that and
that secret and we'll have error and
we'll have decoded object here so if we
have error we respond immediately with
respond respond Jace status for a-1 and
Jason is some kind of error as we have
form we could have the global error for
that so we'll have errors global let's
say invalid yeah yeah invalid total
otherwise if everything is okay
we can do we need to find user by this
ID and then update password so there are
two ways to do that in monkey we can use
find one and update but for that we need
password first we need to encrypt it or
we can find and then update and that's
not really great but we'll do this we
already used find one and ablate ones
right so let's do something new we'll
have user and we find one find one by ID
and this ID equals to decoded that ID so
then we'll have user and if we have this
user if user is okay then what we gonna
do we're gonna set password we reuse
that function that we used before and we
pass password here and then we will have
safe it will turn promise and if this is
okay
then we respond with JSON empty object
okay
so if we haven't found user it was
deleted or something happened we respond
with another error here so we'll have
status for for Jason errors let's say
global invalid hope
okay so as you can see this is not ideal
it's very simplistic cold but it will
work for now and you can update it and
refactor it and make it much more secure
as your home task so for example as I
told you before you can save a JSON web
token into the model itself and check
verified token check that this token
belongs to the user and the details in
token and details and the database are
the same so that's one way to ensure
that you know that's the token that we
sent and that also means that there is
only one token at the one period of time
that is active and when for example you
reset the password has been reset
you notify this token so this way you
can't use already used token in our case
we can use it indefinitely until it
expires indefinitely until it expires so
yeah that's that homework for you for
you on the weekends try to play with
this code try to make it prettier try to
change this find one to find one and
update and maybe extract set password
here in model we have set password but
maybe add here the encryption in the
different in the separate method that
you can use so yeah play with it and let
me know what you come up with but for
our purposes let's go to our application
Loden it's okay so we'll have test test
now and we redirect it so now if I try
test I'm logged in but it was actually
it was the password for this particular
user so let's try another one so I'm
gonna have test I as I told before I do
not need to use this one I can just
reuse the same link the same password
during this hour and it works
so we'll have test test test test now
good so now with this old passwords I
can't involve crude 'angels but test
test and I mean and that's pretty much
concludes the reset part of
functionality what we didn't do here is
we didn't send any email confirmation in
or something like hey you change your
password if you haven't done it contact
us or something like that again another
email try to use by self implement by
self it's a great exercises just to do
this thing and to form your skills here
ok that's it for this session thank you
very much for your time if you liked
this episode and this series please hit
the like button subscribe to this
channel also share it with your friends
share it on social media you know spread
the word also if you want to support me
financially you can go to my patreon
page and all the links in the
description below thank you very much
for your time and have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>