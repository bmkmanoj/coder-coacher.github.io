<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Build Real App With React #10: Initial Loading | Coder Coacher - Coaching Coders</title><meta content="Build Real App With React #10: Initial Loading - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Rem-Zolotykh/">Rem Zolotykh</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Build Real App With React #10: Initial Loading</b></h2><h5 class="post__date">2017-12-19</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/j6sOddkDRpc" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi my name is RAM and welcome to the
series where we build real web
application with react Redux and no GS
the time has come to start working on
our and new application dungeon &amp;amp; dragon
stuff so as you can see here I have the
shirt that's sure from rola con that's
the role players festival that is held
twice a year in Moscow and I have the
roll comm cup so I'm really I'm really
prepared to geek out with a cup of tea
here so everything is ready so let's get
down to it so here is an hour plan what
I want to achieve in this coding session
and I will split it in several parts so
in the first part what we're gonna do
we're gonna handle this initial load and
stuff so what I want to achieve is when
user loads application we actually want
to load the initial data from the server
usually what happens is we display some
kind of loading indicator making
requires behind the scenes and when all
the requests are done when we have all
the data that we need only then we boot
up our application there's much better
experience and you will avoid a lot of
bugs along the way especially with
authorization stuff so that's basically
what we're gonna do first we're gonna
redo a little bit our application and
after that we'll handle the basics of
localization so we'll use react in two
and just set up two languages Russian
and English and we'll see how it can be
done and then we'll continue developing
our application and English and at the
end of it when we finish with it so in
the long long future we'll just get all
the data all the strings that we need to
translate with the help of script and
then we're gonna translate it and we'll
have the bilingual application and after
that we'll start working on this user
creates new character because that's the
most important stuff in our application
so there is very important thing that
very often when we start working
our application we focus on not the
essential things so for example in this
application we could focus on things
that we do not have for example you do
not have character races in our database
we have empty database where can we get
it so we start with admin interface so
admin can add this data to the database
what the hell we are developers we know
how databases work we can you know
communicate with them on their language
so that's not necessary right now we can
do it manually just in database and
instead we focus on the most important
features and the most important feature
is for user he already can sign up so
next step for him is to create a new
character that he wants to use in
adventures so that's what we're gonna do
we're gonna create some routes and we're
gonna talk about the form and lay down
the foundation for this form okay so
that's basically over of what I want to
achieve in this coding session and it
will be splitted I think in maybe two or
three episodes so let's start with
initial load in here let's go to our
editor and by the way I switch to visual
code studio so there's a new editor we
use sublime text before now this one so
you can see how I use this one maybe you
like it as well because that's pretty
cool DITA okay so first of all let's go
to our App component so what happens
here is we want to make requests when
this app component mounts and fetch
current user but in the case when we do
not have user when user is not logged in
we don't want to do anything we do not
want to do anything special but we still
need to have some kind of loaded
indicator and we'll place it in our user
model now use a reducer so right now
here in user we have just an empty state
object state equals empty object but
we'll have loaded here and by default it
is false so when our application starts
loaded is false but then we need to make
sure that we set it to true when we
download in and our
location starts in his DOJ's file and
here where we check if we have JSON web
token for our user so if we have one we
set up the relation header and we
dispatch user logged in but what we now
want to do is we just make the request
to the server right away we'll make the
request
we'll get data from server with user
details and that's it right so basically
we're going to remove these lines we
will not decode our JSON web token
anymore otherwise if we do not have it
we'll need to update our reduce user
model that loaded set to true okay so
for that we're going to use something
like user fetched component user fetched
action so let's start from the app
though because it will be easier to
understand the flow of all of this so
first of all in our app we're gonna
transform this app to class component
that extends react dart component and
there's gonna be a render and it's gonna
return all of this markup from here and
I'm gonna just copy everything and paste
it here also our app uses this variable
so I'm gonna just cut them and place
them at the top of the render method
Const equals to these dot props let's
save it
let's prettier do its job now next we do
component component in mount and inside
of it if this props is authenticated so
yeah if user is authenticated then we
going to make the request to the server
so we'll do this props that fetch
current user okay so this fetcher this
this page current user is just the stunt
action so it will make the request and
we get back the user details but only if
user is authenticated if it's not we do
not want to do that but also we do not
want to
if user is already loaded we do not need
but we can we're gonna do it later
so now we need to have this fetch action
so we'll have fetch current user and we
going to input it from actions users and
next at the bottom here will let it do
the connect fetch current user like this
of course we need also to add it in to
prop types so we'll have fetch current
user prop function okay so now we we're
having the fetch current user and we use
it in component dismount nice next we
need to define it so let's go to users
and let's create a new thunk action and
we call it fetch current user it takes
no data and it will use API user data
fetch current user and then we'll have
user and then we're going to dispatch
new action dispatch we call it user user
fetched fetched and we pass down user to
it good so now we need to create this so
we're gonna export constant constant
user fetched that equals to function
that takes user and it returns type user
fetched user fetched and we pass down
user so now we need to import a user
fetched from types okay
now also of course we need to go to
types and create this constant user
fetched done so the next thing is in API
we need to create this fetch current
user so let's go to API and let's adhere
the fetch current user there's a
function we take access get request to
API users current user and it will take
it will respond
and we take the rest data user from the
response okay so that's done next we
need to go to the reducer so we go into
user reducers here let's import the user
fetched and inside of here when user is
fetched let's do it here okay it's user
fetched we're gonna take the whole state
that we already have here just in case
and then we're gonna override it with
action with action that user that we
passed and then we set loaded to true
because after users fetched we can see
that that user is loaded another thing
here when user is logged out we also
want to set loaded to true we know that
when user logged out we know that user
is loaded right it's the final
information so we set it to true here as
well okay so that's what's happened what
happens on the app component so when it
mounds we making the request we check if
user is authenticated if user is
authenticated we make a request to the
server to get current user details and
then we populate our user here and we
set loaded to true and now we can use
this loaded to display whether loading
indicator or our application so let's go
back to app component and to display
load an indicator we're gonna use yarn
add react loader done now we can import
this loader so it's input loader from
react loader and we're just going to
enclose everything into this loader so
we'll have loader and I'm gonna just cut
this stuff from here and paste it at the
end here so this loader takes one prop
loaded it could take more but you can
read the documentation
and if it's loaded equals to true then
it will rent everything that is inside
of this loader but if it's false it will
have this loading indicator so we'll
have loaded here so let's deconstruct
the structured here load it from props
that means that in props we expect load
it to be a boolean and we take it from
our state so load it equals to state
that user downloaded of course later
we'll change this line to to use the
selectors because again loaded loaded
state of application is not only user it
could also be something else several
entities for example okay so that's done
let's go to the browser I think we we
yeah we messed things up right so now we
have in this loading indicator because
we were not logged in so we do not have
token and also we do not but I think
we're making the request let's have a
look let's reload the page dude are we
making the request no we not yeah
because because we are not authenticated
that's good that's good we're not making
a request but we still have in this
loading indicator so let's go back and
let's go to index.js file so here is
where this logic comes in into play so
if we have token then we will do some
stuff but if we don't we need to set
loaded to true and we can do it with
store by dispatch in action basically
dispatch and we have the user fetched so
users not logged in so we fetched empty
object user so let's add it from here
user fetched from users let's go back
here let's reload the page now it works
that's good it works for non
authenticated user so let's try to login
and now we have a problem with login and
that happens because here as well we
need to change something so right now we
decode in
staff and also it happens because we're
actually making the request but we
haven't created the request on the
server here is so this is API not a
website so yeah but it still works on
the following reload but it doesn't work
when we just logged in at bummer
okay so first let's let's delete all of
this so what happens here on when we
have token in our local storage is we
set off the relation header so now every
request will have this token and then
we'll just dispatch fetch current user
and that will do everything right so
we'll just add here fetch current user
and we can get rid of user logged in and
from the JSON decode okay so so now we
we have a real problem because we do not
have anything in our Redux right now our
Redux is actually empty so user model is
empty and after that we set it to true
not good so in our API let's create new
route so we go to users and here let's
create your request get request to
current user and we need to authenticate
this request so we expect only the
authenticated user to make this request
so we go into import of import
authenticate from middlewares
authenticate and then we just add it
here as the middleware so now because we
added here in this request object we
have current user and what we could do
is we could do a response that JSON user
and just request current user okay
don't do that and here's why so you've
gotta load the page you will see that
now we're logged in but in our redux you
can see that we have this password hash
and that's really bad but sometimes I
see that this this errors actually
happen in production applications or for
example a lot of applications web
applications right now send password by
email that's just one of the hosts that
I used for some time they just allowed
you to see your passwords right in the
web application it's crazy ok so that's
not good
so let's fix it there are several things
to do that you can do it with monkey to
be just to filter and whitelist only the
parameters that you want to have in your
current user that's one way to do that
we're gonna have will go very simple way
we'll just have user object and we'll
just construct it we need to have email
with a request current current user dot
email and we need to have the confirmed
I think that's it that's all that we
need so now if we reload the page yeah
our state is much better all that we
have here is loaded email and confirmed
that's good but now I think we have
another problem yeah we can go to the
dashboard that's because right now I
actually remove the token from the redux
and basically we do not need to have it
there we do not do anything with this
token on the client side except that we
just make sure that it is there and we
include it into the old all the requests
so if you go back here and let's go to
our components routes routes where our
routes yeah here user out here's where
we check for is authenticated this state
user token that's why we should use
selector here but we are lazy so we're
gonna have just in
if there is a user email it means that
user is authenticated so now we co can
go back to dashboard that's good and if
you load the page you can see that we
have this loading indicator and then we
have in our application if we go in
we're going to log out everything works
if we go to the dashboard now we ever
directed back so hopefully we didn't you
don't ruined a lot of stuff but we still
can't log in why is that so let's have a
constructor loaded is marked as required
but value is undefined so let's track
down what's going on so when we log in
we dispatch action with the users so not
users out and here is login and what we
do here we have the API then we haven't
the token there and then we set off the
relation here and then we dispatch user
logged in with user but that's not
enough
right our user has some information if
we go back to our redox we'll see that
we have loaded email confirm to username
oh yeah username we need to have user
name as well and we have token but we do
not have all this loaded this wasn't in
the response so that's why it becomes
false so all we need to do is just to
disrupt it here we'll have user and we
add loaded to true
let's try to log out and let's try to
log in again and now it works great but
now here we have username but if you
reload the page we will not have user
name because we forgot about it so let's
go to API and let's add user name here
as well
user name let's be lazy user name
like this so now if you're all over the
page we have used me nice Oh
so I think we accomplished what we
wanted to do so if we log out we have
this the main thing here is that we have
loaded an indicator and now we can load
our application initially with all
information that we need for this
application be very fast and yeah that's
the purpose of the single page
applications and react stuff right so
that's a good place to commit our change
so here we have the load current user
details done
oops done and we ran the load in first
and then proceeded to app when it's done
done nice so let's commit this change in
API we just added the current user API
endpoint and on the react
we added initial loading initial app
loading commit messages are hard so
let's take a break and thank you very
much for your time if you like this
episode just hit the like button
subscribe to this channel share it with
your friends colleagues loved ones etc
and yeah spread the word if you want to
support me you can become a patron or
you can make one time donation my paypal
or even better you can go to J's
full-stack comm and purchase my course
thank you very much for time and have a
great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>