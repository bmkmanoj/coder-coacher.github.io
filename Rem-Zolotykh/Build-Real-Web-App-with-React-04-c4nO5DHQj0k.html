<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Build Real Web App with React #04 | Coder Coacher - Coaching Coders</title><meta content="Build Real Web App with React #04 - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Rem-Zolotykh/">Rem Zolotykh</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Build Real Web App with React #04</b></h2><h5 class="post__date">2017-09-06</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/c4nO5DHQj0k" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi my name is RAM and welcome to another
session of the series of life coding
where we develop real web application
with react and our GS so today we're
going to continue with our login feature
and the plan is to have the dashboard
page and as we know from our mock ups
the dashboard page should be available
only to authenticated users and that
means that we're going to create
authorized routes and then we'll proceed
with user signup feature okay before we
begin I want to thank you all for your
comments for your likes for
subscriptions that's really every time
that I see a good comment that makes my
day thank you very much
and I want to thank all the patrons that
support me I'm humbled thank you and
let's go to the code in so first of all
here let's go back to our github
repository and you can see that we
almost almost completed the user login
feature so I can we have the set setup
completed we have format for validation
we have several components we do not
have dashboard page but we're gonna
implement it now we have no GS project
we have authentication with JSON web
token we have API for user
authentication we have user data and
token generation so what left is
authorized rounds so before we do that
we need to create dashboard page and
redirect to that page so let's do that
so here I am in react application so
let's go to what do we have what we call
it login page so here we redirect to
route URL but let's go to dashboard okay
so now we're going to redirect here so
let's open up the GS and describe or
define this dashboard route and for that
we'll use dashboard page component so
here I'm going to copy it and have the
dashboard page now we need to create one
so in components pages there's board
page from
on it there's going to be class
component as well without any state but
it will have this admit because no it
won't know what yeah - port is for now a
dashboard is just the page without
anything but what we want to do we want
to display this negative message to
confirm your email
so when user signups and we do not
require to confirming or right away to
use the application but we negging our
users hey just to unlock the full
potential of this application please
verify your email address so that's what
we're gonna do here so here we have the
dashboard page it's gonna be a div and
we want to display some message if is
authenticated so it is authenticated
then we want if not authenticated oh is
confirmed so if it's not if users not
confirmed then we want to have this
confirm email message okay a lot of
assumptions so we need to have this is
confirmed we take it from redox state so
we can act from react Redux
we can act our dashboard and here we'll
have map state to props function so
let's define it function maps taped
props take state really enough I did not
use the snippets for it for anything
else I use it but for this now and I'm
gonna return the is confirmed to be just
state user confirmed so we do not have
confirmed so it will be undefined and
that will actually break not break but
it will warn us because right now here I
will define the that is confirmed is a
boolean so if I define it as
if I pass undefined it will it will have
warning
so for now I'm just gonna convert it
into boolean so prop types and here I
deconstruct it here okay so the next one
is confirm email message so as create
one confirm email message is going to be
messages confirm email message so let's
go to messages confirm email mess
messages message functional component
nothing here so what we gonna have here
is a message component from semantic UI
react and here instead of d f-- i will
have message info i think called
info and here we'll have the message
that header please verify your email to
unlock awesomeness okay
so we're a simple no props nothing like
that so now if we go to to the browser
and let's go to the dashboard page
dashboard page we have to this verify
your email to unlock Ausmus nice it
works and it will be nagging our users
for a long time maybe later we'll have
some kind of a close so do not show me
this message again and we will save it
in the database but for now until user
verifies email we are negging but as you
can see here I am I'm not logged in so
I'm uh not that I'm not authenticated
but I still can go to this page which is
not good and that's the next thing that
we want to do to create authorized
routes and route routes in route react
router version 4 is just another
components and that's the genius behind
all of this is that just
components so we can create another
higher-order component and have our
logic in there so let's have a look so
here in app this dashboard I want it to
be available only to users so I will
create user route and I pass everything
like I do for routes so here I'm gonna
import user out from like this
components routes user out so now let's
create one components routes user route
there's going to be a functional
component use a route and it will take
in props it will take several things so
it will take everything that will be
passed around
so we'll take component from it and we
rename it to component from capital C
and then the rest of it will get into
this rest variable so now here what
we're going to do is we're gonna use
route and we're going to passed all of
the props that we pass to this user
route to the route here okay so
everything that we have just there but
instead of components like we did before
we're gonna use render and we're going
to render component for now so we'll
have props and we ran the component and
we pass props to it so basically what we
did right now we created higher-order
component and we just do absolutely the
same that just the simple component as
here so nothing has changed but we need
to define prop types and we need to
define prop types define component and
components just the function react
components or functions and we need to
import route from react route down
okay so now if we go back here we'll see
that it works it still works
we have user route now route and a to
the dashboard but now we can introduce
the conditional we're gonna connect our
route to read X store and then to see if
it's authenticated we render the
component if it's not authenticated we
redirect so let's import connect from
react redux so we're going to connect it
here again map step two props function
we return object is authenticated to be
again state user token like we did
previously so now in prop types we also
need to define is authenticated to be a
boolean and we pass it here as well so
now we have is authenticated so let's
introduce it right here so if is
authenticated then we'll run the
component
otherwise we render read direct
component to homepage so this redirect
component we input from reacts wrote
down and now if you go back to our
browser you can see that we being
redirected to home page we can't access
dashboard route anymore
nice right so we can create another
route this almost the same route let's
copy and let's create guest route is I'm
gonna paste it and the only thing that I
want to change if if it's not
authenticated then we run the component
otherwise we redirect to dashboard so
that's for example where we want to use
it is in our app here in Laden so only
guest users should be
should have access to login route so
let's import guest route as well now
let's have a look yeah so now if we go
to login you can see that we have the
login page available to us we can't go
to dashboard because we are not
authenticated but we have a problem
actually with a reactor out right here
so nothing happens what's going on so
this is the problem with update blockers
and you can read about it in official
documentation but basically when you use
react connect react Redux connect
function it will have a conflict with
reactor outages so we need to have a
workaround and you can read about it and
in documentation if you want to learn a
little bit more details but basically
what we want to do we want to pass to
each round here to each round that we
use we want to pass location occasion
equals location and that will fix it so
we'll take this location and let's
define let's define location as we could
do it like this but linter will not be
happy when we define it as object
because defining something in JavaScript
as object is almost the same it's not
defined at all it's just it can be
anything right so that's why linter
doesn't like it instead of it will use
shape and in shape let's have path name
to be string we actually doesn't care
about what's particularly there in this
object for this particular component but
that pretty good so we have location we
pass it down to other routes but
application itself doesn't have an
allocation so for that lets go to index
digest file here let's import from a
reactor outer route and here we instead
of just app will use route for any kind
of route and
is app so this way we'll have route that
will render app component and past
history location to it and then in app
itself we're gonna use this location to
fix this problem so if you go back let's
go back to to the home page and now if
we go to login it's fixed so this kind
of a workaround when you connect
components to redux and use them in your
route so you you will have blockers so
and that's one way to fix it ok so now
we have authorized routes we have login
page we have dashboard page so if I log
in one two three four five and I login
I'm redirected to dashboard and I have
access to it
I have this nagging message and if I go
to login I will be redirected back to
dashboard because I'm already signed in
let's go so let's status so what we did
authorize routes good so the next step
is to create signup page so basically
what we gonna do we already done it
almost exactly the same with login so
we'll have route which points to page
that page will render form this form
will have client-side validation and it
will make a synchronous requested server
display render the server error messages
and if everything is okay it will
redirect somewhere in our case after
sign up we also want to we again want to
log in automatically and then go back to
dashboard so if I go here in the github
we finish this authorized route so we
finish this user login feature we can
close it close it nice so the next one
is user signs up and here you can see
again my markup so we have sign up route
sign up page and sign up form and sign
up form is almost identical to login
form so we have on the email and
password
even without confirmation so we trust
our user to type their password from the
first try and if user makes a mistake he
always can reset the password and then
on the background will send information
email and redirect dashboard with the
negative message we got this part with
the negative message already so we need
to have this sign up so let's get
started
so first let's define guest route I'm
gonna find it right here
it's guest route to sign up and we'll
have sign signup page here pages here
we'll have sign-up page let's go to
components pages signup page yes there's
going to be a component class component
signup page without a state but with
submit like we did before so it will
take data and it will invoke thunk
action these props sign-up path data and
if everything is ok it will this props
history it will push to dashboard ok so
now here in India if we'll have the form
so we'll have signup form and we pass
submit to this one this submit of course
we need to connect it so here we need to
have signup action and we need to define
this history push so let's probe types
define first of all history like we did
before there's a shape with push as a
function and we have the signup that is
function so we now we need to import
prop types and we need to import connect
from reactor edicts I need to create
snippet for this stuff so now I have
disconnect I do not need anything from
the state but I need to have the sign up
here
good so in the last thing I need to
import sign-up form from forms sign up
so as create in form to create sign up
form the GS that's the component I
actually have the the whole snippet for
forms but I will show you other snippets
that I do so here I have the sign up
form and here I can design my state
usually it's data here i will have email
and password that's all that i need in a
form i also will have as usual loading
loading false and errors empty object in
render I will deconstruct it and we will
take data errors and loading from this
that state so here as well I need to
have the prop types and in prop types
this form will take submit function so
I'm gonna define it oops define it and
we'll have the submit as a function next
I need to have the form to input form
and button from semantic UI react and
here instead of deep will have form this
form will have the on submit equals this
on submit and also loading to equals
loading 2 equals loading you can see how
repetitive it is how I type almost the
same thing over and over again so almost
any kind of form will have this kind of
code so that's why I have snippets so
now I need
define this on submit pretty easy I have
on submit snippet and it's almost always
doesn't change so it's like this so now
here I have this code to validate so I
need validation so I have a snippet for
that as well and I can define my
validations here so if not is email data
email then errors that email equals
invalid email and for password if not
data password then error is that
password equals can't be blank so now I
need to have this is email I'm gonna
import it from validator leap is email
so now I have one submit and I have
validation so the next thing is to
define form fields and buttons so let's
start from the button you'll have button
primary and here inside of the button
will have a sign up so now form fields
to form fields and I have its name
before it symmetric form field BAM and
we have one for email email the type is
email and the placeholder is oh I messed
up with my with my snippet here and the
placeholder is email at email calm and
here I need to change it to on change
and I need to do the same thing so as
you can see here I have inline error
so let's simple it inline error from
messages inline error and I need to do
the same thing for another one so I have
react semantics form field for password
password and type is password as well
and placeholder I do not in one
let's remove it and here I will have
unchanged okay so now we need to define
this unchanged unchanged BAM
and we done so the form is done we have
States we have unchanged in and submit
we have validation we have the form
itself we have prop types all that we
need good so as you can imagine you can
abstract it you can extract it to the
higher deform component to eliminate
this duplication if you want to I
usually don't because sometimes very
often forms goes other way so they
become in much more complex because when
you have this power of react and you
have the ability to create really
powerful interfaces you do all this kind
of stuff so yeah I prefer to do this way
so now we have form but now we need to
define this action and reducer so what
we do here in in our submit in sign up
page we have the sign up which we
haven't yet imported so we'll have sign
up action from actions users so this
action is going to be used here passed
as a prop and here we call it when we
submit the form so now we need to create
in actions users J's file and inside of
it will define func action that we call
sign up it takes data it has dispatch
and then here we'll just make API called
user sign up sign up it will pass data
to it it will respond with user data so
what we're going to do here is we going
to dispatch user logged in because
that's what we want to that's what we
want to do we want to dispatch we want
to login user after successful
registration okay so now we need to
improve API from
API we need to import user logged in
from out actions and Linda will still be
not happy with our expert here because
when we have only one expert it wants
you to use default export expert default
but we'll leave it for now because we'll
have much more actions here later so now
we need to go to API and let's define
another method here because it's sign up
so it takes user and we have also access
Post will have API users and we pass the
user to it and if everything is ok we
have response and we return user data
done so that's the client side now we
need to handle the backend so if we go
here and let's log out
let's add here the link to the signup
page sign up route so if you go to home
page here you have the link
let's enclose it wrap it into div and
here we'll add or link to sign up sign
up
okay so now we can go to sign up here is
the form if I try to sign up
I have 404 so we make a request but of
course we haven't defined this round so
now we need to go to the backend and
create this route so let's do this we go
into the backend code so first of all in
index dot JS file let's import users
route and let's mount it into users here
okay so now let's create one in routes
will have users the GS and that's route
so router that pause post and we have
request in response so what we want to
do here first of all we we want to
create a new user model so let's get
email and password from from request
body credentials request body user and
now we need to create constant user
equals new user and we pass that we want
to have email to equal this email and
that's it because we do not want to pass
passwords in our model here so let's
import this model user from models user
so here in our model in user model you
can see that we have password hash we do
not have just a password so what we
gonna do instead after we created this
instance will use user set password and
pass password to it so now we need to
define this set password let's do it
right here so we'll have schema methods
set password equals function set
password it takes password
and we do not need to return anything we
just said this password hash equals to
be creped hash sync and we pass possible
to it and 10 for salt done so that's
what we need to do so we make a request
we have email password we hash in this
password and we have now we have email
and hashed password there so after that
we want to save so here in users I'm
gonna do user that safe and that will
return promise and if everything is OK
it will return user record to us if
something went wrong for example
validation error it will return this
error it will throw an error at us so
let's do just this we need to we need to
validate that email is unique right and
for uniqueness we need to install
another plugin for Mongoose so here I'm
an API in terminal and I yarn add
Mongoose unique valid data okay so now
we have unique validator if you go back
here in our model we can input it unique
value data from Mongoose unique that
very complex words valid data and now
when we have this Val data we just use
it as a plugin so we registered on our
schema schema that plugin unique
validator and another thing that we can
add is the custom message so for example
this email is all ready taken something
like that ok so now we have plug-in
activated on this schema and we can use
on our email here we can use unique true
done also while we're here let's add
another
attribute confirmed because we're gonna
use it later it's gonna be a boolean and
default is false okay and let's add it
to Jason as well
confirmed days confirmed okay so now we
save it it will check for uniqueness it
will have this validation and if
something is wrong for example I
I will try right now to submit to sign
up with the same email that I already
have in the database then we want to
catch it and it will have an error and
this error is different from what we
expect so let's just response Jason
error just to have a look what it looks
like okay so now for all of the page and
I will try to submit with to sign up
with the same email loop here we have
users and you can see that error has the
error is an error object inside of it we
have errors but the errors themselves
are another object with a lot of
messages there but that's not what we
want
that's what not what we use in our
validation we have much simpler
structure so to remedy this we can
create a parser so let's create utils
folder and inside of it parse errors
file and here we export default function
here we define result as an empty object
and then we return this result so what
we want to do we want to create the same
object so we have the as an attribute as
the field is the form field and then
just the message error message so for
that I will use lo - for each and I will
iterate through errors that are passed
to this function
so we'll iterate errors it will take
value which is the error object and key
which is the field and I will do result
key to equal value message like this so
now I need to import from lodash and of
course I need to install loader so yarn
ad low - explicitly it is installed it
is used by a lot of libraries but just
for our linter not to freak out like it
does right here and now I can use this
so I'm gonna input parse errors from UTS
parse errors and now I can use it right
here so I will do errors equals to parse
errors error errors
I guess so now let's try it out if I
sign up we have users and we have errors
as we want them but now the thing that
we need to do of course is to add here
the status the error status so we have
the error on our client so we'll have
400 and let's try it again
now this email is already taken so we
have user we have my server-side
validation and uniqueness validation
nice so now what happens when it's okay
so then we have the user model and we
can just respond with Jason user to
equal user to of Jason so we already
created method that creates this object
that we want to pass down to the client
so if everything's okay
it will do like this okay so linty
doesn't like that i have user here and i
have user here so I will just rename it
to use a record oops not this one
that's just simple user use a record
here okay so now let's try to sign up
with test test calm and here we'll have
one two three four five
excellent so we the user has been signed
up logged in and we redirect it to
dashboard if we go to terminal here and
let's go to Mongo and I'm gonna just use
bookworm and then just DB users find you
can see that now we have two users and
one of them is test test with hashed
password and as we use this time stamps
you can see that we have updated it and
created at data cool exit for me so
that's basically almost it so what we
did here we sign up with a client-side
validation done we serve a side
validation at check for email uniqueness
done the last thing that we need to do
is to send confirmation email and we're
gonna talk and implement emails and then
in the next session so let's status and
commit it's gonna be user sign
up and that's it for today if you liked
this episode please don't hesitate to
hit the like button that makes my day
subscribe to this channel share it with
your friends and social media you know
the drill if you want to support me
financially you can go to my patreon
page and yeah thank you very much for
your time and have a great day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>