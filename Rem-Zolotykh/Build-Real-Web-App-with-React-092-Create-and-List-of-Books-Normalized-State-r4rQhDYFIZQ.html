<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Build Real Web App with React #09.2 - Create and List of Books, Normalized State | Coder Coacher - Coaching Coders</title><meta content="Build Real Web App with React #09.2 - Create and List of Books, Normalized State - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Rem-Zolotykh/">Rem Zolotykh</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Build Real Web App with React #09.2 - Create and List of Books, Normalized State</b></h2><h5 class="post__date">2017-10-14</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/r4rQhDYFIZQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">so now the client is the different story
right now on the dashboard page what we
have here we connect this dashboard page
with our Redux store and we have all the
books from it and then we check so if
books length x equals zero then we
display this call to action stuff but we
never actually do any kind of request to
the server to get books all right so
it's it's false information here so the
first thing that we need to do is to
make this request to get all the books
and then display either call to action
or shelf of books and we're gonna
introduce shelves later as well because
it's very important concept here okay so
for that we need to convert this to the
class component so we'll have class that
extends react component and here we'll
have render inside of this render we'll
have constant and I'm just gonna copy
this thing cut it and paste it here from
this prompts and then we'll have return
and we'll just copy and woops just shift
this into here and I just let prettify
do its job it's amazing so now we have
the class component and we can define
company ended mount and inside of it we
can make the request actual actually
let's do it a little bit differently
this time so it's maybe a good practice
to actually extract the initialization
into separate function and call it from
component it mount or component will
receive props so we'll have one in need
on in it you can name it as you like and
that's function that found function to
take props and that will do all the
things so in our case we want to fetch
books so we'll have props that fetch
books
so an component amount is just going to
be this on in it
this props and we pass props so we can
reuse this on in it for example in
components will receive props so now
this punch box is the thunk action at
last
so how he again going to make funk
actions because we need to get the data
and place it into our redox tour
afterwards
so let's import it fetch box from
actions books we do not have it yet but
we will have in a minute then we need to
connect it here
fetch box and we need to add it to prop
types fetch box is the function okay
done good so now we need to define these
fetch books so let's go to actions books
the GS analyze define funk action vag
books it doesn't take anything here it
has the dispatch and here we'll have the
API books fetch just fetch or fetch all
that's called fetch all it will get us
the books and this books we want to
place into our Redux store so we need to
dispatch action that we call books
fetched and we need to pass books into
it but but we will use normalized state
we will normalize this books data and
then we pass it down to the action and
action we'll just pass it down to the
reducer so we will use normalized for
for it again I will not get into much
detail about it because I don't want to
bog us down but you will see how it
works and you can read through the
documentation to get a grasp of it or
you can just wait for my course on redux
so let's import API from API first of
all let's go to API here and let's
create another field here books and
fetch all is going to be the axis get
API books and this and that's it then we
have books and then we have responsible
just get response data books okay so now
in books here we'll have this book's
page so let's define const books fetched
simple pure redux action it returns the
type that is books fetched and we pass
down data into it so this data is going
to be normalized data and a little bit
later we'll see how it looks like so but
basically it looks like spoiler alert
data entities and the name of the entity
that we have here is books so that's
what is going to be passed to the to the
reducers I will keep this comment for
now here okay so we need to import the
books fetched from types so now we need
to go to types and let's add books
fetched into here okay we don't care
about this expert because we're going to
add another expert here pretty soon
okay so now let's normalize this data
and if unfortunately we will not see
anything right now because we do not
have books but in a moment we'll have
our first book in the database so for
normalization here we do not pass the
books that we returned from the server
but instead we normalize this and we'll
do it I will just create it for a better
so you can see better what's going on so
we'll use normalize and to normalize we
pass the data itself and then the schema
that we want it to be normalized against
and it's the book schema but we have an
array of books so we'll have an array
book schema like this so we need to
install normalizer so let's go to
terminal here and we'll yarn add
normalize
okay
so now here will just import normalize
from normalizer
and now we need to define schemas so
we'll define it in one file you'll have
book schema or we inverted from schemas
and let's create the schemas file GS and
schemas are very simple so we just
import schema from normalizer
and then we export const the book schema
oops
book schema and that equals to new
schema that entity and we pass several
parameters to it usually all you have to
do is just to pass the pluralized form
of it so books for example but in our
case as we use manga manga to be wanting
to be using this underscore ID but by
default normalizer uses the ID so we
need to provide this option so for that
the second parameter is an empty options
and the third one is ID attribute equals
to ID so this is our schema good now we
need to go to our reducer we'll go to
books with users here let's import books
fetched from types and here we'll add
case books fetched and that's the beauty
of normalized thing so for add new items
to the reducer and for updating items we
just use the same code because we have
we all the time we have this data and it
is books and the books itself is not an
array it's a hash so we just merge them
and that's and that's it
so we'll have this state and then we'll
have the action and it is books - so
this kind of this way we merge them so
in the beginning we have just the state
the empty object so we merge it with the
books we have books
if we add another books another book so
we'll have an estate just one book with
hash and we just merge it and it's a
pants to the to the house that we
already have okay so that should do it
it works in redux we still have the same
thing books is an empty object nice whoo
we did a lot of job but we haven't
changed anything right but that's a good
necessary groundwork so now here in the
dashboard page we have books and we
making the request let's have a look
yeah so we know we did a lot of things
so if you go to the dashboard we have an
error I missed something
oh no API books internal oh yeah so we
maintain the request and we have 500
hours so let's have a look and yeah I
knew it yeah so this spread operator is
not available to us we need to install
babel plugin for it so yarn at babel
plugin and the name of this plugin is
i'm gonna look up i looked it up so the
name of is flying in as babel plugin
transform object rest spread i can never
ever remember it and after we install it
we go to to the editor to our react I'm
sorry
API code go to Babel RC and here define
plugins and add it here as well so
transform object rest sprite so now this
functionality is available on the server
as well so let's have a look I'm gonna
reload the page and no no no no no still
not good enough let's reload
and let's try it again okay so can it
read books off on defined action data
yeah
action data but yeah we're gonna fix it
so here books and you can see that books
is an empty array so our request works
but I must stop in in reducer so here of
course we have data so we have action
data and it is both data because in
actions here we call it data right here
so it could be anything I prefer just
use data because it's more generic in
this way okay so let's try it again
hopefully this time it's going to work
and in Redux you can see that we have
books fetched action and this action
didn't do anything because we have empty
books for now and that's why we see this
stuff here so now let's add new book and
to add new book we actually I think we
can do that right now almost we just
need to go to the book booooo new book
page here so and after we oh now we
can't we have add book so here instead
of this console does not we need to add
book and for that we need to dispatch
new action so here we'll have these
props that create create book and we
pass book data into it so we'll have a
book and we'll have book and then if
everything's go well we have these props
that history dart push and we push it to
dashboard ok so now we need to define
all of this thing so first of all let's
start with definitions so pity def so we
define the prop types the first one is
create book there's the function and the
second one is the history we already did
it so it's a shape and inside of the
shape we have push which is function so
we need of course to include prop types
and then we need to connect
this this component so we can pass this
action to it so let's connect here we'll
have the connects we do not need to pass
anything from here but here in this
patch we provide the create book okay so
the create book itself is we going to
take it from create book we take from
actions actions books so back to actions
here we define another function so we'll
have that action create book it's called
data we need to have this page we have
API dot books and we call it let's just
create create and we pass data to it at
the result we'll have poked and again we
do the same thing we dispatch book
create action we normalize the response
with book and the schema is not the they
array anymore so we just provide books
schema so now we need to create it so
let's just copy this thing here so
that's it gonna be
book created and here as well book
created and we need to import it from
types okay
created so let's go to types book
created okay and that's pretty much it
so we need to go to API now and let's
add yeah let's add create it takes data
I think book and we do access post API
books and we pass spoke to it and then
we have response and we get data book
from it
now we need to go to to reducer let's
import book created and now we just add
this case book created to the reducer
but the code is absolutely the same
whether we create a new book and add it
to collection or we recite the
collection usually that's the same and
if we update books one book in this hash
also the same code because we have
normalized the state and we'll see how
it looks like in a moment so now let's
try to create one so let's my favorite
book three men and boats
three men and boat we choose it we save
it we redirect it and you can see that
we do not have this call to action
anymore because we have books in our
state first of all we have this book
created and this book created actually
populated the redux store with with this
book data as you can see here and then
we made when we were redirected to the
dashboard we made another request to the
server like a background server request
to fetch all the books of the rest of
the books so and here is but nothing
changed because there's the same
collection of the books and here what we
have in our books collection books hash
so just for fun let's let's have a look
how how this normalized state looks like
so for that let's go to action and for
example here when we make these fetch
books I'm gonna copy let's do it like
this okay so instead of dispatching
we'll just console dot log it normalize
and now you can see how it looks so as
you can see here we have entities and
inside of this entities we have books
entity and instead of this we'll have
hash of objects so ID and then by this
ID we have an object so we have
small database also there is the result
but I rarely use this result for some
reason and that how it looks so let's
just go back to normal stuff okay so we
actually achieved almost everything that
I planned for this session we have the
we have we requested we request books
from the server we save books in the
database that's cool
another thing that I want to do right
now the last thing is to add this add
new book as the elements of the top
navigation because I need a way to add
out a book and other books but I do not
need to have this big call to action
because what I want actually is just to
display the books with progress and
that's it I do not need any kind of
additional noise into it so and right
here we'll just type something out for
now and in the next session we'll just
create the cards for the books okay so
let's do it pretty quickly so in the
dashboard page here so if books plan
will just zero we'll just make it as a
conditional here and we just add just
the P tag you have books okay just to
demonstrate that here you actually have
books and now we need to go to top
navigation so let's go to top navigation
and here this top navigation has already
connected so we can reuse the selector
that we already created right here
so we have this selector old books
selector so let's reuse it here so has
books so if user has books we want to
display additional menu item so we have
this state books and if lengths more
than 0 then we it means that it had we
it has books so let's define it here has
books is it boolean and let's edit here
so if
here has books Eve has books then I want
to display another menu item and this
menu item is going to be books new and
we have add new book and of course I
need to import this all books select
them let's have a look where I import
from here is just copy okay so let's go
back here in the browser and here we go
add new book so if we delete the book we
have different UI so you got the idea
okay
but another thing that we actually need
to fix and that's what I want you to do
as a home task and we will fix it later
but not today so as you can see when I
reload the page I I see the call to
action that it disappears this
flickering effect and that happens
because right now the dashboard page has
two states zero books and more than zero
books but we have another state Loden
books right so when we making the the
request to the server so try to
implement it find a way to to display
the loading indicator and if we have no
books then then call to action if we
have books than this kind of UI but
that's it for this episode thank you
very much for your time and for your
interest if you if you like this video
please hit the like button subscribe to
this channel share it with your friends
if you want to support my work go to my
patreon account or and become a patron
or make a one-time donation via PayPal
all contributions are very much
appreciated and join our community thank
you very much for time and have a great
day</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>