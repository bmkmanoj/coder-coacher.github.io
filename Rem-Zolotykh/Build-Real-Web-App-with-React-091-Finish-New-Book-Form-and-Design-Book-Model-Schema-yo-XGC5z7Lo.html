<!DOCTYPE html><html lang="en"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-114897551-4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-114897551-4');
</script><script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ac2443d1fff98001395ab6c&amp;product=sticky-share-buttons" async="async"></script><title>Build Real Web App with React #09.1 - Finish New Book Form and Design Book Model Schema | Coder Coacher - Coaching Coders</title><meta content="Build Real Web App with React #09.1 - Finish New Book Form and Design Book Model Schema - All technical stuff in one place" name="description"><meta name="keywords" content="education, coding, programming, technology, nodejs, mongodb, software, computer science, engineering, teaching, coaching, coder, learning, java, kotlin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/coder-coacher.css"></head><body><div class="container-fluid"><h1 class="site-title"><a href="/">Coder Coacher</a></h1><hr><h4 class="site-subtitle text-right">Coaching Coders</h4></div><div id="amzn-assoc-ad-99d6751e-2392-4004-ad16-73aa8385d9d0"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=99d6751e-2392-4004-ad16-73aa8385d9d0"></script><div class="post__breadcrumb"><div class="container"><ol class="breadcrumb"><li><a href="/">Coder Coacher</a></li><li><a href="/Rem-Zolotykh/">Rem Zolotykh</a></li><li class="active">â¤µ</li></ol></div></div><h2 class="post__title"><b>Build Real Web App with React #09.1 - Finish New Book Form and Design Book Model Schema</b></h2><h5 class="post__date">2017-10-13</h5><div class="container"><div class="video-responsive"><iframe width="560" height="315" src="https://www.youtube.com/embed/yo-XGC5z7Lo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div><div class="post__text">hi my name is RAM and welcome to the
series where we build real web
application with react and OGS
in this episode we'll continue to work
in with Goodreads API and we'll save the
book into our database and alongside
will at last start working with Redux
store and we will normalize our data so
before we begin I want to make an
announcement huge announcement for me
very exciting so a couple of days ago I
launched the J's full stacker calm and
if you go there you will see the timer
the countdown timer that comes down to
my publishing my own premium core so
it's very near it's very close to the
release and it's very exciting so it
counts it counts it comes down like six
days but we'll see how it goes because
maybe banks and legal staff can delay it
a little bit but I'm doing my best work
right now to make it on time also I'm
rear according some of the some of the
content of the course so it will use the
latest react 16th version so that's one
of the ideas to make it evergreen which
is pretty cool so if you interested if
if you find it interesting just go to
this website sign up to my newsletter
and get the first chapter of the course
for free that's 35 minutes of content
about react components not shabby so and
yeah don't hesitate to let me know what
you think about it your comments yeah
anything like that will be very much
welcomed also I want to thank my patrons
and I want to give a shout out to a pay
and hello I'm hoping I'm pronouncing
your names right guys thank you very
much for your activity on the forum for
questions for discussions for your code
snippets it's it's really great and yeah
thank you very much for that if you want
to be part of it just a small donation
become a patron on the patreon page down
in the
in the description below I'll make you
one time PayPal donation okay so let's
get down to the development so what we
have right now here is that we can go to
add new book and we can search for books
from the Goodreads but when we choose
one we do not have pages because
Goodreads for some reason doesn't
provide pages for us so we need to make
another request to the to the Goodreads
to get this data so that's what we're
gonna do first and along the way we're
gonna fix some errors and see some you
know Cabot's with javascript bullying
stuff yeah so let's do this so let's go
to react code and it's good to you back
a new book page so here is where we set
in-state when we select the book so now
we need to extend it a little bit so I'm
gonna enclose it in in the parens and
right after I set the state with a book
right after that I want to make the
request so I'm gonna import access from
access because I'm still doing the
heresy I'm turning it right here without
any actions so what we did before we
made the request to our server and our
server made the request to Goodreads and
then handled the request why not do that
right from the reactor plication well
there is no reason not to do it you can
do it actually but there are two ways
you you should think about if you go to
the server code here and we go to our
routes books yep so right here you can
see that we have good risky that's a
secret information so as you can see I
actually extracted it into the
environment variable and you don't want
to store it on the client-side
but if you want if you really want to
you can use environment variables in
react application with the help of
create react app package as well another
thing is you need to parse XML so for
example in Goodreads provided good JSON
API we could just take the data in the
and parse it without any problem but
here we have example so we need to you
know to add another dependency just for
this parson thing which is not a good
thing to do on a client in my opinion so
there's another thing so instead we do
everything on the server all the
calculations right so what's this comes
from Adam but you can try to do it from
the client from the react app okay so
let's do the access get request to API
books and we call it let's say fetch
pages and we pass the primer okay I
always forgot to enclose it in two
different quotes like this and and we
provide the Goodreads ID 2 equal to book
good reads ID so that's what we send to
our server and from server as we control
it we can have any kind of response so
we can shape it so in this case response
data we call it pages and after that
what I want to do we have pages I want
to set state I want to set state for the
book and I want to take all the book
information that I already have and then
overwrite pages pages not overwrite
there is no pages there undefined right
now and that will become quite important
I think in a couple of minutes ok so now
we're making the request so let's go to
the server
and we create this fetch pages route
let's copy this round here now let's
change it to fetch pages so first of all
let's get the
goodra's ID from request query goodreads
ID so now here we make in another
request instead of search be going for
the book slash book slash show that
examine the key is the same and instead
of query we pass the ID this Goodreads
ID so in the result we have the same
thing you can go to the Goodreads API
and have a look how it works and what it
responds with I've already done this job
to not waste our time so here instead of
books we'll have pages and instead and
here to get these pages we get the book
and inside of this book we'll have num
pages so that's what we take everything
else we can just simply remove okay so
let's have a look let's try to find a
book and yeah after a second or so we
have our pages in there we got a lot of
errors for errors and one of the errors
that I want to point out is this one at
the bottom book form is changing and can
a control input of types number to be
controlled so this controlled
uncontrolled stuff on my youtube channel
you can find control and control
elements and react if you if you need to
learn about them but basically I I said
earlier that pages are undefined right
here so the pages aren't defined until
we set them here so we set them here no
pages at all and then we set them here
and in book form we have these pages and
we set them on this element pages right
here in input but this value will be
undefined and that means that react
doesn't control it but then it becomes
defined and now it's controlled on so
it's kind of confusing if you react so
we shouldn't do that so one way to fix
this is just a comment this thing out so
if we comment this out and we do this
then it will fix it but we will have the
delay so I click I have a delay because
I'm making another request and then I
just populate the whole thing and that's
why I do not have this error anymore but
that's not the best experience for the
users I think so
I already have this data I want to
immediately show them and while the
users just scrolling down BAM pages are
already there so it's much better
experience so that's not a way for me to
go what I need to do is to make it to
get rid of this particular thing this
particular error with control and
control stuff so there are different
ways to do that and one of the way that
we want to do we could do is to check it
here so if data pages is there then we
have data pages otherwise for example we
have zero so this way it it is it always
controlled so that will get rid of this
particular error 0 and then 150 and 9na
nice and we do not have this error
anymore ok that works but still I don't
like it this zero and then another value
of what if we have this book without any
pages ok it seems to work your pages so
why are you choosing this thin is
because if you go to the network here
you will see that it returns empty empty
string which is not good thing because
we want to get number two it also here
is well we have we do not have number we
have string and that's why we have an
error here as well so let's fix this so
here is book pages is marked as required
it's undefined
that's one error that we need to fix and
when we at last passed pages to it we
passed three instead of a number that is
not good so let's fix the thing with num
with number so let's go back to server
and here it's very easy to write or just
percent
and that's it we have a number except
one edge case so now if we choose the
book let's reload the page just to count
our errors okay we have two errors left
nice so this particular error is gone
but if we choose without pages will have
another error again it's required but it
it's not and it's now because we have
empty string it tries to convert it to
int it can't do that
so we need to fix it as well on the
server so let's do it like this so I'm
gonna enclose this into parenthesis and
after that I will define new constant
nan pages just gonna take this stuff out
of here and then even on pages if num
pages then I want to convert it to parts
and non pages otherwise 0 okay and I'm
gonna set it to pages and here I'm gonna
just remove everything from here okay so
non pages if it's an empty string it the
same it's false in JavaScript go figure
but empty string is false so we do not
need to do anything else we just check
nan pages if it's not empty then we
percent otherwise it's zero for us so
zero pages we have no information okay
so that's good we have we get rid of
this particular error but we got another
one so here we have the error message
that book pages is marked as required
but we pass the book without pages first
so we need to fix it and to do that of
course we going to remove this is
required stuff another thing that I want
to do I don't like this then I don't
like this 0 let's do it a little bit
differently let's say that I want to
Loden and i'm gonna change type from
number to text no big deal and here I
will I will add disabled and disabled is
going to be not data pages so if pages
are not defined its disabled we see
loading when we got pages back we got
the result and so let's have a look I
just want to while I still want to do it
as real world as possible
I still want to be it as an educational
stuff so I show you different things
different cultures etc so it would be
much more useful for you so now when I
do that okay I missed it
we had load and right so let's do
another reach that put it we have load
in and when it's done we have pages nice
but if we go to Harry Potter here
without pages nothing happens so we do
not get this 0 that is actually returned
to us 0 pages but we do not have it
right here
why because JavaScript its JavaScript so
0 is also false in JavaScript and that's
why we have this problem and this very
common problem not common but it
sometimes it just happens and you just
scratch your head and think why why and
that's why 0 is false so that's why we
should actually check for one date and
then to fine so we can do undefined okay
so if data page is undefined then it's
disabled otherwise 0 are the kind of
values there it's not it's enabled and
here as well undefined
if it's not undefined let's have lost
test
so here Loden nice okay I'm gonna just
do a bit space here reporte nice zero
okay cool so we got one last error left
and this I added fluid in the book form
okay let's search for food
okay so agreed yeah greets can't have
this attribute here
okie doke okay so now that we handle
this thing let's go to the next thing
that we need to implement saving book
into the database but before we do that
we need to actually design our database
schema and design our data and how we
would connect different types of
entities and that's what we're gonna do
next so we start simple as usual but we
still need to have a connection between
user and books right so book belongs to
user user could have a lot of books and
we will create a new entity book we'll
create a new model book so in in
Mongoose you would you always have to
invoke it to be you always have two
options you add either embed everything
in one document or you create separate
documents and then connect them by IDs
and in this particular case these are
two separate entities so we have user
representative book separate entity so
usually I am bad
only the entities that can't live
without each other
right so we need to create a book a book
model in our right here so let's create
bhakta GS
so we'll import month goes from Mongoose
and we define schema Const schema equals
new mongoose schema okay so here we're
gonna have it analyzed expert for
right away schema month Mongoose sorry
Mongoose model and we call it book and
we use schema for it
okay so what do we need to have so we
have title let's type string and it is
required and let's copy several times
because we have the same thing with
authors it's required it's a string
we'll have cover the same thing we have
Goodreads ID I think it's not required
maybe later we will ditch the Goodreads
there just an experiment maybe we will
have the complete form for our books
instead of the Goodreads API okay so we
have Goodreads ID pages pages that's a
number also required and the last one is
user ID so who is the owner of this book
it's very important because we could
have several a lot of users and we just
need a way to fetch the books for
particular user and the user ID will be
the type of object ID and for that we'll
use Mongoose dot schema that types that
object object ID required omen
so this is our schema so now to use it
in our books here so we will have to
route we'll have post route to create a
book and we'll have get route to get all
the books of the user so let's define it
right away usually I start from front
end but now it's it's pretty a simple
code and we can do it and test it later
so we'll have router post for books and
the first thing that we need to do is to
get user because in our middleware in
authenticate we do not
we only have user email in our requests
so we need to get user and actually to
think about it we always need to get
user to get any kind of details about
any kind of books shelves will have
different things the tags that user
created so we need to have user all the
time almost all the time so let's do the
same the thing that I talked earlier
when we developed this authenticate
middleware let's store current user
actual current user and this request
object so instead of this code we'll
import
let's import user from models use them
and let's add user find one by email and
we'll use the coded email and then we'll
have user and real set request request
that current user equals to user and
then we'll have next so this way when we
authenticate we make the request to the
database find the user and store it in
the request object and we can use it in
all routes that is authenticated so here
this all the routes and books are
authenticated so now in this request
object we have current user that makes
our life a little bit easier so now we
need to create a book so let's import
book from models book and let's create
one so we'll have book create and then
we need to pass down the book details in
request body a book and not only that we
could do it like this write book but not
only that we need to expand it with the
user ID so again there are two ways to
do that we can make it by a client to
include it through the client or we can
do it on the on the server I prefer to
do it on the server because here I know
exactly that this is the current user
because it's authenticated it's a valid
token so that's why I just
totally trusted I do not trust clients
Oh client could just change the ID
anytime to any kind of other user so
that's why we do it right here so we'll
expand it with user ID so we'll have the
content of the book and then we'll have
user ID to equal request current user
dot ID so after that we'll have the book
itself and what we want to do we want to
Jason book back but if you have any kind
of errors like validation error we need
to catch things so we'll have the catch
so let's go to other route that we have
already and I think in users yeah we
have this catch so I'm gonna just copy
and paste it because I'm lazy
okay so catch here and I need to have
this parse errors so I'm gonna import
parse errors from UTS parsers okay so
this is the post what about getting
users getting books easy peasy
so we're gonna have request get book and
again we need to find all books with the
user ID so we'll do book find and we say
user ID to equal request current user
underscore ID so then we have books and
we just response JSON books with okay so
we have everything we need and on the
back end I hope it works
so let's go back to to the client</div></div><div class="container-fluid bottom-ad"><div id="amzn-assoc-ad-6a809dda-347a-4187-8a86-91faf94575da"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=6a809dda-347a-4187-8a86-91faf94575da"></script></div><div class="text-center">We are a participant in the Amazon Services LLC Associates Program, an affiliate advertising program designed to provide a means for us to earn fees by linking to Amazon.com and affiliated sites.</div><script>(function(w, d){
    var b = d.getElementsByTagName('body')[0];
    var s = d.createElement("script"); s.async = true;
    var v = !("IntersectionObserver" in w) ? "8.6.0" : "10.4.2";
    s.src = "https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/" + v + "/lazyload.min.js";
    w.lazyLoadOptions = {};
    b.appendChild(s);
}(window, document));</script></body></html>